(self.webpackChunkvector_style_tester=self.webpackChunkvector_style_tester||[]).push([[179],{948:(xr,Gr,Ht)=>{"use strict";Ht.r(Gr),Ht.d(Gr,{default:()=>it});var Ut=Ht(630);function Jt(Ge){var Ke=Ge.expr,Wt=Ge.layer,on=Math.min(Ke(Wt,"paint","circle-radius"),8),Cn=Math.min(Ke(Wt,"paint","circle-stroke-width"),4),fn=Ke(Wt,"paint","circle-color"),et=Ke(Wt,"paint","circle-opacity"),_t=Ke(Wt,"paint","circle-stroke-color"),Dt=Ke(Wt,"paint","circle-stroke-opacity"),bn=on-Cn/2;return{element:"svg",attributes:{viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",style:{filter:"blur("+Ke(Wt,"paint","circle-blur")*bn+"px)"}},children:[{element:"circle",attributes:{key:"l1",cx:10,cy:10,fill:fn,opacity:et,r:bn}},{element:"circle",attributes:{key:"l2",cx:10,cy:10,fill:"transparent",opacity:Dt,r:on,"stroke-width":Cn,stroke:_t}}]}}function L(Ge){var Ke=Ge.expr,Wt=Ge.layer;return{element:"div",attributes:{style:{width:"100%",height:"100%",backgroundImage:"url("+(0,Ge.image)(Ke(Wt,"paint","fill-pattern"))+")",backgroundColor:Ke(Wt,"paint","fill-color"),opacity:Ke(Wt,"paint","fill-opacity"),backgroundSize:"66% 66%",backgroundPosition:"center"}}}}function C(Ge){var Ke=Ge.layer,Wt=Ge.expr,on=(0,Ge.image)(Wt(Ke,"paint","line-pattern")),Cn={stroke:on?"url(#img1)":Wt(Ke,"paint","line-color"),strokeWidth:Math.max(2,Math.min(Wt(Ke,"paint","line-width"),8)),strokeOpacity:Wt(Ke,"paint","line-opacity")},fn=Cn.strokeWidth;return{element:"svg",attributes:{viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},children:[{element:"defs",attributes:{key:"defs"},children:[{element:"pattern",attributes:{key:"pattern",id:"img1",x:0,y:0,width:Cn.strokeWidth,height:Cn.strokeWidth,patternUnits:"userSpaceOnUse",patternTransform:"translate("+-fn/2+" "+-fn/2+") rotate(45)"},children:[{element:"image",attributes:{key:"img",xlinkHref:on,x:0,y:0,width:Cn.strokeWidth,height:Cn.strokeWidth}}]}]},{element:"path",attributes:{key:"path",style:Cn,stroke:Cn.stroke,d:"M0 20 L 20 0"}}]}}function ut(Ge){return function(_t){var Dt=_t.image,bn=(0,_t.expr)(_t.layer,"layout","icon-image");if(!bn)return null;var Pn=Dt(bn);return Pn?{element:"div",attributes:{style:{backgroundImage:"url("+Pn+")",backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%"}}}:null}(Ge)||(Cn=(Wt=(Ke=Ge).expr)(on=Ke.layer,"paint","text-color"),fn=Wt(on,"paint","text-opacity"),{element:"svg",attributes:{viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},children:[{element:"path",attributes:{key:"l1",d:et="M 4,4 L 16,4 L 16,7 L 11.5 7 L 11.5 16 L 8.5 16 L 8.5 7 L 4 7 Z",stroke:Wt(on,"paint","text-halo-color"),"stroke-width":2*Wt(on,"paint","text-halo-width"),fill:"transparent","stroke-linejoin":"round"}},{element:"path",attributes:{key:"l2",d:et,fill:"white"}},{element:"path",attributes:{key:"l3",d:et,fill:Cn,opacity:fn}}]});var Ke,Wt,on,Cn,fn,et}var tn=[["background"],["circle"],["fill-extrusion"],["fill"],["heatmap"],["hillshade"],["line"],["raster"],["icon","symbol"],["text","symbol"]];const it=function(Ge){var Ke,Wt=Ge.sprite,on=Ge.layer,Cn={circle:Jt,symbol:ut,line:C,fill:L}[on.type],fn=(Ke=Ge.zoom,function(et,_t,Dt){var dr,jn,bn=(dr=Dt,(jn=tn.find(function(pn){return dr.startsWith(pn[0])}))?jn[1]||jn[0]:null),Pn=Ut.pA[_t+"_"+bn][Dt];if(!et[_t])return Pn.default;var an=et[_t][Dt];if(void 0===an)return Pn.default;if("object"==typeof an){var Rn;if(!(Rn=Array.isArray(an)?Ut.th.createExpression(an).value:Ut.ZI.createFunction(an,Pn)).evaluate)return null;var nr=Rn.evaluate({zoom:Ke},{});return nr?nr.name||nr:null}return an});return Cn?Cn({layer:on,expr:fn,image:function(et){if(Wt&&Wt.json){var _t=Wt.json[et];if(_t)return Dt=Wt.image,Pn=(bn=_t).x,an=bn.y,Rn=bn.width,nr=bn.height,(dr=document.createElement("canvas")).width=2*Rn,dr.height=2*nr,dr.getContext("2d").drawImage(Dt,2*Pn,2*an,2*Rn,2*nr,0,0,2*Rn,2*nr),dr.toDataURL()}var Dt,bn,Pn,an,Rn,nr,dr;return null}}):null}},511:(xr,Gr,Ht)=>{"use strict";var Jt=Ht(419);Object.defineProperty(Gr,"P",{enumerable:!0,get:function(){return Jt.default}})},419:function(xr,Gr,Ht){"use strict";var Ut=this&&this.__awaiter||function(Et,it,Ge,Ke){return new(Ge||(Ge=Promise))(function(on,Cn){function fn(Dt){try{_t(Ke.next(Dt))}catch(bn){Cn(bn)}}function et(Dt){try{_t(Ke.throw(Dt))}catch(bn){Cn(bn)}}function _t(Dt){Dt.done?on(Dt.value):function(on){return on instanceof Ge?on:new Ge(function(Cn){Cn(on)})}(Dt.value).then(fn,et)}_t((Ke=Ke.apply(Et,it||[])).next())})},Jt=this&&this.__importDefault||function(Et){return Et&&Et.__esModule?Et:{default:Et}};Object.defineProperty(Gr,"__esModule",{value:!0});const L=Ht(347),C=Jt(Ht(948)),ut=Jt(Ht(686));Gr.default=class{constructor(it,Ge){this.uncheckedLayers={},this.options={showDefault:!0,showCheckbox:!0,reverseOrder:!0,onlyRendered:!0,accesstoken:void 0,title:void 0},this.sprite={image:HTMLImageElement,json:JSON},this.targets=it,Ge&&(this.options=Object.assign(this.options,Ge)),this.onlyRendered=this.options.onlyRendered,this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}changeLayerVisibility(it,Ge){var Ke,Wt;Ge?(this.uncheckedLayers[it]&&delete this.uncheckedLayers[it],null===(Ke=this.map)||void 0===Ke||Ke.setLayoutProperty(it,"visibility","visible")):(this.uncheckedLayers[it]=it,null===(Wt=this.map)||void 0===Wt||Wt.setLayoutProperty(it,"visibility","none"));const on=document.getElementsByName(it);for(let Cn in on)"number"!=typeof on[Cn]&&(on[Cn].checked=Ge)}createLayerCheckbox(it){var Ge;if(!this.options.showCheckbox)return;const Ke=this,Wt=document.createElement("TD");Wt.className="legend-table-td";const on=document.createElement("input");on.setAttribute("type","checkbox"),on.setAttribute("name",it.id),on.setAttribute("value",it.id);const Cn=null===(Ge=this.map)||void 0===Ge?void 0:Ge.getLayoutProperty(it.id,"visibility");if(Cn){let fn=!0;switch(Cn){case"none":fn=!1;break;case"visible":fn=!0,on.checked=!0}Ke.changeLayerVisibility(it.id,fn)}else on.checked=!0;return on.addEventListener("click",function(fn){var et,_t;const Dt=null===(et=fn.target)||void 0===et?void 0:et.value,bn=null===(_t=fn.target)||void 0===_t?void 0:_t.checked;Ke.changeLayerVisibility(Dt,bn)}),Wt.appendChild(on),Wt}getLayerLegend(it){const Ge=this.map,Ke=null==Ge?void 0:Ge.getZoom();let on=C.default({sprite:this.sprite,zoom:Ke,layer:it});if(!on)return;var Cn=document.createElement("TR");const fn=this.createLayerCheckbox(it);fn&&Cn.appendChild(fn);var et=document.createElement("TD");switch(et.className="legend-table-td",on.element){case"div":if(on.attributes.style.backgroundImage&&!["url(undefined)","url(null)"].includes(on.attributes.style.backgroundImage)){var _t=document.createElement("img");_t.src=on.attributes.style.backgroundImage.replace("url(","").replace(")",""),_t.alt=it.id,_t.style.cssText="height: 17px;",et.appendChild(_t)}et.style.backgroundColor=on.attributes.style.backgroundColor,et.style.backgroundPosition=on.attributes.style.backgroundPosition,et.style.backgroundSize=on.attributes.style.backgroundSize,et.style.backgroundRepeat=on.attributes.style.backgroundRepeat,et.style.opacity=on.attributes.style.opacity;break;case"svg":let an=document.createElementNS("http://www.w3.org/2000/svg","svg");an.style.cssText="height: 17px;",an.setAttributeNS(null,"version","1.1"),Object.keys(on.attributes).forEach(Rn=>{an.setAttribute(Rn,on.attributes[Rn]);let nr=document.createElementNS("http://www.w3.org/2000/svg","g");on.children.forEach(dr=>{var jn=document.createElementNS("http://www.w3.org/2000/svg",dr.element);Object.keys(dr.attributes).forEach(pn=>{jn.setAttributeNS(null,pn,dr.attributes[pn])}),nr.appendChild(jn)}),an.appendChild(nr)}),document.createElement("label").textContent=this.targets&&this.targets[it.id]?this.targets[it.id]:it.id,et.appendChild(an);break;default:return}var bn=document.createElement("TD");bn.className="legend-table-td";let Pn=document.createElement("label");return Pn.textContent=this.targets&&this.targets[it.id]?this.targets[it.id]:it.id,bn.appendChild(Pn),Cn.appendChild(et),Cn.appendChild(bn),Cn}updateLegendControl(){const it=this.map,Ge={};if(it){const Wt=it.queryRenderedFeatures();for(let on of Wt)Ge[on.layer.id]=on.layer}let Ke=null==it?void 0:it.getStyle().layers;if(Ke){for(this.legendTable||(this.legendTable=document.createElement("TABLE"),this.legendTable.className="legend-table",this.legendContainer.appendChild(this.legendTable));this.legendTable.firstChild;)this.legendTable.removeChild(this.legendTable.firstChild);this.options.reverseOrder&&(Ke=Ke.reverse()),Ke.forEach(Wt=>{if(Ge[Wt.id]&&this.uncheckedLayers[Wt.id]?delete this.uncheckedLayers[Wt.id]:this.uncheckedLayers[Wt.id]&&(Ge[Wt.id]=Wt),void 0===this.targets||this.targets&&0===Object.keys(this.targets).length||this.targets&&Object.keys(this.targets).map(on=>on).includes(Wt.id)){if(this.onlyRendered&&!Ge[Wt.id])return;const on=this.getLayerLegend(Wt);if(!on)return;this.legendTable.appendChild(on)}})}}onAdd(it){this.map=it,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.legendContainer=document.createElement("div"),this.legendContainer.classList.add("maplibregl-legend-list"),this.legendButton=document.createElement("button"),this.legendButton.classList.add("maplibregl-ctrl-icon"),this.legendButton.classList.add("maplibregl-legend-switcher"),this.legendButton.addEventListener("click",()=>{this.legendButton.style.display="none",this.legendContainer.style.display="block"}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.legendButton),this.controlContainer.appendChild(this.legendContainer),this.closeButton=document.createElement("button"),this.closeButton.textContent="x",this.closeButton.classList.add("maplibregl-legend-close-button"),this.closeButton.addEventListener("click",()=>{this.legendButton.style.display="block",this.legendContainer.style.display="none"}),this.legendContainer.appendChild(this.closeButton);const Ge=document.createElement("label");Ge.classList.add("maplibregl-legend-title-label"),Ge.textContent=this.options.title||"Legend",this.legendContainer.appendChild(Ge),this.legendContainer.appendChild(document.createElement("br"));const Ke=document.createElement("input");Ke.setAttribute("type","checkbox");const Wt="maplibregl-legend-onlyrendered-checkbox-"+100*Math.random();Ke.setAttribute("id",Wt),Ke.classList.add("maplibregl-legend-onlyRendered-checkbox"),Ke.checked=this.onlyRendered;const on=this;Ke.addEventListener("click",function(et){var _t;const Dt=null===(_t=et.target)||void 0===_t?void 0:_t.checked;on.onlyRendered=!!Dt,on.updateLegendControl()}),this.legendContainer.appendChild(Ke);const Cn=document.createElement("label");Cn.classList.add("maplibregl-legend-onlyRendered-label"),Cn.textContent="Only rendered",Cn.htmlFor=Wt,this.legendContainer.appendChild(Cn),this.legendContainer.appendChild(document.createElement("br")),this.map.on("moveend",et=>{this.updateLegendControl()});const fn=()=>Ut(this,void 0,void 0,function*(){if(it.loaded()){let _t=it.getStyle().sprite,Dt="";_t&&_t.includes("mapbox://")&&(_t=_t.replace(/mapbox:\/\//g,L.baseApiUrl).replace(/sprites/g,"/styles/v1"),_t=`${_t}/sprite`,Dt=`?access_token=${this.options.accesstoken||L.accessToken}`),yield Promise.all([this.loadImage(`${_t}@2x.png${Dt}`),this.loadJson(`${_t}.json${Dt}`)]).then(([Pn,an])=>{this.setSprite(Pn,an)}),this.updateLegendControl(),it.off("idle",fn)}});return this.map.on("idle",fn),this.options&&1==this.options.showDefault&&(this.legendContainer.style.display="block",this.legendButton.style.display="none"),this.controlContainer}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.legendButton||(this.legendButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.map=void 0)}redraw(){this.updateLegendControl()}onDocumentClick(it){this.controlContainer&&!this.controlContainer.contains(it.target)&&this.legendContainer&&this.legendButton&&this.options&&!0!==this.options.showDefault&&(this.legendContainer.style.display="none",this.legendButton.style.display="block")}setSprite(it,Ge){this.sprite={image:it,json:Ge}}loadImage(it){let Ge=!1;const Ke=new Promise((Wt,on)=>{const Cn=new Image;Cn.crossOrigin="Anonymous",Cn.onload=()=>{Ge||Wt(Cn)},Cn.onerror=fn=>{Ge||on(fn)},Cn.src=it});return Ke.cancel=()=>{Ge=!0},Ke}loadJson(it){return ut.default.get(it,{responseType:"json"}).then(Ge=>Ge.data)}}},686:(xr,Gr,Ht)=>{xr.exports=Ht(454)},54:(xr,Gr,Ht)=>{"use strict";var Ut=Ht(471),Jt=Ht(650),L=Ht(300),C=Ht(790),ut=Ht(634),tn=Ht(929),Et=Ht(984),it=Ht(886);xr.exports=function(Ke){return new Promise(function(on,Cn){var fn=Ke.data,et=Ke.headers,_t=Ke.responseType;Ut.isFormData(fn)&&delete et["Content-Type"];var Dt=new XMLHttpRequest;if(Ke.auth){var bn=Ke.auth.username||"",Pn=Ke.auth.password?unescape(encodeURIComponent(Ke.auth.password)):"";et.Authorization="Basic "+btoa(bn+":"+Pn)}var an=ut(Ke.baseURL,Ke.url);function Rn(){if(Dt){var dr="getAllResponseHeaders"in Dt?tn(Dt.getAllResponseHeaders()):null;Jt(on,Cn,{data:_t&&"text"!==_t&&"json"!==_t?Dt.response:Dt.responseText,status:Dt.status,statusText:Dt.statusText,headers:dr,config:Ke,request:Dt}),Dt=null}}if(Dt.open(Ke.method.toUpperCase(),C(an,Ke.params,Ke.paramsSerializer),!0),Dt.timeout=Ke.timeout,"onloadend"in Dt?Dt.onloadend=Rn:Dt.onreadystatechange=function(){!Dt||4!==Dt.readyState||0===Dt.status&&(!Dt.responseURL||0!==Dt.responseURL.indexOf("file:"))||setTimeout(Rn)},Dt.onabort=function(){!Dt||(Cn(it("Request aborted",Ke,"ECONNABORTED",Dt)),Dt=null)},Dt.onerror=function(){Cn(it("Network Error",Ke,null,Dt)),Dt=null},Dt.ontimeout=function(){var jn="timeout of "+Ke.timeout+"ms exceeded";Ke.timeoutErrorMessage&&(jn=Ke.timeoutErrorMessage),Cn(it(jn,Ke,Ke.transitional&&Ke.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",Dt)),Dt=null},Ut.isStandardBrowserEnv()){var nr=(Ke.withCredentials||Et(an))&&Ke.xsrfCookieName?L.read(Ke.xsrfCookieName):void 0;nr&&(et[Ke.xsrfHeaderName]=nr)}"setRequestHeader"in Dt&&Ut.forEach(et,function(jn,pn){void 0===fn&&"content-type"===pn.toLowerCase()?delete et[pn]:Dt.setRequestHeader(pn,jn)}),Ut.isUndefined(Ke.withCredentials)||(Dt.withCredentials=!!Ke.withCredentials),_t&&"json"!==_t&&(Dt.responseType=Ke.responseType),"function"==typeof Ke.onDownloadProgress&&Dt.addEventListener("progress",Ke.onDownloadProgress),"function"==typeof Ke.onUploadProgress&&Dt.upload&&Dt.upload.addEventListener("progress",Ke.onUploadProgress),Ke.cancelToken&&Ke.cancelToken.promise.then(function(jn){!Dt||(Dt.abort(),Cn(jn),Dt=null)}),fn||(fn=null),Dt.send(fn)})}},454:(xr,Gr,Ht)=>{"use strict";var Ut=Ht(471),Jt=Ht(533),L=Ht(227),C=Ht(18);function tn(it){var Ge=new L(it),Ke=Jt(L.prototype.request,Ge);return Ut.extend(Ke,L.prototype,Ge),Ut.extend(Ke,Ge),Ke}var Et=tn(Ht(567));Et.Axios=L,Et.create=function(Ge){return tn(C(Et.defaults,Ge))},Et.Cancel=Ht(305),Et.CancelToken=Ht(701),Et.isCancel=Ht(130),Et.all=function(Ge){return Promise.all(Ge)},Et.spread=Ht(908),Et.isAxiosError=Ht(541),xr.exports=Et,xr.exports.default=Et},305:xr=>{"use strict";function Gr(Ht){this.message=Ht}Gr.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},Gr.prototype.__CANCEL__=!0,xr.exports=Gr},701:(xr,Gr,Ht)=>{"use strict";var Ut=Ht(305);function Jt(L){if("function"!=typeof L)throw new TypeError("executor must be a function.");var C;this.promise=new Promise(function(Et){C=Et});var ut=this;L(function(Et){ut.reason||(ut.reason=new Ut(Et),C(ut.reason))})}Jt.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Jt.source=function(){var C;return{token:new Jt(function(Et){C=Et}),cancel:C}},xr.exports=Jt},130:xr=>{"use strict";xr.exports=function(Ht){return!(!Ht||!Ht.__CANCEL__)}},227:(xr,Gr,Ht)=>{"use strict";var Ut=Ht(471),Jt=Ht(790),L=Ht(976),C=Ht(764),ut=Ht(18),tn=Ht(558),Et=tn.validators;function it(Ge){this.defaults=Ge,this.interceptors={request:new L,response:new L}}it.prototype.request=function(Ke){"string"==typeof Ke?(Ke=arguments[1]||{}).url=arguments[0]:Ke=Ke||{},(Ke=ut(this.defaults,Ke)).method=Ke.method?Ke.method.toLowerCase():this.defaults.method?this.defaults.method.toLowerCase():"get";var Wt=Ke.transitional;void 0!==Wt&&tn.assertOptions(Wt,{silentJSONParsing:Et.transitional(Et.boolean,"1.0.0"),forcedJSONParsing:Et.transitional(Et.boolean,"1.0.0"),clarifyTimeoutError:Et.transitional(Et.boolean,"1.0.0")},!1);var on=[],Cn=!0;this.interceptors.request.forEach(function(Rn){"function"==typeof Rn.runWhen&&!1===Rn.runWhen(Ke)||(Cn=Cn&&Rn.synchronous,on.unshift(Rn.fulfilled,Rn.rejected))});var et,fn=[];if(this.interceptors.response.forEach(function(Rn){fn.push(Rn.fulfilled,Rn.rejected)}),!Cn){var _t=[C,void 0];for(Array.prototype.unshift.apply(_t,on),_t=_t.concat(fn),et=Promise.resolve(Ke);_t.length;)et=et.then(_t.shift(),_t.shift());return et}for(var Dt=Ke;on.length;){var bn=on.shift(),Pn=on.shift();try{Dt=bn(Dt)}catch(an){Pn(an);break}}try{et=C(Dt)}catch(an){return Promise.reject(an)}for(;fn.length;)et=et.then(fn.shift(),fn.shift());return et},it.prototype.getUri=function(Ke){return Ke=ut(this.defaults,Ke),Jt(Ke.url,Ke.params,Ke.paramsSerializer).replace(/^\?/,"")},Ut.forEach(["delete","get","head","options"],function(Ke){it.prototype[Ke]=function(Wt,on){return this.request(ut(on||{},{method:Ke,url:Wt,data:(on||{}).data}))}}),Ut.forEach(["post","put","patch"],function(Ke){it.prototype[Ke]=function(Wt,on,Cn){return this.request(ut(Cn||{},{method:Ke,url:Wt,data:on}))}}),xr.exports=it},976:(xr,Gr,Ht)=>{"use strict";var Ut=Ht(471);function Jt(){this.handlers=[]}Jt.prototype.use=function(C,ut,tn){return this.handlers.push({fulfilled:C,rejected:ut,synchronous:!!tn&&tn.synchronous,runWhen:tn?tn.runWhen:null}),this.handlers.length-1},Jt.prototype.eject=function(C){this.handlers[C]&&(this.handlers[C]=null)},Jt.prototype.forEach=function(C){Ut.forEach(this.handlers,function(tn){null!==tn&&C(tn)})},xr.exports=Jt},634:(xr,Gr,Ht)=>{"use strict";var Ut=Ht(164),Jt=Ht(540);xr.exports=function(C,ut){return C&&!Ut(ut)?Jt(C,ut):ut}},886:(xr,Gr,Ht)=>{"use strict";var Ut=Ht(570);xr.exports=function(L,C,ut,tn,Et){var it=new Error(L);return Ut(it,C,ut,tn,Et)}},764:(xr,Gr,Ht)=>{"use strict";var Ut=Ht(471),Jt=Ht(284),L=Ht(130),C=Ht(567);function ut(tn){tn.cancelToken&&tn.cancelToken.throwIfRequested()}xr.exports=function(Et){return ut(Et),Et.headers=Et.headers||{},Et.data=Jt.call(Et,Et.data,Et.headers,Et.transformRequest),Et.headers=Ut.merge(Et.headers.common||{},Et.headers[Et.method]||{},Et.headers),Ut.forEach(["delete","get","head","post","put","patch","common"],function(Ke){delete Et.headers[Ke]}),(Et.adapter||C.adapter)(Et).then(function(Ke){return ut(Et),Ke.data=Jt.call(Et,Ke.data,Ke.headers,Et.transformResponse),Ke},function(Ke){return L(Ke)||(ut(Et),Ke&&Ke.response&&(Ke.response.data=Jt.call(Et,Ke.response.data,Ke.response.headers,Et.transformResponse))),Promise.reject(Ke)})}},570:xr=>{"use strict";xr.exports=function(Ht,Ut,Jt,L,C){return Ht.config=Ut,Jt&&(Ht.code=Jt),Ht.request=L,Ht.response=C,Ht.isAxiosError=!0,Ht.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},Ht}},18:(xr,Gr,Ht)=>{"use strict";var Ut=Ht(471);xr.exports=function(L,C){C=C||{};var ut={},tn=["url","method","data"],Et=["headers","auth","proxy","params"],it=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],Ge=["validateStatus"];function Ke(fn,et){return Ut.isPlainObject(fn)&&Ut.isPlainObject(et)?Ut.merge(fn,et):Ut.isPlainObject(et)?Ut.merge({},et):Ut.isArray(et)?et.slice():et}function Wt(fn){Ut.isUndefined(C[fn])?Ut.isUndefined(L[fn])||(ut[fn]=Ke(void 0,L[fn])):ut[fn]=Ke(L[fn],C[fn])}Ut.forEach(tn,function(et){Ut.isUndefined(C[et])||(ut[et]=Ke(void 0,C[et]))}),Ut.forEach(Et,Wt),Ut.forEach(it,function(et){Ut.isUndefined(C[et])?Ut.isUndefined(L[et])||(ut[et]=Ke(void 0,L[et])):ut[et]=Ke(void 0,C[et])}),Ut.forEach(Ge,function(et){et in C?ut[et]=Ke(L[et],C[et]):et in L&&(ut[et]=Ke(void 0,L[et]))});var on=tn.concat(Et).concat(it).concat(Ge),Cn=Object.keys(L).concat(Object.keys(C)).filter(function(et){return-1===on.indexOf(et)});return Ut.forEach(Cn,Wt),ut}},650:(xr,Gr,Ht)=>{"use strict";var Ut=Ht(886);xr.exports=function(L,C,ut){var tn=ut.config.validateStatus;ut.status&&tn&&!tn(ut.status)?C(Ut("Request failed with status code "+ut.status,ut.config,null,ut.request,ut)):L(ut)}},284:(xr,Gr,Ht)=>{"use strict";var Ut=Ht(471),Jt=Ht(567);xr.exports=function(C,ut,tn){var Et=this||Jt;return Ut.forEach(tn,function(Ge){C=Ge.call(Et,C,ut)}),C}},567:(xr,Gr,Ht)=>{"use strict";var Ut=Ht(471),Jt=Ht(196),L=Ht(570),C={"Content-Type":"application/x-www-form-urlencoded"};function ut(Ge,Ke){!Ut.isUndefined(Ge)&&Ut.isUndefined(Ge["Content-Type"])&&(Ge["Content-Type"]=Ke)}var Ge,it={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(Ge=Ht(54)),Ge),transformRequest:[function(Ke,Wt){return Jt(Wt,"Accept"),Jt(Wt,"Content-Type"),Ut.isFormData(Ke)||Ut.isArrayBuffer(Ke)||Ut.isBuffer(Ke)||Ut.isStream(Ke)||Ut.isFile(Ke)||Ut.isBlob(Ke)?Ke:Ut.isArrayBufferView(Ke)?Ke.buffer:Ut.isURLSearchParams(Ke)?(ut(Wt,"application/x-www-form-urlencoded;charset=utf-8"),Ke.toString()):Ut.isObject(Ke)||Wt&&"application/json"===Wt["Content-Type"]?(ut(Wt,"application/json"),function(Ge,Ke,Wt){if(Ut.isString(Ge))try{return(0,JSON.parse)(Ge),Ut.trim(Ge)}catch(on){if("SyntaxError"!==on.name)throw on}return(0,JSON.stringify)(Ge)}(Ke)):Ke}],transformResponse:[function(Ke){var Wt=this.transitional,fn=!(Wt&&Wt.silentJSONParsing)&&"json"===this.responseType;if(fn||Wt&&Wt.forcedJSONParsing&&Ut.isString(Ke)&&Ke.length)try{return JSON.parse(Ke)}catch(et){if(fn)throw"SyntaxError"===et.name?L(et,this,"E_JSON_PARSE"):et}return Ke}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(Ke){return Ke>=200&&Ke<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Ut.forEach(["delete","get","head"],function(Ke){it.headers[Ke]={}}),Ut.forEach(["post","put","patch"],function(Ke){it.headers[Ke]=Ut.merge(C)}),xr.exports=it},533:xr=>{"use strict";xr.exports=function(Ht,Ut){return function(){for(var L=new Array(arguments.length),C=0;C<L.length;C++)L[C]=arguments[C];return Ht.apply(Ut,L)}}},790:(xr,Gr,Ht)=>{"use strict";var Ut=Ht(471);function Jt(L){return encodeURIComponent(L).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}xr.exports=function(C,ut,tn){if(!ut)return C;var Et;if(tn)Et=tn(ut);else if(Ut.isURLSearchParams(ut))Et=ut.toString();else{var it=[];Ut.forEach(ut,function(Wt,on){null==Wt||(Ut.isArray(Wt)?on+="[]":Wt=[Wt],Ut.forEach(Wt,function(fn){Ut.isDate(fn)?fn=fn.toISOString():Ut.isObject(fn)&&(fn=JSON.stringify(fn)),it.push(Jt(on)+"="+Jt(fn))}))}),Et=it.join("&")}if(Et){var Ge=C.indexOf("#");-1!==Ge&&(C=C.slice(0,Ge)),C+=(-1===C.indexOf("?")?"?":"&")+Et}return C}},540:xr=>{"use strict";xr.exports=function(Ht,Ut){return Ut?Ht.replace(/\/+$/,"")+"/"+Ut.replace(/^\/+/,""):Ht}},300:(xr,Gr,Ht)=>{"use strict";var Ut=Ht(471);xr.exports=Ut.isStandardBrowserEnv()?{write:function(C,ut,tn,Et,it,Ge){var Ke=[];Ke.push(C+"="+encodeURIComponent(ut)),Ut.isNumber(tn)&&Ke.push("expires="+new Date(tn).toGMTString()),Ut.isString(Et)&&Ke.push("path="+Et),Ut.isString(it)&&Ke.push("domain="+it),!0===Ge&&Ke.push("secure"),document.cookie=Ke.join("; ")},read:function(C){var ut=document.cookie.match(new RegExp("(^|;\\s*)("+C+")=([^;]*)"));return ut?decodeURIComponent(ut[3]):null},remove:function(C){this.write(C,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},164:xr=>{"use strict";xr.exports=function(Ht){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(Ht)}},541:xr=>{"use strict";xr.exports=function(Ht){return"object"==typeof Ht&&!0===Ht.isAxiosError}},984:(xr,Gr,Ht)=>{"use strict";var Ut=Ht(471);xr.exports=Ut.isStandardBrowserEnv()?function(){var ut,L=/(msie|trident)/i.test(navigator.userAgent),C=document.createElement("a");function tn(Et){var it=Et;return L&&(C.setAttribute("href",it),it=C.href),C.setAttribute("href",it),{href:C.href,protocol:C.protocol?C.protocol.replace(/:$/,""):"",host:C.host,search:C.search?C.search.replace(/^\?/,""):"",hash:C.hash?C.hash.replace(/^#/,""):"",hostname:C.hostname,port:C.port,pathname:"/"===C.pathname.charAt(0)?C.pathname:"/"+C.pathname}}return ut=tn(window.location.href),function(it){var Ge=Ut.isString(it)?tn(it):it;return Ge.protocol===ut.protocol&&Ge.host===ut.host}}():function(){return!0}},196:(xr,Gr,Ht)=>{"use strict";var Ut=Ht(471);xr.exports=function(L,C){Ut.forEach(L,function(tn,Et){Et!==C&&Et.toUpperCase()===C.toUpperCase()&&(L[C]=tn,delete L[Et])})}},929:(xr,Gr,Ht)=>{"use strict";var Ut=Ht(471),Jt=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];xr.exports=function(C){var tn,Et,it,ut={};return C&&Ut.forEach(C.split("\n"),function(Ke){if(it=Ke.indexOf(":"),tn=Ut.trim(Ke.substr(0,it)).toLowerCase(),Et=Ut.trim(Ke.substr(it+1)),tn){if(ut[tn]&&Jt.indexOf(tn)>=0)return;ut[tn]="set-cookie"===tn?(ut[tn]?ut[tn]:[]).concat([Et]):ut[tn]?ut[tn]+", "+Et:Et}}),ut}},908:xr=>{"use strict";xr.exports=function(Ht){return function(Jt){return Ht.apply(null,Jt)}}},558:(xr,Gr,Ht)=>{"use strict";var Ut=Ht(593),Jt={};["object","boolean","number","function","string","symbol"].forEach(function(Et,it){Jt[Et]=function(Ke){return typeof Ke===Et||"a"+(it<1?"n ":" ")+Et}});var L={},C=Ut.version.split(".");function ut(Et,it){for(var Ge=it?it.split("."):C,Ke=Et.split("."),Wt=0;Wt<3;Wt++){if(Ge[Wt]>Ke[Wt])return!0;if(Ge[Wt]<Ke[Wt])return!1}return!1}Jt.transitional=function(it,Ge,Ke){var Wt=Ge&&ut(Ge);function on(Cn,fn){return"[Axios v"+Ut.version+"] Transitional option '"+Cn+"'"+fn+(Ke?". "+Ke:"")}return function(Cn,fn,et){if(!1===it)throw new Error(on(fn," has been removed in "+Ge));return Wt&&!L[fn]&&(L[fn]=!0,console.warn(on(fn," has been deprecated since v"+Ge+" and will be removed in the near future"))),!it||it(Cn,fn,et)}},xr.exports={isOlderVersion:ut,assertOptions:function(Et,it,Ge){if("object"!=typeof Et)throw new TypeError("options must be an object");for(var Ke=Object.keys(Et),Wt=Ke.length;Wt-- >0;){var on=Ke[Wt],Cn=it[on];if(Cn){var fn=Et[on],et=void 0===fn||Cn(fn,on,Et);if(!0!==et)throw new TypeError("option "+on+" must be "+et)}else if(!0!==Ge)throw Error("Unknown option "+on)}},validators:Jt}},471:(xr,Gr,Ht)=>{"use strict";var Ut=Ht(533),Jt=Object.prototype.toString;function L(pn){return"[object Array]"===Jt.call(pn)}function C(pn){return void 0===pn}function Wt(pn){return null!==pn&&"object"==typeof pn}function on(pn){if("[object Object]"!==Jt.call(pn))return!1;var sr=Object.getPrototypeOf(pn);return null===sr||sr===Object.prototype}function _t(pn){return"[object Function]"===Jt.call(pn)}function Rn(pn,sr){if(null!=pn)if("object"!=typeof pn&&(pn=[pn]),L(pn))for(var qr=0,Es=pn.length;qr<Es;qr++)sr.call(null,pn[qr],qr,pn);else for(var je in pn)Object.prototype.hasOwnProperty.call(pn,je)&&sr.call(null,pn[je],je,pn)}xr.exports={isArray:L,isArrayBuffer:function(pn){return"[object ArrayBuffer]"===Jt.call(pn)},isBuffer:function(pn){return null!==pn&&!C(pn)&&null!==pn.constructor&&!C(pn.constructor)&&"function"==typeof pn.constructor.isBuffer&&pn.constructor.isBuffer(pn)},isFormData:function(pn){return"undefined"!=typeof FormData&&pn instanceof FormData},isArrayBufferView:function(pn){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(pn):pn&&pn.buffer&&pn.buffer instanceof ArrayBuffer},isString:function(pn){return"string"==typeof pn},isNumber:function(pn){return"number"==typeof pn},isObject:Wt,isPlainObject:on,isUndefined:C,isDate:function(pn){return"[object Date]"===Jt.call(pn)},isFile:function(pn){return"[object File]"===Jt.call(pn)},isBlob:function(pn){return"[object Blob]"===Jt.call(pn)},isFunction:_t,isStream:function(pn){return Wt(pn)&&_t(pn.pipe)},isURLSearchParams:function(pn){return"undefined"!=typeof URLSearchParams&&pn instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:Rn,merge:function nr(){var pn={};function sr(je,ct){pn[ct]=on(pn[ct])&&on(je)?nr(pn[ct],je):on(je)?nr({},je):L(je)?je.slice():je}for(var qr=0,Es=arguments.length;qr<Es;qr++)Rn(arguments[qr],sr);return pn},extend:function(pn,sr,qr){return Rn(sr,function(je,ct){pn[ct]=qr&&"function"==typeof je?Ut(je,qr):je}),pn},trim:function(pn){return pn.trim?pn.trim():pn.replace(/^\s+|\s+$/g,"")},stripBOM:function(pn){return 65279===pn.charCodeAt(0)&&(pn=pn.slice(1)),pn}}},658:(xr,Gr)=>{Gr.read=function(Ht,Ut,Jt,L,C){var ut,tn,Et=8*C-L-1,it=(1<<Et)-1,Ge=it>>1,Ke=-7,Wt=Jt?C-1:0,on=Jt?-1:1,Cn=Ht[Ut+Wt];for(Wt+=on,ut=Cn&(1<<-Ke)-1,Cn>>=-Ke,Ke+=Et;Ke>0;ut=256*ut+Ht[Ut+Wt],Wt+=on,Ke-=8);for(tn=ut&(1<<-Ke)-1,ut>>=-Ke,Ke+=L;Ke>0;tn=256*tn+Ht[Ut+Wt],Wt+=on,Ke-=8);if(0===ut)ut=1-Ge;else{if(ut===it)return tn?NaN:1/0*(Cn?-1:1);tn+=Math.pow(2,L),ut-=Ge}return(Cn?-1:1)*tn*Math.pow(2,ut-L)},Gr.write=function(Ht,Ut,Jt,L,C,ut){var tn,Et,it,Ge=8*ut-C-1,Ke=(1<<Ge)-1,Wt=Ke>>1,on=23===C?Math.pow(2,-24)-Math.pow(2,-77):0,Cn=L?0:ut-1,fn=L?1:-1,et=Ut<0||0===Ut&&1/Ut<0?1:0;for(Ut=Math.abs(Ut),isNaN(Ut)||Ut===1/0?(Et=isNaN(Ut)?1:0,tn=Ke):(tn=Math.floor(Math.log(Ut)/Math.LN2),Ut*(it=Math.pow(2,-tn))<1&&(tn--,it*=2),(Ut+=tn+Wt>=1?on/it:on*Math.pow(2,1-Wt))*it>=2&&(tn++,it/=2),tn+Wt>=Ke?(Et=0,tn=Ke):tn+Wt>=1?(Et=(Ut*it-1)*Math.pow(2,C),tn+=Wt):(Et=Ut*Math.pow(2,Wt-1)*Math.pow(2,C),tn=0));C>=8;Ht[Jt+Cn]=255&Et,Cn+=fn,Et/=256,C-=8);for(tn=tn<<C|Et,Ge+=C;Ge>0;Ht[Jt+Cn]=255&tn,Cn+=fn,tn/=256,Ge-=8);Ht[Jt+Cn-fn]|=128*et}},958:function(xr){xr.exports=function(){"use strict";var Gr,Ht,Ut;function Jt(C,ut){if(Gr)if(Ht){var tn="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Gr+")(sharedChunk); ("+Ht+")(sharedChunk); self.onerror = null;",Et={};Gr(Et),Ut=ut(Et),"undefined"!=typeof window&&(Ut.workerUrl=window.URL.createObjectURL(new Blob([tn],{type:"text/javascript"})))}else Ht=ut;else Gr=ut}return Jt(0,function(C){var tn=Et;function Et(c,a,p,y){this.cx=3*c,this.bx=3*(p-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(y-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=y,this.p2x=p,this.p2y=y}Et.prototype.sampleCurveX=function(c){return((this.ax*c+this.bx)*c+this.cx)*c},Et.prototype.sampleCurveY=function(c){return((this.ay*c+this.by)*c+this.cy)*c},Et.prototype.sampleCurveDerivativeX=function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},Et.prototype.solveCurveX=function(c,a){var p,y,E,A,R;for(void 0===a&&(a=1e-6),E=c,R=0;R<8;R++){if(A=this.sampleCurveX(E)-c,Math.abs(A)<a)return E;var U=this.sampleCurveDerivativeX(E);if(Math.abs(U)<1e-6)break;E-=A/U}if((E=c)<(p=0))return p;if(E>(y=1))return y;for(;p<y;){if(A=this.sampleCurveX(E),Math.abs(A-c)<a)return E;c>A?p=E:y=E,E=.5*(y-p)+p}return E},Et.prototype.solve=function(c,a){return this.sampleCurveY(this.solveCurveX(c,a))};var it=Ge;function Ge(c,a){this.x=c,this.y=a}Ge.prototype={clone:function(){return new Ge(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,a){return this.clone()._rotateAround(c,a)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var a=c.x-this.x,p=c.y-this.y;return a*a+p*p},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,a){return Math.atan2(this.x*a-this.y*c,this.x*c+this.y*a)},_matMult:function(c){var a=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=a,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var a=Math.cos(c),p=Math.sin(c),y=p*this.x+a*this.y;return this.x=a*this.x-p*this.y,this.y=y,this},_rotateAround:function(c,a){var p=Math.cos(c),y=Math.sin(c),E=a.y+y*(this.x-a.x)+p*(this.y-a.y);return this.x=a.x+p*(this.x-a.x)-y*(this.y-a.y),this.y=E,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ge.convert=function(c){return c instanceof Ge?c:Array.isArray(c)?new Ge(c[0],c[1]):c};var Ke="undefined"!=typeof self?self:{};const Wt=Math.pow(2,53)-1,on=Math.PI/180,Cn=180/Math.PI;function fn(c){return c*on}function et(c){return c*Cn}const _t=[[0,0],[1,0],[1,1],[0,1]];function Dt(c){if(c<=0)return 0;if(c>=1)return 1;const a=c*c,p=a*c;return 4*(c<.5?p:3*(c-a)+p-.75)}function bn(c,a,p,y){const E=new tn(c,a,p,y);return function(A){return E.solve(A)}}const Pn=bn(.25,.1,.25,1);function an(c,a,p){return Math.min(p,Math.max(a,c))}function Rn(c,a,p){const y=p-a,E=((c-a)%y+y)%y+a;return E===a?p:E}function nr(c,a,p){if(!c.length)return p(null,[]);let y=c.length;const E=new Array(c.length);let A=null;c.forEach((R,U)=>{a(R,(Z,$)=>{Z&&(A=Z),E[U]=$,0==--y&&p(A,E)})})}function dr(c){const a=[];for(const p in c)a.push(c[p]);return a}function jn(c,...a){for(const p of a)for(const y in p)c[y]=p[y];return c}let pn=1;function sr(){return pn++}function qr(){return function c(a){return a?(a^16*Math.random()>>a/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()}function Es(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function je(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)}function ct(c,a){c.forEach(p=>{a[p]&&(a[p]=a[p].bind(a))})}function Vt(c,a){return-1!==c.indexOf(a,c.length-a.length)}function Pr(c,a,p){const y={};for(const E in c)y[E]=a.call(p||this,c[E],E,c);return y}function fr(c,a,p){const y={};for(const E in c)a.call(p||this,c[E],E,c)&&(y[E]=c[E]);return y}function vr(c){return Array.isArray(c)?c.map(vr):"object"==typeof c&&c?Pr(c,vr):c}const Er={};function Ui(c){Er[c]||("undefined"!=typeof console&&console.warn(c),Er[c]=!0)}function Wo(c,a,p){return(p.y-c.y)*(a.x-c.x)>(a.y-c.y)*(p.x-c.x)}function Xi(c){let a=0;for(let p,y,E=0,A=c.length,R=A-1;E<A;R=E++)p=c[E],y=c[R],a+=(y.x-p.x)*(p.y+y.y);return a}function Vi(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Zr(c){const a={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(p,y,E,A)=>{const R=E||A;return a[y]=!R||R.toLowerCase(),""}),a["max-age"]){const p=parseInt(a["max-age"],10);isNaN(p)?delete a["max-age"]:a["max-age"]=p}return a}let gl,Ir,yl,Sc=null;function Yl(c){if(null==Sc){const a=c.navigator?c.navigator.userAgent:null;Sc=!!c.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Sc}function di(c){try{const a=Ke[c];return a.setItem("_mapbox_test_",1),a.removeItem("_mapbox_test_"),!0}catch(a){return!1}}const zs={now:()=>void 0!==yl?yl:Ke.performance.now(),setNow(c){yl=c},restoreNow(){yl=void 0},frame(c){const a=Ke.requestAnimationFrame(c);return{cancel:()=>Ke.cancelAnimationFrame(a)}},getImageData(c,a=0){const p=Ke.document.createElement("canvas"),y=p.getContext("2d");if(!y)throw new Error("failed to create canvas 2d context");return p.width=c.width,p.height=c.height,y.drawImage(c,0,0,c.width,c.height),y.getImageData(-a,-a,c.width+2*a,c.height+2*a)},resolveURL:c=>(gl||(gl=Ke.document.createElement("a")),gl.href=c,gl.href),get devicePixelRatio(){return Ke.devicePixelRatio},get prefersReducedMotion(){return!!Ke.matchMedia&&(null==Ir&&(Ir=Ke.matchMedia("(prefers-reduced-motion: reduce)")),Ir.matches)}};let ss;const Ar={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ss){const c=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ss=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):c}catch(a){ss=c}}return ss},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Tc={supported:!1,testSupport:function(c){!Rl&&vl&&(Ol?gu(c):ol=c)}};let ol,vl,Rl=!1,Ol=!1;function gu(c){const a=c.createTexture();c.bindTexture(c.TEXTURE_2D,a);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,vl),c.isContextLost())return;Tc.supported=!0}catch(p){}c.deleteTexture(a),Rl=!0}Ke.document&&(vl=Ke.document.createElement("img"),vl.onload=function(){ol&&gu(ol),ol=null,Ol=!0},vl.onerror=function(){Rl=!0,ol=null},vl.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const _l="01",Na="NO_ACCESS_TOKEN";function la(c){return 0===c.indexOf("mapbox:")}function al(c){return Ar.API_URL_REGEX.test(c)}const Uh=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ys(c){const a=c.match(Uh);if(!a)throw new Error("Unable to parse URL object");return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}function Ns(c){const a=c.params.length?`?${c.params.join("&")}`:"";return`${c.protocol}://${c.authority}${c.path}${a}`}function Kc(c){if(!c)return null;const a=c.split(".");if(!a||3!==a.length)return null;try{return JSON.parse(decodeURIComponent(Ke.atob(a[1]).split("").map(p=>"%"+("00"+p.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(p){return null}}class Ic{constructor(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(a){const p=Kc(Ar.ACCESS_TOKEN);let y="";return y=p&&p.u?Ke.btoa(encodeURIComponent(p.u).replace(/%([0-9A-F]{2})/g,(E,A)=>String.fromCharCode(Number("0x"+A)))):Ar.ACCESS_TOKEN||"",a?`mapbox.eventData.${a}:${y}`:`mapbox.eventData:${y}`}fetchEventData(){const a=di("localStorage"),p=this.getStorageKey(),y=this.getStorageKey("uuid");if(a)try{const E=Ke.localStorage.getItem(p);E&&(this.eventData=JSON.parse(E));const A=Ke.localStorage.getItem(y);A&&(this.anonId=A)}catch(E){Ui("Unable to read from LocalStorage")}}saveEventData(){const a=di("localStorage"),p=this.getStorageKey(),y=this.getStorageKey("uuid");if(a)try{Ke.localStorage.setItem(y,this.anonId),Object.keys(this.eventData).length>=1&&Ke.localStorage.setItem(p,JSON.stringify(this.eventData))}catch(E){Ui("Unable to write to LocalStorage")}}processRequests(a){}postEvent(a,p,y,E){if(!Ar.EVENTS_URL)return;const A=Ys(Ar.EVENTS_URL);A.params.push(`access_token=${E||Ar.ACCESS_TOKEN||""}`);const R={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.6.1",skuId:_l,userId:this.anonId},U=p?jn(R,p):R,Z={url:Ns(A),headers:{"Content-Type":"text/plain"},body:JSON.stringify([U])};this.pendingRequest=me(Z,$=>{this.pendingRequest=null,y($),this.saveEventData(),this.processRequests(E)})}queueRequest(a,p){this.queue.push(a),this.processRequests(p)}}const Vh=new class extends Ic{constructor(c){super("appUserTurnstile"),this._customAccessToken=c}postTurnstileEvent(c,a){Ar.EVENTS_URL&&Ar.ACCESS_TOKEN&&Array.isArray(c)&&c.some(p=>la(p)||al(p))&&this.queueRequest(Date.now(),a)}processRequests(c){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const a=Kc(Ar.ACCESS_TOKEN),p=a?a.u:Ar.ACCESS_TOKEN;let y=p!==this.eventData.tokenU;je(this.anonId)||(this.anonId=qr(),y=!0);const E=this.queue.shift();if(this.eventData.lastSuccess){const A=new Date(this.eventData.lastSuccess),R=new Date(E),U=(E-this.eventData.lastSuccess)/864e5;y=y||U>=1||U<-1||A.getDate()!==R.getDate()}else y=!0;if(!y)return this.processRequests();this.postEvent(E,{"enabled.telemetry":!1},A=>{A||(this.eventData.lastSuccess=E,this.eventData.tokenU=p)},c)}},Jc=Vh.postTurnstileEvent.bind(Vh),Qu=new class extends Ic{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(c,a,p,y){this.skuToken=a,this.errorCb=y,Ar.EVENTS_URL&&(p||Ar.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},p):this.errorCb(new Error(Na)))}processRequests(c){if(this.pendingRequest||0===this.queue.length)return;const{id:a,timestamp:p}=this.queue.shift();a&&this.success[a]||(this.anonId||this.fetchEventData(),je(this.anonId)||(this.anonId=qr()),this.postEvent(p,{skuToken:this.skuToken},y=>{y?this.errorCb(y):a&&(this.success[a]=!0)},c))}},Mc=Qu.postMapLoadEvent.bind(Qu),Ss=new class extends Ic{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(c,a,p,y){if(!Ar.API_URL||!Ar.SESSION_PATH)return;const E=Ys(Ar.API_URL+Ar.SESSION_PATH);E.params.push(`sku=${a||""}`),E.params.push(`access_token=${y||Ar.ACCESS_TOKEN||""}`);const A={url:Ns(E),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ve(A,R=>{this.pendingRequest=null,p(R),this.saveEventData(),this.processRequests(y)})}getSessionAPI(c,a,p,y){this.skuToken=a,this.errorCb=y,Ar.SESSION_PATH&&Ar.API_URL&&(p||Ar.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},p):this.errorCb(new Error(Na)))}processRequests(c){if(this.pendingRequest||0===this.queue.length)return;const{id:a,timestamp:p}=this.queue.shift();a&&this.success[a]||this.getSession(p,this.skuToken,y=>{y?this.errorCb(y):a&&(this.success[a]=!0)},c)}},Qc=Ss.getSessionAPI.bind(Ss),Nu=new Set,_h="mapbox-tiles";let Bs,Kl,Jl=500,Ll=50;function Da(){Ke.caches&&!Bs&&(Bs=Ke.caches.open(_h))}function Bo(c){const a=c.indexOf("?");return a<0?c:c.slice(0,a)}let be=1/0;const De={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(De);class Oe extends Error{constructor(a,p,y){401===p&&al(y)&&(a+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(a),this.status=p,this.url=y}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const se=Vi()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Ke.location.protocol?Ke.parent:Ke).location.href,te=function(c,a){if(!(/^file:/.test(p=c.url)||/^file:/.test(se())&&!/^\w+:/.test(p))){if(Ke.fetch&&Ke.Request&&Ke.AbortController&&Ke.Request.prototype.hasOwnProperty("signal"))return function(y,E){const A=new Ke.AbortController,R=new Ke.Request(y.url,{method:y.method||"GET",body:y.body,credentials:y.credentials,headers:y.headers,referrer:se(),signal:A.signal});let U=!1,Z=!1;const $=(re=R.url).indexOf("sku=")>0&&al(re);var re;"json"===y.type&&R.headers.set("Accept","application/json");const ae=(Ce,ke,Ve)=>{if(Z)return;if(Ce&&"SecurityError"!==Ce.message&&Ui(Ce),ke&&Ve)return ue(ke);const We=Date.now();Ke.fetch(R).then(rt=>{if(rt.ok){const ht=$?rt.clone():null;return ue(rt,ht,We)}return E(new Oe(rt.statusText,rt.status,y.url))}).catch(rt=>{20!==rt.code&&E(new Error(rt.message))})},ue=(Ce,ke,Ve)=>{("arrayBuffer"===y.type?Ce.arrayBuffer():"json"===y.type?Ce.json():Ce.text()).then(We=>{Z||(ke&&Ve&&function(rt,ht,vt){if(Da(),!Bs)return;const Tt={status:ht.status,statusText:ht.statusText,headers:new Ke.Headers};ht.headers.forEach((kt,ln)=>Tt.headers.set(ln,kt));const Ct=Zr(ht.headers.get("Cache-Control")||"");Ct["no-store"]||(Ct["max-age"]&&Tt.headers.set("Expires",new Date(vt+1e3*Ct["max-age"]).toUTCString()),new Date(Tt.headers.get("Expires")).getTime()-vt<42e4||function(kt,ln){if(void 0===Kl)try{new Response(new ReadableStream),Kl=!0}catch(Yt){Kl=!1}Kl?ln(kt.body):kt.blob().then(ln)}(ht,kt=>{const ln=new Ke.Response(kt,Tt);Da(),Bs&&Bs.then(Yt=>Yt.put(Bo(rt.url),ln)).catch(Yt=>Ui(Yt.message))}))}(R,ke,Ve),U=!0,E(null,We,Ce.headers.get("Cache-Control"),Ce.headers.get("Expires")))}).catch(We=>{Z||E(new Error(We.message))})};return $?function(Ce,ke){if(Da(),!Bs)return ke(null);const Ve=Bo(Ce.url);Bs.then(We=>{We.match(Ve).then(rt=>{const ht=function(vt){if(!vt)return!1;const Tt=new Date(vt.headers.get("Expires")||0),Ct=Zr(vt.headers.get("Cache-Control")||"");return Tt>Date.now()&&!Ct["no-cache"]}(rt);We.delete(Ve),ht&&We.put(Ve,rt.clone()),ke(null,rt,ht)}).catch(ke)}).catch(ke)}(R,ae):ae(null,null),{cancel:()=>{Z=!0,U||A.abort()}}}(c,a);if(Vi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,a,void 0,!0)}var p;return function(y,E){const A=new Ke.XMLHttpRequest;A.open(y.method||"GET",y.url,!0),"arrayBuffer"===y.type&&(A.responseType="arraybuffer");for(const R in y.headers)A.setRequestHeader(R,y.headers[R]);return"json"===y.type&&(A.responseType="text",A.setRequestHeader("Accept","application/json")),A.withCredentials="include"===y.credentials,A.onerror=()=>{E(new Error(A.statusText))},A.onload=()=>{if((A.status>=200&&A.status<300||0===A.status)&&null!==A.response){let R=A.response;if("json"===y.type)try{R=JSON.parse(A.response)}catch(U){return E(U)}E(null,R,A.getResponseHeader("Cache-Control"),A.getResponseHeader("Expires"))}else E(new Oe(A.statusText,A.status,y.url))},A.send(y.body),{cancel:()=>A.abort()}}(c,a)},oe=function(c,a){return te(jn(c,{type:"arrayBuffer"}),a)},me=function(c,a){return te(jn(c,{method:"POST"}),a)},ve=function(c,a){return te(jn(c,{method:"GET"}),a)};function pe(c){const a=Ke.document.createElement("a");return a.href=c,a.protocol===Ke.document.location.protocol&&a.host===Ke.document.location.host}const Se="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let He,Ze;He=[],Ze=0;const Be=function(c,a){if(Tc.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),Ze>=Ar.MAX_PARALLEL_IMAGE_REQUESTS){const A={requestParameters:c,callback:a,cancelled:!1,cancel(){this.cancelled=!0}};return He.push(A),A}Ze++;let p=!1;const y=()=>{if(!p)for(p=!0,Ze--;He.length&&Ze<Ar.MAX_PARALLEL_IMAGE_REQUESTS;){const A=He.shift(),{requestParameters:R,callback:U,cancelled:Z}=A;Z||(A.cancel=Be(R,U).cancel)}},E=oe(c,(A,R,U,Z)=>{y(),A?a(A):R&&(Ke.createImageBitmap?function($,re){const ae=new Ke.Blob([new Uint8Array($)],{type:"image/png"});Ke.createImageBitmap(ae).then(ue=>{re(null,ue)}).catch(ue=>{re(new Error(`Could not load image because of ${ue.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(R,($,re)=>a($,re,U,Z)):function($,re){const ae=new Ke.Image,ue=Ke.URL;ae.onload=()=>{re(null,ae),ue.revokeObjectURL(ae.src),ae.onload=null,Ke.requestAnimationFrame(()=>{ae.src=Se})},ae.onerror=()=>re(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Ce=new Ke.Blob([new Uint8Array($)],{type:"image/png"});ae.src=$.byteLength?ue.createObjectURL(Ce):Se}(R,($,re)=>a($,re,U,Z)))});return{cancel:()=>{E.cancel(),y()}}};function lt(c,a,p){p[c]&&-1!==p[c].indexOf(a)||(p[c]=p[c]||[],p[c].push(a))}function Rt(c,a,p){if(p&&p[c]){const y=p[c].indexOf(a);-1!==y&&p[c].splice(y,1)}}class xt{constructor(a,p={}){jn(this,p),this.type=a}}class Xt extends xt{constructor(a,p={}){super("error",jn({error:a},p))}}class mt{on(a,p){return this._listeners=this._listeners||{},lt(a,p,this._listeners),this}off(a,p){return Rt(a,p,this._listeners),Rt(a,p,this._oneTimeListeners),this}once(a,p){return p?(this._oneTimeListeners=this._oneTimeListeners||{},lt(a,p,this._oneTimeListeners),this):new Promise(y=>this.once(a,y))}fire(a,p){"string"==typeof a&&(a=new xt(a,p||{}));const y=a.type;if(this.listens(y)){a.target=this;const E=this._listeners&&this._listeners[y]?this._listeners[y].slice():[];for(const U of E)U.call(this,a);const A=this._oneTimeListeners&&this._oneTimeListeners[y]?this._oneTimeListeners[y].slice():[];for(const U of A)Rt(y,U,this._oneTimeListeners),U.call(this,a);const R=this._eventedParent;R&&(jn(a,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),R.fire(a))}else a instanceof Xt&&console.error(a.error);return this}listens(a){return!!(this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a))}setEventedParent(a,p){return this._eventedParent=a,this._eventedParentData=p,this}}var Je=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class ot{constructor(a,p,y,E){this.message=(a?`${a}: `:"")+y,E&&(this.identifier=E),null!=p&&p.__line__&&(this.line=p.__line__)}}function On(c){const a=c.value;return a?[new ot(c.key,a,"constants have been deprecated as of v8")]:[]}function Bn(c,...a){for(const p of a)for(const y in p)c[y]=p[y];return c}function sn(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function br(c){if(Array.isArray(c))return c.map(br);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const a={};for(const p in c)a[p]=br(c[p]);return a}return sn(c)}class Ft extends Error{constructor(a,p){super(p),this.message=p,this.key=a}}class mr{constructor(a,p=[]){this.parent=a,this.bindings={};for(const[y,E]of p)this.bindings[y]=E}concat(a){return new mr(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const or={kind:"null"},qt={kind:"number"},ur={kind:"string"},wn={kind:"boolean"},ri={kind:"color"},Yr={kind:"object"},lr={kind:"value"},ni={kind:"collator"},Kr={kind:"formatted"},yo={kind:"resolvedImage"};function Ro(c,a){return{kind:"array",itemType:c,N:a}}function gi(c){if("array"===c.kind){const a=gi(c.itemType);return"number"==typeof c.N?`array<${a}, ${c.N}>`:"value"===c.itemType.kind?"array":`array<${a}>`}return c.kind}const fi=[or,qt,ur,wn,ri,Kr,Yr,Ro(lr),yo];function js(c,a){if("error"===a.kind)return null;if("array"===c.kind){if("array"===a.kind&&(0===a.N&&"value"===a.itemType.kind||!js(c.itemType,a.itemType))&&("number"!=typeof c.N||c.N===a.N))return null}else{if(c.kind===a.kind)return null;if("value"===c.kind)for(const p of fi)if(!js(p,a))return null}return`Expected ${gi(c)} but found ${gi(a)} instead.`}function Ya(c,a){return a.some(p=>p.kind===c.kind)}function Fr(c,a){return a.some(p=>"null"===p?null===c:"array"===p?Array.isArray(c):"object"===p?c&&!Array.isArray(c)&&"object"==typeof c:p===typeof c)}function xl(c){var a={exports:{}};return c(a,a.exports),a.exports}var Oi=xl(function(c,a){var p={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function y(U){return(U=Math.round(U))<0?0:U>255?255:U}function E(U){return y("%"===U[U.length-1]?parseFloat(U)/100*255:parseInt(U))}function A(U){return(Z="%"===U[U.length-1]?parseFloat(U)/100:parseFloat(U))<0?0:Z>1?1:Z;var Z}function R(U,Z,$){return $<0?$+=1:$>1&&($-=1),6*$<1?U+(Z-U)*$*6:2*$<1?Z:3*$<2?U+(Z-U)*(2/3-$)*6:U}try{a.parseCSSColor=function(U){var Z,$=U.replace(/ /g,"").toLowerCase();if($ in p)return p[$].slice();if("#"===$[0])return 4===$.length?(Z=parseInt($.substr(1),16))>=0&&Z<=4095?[(3840&Z)>>4|(3840&Z)>>8,240&Z|(240&Z)>>4,15&Z|(15&Z)<<4,1]:null:7===$.length&&(Z=parseInt($.substr(1),16))>=0&&Z<=16777215?[(16711680&Z)>>16,(65280&Z)>>8,255&Z,1]:null;var re=$.indexOf("("),ae=$.indexOf(")");if(-1!==re&&ae+1===$.length){var ue=$.substr(0,re),Ce=$.substr(re+1,ae-(re+1)).split(","),ke=1;switch(ue){case"rgba":if(4!==Ce.length)return null;ke=A(Ce.pop());case"rgb":return 3!==Ce.length?null:[E(Ce[0]),E(Ce[1]),E(Ce[2]),ke];case"hsla":if(4!==Ce.length)return null;ke=A(Ce.pop());case"hsl":if(3!==Ce.length)return null;var Ve=(parseFloat(Ce[0])%360+360)%360/360,We=A(Ce[1]),rt=A(Ce[2]),ht=rt<=.5?rt*(We+1):rt+We-rt*We,vt=2*rt-ht;return[y(255*R(vt,ht,Ve+1/3)),y(255*R(vt,ht,Ve)),y(255*R(vt,ht,Ve-1/3)),ke];default:return null}}return null}}catch(U){}});class Mn{constructor(a,p,y,E=1){this.r=a,this.g=p,this.b=y,this.a=E}static parse(a){if(!a)return;if(a instanceof Mn)return a;if("string"!=typeof a)return;const p=Oi.parseCSSColor(a);return p?new Mn(p[0]/255*p[3],p[1]/255*p[3],p[2]/255*p[3],p[3]):void 0}toString(){const[a,p,y,E]=this.toArray();return`rgba(${Math.round(a)},${Math.round(p)},${Math.round(y)},${E})`}toArray(){const{r:a,g:p,b:y,a:E}=this;return 0===E?[0,0,0,0]:[255*a/E,255*p/E,255*y/E,E]}}Mn.black=new Mn(0,0,0,1),Mn.white=new Mn(1,1,1,1),Mn.transparent=new Mn(0,0,0,0),Mn.red=new Mn(1,0,0,1),Mn.blue=new Mn(0,0,1,1);class Ai{constructor(a,p,y){this.sensitivity=a?p?"variant":"case":p?"accent":"base",this.locale=y,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,p){return this.collator.compare(a,p)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ls{constructor(a,p,y,E,A){this.text=a,this.image=p,this.scale=y,this.fontStack=E,this.textColor=A}}class ga{constructor(a){this.sections=a}static fromString(a){return new ga([new ls(a,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(a=>0!==a.text.length||a.image&&0!==a.image.name.length)}static factory(a){return a instanceof ga?a:ga.fromString(a)}toString(){return 0===this.sections.length?"":this.sections.map(a=>a.text).join("")}serialize(){const a=["format"];for(const p of this.sections){if(p.image){a.push(["image",p.image.name]);continue}a.push(p.text);const y={};p.fontStack&&(y["text-font"]=["literal",p.fontStack.split(",")]),p.scale&&(y["font-scale"]=p.scale),p.textColor&&(y["text-color"]=["rgba"].concat(p.textColor.toArray())),a.push(y)}return a}}class $o{constructor(a){this.name=a.name,this.available=a.available}toString(){return this.name}static fromString(a){return a?new $o({name:a,available:!1}):null}serialize(){return["image",this.name]}}function Ts(c,a,p,y){return"number"==typeof c&&c>=0&&c<=255&&"number"==typeof a&&a>=0&&a<=255&&"number"==typeof p&&p>=0&&p<=255?void 0===y||"number"==typeof y&&y>=0&&y<=1?null:`Invalid rgba value [${[c,a,p,y].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof y?[c,a,p,y]:[c,a,p]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ka(c){if(null===c||"string"==typeof c||"boolean"==typeof c||"number"==typeof c||c instanceof Mn||c instanceof Ai||c instanceof ga||c instanceof $o)return!0;if(Array.isArray(c)){for(const a of c)if(!Ka(a))return!1;return!0}if("object"==typeof c){for(const a in c)if(!Ka(c[a]))return!1;return!0}return!1}function xi(c){if(null===c)return or;if("string"==typeof c)return ur;if("boolean"==typeof c)return wn;if("number"==typeof c)return qt;if(c instanceof Mn)return ri;if(c instanceof Ai)return ni;if(c instanceof ga)return Kr;if(c instanceof $o)return yo;if(Array.isArray(c)){const a=c.length;let p;for(const y of c){const E=xi(y);if(p){if(p===E)continue;p=lr;break}p=E}return Ro(p||lr,a)}return Yr}function ua(c){const a=typeof c;return null===c?"":"string"===a||"number"===a||"boolean"===a?String(c):c instanceof Mn||c instanceof ga||c instanceof $o?c.toString():JSON.stringify(c)}class no{constructor(a,p){this.type=a,this.value=p}static parse(a,p){if(2!==a.length)return p.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!Ka(a[1]))return p.error("invalid value");const y=a[1];let E=xi(y);const A=p.expectedType;return"array"!==E.kind||0!==E.N||!A||"array"!==A.kind||"number"==typeof A.N&&0!==A.N||(E=A),new no(E,y)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Mn?["rgba"].concat(this.value.toArray()):this.value instanceof ga?this.value.serialize():this.value}}class ro{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}}const xh={string:ur,number:qt,boolean:wn,object:Yr};class Ac{constructor(a,p){this.type=a,this.args=p}static parse(a,p){if(a.length<2)return p.error("Expected at least one argument.");let y,E=1;const A=a[0];if("array"===A){let U,Z;if(a.length>2){const $=a[1];if("string"!=typeof $||!($ in xh)||"object"===$)return p.error('The item type argument of "array" must be one of string, number, boolean',1);U=xh[$],E++}else U=lr;if(a.length>3){if(null!==a[2]&&("number"!=typeof a[2]||a[2]<0||a[2]!==Math.floor(a[2])))return p.error('The length argument to "array" must be a positive integer literal',2);Z=a[2],E++}y=Ro(U,Z)}else y=xh[A];const R=[];for(;E<a.length;E++){const U=p.parse(a[E],E,lr);if(!U)return null;R.push(U)}return new Ac(y,R)}evaluate(a){for(let p=0;p<this.args.length;p++){const y=this.args[p].evaluate(a);if(!js(this.type,xi(y)))return y;if(p===this.args.length-1)throw new ro(`Expected value to be of type ${gi(this.type)}, but found ${gi(xi(y))} instead.`)}return null}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){const a=this.type,p=[a.kind];if("array"===a.kind){const y=a.itemType;if("string"===y.kind||"number"===y.kind||"boolean"===y.kind){p.push(y.kind);const E=a.N;("number"==typeof E||this.args.length>1)&&p.push(E)}}return p.concat(this.args.map(y=>y.serialize()))}}class ec{constructor(a){this.type=Kr,this.sections=a}static parse(a,p){if(a.length<2)return p.error("Expected at least one argument.");const y=a[1];if(!Array.isArray(y)&&"object"==typeof y)return p.error("First argument must be an image or text section.");const E=[];let A=!1;for(let R=1;R<=a.length-1;++R){const U=a[R];if(A&&"object"==typeof U&&!Array.isArray(U)){A=!1;let Z=null;if(U["font-scale"]&&(Z=p.parse(U["font-scale"],1,qt),!Z))return null;let $=null;if(U["text-font"]&&($=p.parse(U["text-font"],1,Ro(ur)),!$))return null;let re=null;if(U["text-color"]&&(re=p.parse(U["text-color"],1,ri),!re))return null;const ae=E[E.length-1];ae.scale=Z,ae.font=$,ae.textColor=re}else{const Z=p.parse(a[R],1,lr);if(!Z)return null;const $=Z.type.kind;if("string"!==$&&"value"!==$&&"null"!==$&&"resolvedImage"!==$)return p.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");A=!0,E.push({content:Z,scale:null,font:null,textColor:null})}}return new ec(E)}evaluate(a){return new ga(this.sections.map(p=>{const y=p.content.evaluate(a);return xi(y)===yo?new ls("",y,null,null,null):new ls(ua(y),null,p.scale?p.scale.evaluate(a):null,p.font?p.font.evaluate(a).join(","):null,p.textColor?p.textColor.evaluate(a):null)}))}eachChild(a){for(const p of this.sections)a(p.content),p.scale&&a(p.scale),p.font&&a(p.font),p.textColor&&a(p.textColor)}outputDefined(){return!1}serialize(){const a=["format"];for(const p of this.sections){a.push(p.content.serialize());const y={};p.scale&&(y["font-scale"]=p.scale.serialize()),p.font&&(y["text-font"]=p.font.serialize()),p.textColor&&(y["text-color"]=p.textColor.serialize()),a.push(y)}return a}}class kp{constructor(a){this.type=yo,this.input=a}static parse(a,p){if(2!==a.length)return p.error("Expected two arguments.");const y=p.parse(a[1],1,ur);return y?new kp(y):p.error("No image name provided.")}evaluate(a){const p=this.input.evaluate(a),y=$o.fromString(p);return y&&a.availableImages&&(y.available=a.availableImages.indexOf(p)>-1),y}eachChild(a){a(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const sf={"to-boolean":wn,"to-color":ri,"to-number":qt,"to-string":ur};class Us{constructor(a,p){this.type=a,this.args=p}static parse(a,p){if(a.length<2)return p.error("Expected at least one argument.");const y=a[0];if(("to-boolean"===y||"to-string"===y)&&2!==a.length)return p.error("Expected one argument.");const E=sf[y],A=[];for(let R=1;R<a.length;R++){const U=p.parse(a[R],R,lr);if(!U)return null;A.push(U)}return new Us(E,A)}evaluate(a){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(a));if("color"===this.type.kind){let p,y;for(const E of this.args){if(p=E.evaluate(a),y=null,p instanceof Mn)return p;if("string"==typeof p){const A=a.parseColor(p);if(A)return A}else if(Array.isArray(p)&&(y=p.length<3||p.length>4?`Invalid rbga value ${JSON.stringify(p)}: expected an array containing either three or four numeric values.`:Ts(p[0],p[1],p[2],p[3]),!y))return new Mn(p[0]/255,p[1]/255,p[2]/255,p[3])}throw new ro(y||`Could not parse color from value '${"string"==typeof p?p:String(JSON.stringify(p))}'`)}if("number"===this.type.kind){let p=null;for(const y of this.args){if(p=y.evaluate(a),null===p)return 0;const E=Number(p);if(!isNaN(E))return E}throw new ro(`Could not convert ${JSON.stringify(p)} to number.`)}return"formatted"===this.type.kind?ga.fromString(ua(this.args[0].evaluate(a))):"resolvedImage"===this.type.kind?$o.fromString(ua(this.args[0].evaluate(a))):ua(this.args[0].evaluate(a))}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){if("formatted"===this.type.kind)return new ec([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new kp(this.args[0]).serialize();const a=[`to-${this.type.kind}`];return this.eachChild(p=>{a.push(p.serialize())}),a}}const Uf=["Unknown","Point","LineString","Polygon"];class Gh{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Uf[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,p=this.featureDistanceData.scale,{x:y,y:E}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(y*p-a[0])+this.featureDistanceData.bearing[1]*(E*p-a[1])}return 0}parseColor(a){let p=this._parseColorCache[a];return p||(p=this._parseColorCache[a]=Mn.parse(a)),p}}class Yi{constructor(a,p,y,E){this.name=a,this.type=p,this._evaluate=y,this.args=E}evaluate(a){return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(a=>a.serialize()))}static parse(a,p){const y=a[0],E=Yi.definitions[y];if(!E)return p.error(`Unknown expression "${y}". If you wanted a literal array, use ["literal", [...]].`,0);const A=Array.isArray(E)?E[0]:E.type,R=Array.isArray(E)?[[E[1],E[2]]]:E.overloads,U=R.filter(([$])=>!Array.isArray($)||$.length===a.length-1);let Z=null;for(const[$,re]of U){Z=new Bu(p.registry,p.path,null,p.scope);const ae=[];let ue=!1;for(let Ce=1;Ce<a.length;Ce++){const ke=a[Ce],Ve=Array.isArray($)?$[Ce-1]:$.type,We=Z.parse(ke,1+ae.length,Ve);if(!We){ue=!0;break}ae.push(We)}if(!ue)if(Array.isArray($)&&$.length!==ae.length)Z.error(`Expected ${$.length} arguments, but found ${ae.length} instead.`);else{for(let Ce=0;Ce<ae.length;Ce++){const ke=Array.isArray($)?$[Ce]:$.type,Ve=ae[Ce];Z.concat(Ce+1).checkSubtype(ke,Ve.type)}if(0===Z.errors.length)return new Yi(y,A,re,ae)}}if(1===U.length)p.errors.push(...Z.errors);else{const $=(U.length?U:R).map(([ae])=>{return ue=ae,Array.isArray(ue)?`(${ue.map(gi).join(", ")})`:`(${gi(ue.type)}...)`;var ue}).join(" | "),re=[];for(let ae=1;ae<a.length;ae++){const ue=p.parse(a[ae],1+re.length);if(!ue)return null;re.push(gi(ue.type))}p.error(`Expected arguments of type ${$}, but found (${re.join(", ")}) instead.`)}return null}static register(a,p){Yi.definitions=p;for(const y in p)a[y]=Yi}}class Eo{constructor(a,p,y){this.type=ni,this.locale=y,this.caseSensitive=a,this.diacriticSensitive=p}static parse(a,p){if(2!==a.length)return p.error("Expected one argument.");const y=a[1];if("object"!=typeof y||Array.isArray(y))return p.error("Collator options argument must be an object.");const E=p.parse(void 0!==y["case-sensitive"]&&y["case-sensitive"],1,wn);if(!E)return null;const A=p.parse(void 0!==y["diacritic-sensitive"]&&y["diacritic-sensitive"],1,wn);if(!A)return null;let R=null;return y.locale&&(R=p.parse(y.locale,1,ur),!R)?null:new Eo(E,A,R)}evaluate(a){return new Ai(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}serialize(){const a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]}}const tc=8192;function Sd(c,a){c[0]=Math.min(c[0],a[0]),c[1]=Math.min(c[1],a[1]),c[2]=Math.max(c[2],a[0]),c[3]=Math.max(c[3],a[1])}function eh(c,a){return!(c[0]<=a[0]||c[2]>=a[2]||c[1]<=a[1]||c[3]>=a[3])}function Hr(c,a){const p=(180+c[0])/360,y=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,E=Math.pow(2,a.z);return[Math.round(p*E*tc),Math.round(y*E*tc)]}function Ql(c,a,p){const y=c[0]-a[0],E=c[1]-a[1],A=c[0]-p[0],R=c[1]-p[1];return y*R-A*E==0&&y*A<=0&&E*R<=0}function io(c,a){let p=!1;for(let R=0,U=a.length;R<U;R++){const Z=a[R];for(let $=0,re=Z.length;$<re-1;$++){if(Ql(c,Z[$],Z[$+1]))return!1;(E=Z[$])[1]>(y=c)[1]!=(A=Z[$+1])[1]>y[1]&&y[0]<(A[0]-E[0])*(y[1]-E[1])/(A[1]-E[1])+E[0]&&(p=!p)}}var y,E,A;return p}function Fl(c,a){for(let p=0;p<a.length;p++)if(io(c,a[p]))return!0;return!1}function up(c,a,p,y){const E=y[0]-p[0],A=y[1]-p[1],R=(c[0]-p[0])*A-E*(c[1]-p[1]),U=(a[0]-p[0])*A-E*(a[1]-p[1]);return R>0&&U<0||R<0&&U>0}function bh(c,a,p){for(const $ of p)for(let re=0;re<$.length-1;++re)if((U=[(R=$[re+1])[0]-(A=$[re])[0],R[1]-A[1]])[0]*(Z=[(E=a)[0]-(y=c)[0],E[1]-y[1]])[1]-U[1]*Z[0]!=0&&up(y,E,A,R)&&up(A,R,y,E))return!0;var y,E,A,R,U,Z;return!1}function Dc(c,a){for(let p=0;p<c.length;++p)if(!io(c[p],a))return!1;for(let p=0;p<c.length-1;++p)if(bh(c[p],c[p+1],a))return!1;return!0}function kc(c,a){for(let p=0;p<a.length;p++)if(Dc(c,a[p]))return!0;return!1}function wa(c,a,p){const y=[];for(let E=0;E<c.length;E++){const A=[];for(let R=0;R<c[E].length;R++){const U=Hr(c[E][R],p);Sd(a,U),A.push(U)}y.push(A)}return y}function ca(c,a,p){const y=[];for(let E=0;E<c.length;E++){const A=wa(c[E],a,p);y.push(A)}return y}function qh(c,a,p,y){if(c[0]<p[0]||c[0]>p[2]){const E=.5*y;let A=c[0]-p[0]>E?-y:p[0]-c[0]>E?y:0;0===A&&(A=c[0]-p[2]>E?-y:p[2]-c[0]>E?y:0),c[0]+=A}Sd(a,c)}function wh(c,a,p,y){const E=Math.pow(2,y.z)*tc,A=[y.x*tc,y.y*tc],R=[];for(const U of c)for(const Z of U){const $=[Z.x+A[0],Z.y+A[1]];qh($,a,p,E),R.push($)}return R}function oi(c,a,p,y){const E=Math.pow(2,y.z)*tc,A=[y.x*tc,y.y*tc],R=[];for(const Z of c){const $=[];for(const re of Z){const ae=[re.x+A[0],re.y+A[1]];Sd(a,ae),$.push(ae)}R.push($)}if(a[2]-a[0]<=E/2){(U=a)[0]=U[1]=1/0,U[2]=U[3]=-1/0;for(const Z of R)for(const $ of Z)qh($,a,p,E)}var U;return R}class nc{constructor(a,p){this.type=wn,this.geojson=a,this.geometries=p}static parse(a,p){if(2!==a.length)return p.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(Ka(a[1])){const y=a[1];if("FeatureCollection"===y.type)for(let E=0;E<y.features.length;++E){const A=y.features[E].geometry.type;if("Polygon"===A||"MultiPolygon"===A)return new nc(y,y.features[E].geometry)}else if("Feature"===y.type){const E=y.geometry.type;if("Polygon"===E||"MultiPolygon"===E)return new nc(y,y.geometry)}else if("Polygon"===y.type||"MultiPolygon"===y.type)return new nc(y,y)}return p.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(null!=a.geometry()&&null!=a.canonicalID()){if("Point"===a.geometryType())return function(p,y){const E=[1/0,1/0,-1/0,-1/0],A=[1/0,1/0,-1/0,-1/0],R=p.canonicalID();if("Polygon"===y.type){const U=wa(y.coordinates,A,R),Z=wh(p.geometry(),E,A,R);if(!eh(E,A))return!1;for(const $ of Z)if(!io($,U))return!1}if("MultiPolygon"===y.type){const U=ca(y.coordinates,A,R),Z=wh(p.geometry(),E,A,R);if(!eh(E,A))return!1;for(const $ of Z)if(!Fl($,U))return!1}return!0}(a,this.geometries);if("LineString"===a.geometryType())return function(p,y){const E=[1/0,1/0,-1/0,-1/0],A=[1/0,1/0,-1/0,-1/0],R=p.canonicalID();if("Polygon"===y.type){const U=wa(y.coordinates,A,R),Z=oi(p.geometry(),E,A,R);if(!eh(E,A))return!1;for(const $ of Z)if(!Dc($,U))return!1}if("MultiPolygon"===y.type){const U=ca(y.coordinates,A,R),Z=oi(p.geometry(),E,A,R);if(!eh(E,A))return!1;for(const $ of Z)if(!kc($,U))return!1}return!0}(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Ch(c){if(c instanceof Yi&&("get"===c.name&&1===c.args.length||"feature-state"===c.name||"has"===c.name&&1===c.args.length||"properties"===c.name||"geometry-type"===c.name||"id"===c.name||/^filter-/.test(c.name))||c instanceof nc)return!1;let a=!0;return c.eachChild(p=>{a&&!Ch(p)&&(a=!1)}),a}function eu(c){if(c instanceof Yi&&"feature-state"===c.name)return!1;let a=!0;return c.eachChild(p=>{a&&!eu(p)&&(a=!1)}),a}function Li(c,a){if(c instanceof Yi&&a.indexOf(c.name)>=0)return!1;let p=!0;return c.eachChild(y=>{p&&!Li(y,a)&&(p=!1)}),p}class Pp{constructor(a,p){this.type=p.type,this.name=a,this.boundExpression=p}static parse(a,p){if(2!==a.length||"string"!=typeof a[1])return p.error("'var' expression requires exactly one string literal argument.");const y=a[1];return p.scope.has(y)?new Pp(y,p.scope.get(y)):p.error(`Unknown variable "${y}". Make sure "${y}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Bu{constructor(a,p=[],y,E=new mr,A=[]){this.registry=a,this.path=p,this.key=p.map(R=>`[${R}]`).join(""),this.scope=E,this.errors=A,this.expectedType=y}parse(a,p,y,E,A={}){return p?this.concat(p,y,E)._parse(a,A):this._parse(a,A)}_parse(a,p){function y(E,A,R){return"assert"===R?new Ac(A,[E]):"coerce"===R?new Us(A,[E]):E}if(null!==a&&"string"!=typeof a&&"boolean"!=typeof a&&"number"!=typeof a||(a=["literal",a]),Array.isArray(a)){if(0===a.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const E=a[0];if("string"!=typeof E)return this.error(`Expression name must be a string, but found ${typeof E} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const A=this.registry[E];if(A){let R=A.parse(a,this);if(!R)return null;if(this.expectedType){const U=this.expectedType,Z=R.type;if("string"!==U.kind&&"number"!==U.kind&&"boolean"!==U.kind&&"object"!==U.kind&&"array"!==U.kind||"value"!==Z.kind)if("color"!==U.kind&&"formatted"!==U.kind&&"resolvedImage"!==U.kind||"value"!==Z.kind&&"string"!==Z.kind){if(this.checkSubtype(U,Z))return null}else R=y(R,U,p.typeAnnotation||"coerce");else R=y(R,U,p.typeAnnotation||"assert")}if(!(R instanceof no)&&"resolvedImage"!==R.type.kind&&Is(R)){const U=new Gh;try{R=new no(R.type,R.evaluate(U))}catch(Z){return this.error(Z.message),null}}return R}return this.error(`Unknown expression "${E}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===a?"'undefined' value invalid. Use null instead.":"object"==typeof a?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,p,y){const E="number"==typeof a?this.path.concat(a):this.path,A=y?this.scope.concat(y):this.scope;return new Bu(this.registry,E,p||null,A,this.errors)}error(a,...p){const y=`${this.key}${p.map(E=>`[${E}]`).join("")}`;this.errors.push(new Ft(y,a))}checkSubtype(a,p){const y=js(a,p);return y&&this.error(y),y}}function Is(c){if(c instanceof Pp)return Is(c.boundExpression);if(c instanceof Yi&&"error"===c.name||c instanceof Eo||c instanceof nc)return!1;const a=c instanceof Us||c instanceof Ac;let p=!0;return c.eachChild(y=>{p=a?p&&Is(y):p&&y instanceof no}),!!p&&Ch(c)&&Li(c,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Eh(c,a){const p=c.length-1;let y,E,A=0,R=p,U=0;for(;A<=R;)if(U=Math.floor((A+R)/2),y=c[U],E=c[U+1],y<=a){if(U===p||a<E)return U;A=U+1}else{if(!(y>a))throw new ro("Input is not a number.");R=U-1}return 0}class rc{constructor(a,p,y){this.type=a,this.input=p,this.labels=[],this.outputs=[];for(const[E,A]of y)this.labels.push(E),this.outputs.push(A)}static parse(a,p){if(a.length-1<4)return p.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return p.error("Expected an even number of arguments.");const y=p.parse(a[1],1,qt);if(!y)return null;const E=[];let A=null;p.expectedType&&"value"!==p.expectedType.kind&&(A=p.expectedType);for(let R=1;R<a.length;R+=2){const U=1===R?-1/0:a[R],Z=a[R+1],$=R,re=R+1;if("number"!=typeof U)return p.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(E.length&&E[E.length-1][0]>=U)return p.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',$);const ae=p.parse(Z,re,A);if(!ae)return null;A=A||ae.type,E.push([U,ae])}return new rc(A,y,E)}evaluate(a){const p=this.labels,y=this.outputs;if(1===p.length)return y[0].evaluate(a);const E=this.input.evaluate(a);if(E<=p[0])return y[0].evaluate(a);const A=p.length;return E>=p[A-1]?y[A-1].evaluate(a):y[Eh(p,E)].evaluate(a)}eachChild(a){a(this.input);for(const p of this.outputs)a(p)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}serialize(){const a=["step",this.input.serialize()];for(let p=0;p<this.labels.length;p++)p>0&&a.push(this.labels[p]),a.push(this.outputs[p].serialize());return a}}function ii(c,a,p){return c*(1-p)+a*p}var th=Object.freeze({__proto__:null,number:ii,color:function(c,a,p){return new Mn(ii(c.r,a.r,p),ii(c.g,a.g,p),ii(c.b,a.b,p),ii(c.a,a.a,p))},array:function(c,a,p){return c.map((y,E)=>ii(y,a[E],p))}});const ic=4/29,Di=6/29,Sh=3*Di*Di,oc=Math.PI/180,ya=180/Math.PI;function uo(c){return c>.008856451679035631?Math.pow(c,1/3):c/Sh+ic}function yu(c){return c>Di?c*c*c:Sh*(c-ic)}function tu(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function Th(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Oo(c){const a=Th(c.r),p=Th(c.g),y=Th(c.b),E=uo((.4124564*a+.3575761*p+.1804375*y)/.95047),A=uo((.2126729*a+.7151522*p+.072175*y)/1);return{l:116*A-16,a:500*(E-A),b:200*(A-uo((.0193339*a+.119192*p+.9503041*y)/1.08883)),alpha:c.a}}function bl(c){let a=(c.l+16)/116,p=isNaN(c.a)?a:a+c.a/500,y=isNaN(c.b)?a:a-c.b/200;return a=1*yu(a),p=.95047*yu(p),y=1.08883*yu(y),new Mn(tu(3.2404542*p-1.5371385*a-.4985314*y),tu(-.969266*p+1.8760108*a+.041556*y),tu(.0556434*p-.2040259*a+1.0572252*y),c.alpha)}function Pc(c,a,p){const y=a-c;return c+p*(y>180||y<-180?y-360*Math.round(y/360):y)}const ju={forward:Oo,reverse:bl,interpolate:function(c,a,p){return{l:ii(c.l,a.l,p),a:ii(c.a,a.a,p),b:ii(c.b,a.b,p),alpha:ii(c.alpha,a.alpha,p)}}},eo={forward:function(c){const{l:a,a:p,b:y}=Oo(c),E=Math.atan2(y,p)*ya;return{h:E<0?E+360:E,c:Math.sqrt(p*p+y*y),l:a,alpha:c.a}},reverse:function(c){const a=c.h*oc,p=c.c;return bl({l:c.l,a:Math.cos(a)*p,b:Math.sin(a)*p,alpha:c.alpha})},interpolate:function(c,a,p){return{h:Pc(c.h,a.h,p),c:ii(c.c,a.c,p),l:ii(c.l,a.l,p),alpha:ii(c.alpha,a.alpha,p)}}};var Td=Object.freeze({__proto__:null,lab:ju,hcl:eo});class zl{constructor(a,p,y,E,A){this.type=a,this.operator=p,this.interpolation=y,this.input=E,this.labels=[],this.outputs=[];for(const[R,U]of A)this.labels.push(R),this.outputs.push(U)}static interpolationFactor(a,p,y,E){let A=0;if("exponential"===a.name)A=nd(p,a.base,y,E);else if("linear"===a.name)A=nd(p,1,y,E);else if("cubic-bezier"===a.name){const R=a.controlPoints;A=new tn(R[0],R[1],R[2],R[3]).solve(nd(p,1,y,E))}return A}static parse(a,p){let[y,E,A,...R]=a;if(!Array.isArray(E)||0===E.length)return p.error("Expected an interpolation type expression.",1);if("linear"===E[0])E={name:"linear"};else if("exponential"===E[0]){const $=E[1];if("number"!=typeof $)return p.error("Exponential interpolation requires a numeric base.",1,1);E={name:"exponential",base:$}}else{if("cubic-bezier"!==E[0])return p.error(`Unknown interpolation type ${String(E[0])}`,1,0);{const $=E.slice(1);if(4!==$.length||$.some(re=>"number"!=typeof re||re<0||re>1))return p.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);E={name:"cubic-bezier",controlPoints:$}}}if(a.length-1<4)return p.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return p.error("Expected an even number of arguments.");if(A=p.parse(A,2,qt),!A)return null;const U=[];let Z=null;"interpolate-hcl"===y||"interpolate-lab"===y?Z=ri:p.expectedType&&"value"!==p.expectedType.kind&&(Z=p.expectedType);for(let $=0;$<R.length;$+=2){const re=R[$],ae=R[$+1],ue=$+3,Ce=$+4;if("number"!=typeof re)return p.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ue);if(U.length&&U[U.length-1][0]>=re)return p.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ue);const ke=p.parse(ae,Ce,Z);if(!ke)return null;Z=Z||ke.type,U.push([re,ke])}return"number"===Z.kind||"color"===Z.kind||"array"===Z.kind&&"number"===Z.itemType.kind&&"number"==typeof Z.N?new zl(Z,y,E,A,U):p.error(`Type ${gi(Z)} is not interpolatable.`)}evaluate(a){const p=this.labels,y=this.outputs;if(1===p.length)return y[0].evaluate(a);const E=this.input.evaluate(a);if(E<=p[0])return y[0].evaluate(a);const A=p.length;if(E>=p[A-1])return y[A-1].evaluate(a);const R=Eh(p,E),U=zl.interpolationFactor(this.interpolation,E,p[R],p[R+1]),Z=y[R].evaluate(a),$=y[R+1].evaluate(a);return"interpolate"===this.operator?th[this.type.kind.toLowerCase()](Z,$,U):"interpolate-hcl"===this.operator?eo.reverse(eo.interpolate(eo.forward(Z),eo.forward($),U)):ju.reverse(ju.interpolate(ju.forward(Z),ju.forward($),U))}eachChild(a){a(this.input);for(const p of this.outputs)a(p)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}serialize(){let a;a="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const p=[this.operator,a,this.input.serialize()];for(let y=0;y<this.labels.length;y++)p.push(this.labels[y],this.outputs[y].serialize());return p}}function nd(c,a,p,y){const E=y-p,A=c-p;return 0===E?0:1===a?A/E:(Math.pow(a,A)-1)/(Math.pow(a,E)-1)}class nu{constructor(a,p){this.type=a,this.args=p}static parse(a,p){if(a.length<2)return p.error("Expectected at least one argument.");let y=null;const E=p.expectedType;E&&"value"!==E.kind&&(y=E);const A=[];for(const U of a.slice(1)){const Z=p.parse(U,1+A.length,y,void 0,{typeAnnotation:"omit"});if(!Z)return null;y=y||Z.type,A.push(Z)}const R=E&&A.some(U=>js(E,U.type));return new nu(R?lr:y,A)}evaluate(a){let p,y=null,E=0;for(const A of this.args)if(E++,y=A.evaluate(a),y&&y instanceof $o&&!y.available&&(p||(p=y.name),y=null,E===this.args.length&&(y=p)),null!==y)break;return y}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){const a=["coalesce"];return this.eachChild(p=>{a.push(p.serialize())}),a}}class Gi{constructor(a,p){this.type=p.type,this.bindings=[].concat(a),this.result=p}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const p of this.bindings)a(p[1]);a(this.result)}static parse(a,p){if(a.length<4)return p.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const y=[];for(let A=1;A<a.length-1;A+=2){const R=a[A];if("string"!=typeof R)return p.error(`Expected string, but found ${typeof R} instead.`,A);if(/[^a-zA-Z0-9_]/.test(R))return p.error("Variable names must contain only alphanumeric characters or '_'.",A);const U=p.parse(a[A+1],A+1);if(!U)return null;y.push([R,U])}const E=p.parse(a[a.length-1],a.length-1,p.expectedType,y);return E?new Gi(y,E):null}outputDefined(){return this.result.outputDefined()}serialize(){const a=["let"];for(const[p,y]of this.bindings)a.push(p,y.serialize());return a.push(this.result.serialize()),a}}class Rc{constructor(a,p,y){this.type=a,this.index=p,this.input=y}static parse(a,p){if(3!==a.length)return p.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const y=p.parse(a[1],1,qt),E=p.parse(a[2],2,Ro(p.expectedType||lr));return y&&E?new Rc(E.type.itemType,y,E):null}evaluate(a){const p=this.index.evaluate(a),y=this.input.evaluate(a);if(p<0)throw new ro(`Array index out of bounds: ${p} < 0.`);if(p>=y.length)throw new ro(`Array index out of bounds: ${p} > ${y.length-1}.`);if(p!==Math.floor(p))throw new ro(`Array index must be an integer, but found ${p} instead.`);return y[p]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Hh{constructor(a,p){this.type=wn,this.needle=a,this.haystack=p}static parse(a,p){if(3!==a.length)return p.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const y=p.parse(a[1],1,lr),E=p.parse(a[2],2,lr);return y&&E?Ya(y.type,[wn,ur,qt,or,lr])?new Hh(y,E):p.error(`Expected first argument to be of type boolean, string, number or null, but found ${gi(y.type)} instead`):null}evaluate(a){const p=this.needle.evaluate(a),y=this.haystack.evaluate(a);if(!y)return!1;if(!Fr(p,["boolean","string","number","null"]))throw new ro(`Expected first argument to be of type boolean, string, number or null, but found ${gi(xi(p))} instead.`);if(!Fr(y,["string","array"]))throw new ro(`Expected second argument to be of type array or string, but found ${gi(xi(y))} instead.`);return y.indexOf(p)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Pa{constructor(a,p,y){this.type=qt,this.needle=a,this.haystack=p,this.fromIndex=y}static parse(a,p){if(a.length<=2||a.length>=5)return p.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const y=p.parse(a[1],1,lr),E=p.parse(a[2],2,lr);if(!y||!E)return null;if(!Ya(y.type,[wn,ur,qt,or,lr]))return p.error(`Expected first argument to be of type boolean, string, number or null, but found ${gi(y.type)} instead`);if(4===a.length){const A=p.parse(a[3],3,qt);return A?new Pa(y,E,A):null}return new Pa(y,E)}evaluate(a){const p=this.needle.evaluate(a),y=this.haystack.evaluate(a);if(!Fr(p,["boolean","string","number","null"]))throw new ro(`Expected first argument to be of type boolean, string, number or null, but found ${gi(xi(p))} instead.`);if(!Fr(y,["string","array"]))throw new ro(`Expected second argument to be of type array or string, but found ${gi(xi(y))} instead.`);if(this.fromIndex){const E=this.fromIndex.evaluate(a);return y.indexOf(p,E)}return y.indexOf(p)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ms{constructor(a,p,y,E,A,R){this.inputType=a,this.type=p,this.input=y,this.cases=E,this.outputs=A,this.otherwise=R}static parse(a,p){if(a.length<5)return p.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return p.error("Expected an even number of arguments.");let y,E;p.expectedType&&"value"!==p.expectedType.kind&&(E=p.expectedType);const A={},R=[];for(let $=2;$<a.length-1;$+=2){let re=a[$];const ae=a[$+1];Array.isArray(re)||(re=[re]);const ue=p.concat($);if(0===re.length)return ue.error("Expected at least one branch label.");for(const ke of re){if("number"!=typeof ke&&"string"!=typeof ke)return ue.error("Branch labels must be numbers or strings.");if("number"==typeof ke&&Math.abs(ke)>Number.MAX_SAFE_INTEGER)return ue.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof ke&&Math.floor(ke)!==ke)return ue.error("Numeric branch labels must be integer values.");if(y){if(ue.checkSubtype(y,xi(ke)))return null}else y=xi(ke);if(void 0!==A[String(ke)])return ue.error("Branch labels must be unique.");A[String(ke)]=R.length}const Ce=p.parse(ae,$,E);if(!Ce)return null;E=E||Ce.type,R.push(Ce)}const U=p.parse(a[1],1,lr);if(!U)return null;const Z=p.parse(a[a.length-1],a.length-1,E);return Z?"value"!==U.type.kind&&p.concat(1).checkSubtype(y,U.type)?null:new Ms(y,E,U,A,R,Z):null}evaluate(a){const p=this.input.evaluate(a);return(xi(p)===this.inputType&&this.outputs[this.cases[p]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every(a=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const a=["match",this.input.serialize()],p=Object.keys(this.cases).sort(),y=[],E={};for(const R of p){const U=E[this.cases[R]];void 0===U?(E[this.cases[R]]=y.length,y.push([this.cases[R],[R]])):y[U][1].push(R)}const A=R=>"number"===this.inputType.kind?Number(R):R;for(const[R,U]of y)a.push(1===U.length?A(U[0]):U.map(A)),a.push(this.outputs[R].serialize());return a.push(this.otherwise.serialize()),a}}class Ca{constructor(a,p,y){this.type=a,this.branches=p,this.otherwise=y}static parse(a,p){if(a.length<4)return p.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return p.error("Expected an odd number of arguments.");let y;p.expectedType&&"value"!==p.expectedType.kind&&(y=p.expectedType);const E=[];for(let R=1;R<a.length-1;R+=2){const U=p.parse(a[R],R,wn);if(!U)return null;const Z=p.parse(a[R+1],R+1,y);if(!Z)return null;E.push([U,Z]),y=y||Z.type}const A=p.parse(a[a.length-1],a.length-1,y);return A?new Ca(y,E,A):null}evaluate(a){for(const[p,y]of this.branches)if(p.evaluate(a))return y.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[p,y]of this.branches)a(p),a(y);a(this.otherwise)}outputDefined(){return this.branches.every(([a,p])=>p.outputDefined())&&this.otherwise.outputDefined()}serialize(){const a=["case"];return this.eachChild(p=>{a.push(p.serialize())}),a}}class vu{constructor(a,p,y,E){this.type=a,this.input=p,this.beginIndex=y,this.endIndex=E}static parse(a,p){if(a.length<=2||a.length>=5)return p.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const y=p.parse(a[1],1,lr),E=p.parse(a[2],2,qt);if(!y||!E)return null;if(!Ya(y.type,[Ro(lr),ur,lr]))return p.error(`Expected first argument to be of type array or string, but found ${gi(y.type)} instead`);if(4===a.length){const A=p.parse(a[3],3,qt);return A?new vu(y.type,y,E,A):null}return new vu(y.type,y,E)}evaluate(a){const p=this.input.evaluate(a),y=this.beginIndex.evaluate(a);if(!Fr(p,["string","array"]))throw new ro(`Expected first argument to be of type array or string, but found ${gi(xi(p))} instead.`);if(this.endIndex){const E=this.endIndex.evaluate(a);return p.slice(y,E)}return p.slice(y)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Nl(c,a){return"=="===c||"!="===c?"boolean"===a.kind||"string"===a.kind||"number"===a.kind||"null"===a.kind||"value"===a.kind:"string"===a.kind||"number"===a.kind||"value"===a.kind}function Ks(c,a,p,y){return 0===y.compare(a,p)}function Uu(c,a,p){const y="=="!==c&&"!="!==c;return class HL{constructor(A,R,U){this.type=wn,this.lhs=A,this.rhs=R,this.collator=U,this.hasUntypedArgument="value"===A.type.kind||"value"===R.type.kind}static parse(A,R){if(3!==A.length&&4!==A.length)return R.error("Expected two or three arguments.");const U=A[0];let Z=R.parse(A[1],1,lr);if(!Z)return null;if(!Nl(U,Z.type))return R.concat(1).error(`"${U}" comparisons are not supported for type '${gi(Z.type)}'.`);let $=R.parse(A[2],2,lr);if(!$)return null;if(!Nl(U,$.type))return R.concat(2).error(`"${U}" comparisons are not supported for type '${gi($.type)}'.`);if(Z.type.kind!==$.type.kind&&"value"!==Z.type.kind&&"value"!==$.type.kind)return R.error(`Cannot compare types '${gi(Z.type)}' and '${gi($.type)}'.`);y&&("value"===Z.type.kind&&"value"!==$.type.kind?Z=new Ac($.type,[Z]):"value"!==Z.type.kind&&"value"===$.type.kind&&($=new Ac(Z.type,[$])));let re=null;if(4===A.length){if("string"!==Z.type.kind&&"string"!==$.type.kind&&"value"!==Z.type.kind&&"value"!==$.type.kind)return R.error("Cannot use collator to compare non-string types.");if(re=R.parse(A[3],3,ni),!re)return null}return new HL(Z,$,re)}evaluate(A){const R=this.lhs.evaluate(A),U=this.rhs.evaluate(A);if(y&&this.hasUntypedArgument){const Z=xi(R),$=xi(U);if(Z.kind!==$.kind||"string"!==Z.kind&&"number"!==Z.kind)throw new ro(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${Z.kind}, ${$.kind}) instead.`)}if(this.collator&&!y&&this.hasUntypedArgument){const Z=xi(R),$=xi(U);if("string"!==Z.kind||"string"!==$.kind)return a(A,R,U)}return this.collator?p(A,R,U,this.collator.evaluate(A)):a(A,R,U)}eachChild(A){A(this.lhs),A(this.rhs),this.collator&&A(this.collator)}outputDefined(){return!0}serialize(){const A=[c];return this.eachChild(R=>{A.push(R.serialize())}),A}}}const Oc=Uu("==",function(c,a,p){return a===p},Ks),Ki=Uu("!=",function(c,a,p){return a!==p},function(c,a,p,y){return!Ks(0,a,p,y)}),Ih=Uu("<",function(c,a,p){return a<p},function(c,a,p,y){return y.compare(a,p)<0}),Vs=Uu(">",function(c,a,p){return a>p},function(c,a,p,y){return y.compare(a,p)>0}),Ba=Uu("<=",function(c,a,p){return a<=p},function(c,a,p,y){return y.compare(a,p)<=0}),Rp=Uu(">=",function(c,a,p){return a>=p},function(c,a,p,y){return y.compare(a,p)>=0});class As{constructor(a,p,y,E,A){this.type=ur,this.number=a,this.locale=p,this.currency=y,this.minFractionDigits=E,this.maxFractionDigits=A}static parse(a,p){if(3!==a.length)return p.error("Expected two arguments.");const y=p.parse(a[1],1,qt);if(!y)return null;const E=a[2];if("object"!=typeof E||Array.isArray(E))return p.error("NumberFormat options argument must be an object.");let A=null;if(E.locale&&(A=p.parse(E.locale,1,ur),!A))return null;let R=null;if(E.currency&&(R=p.parse(E.currency,1,ur),!R))return null;let U=null;if(E["min-fraction-digits"]&&(U=p.parse(E["min-fraction-digits"],1,qt),!U))return null;let Z=null;return E["max-fraction-digits"]&&(Z=p.parse(E["max-fraction-digits"],1,qt),!Z)?null:new As(y,A,R,U,Z)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]}}class Qn{constructor(a){this.type=qt,this.input=a}static parse(a,p){if(2!==a.length)return p.error(`Expected 1 argument, but found ${a.length-1} instead.`);const y=p.parse(a[1],1);return y?"array"!==y.type.kind&&"string"!==y.type.kind&&"value"!==y.type.kind?p.error(`Expected argument of type string or array, but found ${gi(y.type)} instead.`):new Qn(y):null}evaluate(a){const p=this.input.evaluate(a);if("string"==typeof p||Array.isArray(p))return p.length;throw new ro(`Expected value to be of type string or array, but found ${gi(xi(p))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}serialize(){const a=["length"];return this.eachChild(p=>{a.push(p.serialize())}),a}}const ui={"==":Oc,"!=":Ki,">":Vs,"<":Ih,">=":Rp,"<=":Ba,array:Ac,at:Rc,boolean:Ac,case:Ca,coalesce:nu,collator:Eo,format:ec,image:kp,in:Hh,"index-of":Pa,interpolate:zl,"interpolate-hcl":zl,"interpolate-lab":zl,length:Qn,let:Gi,literal:no,match:Ms,number:Ac,"number-format":As,object:Ac,slice:vu,step:rc,string:Ac,"to-boolean":Us,"to-color":Us,"to-number":Us,"to-string":Us,var:Pp,within:nc};function So(c,[a,p,y,E]){a=a.evaluate(c),p=p.evaluate(c),y=y.evaluate(c);const A=E?E.evaluate(c):1,R=Ts(a,p,y,A);if(R)throw new ro(R);return new Mn(a/255*A,p/255*A,y/255*A,A)}function Gs(c,a){return c in a}function ru(c,a){const p=a[c];return void 0===p?null:p}function Ao(c){return{type:c}}function Bl(c){return{result:"success",value:c}}function Xo(c){return{result:"error",value:c}}function wl(c){return"data-driven"===c["property-type"]||"cross-faded-data-driven"===c["property-type"]}function sl(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function bi(c){return!!c.expression&&c.expression.interpolated}function Ji(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":null===c?"null":typeof c}function ac(c){return"object"==typeof c&&null!==c&&!Array.isArray(c)}function Lc(c){return c}function sc(c,a){const p="color"===a.type,y=c.stops&&"object"==typeof c.stops[0][0],E=y||!(y||void 0!==c.property),A=c.type||(bi(a)?"exponential":"interval");if(p&&((c=Bn({},c)).stops&&(c.stops=c.stops.map($=>[$[0],Mn.parse($[1])])),c.default=Mn.parse(c.default?c.default:a.default)),c.colorSpace&&"rgb"!==c.colorSpace&&!Td[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let R,U,Z;if("exponential"===A)R=Gu;else if("interval"===A)R=Vu;else if("categorical"===A){R=cp,U=Object.create(null);for(const $ of c.stops)U[$[0]]=$[1];Z=typeof c.stops[0][0]}else{if("identity"!==A)throw new Error(`Unknown function type "${A}"`);R=vo}if(y){const $={},re=[];for(let Ce=0;Ce<c.stops.length;Ce++){const ke=c.stops[Ce],Ve=ke[0].zoom;void 0===$[Ve]&&($[Ve]={zoom:Ve,type:c.type,property:c.property,default:c.default,stops:[]},re.push(Ve)),$[Ve].stops.push([ke[0].value,ke[1]])}const ae=[];for(const Ce of re)ae.push([$[Ce].zoom,sc($[Ce],a)]);const ue={name:"linear"};return{kind:"composite",interpolationType:ue,interpolationFactor:zl.interpolationFactor.bind(void 0,ue),zoomStops:ae.map(Ce=>Ce[0]),evaluate:({zoom:Ce},ke)=>Gu({stops:ae,base:c.base},a,Ce).evaluate(Ce,ke)}}if(E){const $="exponential"===A?{name:"exponential",base:void 0!==c.base?c.base:1}:null;return{kind:"camera",interpolationType:$,interpolationFactor:zl.interpolationFactor.bind(void 0,$),zoomStops:c.stops.map(re=>re[0]),evaluate:({zoom:re})=>R(c,a,re,U,Z)}}return{kind:"source",evaluate($,re){const ae=re&&re.properties?re.properties[c.property]:void 0;return void 0===ae?ja(c.default,a.default):R(c,a,ae,U,Z)}}}function ja(c,a,p){return void 0!==c?c:void 0!==a?a:void 0!==p?p:void 0}function cp(c,a,p,y,E){return ja(typeof p===E?y[p]:void 0,c.default,a.default)}function Vu(c,a,p){if("number"!==Ji(p))return ja(c.default,a.default);const y=c.stops.length;if(1===y||p<=c.stops[0][0])return c.stops[0][1];if(p>=c.stops[y-1][0])return c.stops[y-1][1];const E=Eh(c.stops.map(A=>A[0]),p);return c.stops[E][1]}function Gu(c,a,p){const y=void 0!==c.base?c.base:1;if("number"!==Ji(p))return ja(c.default,a.default);const E=c.stops.length;if(1===E||p<=c.stops[0][0])return c.stops[0][1];if(p>=c.stops[E-1][0])return c.stops[E-1][1];const A=Eh(c.stops.map(re=>re[0]),p),R=function(re,ae,ue,Ce){const ke=Ce-ue,Ve=re-ue;return 0===ke?0:1===ae?Ve/ke:(Math.pow(ae,Ve)-1)/(Math.pow(ae,ke)-1)}(p,y,c.stops[A][0],c.stops[A+1][0]),U=c.stops[A][1],Z=c.stops[A+1][1];let $=th[a.type]||Lc;if(c.colorSpace&&"rgb"!==c.colorSpace){const re=Td[c.colorSpace];$=(ae,ue)=>re.reverse(re.interpolate(re.forward(ae),re.forward(ue),R))}return"function"==typeof U.evaluate?{evaluate(...re){const ae=U.evaluate.apply(void 0,re),ue=Z.evaluate.apply(void 0,re);if(void 0!==ae&&void 0!==ue)return $(ae,ue,R)}}:$(U,Z,R)}function vo(c,a,p){return"color"===a.type?p=Mn.parse(p):"formatted"===a.type?p=ga.fromString(p.toString()):"resolvedImage"===a.type?p=$o.fromString(p.toString()):Ji(p)===a.type||"enum"===a.type&&a.values[p]||(p=void 0),ja(p,c.default,a.default)}Yi.register(ui,{error:[{kind:"error"},[ur],(c,[a])=>{throw new ro(a.evaluate(c))}],typeof:[ur,[lr],(c,[a])=>gi(xi(a.evaluate(c)))],"to-rgba":[Ro(qt,4),[ri],(c,[a])=>a.evaluate(c).toArray()],rgb:[ri,[qt,qt,qt],So],rgba:[ri,[qt,qt,qt,qt],So],has:{type:wn,overloads:[[[ur],(c,[a])=>Gs(a.evaluate(c),c.properties())],[[ur,Yr],(c,[a,p])=>Gs(a.evaluate(c),p.evaluate(c))]]},get:{type:lr,overloads:[[[ur],(c,[a])=>ru(a.evaluate(c),c.properties())],[[ur,Yr],(c,[a,p])=>ru(a.evaluate(c),p.evaluate(c))]]},"feature-state":[lr,[ur],(c,[a])=>ru(a.evaluate(c),c.featureState||{})],properties:[Yr,[],c=>c.properties()],"geometry-type":[ur,[],c=>c.geometryType()],id:[lr,[],c=>c.id()],zoom:[qt,[],c=>c.globals.zoom],pitch:[qt,[],c=>c.globals.pitch||0],"distance-from-center":[qt,[],c=>c.distanceFromCenter()],"heatmap-density":[qt,[],c=>c.globals.heatmapDensity||0],"line-progress":[qt,[],c=>c.globals.lineProgress||0],"sky-radial-progress":[qt,[],c=>c.globals.skyRadialProgress||0],accumulated:[lr,[],c=>void 0===c.globals.accumulated?null:c.globals.accumulated],"+":[qt,Ao(qt),(c,a)=>{let p=0;for(const y of a)p+=y.evaluate(c);return p}],"*":[qt,Ao(qt),(c,a)=>{let p=1;for(const y of a)p*=y.evaluate(c);return p}],"-":{type:qt,overloads:[[[qt,qt],(c,[a,p])=>a.evaluate(c)-p.evaluate(c)],[[qt],(c,[a])=>-a.evaluate(c)]]},"/":[qt,[qt,qt],(c,[a,p])=>a.evaluate(c)/p.evaluate(c)],"%":[qt,[qt,qt],(c,[a,p])=>a.evaluate(c)%p.evaluate(c)],ln2:[qt,[],()=>Math.LN2],pi:[qt,[],()=>Math.PI],e:[qt,[],()=>Math.E],"^":[qt,[qt,qt],(c,[a,p])=>Math.pow(a.evaluate(c),p.evaluate(c))],sqrt:[qt,[qt],(c,[a])=>Math.sqrt(a.evaluate(c))],log10:[qt,[qt],(c,[a])=>Math.log(a.evaluate(c))/Math.LN10],ln:[qt,[qt],(c,[a])=>Math.log(a.evaluate(c))],log2:[qt,[qt],(c,[a])=>Math.log(a.evaluate(c))/Math.LN2],sin:[qt,[qt],(c,[a])=>Math.sin(a.evaluate(c))],cos:[qt,[qt],(c,[a])=>Math.cos(a.evaluate(c))],tan:[qt,[qt],(c,[a])=>Math.tan(a.evaluate(c))],asin:[qt,[qt],(c,[a])=>Math.asin(a.evaluate(c))],acos:[qt,[qt],(c,[a])=>Math.acos(a.evaluate(c))],atan:[qt,[qt],(c,[a])=>Math.atan(a.evaluate(c))],min:[qt,Ao(qt),(c,a)=>Math.min(...a.map(p=>p.evaluate(c)))],max:[qt,Ao(qt),(c,a)=>Math.max(...a.map(p=>p.evaluate(c)))],abs:[qt,[qt],(c,[a])=>Math.abs(a.evaluate(c))],round:[qt,[qt],(c,[a])=>{const p=a.evaluate(c);return p<0?-Math.round(-p):Math.round(p)}],floor:[qt,[qt],(c,[a])=>Math.floor(a.evaluate(c))],ceil:[qt,[qt],(c,[a])=>Math.ceil(a.evaluate(c))],"filter-==":[wn,[ur,lr],(c,[a,p])=>c.properties()[a.value]===p.value],"filter-id-==":[wn,[lr],(c,[a])=>c.id()===a.value],"filter-type-==":[wn,[ur],(c,[a])=>c.geometryType()===a.value],"filter-<":[wn,[ur,lr],(c,[a,p])=>{const y=c.properties()[a.value],E=p.value;return typeof y==typeof E&&y<E}],"filter-id-<":[wn,[lr],(c,[a])=>{const p=c.id(),y=a.value;return typeof p==typeof y&&p<y}],"filter->":[wn,[ur,lr],(c,[a,p])=>{const y=c.properties()[a.value],E=p.value;return typeof y==typeof E&&y>E}],"filter-id->":[wn,[lr],(c,[a])=>{const p=c.id(),y=a.value;return typeof p==typeof y&&p>y}],"filter-<=":[wn,[ur,lr],(c,[a,p])=>{const y=c.properties()[a.value],E=p.value;return typeof y==typeof E&&y<=E}],"filter-id-<=":[wn,[lr],(c,[a])=>{const p=c.id(),y=a.value;return typeof p==typeof y&&p<=y}],"filter->=":[wn,[ur,lr],(c,[a,p])=>{const y=c.properties()[a.value],E=p.value;return typeof y==typeof E&&y>=E}],"filter-id->=":[wn,[lr],(c,[a])=>{const p=c.id(),y=a.value;return typeof p==typeof y&&p>=y}],"filter-has":[wn,[lr],(c,[a])=>a.value in c.properties()],"filter-has-id":[wn,[],c=>null!==c.id()&&void 0!==c.id()],"filter-type-in":[wn,[Ro(ur)],(c,[a])=>a.value.indexOf(c.geometryType())>=0],"filter-id-in":[wn,[Ro(lr)],(c,[a])=>a.value.indexOf(c.id())>=0],"filter-in-small":[wn,[ur,Ro(lr)],(c,[a,p])=>p.value.indexOf(c.properties()[a.value])>=0],"filter-in-large":[wn,[ur,Ro(lr)],(c,[a,p])=>function(y,E,A,R){for(;A<=R;){const U=A+R>>1;if(E[U]===y)return!0;E[U]>y?R=U-1:A=U+1}return!1}(c.properties()[a.value],p.value,0,p.value.length-1)],all:{type:wn,overloads:[[[wn,wn],(c,[a,p])=>a.evaluate(c)&&p.evaluate(c)],[Ao(wn),(c,a)=>{for(const p of a)if(!p.evaluate(c))return!1;return!0}]]},any:{type:wn,overloads:[[[wn,wn],(c,[a,p])=>a.evaluate(c)||p.evaluate(c)],[Ao(wn),(c,a)=>{for(const p of a)if(p.evaluate(c))return!0;return!1}]]},"!":[wn,[wn],(c,[a])=>!a.evaluate(c)],"is-supported-script":[wn,[ur],(c,[a])=>{const p=c.globals&&c.globals.isSupportedScript;return!p||p(a.evaluate(c))}],upcase:[ur,[ur],(c,[a])=>a.evaluate(c).toUpperCase()],downcase:[ur,[ur],(c,[a])=>a.evaluate(c).toLowerCase()],concat:[ur,Ao(lr),(c,a)=>a.map(p=>ua(p.evaluate(c))).join("")],"resolved-locale":[ur,[ni],(c,[a])=>a.evaluate(c).resolvedLocale()]});class Op{constructor(a,p){var y;this.expression=a,this._warningHistory={},this._evaluator=new Gh,this._defaultValue=p?"color"===(y=p).type&&ac(y.default)?new Mn(0,0,0,0):"color"===y.type?Mn.parse(y.default)||null:void 0===y.default?null:y.default:null,this._enumValues=p&&"enum"===p.type?p.values:null}evaluateWithoutErrorHandling(a,p,y,E,A,R,U,Z){return this._evaluator.globals=a,this._evaluator.feature=p,this._evaluator.featureState=y,this._evaluator.canonical=E,this._evaluator.availableImages=A||null,this._evaluator.formattedSection=R,this._evaluator.featureTileCoord=U||null,this._evaluator.featureDistanceData=Z||null,this.expression.evaluate(this._evaluator)}evaluate(a,p,y,E,A,R,U,Z){this._evaluator.globals=a,this._evaluator.feature=p||null,this._evaluator.featureState=y||null,this._evaluator.canonical=E,this._evaluator.availableImages=A||null,this._evaluator.formattedSection=R||null,this._evaluator.featureTileCoord=U||null,this._evaluator.featureDistanceData=Z||null;try{const $=this.expression.evaluate(this._evaluator);if(null==$||"number"==typeof $&&$!=$)return this._defaultValue;if(this._enumValues&&!($ in this._enumValues))throw new ro(`Expected value to be one of ${Object.keys(this._enumValues).map(re=>JSON.stringify(re)).join(", ")}, but found ${JSON.stringify($)} instead.`);return $}catch($){return this._warningHistory[$.message]||(this._warningHistory[$.message]=!0,"undefined"!=typeof console&&console.warn($.message)),this._defaultValue}}}function qu(c){return Array.isArray(c)&&c.length>0&&"string"==typeof c[0]&&c[0]in ui}function Cl(c,a){const p=new Bu(ui,[],a?function(E){const A={color:ri,string:ur,number:qt,enum:ur,boolean:wn,formatted:Kr,resolvedImage:yo};return"array"===E.type?Ro(A[E.value]||lr,E.length):A[E.type]}(a):void 0),y=p.parse(c,void 0,void 0,void 0,a&&"string"===a.type?{typeAnnotation:"coerce"}:void 0);return y?Bl(new Op(y,a)):Xo(p.errors)}class us{constructor(a,p){this.kind=a,this._styleExpression=p,this.isStateDependent="constant"!==a&&!eu(p.expression)}evaluateWithoutErrorHandling(a,p,y,E,A,R){return this._styleExpression.evaluateWithoutErrorHandling(a,p,y,E,A,R)}evaluate(a,p,y,E,A,R){return this._styleExpression.evaluate(a,p,y,E,A,R)}}class nh{constructor(a,p,y,E){this.kind=a,this.zoomStops=y,this._styleExpression=p,this.isStateDependent="camera"!==a&&!eu(p.expression),this.interpolationType=E}evaluateWithoutErrorHandling(a,p,y,E,A,R){return this._styleExpression.evaluateWithoutErrorHandling(a,p,y,E,A,R)}evaluate(a,p,y,E,A,R){return this._styleExpression.evaluate(a,p,y,E,A,R)}interpolationFactor(a,p,y){return this.interpolationType?zl.interpolationFactor(this.interpolationType,a,p,y):0}}function Wh(c,a){if("error"===(c=Cl(c,a)).result)return c;const p=c.value.expression,y=Ch(p);if(!y&&!wl(a))return Xo([new Ft("","data expressions not supported")]);const E=Li(p,["zoom","pitch","distance-from-center"]);if(!E&&!sl(a))return Xo([new Ft("","zoom expressions not supported")]);const A=cs(p);return A||E?A instanceof Ft?Xo([A]):A instanceof zl&&!bi(a)?Xo([new Ft("",'"interpolate" expressions cannot be used with this property')]):Bl(A?new nh(y?"camera":"composite",c.value,A.labels,A instanceof zl?A.interpolation:void 0):new us(y?"constant":"source",c.value)):Xo([new Ft("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class jl{constructor(a,p){this._parameters=a,this._specification=p,Bn(this,sc(this._parameters,this._specification))}static deserialize(a){return new jl(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function cs(c){let a=null;if(c instanceof Gi)a=cs(c.result);else if(c instanceof nu){for(const p of c.args)if(a=cs(p),a)break}else(c instanceof rc||c instanceof zl)&&c.input instanceof Yi&&"zoom"===c.input.name&&(a=c);return a instanceof Ft||c.eachChild(p=>{const y=cs(p);y instanceof Ft?a=y:!a&&y?a=new Ft("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):a&&y&&a!==y&&(a=new Ft("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),a}function El(c){const a=c.key,p=c.value,y=c.valueSpec||{},E=c.objectElementValidators||{},A=c.style,R=c.styleSpec;let U=[];const Z=Ji(p);if("object"!==Z)return[new ot(a,p,`object expected, ${Z} found`)];for(const $ in p){const re=$.split(".")[0],ae=y[re]||y["*"];let ue;if(E[re])ue=E[re];else if(y[re])ue=ks;else if(E["*"])ue=E["*"];else{if(!y["*"]){U.push(new ot(a,p[$],`unknown property "${$}"`));continue}ue=ks}U=U.concat(ue({key:(a&&`${a}.`)+$,value:p[$],valueSpec:ae,style:A,styleSpec:R,object:p,objectKey:$},p))}for(const $ in y)E[$]||y[$].required&&void 0===y[$].default&&void 0===p[$]&&U.push(new ot(a,p,`missing required property "${$}"`));return U}function _o(c){const a=c.value,p=c.valueSpec,y=c.style,E=c.styleSpec,A=c.key,R=c.arrayElementValidator||ks;if("array"!==Ji(a))return[new ot(A,a,`array expected, ${Ji(a)} found`)];if(p.length&&a.length!==p.length)return[new ot(A,a,`array length ${p.length} expected, length ${a.length} found`)];if(p["min-length"]&&a.length<p["min-length"])return[new ot(A,a,`array length at least ${p["min-length"]} expected, length ${a.length} found`)];let U={type:p.value,values:p.values,minimum:p.minimum,maximum:p.maximum};E.$version<7&&(U.function=p.function),"object"===Ji(p.value)&&(U=p.value);let Z=[];for(let $=0;$<a.length;$++)Z=Z.concat(R({array:a,arrayIndex:$,value:a[$],valueSpec:U,style:y,styleSpec:E,key:`${A}[${$}]`}));return Z}function $h(c){const a=c.key,p=c.value,y=c.valueSpec;let E=Ji(p);if("number"===E&&p!=p&&(E="NaN"),"number"!==E)return[new ot(a,p,`number expected, ${E} found`)];if("minimum"in y){let A=y.minimum;if("array"===Ji(y.minimum)&&(A=y.minimum[c.arrayIndex]),p<A)return[new ot(a,p,`${p} is less than the minimum value ${A}`)]}if("maximum"in y){let A=y.maximum;if("array"===Ji(y.maximum)&&(A=y.maximum[c.arrayIndex]),p>A)return[new ot(a,p,`${p} is greater than the maximum value ${A}`)]}return[]}function Zu(c){const a=c.valueSpec,p=sn(c.value.type);let y,E,A,R={};const U="categorical"!==p&&void 0===c.value.property,Z=!U,$="array"===Ji(c.value.stops)&&"array"===Ji(c.value.stops[0])&&"object"===Ji(c.value.stops[0][0]),re=El({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(Ce){if("identity"===p)return[new ot(Ce.key,Ce.value,'identity function may not have a "stops" property')];let ke=[];const Ve=Ce.value;return ke=ke.concat(_o({key:Ce.key,value:Ve,valueSpec:Ce.valueSpec,style:Ce.style,styleSpec:Ce.styleSpec,arrayElementValidator:ae})),"array"===Ji(Ve)&&0===Ve.length&&ke.push(new ot(Ce.key,Ve,"array must have at least one stop")),ke},default:function(Ce){return ks({key:Ce.key,value:Ce.value,valueSpec:a,style:Ce.style,styleSpec:Ce.styleSpec})}}});return"identity"===p&&U&&re.push(new ot(c.key,c.value,'missing required property "property"')),"identity"===p||c.value.stops||re.push(new ot(c.key,c.value,'missing required property "stops"')),"exponential"===p&&c.valueSpec.expression&&!bi(c.valueSpec)&&re.push(new ot(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(Z&&!wl(c.valueSpec)?re.push(new ot(c.key,c.value,"property functions not supported")):U&&!sl(c.valueSpec)&&re.push(new ot(c.key,c.value,"zoom functions not supported"))),"categorical"!==p&&!$||void 0!==c.value.property||re.push(new ot(c.key,c.value,'"property" property is required')),re;function ae(Ce){let ke=[];const Ve=Ce.value,We=Ce.key;if("array"!==Ji(Ve))return[new ot(We,Ve,`array expected, ${Ji(Ve)} found`)];if(2!==Ve.length)return[new ot(We,Ve,`array length 2 expected, length ${Ve.length} found`)];if($){if("object"!==Ji(Ve[0]))return[new ot(We,Ve,`object expected, ${Ji(Ve[0])} found`)];if(void 0===Ve[0].zoom)return[new ot(We,Ve,"object stop key must have zoom")];if(void 0===Ve[0].value)return[new ot(We,Ve,"object stop key must have value")];if(A&&A>sn(Ve[0].zoom))return[new ot(We,Ve[0].zoom,"stop zoom values must appear in ascending order")];sn(Ve[0].zoom)!==A&&(A=sn(Ve[0].zoom),E=void 0,R={}),ke=ke.concat(El({key:`${We}[0]`,value:Ve[0],valueSpec:{zoom:{}},style:Ce.style,styleSpec:Ce.styleSpec,objectElementValidators:{zoom:$h,value:ue}}))}else ke=ke.concat(ue({key:`${We}[0]`,value:Ve[0],valueSpec:{},style:Ce.style,styleSpec:Ce.styleSpec},Ve));return qu(br(Ve[1]))?ke.concat([new ot(`${We}[1]`,Ve[1],"expressions are not allowed in function stops.")]):ke.concat(ks({key:`${We}[1]`,value:Ve[1],valueSpec:a,style:Ce.style,styleSpec:Ce.styleSpec}))}function ue(Ce,ke){const Ve=Ji(Ce.value),We=sn(Ce.value),rt=null!==Ce.value?Ce.value:ke;if(y){if(Ve!==y)return[new ot(Ce.key,rt,`${Ve} stop domain type must match previous stop domain type ${y}`)]}else y=Ve;if("number"!==Ve&&"string"!==Ve&&"boolean"!==Ve)return[new ot(Ce.key,rt,"stop domain value must be a number, string, or boolean")];if("number"!==Ve&&"categorical"!==p){let ht=`number expected, ${Ve} found`;return wl(a)&&void 0===p&&(ht+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ot(Ce.key,rt,ht)]}return"categorical"!==p||"number"!==Ve||isFinite(We)&&Math.floor(We)===We?"categorical"!==p&&"number"===Ve&&void 0!==E&&We<E?[new ot(Ce.key,rt,"stop domain values must appear in ascending order")]:(E=We,"categorical"===p&&We in R?[new ot(Ce.key,rt,"stop domain values must be unique")]:(R[We]=!0,[])):[new ot(Ce.key,rt,`integer expected, found ${We}`)]}}function iu(c){const a=("property"===c.expressionContext?Wh:Cl)(br(c.value),c.valueSpec);if("error"===a.result)return a.value.map(y=>new ot(`${c.key}${y.key}`,c.value,y.message));const p=a.value.expression||a.value._styleExpression.expression;if("property"===c.expressionContext&&"text-font"===c.propertyKey&&!p.outputDefined())return[new ot(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===c.expressionContext&&"layout"===c.propertyType&&!eu(p))return[new ot(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===c.expressionContext)return qi(p,c);if(c.expressionContext&&0===c.expressionContext.indexOf("cluster")){if(!Li(p,["zoom","feature-state"]))return[new ot(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===c.expressionContext&&!Ch(p))return[new ot(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function qi(c,a){const p=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const E of a.valueSpec.expression.parameters)p.delete(E);if(0===p.size)return[];const y=[];return c instanceof Yi&&p.has(c.name)?[new ot(a.key,a.value,`["${c.name}"] expression is not supported in a filter for a ${a.object.type} layer with id: ${a.object.id}`)]:(c.eachChild(E=>{y.push(...qi(E,a))}),y)}function yi(c){const a=c.key,p=c.value,y=c.valueSpec,E=[];return Array.isArray(y.values)?-1===y.values.indexOf(sn(p))&&E.push(new ot(a,p,`expected one of [${y.values.join(", ")}], ${JSON.stringify(p)} found`)):-1===Object.keys(y.values).indexOf(sn(p))&&E.push(new ot(a,p,`expected one of [${Object.keys(y.values).join(", ")}], ${JSON.stringify(p)} found`)),E}function ou(c){if(!0===c||!1===c)return!0;if(!Array.isArray(c)||0===c.length)return!1;switch(c[0]){case"has":return c.length>=2&&"$id"!==c[1]&&"$type"!==c[1];case"in":return c.length>=3&&("string"!=typeof c[1]||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==c.length||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const a of c.slice(1))if(!ou(a)&&"boolean"!=typeof a)return!1;return!0;default:return!0}}function Sl(c,a="fill"){if(null==c)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ou(c)||(c=lc(c));const p=c;let y=!0;try{y=function($){if(!vi($))return $;let re=br($);return _u(re),re=rd(re),re}(p)}catch($){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(p,null,2)}\n        `)}const E=Je[`filter_${a}`],A=Cl(y,E);let R=null;if("error"===A.result)throw new Error(A.value.map($=>`${$.key}: ${$.message}`).join(", "));R=($,re,ae)=>A.value.evaluate($,re,{},ae);let U=null,Z=null;if(y!==p){const $=Cl(p,E);if("error"===$.result)throw new Error($.value.map(re=>`${re.key}: ${re.message}`).join(", "));U=(re,ae,ue,Ce,ke)=>$.value.evaluate(re,ae,{},ue,void 0,void 0,Ce,ke),Z=!Ch($.value.expression)}return R=R,{filter:R,dynamicFilter:U||void 0,needGeometry:Xh(y),needFeature:!!Z}}function rd(c){if(!Array.isArray(c))return c;const a=function(p){if(Lp.has(p[0]))for(let y=1;y<p.length;y++)if(vi(p[y]))return!0;return p}(c);return!0===a?a:a.map(p=>rd(p))}function _u(c){let a=!1;const p=[];if("case"===c[0]){for(let y=1;y<c.length-1;y+=2)a=a||vi(c[y]),p.push(c[y+1]);p.push(c[c.length-1])}else if("match"===c[0]){a=a||vi(c[1]);for(let y=2;y<c.length-1;y+=2)p.push(c[y+1]);p.push(c[c.length-1])}else if("step"===c[0]){a=a||vi(c[1]);for(let y=1;y<c.length-1;y+=2)p.push(c[y+1])}a&&(c.length=0,c.push("any",...p));for(let y=1;y<c.length;y++)_u(c[y])}function vi(c){if(!Array.isArray(c))return!1;if("pitch"===(a=c[0])||"distance-from-center"===a)return!0;var a;for(let p=1;p<c.length;p++)if(vi(c[p]))return!0;return!1}const Lp=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function hp(c,a){return c<a?-1:c>a?1:0}function Xh(c){if(!Array.isArray(c))return!1;if("within"===c[0])return!0;for(let a=1;a<c.length;a++)if(Xh(c[a]))return!0;return!1}function lc(c){if(!c)return!0;const a=c[0];return c.length<=1?"any"!==a:"=="===a?hs(c[1],c[2],"=="):"!="===a?Ra(hs(c[1],c[2],"==")):"<"===a||">"===a||"<="===a||">="===a?hs(c[1],c[2],a):"any"===a?(p=c.slice(1),["any"].concat(p.map(lc))):"all"===a?["all"].concat(c.slice(1).map(lc)):"none"===a?["all"].concat(c.slice(1).map(lc).map(Ra)):"in"===a?xu(c[1],c.slice(2)):"!in"===a?Ra(xu(c[1],c.slice(2))):"has"===a?Fp(c[1]):"!has"===a?Ra(Fp(c[1])):"within"!==a||c;var p}function hs(c,a,p){switch(c){case"$type":return[`filter-type-${p}`,a];case"$id":return[`filter-id-${p}`,a];default:return[`filter-${p}`,c,a]}}function xu(c,a){if(0===a.length)return!1;switch(c){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(p=>typeof p!=typeof a[0])?["filter-in-large",c,["literal",a.sort(hp)]]:["filter-in-small",c,["literal",a]]}}function Fp(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Ra(c){return["!",c]}function Ul(c){if(ou(br(c.value))){const a=br(c.layerType);return iu(Bn({},c,{expressionContext:"filter",valueSpec:c.styleSpec[`filter_${a||"fill"}`]}))}return $n(c)}function $n(c){const a=c.value,p=c.key;if("array"!==Ji(a))return[new ot(p,a,`array expected, ${Ji(a)} found`)];const y=c.styleSpec;let E,A=[];if(a.length<1)return[new ot(p,a,"filter array must have at least 1 element")];switch(A=A.concat(yi({key:`${p}[0]`,value:a[0],valueSpec:y.filter_operator,style:c.style,styleSpec:c.styleSpec})),sn(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&"$type"===sn(a[1])&&A.push(new ot(p,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":3!==a.length&&A.push(new ot(p,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(E=Ji(a[1]),"string"!==E&&A.push(new ot(`${p}[1]`,a[1],`string expected, ${E} found`)));for(let R=2;R<a.length;R++)E=Ji(a[R]),"$type"===sn(a[1])?A=A.concat(yi({key:`${p}[${R}]`,value:a[R],valueSpec:y.geometry_type,style:c.style,styleSpec:c.styleSpec})):"string"!==E&&"number"!==E&&"boolean"!==E&&A.push(new ot(`${p}[${R}]`,a[R],`string, number, or boolean expected, ${E} found`));break;case"any":case"all":case"none":for(let R=1;R<a.length;R++)A=A.concat($n({key:`${p}[${R}]`,value:a[R],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":E=Ji(a[1]),2!==a.length?A.push(new ot(p,a,`filter array for "${a[0]}" operator must have 2 elements`)):"string"!==E&&A.push(new ot(`${p}[1]`,a[1],`string expected, ${E} found`));break;case"within":E=Ji(a[1]),2!==a.length?A.push(new ot(p,a,`filter array for "${a[0]}" operator must have 2 elements`)):"object"!==E&&A.push(new ot(`${p}[1]`,a[1],`object expected, ${E} found`))}return A}function Hu(c,a){const p=c.key,y=c.style,E=c.styleSpec,A=c.value,R=c.objectKey,U=E[`${a}_${c.layerType}`];if(!U)return[];const Z=R.match(/^(.*)-transition$/);if("paint"===a&&Z&&U[Z[1]]&&U[Z[1]].transition)return ks({key:p,value:A,valueSpec:E.transition,style:y,styleSpec:E});const $=c.valueSpec||U[R];if(!$)return[new ot(p,A,`unknown property "${R}"`)];let re;if("string"===Ji(A)&&wl($)&&!$.tokens&&(re=/^{([^}]+)}$/.exec(A)))return[new ot(p,A,`"${R}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(re[1])} }\`.`)];const ae=[];return"symbol"===c.layerType&&("text-field"===R&&y&&!y.glyphs&&ae.push(new ot(p,A,'use of "text-field" requires a style "glyphs" property')),"text-font"===R&&ac(br(A))&&"identity"===sn(A.type)&&ae.push(new ot(p,A,'"text-font" does not support identity functions'))),ae.concat(ks({key:c.key,value:A,valueSpec:$,style:y,styleSpec:E,expressionContext:"property",propertyType:a,propertyKey:R}))}function Ds(c){return Hu(c,"paint")}function Ua(c){return Hu(c,"layout")}function Lo(c){let a=[];const p=c.value,y=c.key,E=c.style,A=c.styleSpec;p.type||p.ref||a.push(new ot(y,p,'either "type" or "ref" is required'));let R=sn(p.type);const U=sn(p.ref);if(p.id){const Z=sn(p.id);for(let $=0;$<c.arrayIndex;$++){const re=E.layers[$];sn(re.id)===Z&&a.push(new ot(y,p.id,`duplicate layer id "${p.id}", previously used at line ${re.id.__line__}`))}}if("ref"in p){let Z;["type","source","source-layer","filter","layout"].forEach($=>{$ in p&&a.push(new ot(y,p[$],`"${$}" is prohibited for ref layers`))}),E.layers.forEach($=>{sn($.id)===U&&(Z=$)}),Z?Z.ref?a.push(new ot(y,p.ref,"ref cannot reference another ref layer")):R=sn(Z.type):a.push(new ot(y,p.ref,`ref layer "${U}" not found`))}else if("background"!==R&&"sky"!==R)if(p.source){const Z=E.sources&&E.sources[p.source],$=Z&&sn(Z.type);Z?"vector"===$&&"raster"===R?a.push(new ot(y,p.source,`layer "${p.id}" requires a raster source`)):"raster"===$&&"raster"!==R?a.push(new ot(y,p.source,`layer "${p.id}" requires a vector source`)):"vector"!==$||p["source-layer"]?"raster-dem"===$&&"hillshade"!==R?a.push(new ot(y,p.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==R||!p.paint||!p.paint["line-gradient"]||"geojson"===$&&Z.lineMetrics||a.push(new ot(y,p,`layer "${p.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new ot(y,p,`layer "${p.id}" must specify a "source-layer"`)):a.push(new ot(y,p.source,`source "${p.source}" not found`))}else a.push(new ot(y,p,'missing required property "source"'));return a=a.concat(El({key:y,value:p,valueSpec:A.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ks({key:`${y}.type`,value:p.type,valueSpec:A.layer.type,style:c.style,styleSpec:c.styleSpec,object:p,objectKey:"type"}),filter:Z=>Ul(Bn({layerType:R},Z)),layout:Z=>El({layer:p,key:Z.key,value:Z.value,style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{"*":$=>Ua(Bn({layerType:R},$))}}),paint:Z=>El({layer:p,key:Z.key,value:Z.value,style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{"*":$=>Ds(Bn({layerType:R},$))}})}})),a}function bu(c){const a=c.value,p=c.key,y=Ji(a);return"string"!==y?[new ot(p,a,`string expected, ${y} found`)]:[]}const qs={promoteId:function({key:c,value:a}){if("string"===Ji(a))return bu({key:c,value:a});{const p=[];for(const y in a)p.push(...bu({key:`${c}.${y}`,value:a[y]}));return p}}};function er(c){const a=c.value,p=c.key,y=c.styleSpec,E=c.style;if(!a.type)return[new ot(p,a,'"type" is required')];const A=sn(a.type);let R;switch(A){case"vector":case"raster":case"raster-dem":return R=El({key:p,value:a,valueSpec:y[`source_${A.replace("-","_")}`],style:c.style,styleSpec:y,objectElementValidators:qs}),R;case"geojson":if(R=El({key:p,value:a,valueSpec:y.source_geojson,style:E,styleSpec:y,objectElementValidators:qs}),a.cluster)for(const U in a.clusterProperties){const[Z,$]=a.clusterProperties[U],re="string"==typeof Z?[Z,["accumulated"],["get",U]]:Z;R.push(...iu({key:`${p}.${U}.map`,value:$,expressionContext:"cluster-map"})),R.push(...iu({key:`${p}.${U}.reduce`,value:re,expressionContext:"cluster-reduce"}))}return R;case"video":return El({key:p,value:a,valueSpec:y.source_video,style:E,styleSpec:y});case"image":return El({key:p,value:a,valueSpec:y.source_image,style:E,styleSpec:y});case"canvas":return[new ot(p,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return yi({key:`${p}.type`,value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:E,styleSpec:y})}}function rh(c){const a=c.value,p=c.styleSpec,y=p.light,E=c.style;let A=[];const R=Ji(a);if(void 0===a)return A;if("object"!==R)return A=A.concat([new ot("light",a,`object expected, ${R} found`)]),A;for(const U in a){const Z=U.match(/^(.*)-transition$/);A=A.concat(Z&&y[Z[1]]&&y[Z[1]].transition?ks({key:U,value:a[U],valueSpec:p.transition,style:E,styleSpec:p}):y[U]?ks({key:U,value:a[U],valueSpec:y[U],style:E,styleSpec:p}):[new ot(U,a[U],`unknown property "${U}"`)])}return A}function Mh(c){const a=c.value,p=c.key,y=c.style,E=c.styleSpec,A=E.terrain;let R=[];const U=Ji(a);if(void 0===a)return R;if("object"!==U)return R=R.concat([new ot("terrain",a,`object expected, ${U} found`)]),R;for(const Z in a){const $=Z.match(/^(.*)-transition$/);R=R.concat($&&A[$[1]]&&A[$[1]].transition?ks({key:Z,value:a[Z],valueSpec:E.transition,style:y,styleSpec:E}):A[Z]?ks({key:Z,value:a[Z],valueSpec:A[Z],style:y,styleSpec:E}):[new ot(Z,a[Z],`unknown property "${Z}"`)])}if(a.source){const Z=y.sources&&y.sources[a.source],$=Z&&sn(Z.type);Z?"raster-dem"!==$&&R.push(new ot(p,a.source,`terrain cannot be used with a source of type ${$}, it only be used with a "raster-dem" source type`)):R.push(new ot(p,a.source,`source "${a.source}" not found`))}else R.push(new ot(p,a,'terrain is missing required property "source"'));return R}function wu(c){const a=c.value,p=c.style,y=c.styleSpec,E=y.fog;let A=[];const R=Ji(a);if(void 0===a)return A;if("object"!==R)return A=A.concat([new ot("fog",a,`object expected, ${R} found`)]),A;for(const U in a){const Z=U.match(/^(.*)-transition$/);A=A.concat(Z&&E[Z[1]]&&E[Z[1]].transition?ks({key:U,value:a[U],valueSpec:y.transition,style:p,styleSpec:y}):E[U]?ks({key:U,value:a[U],valueSpec:E[U],style:p,styleSpec:y}):[new ot(U,a[U],`unknown property "${U}"`)])}return A}const Oa={"*":()=>[],array:_o,boolean:function(c){const a=c.value,p=c.key,y=Ji(a);return"boolean"!==y?[new ot(p,a,`boolean expected, ${y} found`)]:[]},number:$h,color:function(c){const a=c.key,p=c.value,y=Ji(p);return"string"!==y?[new ot(a,p,`color expected, ${y} found`)]:null===Oi.parseCSSColor(p)?[new ot(a,p,`color expected, "${p}" found`)]:[]},constants:On,enum:yi,filter:Ul,function:Zu,layer:Lo,object:El,source:er,light:rh,terrain:Mh,fog:wu,string:bu,formatted:function(c){return 0===bu(c).length?[]:iu(c)},resolvedImage:function(c){return 0===bu(c).length?[]:iu(c)},projection:function(c){const a=c.value,p=c.styleSpec,y=p.projection,E=c.style;let A=[];const R=Ji(a);if("object"===R)for(const U in a)A=A.concat(ks({key:U,value:a[U],valueSpec:y[U],style:E,styleSpec:p}));else"string"!==R&&(A=A.concat([new ot("projection",a,`object or string expected, ${R} found`)]));return A}};function ks(c){const a=c.value,p=c.valueSpec,y=c.styleSpec;return p.expression&&ac(sn(a))?Zu(c):p.expression&&qu(br(a))?iu(c):p.type&&Oa[p.type]?Oa[p.type](c):El(Bn({},c,{valueSpec:p.type?y[p.type]:p}))}function Cu(c){const a=c.value,p=c.key,y=bu(c);return y.length||(-1===a.indexOf("{fontstack}")&&y.push(new ot(p,a,'"glyphs" url must include a "{fontstack}" token')),-1===a.indexOf("{range}")&&y.push(new ot(p,a,'"glyphs" url must include a "{range}" token'))),y}function Tl(c,a=Je){let p=[];return p=p.concat(ks({key:"",value:c,valueSpec:a.$root,styleSpec:a,style:c,objectElementValidators:{glyphs:Cu,"*":()=>[]}})),c.constants&&(p=p.concat(On({key:"constants",value:c.constants,style:c,styleSpec:a}))),ll(p)}function ll(c){return[].concat(c).sort((a,p)=>a.line-p.line)}function Js(c){return function(...a){return ll(c.apply(this,a))}}Tl.source=Js(er),Tl.light=Js(rh),Tl.terrain=Js(Mh),Tl.fog=Js(wu),Tl.layer=Js(Lo),Tl.filter=Js(Ul),Tl.paintProperty=Js(Ds),Tl.layoutProperty=Js(Ua);const uc=Tl,Yh=uc.light,id=uc.fog,to=uc.paintProperty,ih=uc.layoutProperty;function Yo(c,a){let p=!1;if(a&&a.length)for(const y of a)c.fire(new Xt(new Error(y.message))),p=!0;return p}var Vr=ki;function ki(c,a,p){var y=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;var E=new Int32Array(this.arrayBuffer);c=E[0],this.d=(a=E[1])+2*(p=E[2]);for(var A=0;A<this.d*this.d;A++){var R=E[3+A],U=E[3+A+1];y.push(R===U?null:E.subarray(R,U))}var Z=E[3+y.length+1];this.keys=E.subarray(E[3+y.length],Z),this.bboxes=E.subarray(Z),this.insert=this._insertReadonly}else{this.d=a+2*p;for(var $=0;$<this.d*this.d;$++)y.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=c,this.padding=p,this.scale=a/c,this.uid=0;var re=p/a*c;this.min=-re,this.max=c+re}ki.prototype.insert=function(c,a,p,y,E){this._forEachCell(a,p,y,E,this._insertCell,this.uid++),this.keys.push(c),this.bboxes.push(a),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(E)},ki.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ki.prototype._insertCell=function(c,a,p,y,E,A){this.cells[E].push(A)},ki.prototype.query=function(c,a,p,y,E){var A=this.min,R=this.max;if(c<=A&&a<=A&&R<=p&&R<=y&&!E)return Array.prototype.slice.call(this.keys);var U=[];return this._forEachCell(c,a,p,y,this._queryCell,U,{},E),U},ki.prototype._queryCell=function(c,a,p,y,E,A,R,U){var Z=this.cells[E];if(null!==Z)for(var $=this.keys,re=this.bboxes,ae=0;ae<Z.length;ae++){var ue=Z[ae];if(void 0===R[ue]){var Ce=4*ue;(U?U(re[Ce+0],re[Ce+1],re[Ce+2],re[Ce+3]):c<=re[Ce+2]&&a<=re[Ce+3]&&p>=re[Ce+0]&&y>=re[Ce+1])?(R[ue]=!0,A.push($[ue])):R[ue]=!1}}},ki.prototype._forEachCell=function(c,a,p,y,E,A,R,U){for(var Z=this._convertToCellCoord(c),$=this._convertToCellCoord(a),re=this._convertToCellCoord(p),ae=this._convertToCellCoord(y),ue=Z;ue<=re;ue++)for(var Ce=$;Ce<=ae;Ce++){var ke=this.d*Ce+ue;if((!U||U(this._convertFromCellCoord(ue),this._convertFromCellCoord(Ce),this._convertFromCellCoord(ue+1),this._convertFromCellCoord(Ce+1)))&&E.call(this,c,a,p,y,ke,A,R,U))return}},ki.prototype._convertFromCellCoord=function(c){return(c-this.padding)/this.scale},ki.prototype._convertToCellCoord=function(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))},ki.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var c=this.cells,a=3+this.cells.length+1+1,p=0,y=0;y<this.cells.length;y++)p+=this.cells[y].length;var E=new Int32Array(a+p+this.keys.length+this.bboxes.length);E[0]=this.extent,E[1]=this.n,E[2]=this.padding;for(var A=a,R=0;R<c.length;R++){var U=c[R];E[3+R]=A,E.set(U,A),A+=U.length}return E[3+c.length]=A,E.set(this.keys,A),E[3+c.length+1]=A+=this.keys.length,E.set(this.bboxes,A),A+=this.bboxes.length,E.buffer};const{ImageData:La,ImageBitmap:ps}=Ke,Ja={};function Zn(c,a,p={}){Object.defineProperty(a,"_classRegistryKey",{value:c,writeable:!1}),Ja[c]={klass:a,omit:p.omit||[],shallow:p.shallow||[]}}Zn("Object",Object),Vr.serialize=function(c,a){const p=c.toArrayBuffer();return a&&a.push(p),{buffer:p}},Vr.deserialize=function(c){return new Vr(c.buffer)},Zn("Grid",Vr),Zn("Color",Mn),Zn("Error",Error),Zn("ResolvedImage",$o),Zn("StylePropertyFunction",jl),Zn("StyleExpression",Op,{omit:["_evaluator"]}),Zn("ZoomDependentExpression",nh),Zn("ZoomConstantExpression",us),Zn("CompoundExpression",Yi,{omit:["_evaluate"]});for(const c in ui)ui[c]._classRegistryKey||Zn(`Expression_${c}`,ui[c]);function Wu(c){return c&&"undefined"!=typeof ArrayBuffer&&(c instanceof ArrayBuffer||c.constructor&&"ArrayBuffer"===c.constructor.name)}function ds(c){return ps&&c instanceof ps}function ta(c,a){if(null==c||"boolean"==typeof c||"number"==typeof c||"string"==typeof c||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(Wu(c)||ds(c))return a&&a.push(c),c;if(ArrayBuffer.isView(c)){const p=c;return a&&a.push(p.buffer),p}if(c instanceof La)return a&&a.push(c.data.buffer),c;if(Array.isArray(c)){const p=[];for(const y of c)p.push(ta(y,a));return p}if("object"==typeof c){const p=c.constructor,y=p._classRegistryKey;if(!y)throw new Error("can't serialize object of unregistered class");const E=p.serialize?p.serialize(c,a):{};if(!p.serialize){for(const A in c){if(!c.hasOwnProperty(A)||Ja[y].omit.indexOf(A)>=0)continue;const R=c[A];E[A]=Ja[y].shallow.indexOf(A)>=0?R:ta(R,a)}c instanceof Error&&(E.message=c.message)}if(E.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==y&&(E.$name=y),E}throw new Error("can't serialize object of type "+typeof c)}function Un(c){if(null==c||"boolean"==typeof c||"number"==typeof c||"string"==typeof c||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||Wu(c)||ds(c)||ArrayBuffer.isView(c)||c instanceof La)return c;if(Array.isArray(c))return c.map(Un);if("object"==typeof c){const a=c.$name||"Object",{klass:p}=Ja[a];if(!p)throw new Error(`can't deserialize unregistered class ${a}`);if(p.deserialize)return p.deserialize(c);const y=Object.create(p.prototype);for(const E of Object.keys(c)){if("$name"===E)continue;const A=c[E];y[E]=Ja[a].shallow.indexOf(E)>=0?A:Un(A)}return y}throw new Error("can't deserialize object of type "+typeof c)}class Nr{constructor(){this.first=!0}update(a,p){const y=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=y,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=y,!0):(this.lastFloorZoom>y?(this.lastIntegerZoom=y+1,this.lastIntegerZoomTime=p):this.lastFloorZoom<y&&(this.lastIntegerZoom=y,this.lastIntegerZoomTime=p),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=y,!0))}}const Vl=c=>c>=1536&&c<=1791,Ps=c=>c>=1872&&c<=1919,$u=c=>c>=2208&&c<=2303,Rs=c=>c>=11904&&c<=12031,Lr=c=>c>=12032&&c<=12255,Vf=c=>c>=12272&&c<=12287,Eu=c=>c>=12288&&c<=12351,co=c=>c>=12352&&c<=12447,Ea=c=>c>=12448&&c<=12543,pp=c=>c>=12544&&c<=12591,oh=c=>c>=12704&&c<=12735,cc=c=>c>=12736&&c<=12783,gn=c=>c>=12784&&c<=12799,Ni=c=>c>=12800&&c<=13055,Rr=c=>c>=13056&&c<=13311,jo=c=>c>=13312&&c<=19903,Fc=c=>c>=19968&&c<=40959,ah=c=>c>=40960&&c<=42127,Su=c=>c>=42128&&c<=42191,hc=c=>c>=44032&&c<=55215,pc=c=>c>=63744&&c<=64255,oo=c=>c>=64336&&c<=65023,ho=c=>c>=65040&&c<=65055,fs=c=>c>=65072&&c<=65103,sh=c=>c>=65104&&c<=65135,Va=c=>c>=65136&&c<=65279,Ga=c=>c>=65280&&c<=65519;function dc(c){for(const a of c)if(Kh(a.charCodeAt(0)))return!0;return!1}function au(c){for(const a of c)if(!Qs(a.charCodeAt(0)))return!1;return!0}function Qs(c){return!(Vl(c)||Ps(c)||$u(c)||oo(c)||Va(c))}function Kh(c){return!(746!==c&&747!==c&&(c<4352||!(oh(c)||pp(c)||fs(c)&&!(c>=65097&&c<=65103)||pc(c)||Rr(c)||Rs(c)||cc(c)||!(!Eu(c)||c>=12296&&c<=12305||c>=12308&&c<=12319||12336===c)||jo(c)||Fc(c)||Ni(c)||(a=c,a>=12592&&a<=12687)||(a=>a>=43360&&a<=43391)(c)||(a=>a>=55216&&a<=55295)(c)||(a=>a>=4352&&a<=4607)(c)||hc(c)||co(c)||Vf(c)||(a=>a>=12688&&a<=12703)(c)||Lr(c)||gn(c)||Ea(c)&&12540!==c||!(!Ga(c)||65288===c||65289===c||65293===c||c>=65306&&c<=65310||65339===c||65341===c||65343===c||c>=65371&&c<=65503||65507===c||c>=65512&&c<=65519)||!(!sh(c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||(a=>a>=5120&&a<=5759)(c)||(a=>a>=6320&&a<=6399)(c)||ho(c)||(a=>a>=19904&&a<=19967)(c)||ah(c)||Su(c))));var a}function v(c){return!(Kh(c)||(a=c,(p=a)>=128&&p<=255&&(167===a||169===a||174===a||177===a||188===a||189===a||190===a||215===a||247===a)||(p=>p>=8192&&p<=8303)(a)&&(8214===a||8224===a||8225===a||8240===a||8241===a||8251===a||8252===a||8258===a||8263===a||8264===a||8265===a||8273===a)||(p=>p>=8448&&p<=8527)(a)||(p=>p>=8528&&p<=8591)(a)||(p=>p>=8960&&p<=9215)(a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||9003===a||a>=9085&&a<=9114||a>=9150&&a<=9165||9167===a||a>=9169&&a<=9179||a>=9186&&a<=9215)||(p=>p>=9216&&p<=9279)(a)&&9251!==a||(p=>p>=9280&&p<=9311)(a)||(p=>p>=9312&&p<=9471)(a)||(p=>p>=9632&&p<=9727)(a)||(p=>p>=9728&&p<=9983)(a)&&!(a>=9754&&a<=9759)||(p=>p>=11008&&p<=11263)(a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||Eu(a)||Ea(a)||(p=>p>=57344&&p<=63743)(a)||fs(a)||sh(a)||Ga(a)||8734===a||8756===a||8757===a||a>=9984&&a<=10087||a>=10102&&a<=10131||65532===a||65533===a));var a,p}function w(c){return c>=1424&&c<=2303||oo(c)||Va(c)}function _(c,a){return!(!a&&w(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||(p=c,p>=6016&&p<=6143));var p}function I(c){for(const a of c)if(w(a.charCodeAt(0)))return!0;return!1}const j="deferred",f="loading",l="loaded";let d=null,x="unavailable",M=null;const D=function(c){c&&"string"==typeof c&&c.indexOf("NetworkError")>-1&&(x="error"),d&&d(c)};function B(){G.fire(new xt("pluginStateChange",{pluginStatus:x,pluginURL:M}))}const G=new mt,W=function(){return x},Y=function(){if(x!==j||!M)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");x=f,B(),M&&oe({url:M},c=>{c?D(c):(x=l,B())})},ee={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>x===l||null!=ee.applyArabicShaping,isLoading:()=>x===f,setState(c){x=c.pluginStatus,M=c.pluginURL},isParsed:()=>null!=ee.applyArabicShaping&&null!=ee.processBidirectionalText&&null!=ee.processStyledBidirectionalText,getPluginURL:()=>M};class Q{constructor(a,p){this.zoom=a,p?(this.now=p.now,this.fadeDuration=p.fadeDuration,this.zoomHistory=p.zoomHistory,this.transition=p.transition,this.pitch=p.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Nr,this.transition={},this.pitch=0)}isSupportedScript(a){return function(p,y){for(const E of p)if(!_(E.charCodeAt(0),y))return!1;return!0}(a,ee.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const a=this.zoom,p=a-Math.floor(a),y=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:p+(1-p)*y}:{fromScale:.5,toScale:1,t:1-(1-y)*p}}}class le{constructor(a,p){this.property=a,this.value=p,this.expression=function(y,E){if(ac(y))return new jl(y,E);if(qu(y)){const A=Wh(y,E);if("error"===A.result)throw new Error(A.value.map(R=>`${R.key}: ${R.message}`).join(", "));return A.value}{let A=y;return"string"==typeof y&&"color"===E.type&&(A=Mn.parse(y)),{kind:"constant",evaluate:()=>A}}}(void 0===p?a.specification.default:p,a.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(a,p,y){return this.property.possiblyEvaluate(this,a,p,y)}}class de{constructor(a){this.property=a,this.value=new le(a,void 0)}transitioned(a,p){return new xe(this.property,this.value,p,jn({},a.transition,this.transition),a.now)}untransitioned(){return new xe(this.property,this.value,null,{},0)}}class ge{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)}getValue(a){return vr(this._values[a].value.value)}setValue(a,p){this._values.hasOwnProperty(a)||(this._values[a]=new de(this._values[a].property)),this._values[a].value=new le(this._values[a].property,null===p?void 0:vr(p))}getTransition(a){return vr(this._values[a].transition)}setTransition(a,p){this._values.hasOwnProperty(a)||(this._values[a]=new de(this._values[a].property)),this._values[a].transition=vr(p)||void 0}serialize(){const a={};for(const p of Object.keys(this._values)){const y=this.getValue(p);void 0!==y&&(a[p]=y);const E=this.getTransition(p);void 0!==E&&(a[`${p}-transition`]=E)}return a}transitioned(a,p){const y=new Te(this._properties);for(const E of Object.keys(this._values))y._values[E]=this._values[E].transitioned(a,p._values[E]);return y}untransitioned(){const a=new Te(this._properties);for(const p of Object.keys(this._values))a._values[p]=this._values[p].untransitioned();return a}}class xe{constructor(a,p,y,E,A){const R=E.delay||0,U=E.duration||0;A=A||0,this.property=a,this.value=p,this.begin=A+R,this.end=this.begin+U,a.specification.transition&&(E.delay||E.duration)&&(this.prior=y)}possiblyEvaluate(a,p,y){const E=a.now||0,A=this.value.possiblyEvaluate(a,p,y),R=this.prior;if(R){if(E>this.end)return this.prior=null,A;if(this.value.isDataDriven())return this.prior=null,A;if(E<this.begin)return R.possiblyEvaluate(a,p,y);{const U=(E-this.begin)/(this.end-this.begin);return this.property.interpolate(R.possiblyEvaluate(a,p,y),A,Dt(U))}}return A}}class Te{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,p,y){const E=new Le(this._properties);for(const A of Object.keys(this._values))E._values[A]=this._values[A].possiblyEvaluate(a,p,y);return E}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class Ee{constructor(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)}getValue(a){return vr(this._values[a].value)}setValue(a,p){this._values[a]=new le(this._values[a].property,null===p?void 0:vr(p))}serialize(){const a={};for(const p of Object.keys(this._values)){const y=this.getValue(p);void 0!==y&&(a[p]=y)}return a}possiblyEvaluate(a,p,y){const E=new Le(this._properties);for(const A of Object.keys(this._values))E._values[A]=this._values[A].possiblyEvaluate(a,p,y);return E}}class Pe{constructor(a,p,y){this.property=a,this.value=p,this.parameters=y}isConstant(){return"constant"===this.value.kind}constantOr(a){return"constant"===this.value.kind?this.value.value:a}evaluate(a,p,y,E){return this.property.evaluate(this.value,this.parameters,a,p,y,E)}}class Le{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class Me{constructor(a){this.specification=a}possiblyEvaluate(a,p){return a.expression.evaluate(p)}interpolate(a,p,y){const E=th[this.specification.type];return E?E(a,p,y):a}}class Ue{constructor(a,p){this.specification=a,this.overrides=p}possiblyEvaluate(a,p,y,E){return new Pe(this,"constant"===a.expression.kind||"camera"===a.expression.kind?{kind:"constant",value:a.expression.evaluate(p,null,{},y,E)}:a.expression,p)}interpolate(a,p,y){if("constant"!==a.value.kind||"constant"!==p.value.kind)return a;if(void 0===a.value.value||void 0===p.value.value)return new Pe(this,{kind:"constant",value:void 0},a.parameters);const E=th[this.specification.type];return E?new Pe(this,{kind:"constant",value:E(a.value.value,p.value.value,y)},a.parameters):a}evaluate(a,p,y,E,A,R){return"constant"===a.kind?a.value:a.evaluate(p,y,E,A,R)}}class Ye extends Ue{possiblyEvaluate(a,p,y,E){if(void 0===a.value)return new Pe(this,{kind:"constant",value:void 0},p);if("constant"===a.expression.kind){const A=a.expression.evaluate(p,null,{},y,E),R="resolvedImage"===a.property.specification.type&&"string"!=typeof A?A.name:A,U=this._calculate(R,R,R,p);return new Pe(this,{kind:"constant",value:U},p)}if("camera"===a.expression.kind){const A=this._calculate(a.expression.evaluate({zoom:p.zoom-1}),a.expression.evaluate({zoom:p.zoom}),a.expression.evaluate({zoom:p.zoom+1}),p);return new Pe(this,{kind:"constant",value:A},p)}return new Pe(this,a.expression,p)}evaluate(a,p,y,E,A,R){if("source"===a.kind){const U=a.evaluate(p,y,E,A,R);return this._calculate(U,U,U,p)}return"composite"===a.kind?this._calculate(a.evaluate({zoom:Math.floor(p.zoom)-1},y,E),a.evaluate({zoom:Math.floor(p.zoom)},y,E),a.evaluate({zoom:Math.floor(p.zoom)+1},y,E),p):a.value}_calculate(a,p,y,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:a,to:p,other:y}:{from:y,to:p,other:a}}interpolate(a){return a}}class yt{constructor(a){this.specification=a}possiblyEvaluate(a,p,y,E){if(void 0!==a.value){if("constant"===a.expression.kind){const A=a.expression.evaluate(p,null,{},y,E);return this._calculate(A,A,A,p)}return this._calculate(a.expression.evaluate(new Q(Math.floor(p.zoom-1),p)),a.expression.evaluate(new Q(Math.floor(p.zoom),p)),a.expression.evaluate(new Q(Math.floor(p.zoom+1),p)),p)}}_calculate(a,p,y,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:a,to:p}:{from:y,to:p}}interpolate(a){return a}}class gt{constructor(a){this.specification=a}possiblyEvaluate(a,p,y,E){return!!a.expression.evaluate(p,null,{},y,E)}interpolate(){return!1}}class Ot{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const p in a){const y=a[p];y.specification.overridable&&this.overridableProperties.push(p);const E=this.defaultPropertyValues[p]=new le(y,void 0),A=this.defaultTransitionablePropertyValues[p]=new de(y);this.defaultTransitioningPropertyValues[p]=A.untransitioned(),this.defaultPossiblyEvaluatedValues[p]=E.possiblyEvaluate({})}}}function dt(c,a){return 256*(c=an(Math.floor(c),0,255))+an(Math.floor(a),0,255)}Zn("DataDrivenProperty",Ue),Zn("DataConstantProperty",Me),Zn("CrossFadedDataDrivenProperty",Ye),Zn("CrossFadedProperty",yt),Zn("ColorRampProperty",gt);const Nt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class wt{constructor(a,p){this._structArray=a,this._pos1=p*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Zt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(a,p){return a._trim(),p&&(a.isTransferred=!0,p.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const p=Object.create(this.prototype);return p.arrayBuffer=a.arrayBuffer,p.length=a.length,p.capacity=a.arrayBuffer.byteLength/p.bytesPerElement,p._refreshViews(),p}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const p=this.uint8;this._refreshViews(),p&&this.uint8.set(p)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ft(c,a=1){let p=0,y=0;return{members:c.map(E=>{const A=Nt[E.type].BYTES_PER_ELEMENT,R=p=Gt(p,Math.max(a,A)),U=E.components||1;return y=Math.max(y,A),p+=A*U,{name:E.name,type:E.type,components:U,offset:R}}),size:Gt(p,Math.max(y,a)),alignment:a}}function Gt(c,a){return Math.ceil(c/a)*a}class Qt extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,p){const y=this.length;return this.resize(y+1),this.emplace(y,a,p)}emplace(a,p,y){const E=2*a;return this.int16[E+0]=p,this.int16[E+1]=y,a}}Qt.prototype.bytesPerElement=4,Zn("StructArrayLayout2i4",Qt);class mn extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,p,y,E){const A=this.length;return this.resize(A+1),this.emplace(A,a,p,y,E)}emplace(a,p,y,E,A){const R=4*a;return this.int16[R+0]=p,this.int16[R+1]=y,this.int16[R+2]=E,this.int16[R+3]=A,a}}mn.prototype.bytesPerElement=8,Zn("StructArrayLayout4i8",mn);class Hn extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,p,y,E,A,R,U){const Z=this.length;return this.resize(Z+1),this.emplace(Z,a,p,y,E,A,R,U)}emplace(a,p,y,E,A,R,U,Z){const $=6*a,re=12*a,ae=3*a;return this.int16[$+0]=p,this.int16[$+1]=y,this.uint8[re+4]=E,this.uint8[re+5]=A,this.uint8[re+6]=R,this.uint8[re+7]=U,this.float32[ae+2]=Z,a}}Hn.prototype.bytesPerElement=12,Zn("StructArrayLayout2i4ub1f12",Hn);class gr extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,p,y){const E=this.length;return this.resize(E+1),this.emplace(E,a,p,y)}emplace(a,p,y,E){const A=3*a;return this.float32[A+0]=p,this.float32[A+1]=y,this.float32[A+2]=E,a}}gr.prototype.bytesPerElement=12,Zn("StructArrayLayout3f12",gr);class wr extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,p,y,E,A,R,U,Z,$,re){const ae=this.length;return this.resize(ae+1),this.emplace(ae,a,p,y,E,A,R,U,Z,$,re)}emplace(a,p,y,E,A,R,U,Z,$,re,ae){const ue=10*a;return this.uint16[ue+0]=p,this.uint16[ue+1]=y,this.uint16[ue+2]=E,this.uint16[ue+3]=A,this.uint16[ue+4]=R,this.uint16[ue+5]=U,this.uint16[ue+6]=Z,this.uint16[ue+7]=$,this.uint16[ue+8]=re,this.uint16[ue+9]=ae,a}}wr.prototype.bytesPerElement=20,Zn("StructArrayLayout10ui20",wr);class tr extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,p,y,E,A,R,U,Z){const $=this.length;return this.resize($+1),this.emplace($,a,p,y,E,A,R,U,Z)}emplace(a,p,y,E,A,R,U,Z,$){const re=8*a;return this.uint16[re+0]=p,this.uint16[re+1]=y,this.uint16[re+2]=E,this.uint16[re+3]=A,this.uint16[re+4]=R,this.uint16[re+5]=U,this.uint16[re+6]=Z,this.uint16[re+7]=$,a}}tr.prototype.bytesPerElement=16,Zn("StructArrayLayout8ui16",tr);class Cr extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,p,y,E,A,R,U,Z,$,re,ae,ue,Ce,ke,Ve,We){const rt=this.length;return this.resize(rt+1),this.emplace(rt,a,p,y,E,A,R,U,Z,$,re,ae,ue,Ce,ke,Ve,We)}emplace(a,p,y,E,A,R,U,Z,$,re,ae,ue,Ce,ke,Ve,We,rt){const ht=16*a;return this.int16[ht+0]=p,this.int16[ht+1]=y,this.int16[ht+2]=E,this.int16[ht+3]=A,this.uint16[ht+4]=R,this.uint16[ht+5]=U,this.uint16[ht+6]=Z,this.uint16[ht+7]=$,this.int16[ht+8]=re,this.int16[ht+9]=ae,this.int16[ht+10]=ue,this.int16[ht+11]=Ce,this.int16[ht+12]=ke,this.int16[ht+13]=Ve,this.int16[ht+14]=We,this.int16[ht+15]=rt,a}}Cr.prototype.bytesPerElement=32,Zn("StructArrayLayout4i4ui4i4i32",Cr);class Wr extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const p=this.length;return this.resize(p+1),this.emplace(p,a)}emplace(a,p){return this.uint32[1*a+0]=p,a}}Wr.prototype.bytesPerElement=4,Zn("StructArrayLayout1ul4",Wr);class Zi extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,p,y,E,A,R,U,Z,$,re,ae,ue,Ce){const ke=this.length;return this.resize(ke+1),this.emplace(ke,a,p,y,E,A,R,U,Z,$,re,ae,ue,Ce)}emplace(a,p,y,E,A,R,U,Z,$,re,ae,ue,Ce,ke){const Ve=20*a,We=10*a;return this.int16[Ve+0]=p,this.int16[Ve+1]=y,this.int16[Ve+2]=E,this.int16[Ve+3]=A,this.int16[Ve+4]=R,this.float32[We+3]=U,this.float32[We+4]=Z,this.float32[We+5]=$,this.float32[We+6]=re,this.int16[Ve+14]=ae,this.uint32[We+8]=ue,this.uint16[Ve+18]=Ce,this.uint16[Ve+19]=ke,a}}Zi.prototype.bytesPerElement=40,Zn("StructArrayLayout5i4f1i1ul2ui40",Zi);class ha extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,p,y,E,A,R,U){const Z=this.length;return this.resize(Z+1),this.emplace(Z,a,p,y,E,A,R,U)}emplace(a,p,y,E,A,R,U,Z){const $=8*a;return this.int16[$+0]=p,this.int16[$+1]=y,this.int16[$+2]=E,this.int16[$+4]=A,this.int16[$+5]=R,this.int16[$+6]=U,this.int16[$+7]=Z,a}}ha.prototype.bytesPerElement=16,Zn("StructArrayLayout3i2i2i16",ha);class Do extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,p,y,E,A){const R=this.length;return this.resize(R+1),this.emplace(R,a,p,y,E,A)}emplace(a,p,y,E,A,R){const U=4*a,Z=8*a;return this.float32[U+0]=p,this.float32[U+1]=y,this.float32[U+2]=E,this.int16[Z+6]=A,this.int16[Z+7]=R,a}}Do.prototype.bytesPerElement=16,Zn("StructArrayLayout2f1f2i16",Do);class xo extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,p,y,E){const A=this.length;return this.resize(A+1),this.emplace(A,a,p,y,E)}emplace(a,p,y,E,A){const R=12*a,U=3*a;return this.uint8[R+0]=p,this.uint8[R+1]=y,this.float32[U+1]=E,this.float32[U+2]=A,a}}xo.prototype.bytesPerElement=12,Zn("StructArrayLayout2ub2f12",xo);class Ko extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,p,y){const E=this.length;return this.resize(E+1),this.emplace(E,a,p,y)}emplace(a,p,y,E){const A=3*a;return this.uint16[A+0]=p,this.uint16[A+1]=y,this.uint16[A+2]=E,a}}Ko.prototype.bytesPerElement=6,Zn("StructArrayLayout3ui6",Ko);class va extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a,p,y,E,A,R,U,Z,$,re,ae,ue,Ce,ke,Ve,We,rt,ht,vt,Tt,Ct){const kt=this.length;return this.resize(kt+1),this.emplace(kt,a,p,y,E,A,R,U,Z,$,re,ae,ue,Ce,ke,Ve,We,rt,ht,vt,Tt,Ct)}emplace(a,p,y,E,A,R,U,Z,$,re,ae,ue,Ce,ke,Ve,We,rt,ht,vt,Tt,Ct,kt){const ln=30*a,Yt=15*a,Kn=60*a;return this.int16[ln+0]=p,this.int16[ln+1]=y,this.int16[ln+2]=E,this.float32[Yt+2]=A,this.float32[Yt+3]=R,this.uint16[ln+8]=U,this.uint16[ln+9]=Z,this.uint32[Yt+5]=$,this.uint32[Yt+6]=re,this.uint32[Yt+7]=ae,this.uint16[ln+16]=ue,this.uint16[ln+17]=Ce,this.uint16[ln+18]=ke,this.float32[Yt+10]=Ve,this.float32[Yt+11]=We,this.uint8[Kn+48]=rt,this.uint8[Kn+49]=ht,this.uint8[Kn+50]=vt,this.uint32[Yt+13]=Tt,this.int16[ln+28]=Ct,this.uint8[Kn+58]=kt,a}}va.prototype.bytesPerElement=60,Zn("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",va);class Tu extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a,p,y,E,A,R,U,Z,$,re,ae,ue,Ce,ke,Ve,We,rt,ht,vt,Tt,Ct,kt,ln,Yt,Kn,In,hn,Tn,Ln,yn){const Jn=this.length;return this.resize(Jn+1),this.emplace(Jn,a,p,y,E,A,R,U,Z,$,re,ae,ue,Ce,ke,Ve,We,rt,ht,vt,Tt,Ct,kt,ln,Yt,Kn,In,hn,Tn,Ln,yn)}emplace(a,p,y,E,A,R,U,Z,$,re,ae,ue,Ce,ke,Ve,We,rt,ht,vt,Tt,Ct,kt,ln,Yt,Kn,In,hn,Tn,Ln,yn,Jn){const pr=38*a,Ri=19*a;return this.int16[pr+0]=p,this.int16[pr+1]=y,this.int16[pr+2]=E,this.float32[Ri+2]=A,this.float32[Ri+3]=R,this.int16[pr+8]=U,this.int16[pr+9]=Z,this.int16[pr+10]=$,this.int16[pr+11]=re,this.int16[pr+12]=ae,this.int16[pr+13]=ue,this.uint16[pr+14]=Ce,this.uint16[pr+15]=ke,this.uint16[pr+16]=Ve,this.uint16[pr+17]=We,this.uint16[pr+18]=rt,this.uint16[pr+19]=ht,this.uint16[pr+20]=vt,this.uint16[pr+21]=Tt,this.uint16[pr+22]=Ct,this.uint16[pr+23]=kt,this.uint16[pr+24]=ln,this.uint16[pr+25]=Yt,this.uint16[pr+26]=Kn,this.uint16[pr+27]=In,this.uint16[pr+28]=hn,this.uint32[Ri+15]=Tn,this.float32[Ri+16]=Ln,this.float32[Ri+17]=yn,this.float32[Ri+18]=Jn,a}}Tu.prototype.bytesPerElement=76,Zn("StructArrayLayout3i2f6i15ui1ul3f76",Tu);class O extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const p=this.length;return this.resize(p+1),this.emplace(p,a)}emplace(a,p){return this.float32[1*a+0]=p,a}}O.prototype.bytesPerElement=4,Zn("StructArrayLayout1f4",O);class P extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,p,y){const E=this.length;return this.resize(E+1),this.emplace(E,a,p,y)}emplace(a,p,y,E){const A=3*a;return this.int16[A+0]=p,this.int16[A+1]=y,this.int16[A+2]=E,a}}P.prototype.bytesPerElement=6,Zn("StructArrayLayout3i6",P);class z extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,p,y,E){const A=this.length;return this.resize(A+1),this.emplace(A,a,p,y,E)}emplace(a,p,y,E,A){const R=6*a;return this.uint32[3*a+0]=p,this.uint16[R+2]=y,this.uint16[R+3]=E,this.uint16[R+4]=A,a}}z.prototype.bytesPerElement=12,Zn("StructArrayLayout1ul3ui12",z);class K extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,p){const y=this.length;return this.resize(y+1),this.emplace(y,a,p)}emplace(a,p,y){const E=2*a;return this.uint16[E+0]=p,this.uint16[E+1]=y,a}}K.prototype.bytesPerElement=4,Zn("StructArrayLayout2ui4",K);class he extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const p=this.length;return this.resize(p+1),this.emplace(p,a)}emplace(a,p){return this.uint16[1*a+0]=p,a}}he.prototype.bytesPerElement=2,Zn("StructArrayLayout1ui2",he);class fe extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,p){const y=this.length;return this.resize(y+1),this.emplace(y,a,p)}emplace(a,p,y){const E=2*a;return this.float32[E+0]=p,this.float32[E+1]=y,a}}fe.prototype.bytesPerElement=8,Zn("StructArrayLayout2f8",fe);class Ie extends Zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,p,y,E){const A=this.length;return this.resize(A+1),this.emplace(A,a,p,y,E)}emplace(a,p,y,E,A){const R=4*a;return this.float32[R+0]=p,this.float32[R+1]=y,this.float32[R+2]=E,this.float32[R+3]=A,a}}Ie.prototype.bytesPerElement=16,Zn("StructArrayLayout4f16",Ie);class Fe extends wt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Fe.prototype.size=40;class at extends Zi{get(a){return new Fe(this,a)}}Zn("CollisionBoxArray",at);class nt extends wt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(a){this._structArray.uint8[this._pos1+49]=a}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(a){this._structArray.uint8[this._pos1+50]=a}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(a){this._structArray.uint32[this._pos4+13]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(a){this._structArray.uint8[this._pos1+58]=a}}nt.prototype.size=60;class jt extends va{get(a){return new nt(this,a)}}Zn("PlacedSymbolArray",jt);class Pt extends wt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(a){this._structArray.uint32[this._pos4+15]=a}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Pt.prototype.size=76;class cn extends Tu{get(a){return new Pt(this,a)}}Zn("SymbolInstanceArray",cn);class Sn extends O{getoffsetX(a){return this.float32[1*a+0]}}Zn("GlyphOffsetArray",Sn);class ar extends P{getx(a){return this.int16[3*a+0]}gety(a){return this.int16[3*a+1]}gettileUnitDistanceFromAnchor(a){return this.int16[3*a+2]}}Zn("SymbolLineVertexArray",ar);class xn extends wt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}xn.prototype.size=12;class Xr extends z{get(a){return new xn(this,a)}}Zn("FeatureIndexArray",Xr);class Sr extends wt{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Sr.prototype.size=4;class en extends K{get(a){return new Sr(this,a)}}Zn("FillExtrusionCentroidArray",en);const Vn=ft([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),yr=ft([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Br=xl(function(c){c.exports=function(a,p){var y,E,A,R,U,Z,$,re;for(E=a.length-(y=3&a.length),A=p,U=3432918353,Z=461845907,re=0;re<E;)$=255&a.charCodeAt(re)|(255&a.charCodeAt(++re))<<8|(255&a.charCodeAt(++re))<<16|(255&a.charCodeAt(++re))<<24,++re,A=27492+(65535&(R=5*(65535&(A=(A^=$=(65535&($=($=(65535&$)*U+((($>>>16)*U&65535)<<16)&4294967295)<<15|$>>>17))*Z+((($>>>16)*Z&65535)<<16)&4294967295)<<13|A>>>19))+((5*(A>>>16)&65535)<<16)&4294967295))+((58964+(R>>>16)&65535)<<16);switch($=0,y){case 3:$^=(255&a.charCodeAt(re+2))<<16;case 2:$^=(255&a.charCodeAt(re+1))<<8;case 1:A^=$=(65535&($=($=(65535&($^=255&a.charCodeAt(re)))*U+((($>>>16)*U&65535)<<16)&4294967295)<<15|$>>>17))*Z+((($>>>16)*Z&65535)<<16)&4294967295}return A^=a.length,A=2246822507*(65535&(A^=A>>>16))+((2246822507*(A>>>16)&65535)<<16)&4294967295,A=3266489909*(65535&(A^=A>>>13))+((3266489909*(A>>>16)&65535)<<16)&4294967295,(A^=A>>>16)>>>0}}),ei=xl(function(c){c.exports=function(a,p){for(var y,E=a.length,A=p^E,R=0;E>=4;)y=1540483477*(65535&(y=255&a.charCodeAt(R)|(255&a.charCodeAt(++R))<<8|(255&a.charCodeAt(++R))<<16|(255&a.charCodeAt(++R))<<24))+((1540483477*(y>>>16)&65535)<<16),A=1540483477*(65535&A)+((1540483477*(A>>>16)&65535)<<16)^(y=1540483477*(65535&(y^=y>>>24))+((1540483477*(y>>>16)&65535)<<16)),E-=4,++R;switch(E){case 3:A^=(255&a.charCodeAt(R+2))<<16;case 2:A^=(255&a.charCodeAt(R+1))<<8;case 1:A=1540483477*(65535&(A^=255&a.charCodeAt(R)))+((1540483477*(A>>>16)&65535)<<16)}return A=1540483477*(65535&(A^=A>>>13))+((1540483477*(A>>>16)&65535)<<16),(A^=A>>>15)>>>0}}),ci=Br,qa=ei;ci.murmur3=Br,ci.murmur2=qa;class ai{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(a,p,y,E){this.ids.push(Iu(a)),this.positions.push(p,y,E)}getPositions(a){const p=Iu(a);let y=0,E=this.ids.length-1;for(;y<E;){const R=y+E>>1;this.ids[R]>=p?E=R:y=R+1}const A=[];for(;this.ids[y]===p;)A.push({index:this.positions[3*y],start:this.positions[3*y+1],end:this.positions[3*y+2]}),y++;return A}static serialize(a,p){const y=new Float64Array(a.ids),E=new Uint32Array(a.positions);return Xu(y,E,0,y.length-1),p&&p.push(y.buffer,E.buffer),{ids:y,positions:E}}static deserialize(a){const p=new ai;return p.ids=a.ids,p.positions=a.positions,p.indexed=!0,p}}function Iu(c){const a=+c;return!isNaN(a)&&a<=Wt?a:ci(String(c))}function Xu(c,a,p,y){for(;p<y;){const E=c[p+y>>1];let A=p-1,R=y+1;for(;;){do{A++}while(c[A]<E);do{R--}while(c[R]>E);if(A>=R)break;fc(c,A,R),fc(a,3*A,3*R),fc(a,3*A+1,3*R+1),fc(a,3*A+2,3*R+2)}R-p<y-R?(Xu(c,a,p,R),p=R+1):(Xu(c,a,R+1,y),y=R)}}function fc(c,a,p){const y=c[a];c[a]=c[p],c[p]=y}Zn("FeaturePositionMap",ai);class el{constructor(a,p){this.gl=a.gl,this.location=p}}class Sa extends el{constructor(a,p){super(a,p),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Mu extends el{constructor(a,p){super(a,p),this.current=[0,0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))}}class Gl extends el{constructor(a,p){super(a,p),this.current=Mn.transparent}set(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))}}const Id=new Float32Array(16),lf=new Float32Array(9),ao=new Float32Array(4);function hr(c){return[dt(255*c.r,255*c.g),dt(255*c.b,255*c.a)]}class ti{constructor(a,p,y){this.value=a,this.uniformNames=p.map(E=>`u_${E}`),this.type=y}setUniform(a,p,y){a.set(y.constantOr(this.value))}getBinding(a,p,y){return"color"===this.type?new Gl(a,p):new Sa(a,p)}}class wi{constructor(a,p){this.uniformNames=p.map(y=>`u_${y}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(a,p){this.pixelRatioFrom=p.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=p.tl.concat(p.br),this.patternTo=a.tl.concat(a.br)}setUniform(a,p,y,E){const A="u_pattern_to"===E||"u_dash_to"===E?this.patternTo:"u_pattern_from"===E||"u_dash_from"===E?this.patternFrom:"u_pixel_ratio_to"===E?this.pixelRatioTo:"u_pixel_ratio_from"===E?this.pixelRatioFrom:null;A&&a.set(A)}getBinding(a,p,y){return"u_pattern_from"===y||"u_pattern_to"===y||"u_dash_from"===y||"u_dash_to"===y?new Mu(a,p):new Sa(a,p)}}class Uo{constructor(a,p,y,E){this.expression=a,this.type=y,this.maxValue=0,this.paintVertexAttributes=p.map(A=>({name:`a_${A}`,type:"Float32",components:"color"===y?2:1,offset:0})),this.paintVertexArray=new E}populatePaintArray(a,p,y,E,A,R){const U=this.paintVertexArray.length,Z=this.expression.evaluate(new Q(0),p,{},A,E,R);this.paintVertexArray.resize(a),this._setPaintValue(U,a,Z)}updatePaintArray(a,p,y,E,A){const R=this.expression.evaluate({zoom:0},y,E,void 0,A);this._setPaintValue(a,p,R)}_setPaintValue(a,p,y){if("color"===this.type){const E=hr(y);for(let A=a;A<p;A++)this.paintVertexArray.emplace(A,E[0],E[1])}else{for(let E=a;E<p;E++)this.paintVertexArray.emplace(E,y);this.maxValue=Math.max(this.maxValue,Math.abs(y))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class To{constructor(a,p,y,E,A,R){this.expression=a,this.uniformNames=p.map(U=>`u_${U}_t`),this.type=y,this.useIntegerZoom=E,this.zoom=A,this.maxValue=0,this.paintVertexAttributes=p.map(U=>({name:`a_${U}`,type:"Float32",components:"color"===y?4:2,offset:0})),this.paintVertexArray=new R}populatePaintArray(a,p,y,E,A,R){const U=this.expression.evaluate(new Q(this.zoom),p,{},A,E,R),Z=this.expression.evaluate(new Q(this.zoom+1),p,{},A,E,R),$=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue($,a,U,Z)}updatePaintArray(a,p,y,E,A){const R=this.expression.evaluate({zoom:this.zoom},y,E,void 0,A),U=this.expression.evaluate({zoom:this.zoom+1},y,E,void 0,A);this._setPaintValue(a,p,R,U)}_setPaintValue(a,p,y,E){if("color"===this.type){const A=hr(y),R=hr(E);for(let U=a;U<p;U++)this.paintVertexArray.emplace(U,A[0],A[1],R[0],R[1])}else{for(let A=a;A<p;A++)this.paintVertexArray.emplace(A,y,E);this.maxValue=Math.max(this.maxValue,Math.abs(y),Math.abs(E))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,p){const y=this.useIntegerZoom?Math.floor(p.zoom):p.zoom,E=an(this.expression.interpolationFactor(y,this.zoom,this.zoom+1),0,1);a.set(E)}getBinding(a,p,y){return new Sa(a,p)}}class Qa{constructor(a,p,y,E,A,R,U){this.expression=a,this.type=y,this.useIntegerZoom=E,this.zoom=A,this.layerId=U,this.paintVertexAttributes=("array"===y?yr:Vn).members;for(let Z=0;Z<p.length;++Z);this.zoomInPaintVertexArray=new R,this.zoomOutPaintVertexArray=new R}populatePaintArray(a,p,y){const E=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(E,a,p.patterns&&p.patterns[this.layerId],y)}updatePaintArray(a,p,y,E,A,R){this._setPaintValues(a,p,y.patterns&&y.patterns[this.layerId],R)}_setPaintValues(a,p,y,E){if(!E||!y)return;const{min:A,mid:R,max:U}=y,Z=E[A],$=E[R],re=E[U];if(Z&&$&&re)for(let ae=a;ae<p;ae++)this._setPaintValue(this.zoomInPaintVertexArray,ae,$,Z),this._setPaintValue(this.zoomOutPaintVertexArray,ae,$,re)}_setPaintValue(a,p,y,E){a.emplace(p,y.tl[0],y.tl[1],y.br[0],y.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],y.pixelRatio,E.pixelRatio)}upload(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Vo{constructor(a,p,y=(()=>!0)){this.binders={},this._buffers=[];const E=[];for(const A in a.paint._values){if(!y(A))continue;const R=a.paint.get(A);if(!(R instanceof Pe&&wl(R.property.specification)))continue;const U=Go(A,a.type),Z=R.value,$=R.property.specification.type,re=R.property.useIntegerZoom,ae=R.property.specification["property-type"],ue="cross-faded"===ae||"cross-faded-data-driven"===ae,Ce="line-dasharray"===String(A)&&"constant"!==a.layout.get("line-cap").value.kind;if("constant"!==Z.kind||Ce)if("source"===Z.kind||Ce||ue){const ke=Ah(A,$,"source");this.binders[A]=ue?new Qa(Z,U,$,re,p,ke,a.id):new Uo(Z,U,$,ke),E.push(`/a_${A}`)}else{const ke=Ah(A,$,"composite");this.binders[A]=new To(Z,U,$,re,p,ke),E.push(`/z_${A}`)}else this.binders[A]=ue?new wi(Z.value,U):new ti(Z.value,U,$),E.push(`/u_${A}`)}this.cacheKey=E.sort().join("")}getMaxValue(a){const p=this.binders[a];return p instanceof Uo||p instanceof To?p.maxValue:0}populatePaintArrays(a,p,y,E,A,R){for(const U in this.binders){const Z=this.binders[U];(Z instanceof Uo||Z instanceof To||Z instanceof Qa)&&Z.populatePaintArray(a,p,y,E,A,R)}}setConstantPatternPositions(a,p){for(const y in this.binders){const E=this.binders[y];E instanceof wi&&E.setConstantPatternPositions(a,p)}}updatePaintArrays(a,p,y,E,A,R){let U=!1;for(const Z in a){const $=p.getPositions(Z);for(const re of $){const ae=y.feature(re.index);for(const ue in this.binders){const Ce=this.binders[ue];if((Ce instanceof Uo||Ce instanceof To||Ce instanceof Qa)&&!0===Ce.expression.isStateDependent){const ke=E.paint.get(ue);Ce.expression=ke.value,Ce.updatePaintArray(re.start,re.end,ae,a[Z],A,R),U=!0}}}}return U}defines(){const a=[];for(const p in this.binders){const y=this.binders[p];(y instanceof ti||y instanceof wi)&&a.push(...y.uniformNames.map(E=>`#define HAS_UNIFORM_${E}`))}return a}getBinderAttributes(){const a=[];for(const p in this.binders){const y=this.binders[p];if(y instanceof Uo||y instanceof To||y instanceof Qa)for(let E=0;E<y.paintVertexAttributes.length;E++)a.push(y.paintVertexAttributes[E].name)}return a}getBinderUniforms(){const a=[];for(const p in this.binders){const y=this.binders[p];if(y instanceof ti||y instanceof wi||y instanceof To)for(const E of y.uniformNames)a.push(E)}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a,p){const y=[];for(const E in this.binders){const A=this.binders[E];if(A instanceof ti||A instanceof wi||A instanceof To)for(const R of A.uniformNames)if(p[R]){const U=A.getBinding(a,p[R],R);y.push({name:R,property:E,binding:U})}}return y}setUniforms(a,p,y,E){for(const{name:A,property:R,binding:U}of p)this.binders[R].setUniform(U,E,y.get(R),A)}updatePaintBuffers(a){this._buffers=[];for(const p in this.binders){const y=this.binders[p];if(a&&y instanceof Qa){const E=2===a.fromScale?y.zoomInPaintVertexBuffer:y.zoomOutPaintVertexBuffer;E&&this._buffers.push(E)}else(y instanceof Uo||y instanceof To)&&y.paintVertexBuffer&&this._buffers.push(y.paintVertexBuffer)}}upload(a){for(const p in this.binders){const y=this.binders[p];(y instanceof Uo||y instanceof To||y instanceof Qa)&&y.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const p=this.binders[a];(p instanceof Uo||p instanceof To||p instanceof Qa)&&p.destroy()}}}class es{constructor(a,p,y=(()=>!0)){this.programConfigurations={};for(const E of a)this.programConfigurations[E.id]=new Vo(E,p,y);this.needsUpload=!1,this._featureMap=new ai,this._bufferOffset=0}populatePaintArrays(a,p,y,E,A,R,U){for(const Z in this.programConfigurations)this.programConfigurations[Z].populatePaintArrays(a,p,E,A,R,U);void 0!==p.id&&this._featureMap.add(p.id,y,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,p,y,E,A){for(const R of y)this.needsUpload=this.programConfigurations[R.id].updatePaintArrays(a,this._featureMap,p,R,E,A)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const p in this.programConfigurations)this.programConfigurations[p].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}const mc={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Go(c,a){return mc[c]||[c.replace(`${a}-`,"").replace(/-/g,"_")]}const su={"line-pattern":{source:wr,composite:wr},"fill-pattern":{source:wr,composite:wr},"fill-extrusion-pattern":{source:wr,composite:wr},"line-dasharray":{source:tr,composite:tr}},ms={color:{source:fe,composite:Ie},number:{source:O,composite:fe}};function Ah(c,a,p){const y=su[c];return y&&y[p]||ms[a][p]}Zn("ConstantBinder",ti),Zn("CrossFadedConstantBinder",wi),Zn("SourceExpressionBinder",Uo),Zn("CrossFadedCompositeBinder",Qa),Zn("CompositeExpressionBinder",To),Zn("ProgramConfiguration",Vo,{omit:["_buffers"]}),Zn("ProgramConfigurationSet",es);const ko="-transition";class na extends mt{constructor(a,p){if(super(),this.id=a.id,this.type=a.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==a.type&&(this.metadata=(a=a).metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,"background"!==a.type&&"sky"!==a.type&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter),p.layout&&(this._unevaluatedLayout=new Ee(p.layout)),p.paint)){this._transitionablePaint=new ge(p.paint);for(const y in a.paint)this.setPaintProperty(y,a.paint[y],{validate:!1});for(const y in a.layout)this.setLayoutProperty(y,a.layout[y],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Le(p.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(a){return"visibility"===a?this.visibility:this._unevaluatedLayout.getValue(a)}setLayoutProperty(a,p,y={}){null!=p&&this._validate(ih,`layers.${this.id}.layout.${a}`,a,p,y)||("visibility"!==a?this._unevaluatedLayout.setValue(a,p):this.visibility=p)}getPaintProperty(a){return Vt(a,ko)?this._transitionablePaint.getTransition(a.slice(0,-ko.length)):this._transitionablePaint.getValue(a)}setPaintProperty(a,p,y={}){if(null!=p&&this._validate(to,`layers.${this.id}.paint.${a}`,a,p,y))return!1;if(Vt(a,ko))return this._transitionablePaint.setTransition(a.slice(0,-ko.length),p||void 0),!1;{const E=this._transitionablePaint._values[a],A="cross-faded-data-driven"===E.property.specification["property-type"],R=E.value.isDataDriven(),U=E.value;this._transitionablePaint.setValue(a,p),this._handleSpecialPaintPropertyUpdate(a);const Z=this._transitionablePaint._values[a].value;return Z.isDataDriven()||R||A||this._handleOverridablePaintPropertyUpdate(a,U,Z)}}_handleSpecialPaintPropertyUpdate(a){}getProgramIds(){return null}getProgramConfiguration(a){return null}_handleOverridablePaintPropertyUpdate(a,p,y){return!1}isHidden(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||"none"===this.visibility}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(a,p){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,p)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,p)}serialize(){const a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),fr(a,(p,y)=>!(void 0===p||"layout"===y&&!Object.keys(p).length||"paint"===y&&!Object.keys(p).length))}_validate(a,p,y,E,A={}){return(!A||!1!==A.validate)&&Yo(this,a.call(uc,{key:p,layerType:this.type,objectKey:y,value:E,styleSpec:Je,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const a in this.paint._values){const p=this.paint.get(a);if(p instanceof Pe&&wl(p.property.specification)&&("source"===p.value.kind||"composite"===p.value.kind)&&p.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Sl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Au=ft([{name:"a_pos",components:2,type:"Int16"}],4),{members:Md}=Au;class Zs{constructor(a=[]){this.segments=a}prepareSegment(a,p,y,E){let A=this.segments[this.segments.length-1];return a>Zs.MAX_VERTEX_ARRAY_LENGTH&&Ui(`Max vertices per segment is ${Zs.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}`),(!A||A.vertexLength+a>Zs.MAX_VERTEX_ARRAY_LENGTH||A.sortKey!==E)&&(A={vertexOffset:p.length,primitiveOffset:y.length,vertexLength:0,primitiveLength:0},void 0!==E&&(A.sortKey=E),this.segments.push(A)),A}get(){return this.segments}destroy(){for(const a of this.segments)for(const p in a.vaos)a.vaos[p].destroy()}static simpleSegment(a,p,y,E){return new Zs([{vertexOffset:a,primitiveOffset:p,vertexLength:y,primitiveLength:E,vaos:{},sortKey:0}])}}Zs.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zn("SegmentVector",Zs);var Bi=8192;class Ad{constructor(a,p){a&&(p?this.setSouthWest(a).setNorthEast(p):4===a.length?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))}setNorthEast(a){return this._ne=a instanceof qo?new qo(a.lng,a.lat):qo.convert(a),this}setSouthWest(a){return this._sw=a instanceof qo?new qo(a.lng,a.lat):qo.convert(a),this}extend(a){const p=this._sw,y=this._ne;let E,A;if(a instanceof qo)E=a,A=a;else{if(!(a instanceof Ad))return Array.isArray(a)?4===a.length||a.every(Array.isArray)?this.extend(Ad.convert(a)):this.extend(qo.convert(a)):this;if(E=a._sw,A=a._ne,!E||!A)return this}return p||y?(p.lng=Math.min(E.lng,p.lng),p.lat=Math.min(E.lat,p.lat),y.lng=Math.max(A.lng,y.lng),y.lat=Math.max(A.lat,y.lat)):(this._sw=new qo(E.lng,E.lat),this._ne=new qo(A.lng,A.lat)),this}getCenter(){return new qo((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new qo(this.getWest(),this.getNorth())}getSouthEast(){return new qo(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(a){const{lng:p,lat:y}=qo.convert(a);let E=this._sw.lng<=p&&p<=this._ne.lng;return this._sw.lng>this._ne.lng&&(E=this._sw.lng>=p&&p>=this._ne.lng),this._sw.lat<=y&&y<=this._ne.lat&&E}static convert(a){return!a||a instanceof Ad?a:new Ad(a)}}const mv=6371008.8;class qo{constructor(a,p){if(isNaN(a)||isNaN(p))throw new Error(`Invalid LngLat object: (${a}, ${p})`);if(this.lng=+a,this.lat=+p,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new qo(Rn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const p=Math.PI/180,y=this.lat*p,E=a.lat*p,A=Math.sin(y)*Math.sin(E)+Math.cos(y)*Math.cos(E)*Math.cos((a.lng-this.lng)*p);return mv*Math.acos(Math.min(A,1))}toBounds(a=0){const p=360*a/40075017,y=p/Math.cos(Math.PI/180*this.lat);return new Ad(new qo(this.lng-y,this.lat-p),new qo(this.lng+y,this.lat+p))}static convert(a){if(a instanceof qo)return a;if(Array.isArray(a)&&(2===a.length||3===a.length))return new qo(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&"object"==typeof a&&null!==a)return new qo(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const gv=2*Math.PI*mv;function yv(c){return gv*Math.cos(c*Math.PI/180)}function dy(c){return(180+c)/360}function Du(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function wg(c,a){return c/yv(a)}function Dh(c){return 360*c-180}function Dd(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Im(c,a){return c*yv(Dd(a))}const od=85.051129;class kh{constructor(a,p,y=0){this.x=+a,this.y=+p,this.z=+y}static fromLngLat(a,p=0){const y=qo.convert(a);return new kh(dy(y.lng),Du(y.lat),wg(p,y.lat))}toLngLat(){return new qo(Dh(this.x),Dd(this.y))}toAltitude(){return Im(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/gv*(a=Dd(this.y),1/Math.cos(a*Math.PI/180));var a}}function vv(c,a,p,y,E,A,R,U,Z){const $=(a+y)/2,re=(p+E)/2,ae=new it($,re);U(ae),function(ue,Ce,ke,Ve,We,rt){const ht=ke-We,vt=Ve-rt;return Math.abs((Ve-Ce)*ht-(ke-ue)*vt)/Math.hypot(ht,vt)}(ae.x,ae.y,A.x,A.y,R.x,R.y)>=Z?(vv(c,a,p,$,re,A,ae,U,Z),vv(c,$,re,y,E,ae,R,U,Z)):c.push(R)}function vx(c,a,p){const y=[];let E,A,R;for(const U of c){const{x:Z,y:$}=U;a(U),R?vv(y,E,A,Z,$,R,U,a,p):y.push(U),E=Z,A=$,R=U}return y}const _v=Math.pow(2,14)-1,xv=-_v-1;function fy(c,a){const p=Math.round(c.x*a),y=Math.round(c.y*a);return c.x=an(p,xv,_v),c.y=an(y,xv,_v),(p<c.x||p>c.x+1||y<c.y||y>c.y+1)&&Ui("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function gc(c,a,p){const y=c.loadGeometry(),E=c.extent,A=Bi/E;if(a&&p&&"mercator"!==p.projection.name){const R=1<<a.z,{scale:U,x:Z,y:$,projection:re}=p,ae=ue=>{const Ce=Dh((a.x+ue.x/E)/R),ke=Dd((a.y+ue.y/E)/R),Ve=re.project(Ce,ke);ue.x=(Ve.x*U-Z)*E,ue.y=(Ve.y*U-$)*E};for(let ue=0;ue<y.length;ue++)if(1!==c.type)y[ue]=vx(y[ue],ae,1);else{const Ce=[];for(const ke of y[ue])ke.x<0||ke.x>=E||ke.y<0||ke.y>=E||(ae(ke),Ce.push(ke));y[ue]=Ce}}for(const R of y)for(const U of R)fy(U,A);return y}function Mm(c,a){return{type:c.type,id:c.id,properties:c.properties,geometry:a?gc(c):[]}}function uf(c,a,p,y,E){c.emplaceBack(2*a+(y+1)/2,2*p+(E+1)/2)}class Am{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(p=>p.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Qt,this.indexArray=new Ko,this.segments=new Zs,this.programConfigurations=new es(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id)}populate(a,p,y,E){const A=this.layers[0],R=[];let U=null;"circle"===A.type&&(U=A.layout.get("circle-sort-key"));for(const{feature:Z,id:$,index:re,sourceLayerIndex:ae}of a){const ue=this.layers[0]._featureFilter.needGeometry,Ce=Mm(Z,ue);if(!this.layers[0]._featureFilter.filter(new Q(this.zoom),Ce,y))continue;const ke=U?U.evaluate(Ce,{},y):void 0,Ve={id:$,properties:Z.properties,type:Z.type,sourceLayerIndex:ae,index:re,geometry:ue?Ce.geometry:gc(Z,y,E),patterns:{},sortKey:ke};R.push(Ve)}U&&R.sort((Z,$)=>Z.sortKey-$.sortKey);for(const Z of R){const{geometry:$,index:re,sourceLayerIndex:ae}=Z,ue=a[re].feature;this.addFeature(Z,$,re,p.availableImages,y),p.featureIndex.insert(ue,$,re,ae,this.index)}}update(a,p,y,E){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,p,this.stateDependentLayers,y,E)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Md),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,p,y,E,A){for(const R of p)for(const U of R){const Z=U.x,$=U.y;if(Z<0||Z>=Bi||$<0||$>=Bi)continue;const re=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),ae=re.vertexLength;uf(this.layoutVertexArray,Z,$,-1,-1),uf(this.layoutVertexArray,Z,$,1,-1),uf(this.layoutVertexArray,Z,$,1,1),uf(this.layoutVertexArray,Z,$,-1,1),this.indexArray.emplaceBack(ae,ae+1,ae+2),this.indexArray.emplaceBack(ae,ae+3,ae+2),re.vertexLength+=4,re.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,y,{},E,A)}}function Dm(c,a){for(let p=0;p<c.length;p++)if(Xn(a,c[p]))return!0;for(let p=0;p<a.length;p++)if(Xn(c,a[p]))return!0;return!!my(c,a)}function _x(c,a,p){return!!Xn(c,a)||!!zp(a,c,p)}function B_(c,a){if(1===c.length)return j_(a,c[0]);for(let p=0;p<a.length;p++){const y=a[p];for(let E=0;E<y.length;E++)if(Xn(c,y[E]))return!0}for(let p=0;p<c.length;p++)if(j_(a,c[p]))return!0;for(let p=0;p<a.length;p++)if(my(c,a[p]))return!0;return!1}function km(c,a,p){if(c.length>1){if(my(c,a))return!0;for(let y=0;y<a.length;y++)if(zp(a[y],c,p))return!0}for(let y=0;y<c.length;y++)if(zp(c[y],a,p))return!0;return!1}function my(c,a){if(0===c.length||0===a.length)return!1;for(let p=0;p<c.length-1;p++){const y=c[p],E=c[p+1];for(let A=0;A<a.length-1;A++)if(bv(y,E,a[A],a[A+1]))return!0}return!1}function bv(c,a,p,y){return Wo(c,p,y)!==Wo(a,p,y)&&Wo(c,a,p)!==Wo(c,a,y)}function zp(c,a,p){const y=p*p;if(1===a.length)return c.distSqr(a[0])<y;for(let E=1;E<a.length;E++)if(Jh(c,a[E-1],a[E])<y)return!0;return!1}function Jh(c,a,p){const y=a.distSqr(p);if(0===y)return c.distSqr(a);const E=((c.x-a.x)*(p.x-a.x)+(c.y-a.y)*(p.y-a.y))/y;return c.distSqr(E<0?a:E>1?p:p.sub(a)._mult(E)._add(a))}function j_(c,a){let p,y,E,A=!1;for(let R=0;R<c.length;R++){p=c[R];for(let U=0,Z=p.length-1;U<p.length;Z=U++)y=p[U],E=p[Z],y.y>a.y!=E.y>a.y&&a.x<(E.x-y.x)*(a.y-y.y)/(E.y-y.y)+y.x&&(A=!A)}return A}function Xn(c,a){let p=!1;for(let y=0,E=c.length-1;y<c.length;E=y++){const A=c[y],R=c[E];A.y>a.y!=R.y>a.y&&a.x<(R.x-A.x)*(a.y-A.y)/(R.y-A.y)+A.x&&(p=!p)}return p}function wv(c,a,p,y,E){for(const R of c)if(a<=R.x&&p<=R.y&&y>=R.x&&E>=R.y)return!0;const A=[new it(a,p),new it(a,E),new it(y,E),new it(y,p)];if(c.length>2)for(const R of A)if(Xn(c,R))return!0;for(let R=0;R<c.length-1;R++)if(gy(c[R],c[R+1],A))return!0;return!1}function gy(c,a,p){const y=p[0],E=p[2];if(c.x<y.x&&a.x<y.x||c.x>E.x&&a.x>E.x||c.y<y.y&&a.y<y.y||c.y>E.y&&a.y>E.y)return!1;const A=Wo(c,a,p[0]);return A!==Wo(c,a,p[1])||A!==Wo(c,a,p[2])||A!==Wo(c,a,p[3])}function kd(c,a,p){const y=a.paint.get(c).value;return"constant"===y.kind?y.value:p.programConfigurations.get(a.id).getMaxValue(c)}function cf(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function U_(c,a,p,y,E){if(!a[0]&&!a[1])return c;const A=it.convert(a)._mult(E);"viewport"===p&&A._rotate(-y);const R=[];for(let U=0;U<c.length;U++)R.push(c[U].sub(A));return R}function V_(c,a,p,y){const E=it.convert(c)._mult(y);return"viewport"===a&&E._rotate(-p),E}Zn("CircleBucket",Am,{omit:["layers"]});const xx=new Ot({"circle-sort-key":new Ue(Je.layout_circle["circle-sort-key"])});var Pm={paint:new Ot({"circle-radius":new Ue(Je.paint_circle["circle-radius"]),"circle-color":new Ue(Je.paint_circle["circle-color"]),"circle-blur":new Ue(Je.paint_circle["circle-blur"]),"circle-opacity":new Ue(Je.paint_circle["circle-opacity"]),"circle-translate":new Me(Je.paint_circle["circle-translate"]),"circle-translate-anchor":new Me(Je.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Me(Je.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Me(Je.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ue(Je.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ue(Je.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ue(Je.paint_circle["circle-stroke-opacity"])}),layout:xx},po="undefined"!=typeof Float32Array?Float32Array:Array;function Cv(){var c=new po(9);return po!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function Pd(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function Ev(c,a,p){var y=a[0],E=a[1],A=a[2],R=a[3],U=a[4],Z=a[5],$=a[6],re=a[7],ae=a[8],ue=a[9],Ce=a[10],ke=a[11],Ve=a[12],We=a[13],rt=a[14],ht=a[15],vt=p[0],Tt=p[1],Ct=p[2],kt=p[3];return c[0]=vt*y+Tt*U+Ct*ae+kt*Ve,c[1]=vt*E+Tt*Z+Ct*ue+kt*We,c[2]=vt*A+Tt*$+Ct*Ce+kt*rt,c[3]=vt*R+Tt*re+Ct*ke+kt*ht,c[4]=(vt=p[4])*y+(Tt=p[5])*U+(Ct=p[6])*ae+(kt=p[7])*Ve,c[5]=vt*E+Tt*Z+Ct*ue+kt*We,c[6]=vt*A+Tt*$+Ct*Ce+kt*rt,c[7]=vt*R+Tt*re+Ct*ke+kt*ht,c[8]=(vt=p[8])*y+(Tt=p[9])*U+(Ct=p[10])*ae+(kt=p[11])*Ve,c[9]=vt*E+Tt*Z+Ct*ue+kt*We,c[10]=vt*A+Tt*$+Ct*Ce+kt*rt,c[11]=vt*R+Tt*re+Ct*ke+kt*ht,c[12]=(vt=p[12])*y+(Tt=p[13])*U+(Ct=p[14])*ae+(kt=p[15])*Ve,c[13]=vt*E+Tt*Z+Ct*ue+kt*We,c[14]=vt*A+Tt*$+Ct*Ce+kt*rt,c[15]=vt*R+Tt*re+Ct*ke+kt*ht,c}Math.hypot||(Math.hypot=function(){for(var c=0,a=arguments.length;a--;)c+=arguments[a]*arguments[a];return Math.sqrt(c)});var G_=Ev;function Gf(){var c=new po(3);return po!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function Cg(c){return Math.hypot(c[0],c[1],c[2])}function qf(c,a,p){var y=new po(3);return y[0]=c,y[1]=a,y[2]=p,y}function q_(c,a,p){return c[0]=a[0]-p[0],c[1]=a[1]-p[1],c[2]=a[2]-p[2],c}function Sv(c,a,p){return c[0]=a[0]*p[0],c[1]=a[1]*p[1],c[2]=a[2]*p[2],c}function Zf(c,a,p,y){return c[0]=a[0]+p[0]*y,c[1]=a[1]+p[1]*y,c[2]=a[2]+p[2]*y,c}function Rm(c,a){var p=a[0],y=a[1],E=a[2],A=p*p+y*y+E*E;return A>0&&(A=1/Math.sqrt(A)),c[0]=a[0]*A,c[1]=a[1]*A,c[2]=a[2]*A,c}function Om(c,a,p){var y=p[0],E=p[1],A=p[2],R=a[0],U=a[1],Z=a[2],$=E*Z-A*U,re=A*R-y*Z,ae=y*U-E*R,ue=E*ae-A*re,Ce=A*$-y*ae,ke=y*re-E*$,Ve=2*p[3];return re*=Ve,ae*=Ve,Ce*=2,ke*=2,c[0]=R+($*=Ve)+(ue*=2),c[1]=U+re+Ce,c[2]=Z+ae+ke,c}var Eg,c,Tv=q_,yy=Sv,Fa=Cg;function Lm(c,a,p){var y=a[0],E=a[1],A=a[2],R=a[3];return c[0]=p[0]*y+p[4]*E+p[8]*A+p[12]*R,c[1]=p[1]*y+p[5]*E+p[9]*A+p[13]*R,c[2]=p[2]*y+p[6]*E+p[10]*A+p[14]*R,c[3]=p[3]*y+p[7]*E+p[11]*A+p[15]*R,c}function Np(){var c=new po(4);return po!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function Hf(c){return c[0]=0,c[1]=0,c[2]=0,c[3]=1,c}function Fm(c,a,p){p*=.5;var y=a[0],E=a[1],A=a[2],R=a[3],U=Math.sin(p),Z=Math.cos(p);return c[0]=y*Z+R*U,c[1]=E*Z+A*U,c[2]=A*Z-E*U,c[3]=R*Z-y*U,c}function vy(c,a){return c[0]===a[0]&&c[1]===a[1]}function Wf(c,a,p,y,E,A,R,U,Z){if(A&&c.queryGeometry.isAboveHorizon)return!1;A&&(Z*=c.pixelToTileUnitsFactor);for(const $ of a)for(const re of $){const ae=re.add(U),ue=E&&p.elevation?p.elevation.exaggeration()*E.getElevationAt(ae.x,ae.y,!0):0,Ce=A?ae:bx(ae,ue,y),ke=A?c.tilespaceRays.map(We=>_y(We,ue)):c.queryGeometry.screenGeometry,Ve=Lm([],[re.x,re.y,ue,1],y);if(!R&&A?Z*=Ve[3]/p.cameraToCenterDistance:R&&!A&&(Z*=p.cameraToCenterDistance/Ve[3]),_x(ke,Ce,Z))return!0}return!1}function bx(c,a,p){const y=Lm([],[c.x,c.y,a,1],p);return new it(y[0]/y[3],y[1]/y[3])}Gf(),Eg=new po(4),po!=Float32Array&&(Eg[0]=0,Eg[1]=0,Eg[2]=0,Eg[3]=0),Gf(),qf(1,0,0),qf(0,1,0),Np(),Np(),Cv(),c=new po(2),po!=Float32Array&&(c[0]=0,c[1]=0);const Z_=qf(0,0,0),J1=qf(0,0,1);function _y(c,a){const p=Gf();return Z_[2]=a,c.intersectsPlane(Z_,J1,p),new it(p[0],p[1])}class xy extends Am{}function by(c,{width:a,height:p},y,E){if(E){if(E instanceof Uint8ClampedArray)E=new Uint8Array(E.buffer);else if(E.length!==a*p*y)throw new RangeError("mismatched image size")}else E=new Uint8Array(a*p*y);return c.width=a,c.height=p,c.data=E,c}function Iv(c,{width:a,height:p},y){if(a===c.width&&p===c.height)return;const E=by({},{width:a,height:p},y);$f(c,E,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,a),height:Math.min(c.height,p)},y),c.width=a,c.height=p,c.data=E.data}function $f(c,a,p,y,E,A){if(0===E.width||0===E.height)return a;if(E.width>c.width||E.height>c.height||p.x>c.width-E.width||p.y>c.height-E.height)throw new RangeError("out of range source coordinates for image copy");if(E.width>a.width||E.height>a.height||y.x>a.width-E.width||y.y>a.height-E.height)throw new RangeError("out of range destination coordinates for image copy");const R=c.data,U=a.data;for(let Z=0;Z<E.height;Z++){const $=((p.y+Z)*c.width+p.x)*A,re=((y.y+Z)*a.width+y.x)*A;for(let ae=0;ae<E.width*A;ae++)U[re+ae]=R[$+ae]}return a}Zn("HeatmapBucket",xy,{omit:["layers"]});class Ph{constructor(a,p){by(this,a,1,p)}resize(a){Iv(this,a,1)}clone(){return new Ph({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,p,y,E,A){$f(a,p,y,E,A,1)}}class Rh{constructor(a,p){by(this,a,4,p)}resize(a){Iv(this,a,4)}replace(a,p){p?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new Rh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,p,y,E,A){$f(a,p,y,E,A,4)}}Zn("AlphaImage",Ph),Zn("RGBAImage",Rh);var wx={paint:new Ot({"heatmap-radius":new Ue(Je.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ue(Je.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Me(Je.paint_heatmap["heatmap-intensity"]),"heatmap-color":new gt(Je.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Me(Je.paint_heatmap["heatmap-opacity"])})};function Mv(c){const a={},p=c.resolution||256,y=c.clips?c.clips.length:1,E=c.image||new Rh({width:p,height:y}),A=(R,U,Z)=>{a[c.evaluationKey]=Z;const $=c.expression.evaluate(a);E.data[R+U+0]=Math.floor(255*$.r/$.a),E.data[R+U+1]=Math.floor(255*$.g/$.a),E.data[R+U+2]=Math.floor(255*$.b/$.a),E.data[R+U+3]=Math.floor(255*$.a)};if(c.clips)for(let R=0,U=0;R<y;++R,U+=4*p)for(let Z=0,$=0;Z<p;Z++,$+=4){const re=Z/(p-1),{start:ae,end:ue}=c.clips[R];A(U,$,ae*(1-re)+ue*re)}else for(let R=0,U=0;R<p;R++,U+=4)A(0,U,R/(p-1));return E}var Cx={paint:new Ot({"hillshade-illumination-direction":new Me(Je.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Me(Je.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Me(Je.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Me(Je.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Me(Je.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Me(Je.paint_hillshade["hillshade-accent-color"])})};const H_=ft([{name:"a_pos",components:2,type:"Int16"}],4),{members:Bp}=H_;var dp=zc,Sg=zc;function zc(c,a,p){p=p||2;var y,E,A,R,U,Z,$,re=a&&a.length,ae=re?a[0]*p:c.length,ue=zm(c,0,ae,p,!0),Ce=[];if(!ue||ue.next===ue.prev)return Ce;if(re&&(ue=function(Ve,We,rt,ht){var vt,Tt,Ct,kt=[];for(vt=0,Tt=We.length;vt<Tt;vt++)(Ct=zm(Ve,We[vt]*ht,vt<Tt-1?We[vt+1]*ht:Ve.length,ht,!1))===Ct.next&&(Ct.steiner=!0),kt.push(wy(Ct));for(kt.sort(Ex),vt=0;vt<kt.length;vt++)rt=tl(rt=X_(kt[vt],rt),rt.next);return rt}(c,a,ue,p)),c.length>80*p){y=A=c[0],E=R=c[1];for(var ke=p;ke<ae;ke+=p)(U=c[ke])<y&&(y=U),(Z=c[ke+1])<E&&(E=Z),U>A&&(A=U),Z>R&&(R=Z);$=0!==($=Math.max(A-y,R-E))?1/$:0}return Xf(ue,Ce,p,y,E,$),Ce}function zm(c,a,p,y,E){var A,R;if(E===Dv(c,a,p,y)>0)for(A=a;A<p;A+=y)R=Ag(A,c[A],c[A+1],R);else for(A=p-y;A>=a;A-=y)R=Ag(A,c[A],c[A+1],R);return R&&Nm(R,R.next)&&(Yf(R),R=R.next),R}function tl(c,a){if(!c)return c;a||(a=c);var p,y=c;do{if(p=!1,y.steiner||!Nm(y,y.next)&&0!==Za(y.prev,y,y.next))y=y.next;else{if(Yf(y),(y=a=y.prev)===y.next)break;p=!0}}while(p||y!==a);return a}function Xf(c,a,p,y,E,A,R){if(c){!R&&A&&function(re,ae,ue,Ce){var ke=re;do{null===ke.z&&(ke.z=Tg(ke.x,ke.y,ae,ue,Ce)),ke.prevZ=ke.prev,ke.nextZ=ke.next,ke=ke.next}while(ke!==re);ke.prevZ.nextZ=null,ke.prevZ=null,function(Ve){var We,rt,ht,vt,Tt,Ct,kt,ln,Yt=1;do{for(rt=Ve,Ve=null,Tt=null,Ct=0;rt;){for(Ct++,ht=rt,kt=0,We=0;We<Yt&&(kt++,ht=ht.nextZ);We++);for(ln=Yt;kt>0||ln>0&&ht;)0!==kt&&(0===ln||!ht||rt.z<=ht.z)?(vt=rt,rt=rt.nextZ,kt--):(vt=ht,ht=ht.nextZ,ln--),Tt?Tt.nextZ=vt:Ve=vt,vt.prevZ=Tt,Tt=vt;rt=ht}Tt.nextZ=null,Yt*=2}while(Ct>1)}(ke)}(c,y,E,A);for(var U,Z,$=c;c.prev!==c.next;)if(U=c.prev,Z=c.next,A?Nc(c,y,E,A):Av(c))a.push(U.i/p),a.push(c.i/p),a.push(Z.i/p),Yf(c),c=Z.next,$=Z.next;else if((c=Z)===$){R?1===R?Xf(c=W_(tl(c),a,p),a,p,y,E,A,2):2===R&&$_(c,a,p,y,E,A):Xf(tl(c),a,p,y,E,A,1);break}}}function Av(c){var a=c.prev,p=c,y=c.next;if(Za(a,p,y)>=0)return!1;for(var E=c.next.next;E!==c.prev;){if(hf(a.x,a.y,p.x,p.y,y.x,y.y,E.x,E.y)&&Za(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function Nc(c,a,p,y){var E=c.prev,A=c,R=c.next;if(Za(E,A,R)>=0)return!1;for(var U=E.x>A.x?E.x>R.x?E.x:R.x:A.x>R.x?A.x:R.x,Z=E.y>A.y?E.y>R.y?E.y:R.y:A.y>R.y?A.y:R.y,$=Tg(E.x<A.x?E.x<R.x?E.x:R.x:A.x<R.x?A.x:R.x,E.y<A.y?E.y<R.y?E.y:R.y:A.y<R.y?A.y:R.y,a,p,y),re=Tg(U,Z,a,p,y),ae=c.prevZ,ue=c.nextZ;ae&&ae.z>=$&&ue&&ue.z<=re;){if(ae!==c.prev&&ae!==c.next&&hf(E.x,E.y,A.x,A.y,R.x,R.y,ae.x,ae.y)&&Za(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,ue!==c.prev&&ue!==c.next&&hf(E.x,E.y,A.x,A.y,R.x,R.y,ue.x,ue.y)&&Za(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;ae&&ae.z>=$;){if(ae!==c.prev&&ae!==c.next&&hf(E.x,E.y,A.x,A.y,R.x,R.y,ae.x,ae.y)&&Za(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;ue&&ue.z<=re;){if(ue!==c.prev&&ue!==c.next&&hf(E.x,E.y,A.x,A.y,R.x,R.y,ue.x,ue.y)&&Za(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function W_(c,a,p){var y=c;do{var E=y.prev,A=y.next.next;!Nm(E,A)&&Cy(E,y,y.next,A)&&Mg(E,A)&&Mg(A,E)&&(a.push(E.i/p),a.push(y.i/p),a.push(A.i/p),Yf(y),Yf(y.next),y=c=A),y=y.next}while(y!==c);return tl(y)}function $_(c,a,p,y,E,A){var R=c;do{for(var U=R.next.next;U!==R.prev;){if(R.i!==U.i&&lh(R,U)){var Z=K_(R,U);return R=tl(R,R.next),Z=tl(Z,Z.next),Xf(R,a,p,y,E,A),void Xf(Z,a,p,y,E,A)}U=U.next}R=R.next}while(R!==c)}function Ex(c,a){return c.x-a.x}function X_(c,a){var p=function(A,R){var U,Z=R,$=A.x,re=A.y,ae=-1/0;do{if(re<=Z.y&&re>=Z.next.y&&Z.next.y!==Z.y){var ue=Z.x+(re-Z.y)*(Z.next.x-Z.x)/(Z.next.y-Z.y);if(ue<=$&&ue>ae){if(ae=ue,ue===$){if(re===Z.y)return Z;if(re===Z.next.y)return Z.next}U=Z.x<Z.next.x?Z:Z.next}}Z=Z.next}while(Z!==R);if(!U)return null;if($===ae)return U;var Ce,ke=U,Ve=U.x,We=U.y,rt=1/0;Z=U;do{$>=Z.x&&Z.x>=Ve&&$!==Z.x&&hf(re<We?$:ae,re,Ve,We,re<We?ae:$,re,Z.x,Z.y)&&(Ce=Math.abs(re-Z.y)/($-Z.x),Mg(Z,A)&&(Ce<rt||Ce===rt&&(Z.x>U.x||Z.x===U.x&&Y_(U,Z)))&&(U=Z,rt=Ce)),Z=Z.next}while(Z!==ke);return U}(c,a);if(!p)return a;var y=K_(p,c),E=tl(p,p.next);return tl(y,y.next),a===p?E:a}function Y_(c,a){return Za(c.prev,c,a.prev)<0&&Za(a.next,c,c.next)<0}function Tg(c,a,p,y,E){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=32767*(c-p)*E)|c<<8))|c<<4))|c<<2))|c<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-y)*E)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function wy(c){var a=c,p=c;do{(a.x<p.x||a.x===p.x&&a.y<p.y)&&(p=a),a=a.next}while(a!==c);return p}function hf(c,a,p,y,E,A,R,U){return(E-R)*(a-U)-(c-R)*(A-U)>=0&&(c-R)*(y-U)-(p-R)*(a-U)>=0&&(p-R)*(A-U)-(E-R)*(y-U)>=0}function lh(c,a){return c.next.i!==a.i&&c.prev.i!==a.i&&!function(p,y){var E=p;do{if(E.i!==p.i&&E.next.i!==p.i&&E.i!==y.i&&E.next.i!==y.i&&Cy(E,E.next,p,y))return!0;E=E.next}while(E!==p);return!1}(c,a)&&(Mg(c,a)&&Mg(a,c)&&function(p,y){var E=p,A=!1,R=(p.x+y.x)/2,U=(p.y+y.y)/2;do{E.y>U!=E.next.y>U&&E.next.y!==E.y&&R<(E.next.x-E.x)*(U-E.y)/(E.next.y-E.y)+E.x&&(A=!A),E=E.next}while(E!==p);return A}(c,a)&&(Za(c.prev,c,a.prev)||Za(c,a.prev,a))||Nm(c,a)&&Za(c.prev,c,c.next)>0&&Za(a.prev,a,a.next)>0)}function Za(c,a,p){return(a.y-c.y)*(p.x-a.x)-(a.x-c.x)*(p.y-a.y)}function Nm(c,a){return c.x===a.x&&c.y===a.y}function Cy(c,a,p,y){var E=Ey(Za(c,a,p)),A=Ey(Za(c,a,y)),R=Ey(Za(p,y,c)),U=Ey(Za(p,y,a));return E!==A&&R!==U||!(0!==E||!Ig(c,p,a))||!(0!==A||!Ig(c,y,a))||!(0!==R||!Ig(p,c,y))||!(0!==U||!Ig(p,a,y))}function Ig(c,a,p){return a.x<=Math.max(c.x,p.x)&&a.x>=Math.min(c.x,p.x)&&a.y<=Math.max(c.y,p.y)&&a.y>=Math.min(c.y,p.y)}function Ey(c){return c>0?1:c<0?-1:0}function Mg(c,a){return Za(c.prev,c,c.next)<0?Za(c,a,c.next)>=0&&Za(c,c.prev,a)>=0:Za(c,a,c.prev)<0||Za(c,c.next,a)<0}function K_(c,a){var p=new Dg(c.i,c.x,c.y),y=new Dg(a.i,a.x,a.y),E=c.next,A=a.prev;return c.next=a,a.prev=c,p.next=E,E.prev=p,y.next=p,p.prev=y,A.next=y,y.prev=A,y}function Ag(c,a,p,y){var E=new Dg(c,a,p);return y?(E.next=y.next,E.prev=y,y.next.prev=E,y.next=E):(E.prev=E,E.next=E),E}function Yf(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Dg(c,a,p){this.i=c,this.x=a,this.y=p,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Dv(c,a,p,y){for(var E=0,A=a,R=p-y;A<p;A+=y)E+=(c[R]-c[A])*(c[A+1]+c[R+1]),R=A;return E}function Sx(c,a,p,y,E){Bm(c,a,p||0,y||c.length-1,E||Sy)}function Bm(c,a,p,y,E){for(;y>p;){if(y-p>600){var A=y-p+1,R=a-p+1,U=Math.log(A),Z=.5*Math.exp(2*U/3),$=.5*Math.sqrt(U*Z*(A-Z)/A)*(R-A/2<0?-1:1);Bm(c,a,Math.max(p,Math.floor(a-R*Z/A+$)),Math.min(y,Math.floor(a+(A-R)*Z/A+$)),E)}var re=c[a],ae=p,ue=y;for(jm(c,p,a),E(c[y],re)>0&&jm(c,p,y);ae<ue;){for(jm(c,ae,ue),ae++,ue--;E(c[ae],re)<0;)ae++;for(;E(c[ue],re)>0;)ue--}0===E(c[p],re)?jm(c,p,ue):jm(c,++ue,y),ue<=a&&(p=ue+1),a<=ue&&(y=ue-1)}}function jm(c,a,p){var y=c[a];c[a]=c[p],c[p]=y}function Sy(c,a){return c<a?-1:c>a?1:0}function Um(c,a){const p=c.length;if(p<=1)return[c];const y=[];let E,A;for(let R=0;R<p;R++){const U=Xi(c[R]);0!==U&&(c[R].area=Math.abs(U),void 0===A&&(A=U<0),A===U<0?(E&&y.push(E),E=[c[R]]):E.push(c[R]))}if(E&&y.push(E),a>1)for(let R=0;R<y.length;R++)y[R].length<=a||(Sx(y[R],a,1,y[R].length-1,Ty),y[R]=y[R].slice(0,a));return y}function Ty(c,a){return a.area-c.area}function Rd(c,a,p){const y=p.patternDependencies;let E=!1;for(const A of a){const R=A.paint.get(`${c}-pattern`);R.isConstant()||(E=!0);const U=R.constantOr(null);U&&(E=!0,y[U.to]=!0,y[U.from]=!0)}return E}function Vm(c,a,p,y,E){const A=E.patternDependencies;for(const R of a){const U=R.paint.get(`${c}-pattern`).value;if("constant"!==U.kind){let Z=U.evaluate({zoom:y-1},p,{},E.availableImages),$=U.evaluate({zoom:y},p,{},E.availableImages),re=U.evaluate({zoom:y+1},p,{},E.availableImages);Z=Z&&Z.name?Z.name:Z,$=$&&$.name?$.name:$,re=re&&re.name?re.name:re,A[Z]=!0,A[$]=!0,A[re]=!0,p.patterns[R.id]={min:Z,mid:$,max:re}}}return p}zc.deviation=function(c,a,p,y){var E=a&&a.length,A=Math.abs(Dv(c,0,E?a[0]*p:c.length,p));if(E)for(var R=0,U=a.length;R<U;R++)A-=Math.abs(Dv(c,a[R]*p,R<U-1?a[R+1]*p:c.length,p));var Z=0;for(R=0;R<y.length;R+=3){var $=y[R]*p,re=y[R+1]*p,ae=y[R+2]*p;Z+=Math.abs((c[$]-c[ae])*(c[re+1]-c[$+1])-(c[$]-c[re])*(c[ae+1]-c[$+1]))}return 0===A&&0===Z?0:Math.abs((Z-A)/A)},zc.flatten=function(c){for(var a=c[0][0].length,p={vertices:[],holes:[],dimensions:a},y=0,E=0;E<c.length;E++){for(var A=0;A<c[E].length;A++)for(var R=0;R<a;R++)p.vertices.push(c[E][A][R]);E>0&&p.holes.push(y+=c[E-1].length)}return p},dp.default=Sg;class Iy{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(p=>p.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Qt,this.indexArray=new Ko,this.indexArray2=new K,this.programConfigurations=new es(a.layers,a.zoom),this.segments=new Zs,this.segments2=new Zs,this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id)}populate(a,p,y,E){this.hasPattern=Rd("fill",this.layers,p);const A=this.layers[0].layout.get("fill-sort-key"),R=[];for(const{feature:U,id:Z,index:$,sourceLayerIndex:re}of a){const ae=this.layers[0]._featureFilter.needGeometry,ue=Mm(U,ae);if(!this.layers[0]._featureFilter.filter(new Q(this.zoom),ue,y))continue;const Ce=A?A.evaluate(ue,{},y,p.availableImages):void 0,ke={id:Z,properties:U.properties,type:U.type,sourceLayerIndex:re,index:$,geometry:ae?ue.geometry:gc(U,y,E),patterns:{},sortKey:Ce};R.push(ke)}A&&R.sort((U,Z)=>U.sortKey-Z.sortKey);for(const U of R){const{geometry:Z,index:$,sourceLayerIndex:re}=U;if(this.hasPattern){const ae=Vm("fill",this.layers,U,this.zoom,p);this.patternFeatures.push(ae)}else this.addFeature(U,Z,$,y,{},p.availableImages);p.featureIndex.insert(a[$].feature,Z,$,re,this.index)}}update(a,p,y,E){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,p,this.stateDependentLayers,y,E)}addFeatures(a,p,y,E){for(const A of this.patternFeatures)this.addFeature(A,A.geometry,A.index,p,y,E)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Bp),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(a,p,y,E,A,R=[]){for(const U of Um(p,500)){let Z=0;for(const ke of U)Z+=ke.length;const $=this.segments.prepareSegment(Z,this.layoutVertexArray,this.indexArray),re=$.vertexLength,ae=[],ue=[];for(const ke of U){if(0===ke.length)continue;ke!==U[0]&&ue.push(ae.length/2);const Ve=this.segments2.prepareSegment(ke.length,this.layoutVertexArray,this.indexArray2),We=Ve.vertexLength;this.layoutVertexArray.emplaceBack(ke[0].x,ke[0].y),this.indexArray2.emplaceBack(We+ke.length-1,We),ae.push(ke[0].x),ae.push(ke[0].y);for(let rt=1;rt<ke.length;rt++)this.layoutVertexArray.emplaceBack(ke[rt].x,ke[rt].y),this.indexArray2.emplaceBack(We+rt-1,We+rt),ae.push(ke[rt].x),ae.push(ke[rt].y);Ve.vertexLength+=ke.length,Ve.primitiveLength+=ke.length}const Ce=dp(ae,ue);for(let ke=0;ke<Ce.length;ke+=3)this.indexArray.emplaceBack(re+Ce[ke],re+Ce[ke+1],re+Ce[ke+2]);$.vertexLength+=Z,$.primitiveLength+=Ce.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,y,A,R,E)}}Zn("FillBucket",Iy,{omit:["layers","patternFeatures"]});const kv=new Ot({"fill-sort-key":new Ue(Je.layout_fill["fill-sort-key"])});var Gm={paint:new Ot({"fill-antialias":new Me(Je.paint_fill["fill-antialias"]),"fill-opacity":new Ue(Je.paint_fill["fill-opacity"]),"fill-color":new Ue(Je.paint_fill["fill-color"]),"fill-outline-color":new Ue(Je.paint_fill["fill-outline-color"]),"fill-translate":new Me(Je.paint_fill["fill-translate"]),"fill-translate-anchor":new Me(Je.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ye(Je.paint_fill["fill-pattern"])}),layout:kv};const Il=ft([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),J_=ft([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:Pv}=Il;var qm=pf;function pf(c,a,p,y,E){this.properties={},this.extent=p,this.type=0,this._pbf=c,this._geometry=-1,this._keys=y,this._values=E,c.readFields(Tx,this,a)}function Tx(c,a,p){1==c?a.id=p.readVarint():2==c?function(y,E){for(var A=y.readVarint()+y.pos;y.pos<A;){var R=E._keys[y.readVarint()],U=E._values[y.readVarint()];E.properties[R]=U}}(p,a):3==c?a.type=p.readVarint():4==c&&(a._geometry=p.pos)}function Ix(c){for(var a,p,y=0,E=0,A=c.length,R=A-1;E<A;R=E++)y+=((p=c[R]).x-(a=c[E]).x)*(a.y+p.y);return y}pf.types=["Unknown","Point","LineString","Polygon"],pf.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var a,p=c.readVarint()+c.pos,y=1,E=0,A=0,R=0,U=[];c.pos<p;){if(E<=0){var Z=c.readVarint();y=7&Z,E=Z>>3}if(E--,1===y||2===y)A+=c.readSVarint(),R+=c.readSVarint(),1===y&&(a&&U.push(a),a=[]),a.push(new it(A,R));else{if(7!==y)throw new Error("unknown command "+y);a&&a.push(a[0].clone())}}return a&&U.push(a),U},pf.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var a=c.readVarint()+c.pos,p=1,y=0,E=0,A=0,R=1/0,U=-1/0,Z=1/0,$=-1/0;c.pos<a;){if(y<=0){var re=c.readVarint();p=7&re,y=re>>3}if(y--,1===p||2===p)(E+=c.readSVarint())<R&&(R=E),E>U&&(U=E),(A+=c.readSVarint())<Z&&(Z=A),A>$&&($=A);else if(7!==p)throw new Error("unknown command "+p)}return[R,Z,U,$]},pf.prototype.toGeoJSON=function(c,a,p){var y,E,A=this.extent*Math.pow(2,p),R=this.extent*c,U=this.extent*a,Z=this.loadGeometry(),$=pf.types[this.type];function re(Ce){for(var ke=0;ke<Ce.length;ke++){var Ve=Ce[ke];Ce[ke]=[360*(Ve.x+R)/A-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ve.y+U)/A)*Math.PI/180))-90]}}switch(this.type){case 1:var ae=[];for(y=0;y<Z.length;y++)ae[y]=Z[y][0];re(Z=ae);break;case 2:for(y=0;y<Z.length;y++)re(Z[y]);break;case 3:for(Z=function(Ce){var ke=Ce.length;if(ke<=1)return[Ce];for(var Ve,We,rt=[],ht=0;ht<ke;ht++){var vt=Ix(Ce[ht]);0!==vt&&(void 0===We&&(We=vt<0),We===vt<0?(Ve&&rt.push(Ve),Ve=[Ce[ht]]):Ve.push(Ce[ht]))}return Ve&&rt.push(Ve),rt}(Z),y=0;y<Z.length;y++)for(E=0;E<Z[y].length;E++)re(Z[y][E])}1===Z.length?Z=Z[0]:$="Multi"+$;var ue={type:"Feature",geometry:{type:$,coordinates:Z},properties:this.properties};return"id"in this&&(ue.id=this.id),ue};var Q_=kg;function kg(c,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(Rv,this,a),this.length=this._features.length}function Rv(c,a,p){15===c?a.version=p.readVarint():1===c?a.name=p.readString():5===c?a.extent=p.readVarint():2===c?a._features.push(p.pos):3===c?a._keys.push(p.readString()):4===c&&a._values.push(function(y){for(var E=null,A=y.readVarint()+y.pos;y.pos<A;){var R=y.readVarint()>>3;E=1===R?y.readString():2===R?y.readFloat():3===R?y.readDouble():4===R?y.readVarint64():5===R?y.readVarint():6===R?y.readSVarint():7===R?y.readBoolean():null}return E}(p))}function Q1(c,a,p){if(3===c){var y=new Q_(p,p.readVarint()+p.pos);y.length&&(a[y.name]=y)}}kg.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var a=this._pbf.readVarint()+this._pbf.pos;return new qm(this._pbf,a,this.extent,this._keys,this._values)};var jp={VectorTile:function(c,a){this.layers=c.readFields(Q1,{},a)},VectorTileFeature:qm,VectorTileLayer:Q_};const Od=jp.VectorTileFeature.types,Pi=Math.pow(2,13);function Kf(c,a,p,y,E,A,R,U){c.emplaceBack((a<<1)+R,(p<<1)+A,(Math.floor(y*Pi)<<1)+E,Math.round(U))}class Pg{constructor(){this.acc=new it(0,0),this.polyCount=[]}startRing(a){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new it(a.x,a.y),this.max=new it(a.x,a.y))}append(a,p){this.currentPolyCount.edges++,this.acc._add(a);let y=!!this.borders;const E=this.min,A=this.max;a.x<E.x?(E.x=a.x,y=!0):a.x>A.x&&(A.x=a.x,y=!0),a.y<E.y?(E.y=a.y,y=!0):a.y>A.y&&(A.y=a.y,y=!0),((0===a.x||a.x===Bi)&&a.x===p.x)!=((0===a.y||a.y===Bi)&&a.y===p.y)&&this.processBorderOverlap(a,p),y&&this.checkBorderIntersection(a,p)}checkBorderIntersection(a,p){p.x<0!=a.x<0&&this.addBorderIntersection(0,ii(p.y,a.y,(0-p.x)/(a.x-p.x))),p.x>Bi!=a.x>Bi&&this.addBorderIntersection(1,ii(p.y,a.y,(Bi-p.x)/(a.x-p.x))),p.y<0!=a.y<0&&this.addBorderIntersection(2,ii(p.x,a.x,(0-p.y)/(a.y-p.y))),p.y>Bi!=a.y>Bi&&this.addBorderIntersection(3,ii(p.x,a.x,(Bi-p.y)/(a.y-p.y)))}addBorderIntersection(a,p){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const y=this.borders[a];p<y[0]&&(y[0]=p),p>y[1]&&(y[1]=p)}processBorderOverlap(a,p){if(a.x===p.x){if(a.y===p.y)return;const y=0===a.x?0:1;this.addBorderIntersection(y,p.y),this.addBorderIntersection(y,a.y)}else{const y=0===a.y?2:3;this.addBorderIntersection(y,p.x),this.addBorderIntersection(y,a.x)}}centroid(){const a=this.polyCount.reduce((p,y)=>p+y.edges,0);return 0!==a?this.acc.div(a)._round():new it(0,0)}span(){return new it(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((a,p)=>a+ +(p[0]!==Number.MAX_VALUE),0)}}class Ld{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(p=>p.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new mn,this.centroidVertexArray=new en,this.indexArray=new Ko,this.programConfigurations=new es(a.layers,a.zoom),this.segments=new Zs,this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.enableTerrain=a.enableTerrain}populate(a,p,y,E){this.features=[],this.hasPattern=Rd("fill-extrusion",this.layers,p),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(A){const R=Math.exp(Math.PI*(1-A.y/(1<<A.z)*2));return 80150034*R/(R*R+1)/Bi/(1<<A.z)}(y);for(const{feature:A,id:R,index:U,sourceLayerIndex:Z}of a){const $=this.layers[0]._featureFilter.needGeometry,re=Mm(A,$);if(!this.layers[0]._featureFilter.filter(new Q(this.zoom),re,y))continue;const ae={id:R,sourceLayerIndex:Z,index:U,geometry:$?re.geometry:gc(A,y,E),properties:A.properties,type:A.type,patterns:{}},ue=this.layoutVertexArray.length;this.hasPattern?this.features.push(Vm("fill-extrusion",this.layers,ae,this.zoom,p)):this.addFeature(ae,ae.geometry,U,y,{},p.availableImages),p.featureIndex.insert(A,ae.geometry,U,Z,this.index,ue)}this.sortBorders()}addFeatures(a,p,y,E){for(const A of this.features){const{geometry:R}=A;this.addFeature(A,R,A.index,p,y,E)}this.sortBorders()}update(a,p,y,E){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,p,this.stateDependentLayers,y,E)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Pv),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}uploadCentroid(a){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,J_.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,p,y,E,A,R){const U=this.enableTerrain?new Pg:null;for(const $ of Um(p,500)){let re=0,ae=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===$.length||(Z=$[0]).every(We=>We.x<=0)||Z.every(We=>We.x>=Bi)||Z.every(We=>We.y<=0)||Z.every(We=>We.y>=Bi))continue;for(let We=0;We<$.length;We++){const rt=$[We];if(0===rt.length)continue;re+=rt.length;let ht=0;U&&U.startRing(rt[0]);for(let vt=0;vt<rt.length;vt++){const Tt=rt[vt];if(vt>=1){const Ct=rt[vt-1];if(!Bc(Tt,Ct)){U&&U.append(Tt,Ct),ae.vertexLength+4>Zs.MAX_VERTEX_ARRAY_LENGTH&&(ae=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const kt=Tt.sub(Ct)._perp(),ln=kt.x/(Math.abs(kt.x)+Math.abs(kt.y)),Yt=kt.y>0?1:0,Kn=Ct.dist(Tt);ht+Kn>32768&&(ht=0),Kf(this.layoutVertexArray,Tt.x,Tt.y,ln,Yt,0,0,ht),Kf(this.layoutVertexArray,Tt.x,Tt.y,ln,Yt,0,1,ht),ht+=Kn,Kf(this.layoutVertexArray,Ct.x,Ct.y,ln,Yt,0,0,ht),Kf(this.layoutVertexArray,Ct.x,Ct.y,ln,Yt,0,1,ht);const In=ae.vertexLength;this.indexArray.emplaceBack(In,In+2,In+1),this.indexArray.emplaceBack(In+1,In+2,In+3),ae.vertexLength+=4,ae.primitiveLength+=2}}}}if(ae.vertexLength+re>Zs.MAX_VERTEX_ARRAY_LENGTH&&(ae=this.segments.prepareSegment(re,this.layoutVertexArray,this.indexArray)),"Polygon"!==Od[a.type])continue;const ue=[],Ce=[],ke=ae.vertexLength;for(let We=0;We<$.length;We++){const rt=$[We];if(0!==rt.length){rt!==$[0]&&Ce.push(ue.length/2);for(let ht=0;ht<rt.length;ht++){const vt=rt[ht];Kf(this.layoutVertexArray,vt.x,vt.y,0,0,1,1,0),ue.push(vt.x),ue.push(vt.y),U&&U.currentPolyCount.top++}}}const Ve=dp(ue,Ce);for(let We=0;We<Ve.length;We+=3)this.indexArray.emplaceBack(ke+Ve[We],ke+Ve[We+2],ke+Ve[We+1]);ae.primitiveLength+=Ve.length/3,ae.vertexLength+=re}var Z;if(U&&U.polyCount.length>0){if(U.borders){U.vertexArrayOffset=this.centroidVertexArray.length;const $=U.borders,re=this.featuresOnBorder.push(U)-1;for(let ae=0;ae<4;ae++)$[ae][0]!==Number.MAX_VALUE&&this.borders[ae].push(re)}this.encodeCentroid(U.borders?void 0:U.centroid(),U)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,y,A,R,E)}sortBorders(){for(let a=0;a<4;a++)this.borders[a].sort((p,y)=>this.featuresOnBorder[p].borders[a][0]-this.featuresOnBorder[y].borders[a][0])}encodeCentroid(a,p,y=!0){let E,A;if(a)if(0!==a.y){const U=p.span()._mult(this.tileToMeter);E=(Math.max(a.x,1)<<3)+Math.min(7,Math.round(U.x/10)),A=(Math.max(a.y,1)<<3)+Math.min(7,Math.round(U.y/10))}else E=Math.ceil(7*(a.x+450)),A=0;else E=0,A=+y;let R=y?this.centroidVertexArray.length:p.vertexArrayOffset;for(const U of p.polyCount){y&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*U.edges+U.top);for(let Z=0;Z<2*U.edges;Z++)this.centroidVertexArray.emplace(R++,0,A),this.centroidVertexArray.emplace(R++,E,A);for(let Z=0;Z<U.top;Z++)this.centroidVertexArray.emplace(R++,E,A)}}}function Bc(c,a){return c.x===a.x&&(c.x<0||c.x>Bi)||c.y===a.y&&(c.y<0||c.y>Bi)}Zn("FillExtrusionBucket",Ld,{omit:["layers","features"]}),Zn("PartMetadata",Pg);var Rg={paint:new Ot({"fill-extrusion-opacity":new Me(Je["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ue(Je["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Me(Je["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Me(Je["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ye(Je["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ue(Je["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ue(Je["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Me(Je["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Jf(c,a){return c.x*a.x+c.y*a.y}function e0(c,a){if(1===c.length){let p=0;const y=a[p++];let E;for(;!E||y.equals(E);)if(E=a[p++],!E)return 1/0;for(;p<a.length;p++){const A=a[p],R=c[0],U=E.sub(y),Z=A.sub(y),$=R.sub(y),re=Jf(U,U),ae=Jf(U,Z),ue=Jf(Z,Z),Ce=Jf($,U),ke=Jf($,Z),Ve=re*ue-ae*ae,We=(ue*Ce-ae*ke)/Ve,rt=(re*ke-ae*Ce)/Ve,ht=y.z*(1-We-rt)+E.z*We+A.z*rt;if(isFinite(ht))return ht}return 1/0}{let p=1/0;for(const y of a)p=Math.min(p,y.z);return p}}function t0(c){const a=new it(c[0],c[1]);return a.z=c[2],a}function n0(c,a,p,y,E,A,R,U){const Z=R*E.getElevationAt(c,a,!0,!0),$=0!==A[0],re=$?0===A[1]?R*(A[0]/7-450):R*function(ae,ue,Ce){const ke=Math.floor(ue[0]/8),Ve=Math.floor(ue[1]/8),We=10*(ue[0]-8*ke),rt=10*(ue[1]-8*Ve),ht=ae.getElevationAt(ke,Ve,!0,!0),vt=ae.getMeterToDEM(Ce),Tt=Math.floor(.5*(We*vt-1)),Ct=Math.floor(.5*(rt*vt-1)),kt=ae.tileCoordToPixel(ke,Ve),ln=2*Tt+1,Yt=2*Ct+1,Kn=(Wa=ln,hi=Yt,[(Jn=ae).getElevationAtPixel(pr=kt.x-Tt,Ri=kt.y-Ct,!0),Jn.getElevationAtPixel(pr+hi,Ri,!0),Jn.getElevationAtPixel(pr,Ri+hi,!0),Jn.getElevationAtPixel(pr+Wa,Ri+hi,!0)]),In=Math.abs(Kn[0]-Kn[1]),hn=Math.abs(Kn[2]-Kn[3]),Tn=Math.abs(Kn[0]-Kn[2])+Math.abs(Kn[1]-Kn[3]),Ln=Math.min(.25,.5*vt*(In+hn)/ln),yn=Math.min(.25,.5*vt*Tn/Yt);var Jn,pr,Ri,Wa,hi;return ht+Math.max(Ln*We,yn*rt)}(E,A,U):Z;return{base:Z+(0===p)?-1:p,top:$?Math.max(re+y,Z+p+2):Z+y}}const Mx=ft([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Ov}=Mx,r0=ft([{name:"a_packed",components:3,type:"Float32"}]),{members:Lv}=r0,o0=jp.VectorTileFeature.types,My=Math.cos(Math.PI/180*37.5);class ad{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(p=>p.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(p=>{this.gradients[p.id]={}}),this.layoutVertexArray=new Hn,this.layoutVertexArray2=new gr,this.indexArray=new Ko,this.programConfigurations=new es(a.layers,a.zoom),this.segments=new Zs,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id)}populate(a,p,y,E){this.hasPattern=Rd("line",this.layers,p);const A=this.layers[0].layout.get("line-sort-key"),R=[];for(const{feature:re,id:ae,index:ue,sourceLayerIndex:Ce}of a){const ke=this.layers[0]._featureFilter.needGeometry,Ve=Mm(re,ke);if(!this.layers[0]._featureFilter.filter(new Q(this.zoom),Ve,y))continue;const We=A?A.evaluate(Ve,{},y):void 0,rt={id:ae,properties:re.properties,type:re.type,sourceLayerIndex:Ce,index:ue,geometry:ke?Ve.geometry:gc(re,y,E),patterns:{},sortKey:We};R.push(rt)}A&&R.sort((re,ae)=>re.sortKey-ae.sortKey);const{lineAtlas:U,featureIndex:Z}=p,$=this.addConstantDashes(U);for(const re of R){const{geometry:ae,index:ue,sourceLayerIndex:Ce}=re;if($&&this.addFeatureDashes(re,U),this.hasPattern){const ke=Vm("line",this.layers,re,this.zoom,p);this.patternFeatures.push(ke)}else this.addFeature(re,ae,ue,y,U.positions,p.availableImages);Z.insert(a[ue].feature,ae,ue,Ce,this.index)}}addConstantDashes(a){let p=!1;for(const y of this.layers){const E=y.paint.get("line-dasharray").value,A=y.layout.get("line-cap").value;if("constant"!==E.kind||"constant"!==A.kind)p=!0;else{const R=A.value,U=E.value;if(!U)continue;a.addDash(U.from,R),a.addDash(U.to,R),U.other&&a.addDash(U.other,R)}}return p}addFeatureDashes(a,p){const y=this.zoom;for(const E of this.layers){const A=E.paint.get("line-dasharray").value,R=E.layout.get("line-cap").value;if("constant"===A.kind&&"constant"===R.kind)continue;let U,Z,$,re,ae,ue;if("constant"===A.kind){const We=A.value;if(!We)continue;U=We.other||We.to,Z=We.to,$=We.from}else U=A.evaluate({zoom:y-1},a),Z=A.evaluate({zoom:y},a),$=A.evaluate({zoom:y+1},a);"constant"===R.kind?re=ae=ue=R.value:(re=R.evaluate({zoom:y-1},a),ae=R.evaluate({zoom:y},a),ue=R.evaluate({zoom:y+1},a)),p.addDash(U,re),p.addDash(Z,ae),p.addDash($,ue);const Ce=p.getKey(U,re),ke=p.getKey(Z,ae),Ve=p.getKey($,ue);a.patterns[E.id]={min:Ce,mid:ke,max:Ve}}}update(a,p,y,E){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,p,this.stateDependentLayers,y,E)}addFeatures(a,p,y,E){for(const A of this.patternFeatures)this.addFeature(A,A.geometry,A.index,p,y,E)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,Lv)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Ov),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}}addFeature(a,p,y,E,A,R){const U=this.layers[0].layout,Z=U.get("line-join").evaluate(a,{}),$=U.get("line-cap").evaluate(a,{}),re=U.get("line-miter-limit"),ae=U.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(const ue of p)this.addLine(ue,a,Z,$,re,ae);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,y,A,R,E)}addLine(a,p,y,E,A,R){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let rt=0;rt<a.length-1;rt++)this.totalDistance+=a[rt].dist(a[rt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const U="Polygon"===o0[p.type];let Z=a.length;for(;Z>=2&&a[Z-1].equals(a[Z-2]);)Z--;let $=0;for(;$<Z-1&&a[$].equals(a[$+1]);)$++;if(Z<(U?3:2))return;"bevel"===y&&(A=1.05);const re=this.overscaling<=16?122880/(512*this.overscaling):0,ae=this.segments.prepareSegment(10*Z,this.layoutVertexArray,this.indexArray);let ue,Ce,ke,Ve,We;this.e1=this.e2=-1,U&&(ue=a[Z-2],We=a[$].sub(ue)._unit()._perp());for(let rt=$;rt<Z;rt++){if(ke=rt===Z-1?U?a[$+1]:void 0:a[rt+1],ke&&a[rt].equals(ke))continue;We&&(Ve=We),ue&&(Ce=ue),ue=a[rt],We=ke?ke.sub(ue)._unit()._perp():Ve,Ve=Ve||We;let ht=Ve.add(We);0===ht.x&&0===ht.y||ht._unit();const vt=Ve.x*We.x+Ve.y*We.y,Tt=ht.x*We.x+ht.y*We.y,Ct=0!==Tt?1/Tt:1/0,kt=2*Math.sqrt(2-2*Tt),ln=Tt<My&&Ce&&ke,Yt=Ve.x*We.y-Ve.y*We.x>0;if(ln&&rt>$){const hn=ue.dist(Ce);if(hn>2*re){const Tn=ue.sub(ue.sub(Ce)._mult(re/hn)._round());this.updateDistance(Ce,Tn),this.addCurrentVertex(Tn,Ve,0,0,ae),Ce=Tn}}const Kn=Ce&&ke;let In=Kn?y:U?"butt":E;if(Kn&&"round"===In&&(Ct<R?In="miter":Ct<=2&&(In="fakeround")),"miter"===In&&Ct>A&&(In="bevel"),"bevel"===In&&(Ct>2&&(In="flipbevel"),Ct<A&&(In="miter")),Ce&&this.updateDistance(Ce,ue),"miter"===In)ht._mult(Ct),this.addCurrentVertex(ue,ht,0,0,ae);else if("flipbevel"===In){if(Ct>100)ht=We.mult(-1);else{const hn=Ct*Ve.add(We).mag()/Ve.sub(We).mag();ht._perp()._mult(hn*(Yt?-1:1))}this.addCurrentVertex(ue,ht,0,0,ae),this.addCurrentVertex(ue,ht.mult(-1),0,0,ae)}else if("bevel"===In||"fakeround"===In){const hn=-Math.sqrt(Ct*Ct-1),Tn=Yt?hn:0,Ln=Yt?0:hn;if(Ce&&this.addCurrentVertex(ue,Ve,Tn,Ln,ae),"fakeround"===In){const yn=Math.round(180*kt/Math.PI/20);for(let Jn=1;Jn<yn;Jn++){let pr=Jn/yn;if(.5!==pr){const Wa=pr-.5;pr+=pr*Wa*(pr-1)*((1.0904+vt*(vt*(3.55645-1.43519*vt)-3.2452))*Wa*Wa+(.848013+vt*(.215638*vt-1.06021)))}const Ri=We.sub(Ve)._mult(pr)._add(Ve)._unit()._mult(Yt?-1:1);this.addHalfVertex(ue,Ri.x,Ri.y,!1,Yt,0,ae)}}ke&&this.addCurrentVertex(ue,We,-Tn,-Ln,ae)}else if("butt"===In)this.addCurrentVertex(ue,ht,0,0,ae);else if("square"===In){const hn=Ce?1:-1;Ce||this.addCurrentVertex(ue,ht,hn,hn,ae),this.addCurrentVertex(ue,ht,0,0,ae),Ce&&this.addCurrentVertex(ue,ht,hn,hn,ae)}else"round"===In&&(Ce&&(this.addCurrentVertex(ue,Ve,0,0,ae),this.addCurrentVertex(ue,Ve,1,1,ae,!0)),ke&&(this.addCurrentVertex(ue,We,-1,-1,ae,!0),this.addCurrentVertex(ue,We,0,0,ae)));if(ln&&rt<Z-1){const hn=ue.dist(ke);if(hn>2*re){const Tn=ue.add(ke.sub(ue)._mult(re/hn)._round());this.updateDistance(ue,Tn),this.addCurrentVertex(Tn,We,0,0,ae),ue=Tn}}}}addCurrentVertex(a,p,y,E,A,R=!1){const U=p.y*E-p.x,Z=-p.y-p.x*E;this.addHalfVertex(a,p.x+p.y*y,p.y-p.x*y,R,!1,y,A),this.addHalfVertex(a,U,Z,R,!0,-E,A)}addHalfVertex({x:a,y:p},y,E,A,R,U,Z){this.layoutVertexArray.emplaceBack((a<<1)+(A?1:0),(p<<1)+(R?1:0),Math.round(63*y)+128,Math.round(63*E)+128,1+(0===U?0:U<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const $=Z.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,$),Z.primitiveLength++),R?this.e2=$:this.e1=$}updateScaledDistance(){if(this.lineClips){const a=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=a*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(a,p){this.distance+=a.dist(p),this.updateScaledDistance()}}Zn("LineBucket",ad,{omit:["layers","patternFeatures"]});const Og=new Ot({"line-cap":new Ue(Je.layout_line["line-cap"]),"line-join":new Ue(Je.layout_line["line-join"]),"line-miter-limit":new Me(Je.layout_line["line-miter-limit"]),"line-round-limit":new Me(Je.layout_line["line-round-limit"]),"line-sort-key":new Ue(Je.layout_line["line-sort-key"])});var Qf={paint:new Ot({"line-opacity":new Ue(Je.paint_line["line-opacity"]),"line-color":new Ue(Je.paint_line["line-color"]),"line-translate":new Me(Je.paint_line["line-translate"]),"line-translate-anchor":new Me(Je.paint_line["line-translate-anchor"]),"line-width":new Ue(Je.paint_line["line-width"]),"line-gap-width":new Ue(Je.paint_line["line-gap-width"]),"line-offset":new Ue(Je.paint_line["line-offset"]),"line-blur":new Ue(Je.paint_line["line-blur"]),"line-dasharray":new Ye(Je.paint_line["line-dasharray"]),"line-pattern":new Ye(Je.paint_line["line-pattern"]),"line-gradient":new gt(Je.paint_line["line-gradient"])}),layout:Og};const Fv=new class extends Ue{possiblyEvaluate(c,a){return a=new Q(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,zoomHistory:a.zoomHistory,transition:a.transition}),super.possiblyEvaluate(c,a)}evaluate(c,a,p,y){return a=jn({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(c,a,p,y)}}(Qf.paint.properties["line-width"].specification);function ul(c,a){return a>0?a+2*c:c}Fv.useIntegerZoom=!0;const Ta=ft([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),a0=ft([{name:"a_projected_pos",components:3,type:"Float32"}],4);ft([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const s0=ft([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),em=ft([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ft([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const zv=ft([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),l0=ft([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ft([{name:"triangle",components:3,type:"Uint16"}]),ft([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ft([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ft([{type:"Float32",name:"offsetX"}]),ft([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const jc=128;function Fd(c,a){const{expression:p}=a;if("constant"===p.kind)return{kind:"constant",layoutSize:p.evaluate(new Q(c+1))};if("source"===p.kind)return{kind:"source"};{const{zoomStops:y,interpolationType:E}=p;let A=0;for(;A<y.length&&y[A]<=c;)A++;A=Math.max(0,A-1);let R=A;for(;R<y.length&&y[R]<c+1;)R++;R=Math.min(y.length-1,R);const U=y[A],Z=y[R];return"composite"===p.kind?{kind:"composite",minZoom:U,maxZoom:Z,interpolationType:E}:{kind:"camera",minZoom:U,maxZoom:Z,minSize:p.evaluate(new Q(U)),maxSize:p.evaluate(new Q(Z)),interpolationType:E}}}function Zm(c,{uSize:a,uSizeT:p},{lowerSize:y,upperSize:E}){return"source"===c.kind?y/jc:"composite"===c.kind?ii(y/jc,E/jc,p):a}function ts(c,a){let p=0,y=0;if("constant"===c.kind)y=c.layoutSize;else if("source"!==c.kind){const{interpolationType:E,minZoom:A,maxZoom:R}=c,U=E?an(zl.interpolationFactor(E,a,A,R),0,1):0;"camera"===c.kind?y=ii(c.minSize,c.maxSize,U):p=U}return{uSizeT:p,uSize:y}}var Lg=Object.freeze({__proto__:null,getSizeData:Fd,evaluateSizeForFeature:Zm,evaluateSizeForZoom:ts,SIZE_PACK_FACTOR:jc});function zd(c,a,p){return c.sections.forEach(y=>{y.text=function(E,A,R){const U=A.layout.get("text-transform").evaluate(R,{});return"uppercase"===U?E=E.toLocaleUpperCase():"lowercase"===U&&(E=E.toLocaleLowerCase()),ee.applyArabicShaping&&(E=ee.applyArabicShaping(E)),E}(y.text,a,p)}),c}const df={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function Fg(c){return"\ufe36"===c||"\ufe48"===c||"\ufe38"===c||"\ufe44"===c||"\ufe42"===c||"\ufe3e"===c||"\ufe3c"===c||"\ufe3a"===c||"\ufe18"===c||"\ufe40"===c||"\ufe10"===c||"\ufe13"===c||"\ufe14"===c||"\uff40"===c||"\uffe3"===c||"\ufe11"===c||"\ufe12"===c}function Nv(c){return"\ufe35"===c||"\ufe47"===c||"\ufe37"===c||"\ufe43"===c||"\ufe41"===c||"\ufe3d"===c||"\ufe3b"===c||"\ufe39"===c||"\ufe17"===c||"\ufe3f"===c}var Nd=function(c,a,p,y,E){var A,R,U=8*E-y-1,Z=(1<<U)-1,$=Z>>1,re=-7,ae=p?E-1:0,ue=p?-1:1,Ce=c[a+ae];for(ae+=ue,A=Ce&(1<<-re)-1,Ce>>=-re,re+=U;re>0;A=256*A+c[a+ae],ae+=ue,re-=8);for(R=A&(1<<-re)-1,A>>=-re,re+=y;re>0;R=256*R+c[a+ae],ae+=ue,re-=8);if(0===A)A=1-$;else{if(A===Z)return R?NaN:1/0*(Ce?-1:1);R+=Math.pow(2,y),A-=$}return(Ce?-1:1)*R*Math.pow(2,A-y)},sd=function(c,a,p,y,E,A){var R,U,Z,$=8*A-E-1,re=(1<<$)-1,ae=re>>1,ue=23===E?Math.pow(2,-24)-Math.pow(2,-77):0,Ce=y?0:A-1,ke=y?1:-1,Ve=a<0||0===a&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(U=isNaN(a)?1:0,R=re):(R=Math.floor(Math.log(a)/Math.LN2),a*(Z=Math.pow(2,-R))<1&&(R--,Z*=2),(a+=R+ae>=1?ue/Z:ue*Math.pow(2,1-ae))*Z>=2&&(R++,Z/=2),R+ae>=re?(U=0,R=re):R+ae>=1?(U=(a*Z-1)*Math.pow(2,E),R+=ae):(U=a*Math.pow(2,ae-1)*Math.pow(2,E),R=0));E>=8;c[p+Ce]=255&U,Ce+=ke,U/=256,E-=8);for(R=R<<E|U,$+=E;$>0;c[p+Ce]=255&R,Ce+=ke,R/=256,$-=8);c[p+Ce-ke]|=128*Ve},Up=fo;function fo(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}fo.Varint=0,fo.Fixed64=1,fo.Bytes=2,fo.Fixed32=5;var u0=4294967296,ql=1/u0,ld="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Bd(c){return c.type===fo.Bytes?c.readVarint()+c.pos:c.pos+1}function h(c,a,p){var y=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));p.realloc(y);for(var E=p.pos-1;E>=c;E--)p.buf[E+y]=p.buf[E]}function g(c,a){for(var p=0;p<c.length;p++)a.writeVarint(c[p])}function S(c,a){for(var p=0;p<c.length;p++)a.writeSVarint(c[p])}function k(c,a){for(var p=0;p<c.length;p++)a.writeFloat(c[p])}function N(c,a){for(var p=0;p<c.length;p++)a.writeDouble(c[p])}function q(c,a){for(var p=0;p<c.length;p++)a.writeBoolean(c[p])}function X(c,a){for(var p=0;p<c.length;p++)a.writeFixed32(c[p])}function ie(c,a){for(var p=0;p<c.length;p++)a.writeSFixed32(c[p])}function ce(c,a){for(var p=0;p<c.length;p++)a.writeFixed64(c[p])}function ye(c,a){for(var p=0;p<c.length;p++)a.writeSFixed64(c[p])}function _e(c,a){return(c[a]|c[a+1]<<8|c[a+2]<<16)+16777216*c[a+3]}function Ae(c,a,p){c[p]=a,c[p+1]=a>>>8,c[p+2]=a>>>16,c[p+3]=a>>>24}function ze(c,a){return(c[a]|c[a+1]<<8|c[a+2]<<16)+(c[a+3]<<24)}function Xe(c,a,p){a.glyphs=[],1===c&&p.readMessage(Qe,a)}function Qe(c,a,p){if(3===c){const{id:y,bitmap:E,width:A,height:R,left:U,top:Z,advance:$}=p.readMessage(pt,{});a.glyphs.push({id:y,bitmap:new Ph({width:A+6,height:R+6},E),metrics:{width:A,height:R,left:U,top:Z,advance:$}})}else 4===c?a.ascender=p.readSVarint():5===c&&(a.descender=p.readSVarint())}function pt(c,a,p){1===c?a.id=p.readVarint():2===c?a.bitmap=p.readBytes():3===c?a.width=p.readVarint():4===c?a.height=p.readVarint():5===c?a.left=p.readSVarint():6===c?a.top=p.readSVarint():7===c&&(a.advance=p.readVarint())}function st(c){let a=0,p=0;for(const R of c)a+=R.w*R.h,p=Math.max(p,R.w);c.sort((R,U)=>U.h-R.h);const y=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),p),h:1/0}];let E=0,A=0;for(const R of c)for(let U=y.length-1;U>=0;U--){const Z=y[U];if(!(R.w>Z.w||R.h>Z.h)){if(R.x=Z.x,R.y=Z.y,A=Math.max(A,R.y+R.h),E=Math.max(E,R.x+R.w),R.w===Z.w&&R.h===Z.h){const $=y.pop();U<y.length&&(y[U]=$)}else R.h===Z.h?(Z.x+=R.w,Z.w-=R.w):R.w===Z.w?(Z.y+=R.h,Z.h-=R.h):(y.push({x:Z.x+R.w,y:Z.y,w:Z.w-R.w,h:R.h}),Z.y+=R.h,Z.h-=R.h);break}}return{w:E,h:A,fill:a/(E*A)||0}}fo.prototype={destroy:function(){this.buf=null},readFields:function(c,a,p){for(p=p||this.length;this.pos<p;){var y=this.readVarint(),E=y>>3,A=this.pos;this.type=7&y,c(E,a,this),this.pos===A&&this.skip(y)}return a},readMessage:function(c,a){return this.readFields(c,a,this.readVarint()+this.pos)},readFixed32:function(){var c=_e(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=ze(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=_e(this.buf,this.pos)+_e(this.buf,this.pos+4)*u0;return this.pos+=8,c},readSFixed64:function(){var c=_e(this.buf,this.pos)+ze(this.buf,this.pos+4)*u0;return this.pos+=8,c},readFloat:function(){var c=Nd(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=Nd(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var a,p,y=this.buf;return a=127&(p=y[this.pos++]),p<128?a:(a|=(127&(p=y[this.pos++]))<<7,p<128?a:(a|=(127&(p=y[this.pos++]))<<14,p<128?a:(a|=(127&(p=y[this.pos++]))<<21,p<128?a:function(E,A,R){var U,Z,$=R.buf;if(U=(112&(Z=$[R.pos++]))>>4,Z<128||(U|=(127&(Z=$[R.pos++]))<<3,Z<128)||(U|=(127&(Z=$[R.pos++]))<<10,Z<128)||(U|=(127&(Z=$[R.pos++]))<<17,Z<128)||(U|=(127&(Z=$[R.pos++]))<<24,Z<128)||(U|=(1&(Z=$[R.pos++]))<<31,Z<128))return function(c,a,p){return p?4294967296*a+(c>>>0):4294967296*(a>>>0)+(c>>>0)}(E,U,A);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(p=y[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var c=this.readVarint()+this.pos,a=this.pos;return this.pos=c,c-a>=12&&ld?ld.decode(this.buf.subarray(a,c)):function(p,y,E){for(var A="",R=y;R<E;){var U,Z,$,re=p[R],ae=null,ue=re>239?4:re>223?3:re>191?2:1;if(R+ue>E)break;1===ue?re<128&&(ae=re):2===ue?128==(192&(U=p[R+1]))&&(ae=(31&re)<<6|63&U)<=127&&(ae=null):3===ue?(Z=p[R+2],128==(192&(U=p[R+1]))&&128==(192&Z)&&((ae=(15&re)<<12|(63&U)<<6|63&Z)<=2047||ae>=55296&&ae<=57343)&&(ae=null)):4===ue&&(Z=p[R+2],$=p[R+3],128==(192&(U=p[R+1]))&&128==(192&Z)&&128==(192&$)&&((ae=(15&re)<<18|(63&U)<<12|(63&Z)<<6|63&$)<=65535||ae>=1114112)&&(ae=null)),null===ae?(ae=65533,ue=1):ae>65535&&(ae-=65536,A+=String.fromCharCode(ae>>>10&1023|55296),ae=56320|1023&ae),A+=String.fromCharCode(ae),R+=ue}return A}(this.buf,a,c)},readBytes:function(){var c=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,c);return this.pos=c,a},readPackedVarint:function(c,a){if(this.type!==fo.Bytes)return c.push(this.readVarint(a));var p=Bd(this);for(c=c||[];this.pos<p;)c.push(this.readVarint(a));return c},readPackedSVarint:function(c){if(this.type!==fo.Bytes)return c.push(this.readSVarint());var a=Bd(this);for(c=c||[];this.pos<a;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==fo.Bytes)return c.push(this.readBoolean());var a=Bd(this);for(c=c||[];this.pos<a;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==fo.Bytes)return c.push(this.readFloat());var a=Bd(this);for(c=c||[];this.pos<a;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==fo.Bytes)return c.push(this.readDouble());var a=Bd(this);for(c=c||[];this.pos<a;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==fo.Bytes)return c.push(this.readFixed32());var a=Bd(this);for(c=c||[];this.pos<a;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==fo.Bytes)return c.push(this.readSFixed32());var a=Bd(this);for(c=c||[];this.pos<a;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==fo.Bytes)return c.push(this.readFixed64());var a=Bd(this);for(c=c||[];this.pos<a;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==fo.Bytes)return c.push(this.readSFixed64());var a=Bd(this);for(c=c||[];this.pos<a;)c.push(this.readSFixed64());return c},skip:function(c){var a=7&c;if(a===fo.Varint)for(;this.buf[this.pos++]>127;);else if(a===fo.Bytes)this.pos=this.readVarint()+this.pos;else if(a===fo.Fixed32)this.pos+=4;else{if(a!==fo.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(c,a){this.writeVarint(c<<3|a)},realloc:function(c){for(var a=this.length||16;a<this.pos+c;)a*=2;if(a!==this.length){var p=new Uint8Array(a);p.set(this.buf),this.buf=p,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),Ae(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),Ae(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),Ae(this.buf,-1&c,this.pos),Ae(this.buf,Math.floor(c*ql),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),Ae(this.buf,-1&c,this.pos),Ae(this.buf,Math.floor(c*ql),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(a,p){var y,E,A,U;if(a>=0?(y=a%4294967296|0,E=a/4294967296|0):(E=~(-a/4294967296),4294967295^(y=~(-a%4294967296))?y=y+1|0:(y=0,E=E+1|0)),a>=0x10000000000000000||a<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");p.realloc(10),A=y,(U=p).buf[U.pos++]=127&A|128,A>>>=7,U.buf[U.pos++]=127&A|128,A>>>=7,U.buf[U.pos++]=127&A|128,A>>>=7,U.buf[U.pos++]=127&A|128,U.buf[U.pos]=127&(A>>>=7),function(A,R){var U=(7&A)<<4;R.buf[R.pos++]|=U|((A>>>=3)?128:0),A&&(R.buf[R.pos++]=127&A|((A>>>=7)?128:0),A&&(R.buf[R.pos++]=127&A|((A>>>=7)?128:0),A&&(R.buf[R.pos++]=127&A|((A>>>=7)?128:0),A&&(R.buf[R.pos++]=127&A|((A>>>=7)?128:0),A&&(R.buf[R.pos++]=127&A)))))}(E,p)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(Boolean(c))},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var a=this.pos;this.pos=function(y,E,A){for(var R,U,Z=0;Z<E.length;Z++){if((R=E.charCodeAt(Z))>55295&&R<57344){if(!U){R>56319||Z+1===E.length?(y[A++]=239,y[A++]=191,y[A++]=189):U=R;continue}if(R<56320){y[A++]=239,y[A++]=191,y[A++]=189,U=R;continue}R=U-55296<<10|R-56320|65536,U=null}else U&&(y[A++]=239,y[A++]=191,y[A++]=189,U=null);R<128?y[A++]=R:(R<2048?y[A++]=R>>6|192:(R<65536?y[A++]=R>>12|224:(y[A++]=R>>18|240,y[A++]=R>>12&63|128),y[A++]=R>>6&63|128),y[A++]=63&R|128)}return A}(this.buf,c,this.pos);var p=this.pos-a;p>=128&&h(a,p,this),this.pos=a-1,this.writeVarint(p),this.pos+=p},writeFloat:function(c){this.realloc(4),sd(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),sd(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var a=c.length;this.writeVarint(a),this.realloc(a);for(var p=0;p<a;p++)this.buf[this.pos++]=c[p]},writeRawMessage:function(c,a){this.pos++;var p=this.pos;c(a,this);var y=this.pos-p;y>=128&&h(p,y,this),this.pos=p-1,this.writeVarint(y),this.pos+=y},writeMessage:function(c,a,p){this.writeTag(c,fo.Bytes),this.writeRawMessage(a,p)},writePackedVarint:function(c,a){a.length&&this.writeMessage(c,g,a)},writePackedSVarint:function(c,a){a.length&&this.writeMessage(c,S,a)},writePackedBoolean:function(c,a){a.length&&this.writeMessage(c,q,a)},writePackedFloat:function(c,a){a.length&&this.writeMessage(c,k,a)},writePackedDouble:function(c,a){a.length&&this.writeMessage(c,N,a)},writePackedFixed32:function(c,a){a.length&&this.writeMessage(c,X,a)},writePackedSFixed32:function(c,a){a.length&&this.writeMessage(c,ie,a)},writePackedFixed64:function(c,a){a.length&&this.writeMessage(c,ce,a)},writePackedSFixed64:function(c,a){a.length&&this.writeMessage(c,ye,a)},writeBytesField:function(c,a){this.writeTag(c,fo.Bytes),this.writeBytes(a)},writeFixed32Field:function(c,a){this.writeTag(c,fo.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(c,a){this.writeTag(c,fo.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(c,a){this.writeTag(c,fo.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(c,a){this.writeTag(c,fo.Fixed64),this.writeSFixed64(a)},writeVarintField:function(c,a){this.writeTag(c,fo.Varint),this.writeVarint(a)},writeSVarintField:function(c,a){this.writeTag(c,fo.Varint),this.writeSVarint(a)},writeStringField:function(c,a){this.writeTag(c,fo.Bytes),this.writeString(a)},writeFloatField:function(c,a){this.writeTag(c,fo.Fixed32),this.writeFloat(a)},writeDoubleField:function(c,a){this.writeTag(c,fo.Fixed64),this.writeDouble(a)},writeBooleanField:function(c,a){this.writeVarintField(c,Boolean(a))}};class St{constructor(a,{pixelRatio:p,version:y,stretchX:E,stretchY:A,content:R}){this.paddedRect=a,this.pixelRatio=p,this.stretchX=E,this.stretchY=A,this.content=R,this.version=y}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class At{constructor(a,p){const y={},E={};this.haveRenderCallbacks=[];const A=[];this.addImages(a,y,A),this.addImages(p,E,A);const{w:R,h:U}=st(A),Z=new Rh({width:R||1,height:U||1});for(const $ in a){const re=a[$],ae=y[$].paddedRect;Rh.copy(re.data,Z,{x:0,y:0},{x:ae.x+1,y:ae.y+1},re.data)}for(const $ in p){const re=p[$],ae=E[$].paddedRect,ue=ae.x+1,Ce=ae.y+1,ke=re.data.width,Ve=re.data.height;Rh.copy(re.data,Z,{x:0,y:0},{x:ue,y:Ce},re.data),Rh.copy(re.data,Z,{x:0,y:Ve-1},{x:ue,y:Ce-1},{width:ke,height:1}),Rh.copy(re.data,Z,{x:0,y:0},{x:ue,y:Ce+Ve},{width:ke,height:1}),Rh.copy(re.data,Z,{x:ke-1,y:0},{x:ue-1,y:Ce},{width:1,height:Ve}),Rh.copy(re.data,Z,{x:0,y:0},{x:ue+ke,y:Ce},{width:1,height:Ve})}this.image=Z,this.iconPositions=y,this.patternPositions=E}addImages(a,p,y){for(const E in a){const A=a[E],R={x:0,y:0,w:A.data.width+2,h:A.data.height+2};y.push(R),p[E]=new St(R,A),A.hasRenderCallback&&this.haveRenderCallbacks.push(E)}}patchUpdatedImages(a,p){a.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const y in a.updatedImages)this.patchUpdatedImage(this.iconPositions[y],a.getImage(y),p),this.patchUpdatedImage(this.patternPositions[y],a.getImage(y),p)}patchUpdatedImage(a,p,y){if(!a||!p||a.version===p.version)return;a.version=p.version;const[E,A]=a.tl;y.update(p.data,void 0,{x:E,y:A})}}Zn("ImagePosition",St),Zn("ImageAtlas",At);const Lt={horizontal:1,vertical:2,horizontalOnly:3};class zt{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(a,p){const y=new zt;return y.scale=a||1,y.fontStack=p,y}static forImage(a){const p=new zt;return p.imageName=a,p}}class nn{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(a,p){const y=new nn;for(let E=0;E<a.sections.length;E++){const A=a.sections[E];A.image?y.addImageSection(A):y.addTextSection(A,p)}return y}length(){return this.text.length}getSection(a){return this.sections[this.sectionIndex[a]]}getSections(){return this.sections}getSectionIndex(a){return this.sectionIndex[a]}getCharCode(a){return this.text.charCodeAt(a)}verticalizePunctuation(a){this.text=function(p,y){let E="";for(let A=0;A<p.length;A++){const R=p.charCodeAt(A+1)||null,U=p.charCodeAt(A-1)||null;E+=!y&&(R&&v(R)&&!df[p[A+1]]||U&&v(U)&&!df[p[A-1]])||!df[p[A]]?p[A]:df[p[A]]}return E}(this.text,a)}trim(){let a=0;for(let y=0;y<this.text.length&&zn[this.text.charCodeAt(y)];y++)a++;let p=this.text.length;for(let y=this.text.length-1;y>=0&&y>=a&&zn[this.text.charCodeAt(y)];y--)p--;this.text=this.text.substring(a,p),this.sectionIndex=this.sectionIndex.slice(a,p)}substring(a,p){const y=new nn;return y.text=this.text.substring(a,p),y.sectionIndex=this.sectionIndex.slice(a,p),y.sections=this.sections,y}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((a,p)=>Math.max(a,this.sections[p].scale),0)}addTextSection(a,p){this.text+=a.text,this.sections.push(zt.forText(a.scale,a.fontStack||p));const y=this.sections.length-1;for(let E=0;E<a.text.length;++E)this.sectionIndex.push(y)}addImageSection(a){const p=a.image?a.image.name:"";if(0===p.length)return void Ui("Can't add FormattedSection with an empty image.");const y=this.getNextImageSectionCharCode();y?(this.text+=String.fromCharCode(y),this.sections.push(zt.forImage(p)),this.sectionIndex.push(this.sections.length-1)):Ui("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function An(c,a,p,y,E,A,R,U,Z,$,re,ae,ue,Ce,ke,Ve){const We=nn.fromFeature(c,E);let rt;ae===Lt.vertical&&We.verticalizePunctuation(ue);const{processBidirectionalText:ht,processStyledBidirectionalText:vt}=ee;if(ht&&1===We.sections.length){rt=[];const kt=ht(We.toString(),rr(We,$,A,a,y,Ce,ke));for(const ln of kt){const Yt=new nn;Yt.text=ln,Yt.sections=We.sections;for(let Kn=0;Kn<ln.length;Kn++)Yt.sectionIndex.push(0);rt.push(Yt)}}else if(vt){rt=[];const kt=vt(We.text,We.sectionIndex,rr(We,$,A,a,y,Ce,ke));for(const ln of kt){const Yt=new nn;Yt.text=ln[0],Yt.sectionIndex=ln[1],Yt.sections=We.sections,rt.push(Yt)}}else rt=function(kt,ln){const Yt=[],Kn=kt.text;let In=0;for(const hn of ln)Yt.push(kt.substring(In,hn)),In=hn;return In<Kn.length&&Yt.push(kt.substring(In,Kn.length)),Yt}(We,rr(We,$,A,a,y,Ce,ke));const Tt=[],Ct={positionedLines:Tt,text:We.toString(),top:re[1],bottom:re[1],left:re[0],right:re[0],writingMode:ae,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(kt,ln,Yt,Kn,In,hn,Tn,Ln,yn,Jn,pr,Ri){let Wa=0,hi=0,mo=0;const Wn="right"===Ln?1:"left"===Ln?0:.5;let is=!1;for(const ia of In){const pa=ia.getSections();for(const xs of pa){if(xs.imageName)continue;const _c=ln[xs.fontStack];if(_c&&(is=void 0!==_c.ascender&&void 0!==_c.descender,!is))break}if(!is)break}let ra=0;for(const ia of In){ia.trim();const pa=ia.getMaxScale(),xs=24*(pa-1),_c={positionedGlyphs:[],lineOffset:0};kt.positionedLines[ra]=_c;const Hl=_c.positionedGlyphs;let Ou=0;if(!ia.length()){hi+=hn,++ra;continue}let Gc=0,Ws=0;for(let os=0;os<ia.length();os++){const Wl=ia.getSection(os),$s=ia.getSectionIndex(os),Al=ia.getCharCode(os);let Dl=Wl.scale,Lu=null,da=null,hh=null,$d=24,Hp=0;const fd=!(yn===Lt.horizontal||!pr&&!Kh(Al)||pr&&(zn[Al]||(Pu=Al,Vl(Pu)||Ps(Pu)||$u(Pu)||oo(Pu)||Va(Pu))));if(Wl.imageName){const Fo=Kn[Wl.imageName];if(!Fo)continue;hh=Wl.imageName,kt.iconsInText=kt.iconsInText||!0,da=Fo.paddedRect;const xc=Fo.displaySize;Dl=24*Dl/Ri,Lu={width:xc[0],height:xc[1],left:1,top:-3,advance:fd?xc[1]:xc[0],localGlyph:!1},Hp=is?-Lu.height*Dl:24*pa-17-xc[1]*Dl,$d=Lu.advance;const Ef=(fd?xc[0]:xc[1])*Dl-24*pa;Ef>0&&Ef>Ou&&(Ou=Ef)}else{const Fo=Yt[Wl.fontStack];if(!Fo)continue;Fo[Al]&&(da=Fo[Al]);const xc=ln[Wl.fontStack];if(!xc)continue;const Ef=xc.glyphs[Al];if(!Ef)continue;if(Lu=Ef.metrics,$d=8203!==Al?24:0,is){const Zg=void 0!==xc.ascender?Math.abs(xc.ascender):0,Hg=void 0!==xc.descender?Math.abs(xc.descender):0,Wg=(Zg+Hg)*Dl;Gc<Wg&&(Gc=Wg,Ws=(Zg-Hg)/2*Dl),Hp=-Zg*Dl}else Hp=24*(pa-Dl)-17}fd?(kt.verticalizable=!0,Hl.push({glyph:Al,imageName:hh,x:Wa,y:hi+Hp,vertical:fd,scale:Dl,localGlyph:Lu.localGlyph,fontStack:Wl.fontStack,sectionIndex:$s,metrics:Lu,rect:da}),Wa+=$d*Dl+Jn):(Hl.push({glyph:Al,imageName:hh,x:Wa,y:hi+Hp,vertical:fd,scale:Dl,localGlyph:Lu.localGlyph,fontStack:Wl.fontStack,sectionIndex:$s,metrics:Lu,rect:da}),Wa+=Lu.advance*Dl+Jn)}0!==Hl.length&&(mo=Math.max(Wa-Jn,mo),is?si(Hl,Wn,Ou,Ws,hn*pa/2):si(Hl,Wn,Ou,0,hn/2)),Wa=0;const op=hn*pa+Ou;_c.lineOffset=Math.max(Ou,xs),hi+=op,++ra}var Pu;const Ml=hi,{horizontalAlign:du,verticalAlign:Ru}=Ci(Tn);(function(ia,pa,xs,_c,Hl,Ou){const Gc=(pa-xs)*Hl,Ws=-Ou*_c;for(const op of ia)for(const os of op.positionedGlyphs)os.x+=Gc,os.y+=Ws})(kt.positionedLines,Wn,du,Ru,mo,Ml),kt.top+=-Ru*Ml,kt.bottom=kt.top+Ml,kt.left+=-du*mo,kt.right=kt.left+mo,kt.hasBaseline=is}(Ct,a,p,y,rt,R,U,Z,ae,$,ue,Ve),!function(kt){for(const ln of kt)if(0!==ln.positionedGlyphs.length)return!1;return!0}(Tt)&&Ct}const zn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},_r={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Gn(c,a,p,y,E,A){if(a.imageName){const R=y[a.imageName];return R?R.displaySize[0]*a.scale*24/A+E:0}{const R=p[a.fontStack],U=R&&R.glyphs[c];return U?U.metrics.advance*a.scale+E:0}}function Dr(c,a,p,y){const E=Math.pow(c-a,2);return y?c<a?E/2:2*E:E+Math.abs(p)*p}function Yn(c,a,p){let y=0;return 10===c&&(y-=1e4),p&&(y+=150),40!==c&&65288!==c||(y+=50),41!==a&&65289!==a||(y+=50),y}function mi(c,a,p,y,E,A){let R=null,U=Dr(a,p,E,A);for(const Z of y){const $=Dr(a-Z.x,p,E,A)+Z.badness;$<=U&&(R=Z,U=$)}return{index:c,x:a,priorBreak:R,badness:U}}function $r(c){return c?$r(c.priorBreak).concat(c.index):[]}function rr(c,a,p,y,E,A,R){if("point"!==A)return[];if(!c)return[];const U=[],Z=function(ue,Ce,ke,Ve,We,rt){let ht=0;for(let vt=0;vt<ue.length();vt++){const Tt=ue.getSection(vt);ht+=Gn(ue.getCharCode(vt),Tt,Ve,We,Ce,rt)}return ht/Math.max(1,Math.ceil(ht/ke))}(c,a,p,y,E,R),$=c.text.indexOf("\u200b")>=0;let re=0;for(let ue=0;ue<c.length();ue++){const Ce=c.getSection(ue),ke=c.getCharCode(ue);if(zn[ke]||(re+=Gn(ke,Ce,y,E,a,R)),ue<c.length()-1){const Ve=!((ae=ke)<11904||!(oh(ae)||pp(ae)||fs(ae)||pc(ae)||Rr(ae)||Rs(ae)||cc(ae)||Eu(ae)||jo(ae)||Fc(ae)||Ni(ae)||Ga(ae)||co(ae)||Vf(ae)||Lr(ae)||gn(ae)||Ea(ae)||ho(ae)||Su(ae)||ah(ae)));(_r[ke]||Ve||Ce.imageName)&&U.push(mi(ue+1,re,Z,U,Yn(ke,c.getCharCode(ue+1),Ve&&$),!1))}}var ae;return $r(mi(c.length(),re,Z,U,0,!0))}function Ci(c){let a=.5,p=.5;switch(c){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":p=1;break;case"top":case"top-right":case"top-left":p=0}return{horizontalAlign:a,verticalAlign:p}}function si(c,a,p,y,E){if(!(a||p||y||E))return;const A=c.length-1,R=c[A],U=(R.x+R.metrics.advance*R.scale)*a;for(let Z=0;Z<=A;Z++)c[Z].x-=U,c[Z].y+=p+y+E}function so(c,a,p){const{horizontalAlign:y,verticalAlign:E}=Ci(p),A=a[0]-c.displaySize[0]*y,R=a[1]-c.displaySize[1]*E;return{image:c,top:R,bottom:R+c.displaySize[1],left:A,right:A+c.displaySize[0]}}function Tr(c,a,p,y,E,A){const R=c.image;let U;if(R.content){const We=R.content,rt=R.pixelRatio||1;U=[We[0]/rt,We[1]/rt,R.displaySize[0]-We[2]/rt,R.displaySize[1]-We[3]/rt]}const Z=a.left*A,$=a.right*A;let re,ae,ue,Ce;"width"===p||"both"===p?(Ce=E[0]+Z-y[3],ae=E[0]+$+y[1]):(Ce=E[0]+(Z+$-R.displaySize[0])/2,ae=Ce+R.displaySize[0]);const ke=a.top*A,Ve=a.bottom*A;return"height"===p||"both"===p?(re=E[1]+ke-y[0],ue=E[1]+Ve+y[2]):(re=E[1]+(ke+Ve-R.displaySize[1])/2,ue=re+R.displaySize[1]),{image:R,top:re,right:ae,bottom:ue,left:Ce,collisionPadding:U}}class ji extends it{constructor(a,p,y,E,A){super(a,p),this.angle=E,this.z=y,void 0!==A&&(this.segment=A)}clone(){return new ji(this.x,this.y,this.z,this.angle,this.segment)}}function Ia(c,a,p,y,E){if(void 0===a.segment)return!0;let A=a,R=a.segment+1,U=0;for(;U>-p/2;){if(R--,R<0)return!1;U-=c[R].dist(A),A=c[R]}U+=c[R].dist(c[R+1]),R++;const Z=[];let $=0;for(;U<p/2;){const re=c[R],ae=c[R+1];if(!ae)return!1;let ue=c[R-1].angleTo(re)-re.angleTo(ae);for(ue=Math.abs((ue+3*Math.PI)%(2*Math.PI)-Math.PI),Z.push({distance:U,angleDelta:ue}),$+=ue;U-Z[0].distance>y;)$-=Z.shift().angleDelta;if($>E)return!1;R++,U+=re.dist(ae)}return!0}function ns(c){let a=0;for(let p=0;p<c.length-1;p++)a+=c[p].dist(c[p+1]);return a}function Ha(c,a,p){return c?.6*a*p:0}function _a(c,a){return Math.max(c?c.right-c.left:0,a?a.right-a.left:0)}function gs(c,a,p,y,E,A){const R=Ha(p,E,A),U=_a(p,y)*A;let Z=0;const $=ns(c)/2;for(let re=0;re<c.length-1;re++){const ae=c[re],ue=c[re+1],Ce=ae.dist(ue);if(Z+Ce>$){const ke=($-Z)/Ce,Ve=ii(ae.x,ue.x,ke),We=ii(ae.y,ue.y,ke),rt=new ji(Ve,We,0,ue.angleTo(ae),re);return!R||Ia(c,rt,U,R,a)?rt:void 0}Z+=Ce}}function Hs(c,a,p,y,E,A,R,U,Z){const $=Ha(y,A,R),re=_a(y,E),ae=re*R,ue=0===c[0].x||c[0].x===Z||0===c[0].y||c[0].y===Z;return a-ae<a/4&&(a=ae+a/4),Os(c,ue?a/2*U%a:(re/2+2*A)*R*U%a,a,$,p,ae,ue,!1,Z)}function Os(c,a,p,y,E,A,R,U,Z){const $=A/2,re=ns(c);let ae=0,ue=a-p,Ce=[];for(let ke=0;ke<c.length-1;ke++){const Ve=c[ke],We=c[ke+1],rt=Ve.dist(We),ht=We.angleTo(Ve);for(;ue+p<ae+rt;){ue+=p;const vt=(ue-ae)/rt,Tt=ii(Ve.x,We.x,vt),Ct=ii(Ve.y,We.y,vt);if(Tt>=0&&Tt<Z&&Ct>=0&&Ct<Z&&ue-$>=0&&ue+$<=re){const kt=new ji(Tt,Ct,0,ht,ke);kt._round(),y&&!Ia(c,kt,A,y,E)||Ce.push(kt)}}ae+=rt}return U||Ce.length||R||(Ce=Os(c,ae/2,p,y,E,A,R,!0,Z)),Ce}function uu(c,a,p,y,E){const A=[];for(let R=0;R<c.length;R++){const U=c[R];let Z;for(let $=0;$<U.length-1;$++){let re=U[$],ae=U[$+1];re.x<a&&ae.x<a||(re.x<a?re=new it(a,re.y+(a-re.x)/(ae.x-re.x)*(ae.y-re.y))._round():ae.x<a&&(ae=new it(a,re.y+(a-re.x)/(ae.x-re.x)*(ae.y-re.y))._round()),re.y<p&&ae.y<p||(re.y<p?re=new it(re.x+(p-re.y)/(ae.y-re.y)*(ae.x-re.x),p)._round():ae.y<p&&(ae=new it(re.x+(p-re.y)/(ae.y-re.y)*(ae.x-re.x),p)._round()),re.x>=y&&ae.x>=y||(re.x>=y?re=new it(y,re.y+(y-re.x)/(ae.x-re.x)*(ae.y-re.y))._round():ae.x>=y&&(ae=new it(y,re.y+(y-re.x)/(ae.x-re.x)*(ae.y-re.y))._round()),re.y>=E&&ae.y>=E||(re.y>=E?re=new it(re.x+(E-re.y)/(ae.y-re.y)*(ae.x-re.x),E)._round():ae.y>=E&&(ae=new it(re.x+(E-re.y)/(ae.y-re.y)*(ae.x-re.x),E)._round()),Z&&re.equals(Z[Z.length-1])||(Z=[re],A.push(Z)),Z.push(ae)))))}}return A}Zn("Anchor",ji);const ys=1e20;function cu(c,a,p,y,E,A,R,U,Z){for(let $=a;$<a+y;$++)rs(c,p*A+$,A,E,R,U,Z);for(let $=p;$<p+E;$++)rs(c,$*A+a,1,y,R,U,Z)}function rs(c,a,p,y,E,A,R){A[0]=0,R[0]=-ys,R[1]=ys,E[0]=c[a];for(let U=1,Z=0,$=0;U<y;U++){E[U]=c[a+U*p];const re=U*U;do{const ae=A[Z];$=(E[U]-E[ae]+re-ae*ae)/(U-ae)/2}while($<=R[Z]&&--Z>-1);Z++,A[Z]=U,R[Z]=$,R[Z+1]=ys}for(let U=0,Z=0;U<y;U++){for(;R[Z+1]<U;)Z++;const $=A[Z],re=U-$;c[a+U*p]=E[$]+re*re}}const vs={none:0,ideographs:1,all:2};class Ei{constructor(a,p,y){this.requestManager=a,this.localGlyphMode=p,this.localFontFamily=y,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(a){this.url=a}getGlyphs(a,p){const y=[];for(const E in a)for(const A of a[E])y.push({stack:E,id:A});nr(y,({stack:E,id:A},R)=>{let U=this.entries[E];U||(U=this.entries[E]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let Z=U.glyphs[A];if(void 0!==Z)return void R(null,{stack:E,id:A,glyph:Z});if(Z=this._tinySDF(U,E,A),Z)return U.glyphs[A]=Z,void R(null,{stack:E,id:A,glyph:Z});const $=Math.floor(A/256);if(256*$>65535)return void R(new Error("glyphs > 65535 not supported"));if(U.ranges[$])return void R(null,{stack:E,id:A,glyph:Z});let re=U.requests[$];re||(re=U.requests[$]=[],Ei.loadGlyphRange(E,$,this.url,this.requestManager,(ae,ue)=>{if(ue){U.ascender=ue.ascender,U.descender=ue.descender;for(const Ce in ue.glyphs)this._doesCharSupportLocalGlyph(+Ce)||(U.glyphs[+Ce]=ue.glyphs[+Ce]);U.ranges[$]=!0}for(const Ce of re)Ce(ae,ue);delete U.requests[$]})),re.push((ae,ue)=>{ae?R(ae):ue&&R(null,{stack:E,id:A,glyph:ue.glyphs[A]||null})})},(E,A)=>{if(E)p(E);else if(A){const R={};for(const{stack:U,id:Z,glyph:$}of A)void 0===R[U]&&(R[U]={}),void 0===R[U].glyphs&&(R[U].glyphs={}),R[U].glyphs[Z]=$&&{id:$.id,bitmap:$.bitmap.clone(),metrics:$.metrics},R[U].ascender=this.entries[U].ascender,R[U].descender=this.entries[U].descender;p(null,R)}})}_doesCharSupportLocalGlyph(a){return this.localGlyphMode!==vs.none&&(this.localGlyphMode===vs.all?!!this.localFontFamily:!!this.localFontFamily&&(Fc(a)||hc(a)||co(a)||Ea(a))||Eu(a))}_tinySDF(a,p,y){const E=this.localFontFamily;if(!E||!this._doesCharSupportLocalGlyph(y))return;let A=a.tinySDF;if(!A){let Ve="400";/bold/i.test(p)?Ve="900":/medium/i.test(p)?Ve="500":/light/i.test(p)&&(Ve="200"),A=a.tinySDF=new Ei.TinySDF({fontFamily:E,fontWeight:Ve,fontSize:48,buffer:6,radius:16}),A.fontWeight=Ve}if(this.localGlyphs[A.fontWeight][y])return this.localGlyphs[A.fontWeight][y];const R=String.fromCharCode(y),{data:U,width:Z,height:$,glyphWidth:re,glyphHeight:ae,glyphLeft:ue,glyphTop:Ce,glyphAdvance:ke}=A.draw(R);return this.localGlyphs[A.fontWeight][y]={id:y,bitmap:new Ph({width:Z,height:$},U),metrics:{width:re/2,height:ae/2,left:ue/2,top:Ce/2-27,advance:ke/2,localGlyph:!0}}}}function Jo(c,a,p,y){const E=[],A=c.image,R=A.pixelRatio,U=A.paddedRect.w-2,Z=A.paddedRect.h-2,$=c.right-c.left,re=c.bottom-c.top,ae=A.stretchX||[[0,U]],ue=A.stretchY||[[0,Z]],Ce=(hn,Tn)=>hn+Tn[1]-Tn[0],ke=ae.reduce(Ce,0),Ve=ue.reduce(Ce,0),We=U-ke,rt=Z-Ve;let ht=0,vt=ke,Tt=0,Ct=Ve,kt=0,ln=We,Yt=0,Kn=rt;if(A.content&&y){const hn=A.content;ht=Po(ae,0,hn[0]),Tt=Po(ue,0,hn[1]),vt=Po(ae,hn[0],hn[2]),Ct=Po(ue,hn[1],hn[3]),kt=hn[0]-ht,Yt=hn[1]-Tt,ln=hn[2]-hn[0]-vt,Kn=hn[3]-hn[1]-Ct}const In=(hn,Tn,Ln,yn)=>{const Jn=Zl(hn.stretch-ht,vt,$,c.left),pr=nl(hn.fixed-kt,ln,hn.stretch,ke),Ri=Zl(Tn.stretch-Tt,Ct,re,c.top),Wa=nl(Tn.fixed-Yt,Kn,Tn.stretch,Ve),hi=Zl(Ln.stretch-ht,vt,$,c.left),mo=nl(Ln.fixed-kt,ln,Ln.stretch,ke),Wn=Zl(yn.stretch-Tt,Ct,re,c.top),is=nl(yn.fixed-Yt,Kn,yn.stretch,Ve),ra=new it(Jn,Ri),Pu=new it(hi,Ri),Ml=new it(hi,Wn),du=new it(Jn,Wn),Ru=new it(pr/R,Wa/R),ia=new it(mo/R,is/R),pa=a*Math.PI/180;if(pa){const Hl=Math.sin(pa),Ou=Math.cos(pa),Gc=[Ou,-Hl,Hl,Ou];ra._matMult(Gc),Pu._matMult(Gc),du._matMult(Gc),Ml._matMult(Gc)}const xs=hn.stretch+hn.fixed,_c=Tn.stretch+Tn.fixed;return{tl:ra,tr:Pu,bl:du,br:Ml,tex:{x:A.paddedRect.x+1+xs,y:A.paddedRect.y+1+_c,w:Ln.stretch+Ln.fixed-xs,h:yn.stretch+yn.fixed-_c},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ru,pixelOffsetBR:ia,minFontScaleX:ln/R/$,minFontScaleY:Kn/R/re,isSDF:p}};if(y&&(A.stretchX||A.stretchY)){const hn=lo(ae,We,ke),Tn=lo(ue,rt,Ve);for(let Ln=0;Ln<hn.length-1;Ln++){const yn=hn[Ln],Jn=hn[Ln+1];for(let pr=0;pr<Tn.length-1;pr++)E.push(In(yn,Tn[pr],Jn,Tn[pr+1]))}}else E.push(In({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:U+1},{fixed:0,stretch:Z+1}));return E}function Po(c,a,p){let y=0;for(const E of c)y+=Math.max(a,Math.min(p,E[1]))-Math.max(a,Math.min(p,E[0]));return y}function lo(c,a,p){const y=[{fixed:-1,stretch:0}];for(const[E,A]of c){const R=y[y.length-1];y.push({fixed:E-R.stretch,stretch:R.stretch}),y.push({fixed:E-R.stretch,stretch:R.stretch+(A-E)})}return y.push({fixed:a+1,stretch:p}),y}function Zl(c,a,p,y){return c/a*p+y}function nl(c,a,p,y){return c-a*p/y}function Ma(c,a,p,y){const E=a+c.positionedLines[y].lineOffset;return 0===y?p+E/2:p+(E+(a+c.positionedLines[y-1].lineOffset))/2}Ei.loadGlyphRange=function(c,a,p,y,E){const A=256*a,R=A+255,U=y.transformRequest(y.normalizeGlyphsURL(p).replace("{fontstack}",c).replace("{range}",`${A}-${R}`),De.Glyphs);oe(U,(Z,$)=>{if(Z)E(Z);else if($){const re={},ae=new Up($).readFields(Xe,{});for(const ue of ae.glyphs)re[ue.id]=ue;E(null,{glyphs:re,ascender:ae.ascender,descender:ae.descender})}})},Ei.TinySDF=class{constructor({fontSize:c=24,buffer:a=3,radius:p=8,cutoff:y=.25,fontFamily:E="sans-serif",fontWeight:A="normal",fontStyle:R="normal"}){this.buffer=a,this.cutoff=y,this.radius=p;const U=this.size=c+4*a,Z=this._createCanvas(U),$=this.ctx=Z.getContext("2d",{willReadFrequently:!0});$.font=`${R} ${A} ${c}px ${E}`,$.textBaseline="alphabetic",$.textAlign="left",$.fillStyle="black",this.gridOuter=new Float64Array(U*U),this.gridInner=new Float64Array(U*U),this.f=new Float64Array(U),this.z=new Float64Array(U+1),this.v=new Uint16Array(U)}_createCanvas(c){const a=document.createElement("canvas");return a.width=a.height=c,a}draw(c){const{width:a,actualBoundingBoxAscent:p,actualBoundingBoxDescent:y,actualBoundingBoxLeft:E,actualBoundingBoxRight:A}=this.ctx.measureText(c),R=Math.floor(p),U=Math.min(this.size-this.buffer,Math.ceil(A-E)),Z=Math.min(this.size-this.buffer,Math.ceil(p)+Math.ceil(y)),$=U+2*this.buffer,re=Z+2*this.buffer,ae=$*re,ue=new Uint8ClampedArray(ae),Ce={data:ue,width:$,height:re,glyphWidth:U,glyphHeight:Z,glyphTop:R,glyphLeft:0,glyphAdvance:a};if(0===U||0===Z)return Ce;const{ctx:ke,buffer:Ve,gridInner:We,gridOuter:rt}=this;ke.clearRect(Ve,Ve,U,Z),ke.fillText(c,Ve,Ve+R+1);const ht=ke.getImageData(Ve,Ve,U,Z);rt.fill(ys,0,ae),We.fill(0,0,ae);for(let vt=0;vt<Z;vt++)for(let Tt=0;Tt<U;Tt++){const Ct=ht.data[4*(vt*U+Tt)+3]/255;if(0===Ct)continue;const kt=(vt+Ve)*$+Tt+Ve;if(1===Ct)rt[kt]=0,We[kt]=ys;else{const ln=.5-Ct;rt[kt]=ln>0?ln*ln:0,We[kt]=ln<0?ln*ln:0}}cu(rt,0,0,$,re,$,this.f,this.v,this.z),cu(We,Ve,Ve,U,Z,$,this.f,this.v,this.z);for(let vt=0;vt<ae;vt++){const Tt=Math.sqrt(rt[vt])-Math.sqrt(We[vt]);ue[vt]=Math.round(255-255*(Tt/this.radius+this.cutoff))}return Ce}};class cl{constructor(a=[],p=hu){if(this.data=a,this.length=this.data.length,this.compare=p,this.length>0)for(let y=(this.length>>1)-1;y>=0;y--)this._down(y)}push(a){this.data.push(a),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const a=this.data[0],p=this.data.pop();return this.length--,this.length>0&&(this.data[0]=p,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:p,compare:y}=this,E=p[a];for(;a>0;){const A=a-1>>1,R=p[A];if(y(E,R)>=0)break;p[a]=R,a=A}p[a]=E}_down(a){const{data:p,compare:y}=this,E=this.length>>1,A=p[a];for(;a<E;){let R=1+(a<<1),U=p[R];const Z=R+1;if(Z<this.length&&y(p[Z],U)<0&&(R=Z,U=p[Z]),y(U,A)>=0)break;p[a]=U,a=R}p[a]=A}}function hu(c,a){return c<a?-1:c>a?1:0}function Io(c,a=1,p=!1){let y=1/0,E=1/0,A=-1/0,R=-1/0;const U=c[0];for(let Ce=0;Ce<U.length;Ce++){const ke=U[Ce];(!Ce||ke.x<y)&&(y=ke.x),(!Ce||ke.y<E)&&(E=ke.y),(!Ce||ke.x>A)&&(A=ke.x),(!Ce||ke.y>R)&&(R=ke.y)}const Z=Math.min(A-y,R-E);let $=Z/2;const re=new cl([],Vp);if(0===Z)return new it(y,E);for(let Ce=y;Ce<A;Ce+=Z)for(let ke=E;ke<R;ke+=Z)re.push(new ku(Ce+$,ke+$,$,c));let ae=function(Ce){let ke=0,Ve=0,We=0;const rt=Ce[0];for(let ht=0,vt=rt.length,Tt=vt-1;ht<vt;Tt=ht++){const Ct=rt[ht],kt=rt[Tt],ln=Ct.x*kt.y-kt.x*Ct.y;Ve+=(Ct.x+kt.x)*ln,We+=(Ct.y+kt.y)*ln,ke+=3*ln}return new ku(Ve/ke,We/ke,0,Ce)}(c),ue=re.length;for(;re.length;){const Ce=re.pop();(Ce.d>ae.d||!ae.d)&&(ae=Ce,p&&console.log("found best %d after %d probes",Math.round(1e4*Ce.d)/1e4,ue)),Ce.max-ae.d<=a||($=Ce.h/2,re.push(new ku(Ce.p.x-$,Ce.p.y-$,$,c)),re.push(new ku(Ce.p.x+$,Ce.p.y-$,$,c)),re.push(new ku(Ce.p.x-$,Ce.p.y+$,$,c)),re.push(new ku(Ce.p.x+$,Ce.p.y+$,$,c)),ue+=4)}return p&&(console.log(`num probes: ${ue}`),console.log(`best distance: ${ae.d}`)),ae.p}function Vp(c,a){return a.max-c.max}function ku(c,a,p,y){this.p=new it(c,a),this.h=p,this.d=function(E,A){let R=!1,U=1/0;for(let Z=0;Z<A.length;Z++){const $=A[Z];for(let re=0,ae=$.length,ue=ae-1;re<ae;ue=re++){const Ce=$[re],ke=$[ue];Ce.y>E.y!=ke.y>E.y&&E.x<(ke.x-Ce.x)*(E.y-Ce.y)/(ke.y-Ce.y)+Ce.x&&(R=!R),U=Math.min(U,Jh(E,Ce,ke))}}return(R?1:-1)*Math.sqrt(U)}(this.p,y),this.max=this.d+this.h*Math.SQRT2}const fp=Number.POSITIVE_INFINITY,Qo=Math.sqrt(2);function Gp(c,a){return a[1]!==fp?function(p,y,E){let A=0,R=0;switch(y=Math.abs(y),E=Math.abs(E),p){case"top-right":case"top-left":case"top":R=E-7;break;case"bottom-right":case"bottom-left":case"bottom":R=7-E}switch(p){case"top-right":case"bottom-right":case"right":A=-y;break;case"top-left":case"bottom-left":case"left":A=y}return[A,R]}(c,a[0],a[1]):function(p,y){let E=0,A=0;y<0&&(y=0);const R=y/Qo;switch(p){case"top-right":case"top-left":A=R-7;break;case"bottom-right":case"bottom-left":A=7-R;break;case"bottom":A=7-y;break;case"top":A=y-7}switch(p){case"top-right":case"bottom-right":E=-R;break;case"top-left":case"bottom-left":E=R;break;case"left":E=y;break;case"right":E=-y}return[E,A]}(c,a[0])}function Qh(c,a,p,y,E,A,R,U,Z){c.createArrays(),c.tilePixelRatio=Bi/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const $=c.layers[0].layout,re=c.layers[0]._unevaluatedLayout._values,ae={};if("composite"===c.textSizeData.kind){const{minZoom:ke,maxZoom:Ve}=c.textSizeData;ae.compositeTextSizes=[re["text-size"].possiblyEvaluate(new Q(ke),U),re["text-size"].possiblyEvaluate(new Q(Ve),U)]}if("composite"===c.iconSizeData.kind){const{minZoom:ke,maxZoom:Ve}=c.iconSizeData;ae.compositeIconSizes=[re["icon-size"].possiblyEvaluate(new Q(ke),U),re["icon-size"].possiblyEvaluate(new Q(Ve),U)]}ae.layoutTextSize=re["text-size"].possiblyEvaluate(new Q(Z+1),U),ae.layoutIconSize=re["icon-size"].possiblyEvaluate(new Q(Z+1),U),ae.textMaxSize=re["text-size"].possiblyEvaluate(new Q(18),U);const ue="map"===$.get("text-rotation-alignment")&&"point"!==$.get("symbol-placement"),Ce=$.get("text-size");for(const ke of c.features){const Ve=$.get("text-font").evaluate(ke,{},U).join(","),We=Ce.evaluate(ke,{},U),rt=ae.layoutTextSize.evaluate(ke,{},U),ht=(ae.layoutIconSize.evaluate(ke,{},U),{horizontal:{},vertical:void 0}),vt=ke.text;let Tt,Ct=[0,0];if(vt){const Yt=vt.toString(),Kn=24*$.get("text-letter-spacing").evaluate(ke,{},U),In=24*$.get("text-line-height").evaluate(ke,{},U),hn=au(Yt)?Kn:0,Tn=$.get("text-anchor").evaluate(ke,{},U),Ln=$.get("text-variable-anchor");if(!Ln){const hi=$.get("text-radial-offset").evaluate(ke,{},U);Ct=hi?Gp(Tn,[24*hi,fp]):$.get("text-offset").evaluate(ke,{},U).map(mo=>24*mo)}let yn=ue?"center":$.get("text-justify").evaluate(ke,{},U);const Jn=$.get("symbol-placement"),pr="point"===Jn,Ri="point"===Jn?24*$.get("text-max-width").evaluate(ke,{},U):0,Wa=hi=>{c.allowVerticalPlacement&&dc(Yt)&&(ht.vertical=An(vt,a,p,E,Ve,Ri,In,Tn,hi,hn,Ct,Lt.vertical,!0,Jn,rt,We))};if(!ue&&Ln){const hi="auto"===yn?Ln.map(Wn=>ff(Wn)):[yn];let mo=!1;for(let Wn=0;Wn<hi.length;Wn++){const is=hi[Wn];if(!ht.horizontal[is])if(mo)ht.horizontal[is]=ht.horizontal[0];else{const ra=An(vt,a,p,E,Ve,Ri,In,"center",is,hn,Ct,Lt.horizontal,!1,Jn,rt,We);ra&&(ht.horizontal[is]=ra,mo=1===ra.positionedLines.length)}}Wa("left")}else{if("auto"===yn&&(yn=ff(Tn)),pr||$.get("text-writing-mode").indexOf("horizontal")>=0||!dc(Yt)){const hi=An(vt,a,p,E,Ve,Ri,In,Tn,yn,hn,Ct,Lt.horizontal,!1,Jn,rt,We);hi&&(ht.horizontal[yn]=hi)}Wa("point"===Jn?"left":yn)}}let kt=!1;if(ke.icon&&ke.icon.name){const Yt=y[ke.icon.name];Yt&&(Tt=so(E[ke.icon.name],$.get("icon-offset").evaluate(ke,{},U),$.get("icon-anchor").evaluate(ke,{},U)),kt=Yt.sdf,void 0===c.sdfIcons?c.sdfIcons=Yt.sdf:c.sdfIcons!==Yt.sdf&&Ui("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Yt.pixelRatio!==c.pixelRatio||0!==$.get("icon-rotate").constantOr(1))&&(c.iconsNeedLinear=!0))}const ln=mf(ht.horizontal)||ht.vertical;c.iconsInText||(c.iconsInText=!!ln&&ln.iconsInText),(ln||Tt)&&tm(c,ke,ht,Tt,y,ae,rt,0,Ct,kt,R,U)}A&&c.generateCollisionDebugBuffers(Z,c.collisionBoxArray)}function ff(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tm(c,a,p,y,E,A,R,U,Z,$,re,ae){let ue=A.textMaxSize.evaluate(a,{},ae);void 0===ue&&(ue=R);const Ce=c.layers[0].layout,ke=Ce.get("icon-offset").evaluate(a,{},ae),Ve=mf(p.horizontal)||p.vertical,We=R/24,rt=c.tilePixelRatio*ue/24,ht=c.tilePixelRatio*Ce.get("symbol-spacing"),vt=Ce.get("text-padding")*c.tilePixelRatio,Tt=Ce.get("icon-padding")*c.tilePixelRatio,Ct=fn(Ce.get("text-max-angle")),kt="map"===Ce.get("text-rotation-alignment")&&"point"!==Ce.get("symbol-placement"),ln="map"===Ce.get("icon-rotation-alignment")&&"point"!==Ce.get("symbol-placement"),Yt=Ce.get("symbol-placement"),Kn=ht/2,In=Ce.get("icon-text-fit");let hn;y&&"none"!==In&&(c.allowVerticalPlacement&&p.vertical&&(hn=Tr(y,p.vertical,In,Ce.get("icon-text-fit-padding"),ke,We)),Ve&&(y=Tr(y,Ve,In,Ce.get("icon-text-fit-padding"),ke,We)));const Tn=(Ln,yn)=>{yn.x<0||yn.x>=Bi||yn.y<0||yn.y>=Bi||function(Jn,pr,Ri,Wa,hi,mo,Wn,is,ra,Pu,Ml,du,Ru,ia,pa,xs,_c,Hl,Ou,Gc,Ws,op,os,Wl,$s){const Al=Jn.addToLineVertexArray(pr,Wa);let Dl,Lu,da,hh,$d,Hp,fd,Fo=0,xc=0,Ef=0,Zg=0,Hg=-1,Wg=-1;const Sf={};let nb=ci(""),kx=0,Px=0;if(void 0===ra._unevaluatedLayout.getValue("text-radial-offset")?[kx,Px]=ra.layout.get("text-offset").evaluate(Ws,{},$s).map(vp=>24*vp):(kx=24*ra.layout.get("text-radial-offset").evaluate(Ws,{},$s),Px=fp),Jn.allowVerticalPlacement&&hi.vertical){const vp=hi.vertical;if(pa)Hp=gf(vp),is&&(fd=gf(is));else{const _p=ra.layout.get("text-rotate").evaluate(Ws,{},$s)+90;da=nm(Pu,Ri,pr,Ml,du,Ru,vp,ia,_p,xs),is&&(hh=nm(Pu,Ri,pr,Ml,du,Ru,is,Hl,_p))}}if(mo){const vp=ra.layout.get("icon-rotate").evaluate(Ws,{},$s),_p="none"!==ra.layout.get("icon-text-fit"),g0=Jo(mo,vp,os,_p),ob=is?Jo(is,vp,os,_p):void 0;Lu=nm(Pu,Ri,pr,Ml,du,Ru,mo,Hl,vp),Fo=4*g0.length;const y0=Jn.iconSizeData;let $g=null;"source"===y0.kind?($g=[jc*ra.layout.get("icon-size").evaluate(Ws,{},$s)],$g[0]>ep&&Ui(`${Jn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===y0.kind&&($g=[jc*op.compositeIconSizes[0].evaluate(Ws,{},$s),jc*op.compositeIconSizes[1].evaluate(Ws,{},$s)],($g[0]>ep||$g[1]>ep)&&Ui(`${Jn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Jn.addSymbols(Jn.icon,g0,$g,Gc,Ou,Ws,!1,Ri,pr,Al.lineStartIndex,Al.lineLength,-1,Wl,$s),Hg=Jn.icon.placedSymbolArray.length-1,ob&&(xc=4*ob.length,Jn.addSymbols(Jn.icon,ob,$g,Gc,Ou,Ws,Lt.vertical,Ri,pr,Al.lineStartIndex,Al.lineLength,-1,Wl,$s),Wg=Jn.icon.placedSymbolArray.length-1)}for(const vp in hi.horizontal){const _p=hi.horizontal[vp];Dl||(nb=ci(_p.text),pa?$d=gf(_p):Dl=nm(Pu,Ri,pr,Ml,du,Ru,_p,ia,ra.layout.get("text-rotate").evaluate(Ws,{},$s),xs));const g0=1===_p.positionedLines.length;if(Ef+=ud(Jn,Ri,pr,_p,Wn,ra,pa,Ws,xs,Al,hi.vertical?Lt.horizontal:Lt.horizontalOnly,g0?Object.keys(hi.horizontal):[vp],Sf,Hg,op,Wl,$s),g0)break}hi.vertical&&(Zg+=ud(Jn,Ri,pr,hi.vertical,Wn,ra,pa,Ws,xs,Al,Lt.vertical,["vertical"],Sf,Wg,op,Wl,$s));let um=-1;const rb=(vp,_p)=>vp?Math.max(vp,_p):_p;um=rb($d,um),um=rb(Hp,um),um=rb(fd,um);const ib=um>-1?1:0;Jn.glyphOffsetArray.length>=qp.MAX_GLYPHS&&Ui("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Ws.sortKey&&Jn.addToSortKeyRanges(Jn.symbolInstances.length,Ws.sortKey),Jn.symbolInstances.emplaceBack(Ri.x,Ri.y,Ri.z,pr.x,pr.y,Sf.right>=0?Sf.right:-1,Sf.center>=0?Sf.center:-1,Sf.left>=0?Sf.left:-1,Sf.vertical>=0?Sf.vertical:-1,Hg,Wg,nb,void 0!==Dl?Dl:Jn.collisionBoxArray.length,void 0!==Dl?Dl+1:Jn.collisionBoxArray.length,void 0!==da?da:Jn.collisionBoxArray.length,void 0!==da?da+1:Jn.collisionBoxArray.length,void 0!==Lu?Lu:Jn.collisionBoxArray.length,void 0!==Lu?Lu+1:Jn.collisionBoxArray.length,hh||Jn.collisionBoxArray.length,hh?hh+1:Jn.collisionBoxArray.length,Ml,Ef,Zg,Fo,xc,ib,0,kx,Px,um)}(c,yn,yn,Ln,p,y,E,hn,c.layers[0],c.collisionBoxArray,a.index,a.sourceLayerIndex,c.index,vt,kt,Z,0,Tt,ln,ke,a,A,$,re,ae)};if("line"===Yt)for(const Ln of uu(a.geometry,0,0,Bi,Bi)){const yn=Hs(Ln,ht,Ct,p.vertical||Ve,y,24,rt,c.overscaling,Bi);for(const Jn of yn){const pr=Ve;pr&&zg(c,pr.text,Kn,Jn)||Tn(Ln,Jn)}}else if("line-center"===Yt){for(const Ln of a.geometry)if(Ln.length>1){const yn=gs(Ln,Ct,p.vertical||Ve,y,24,rt);yn&&Tn(Ln,yn)}}else if("Polygon"===a.type)for(const Ln of Um(a.geometry,0)){const yn=Io(Ln,16);Tn(Ln[0],new ji(yn.x,yn.y,0,0,void 0))}else if("LineString"===a.type)for(const Ln of a.geometry)Tn(Ln,new ji(Ln[0].x,Ln[0].y,0,0,void 0));else if("Point"===a.type)for(const Ln of a.geometry)for(const yn of Ln)Tn([yn],new ji(yn.x,yn.y,0,0,void 0))}const ep=32640;function ud(c,a,p,y,E,A,R,U,Z,$,re,ae,ue,Ce,ke,Ve,We){const rt=function(Tt,Ct,kt,ln,Yt,Kn,In,hn){const Tn=[];if(0===Ct.positionedLines.length)return Tn;const Ln=ln.layout.get("text-rotate").evaluate(Kn,{})*Math.PI/180,yn=function(hi){const mo=hi[0],Wn=hi[1],is=mo*Wn;return is>0?[mo,-Wn]:is<0?[-mo,Wn]:0===mo?[Wn,mo]:[Wn,-mo]}(kt);let Jn=Math.abs(Ct.top-Ct.bottom);for(const hi of Ct.positionedLines)Jn-=hi.lineOffset;const pr=Ct.positionedLines.length,Ri=Jn/pr;let Wa=Ct.top-kt[1];for(let hi=0;hi<pr;++hi){const mo=Ct.positionedLines[hi];Wa=Ma(Ct,Ri,Wa,hi);for(const Wn of mo.positionedGlyphs){if(!Wn.rect)continue;const is=Wn.rect||{};let ra=4,Pu=!0,Ml=1,du=0;if(Wn.imageName){const da=In[Wn.imageName];if(!da)continue;if(da.sdf){Ui("SDF images are not supported in formatted text and will be ignored.");continue}Pu=!1,Ml=da.pixelRatio,ra=1/Ml}const Ru=(Yt||hn)&&Wn.vertical,ia=Wn.metrics.advance*Wn.scale/2,pa=Wn.metrics,xs=Wn.rect;if(null===xs)continue;hn&&Ct.verticalizable&&(du=Wn.imageName?ia-Wn.metrics.width*Wn.scale/2:0);const _c=Yt?[Wn.x+ia,Wn.y]:[0,0];let Hl=[0,0],Ou=[0,0],Gc=!1;Yt||(Ru?(Ou=[Wn.x+ia+yn[0],Wn.y+yn[1]-du],Gc=!0):Hl=[Wn.x+ia+kt[0],Wn.y+kt[1]-du]);const Ws=xs.w*Wn.scale/(Ml*(Wn.localGlyph?2:1)),op=xs.h*Wn.scale/(Ml*(Wn.localGlyph?2:1));let os,Wl,$s,Al;if(Ru){const da=Wn.y-Wa,hh=new it(-ia,ia-da),$d=-Math.PI/2,Hp=new it(...Ou);os=new it(-ia+Hl[0],Hl[1]),os._rotateAround($d,hh)._add(Hp),os.x+=-da+ia,os.y-=(pa.left-ra)*Wn.scale;const fd=Wn.imageName?pa.advance*Wn.scale:24*Wn.scale,Fo=String.fromCharCode(Wn.glyph);Fg(Fo)?os.x+=(1-ra)*Wn.scale:Nv(Fo)?os.x+=fd-pa.height*Wn.scale+(-ra-1)*Wn.scale:os.x+=Wn.imageName||pa.width+2*ra===xs.w&&pa.height+2*ra===xs.h?(fd-op)/2:(fd-(pa.height+2*ra)*Wn.scale)/2,Wl=new it(os.x,os.y-Ws),$s=new it(os.x+op,os.y),Al=new it(os.x+op,os.y-Ws)}else{const da=(pa.left-ra)*Wn.scale-ia+Hl[0],hh=(-pa.top-ra)*Wn.scale+Hl[1],$d=da+Ws,Hp=hh+op;os=new it(da,hh),Wl=new it($d,hh),$s=new it(da,Hp),Al=new it($d,Hp)}if(Ln){let da;da=Yt?new it(0,0):Gc?new it(yn[0],yn[1]):new it(kt[0],kt[1]),os._rotateAround(Ln,da),Wl._rotateAround(Ln,da),$s._rotateAround(Ln,da),Al._rotateAround(Ln,da)}const Dl=new it(0,0),Lu=new it(0,0);Tn.push({tl:os,tr:Wl,bl:$s,br:Al,tex:is,writingMode:Ct.writingMode,glyphOffset:_c,sectionIndex:Wn.sectionIndex,isSDF:Pu,pixelOffsetTL:Dl,pixelOffsetBR:Lu,minFontScaleX:0,minFontScaleY:0})}}return Tn}(0,y,Z,A,R,U,E,c.allowVerticalPlacement),ht=c.textSizeData;let vt=null;"source"===ht.kind?(vt=[jc*A.layout.get("text-size").evaluate(U,{},We)],vt[0]>ep&&Ui(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ht.kind&&(vt=[jc*ke.compositeTextSizes[0].evaluate(U,{},We),jc*ke.compositeTextSizes[1].evaluate(U,{},We)],(vt[0]>ep||vt[1]>ep)&&Ui(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),c.addSymbols(c.text,rt,vt,Z,R,U,re,a,p,$.lineStartIndex,$.lineLength,Ce,Ve,We);for(const Tt of ae)ue[Tt]=c.text.placedSymbolArray.length-1;return 4*rt.length}function mf(c){for(const a in c)return c[a];return null}function nm(c,a,p,y,E,A,R,U,Z,$){let re=R.top,ae=R.bottom,ue=R.left,Ce=R.right;const ke=R.collisionPadding;if(ke&&(ue-=ke[0],re-=ke[1],Ce+=ke[2],ae+=ke[3]),Z){const Ve=new it(ue,re),We=new it(Ce,re),rt=new it(ue,ae),ht=new it(Ce,ae),vt=fn(Z);let Tt=new it(0,0);$&&(Tt=new it($[0],$[1])),Ve._rotateAround(vt,Tt),We._rotateAround(vt,Tt),rt._rotateAround(vt,Tt),ht._rotateAround(vt,Tt),ue=Math.min(Ve.x,We.x,rt.x,ht.x),Ce=Math.max(Ve.x,We.x,rt.x,ht.x),re=Math.min(Ve.y,We.y,rt.y,ht.y),ae=Math.max(Ve.y,We.y,rt.y,ht.y)}return c.emplaceBack(a.x,a.y,a.z,p.x,p.y,ue,re,Ce,ae,U,y,E,A),c.length-1}function gf(c){c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const a=c.bottom-c.top;return a>0?Math.max(10,a):null}function zg(c,a,p,y){const E=c.compareText;if(a in E){const A=E[a];for(let R=A.length-1;R>=0;R--)if(y.dist(A[R])<p)return!0}else E[a]=[];return E[a].push(y),!1}const Fi=jp.VectorTileFeature.types,rn=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function tp(c,a,p,y,E,A,R,U,Z,$,re,ae,ue,Ce,ke,Ve){const We=re?Math.min(ep,Math.round(re[0])):0,rt=re?Math.min(ep,Math.round(re[1])):0;c.emplaceBack(a,p,Math.round(32*R),Math.round(32*U),Z,$,(We<<1)+(ae?1:0),rt,16*ue,16*Ce,256*ke,256*Ve,y,E,A,0)}function yf(c,a,p){c.emplaceBack(a.x,a.y,p),c.emplaceBack(a.x,a.y,p),c.emplaceBack(a.x,a.y,p),c.emplaceBack(a.x,a.y,p)}function jd(c){for(const a of c.sections)if(I(a.text))return!0;return!1}class pu{constructor(a){this.layoutVertexArray=new Cr,this.indexArray=new Ko,this.programConfigurations=a,this.segments=new Zs,this.dynamicLayoutVertexArray=new gr,this.opacityVertexArray=new Wr,this.placedSymbolArray=new jt}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(a,p,y,E){this.isEmpty()||(y&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Ta.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,p),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,a0.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,rn,!0),this.opacityVertexBuffer.itemSize=1),(y||E)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Zn("SymbolBuffers",pu);class Ud{constructor(a,p,y){this.layoutVertexArray=new a,this.layoutAttributes=p,this.indexArray=new y,this.segments=new Zs,this.collisionVertexArray=new xo,this.collisionVertexArrayExt=new gr}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,s0.members,!0),this.collisionVertexBufferExt=a.createVertexBuffer(this.collisionVertexArrayExt,em.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Zn("CollisionBuffers",Ud);class qp{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(R=>R.id),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Pd([]),this.placementViewportMatrix=Pd([]);const p=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Fd(this.zoom,p["text-size"]),this.iconSizeData=Fd(this.zoom,p["icon-size"]);const y=this.layers[0].layout,E=y.get("symbol-sort-key"),A=y.get("symbol-z-order");this.canOverlap=y.get("text-allow-overlap")||y.get("icon-allow-overlap")||y.get("text-ignore-placement")||y.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==A&&void 0!==E.constantOr(1),this.sortFeaturesByY=("viewport-y"===A||"auto"===A&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=y.get("text-writing-mode").map(R=>Lt[R]),this.stateDependentLayerIds=this.layers.filter(R=>R.isStateDependent()).map(R=>R.id),this.sourceID=a.sourceID}createArrays(){this.text=new pu(new es(this.layers,this.zoom,a=>/^text/.test(a))),this.icon=new pu(new es(this.layers,this.zoom,a=>/^icon/.test(a))),this.glyphOffsetArray=new Sn,this.lineVertexArray=new ar,this.symbolInstances=new cn}calculateGlyphDependencies(a,p,y,E,A){for(let R=0;R<a.length;R++)if(p[a.charCodeAt(R)]=!0,E&&A){const U=df[a.charAt(R)];U&&(p[U.charCodeAt(0)]=!0)}}populate(a,p,y,E){const A=this.layers[0],R=A.layout,U=R.get("text-font"),Z=R.get("text-field"),$=R.get("icon-image"),re=("constant"!==Z.value.kind||Z.value.value instanceof ga&&!Z.value.value.isEmpty()||Z.value.value.toString().length>0)&&("constant"!==U.value.kind||U.value.value.length>0),ae="constant"!==$.value.kind||!!$.value.value||Object.keys($.parameters).length>0,ue=R.get("symbol-sort-key");if(this.features=[],!re&&!ae)return;const Ce=p.iconDependencies,ke=p.glyphDependencies,Ve=p.availableImages,We=new Q(this.zoom);for(const{feature:rt,id:ht,index:vt,sourceLayerIndex:Tt}of a){const Ct=A._featureFilter.needGeometry,kt=Mm(rt,Ct);if(!A._featureFilter.filter(We,kt,y))continue;let ln,Yt;if(Ct||(kt.geometry=gc(rt,y,E)),re){const In=A.getValueAndResolveTokens("text-field",kt,y,Ve),hn=ga.factory(In);jd(hn)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===W()||this.hasRTLText&&ee.isParsed())&&(ln=zd(hn,A,kt))}if(ae){const In=A.getValueAndResolveTokens("icon-image",kt,y,Ve);Yt=In instanceof $o?In:$o.fromString(In)}if(!ln&&!Yt)continue;const Kn=this.sortFeaturesByKey?ue.evaluate(kt,{},y):void 0;if(this.features.push({id:ht,text:ln,icon:Yt,index:vt,sourceLayerIndex:Tt,geometry:kt.geometry,properties:rt.properties,type:Fi[rt.type],sortKey:Kn}),Yt&&(Ce[Yt.name]=!0),ln){const In=U.evaluate(kt,{},y).join(","),hn="map"===R.get("text-rotation-alignment")&&"point"!==R.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Lt.vertical)>=0;for(const Tn of ln.sections)if(Tn.image)Ce[Tn.image.name]=!0;else{const Ln=dc(ln.toString()),yn=Tn.fontStack||In,Jn=ke[yn]=ke[yn]||{};this.calculateGlyphDependencies(Tn.text,Jn,hn,this.allowVerticalPlacement,Ln)}}}"line"===R.get("symbol-placement")&&(this.features=function(rt){const ht={},vt={},Tt=[];let Ct=0;function kt(In){Tt.push(rt[In]),Ct++}function ln(In,hn,Tn){const Ln=vt[In];return delete vt[In],vt[hn]=Ln,Tt[Ln].geometry[0].pop(),Tt[Ln].geometry[0]=Tt[Ln].geometry[0].concat(Tn[0]),Ln}function Yt(In,hn,Tn){const Ln=ht[hn];return delete ht[hn],ht[In]=Ln,Tt[Ln].geometry[0].shift(),Tt[Ln].geometry[0]=Tn[0].concat(Tt[Ln].geometry[0]),Ln}function Kn(In,hn,Tn){const Ln=Tn?hn[0][hn[0].length-1]:hn[0][0];return`${In}:${Ln.x}:${Ln.y}`}for(let In=0;In<rt.length;In++){const hn=rt[In],Tn=hn.geometry,Ln=hn.text?hn.text.toString():null;if(!Ln){kt(In);continue}const yn=Kn(Ln,Tn),Jn=Kn(Ln,Tn,!0);if(yn in vt&&Jn in ht&&vt[yn]!==ht[Jn]){const pr=Yt(yn,Jn,Tn),Ri=ln(yn,Jn,Tt[pr].geometry);delete ht[yn],delete vt[Jn],vt[Kn(Ln,Tt[Ri].geometry,!0)]=Ri,Tt[pr].geometry=null}else yn in vt?ln(yn,Jn,Tn):Jn in ht?Yt(yn,Jn,Tn):(kt(In),ht[yn]=Ct-1,vt[Jn]=Ct-1)}return Tt.filter(In=>In.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((rt,ht)=>rt.sortKey-ht.sortKey)}update(a,p,y,E){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,p,this.layers,y,E),this.icon.programConfigurations.updatePaintArrays(a,p,this.layers,y,E))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,p){const y=this.lineVertexArray.length;if(void 0!==a.segment){let E=a.dist(p[a.segment+1]),A=a.dist(p[a.segment]);const R={};for(let U=a.segment+1;U<p.length;U++)R[U]={x:p[U].x,y:p[U].y,tileUnitDistanceFromAnchor:E},U<p.length-1&&(E+=p[U+1].dist(p[U]));for(let U=a.segment||0;U>=0;U--)R[U]={x:p[U].x,y:p[U].y,tileUnitDistanceFromAnchor:A},U>0&&(A+=p[U-1].dist(p[U]));for(let U=0;U<p.length;U++){const Z=R[U];this.lineVertexArray.emplaceBack(Z.x,Z.y,Z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:y,lineLength:this.lineVertexArray.length-y}}addSymbols(a,p,y,E,A,R,U,Z,$,re,ae,ue,Ce,ke){const Ve=a.indexArray,We=a.layoutVertexArray,rt=a.segments.prepareSegment(4*p.length,We,Ve,this.canOverlap?R.sortKey:void 0),ht=this.glyphOffsetArray.length,vt=rt.vertexLength,Tt=this.allowVerticalPlacement&&U===Lt.vertical?Math.PI/2:0,Ct=R.text&&R.text.sections;for(let kt=0;kt<p.length;kt++){const{tl:ln,tr:Yt,bl:Kn,br:In,tex:hn,pixelOffsetTL:Tn,pixelOffsetBR:Ln,minFontScaleX:yn,minFontScaleY:Jn,glyphOffset:pr,isSDF:Ri,sectionIndex:Wa}=p[kt],hi=rt.vertexLength,mo=pr[1];tp(We,Z.x,Z.y,Z.z,$.x,$.y,ln.x,mo+ln.y,hn.x,hn.y,y,Ri,Tn.x,Tn.y,yn,Jn),tp(We,Z.x,Z.y,Z.z,$.x,$.y,Yt.x,mo+Yt.y,hn.x+hn.w,hn.y,y,Ri,Ln.x,Tn.y,yn,Jn),tp(We,Z.x,Z.y,Z.z,$.x,$.y,Kn.x,mo+Kn.y,hn.x,hn.y+hn.h,y,Ri,Tn.x,Ln.y,yn,Jn),tp(We,Z.x,Z.y,Z.z,$.x,$.y,In.x,mo+In.y,hn.x+hn.w,hn.y+hn.h,y,Ri,Ln.x,Ln.y,yn,Jn),yf(a.dynamicLayoutVertexArray,Z,Tt),Ve.emplaceBack(hi,hi+1,hi+2),Ve.emplaceBack(hi+1,hi+2,hi+3),rt.vertexLength+=4,rt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(pr[0]),kt!==p.length-1&&Wa===p[kt+1].sectionIndex||a.programConfigurations.populatePaintArrays(We.length,R,R.index,{},Ce,ke,Ct&&Ct[Wa])}a.placedSymbolArray.emplaceBack(Z.x,Z.y,Z.z,$.x,$.y,ht,this.glyphOffsetArray.length-ht,vt,re,ae,$.segment,y?y[0]:0,y?y[1]:0,E[0],E[1],U,0,!1,0,ue,0)}_commitLayoutVertex(a,p,y,E,A,R,U){a.emplaceBack(p,y,E,A,R,Math.round(U.x),Math.round(U.y))}_addCollisionDebugVertices(a,p,y,E,A,R,U){const Z=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),$=Z.vertexLength,re=U.tileAnchorX,ae=U.tileAnchorY;for(let Ce=0;Ce<4;Ce++)y.collisionVertexArray.emplaceBack(0,0,0,0);y.collisionVertexArrayExt.emplaceBack(p,-a.padding,-a.padding),y.collisionVertexArrayExt.emplaceBack(p,a.padding,-a.padding),y.collisionVertexArrayExt.emplaceBack(p,a.padding,a.padding),y.collisionVertexArrayExt.emplaceBack(p,-a.padding,a.padding),this._commitLayoutVertex(y.layoutVertexArray,E,A,R,re,ae,new it(a.x1,a.y1)),this._commitLayoutVertex(y.layoutVertexArray,E,A,R,re,ae,new it(a.x2,a.y1)),this._commitLayoutVertex(y.layoutVertexArray,E,A,R,re,ae,new it(a.x2,a.y2)),this._commitLayoutVertex(y.layoutVertexArray,E,A,R,re,ae,new it(a.x1,a.y2)),Z.vertexLength+=4;const ue=y.indexArray;ue.emplaceBack($,$+1),ue.emplaceBack($+1,$+2),ue.emplaceBack($+2,$+3),ue.emplaceBack($+3,$),Z.primitiveLength+=4}_addTextDebugCollisionBoxes(a,p,y,E,A,R){for(let U=E;U<A;U++){const Z=y.get(U),$=this.getSymbolInstanceTextSize(a,R,p,U);this._addCollisionDebugVertices(Z,$,this.textCollisionBox,Z.projectedAnchorX,Z.projectedAnchorY,Z.projectedAnchorZ,R)}}_addIconDebugCollisionBoxes(a,p,y,E,A,R){for(let U=E;U<A;U++){const Z=y.get(U),$=this.getSymbolInstanceIconSize(a,p,U);this._addCollisionDebugVertices(Z,$,this.iconCollisionBox,Z.projectedAnchorX,Z.projectedAnchorY,Z.projectedAnchorZ,R)}}generateCollisionDebugBuffers(a,p){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ud(ha,zv.members,K),this.iconCollisionBox=new Ud(ha,zv.members,K);const y=ts(this.iconSizeData,a),E=ts(this.textSizeData,a);for(let A=0;A<this.symbolInstances.length;A++){const R=this.symbolInstances.get(A);this._addTextDebugCollisionBoxes(E,a,p,R.textBoxStartIndex,R.textBoxEndIndex,R),this._addTextDebugCollisionBoxes(E,a,p,R.verticalTextBoxStartIndex,R.verticalTextBoxEndIndex,R),this._addIconDebugCollisionBoxes(y,a,p,R.iconBoxStartIndex,R.iconBoxEndIndex,R),this._addIconDebugCollisionBoxes(y,a,p,R.verticalIconBoxStartIndex,R.verticalIconBoxEndIndex,R)}}getSymbolInstanceTextSize(a,p,y,E){const A=this.text.placedSymbolArray.get(p.rightJustifiedTextSymbolIndex>=0?p.rightJustifiedTextSymbolIndex:p.centerJustifiedTextSymbolIndex>=0?p.centerJustifiedTextSymbolIndex:p.leftJustifiedTextSymbolIndex>=0?p.leftJustifiedTextSymbolIndex:p.verticalPlacedTextSymbolIndex>=0?p.verticalPlacedTextSymbolIndex:E),R=Zm(this.textSizeData,a,A)/24;return this.tilePixelRatio*R}getSymbolInstanceIconSize(a,p,y){const E=this.icon.placedSymbolArray.get(y),A=Zm(this.iconSizeData,a,E);return this.tilePixelRatio*A}_commitDebugCollisionVertexUpdate(a,p,y){a.emplaceBack(p,-y,-y),a.emplaceBack(p,y,-y),a.emplaceBack(p,y,y),a.emplaceBack(p,-y,y)}_updateTextDebugCollisionBoxes(a,p,y,E,A,R){for(let U=E;U<A;U++){const Z=y.get(U),$=this.getSymbolInstanceTextSize(a,R,p,U);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,$,Z.padding)}}_updateIconDebugCollisionBoxes(a,p,y,E,A){for(let R=E;R<A;R++){const U=y.get(R),Z=this.getSymbolInstanceIconSize(a,p,R);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,Z,U.padding)}}updateCollisionDebugBuffers(a,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const y=ts(this.iconSizeData,a),E=ts(this.textSizeData,a);for(let A=0;A<this.symbolInstances.length;A++){const R=this.symbolInstances.get(A);this._updateTextDebugCollisionBoxes(E,a,p,R.textBoxStartIndex,R.textBoxEndIndex,R),this._updateTextDebugCollisionBoxes(E,a,p,R.verticalTextBoxStartIndex,R.verticalTextBoxEndIndex,R),this._updateIconDebugCollisionBoxes(y,a,p,R.iconBoxStartIndex,R.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(y,a,p,R.verticalIconBoxStartIndex,R.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(a,p,y,E,A,R,U,Z,$){const re={};for(let ae=p;ae<y;ae++){const ue=a.get(ae);re.textBox={x1:ue.x1,y1:ue.y1,x2:ue.x2,y2:ue.y2,padding:ue.padding,projectedAnchorX:ue.projectedAnchorX,projectedAnchorY:ue.projectedAnchorY,projectedAnchorZ:ue.projectedAnchorZ,tileAnchorX:ue.tileAnchorX,tileAnchorY:ue.tileAnchorY},re.textFeatureIndex=ue.featureIndex;break}for(let ae=E;ae<A;ae++){const ue=a.get(ae);re.verticalTextBox={x1:ue.x1,y1:ue.y1,x2:ue.x2,y2:ue.y2,padding:ue.padding,projectedAnchorX:ue.projectedAnchorX,projectedAnchorY:ue.projectedAnchorY,projectedAnchorZ:ue.projectedAnchorZ,tileAnchorX:ue.tileAnchorX,tileAnchorY:ue.tileAnchorY},re.verticalTextFeatureIndex=ue.featureIndex;break}for(let ae=R;ae<U;ae++){const ue=a.get(ae);re.iconBox={x1:ue.x1,y1:ue.y1,x2:ue.x2,y2:ue.y2,padding:ue.padding,projectedAnchorX:ue.projectedAnchorX,projectedAnchorY:ue.projectedAnchorY,projectedAnchorZ:ue.projectedAnchorZ,tileAnchorX:ue.tileAnchorX,tileAnchorY:ue.tileAnchorY},re.iconFeatureIndex=ue.featureIndex;break}for(let ae=Z;ae<$;ae++){const ue=a.get(ae);re.verticalIconBox={x1:ue.x1,y1:ue.y1,x2:ue.x2,y2:ue.y2,padding:ue.padding,projectedAnchorX:ue.projectedAnchorX,projectedAnchorY:ue.projectedAnchorY,projectedAnchorZ:ue.projectedAnchorZ,tileAnchorX:ue.tileAnchorX,tileAnchorY:ue.tileAnchorY},re.verticalIconFeatureIndex=ue.featureIndex;break}return re}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let p=0;p<this.symbolInstances.length;p++){const y=this.symbolInstances.get(p);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,y.textBoxStartIndex,y.textBoxEndIndex,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y.iconBoxStartIndex,y.iconBoxEndIndex,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(a,p){const y=a.placedSymbolArray.get(p),E=y.vertexStartIndex+4*y.numGlyphs;for(let A=y.vertexStartIndex;A<E;A+=4)a.indexArray.emplaceBack(A,A+1,A+2),a.indexArray.emplaceBack(A+1,A+2,A+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const p=Math.sin(a),y=Math.cos(a),E=[],A=[],R=[];for(let U=0;U<this.symbolInstances.length;++U){R.push(U);const Z=this.symbolInstances.get(U);E.push(0|Math.round(p*Z.tileAnchorX+y*Z.tileAnchorY)),A.push(Z.featureIndex)}return R.sort((U,Z)=>E[U]-E[Z]||A[Z]-A[U]),R}addToSortKeyRanges(a,p){const y=this.sortKeyRanges[this.sortKeyRanges.length-1];y&&y.sortKey===p?y.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:p,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const p of this.symbolInstanceIndexes){const y=this.symbolInstances.get(p);this.featureSortOrder.push(y.featureIndex),[y.rightJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.leftJustifiedTextSymbolIndex].forEach((E,A,R)=>{E>=0&&R.indexOf(E)===A&&this.addIndicesForPlacedSymbol(this.text,E)}),y.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,y.verticalPlacedTextSymbolIndex),y.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.placedIconSymbolIndex),y.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Zn("SymbolBucket",qp,{omit:["layers","collisionBoxArray","features","compareText"]}),qp.MAX_GLYPHS=65535,qp.addDynamicAttributes=yf;const Hm=new Ot({"symbol-placement":new Me(Je.layout_symbol["symbol-placement"]),"symbol-spacing":new Me(Je.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Me(Je.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ue(Je.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Me(Je.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Me(Je.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Me(Je.layout_symbol["icon-ignore-placement"]),"icon-optional":new Me(Je.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Me(Je.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ue(Je.layout_symbol["icon-size"]),"icon-text-fit":new Me(Je.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Me(Je.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ue(Je.layout_symbol["icon-image"]),"icon-rotate":new Ue(Je.layout_symbol["icon-rotate"]),"icon-padding":new Me(Je.layout_symbol["icon-padding"]),"icon-keep-upright":new Me(Je.layout_symbol["icon-keep-upright"]),"icon-offset":new Ue(Je.layout_symbol["icon-offset"]),"icon-anchor":new Ue(Je.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Me(Je.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Me(Je.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Me(Je.layout_symbol["text-rotation-alignment"]),"text-field":new Ue(Je.layout_symbol["text-field"]),"text-font":new Ue(Je.layout_symbol["text-font"]),"text-size":new Ue(Je.layout_symbol["text-size"]),"text-max-width":new Ue(Je.layout_symbol["text-max-width"]),"text-line-height":new Ue(Je.layout_symbol["text-line-height"]),"text-letter-spacing":new Ue(Je.layout_symbol["text-letter-spacing"]),"text-justify":new Ue(Je.layout_symbol["text-justify"]),"text-radial-offset":new Ue(Je.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Me(Je.layout_symbol["text-variable-anchor"]),"text-anchor":new Ue(Je.layout_symbol["text-anchor"]),"text-max-angle":new Me(Je.layout_symbol["text-max-angle"]),"text-writing-mode":new Me(Je.layout_symbol["text-writing-mode"]),"text-rotate":new Ue(Je.layout_symbol["text-rotate"]),"text-padding":new Me(Je.layout_symbol["text-padding"]),"text-keep-upright":new Me(Je.layout_symbol["text-keep-upright"]),"text-transform":new Ue(Je.layout_symbol["text-transform"]),"text-offset":new Ue(Je.layout_symbol["text-offset"]),"text-allow-overlap":new Me(Je.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Me(Je.layout_symbol["text-ignore-placement"]),"text-optional":new Me(Je.layout_symbol["text-optional"])});var uh={paint:new Ot({"icon-opacity":new Ue(Je.paint_symbol["icon-opacity"]),"icon-color":new Ue(Je.paint_symbol["icon-color"]),"icon-halo-color":new Ue(Je.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ue(Je.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ue(Je.paint_symbol["icon-halo-blur"]),"icon-translate":new Me(Je.paint_symbol["icon-translate"]),"icon-translate-anchor":new Me(Je.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ue(Je.paint_symbol["text-opacity"]),"text-color":new Ue(Je.paint_symbol["text-color"],{runtimeType:ri,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Ue(Je.paint_symbol["text-halo-color"]),"text-halo-width":new Ue(Je.paint_symbol["text-halo-width"]),"text-halo-blur":new Ue(Je.paint_symbol["text-halo-blur"]),"text-translate":new Me(Je.paint_symbol["text-translate"]),"text-translate-anchor":new Me(Je.paint_symbol["text-translate-anchor"])}),layout:Hm};class vf{constructor(a){this.type=a.property.overrides?a.property.overrides.runtimeType:or,this.defaultValue=a}evaluate(a){if(a.formattedSection){const p=this.defaultValue.property.overrides;if(p&&p.hasOverride(a.formattedSection))return p.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zn("FormatSectionOverride",vf,{omit:["defaultValue"]});class _f extends na{constructor(a){super(a,uh)}recalculate(a,p){super.recalculate(a,p),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const y=this.layout.get("text-writing-mode");if(y){const E=[];for(const A of y)E.indexOf(A)<0&&E.push(A);this.layout._values["text-writing-mode"]=E}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(a,p,y,E){const A=this.layout.get(a).evaluate(p,{},y,E),R=this._unevaluatedLayout._values[a];return R.isDataDriven()||qu(R.value)||!A?A:(U=p.properties,A.replace(/{([^{}]+)}/g,($,re)=>re in U?String(U[re]):""));var U}createBucket(a){return new qp(a)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const a of uh.paint.overridableProperties){if(!_f.hasPaintOverride(this.layout,a))continue;const p=this.paint.get(a),y=new vf(p),E=new Op(y,p.property.specification);let A=null;A="constant"===p.value.kind||"source"===p.value.kind?new us("source",E):new nh("composite",E,p.value.zoomStops,p.value._interpolationType),this.paint._values[a]=new Pe(p.property,A,p.parameters)}}_handleOverridablePaintPropertyUpdate(a,p,y){return!(!this.layout||p.isDataDriven()||y.isDataDriven())&&_f.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,p){const y=a.get("text-field"),E=uh.paint.properties[p];let A=!1;const R=U=>{for(const Z of U)if(E.overrides&&E.overrides.hasOverride(Z))return void(A=!0)};if("constant"===y.value.kind&&y.value.value instanceof ga)R(y.value.value.sections);else if("source"===y.value.kind){const U=$=>{A||($ instanceof no&&xi($.value)===Kr?R($.value.sections):$ instanceof ec?R($.sections):$.eachChild(U))},Z=y.value;Z._styleExpression&&U(Z._styleExpression.expression)}return A}getProgramConfiguration(a){return new Vo(this,a)}}var rm={paint:new Ot({"background-color":new Me(Je.paint_background["background-color"]),"background-pattern":new yt(Je.paint_background["background-pattern"]),"background-opacity":new Me(Je.paint_background["background-opacity"])})},Ay={paint:new Ot({"raster-opacity":new Me(Je.paint_raster["raster-opacity"]),"raster-hue-rotate":new Me(Je.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Me(Je.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Me(Je.paint_raster["raster-brightness-max"]),"raster-saturation":new Me(Je.paint_raster["raster-saturation"]),"raster-contrast":new Me(Je.paint_raster["raster-contrast"]),"raster-resampling":new Me(Je.paint_raster["raster-resampling"]),"raster-fade-duration":new Me(Je.paint_raster["raster-fade-duration"])})};class Wm extends na{constructor(a){super(a,{}),this.implementation=a}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(a){this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)}onRemove(a){this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)}}var Bv={paint:new Ot({"sky-type":new Me(Je.paint_sky["sky-type"]),"sky-atmosphere-sun":new Me(Je.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Me(Je.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Me(Je.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Me(Je.paint_sky["sky-gradient-radius"]),"sky-gradient":new gt(Je.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Me(Je.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Me(Je.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Me(Je.paint_sky["sky-opacity"])})};function Zp(c,a,p){const y=qf(0,0,1),E=Hf(Np());return function(A,R,U){U*=.5;var Z=R[0],$=R[1],re=R[2],ae=R[3],ue=Math.sin(U),Ce=Math.cos(U);A[0]=Z*Ce-re*ue,A[1]=$*Ce+ae*ue,A[2]=re*Ce+Z*ue,A[3]=ae*Ce-$*ue}(E,E,p?-fn(c)+Math.PI:fn(c)),Fm(E,E,-fn(a)),Om(y,y,E),Rm(y,y)}const im={circle:class extends na{constructor(c){super(c,Pm)}createBucket(c){return new Am(c)}queryRadius(c){const a=c;return kd("circle-radius",this,a)+kd("circle-stroke-width",this,a)+cf(this.paint.get("circle-translate"))}queryIntersectsFeature(c,a,p,y,E,A,R,U){const Z=V_(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),A.angle,c.pixelToTileUnitsFactor),$=this.paint.get("circle-radius").evaluate(a,p)+this.paint.get("circle-stroke-width").evaluate(a,p);return Wf(c,y,A,R,U,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),Z,$)}getProgramIds(){return["circle"]}getProgramConfiguration(c){return new Vo(this,c)}},heatmap:class extends na{createBucket(c){return new xy(c)}constructor(c){super(c,wx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){"heatmap-color"===c&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Mv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(c){return kd("heatmap-radius",this,c)}queryIntersectsFeature(c,a,p,y,E,A,R,U){const Z=this.paint.get("heatmap-radius").evaluate(a,p);return Wf(c,y,A,R,U,!0,!0,new it(0,0),Z)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(c){return new Vo(this,c)}},hillshade:class extends na{constructor(c){super(c,Cx)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(c){return new Vo(this,c)}},fill:class extends na{constructor(c){super(c,Gm)}getProgramIds(){const c=this.paint.get("fill-pattern"),a=c&&c.constantOr(1),p=[a?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&p.push(a&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),p}getProgramConfiguration(c){return new Vo(this,c)}recalculate(c,a){super.recalculate(c,a);const p=this.paint._values["fill-outline-color"];"constant"===p.value.kind&&void 0===p.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new Iy(c)}queryRadius(){return cf(this.paint.get("fill-translate"))}queryIntersectsFeature(c,a,p,y,E,A){return!c.queryGeometry.isAboveHorizon&&B_(U_(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),A.angle,c.pixelToTileUnitsFactor),y)}isTileClipped(){return!0}},"fill-extrusion":class extends na{constructor(c){super(c,Rg)}createBucket(c){return new Ld(c)}queryRadius(){return cf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(c){return new Vo(this,c)}queryIntersectsFeature(c,a,p,y,E,A,R,U,Z){const $=V_(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),A.angle,c.pixelToTileUnitsFactor),re=this.paint.get("fill-extrusion-height").evaluate(a,p),ae=this.paint.get("fill-extrusion-base").evaluate(a,p),ue=[0,0],Ce=U&&A.elevation,ke=A.elevation?A.elevation.exaggeration():1;if(Ce){const rt=c.tile.getBucket(this).centroidVertexArray,ht=Z+1;if(ht<rt.length){const vt=rt.get(ht);ue[0]=vt.a_centroid_pos0,ue[1]=vt.a_centroid_pos1}}if(0===ue[0]&&1===ue[1])return!1;const Ve=(rt=y,ht=ae,vt=re,Tt=$,Ct=R,(kt=Ce?U:null)?function(In,hn,Tn,Ln,yn,Jn,pr,Ri,Wa){const hi=[],mo=[],Wn=[0,0,0,1];for(const is of In){const ra=[],Pu=[];for(const Ml of is){const du=Ml.x+Ln.x,Ru=Ml.y+Ln.y,ia=n0(du,Ru,hn,Tn,Jn,pr,Ri,Wa);Wn[0]=du,Wn[1]=Ru,Wn[2]=ia.base,Wn[3]=1,Lm(Wn,Wn,yn),Wn[3]=Math.max(Wn[3],1e-5);const pa=t0([Wn[0]/Wn[3],Wn[1]/Wn[3],Wn[2]/Wn[3]]);Wn[0]=du,Wn[1]=Ru,Wn[2]=ia.top,Wn[3]=1,Lm(Wn,Wn,yn),Wn[3]=Math.max(Wn[3],1e-5);const xs=t0([Wn[0]/Wn[3],Wn[1]/Wn[3],Wn[2]/Wn[3]]);ra.push(pa),Pu.push(xs)}hi.push(ra),mo.push(Pu)}return[hi,mo]}(rt,ht,vt,Tt,Ct,kt,ue,ke,A.center.lat):function(In,hn,Tn,Ln,yn){const Jn=[],pr=[],Ri=yn[8]*hn,Wa=yn[9]*hn,hi=yn[10]*hn,mo=yn[11]*hn,Wn=yn[8]*Tn,is=yn[9]*Tn,ra=yn[10]*Tn,Pu=yn[11]*Tn;for(const Ml of In){const du=[],Ru=[];for(const ia of Ml){const pa=ia.x+Ln.x,xs=ia.y+Ln.y,_c=yn[0]*pa+yn[4]*xs+yn[12],Hl=yn[1]*pa+yn[5]*xs+yn[13],Ou=yn[2]*pa+yn[6]*xs+yn[14],Gc=yn[3]*pa+yn[7]*xs+yn[15],Ws=_c+Ri,op=Hl+Wa,os=Ou+hi,Wl=Math.max(Gc+mo,1e-5),$s=_c+Wn,Al=Hl+is,Dl=Ou+ra,Lu=Math.max(Gc+Pu,1e-5),da=new it(Ws/Wl,op/Wl);da.z=os/Wl,du.push(da);const hh=new it($s/Lu,Al/Lu);hh.z=Dl/Lu,Ru.push(hh)}Jn.push(du),pr.push(Ru)}return[Jn,pr]}(rt,ht,vt,Tt,Ct)),We=c.queryGeometry;var rt,ht,vt,Tt,Ct,kt;return function(rt,ht,vt){let Tt=1/0;B_(vt,ht)&&(Tt=e0(vt,ht[0]));for(let Ct=0;Ct<ht.length;Ct++){const kt=ht[Ct],ln=rt[Ct];for(let Yt=0;Yt<kt.length-1;Yt++){const Kn=kt[Yt],In=[Kn,kt[Yt+1],ln[Yt+1],ln[Yt],Kn];Dm(vt,In)&&(Tt=Math.min(Tt,e0(vt,In)))}}return Tt!==1/0&&Tt}(Ve[0],Ve[1],We.isPointQuery()?We.screenBounds:We.screenGeometry)}},line:class extends na{constructor(c){super(c,Qf),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(c){if("line-gradient"===c){const a=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=a._styleExpression&&a._styleExpression.expression instanceof rc,this.gradientVersion=(this.gradientVersion+1)%Wt}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,a){super.recalculate(c,a),this.paint._values["line-floorwidth"]=Fv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new ad(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(c){return new Vo(this,c)}queryRadius(c){const a=c,p=ul(kd("line-width",this,a),kd("line-gap-width",this,a)),y=kd("line-offset",this,a);return p/2+Math.abs(y)+cf(this.paint.get("line-translate"))}queryIntersectsFeature(c,a,p,y,E,A){if(c.queryGeometry.isAboveHorizon)return!1;const R=U_(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),A.angle,c.pixelToTileUnitsFactor),U=c.pixelToTileUnitsFactor/2*ul(this.paint.get("line-width").evaluate(a,p),this.paint.get("line-gap-width").evaluate(a,p)),Z=this.paint.get("line-offset").evaluate(a,p);return Z&&(y=function($,re){const ae=[],ue=new it(0,0);for(let Ce=0;Ce<$.length;Ce++){const ke=$[Ce],Ve=[];for(let We=0;We<ke.length;We++){const rt=ke[We-1],ht=ke[We],vt=ke[We+1],Tt=0===We?ue:ht.sub(rt)._unit()._perp(),Ct=We===ke.length-1?ue:vt.sub(ht)._unit()._perp(),kt=Tt._add(Ct)._unit();kt._mult(1/(kt.x*Ct.x+kt.y*Ct.y)),Ve.push(kt._mult(re)._add(ht))}ae.push(Ve)}return ae}(y,Z*c.pixelToTileUnitsFactor)),function($,re,ae){for(let ue=0;ue<re.length;ue++){const Ce=re[ue];if($.length>=3)for(let ke=0;ke<Ce.length;ke++)if(Xn($,Ce[ke]))return!0;if(km($,Ce,ae))return!0}return!1}(R,y,U)}isTileClipped(){return!0}},symbol:_f,background:class extends na{constructor(c){super(c,rm)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends na{constructor(c){super(c,Ay)}getProgramIds(){return["raster"]}},sky:class extends na{constructor(c){super(c,Bv),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){"sky-gradient"===c?this._updateColorRamp():"sky-atmosphere-sun"!==c&&"sky-atmosphere-halo-color"!==c&&"sky-atmosphere-color"!==c&&"sky-atmosphere-sun-intensity"!==c||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Mv({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const a=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==a.azimuthal||this._lightPosition.polar!==a.polar}}getCenter(c,a){const p=this.paint.get("sky-type");if("atmosphere"===p){const y=this.paint.get("sky-atmosphere-sun"),E=!y,A=c.style.light,R=A.properties.get("position");return E&&"viewport"===A.properties.get("anchor")&&Ui("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),E?Zp(R.azimuthal,90-R.polar,a):Zp(y[0],90-y[1],a)}if("gradient"===p){const y=this.paint.get("sky-gradient-center");return Zp(y[0],90-y[1],a)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return"atmosphere"===c?["skyboxCapture","skybox"]:"gradient"===c?["skyboxGradient"]:null}}},{HTMLImageElement:Vd,HTMLCanvasElement:xf,HTMLVideoElement:cd,ImageData:Ng,ImageBitmap:Gd}=Ke;class $m{constructor(a,p,y,E){this.context=a,this.format=y,this.texture=a.gl.createTexture(),this.update(p,E)}update(a,p,y){const{width:E,height:A}=a,{context:R}=this,{gl:U}=R;if(U.bindTexture(U.TEXTURE_2D,this.texture),R.pixelStoreUnpackFlipY.set(!1),R.pixelStoreUnpack.set(1),R.pixelStoreUnpackPremultiplyAlpha.set(this.format===U.RGBA&&(!p||!1!==p.premultiply)),y||this.size&&this.size[0]===E&&this.size[1]===A){const{x:Z,y:$}=y||{x:0,y:0};a instanceof Vd||a instanceof xf||a instanceof cd||a instanceof Ng||Gd&&a instanceof Gd?U.texSubImage2D(U.TEXTURE_2D,0,Z,$,U.RGBA,U.UNSIGNED_BYTE,a):U.texSubImage2D(U.TEXTURE_2D,0,Z,$,E,A,U.RGBA,U.UNSIGNED_BYTE,a.data)}else this.size=[E,A],a instanceof Vd||a instanceof xf||a instanceof cd||a instanceof Ng||Gd&&a instanceof Gd?U.texImage2D(U.TEXTURE_2D,0,this.format,this.format,U.UNSIGNED_BYTE,a):U.texImage2D(U.TEXTURE_2D,0,this.format,E,A,0,this.format,U.UNSIGNED_BYTE,a.data);this.useMipmap=Boolean(p&&p.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&U.generateMipmap(U.TEXTURE_2D)}bind(a,p){const{context:y}=this,{gl:E}=y;E.bindTexture(E.TEXTURE_2D,this.texture),a!==this.filter&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,a),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,this.useMipmap?a===E.NEAREST?E.NEAREST_MIPMAP_NEAREST:E.LINEAR_MIPMAP_NEAREST:a),this.filter=a),p!==this.wrap&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,p),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,p),this.wrap=p)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}class Dy{constructor(a,p){this.width=a,this.height=p,this.nextRow=0,this.image=new Ph({width:a,height:p}),this.positions={},this.uploaded=!1}getDash(a,p){const y=this.getKey(a,p);return this.positions[y]}trim(){const a=this.width,p=this.height=Es(this.nextRow);this.image.resize({width:a,height:p})}getKey(a,p){return a.join(",")+p}getDashRanges(a,p,y){const E=[];let A=a.length%2==1?-a[a.length-1]*y:0,R=a[0]*y,U=!0;E.push({left:A,right:R,isDash:U,zeroLength:0===a[0]});let Z=a[0];for(let $=1;$<a.length;$++){U=!U;const re=a[$];A=Z*y,Z+=re,R=Z*y,E.push({left:A,right:R,isDash:U,zeroLength:0===re})}return E}addRoundDash(a,p,y){const E=p/2;for(let A=-y;A<=y;A++){const R=this.width*(this.nextRow+y+A);let U=0,Z=a[U];for(let $=0;$<this.width;$++){$/Z.right>1&&(Z=a[++U]);const re=Math.abs($-Z.left),ae=Math.abs($-Z.right),ue=Math.min(re,ae);let Ce;const ke=A/y*(E+1);if(Z.isDash){const Ve=E-Math.abs(ke);Ce=Math.sqrt(ue*ue+Ve*Ve)}else Ce=E-Math.sqrt(ue*ue+ke*ke);this.image.data[R+$]=Math.max(0,Math.min(255,Ce+128))}}}addRegularDash(a,p){for(let Z=a.length-1;Z>=0;--Z){const $=a[Z],re=a[Z+1];$.zeroLength?a.splice(Z,1):re&&re.isDash===$.isDash&&(re.left=$.left,a.splice(Z,1))}const y=a[0],E=a[a.length-1];y.isDash===E.isDash&&(y.left=E.left-this.width,E.right=y.right+this.width);const A=this.width*this.nextRow;let R=0,U=a[R];for(let Z=0;Z<this.width;Z++){Z/U.right>1&&(U=a[++R]);const $=Math.abs(Z-U.left),re=Math.abs(Z-U.right),ae=Math.min($,re);this.image.data[A+Z]=Math.max(0,Math.min(255,(U.isDash?ae:-ae)+p+128))}}addDash(a,p){const y=this.getKey(a,p);if(this.positions[y])return this.positions[y];const E="round"===p,A=E?7:0,R=2*A+1;if(this.nextRow+R>this.height)return Ui("LineAtlas out of space"),null;0===a.length&&a.push(1);let U=0;for(let re=0;re<a.length;re++)a[re]<0&&(Ui("Negative value is found in line dasharray, replacing values with 0"),a[re]=0),U+=a[re];if(0!==U){const re=this.width/U,ae=this.getDashRanges(a,this.width,re);E?this.addRoundDash(ae,re,A):this.addRegularDash(ae,"square"===p?.5*re:0)}const Z=this.nextRow+A;this.nextRow+=R;const $={tl:[Z,A],br:[U,0]};return this.positions[y]=$,$}}Zn("LineAtlas",Dy);class jv{constructor(a){this._callback=a,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Uv=Ke.performance;function Vv(c){const a=c?c.url.toString():void 0;return Uv.getEntriesByName(a)}class Ax{constructor(){this.tasks={},this.taskQueue=[],ct(["process"],this),this.invoker=new jv(this.process),this.nextId=0}add(a,p){const y=this.nextId++,E=function({type:A,isSymbolTile:R,zoom:U}){return U=U||0,"message"===A?0:"maybePrepare"!==A||R?"parseTile"!==A||R?"parseTile"===A&&R?300-U:"maybePrepare"===A&&R?400-U:500:200-U:100-U}(p);if(0===E){Vi();try{a()}finally{}return{cancel:()=>{}}}return this.tasks[y]={fn:a,metadata:p,priority:E,id:y},this.taskQueue.push(y),this.invoker.trigger(),{cancel:()=>{delete this.tasks[y]}}}process(){Vi();try{if(this.taskQueue=this.taskQueue.filter(y=>!!this.tasks[y]),!this.taskQueue.length)return;const a=this.pick();if(null===a)return;const p=this.tasks[a];if(delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),!p)return;p.fn()}finally{}}pick(){let a=null,p=1/0;for(let E=0;E<this.taskQueue.length;E++){const A=this.tasks[this.taskQueue[E]];A.priority<p&&(p=A.priority,a=E)}if(null===a)return null;const y=this.taskQueue[a];return this.taskQueue.splice(a,1),y}remove(){this.invoker.remove()}}function om(c,a){const p=Math.pow(2,-c.z),y=c.x*p,E=(c.x+1)*p,A=c.y*p,R=(c.y+1)*p;if("mercator"===a.name)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:a};const U=Dh(y),Z=Dh(E),$=Dd(A),re=Dd(R),ae=a.project(U,$),ue=a.project(Z,$),Ce=a.project(Z,re),ke=a.project(U,re);let Ve=Math.min(ae.x,ue.x,Ce.x,ke.x),We=Math.min(ae.y,ue.y,Ce.y,ke.y),rt=Math.max(ae.x,ue.x,Ce.x,ke.x),ht=Math.max(ae.y,ue.y,Ce.y,ke.y);const vt=p/16;function Tt(kt,ln,Yt,Kn,In,hn){const Tn=(Yt+In)/2,Ln=(Kn+hn)/2,yn=a.project(Dh(Tn),Dd(Ln)),Jn=Math.max(0,Ve-yn.x,We-yn.y,yn.x-rt,yn.y-ht);Ve=Math.min(Ve,yn.x),rt=Math.max(rt,yn.x),We=Math.min(We,yn.y),ht=Math.max(ht,yn.y),Jn>vt&&(Tt(kt,yn,Yt,Kn,Tn,Ln),Tt(yn,ln,Tn,Ln,In,hn))}Tt(ae,ue,y,A,E,A),Tt(ue,Ce,E,A,E,R),Tt(Ce,ke,E,R,y,R),Tt(ke,ae,y,R,y,A),Ve-=vt,We-=vt,rt+=vt,ht+=vt;const Ct=1/Math.max(rt-Ve,ht-We);return{scale:Ct,x:Ve*Ct,y:We*Ct,x2:rt*Ct,y2:ht*Ct,projection:a}}function _s(c,a,p){var y=2*Math.PI*6378137/256/Math.pow(2,p);return[c*y-2*Math.PI*6378137/2,a*y-2*Math.PI*6378137/2]}class Oh{constructor(a,p,y){this.z=a,this.x=p,this.y=y,this.key=Xm(0,a,a,p,y)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}url(a,p){const y=(A=this.y,R=this.z,U=_s(256*(E=this.x),256*(A=Math.pow(2,R)-A-1),R),Z=_s(256*(E+1),256*(A+1),R),U[0]+","+U[1]+","+Z[0]+","+Z[1]);var E,A,R,U,Z;const $=function(re,ae,ue){let Ce,ke="";for(let Ve=re;Ve>0;Ve--)Ce=1<<Ve-1,ke+=(ae&Ce?1:0)+(ue&Ce?2:0);return ke}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===p?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",$).replace("{bbox-epsg-3857}",y)}toString(){return`${this.z}/${this.x}/${this.y}`}}class c0{constructor(a,p){this.wrap=a,this.canonical=p,this.key=Xm(a,p.z,p.z,p.x,p.y)}}class rl{constructor(a,p,y,E,A){this.overscaledZ=a,this.wrap=p,this.canonical=new Oh(y,+E,+A),this.key=0===p&&a===y?this.canonical.key:Xm(p,a,y,E,A)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){const p=this.canonical.z-a;return a>this.canonical.z?new rl(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new rl(a,this.wrap,a,this.canonical.x>>p,this.canonical.y>>p)}calculateScaledKey(a,p=!0){if(this.overscaledZ===a&&p)return this.key;if(a>this.canonical.z)return Xm(this.wrap*+p,a,this.canonical.z,this.canonical.x,this.canonical.y);{const y=this.canonical.z-a;return Xm(this.wrap*+p,a,a,this.canonical.x>>y,this.canonical.y>>y)}}isChildOf(a){if(a.wrap!==this.wrap)return!1;const p=this.canonical.z-a.canonical.z;return 0===a.overscaledZ||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>p&&a.canonical.y===this.canonical.y>>p}children(a){if(this.overscaledZ>=a)return[new rl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const p=this.canonical.z+1,y=2*this.canonical.x,E=2*this.canonical.y;return[new rl(p,this.wrap,p,y,E),new rl(p,this.wrap,p,y+1,E),new rl(p,this.wrap,p,y,E+1),new rl(p,this.wrap,p,y+1,E+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new rl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new rl(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new c0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Xm(c,a,p,y,E){const A=1<<Math.min(p,22);let R=A*(E%A)+y%A;return c&&p<22&&(R+=A*A*((c<0?-2*c-1:2*c)%(1<<2*(22-p)))),16*(32*R+p)+(a-p)}Zn("CanonicalTileID",Oh),Zn("OverscaledTileID",rl,{omit:["projMatrix"]});class h0{constructor(a){this._stringToNumber={},this._numberToString=[];for(let p=0;p<a.length;p++){const y=a[p];this._stringToNumber[y]=p,this._numberToString[p]=y}}encode(a){return this._stringToNumber[a]}decode(a){return this._numberToString[a]}}class ky{constructor(a,p,y,E,A){this.type="Feature",this._vectorTileFeature=a,a._z=p,a._x=y,a._y=E,this.properties=a.properties,this.id=A}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={geometry:this.geometry};for(const p in this)"_geometry"!==p&&"_vectorTileFeature"!==p&&(a[p]=this[p]);return a}}var qd=ft([{name:"a_pos",type:"Int16",components:2}]);const hd=new Uint16Array(8184);for(let c=0;c<2046;c++){let a=c+2,p=0,y=0,E=0,A=0,R=0,U=0;for(1&a?E=A=R=32:p=y=U=32;(a>>=1)>1;){const $=p+E>>1,re=y+A>>1;1&a?(E=p,A=y,p=R,y=U):(p=E,y=A,E=R,A=U),R=$,U=re}const Z=4*c;hd[Z+0]=p,hd[Z+1]=y,hd[Z+2]=E,hd[Z+3]=A}const mp=new Uint16Array(2178),Zd=new Uint8Array(1089),Py=new Uint16Array(1089);function rp(c){return 0===c?-.03125:32===c?.03125:0}var Ym=ft([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Gv={type:2,extent:Bi,loadGeometry:()=>[[new it(0,0),new it(8193,0),new it(8193,8193),new it(0,8193),new it(0,0)]]};class Ry{constructor(a,p,y,E,A){this.tileID=a,this.uid=sr(),this.uses=0,this.tileSize=p,this.tileZoom=y,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=A,this.expiredRequestCount=0,this.state="loading",E&&E.transform&&(this.projection=E.transform.projection)}registerFadeDuration(a){const p=a+this.timeAdded;p<zs.now()||this.fadeEndTime&&p<this.fadeEndTime||(this.fadeEndTime=p)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=om(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(a,p,y){if(this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(E,A){const R={};if(!A)return R;for(const U of E){const Z=U.layerIds.map($=>A.getLayer($)).filter(Boolean);if(0!==Z.length){U.layers=Z,U.stateDependentLayerIds&&(U.stateDependentLayers=U.stateDependentLayerIds.map($=>Z.filter(re=>re.id===$)[0]));for(const $ of Z)R[$.id]=U}}return R}(a.buckets,p.style),this.hasSymbolBuckets=!1;for(const E in this.buckets){const A=this.buckets[E];if(A instanceof qp){if(this.hasSymbolBuckets=!0,!y)break;A.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const E in this.buckets){const A=this.buckets[E];if(A instanceof qp&&A.hasRTLText){this.hasRTLText=!0,ee.isLoading()||ee.isLoaded()||"deferred"!==W()||Y();break}}this.queryPadding=0;for(const E in this.buckets){const A=this.buckets[E];this.queryPadding=Math.max(this.queryPadding,p.style.getLayer(E).queryRadius(A))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage),a.lineAtlas&&(this.lineAtlas=a.lineAtlas)}else this.collisionBoxArray=new at}unloadVectorData(){if(this.hasData()){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(a){return this.buckets[a.id]}upload(a){for(const y in this.buckets){const E=this.buckets[y];E.uploadPending()&&E.upload(a)}const p=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new $m(a,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new $m(a,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new $m(a,this.lineAtlas.image,p.ALPHA),this.lineAtlas.uploaded=!0)}prepare(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)}queryRenderedFeatures(a,p,y,E,A,R,U,Z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:E,pixelPosMatrix:U,transform:R,params:A,tileTransform:this.tileTransform},a,p,y):{}}querySourceFeatures(a,p){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const E=y.loadVTLayers(),A=p?p.sourceLayer:"",R=E._geojsonTileLayer||E[A];if(!R)return;const U=Sl(p&&p.filter),{z:Z,x:$,y:re}=this.tileID.canonical,ae={z:Z,x:$,y:re};for(let ue=0;ue<R.length;ue++){const Ce=R.feature(ue);if(U.needGeometry){const We=Mm(Ce,!0);if(!U.filter(new Q(this.tileID.overscaledZ),We,this.tileID.canonical))continue}else if(!U.filter(new Q(this.tileID.overscaledZ),Ce))continue;const ke=y.getId(Ce,A),Ve=new ky(Ce,Z,$,re,ke);Ve.tile=ae,a.push(Ve)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(a){const p=this.expirationTime;if(a.cacheControl){const y=Zr(a.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const y=Date.now();let E=!1;if(this.expirationTime>y)E=!1;else if(p)if(this.expirationTime<p)E=!0;else{const A=this.expirationTime-p;A?this.expirationTime=y+Math.max(A,3e4):E=!0}else E=!0;E?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(a,p){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(a).length||!p)return;const y=this.latestFeatureIndex.loadVTLayers(),E=p.style.listImages();for(const A in this.buckets){if(!p.style.hasLayer(A))continue;const R=this.buckets[A],U=R.layers[0].sourceLayer||"_geojsonTileLayer",Z=y[U],$=a[U];if(!Z||!$||0===Object.keys($).length)continue;if(R.update($,Z,E,this.imageAtlas&&this.imageAtlas.patternPositions||{}),R instanceof ad||R instanceof Iy){const ae=p.style._getSourceCache(R.layers[0].source);p._terrain&&p._terrain.enabled&&ae&&R.programConfigurations.needsUpload&&p._terrain._clearRenderCacheForTile(ae.id,this.tileID)}const re=p&&p.style&&p.style.getLayer(A);re&&(this.queryPadding=Math.max(this.queryPadding,re.queryRadius(R)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<zs.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=zs.now()+a}setDependencies(a,p){const y={};for(const E of p)y[E]=!0;this.dependencies[a]=y}hasDependency(a,p){for(const y of a){const E=this.dependencies[y];if(E)for(const A of p)if(E[A])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(a,p){if(!p||"mercator"===p.name||this._tileDebugBuffer)return;const y=gc(Gv,this.tileID.canonical,this.tileTransform)[0],E=new Qt,A=new he;for(let R=0;R<y.length;R++){const{x:U,y:Z}=y[R];E.emplaceBack(U,Z),A.emplaceBack(R)}A.emplaceBack(0),this._tileDebugIndexBuffer=a.createIndexBuffer(A),this._tileDebugBuffer=a.createVertexBuffer(E,Ym.members),this._tileDebugSegments=Zs.simpleSegment(0,0,E.length,A.length)}_makeTileBoundsBuffers(a,p){if(this._tileBoundsBuffer||!p||"mercator"===p.name)return;const y=gc(Gv,this.tileID.canonical,this.tileTransform)[0];let E,A;if(this.isRaster){const R=function(U,Z){const $=om(U,Z),re=Math.pow(2,U.z);for(let We=0;We<33;We++)for(let rt=0;rt<33;rt++){const ht=Dh((U.x+(rt+rp(rt))/32)/re),vt=Dd((U.y+(We+rp(We))/32)/re),Tt=Z.project(ht,vt),Ct=33*We+rt;mp[2*Ct+0]=Math.round((Tt.x*$.scale-$.x)*Bi),mp[2*Ct+1]=Math.round((Tt.y*$.scale-$.y)*Bi)}Zd.fill(0),Py.fill(0);for(let We=2045;We>=0;We--){const rt=4*We,ht=hd[rt+0],vt=hd[rt+1],Tt=hd[rt+2],Ct=hd[rt+3],kt=ht+Tt>>1,ln=vt+Ct>>1,Yt=kt+ln-vt,Kn=ln+ht-kt,In=33*vt+ht,hn=33*Ct+Tt,Tn=33*ln+kt,Ln=Math.hypot((mp[2*In+0]+mp[2*hn+0])/2-mp[2*Tn+0],(mp[2*In+1]+mp[2*hn+1])/2-mp[2*Tn+1])>=16;if(Zd[Tn]=Zd[Tn]||(Ln?1:0),We<1022){const yn=33*(vt+Kn>>1)+(ht+Yt>>1),Jn=33*(Ct+Kn>>1)+(Tt+Yt>>1);Zd[Tn]=Zd[Tn]||Zd[yn]||Zd[Jn]}}const ae=new mn,ue=new Ko;let Ce=0;function ke(We,rt){const ht=33*rt+We;return 0===Py[ht]&&(ae.emplaceBack(mp[2*ht+0],mp[2*ht+1],We*Bi/32,rt*Bi/32),Py[ht]=++Ce),Py[ht]-1}function Ve(We,rt,ht,vt,Tt,Ct){const kt=We+ht>>1,ln=rt+vt>>1;if(Math.abs(We-Tt)+Math.abs(rt-Ct)>1&&Zd[33*ln+kt])Ve(Tt,Ct,We,rt,kt,ln),Ve(ht,vt,Tt,Ct,kt,ln);else{const Yt=ke(We,rt),Kn=ke(ht,vt),In=ke(Tt,Ct);ue.emplaceBack(Yt,Kn,In)}}return Ve(0,0,32,32,32,0),Ve(32,32,0,0,0,32),{vertices:ae,indices:ue}}(this.tileID.canonical,p);E=R.vertices,A=R.indices}else{E=new mn,A=new Ko;for(const{x:U,y:Z}of y)E.emplaceBack(U,Z,0,0);const R=dp(E.int16,void 0,4);for(let U=0;U<R.length;U+=3)A.emplaceBack(R[U],R[U+1],R[U+2])}this._tileBoundsBuffer=a.createVertexBuffer(E,Ym.members),this._tileBoundsIndexBuffer=a.createIndexBuffer(A),this._tileBoundsSegments=Zs.simpleSegment(0,0,E.length,A.length)}}class Oy{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,p,y){const E=String(p);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][E]=this.stateChanges[a][E]||{},jn(this.stateChanges[a][E],y),null===this.deletedStates[a]){this.deletedStates[a]={};for(const A in this.state[a])A!==E&&(this.deletedStates[a][A]=null)}else if(this.deletedStates[a]&&null===this.deletedStates[a][E]){this.deletedStates[a][E]={};for(const A in this.state[a][E])y[A]||(this.deletedStates[a][E][A]=null)}else for(const A in y)this.deletedStates[a]&&this.deletedStates[a][E]&&null===this.deletedStates[a][E][A]&&delete this.deletedStates[a][E][A]}removeFeatureState(a,p,y){if(null===this.deletedStates[a])return;const E=String(p);if(this.deletedStates[a]=this.deletedStates[a]||{},y&&void 0!==p)null!==this.deletedStates[a][E]&&(this.deletedStates[a][E]=this.deletedStates[a][E]||{},this.deletedStates[a][E][y]=null);else if(void 0!==p)if(this.stateChanges[a]&&this.stateChanges[a][E])for(y in this.deletedStates[a][E]={},this.stateChanges[a][E])this.deletedStates[a][E][y]=null;else this.deletedStates[a][E]=null;else this.deletedStates[a]=null}getState(a,p){const y=String(p),E=jn({},(this.state[a]||{})[y],(this.stateChanges[a]||{})[y]);if(null===this.deletedStates[a])return{};if(this.deletedStates[a]){const A=this.deletedStates[a][p];if(null===A)return{};for(const R in A)delete E[R]}return E}initializeTileState(a,p){a.setFeatureState(this.state,p)}coalesceChanges(a,p){const y={};for(const E in this.stateChanges){this.state[E]=this.state[E]||{};const A={};for(const R in this.stateChanges[E])this.state[E][R]||(this.state[E][R]={}),jn(this.state[E][R],this.stateChanges[E][R]),A[R]=this.state[E][R];y[E]=A}for(const E in this.deletedStates){this.state[E]=this.state[E]||{};const A={};if(null===this.deletedStates[E])for(const R in this.state[E])A[R]={},this.state[E][R]={};else for(const R in this.deletedStates[E]){if(null===this.deletedStates[E][R])this.state[E][R]={};else for(const U of Object.keys(this.deletedStates[E][R]))delete this.state[E][R][U];A[R]=this.state[E][R]}y[E]=y[E]||{},jn(y[E],A)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(y).length)for(const E in a)a[E].setFeatureState(y,p)}}class Ly{constructor(a){this.size=a,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(a,p){const y=this.toIdx(a,p);return{min:this.minimums[y],max:this.maximums[y]}}isLeaf(a,p){return this.leaves[this.toIdx(a,p)]}toIdx(a,p){return p*this.size+a}}function yc(c,a,p,y){let E=0,A=Number.MAX_VALUE;for(let R=0;R<3;R++)if(Math.abs(y[R])<1e-15){if(p[R]<c[R]||p[R]>a[R])return null}else{const U=1/y[R];let Z=(c[R]-p[R])*U,$=(a[R]-p[R])*U;if(Z>$){const re=Z;Z=$,$=re}if(Z>E&&(E=Z),$<A&&(A=$),E>A)return null}return E}function Bg(c,a,p,y,E,A,R,U,Z,$,re){const ae=y-c,ue=E-a,Ce=A-p,ke=R-c,Ve=U-a,We=Z-p,rt=re[1]*We-re[2]*Ve,ht=re[2]*ke-re[0]*We,vt=re[0]*Ve-re[1]*ke,Tt=ae*rt+ue*ht+Ce*vt;if(Math.abs(Tt)<1e-15)return null;const Ct=1/Tt,kt=$[0]-c,ln=$[1]-a,Yt=$[2]-p,Kn=(kt*rt+ln*ht+Yt*vt)*Ct;if(Kn<0||Kn>1)return null;const In=ln*Ce-Yt*ue,hn=Yt*ae-kt*Ce,Tn=kt*ue-ln*ae,Ln=(re[0]*In+re[1]*hn+re[2]*Tn)*Ct;return Ln<0||Kn+Ln>1?null:(ke*In+Ve*hn+We*Tn)*Ct}function pd(c,a,p){return(c-a)/(p-a)}function gp(c,a,p,y,E,A,R,U,Z){const $=1<<p,re=A-y,ae=R-E,ue=(c+1)/$*re+y,Ce=(a+0)/$*ae+E,ke=(a+1)/$*ae+E;U[0]=(c+0)/$*re+y,U[1]=Ce,Z[0]=ue,Z[1]=ke}class p0{constructor(a){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=a,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const p=function(A){const R=Math.ceil(Math.log2(A.dim/8)),U=[];let Z=Math.ceil(Math.pow(2,R));const $=1/Z,re=(Ce,ke,Ve,We,rt)=>{const ht=We?1:0,vt=(Ce+1)*Ve-ht,Tt=ke*Ve,Ct=(ke+1)*Ve-ht;rt[0]=Ce*Ve,rt[1]=Tt,rt[2]=vt,rt[3]=Ct};let ae=new Ly(Z);const ue=[];for(let Ce=0;Ce<Z*Z;Ce++){re(Ce%Z,Math.floor(Ce/Z),$,!1,ue);const ke=Fh(ue[0],ue[1],A),Ve=Fh(ue[2],ue[1],A),We=Fh(ue[2],ue[3],A),rt=Fh(ue[0],ue[3],A);ae.minimums.push(Math.min(ke,Ve,We,rt)),ae.maximums.push(Math.max(ke,Ve,We,rt)),ae.leaves.push(1)}for(U.push(ae),Z/=2;Z>=1;Z/=2){const Ce=U[U.length-1];ae=new Ly(Z);for(let ke=0;ke<Z*Z;ke++){re(ke%Z,Math.floor(ke/Z),2,!0,ue);const Ve=Ce.getElevation(ue[0],ue[1]),We=Ce.getElevation(ue[2],ue[1]),rt=Ce.getElevation(ue[2],ue[3]),ht=Ce.getElevation(ue[0],ue[3]),vt=Ce.isLeaf(ue[0],ue[1]),Tt=Ce.isLeaf(ue[2],ue[1]),Ct=Ce.isLeaf(ue[2],ue[3]),kt=Ce.isLeaf(ue[0],ue[3]),ln=Math.min(Ve.min,We.min,rt.min,ht.min),Yt=Math.max(Ve.max,We.max,rt.max,ht.max),Kn=vt&&Tt&&Ct&&kt;ae.maximums.push(Yt),ae.minimums.push(ln),ae.leaves.push(Yt-ln<=5&&Kn?1:0)}U.push(ae)}return U}(this.dem),y=p.length-1,E=p[y];this._addNode(E.minimums[0],E.maximums[0],E.leaves[0]),this._construct(p,0,0,y,0)}raycastRoot(a,p,y,E,A,R,U=1){return yc([a,p,-100],[y,E,this.maximums[0]*U],A,R)}raycast(a,p,y,E,A,R,U=1){if(!this.nodeCount)return null;const Z=this.raycastRoot(a,p,y,E,A,R,U);if(null==Z)return null;const $=[],re=[],ae=[],ue=[],Ce=[{idx:0,t:Z,nodex:0,nodey:0,depth:0}];for(;Ce.length>0;){const{idx:ke,t:Ve,nodex:We,nodey:rt,depth:ht}=Ce.pop();if(this.leaves[ke]){gp(We,rt,ht,a,p,y,E,ae,ue);const Tt=1<<ht,Ct=(We+0)/Tt,kt=(We+1)/Tt,ln=(rt+0)/Tt,Yt=(rt+1)/Tt,Kn=Fh(Ct,ln,this.dem)*U,In=Fh(kt,ln,this.dem)*U,hn=Fh(kt,Yt,this.dem)*U,Tn=Fh(Ct,Yt,this.dem)*U,Ln=Bg(ae[0],ae[1],Kn,ue[0],ae[1],In,ue[0],ue[1],hn,A,R),yn=Bg(ue[0],ue[1],hn,ae[0],ue[1],Tn,ae[0],ae[1],Kn,A,R),Jn=Math.min(null!==Ln?Ln:Number.MAX_VALUE,null!==yn?yn:Number.MAX_VALUE);if(Jn!==Number.MAX_VALUE)return Jn;{const pr=Zf([],A,R,Ve);if(jg(Kn,In,Tn,hn,pd(pr[0],ae[0],ue[0]),pd(pr[1],ae[1],ue[1]))>=pr[2])return Ve}continue}let vt=0;for(let Tt=0;Tt<this._siblingOffset.length;Tt++){gp((We<<1)+this._siblingOffset[Tt][0],(rt<<1)+this._siblingOffset[Tt][1],ht+1,a,p,y,E,ae,ue),ae[2]=-100,ue[2]=this.maximums[this.childOffsets[ke]+Tt]*U;const Ct=yc(ae,ue,A,R);if(null!=Ct){const kt=Ct;$[Tt]=kt;let ln=!1;for(let Yt=0;Yt<vt&&!ln;Yt++)kt>=$[re[Yt]]&&(re.splice(Yt,0,Tt),ln=!0);ln||(re[vt]=Tt),vt++}}for(let Tt=0;Tt<vt;Tt++){const Ct=re[Tt];Ce.push({idx:this.childOffsets[ke]+Ct,t:$[Ct],nodex:(We<<1)+this._siblingOffset[Ct][0],nodey:(rt<<1)+this._siblingOffset[Ct][1],depth:ht+1})}}return null}_addNode(a,p,y){return this.minimums.push(a),this.maximums.push(p),this.leaves.push(y),this.childOffsets.push(0),this.nodeCount++}_construct(a,p,y,E,A){if(1===a[E].isLeaf(p,y))return;this.childOffsets[A]||(this.childOffsets[A]=this.nodeCount);const R=E-1,U=a[R];let Z,$=0;for(let re=0;re<this._siblingOffset.length;re++){const ae=2*p+this._siblingOffset[re][0],ue=2*y+this._siblingOffset[re][1],Ce=U.getElevation(ae,ue),ke=U.isLeaf(ae,ue),Ve=this._addNode(Ce.min,Ce.max,ke);ke&&($|=1<<re),Z||(Z=Ve)}for(let re=0;re<this._siblingOffset.length;re++)$&1<<re||this._construct(a,2*p+this._siblingOffset[re][0],2*y+this._siblingOffset[re][1],R,Z+re)}}function jg(c,a,p,y,E,A){return ii(ii(c,p,A),ii(a,y,A),E)}function Fh(c,a,p){const y=p.dim,E=an(c*y-.5,0,y-1),A=an(a*y-.5,0,y-1),R=Math.floor(E),U=Math.floor(A),Z=Math.min(R+1,y-1),$=Math.min(U+1,y-1);return jg(p.get(R,U),p.get(Z,U),p.get(R,$),p.get(Z,$),E-R,A-U)}const bf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Hd{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(a,p,y,E=!1,A=!1){if(this.uid=a,p.height!==p.width)throw new RangeError("DEM tiles must be square");if(y&&"mapbox"!==y&&"terrarium"!==y)return Ui(`"${y}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=p.height;const R=this.dim=p.height-2;if(this.data=new Uint32Array(p.data.buffer),this.encoding=y||"mapbox",this.borderReady=E,!E){for(let U=0;U<R;U++)this.data[this._idx(-1,U)]=this.data[this._idx(0,U)],this.data[this._idx(R,U)]=this.data[this._idx(R-1,U)],this.data[this._idx(U,-1)]=this.data[this._idx(U,0)],this.data[this._idx(U,R)]=this.data[this._idx(U,R-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(R,-1)]=this.data[this._idx(R-1,0)],this.data[this._idx(-1,R)]=this.data[this._idx(0,R-1)],this.data[this._idx(R,R)]=this.data[this._idx(R-1,R-1)],A&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new p0(this)}get(a,p,y=!1){const E=new Uint8Array(this.data.buffer);y&&(a=an(a,-1,this.dim),p=an(p,-1,this.dim));const A=4*this._idx(a,p);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(E[A],E[A+1],E[A+2])}static getUnpackVector(a){return bf[a]}get unpackVector(){return bf[this.encoding]}_idx(a,p){if(a<-1||a>=this.dim+1||p<-1||p>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(p+1)*this.stride+(a+1)}_unpackMapbox(a,p,y){return(256*a*256+256*p+y)/10-1e4}_unpackTerrarium(a,p,y){return 256*a+p+y/256-32768}static pack(a,p){const y=[0,0,0,0],E=Hd.getUnpackVector(p);let A=Math.floor((a+E[3])/E[2]);return y[2]=A%256,A=Math.floor(A/256),y[1]=A%256,A=Math.floor(A/256),y[0]=A,y}getPixels(){return new Rh({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(a,p,y){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let E=p*this.dim,A=p*this.dim+this.dim,R=y*this.dim,U=y*this.dim+this.dim;switch(p){case-1:E=A-1;break;case 1:A=E+1}switch(y){case-1:R=U-1;break;case 1:U=R+1}const Z=-p*this.dim,$=-y*this.dim;for(let re=R;re<U;re++)for(let ae=E;ae<A;ae++)this.data[this._idx(ae,re)]=a.data[this._idx(ae+Z,re+$)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Zn("DEMData",Hd),Zn("DemMinMaxQuadTree",p0,{omit:["dem"]});class Km{constructor(a,p){this.max=a,this.onRemove=p,this.reset()}reset(){for(const a in this.data)for(const p of this.data[a])p.timeout&&clearTimeout(p.timeout),this.onRemove(p.value);return this.data={},this.order=[],this}add(a,p,y){const E=a.wrapped().key;void 0===this.data[E]&&(this.data[E]=[]);const A={value:p,timeout:void 0};if(void 0!==y&&(A.timeout=setTimeout(()=>{this.remove(a,A)},y)),this.data[E].push(A),this.order.push(E),this.order.length>this.max){const R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const p=this.data[a].shift();return p.timeout&&clearTimeout(p.timeout),0===this.data[a].length&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),p.value}getByKey(a){const p=this.data[a];return p?p[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,p){if(!this.has(a))return this;const y=a.wrapped().key,E=void 0===p?0:this.data[y].indexOf(p),A=this.data[y][E];return this.data[y].splice(E,1),A.timeout&&clearTimeout(A.timeout),0===this.data[y].length&&delete this.data[y],this.onRemove(A.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}filter(a){const p=[];for(const y in this.data)for(const E of this.data[y])a(E.value)||p.push(E);for(const y of p)this.remove(y.value.tileID,y)}}class ch{constructor(a,p,y){this.func=a,this.mask=p,this.range=y}}ch.ReadOnly=!1,ch.ReadWrite=!0,ch.disabled=new ch(519,ch.ReadOnly,[0,1]);class Jm{constructor(a,p,y,E,A,R){this.test=a,this.ref=p,this.mask=y,this.fail=E,this.depthFail=A,this.pass=R}}Jm.disabled=new Jm({func:519,mask:0},0,0,7680,7680,7680);class Uc{constructor(a,p,y){this.blendFunction=a,this.blendColor=p,this.mask=y}}Uc.Replace=[1,0],Uc.disabled=new Uc(Uc.Replace,Mn.transparent,[!1,!1,!1,!1]),Uc.unblended=new Uc(Uc.Replace,Mn.transparent,[!0,!0,!0,!0]),Uc.alphaBlended=new Uc([1,771],Mn.transparent,[!0,!0,!0,!0]);class ip{constructor(a,p,y){this.enable=a,this.mode=p,this.frontFace=y}}ip.disabled=new ip(!1,1029,2305),ip.backCCW=new ip(!0,1029,2305),ip.backCW=new ip(!0,1029,2304),ip.frontCW=new ip(!0,1028,2304),ip.frontCCW=new ip(!0,1028,2305);class Vc extends mt{constructor(a,p,y){super(),this.id=a,this._onlySymbols=y,p.on("data",E=>{"source"===E.dataType&&"metadata"===E.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===E.dataType&&"content"===E.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),p.on("error",()=>{this._sourceErrored=!0}),this._source=p,this._tiles={},this._cache=new Km(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Oy}onAdd(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const a in this._tiles){const p=this._tiles[a];if("loaded"!==p.state&&"errored"!==p.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(a,p){return a.isSymbolTile=this._onlySymbols,this._source.loadTile(a,p)}_unloadTile(a){if(this._source.unloadTile)return this._source.unloadTile(a,()=>{})}_abortTile(a){if(this._source.abortTile)return this._source.abortTile(a,()=>{})}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const p in this._tiles){const y=this._tiles[p];y.upload(a),y.prepare(this.map.style.imageManager)}}getIds(){return dr(this._tiles).map(a=>a.tileID).sort(Fy).map(a=>a.key)}getRenderableIds(a){const p=[];for(const y in this._tiles)this._isIdRenderable(+y,a)&&p.push(this._tiles[y]);return a?p.sort((y,E)=>{const A=y.tileID,R=E.tileID,U=new it(A.canonical.x,A.canonical.y)._rotate(this.transform.angle),Z=new it(R.canonical.x,R.canonical.y)._rotate(this.transform.angle);return A.overscaledZ-R.overscaledZ||Z.y-U.y||Z.x-U.x}).map(y=>y.tileID.key):p.map(y=>y.tileID).sort(Fy).map(y=>y.key)}hasRenderableParent(a){const p=this.findLoadedParent(a,0);return!!p&&this._isIdRenderable(p.tileID.key)}_isIdRenderable(a,p){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(p||!this._tiles[a].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)"errored"!==this._tiles[a].state&&this._reloadTile(+a,"reloading")}}_reloadTile(a,p){const y=this._tiles[a];y&&("loading"!==y.state&&(y.state=p),this._loadTile(y,this._tileLoaded.bind(this,y,a,p)))}_tileLoaded(a,p,y,E){if(E)return a.state="errored",void(404!==E.status?this._source.fire(new Xt(E,{tile:a})):this.update(this.transform));a.timeAdded=zs.now(),"expired"===y&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(p,a),"raster-dem"===this.getSource().type&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),this._source.fire(new xt("data",{dataType:"source",tile:a,coord:a.tileID,sourceCacheId:this.id}))}_backfillDEM(a){const p=this.getRenderableIds();for(let E=0;E<p.length;E++){const A=p[E];if(a.neighboringTiles&&a.neighboringTiles[A]){const R=this.getTileByID(A);y(a,R),y(R,a)}}function y(E,A){if(!E.dem||E.dem.borderReady)return;E.needsHillshadePrepare=!0,E.needsDEMTextureUpload=!0;let R=A.tileID.canonical.x-E.tileID.canonical.x;const U=A.tileID.canonical.y-E.tileID.canonical.y,Z=Math.pow(2,E.tileID.canonical.z),$=A.tileID.key;0===R&&0===U||Math.abs(U)>1||(Math.abs(R)>1&&(1===Math.abs(R+Z)?R+=Z:1===Math.abs(R-Z)&&(R-=Z)),A.dem&&E.dem&&(E.dem.backfillBorder(A.dem,R,U),E.neighboringTiles&&E.neighboringTiles[$]&&(E.neighboringTiles[$].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,p,y,E){for(const A in this._tiles){let R=this._tiles[A];if(E[A]||!R.hasData()||R.tileID.overscaledZ<=p||R.tileID.overscaledZ>y)continue;let U=R.tileID;for(;R&&R.tileID.overscaledZ>p+1;){const $=R.tileID.scaledTo(R.tileID.overscaledZ-1);R=this._tiles[$.key],R&&R.hasData()&&(U=$)}let Z=U;for(;Z.overscaledZ>p;)if(Z=Z.scaledTo(Z.overscaledZ-1),a[Z.key]){E[U.key]=U;break}}}findLoadedParent(a,p){if(a.key in this._loadedParentTiles){const y=this._loadedParentTiles[a.key];return y&&y.tileID.overscaledZ>=p?y:null}for(let y=a.overscaledZ-1;y>=p;y--){const E=a.scaledTo(y),A=this._getLoadedTile(E);if(A)return A}}_getLoadedTile(a){const p=this._tiles[a.key];return p&&p.hasData()?p:this._cache.getByKey(this._source.reparseOverscaled?a.wrapped().key:a.canonical.key)}updateCacheSize(a,p){p=p||this._source.tileSize;const y=Math.ceil(a.width/p)+1,E=Math.ceil(a.height/p)+1,A=Math.floor(y*E*5),R="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,A):A;this._cache.setMaxSize(R)}handleWrapJump(a){const p=Math.round((a-(void 0===this._prevLng?a:this._prevLng))/360);if(this._prevLng=a,p){const y={};for(const E in this._tiles){const A=this._tiles[E];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+p),y[A.tileID.key]=A}this._tiles=y;for(const E in this._timers)clearTimeout(this._timers[E]),delete this._timers[E];for(const E in this._tiles)this._setTileReloadTimer(+E,this._tiles[E])}}update(a,p,y){if(this.transform=a,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!y)return;let E;this.updateCacheSize(a,p),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?E=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(U=>new rl(U.canonical.z,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y)):(E=a.coveringTiles({tileSize:p||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!y,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(E=E.filter(U=>this._source.hasTile(U)))):E=[];const A=this._updateRetainedTiles(E);if(Qm(this._source.type)&&0!==E.length){const U={},Z={},$=Object.keys(A);for(const ae of $){const ue=A[ae],Ce=this._tiles[ae];if(!Ce||Ce.fadeEndTime&&Ce.fadeEndTime<=zs.now())continue;const ke=this.findLoadedParent(ue,Math.max(ue.overscaledZ-Vc.maxOverzooming,this._source.minzoom));ke&&(this._addTile(ke.tileID),U[ke.tileID.key]=ke.tileID),Z[ae]=ue}const re=E[E.length-1].overscaledZ;for(const ae in this._tiles){const ue=this._tiles[ae];if(A[ae]||!ue.hasData())continue;let Ce=ue.tileID;for(;Ce.overscaledZ>re;){Ce=Ce.scaledTo(Ce.overscaledZ-1);const ke=this._tiles[Ce.key];if(ke&&ke.hasData()&&Z[Ce.key]){A[ae]=ue.tileID;break}}}for(const ae in U)A[ae]||(this._coveredTiles[ae]=!0,A[ae]=U[ae])}for(const U in A)this._tiles[U].clearFadeHold();const R=function(U,Z){const $=[];for(const re in U)re in Z||$.push(re);return $}(this._tiles,A);for(const U of R){const Z=this._tiles[U];Z.hasSymbolBuckets&&!Z.holdingForFade()?Z.setHoldDuration(this.map._fadeDuration):Z.hasSymbolBuckets&&!Z.symbolFadeFinished()||this._removeTile(+U)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(+a)}_updateRetainedTiles(a){const p={};if(0===a.length)return p;const y={},E=a.reduce(($,re)=>Math.min($,re.overscaledZ),1/0),A=a[0].overscaledZ,R=Math.max(A-Vc.maxOverzooming,this._source.minzoom),U=Math.max(A+Vc.maxUnderzooming,this._source.minzoom),Z={};for(const $ of a){const re=this._addTile($);p[$.key]=$,re.hasData()||E<this._source.maxzoom&&(Z[$.key]=$)}this._retainLoadedChildren(Z,E,U,p);for(const $ of a){let re=this._tiles[$.key];if(re.hasData())continue;if($.canonical.z>=this._source.maxzoom){const ue=$.children(this._source.maxzoom)[0],Ce=this.getTile(ue);if(Ce&&Ce.hasData()){p[ue.key]=ue;continue}}else{const ue=$.children(this._source.maxzoom);if(p[ue[0].key]&&p[ue[1].key]&&p[ue[2].key]&&p[ue[3].key])continue}let ae=re.wasRequested();for(let ue=$.overscaledZ-1;ue>=R;--ue){const Ce=$.scaledTo(ue);if(y[Ce.key]||(y[Ce.key]=!0,re=this.getTile(Ce),!re&&ae&&(re=this._addTile(Ce)),re&&(p[Ce.key]=Ce,ae=re.wasRequested(),re.hasData())))break}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const p=[];let y,E=this._tiles[a].tileID;for(;E.overscaledZ>0;){if(E.key in this._loadedParentTiles){y=this._loadedParentTiles[E.key];break}p.push(E.key);const A=E.scaledTo(E.overscaledZ-1);if(y=this._getLoadedTile(A),y)break;E=A}for(const A of p)this._loadedParentTiles[A]=y}}_addTile(a){let p=this._tiles[a.key];if(p)return p;p=this._cache.getAndRemove(a),p&&(this._setTileReloadTimer(a.key,p),p.tileID=a,this._state.initializeTileState(p,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,p)));const y=Boolean(p);if(!y){const E=this.map?this.map.painter:null;p=new Ry(a,this._source.tileSize*a.overscaleFactor(),this.transform.tileZoom,E,"raster"===this._source.type||"raster-dem"===this._source.type),this._loadTile(p,this._tileLoaded.bind(this,p,a.key,p.state))}return p?(p.uses++,this._tiles[a.key]=p,y||this._source.fire(new xt("dataloading",{tile:p,coord:p.tileID,dataType:"source"})),p):null}_setTileReloadTimer(a,p){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const y=p.getExpiryTimeout();y&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},y))}_removeTile(a){const p=this._tiles[a];p&&(p.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),p.uses>0||(p.hasData()&&"reloading"!==p.state?this._cache.add(p.tileID,p,p.getExpiryTimeout()):(p.aborted=!0,this._abortTile(p),this._unloadTile(p))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(+a);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(a,p,y){const E=[],A=this.transform;if(!A)return E;for(const R in this._tiles){const U=this._tiles[R];if(y&&U.clearQueryDebugViz(),U.holdingForFade())continue;const Z=a.containsTile(U,A,p);Z&&E.push(Z)}return E}getVisibleCoordinates(a){const p=this.getRenderableIds(a).map(y=>this._tiles[y].tileID);for(const y of p)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped());return p}hasTransition(){if(this._source.hasTransition())return!0;if(Qm(this._source.type))for(const a in this._tiles){const p=this._tiles[a];if(void 0!==p.fadeEndTime&&p.fadeEndTime>=zs.now())return!0}return!1}setFeatureState(a,p,y){this._state.updateState(a=a||"_geojsonTileLayer",p,y)}removeFeatureState(a,p,y){this._state.removeFeatureState(a=a||"_geojsonTileLayer",p,y)}getFeatureState(a,p){return this._state.getState(a=a||"_geojsonTileLayer",p)}setDependencies(a,p,y){const E=this._tiles[a];E&&E.setDependencies(p,y)}reloadTilesForDependencies(a,p){for(const y in this._tiles)this._tiles[y].hasDependency(a,p)&&this._reloadTile(+y,"reloading");this._cache.filter(y=>!y.hasDependency(a,p))}}function Fy(c,a){const p=Math.abs(2*c.wrap)-+(c.wrap<0),y=Math.abs(2*a.wrap)-+(a.wrap<0);return c.overscaledZ-a.overscaledZ||y-p||a.canonical.y-c.canonical.y||a.canonical.x-c.canonical.x}function Qm(c){return"raster"===c||"image"===c||"video"===c}Vc.maxOverzooming=10,Vc.maxUnderzooming=3;class Cf{constructor(a,p,y){this._demTile=a,this._dem=this._demTile.dem,this._scale=p,this._offset=y}static create(a,p,y){const E=y||a.findDEMTileFor(p);if(!E||!E.dem)return;const A=E.dem,R=E.tileID,U=1<<p.canonical.z-R.canonical.z;return new Cf(E,E.tileSize/Bi/U,[(p.canonical.x/U-R.canonical.x)*A.dim,(p.canonical.y/U-R.canonical.y)*A.dim])}tileCoordToPixel(a,p){const y=p*this._scale+this._offset[1],E=Math.floor(a*this._scale+this._offset[0]),A=Math.floor(y);return new it(E,A)}getElevationAt(a,p,y,E){const A=a*this._scale+this._offset[0],R=p*this._scale+this._offset[1],U=Math.floor(A),Z=Math.floor(R),$=this._dem;return E=!!E,y?ii(ii($.get(U,Z,E),$.get(U,Z+1,E),R-Z),ii($.get(U+1,Z,E),$.get(U+1,Z+1,E),R-Z),A-U):$.get(U,Z,E)}getElevationAtPixel(a,p,y){return this._dem.get(a,p,!!y)}getMeterToDEM(a){return(1<<this._demTile.tileID.canonical.z)*wg(1,a)*this._dem.stride}}class zy{constructor(a,p){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Vr(Bi,16,0),this.featureIndexArray=new Xr,this.promoteId=p}insert(a,p,y,E,A,R=0){const U=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(y,E,A,R);const Z=this.grid;for(let $=0;$<p.length;$++){const re=p[$],ae=[1/0,1/0,-1/0,-1/0];for(let ue=0;ue<re.length;ue++){const Ce=re[ue];ae[0]=Math.min(ae[0],Ce.x),ae[1]=Math.min(ae[1],Ce.y),ae[2]=Math.max(ae[2],Ce.x),ae[3]=Math.max(ae[3],Ce.y)}ae[0]<Bi&&ae[1]<Bi&&ae[2]>=0&&ae[3]>=0&&Z.insert(U,ae[0],ae[1],ae[2],ae[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new jp.VectorTile(new Up(this.rawTileData)).layers,this.sourceLayerCoder=new h0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const a in this.vtLayers)this.vtFeatures[a]=[]}return this.vtLayers}query(a,p,y,E){this.loadVTLayers();const A=a.params||{},R=Sl(A.filter),U=a.tileResult,Z=a.transform,$=U.bufferedTilespaceBounds,re=this.grid.query($.min.x,$.min.y,$.max.x,$.max.y,(ke,Ve,We,rt)=>wv(U.bufferedTilespaceGeometry,ke,Ve,We,rt));re.sort(d0);let ae=null;Z.elevation&&re.length>0&&(ae=Cf.create(Z.elevation,this.tileID));const ue={};let Ce;for(let ke=0;ke<re.length;ke++){const Ve=re[ke];if(Ve===Ce)continue;Ce=Ve;const We=this.featureIndexArray.get(Ve);let rt=null;this.loadMatchingFeature(ue,We,R,A.layers,A.availableImages,p,y,E,(ht,vt,Tt,Ct=0)=>(rt||(rt=gc(ht,this.tileID.canonical,a.tileTransform)),vt.queryIntersectsFeature(U,ht,Tt,rt,this.z,a.transform,a.pixelPosMatrix,ae,Ct)))}return ue}loadMatchingFeature(a,p,y,E,A,R,U,Z,$){const{featureIndex:re,bucketIndex:ae,sourceLayerIndex:ue,layoutVertexArrayOffset:Ce}=p,ke=this.bucketLayerIDs[ae];if(E&&!function(ht,vt){for(let Tt=0;Tt<ht.length;Tt++)if(vt.indexOf(ht[Tt])>=0)return!0;return!1}(E,ke))return;const Ve=this.sourceLayerCoder.decode(ue),We=this.vtLayers[Ve].feature(re);if(y.needGeometry){const ht=Mm(We,!0);if(!y.filter(new Q(this.tileID.overscaledZ),ht,this.tileID.canonical))return}else if(!y.filter(new Q(this.tileID.overscaledZ),We))return;const rt=this.getId(We,Ve);for(let ht=0;ht<ke.length;ht++){const vt=ke[ht];if(E&&E.indexOf(vt)<0)continue;const Tt=R[vt];if(!Tt)continue;let Ct={};void 0!==rt&&Z&&(Ct=Z.getState(Tt.sourceLayer||"_geojsonTileLayer",rt));const kt=jn({},U[vt]);kt.paint=am(kt.paint,Tt.paint,We,Ct,A),kt.layout=am(kt.layout,Tt.layout,We,Ct,A);const ln=!$||$(We,Tt,Ct,Ce);if(!ln)continue;const Yt=new ky(We,this.z,this.x,this.y,rt);Yt.layer=kt;let Kn=a[vt];void 0===Kn&&(Kn=a[vt]=[]),Kn.push({featureIndex:re,feature:Yt,intersectionZ:ln})}}lookupSymbolFeatures(a,p,y,E,A,R,U,Z){const $={};this.loadVTLayers();const re=Sl(A);for(const ae of a)this.loadMatchingFeature($,{bucketIndex:y,sourceLayerIndex:E,featureIndex:ae,layoutVertexArrayOffset:0},re,R,U,Z,p);return $}loadFeature(a){const{featureIndex:p,sourceLayerIndex:y}=a;this.loadVTLayers();const E=this.sourceLayerCoder.decode(y),A=this.vtFeatures[E];if(A[p])return A[p];const R=this.vtLayers[E].feature(p);return A[p]=R,R}hasLayer(a){for(const p of this.bucketLayerIDs)for(const y of p)if(a===y)return!0;return!1}getId(a,p){let y=a.id;return this.promoteId&&(y=a.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[p]],"boolean"==typeof y&&(y=Number(y))),y}}function am(c,a,p,y,E){return Pr(c,(A,R)=>{const U=a instanceof Le?a.get(R):null;return U&&U.evaluate?U.evaluate(p,y,E):U})}function d0(c,a){return a-c}Zn("FeatureIndex",zy,{omit:["rawTileData","sourceLayerCoder"]});class Ny{constructor(a){const p={},y=[];for(const U in a){const Z=a[U],$=p[U]={};for(const re in Z.glyphs){const ae=Z.glyphs[+re];if(!ae||0===ae.bitmap.width||0===ae.bitmap.height)continue;const ue=ae.metrics.localGlyph?2:1,Ce={x:0,y:0,w:ae.bitmap.width+2*ue,h:ae.bitmap.height+2*ue};y.push(Ce),$[re]=Ce}}const{w:E,h:A}=st(y),R=new Ph({width:E||1,height:A||1});for(const U in a){const Z=a[U];for(const $ in Z.glyphs){const re=Z.glyphs[+$];if(!re||0===re.bitmap.width||0===re.bitmap.height)continue;const ae=p[U][$],ue=re.metrics.localGlyph?2:1;Ph.copy(re.bitmap,R,{x:0,y:0},{x:ae.x+ue,y:ae.y+ue},re.bitmap)}}this.image=R,this.positions=p}}Zn("GlyphAtlas",Ny);class f0{constructor(a){this.tileID=new rl(a.tileID.overscaledZ,a.tileID.wrap,a.tileID.canonical.z,a.tileID.canonical.x,a.tileID.canonical.y),this.tileZoom=a.tileZoom,this.uid=a.uid,this.zoom=a.zoom,this.canonical=a.tileID.canonical,this.pixelRatio=a.pixelRatio,this.tileSize=a.tileSize,this.source=a.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=a.showCollisionBoxes,this.collectResourceTiming=!!a.collectResourceTiming,this.returnDependencies=!!a.returnDependencies,this.promoteId=a.promoteId,this.enableTerrain=!!a.enableTerrain,this.isSymbolTile=a.isSymbolTile,a.projection&&(this.tileTransform=om(a.tileID.canonical,a.projection))}parse(a,p,y,E,A){this.status="parsing",this.data=a,this.collisionBoxArray=new at;const R=new h0(Object.keys(a.layers).sort()),U=new zy(this.tileID,this.promoteId);U.bucketLayerIDs=[];const Z={},$=new Dy(256,256),re={featureIndex:U,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:$,availableImages:y},ae=p.familiesBySource[this.source];for(const Ct in ae){const kt=a.layers[Ct];if(!kt)continue;let ln=!1,Yt=!1;for(const hn of ae[Ct])"symbol"===hn[0].type?ln=!0:Yt=!0;if(!0===this.isSymbolTile&&!ln||!1===this.isSymbolTile&&!Yt)continue;1===kt.version&&Ui(`Vector tile source "${this.source}" layer "${Ct}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Kn=R.encode(Ct),In=[];for(let hn=0;hn<kt.length;hn++){const Tn=kt.feature(hn),Ln=U.getId(Tn,Ct);In.push({feature:Tn,id:Ln,index:hn,sourceLayerIndex:Kn})}for(const hn of ae[Ct]){const Tn=hn[0];void 0!==this.isSymbolTile&&"symbol"===Tn.type!==this.isSymbolTile||Tn.minzoom&&this.zoom<Math.floor(Tn.minzoom)||Tn.maxzoom&&this.zoom>=Tn.maxzoom||"none"!==Tn.visibility&&(Ug(hn,this.zoom,y),(Z[Tn.id]=Tn.createBucket({index:U.bucketLayerIDs.length,layers:hn,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Kn,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:y})).populate(In,re,this.tileID.canonical,this.tileTransform),U.bucketLayerIDs.push(hn.map(Ln=>Ln.id)))}}let ue,Ce,ke,Ve;$.trim();const We={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},rt=Pr(re.glyphDependencies,Ct=>Object.keys(Ct).map(Number));Object.keys(rt).length?E.send("getGlyphs",{uid:this.uid,stacks:rt},(Ct,kt)=>{ue||(ue=Ct,Ce=kt,Tt.call(this))},void 0,!1,We):Ce={};const ht=Object.keys(re.iconDependencies);ht.length?E.send("getImages",{icons:ht,source:this.source,tileID:this.tileID,type:"icons"},(Ct,kt)=>{ue||(ue=Ct,ke=kt,Tt.call(this))},void 0,!1,We):ke={};const vt=Object.keys(re.patternDependencies);function Tt(){if(ue)return A(ue);if(Ce&&ke&&Ve){const Ct=new Ny(Ce),kt=new At(ke,Ve);for(const ln in Z){const Yt=Z[ln];Yt instanceof qp?(Ug(Yt.layers,this.zoom,y),Qh(Yt,Ce,Ct.positions,ke,kt.iconPositions,this.showCollisionBoxes,y,this.tileID.canonical,this.tileZoom)):Yt.hasPattern&&(Yt instanceof ad||Yt instanceof Iy||Yt instanceof Ld)&&(Ug(Yt.layers,this.zoom,y),Yt.addFeatures(re,this.tileID.canonical,kt.patternPositions,y))}this.status="done",A(null,{buckets:dr(Z).filter(ln=>!ln.isEmpty()),featureIndex:U,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ct.image,lineAtlas:$,imageAtlas:kt,glyphMap:this.returnDependencies?Ce:null,iconMap:this.returnDependencies?ke:null,glyphPositions:this.returnDependencies?Ct.positions:null})}}vt.length?E.send("getImages",{icons:vt,source:this.source,tileID:this.tileID,type:"patterns"},(Ct,kt)=>{ue||(ue=Ct,Ve=kt,Tt.call(this))},void 0,!1,We):Ve={},Tt.call(this)}}function Ug(c,a,p){const y=new Q(a);for(const E of c)E.recalculate(y,p)}class sm{constructor(a){this.entries={},this.scheduler=a}request(a,p,y,E){const A=this.entries[a]=this.entries[a]||{callbacks:[]};if(A.result){const[R,U]=A.result;return this.scheduler?this.scheduler.add(()=>{E(R,U)},p):E(R,U),()=>{}}return A.callbacks.push(E),A.cancel||(A.cancel=y((R,U)=>{A.result=[R,U];for(const Z of A.callbacks)this.scheduler?this.scheduler.add(()=>{Z(R,U)},p):Z(R,U);setTimeout(()=>delete this.entries[a],3e3)})),()=>{A.result||(A.callbacks=A.callbacks.filter(R=>R!==E),A.callbacks.length||(A.cancel(),delete this.entries[a]))}}}function qv(c,a,p){const y=JSON.stringify(c.request);return c.data&&(this.deduped.entries[y]={result:[null,c.data]}),this.deduped.request(y,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},E=>{const A=oe(c.request,(R,U,Z,$)=>{R?E(R):U&&E(null,{vectorTile:p?void 0:new jp.VectorTile(new Up(U)),rawData:U,cacheControl:Z,expires:$})});return()=>{A.cancel(),E()}},a)}var Vg={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],conic:!0,initializeConstants(){if(this.constants&&vy(this.parallels,this.constants.parallels))return;const c=Math.sin(fn(this.parallels[0])),a=(c+Math.sin(fn(this.parallels[1])))/2,p=1+c*(2*a-c),y=Math.sqrt(p)/a;this.constants={n:a,c:p,r0:y,parallels:this.parallels}},project(c,a){this.initializeConstants();const p=fn(c-this.center[0]),y=fn(a),{n:E,c:A,r0:R}=this.constants,U=Math.sqrt(A-2*E*Math.sin(y))/E;return{x:U*Math.sin(p*E),y:U*Math.cos(p*E)-R}},unproject(c,a){this.initializeConstants();const{n:p,c:y,r0:E}=this.constants,A=E+a;let R=Math.atan2(c,Math.abs(A))*Math.sign(A);A*p<0&&(R-=Math.PI*Math.sign(c)*Math.sign(A));const U=fn(this.center[0])*p;R=Rn(R,-Math.PI-U,Math.PI-U);const Z=et(R/p)+this.center[0],$=Math.asin(an((y-(c*c+A*A)*p*p)/(2*p),-1,1)),re=an(et($),-85.051129,od);return new qo(Z,re)}};const Gg=1.340264,eg=-.081106,vc=893e-6,qg=.003796,By=Math.sqrt(3)/2;var eb={name:"equalEarth",center:[0,0],range:[3.5,7],project(c,a){a=a/180*Math.PI,c=c/180*Math.PI;const p=Math.asin(By*Math.sin(a)),y=p*p,E=y*y*y;return{x:.5*(c*Math.cos(p)/(By*(Gg+3*eg*y+E*(7*vc+9*qg*y)))/Math.PI+.5),y:1-.5*(p*(Gg+eg*y+E*(vc+qg*y))/Math.PI+1)}},unproject(c,a){c=(2*c-.5)*Math.PI;let p=a=(2*(1-a)-1)*Math.PI,y=p*p,E=y*y*y;for(let $,re,ae,ue=0;ue<12&&(re=p*(Gg+eg*y+E*(vc+qg*y))-a,ae=Gg+3*eg*y+E*(7*vc+9*qg*y),$=re/ae,p=an(p-$,-Math.PI/3,Math.PI/3),y=p*p,E=y*y*y,!(Math.abs($)<1e-12));++ue);const A=By*c*(Gg+3*eg*y+E*(7*vc+9*qg*y))/Math.cos(p),R=Math.asin(Math.sin(p)/By),U=an(180*A/Math.PI,-180,180),Z=an(180*R/Math.PI,-85.051129,od);return new qo(U,Z)}},tb={name:"equirectangular",wrap:!0,center:[0,0],range:[3.5,7],project:(c,a)=>({x:.5+c/360,y:.5-a/360}),unproject(c,a){const p=360*(c-.5),y=an(360*(.5-a),-85.051129,od);return new qo(p,y)}};const lm=Math.PI/2;function Zv(c){return Math.tan((lm+c)/2)}var Dx={name:"lambertConformalConic",range:[3.5,7],center:[0,30],parallels:[30,30],conic:!0,initializeConstants(){if(this.constants&&vy(this.parallels,this.constants.parallels))return;const c=fn(this.parallels[0]),a=fn(this.parallels[1]),p=Math.cos(c),y=c===a?Math.sin(c):Math.log(p/Math.cos(a))/Math.log(Zv(a)/Zv(c)),E=p*Math.pow(Zv(c),y)/y;this.constants={n:y,f:E,parallels:this.parallels}},project(c,a){this.initializeConstants(),a=fn(a),c=fn(c-this.center[0]);const p=1e-6,{n:y,f:E}=this.constants;E>0?a<-lm+p&&(a=-lm+p):a>lm-p&&(a=lm-p);const A=E/Math.pow(Zv(a),y),R=A*Math.sin(y*c),U=E-A*Math.cos(y*c);return{x:.5*(R/Math.PI+.5),y:1-.5*(U/Math.PI+.5)}},unproject(c,a){this.initializeConstants(),c=(2*c-.5)*Math.PI,a=(2*(1-a)-.5)*Math.PI;const{n:p,f:y}=this.constants,E=y-a,A=Math.sign(E),R=Math.sign(p)*Math.sqrt(c*c+E*E);let U=Math.atan2(c,Math.abs(E))*A;E*p<0&&(U-=Math.PI*Math.sign(c)*A);const Z=an(et(U/p)+this.center[0],-180,180),$=an(et(2*Math.atan(Math.pow(y/R,1/p))-lm),-85.051129,od);return new qo(Z,$)}},yp={name:"mercator",wrap:!0,center:[0,0],project:(c,a)=>({x:dy(c),y:Du(a)}),unproject(c,a){const p=Dh(c),y=Dd(a);return new qo(p,y)}};const tg=fn(od);var m0={name:"naturalEarth",center:[0,0],range:[3.5,7],project(c,a){const p=(a=fn(a))*a,y=p*p;return{x:.5*((c=fn(c))*(.8707-.131979*p+y*(y*(.003971*p-.001529*y)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+p*(.015085+y*(.028874*p-.044475-.005916*y)))/Math.PI+1)}},unproject(c,a){c=(2*c-.5)*Math.PI;let p=a=(2*(1-a)-1)*Math.PI,y=25,E=0,A=p*p;do{A=p*p;const Z=A*A;E=(p*(1.007226+A*(.015085+Z*(.028874*A-.044475-.005916*Z)))-a)/(1.007226+A*(.045255+Z*(.259866*A-.311325-.005916*11*Z))),p=an(p-E,-tg,tg)}while(Math.abs(E)>1e-6&&--y>0);A=p*p;const R=an(et(c/(.8707+A*(A*(A*A*A*(.003971-.001529*A)-.013791)-.131979))),-180,180),U=et(p);return new qo(R,U)}};const ng=fn(od),Hv={albers:Vg,equalEarth:eb,equirectangular:tb,lambertConformalConic:Dx,mercator:yp,naturalEarth:m0,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],project(c,a){a=fn(a),c=fn(c);const p=Math.cos(a),y=2/Math.PI,E=Math.acos(p*Math.cos(c/2)),A=Math.sin(E)/E,R=.5*(c*y+2*p*Math.sin(c/2)/A)||0,U=.5*(a+Math.sin(a)/A)||0;return{x:.5*(R/Math.PI+.5),y:1-.5*(U/Math.PI+1)}},unproject(c,a){let p=c=(2*c-.5)*Math.PI,y=a=(2*(1-a)-1)*Math.PI,E=25;const A=1e-6;let R=0,U=0;do{const Z=Math.cos(y),$=Math.sin(y),re=2*$*Z,ae=$*$,ue=Z*Z,Ce=Math.cos(p/2),ke=Math.sin(p/2),Ve=2*Ce*ke,We=ke*ke,rt=1-ue*Ce*Ce,ht=rt?1/rt:0,vt=rt?Math.acos(Z*Ce)*Math.sqrt(1/rt):0,Tt=.5*(2*vt*Z*ke+2*p/Math.PI)-c,Ct=.5*(vt*$+y)-a,kt=.5*ht*(ue*We+vt*Z*Ce*ae)+1/Math.PI,ln=ht*(Ve*re/4-vt*$*ke),Yt=.125*ht*(re*ke-vt*$*ue*Ve),Kn=.5*ht*(ae*Ce+vt*We*Z)+.5,In=ln*Yt-Kn*kt;R=(Ct*ln-Tt*Kn)/In,U=(Tt*Yt-Ct*kt)/In,p=an(p-R,-Math.PI,Math.PI),y=an(y-U,-ng,ng)}while((Math.abs(R)>A||Math.abs(U)>A)&&--E>0);return new qo(et(p),et(y))}}};C.ARRAY_TYPE=po,C.AUTH_ERR_MSG=Na,C.Actor=class{constructor(c,a,p){this.target=c,this.parent=a,this.mapId=p,this.callbacks={},this.cancelCallbacks={},ct(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Vi()?c:Ke,this.scheduler=new Ax}send(c,a,p,y,E=!1,A){const R=Math.round(1e18*Math.random()).toString(36).substring(0,10);p&&(p.metadata=A,this.callbacks[R]=p);const U=Yl(this.globalScope)?void 0:[];return this.target.postMessage({id:R,type:c,hasCallback:!!p,targetMapId:y,mustQueue:E,sourceMapId:this.mapId,data:ta(a,U)},U),{cancel:()=>{p&&delete this.callbacks[R],this.target.postMessage({id:R,type:"<cancel>",targetMapId:y,sourceMapId:this.mapId})}}}receive(c){const a=c.data,p=a.id;if(p&&(!a.targetMapId||this.mapId===a.targetMapId))if("<cancel>"===a.type){const y=this.cancelCallbacks[p];delete this.cancelCallbacks[p],y&&y.cancel()}else if(a.mustQueue||Vi()){const y=this.callbacks[p];this.cancelCallbacks[p]=this.scheduler.add(()=>this.processTask(p,a),y&&y.metadata||{type:"message"})}else this.processTask(p,a)}processTask(c,a){if("<response>"===a.type){const p=this.callbacks[c];delete this.callbacks[c],p&&(a.error?p(Un(a.error)):p(null,Un(a.data)))}else{const p=Yl(this.globalScope)?void 0:[],y=a.hasCallback?(A,R)=>{delete this.cancelCallbacks[c],this.target.postMessage({id:c,type:"<response>",sourceMapId:this.mapId,error:A?ta(A):null,data:ta(R,p)},p)}:A=>{},E=Un(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,E,y);else if(this.parent.getWorkerSource){const A=a.type.split(".");this.parent.getWorkerSource(a.sourceMapId,A[0],E.source)[A[1]](E,y)}else y(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},C.CanonicalTileID=Oh,C.Color=Mn,C.ColorMode=Uc,C.CullFaceMode=ip,C.DEMData=Hd,C.DataConstantProperty=Me,C.DedupedRequest=sm,C.DepthMode=ch,C.EXTENT=Bi,C.Elevation=class{getAtPointOrZero(c,a=0){return this.getAtPoint(c,a)||0}getAtPoint(c,a,p=!0){null==a&&(a=null);const y=this._source();if(!y||c.y<0||c.y>1)return a;const E=y.getSource().maxzoom,A=1<<E,R=Math.floor(c.x),U=c.x-R,Z=new rl(E,R,E,Math.floor(U*A),Math.floor(c.y*A)),$=this.findDEMTileFor(Z);if(!$||!$.dem)return a;const re=$.dem,ae=1<<$.tileID.canonical.z,ue=(U*ae-$.tileID.canonical.x)*re.dim,Ce=(c.y*ae-$.tileID.canonical.y)*re.dim,ke=Math.floor(ue),Ve=Math.floor(Ce);return(p?this.exaggeration():1)*ii(ii(re.get(ke,Ve),re.get(ke,Ve+1),Ce-Ve),ii(re.get(ke+1,Ve),re.get(ke+1,Ve+1),Ce-Ve),ue-ke)}getAtTileOffset(c,a,p){const y=1<<c.canonical.z;return this.getAtPointOrZero(new kh(c.wrap+(c.canonical.x+a/Bi)/y,(c.canonical.y+p/Bi)/y))}getForTilePoints(c,a,p,y){const E=Cf.create(this,c,y);return!!E&&(a.forEach(A=>{A[2]=this.exaggeration()*E.getElevationAt(A[0],A[1],p)}),!0)}getMinMaxForTile(c){const a=this.findDEMTileFor(c);if(!a||!a.dem)return null;const p=a.dem.tree,y=a.tileID,E=1<<c.canonical.z-y.canonical.z;let A=c.canonical.x/E-y.canonical.x,R=c.canonical.y/E-y.canonical.y,U=0;for(let Z=0;Z<c.canonical.z-y.canonical.z&&!p.leaves[U];Z++){A*=2,R*=2;const $=2*Math.floor(R)+Math.floor(A);U=p.childOffsets[U]+$,A%=1,R%=1}return{min:this.exaggeration()*p.minimums[U],max:this.exaggeration()*p.maximums[U]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,a,p){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},C.ErrorEvent=Xt,C.EvaluationParameters=Q,C.Event=xt,C.Evented=mt,C.GlyphManager=Ei,C.ImagePosition=St,C.LineAtlas=Dy,C.LngLat=qo,C.LngLatBounds=Ad,C.LocalGlyphMode=vs,C.MAX_MERCATOR_LATITUDE=od,C.MAX_SAFE_INTEGER=Wt,C.MercatorCoordinate=kh,C.ONE_EM=24,C.OverscaledTileID=rl,C.Properties=Ot,C.RGBAImage=Rh,C.RequestManager=class{constructor(c,a,p){this._transformRequestFn=c,this._customAccessToken=a,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const c=function(){let a="";for(let p=0;p<10;p++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",_l,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=c.token,this._skuTokenExpiresAt=c.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(c,a){return this._transformRequestFn&&this._transformRequestFn(c,a)||{url:c}}normalizeStyleURL(c,a){if(!la(c))return c;const p=Ys(c);return p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||a)}normalizeGlyphsURL(c,a){if(!la(c))return c;const p=Ys(c);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||a)}normalizeSourceURL(c,a){if(!la(c))return c;const p=Ys(c);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),this._makeAPIURL(p,this._customAccessToken||a)}normalizeSpriteURL(c,a,p,y){const E=Ys(c);return la(c)?(E.path=`/styles/v1${E.path}/sprite${a}${p}`,this._makeAPIURL(E,this._customAccessToken||y)):(E.path+=`${a}${p}`,Ns(E))}normalizeTileURL(c,a,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),c&&!la(c))return c;const y=Ys(c);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||p&&"raster"!==y.authority&&512===p?"@2x":""}${Tc.supported?".webp":"$1"}`),"raster"===y.authority?y.path=`/${Ar.RASTER_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${Ar.TILE_URL_VERSION}${y.path}`);const E=this._customAccessToken||function(A){for(const R of A){const U=R.match(/^access_token=(.*)$/);if(U)return U[1]}return null}(y.params)||Ar.ACCESS_TOKEN;return Ar.REQUIRE_ACCESS_TOKEN&&E&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,E)}canonicalizeTileURL(c,a){const p=Ys(c);if(!p.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!p.path.match(/\.[\w]+$/))return c;let y="mapbox://";p.path.match(/^\/raster\/v1\//)?y+=`raster/${p.path.replace(`/${Ar.RASTER_URL_PREFIX}/`,"")}`:y+=`tiles/${p.path.replace(`/${Ar.TILE_URL_VERSION}/`,"")}`;let E=p.params;return a&&(E=E.filter(A=>!A.match(/^access_token=/))),E.length&&(y+=`?${E.join("&")}`),y}canonicalizeTileset(c,a){const p=!!a&&la(a),y=[];for(const E of c.tiles||[])al(E)?y.push(this.canonicalizeTileURL(E,p)):y.push(E);return y}_makeAPIURL(c,a){const p="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",y=Ys(Ar.API_URL);if(c.protocol=y.protocol,c.authority=y.authority,"http"===c.protocol){const E=c.params.indexOf("secure");E>=0&&c.params.splice(E,1)}if("/"!==y.path&&(c.path=`${y.path}${c.path}`),!Ar.REQUIRE_ACCESS_TOKEN)return Ns(c);if(a=a||Ar.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if("s"===a[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return c.params=c.params.filter(E=>-1===E.indexOf("access_token")),c.params.push(`access_token=${a||""}`),Ns(c)}},C.ResourceType=De,C.SegmentVector=Zs,C.SourceCache=Vc,C.StencilMode=Jm,C.StructArrayLayout1ui2=he,C.StructArrayLayout2f1f2i16=Do,C.StructArrayLayout2i4=Qt,C.StructArrayLayout2ui4=K,C.StructArrayLayout3f12=gr,C.StructArrayLayout3ui6=Ko,C.StructArrayLayout4i8=mn,C.Texture=$m,C.Tile=Ry,C.Transitionable=ge,C.Uniform1f=Sa,C.Uniform1i=class extends el{constructor(c,a){super(c,a),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},C.Uniform2f=class extends el{constructor(c,a){super(c,a),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},C.Uniform3f=class extends el{constructor(c,a){super(c,a),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},C.Uniform4f=Mu,C.UniformColor=Gl,C.UniformMatrix2f=class extends el{constructor(c,a){super(c,a),this.current=ao}set(c){for(let a=0;a<4;a++)if(c[a]!==this.current[a]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}},C.UniformMatrix3f=class extends el{constructor(c,a){super(c,a),this.current=lf}set(c){for(let a=0;a<9;a++)if(c[a]!==this.current[a]){this.current=c,this.gl.uniformMatrix3fv(this.location,!1,c);break}}},C.UniformMatrix4f=class extends el{constructor(c,a){super(c,a),this.current=Id}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let a=1;a<16;a++)if(c[a]!==this.current[a]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},C.UnwrappedTileID=c0,C.ValidationError=ot,C.VectorTileWorkerSource=class extends mt{constructor(c,a,p,y,E){super(),this.actor=c,this.layerIndex=a,this.availableImages=p,this.loadVectorData=E||qv,this.loading={},this.loaded={},this.deduped=new sm(c.scheduler),this.isSpriteLoaded=y,this.scheduler=c.scheduler}loadTile(c,a){const p=c.uid,y=c&&c.request,E=y&&y.collectResourceTiming,A=this.loading[p]=new f0(c);A.abort=this.loadVectorData(c,(R,U)=>{const Z=!this.loading[p];if(delete this.loading[p],Z||R||!U)return A.status="done",Z||(this.loaded[p]=A),a(R);const $=U.rawData,re={};U.expires&&(re.expires=U.expires),U.cacheControl&&(re.cacheControl=U.cacheControl),A.vectorTile=U.vectorTile||new jp.VectorTile(new Up($));const ae=()=>{A.parse(A.vectorTile,this.layerIndex,this.availableImages,this.actor,(ue,Ce)=>{if(ue||!Ce)return a(ue);const ke={};if(E){const Ve=Vv(y);Ve.length>0&&(ke.resourceTiming=JSON.parse(JSON.stringify(Ve)))}a(null,jn({rawTileData:$.slice(0)},Ce,re,ke))})};this.isSpriteLoaded?ae():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(ae,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom}):ae()}),this.loaded=this.loaded||{},this.loaded[p]=A})}reloadTile(c,a){const p=this.loaded,y=c.uid,E=this;if(p&&p[y]){const A=p[y];A.showCollisionBoxes=c.showCollisionBoxes,A.enableTerrain=!!c.enableTerrain;const R=(U,Z)=>{const $=A.reloadCallback;$&&(delete A.reloadCallback,A.parse(A.vectorTile,E.layerIndex,this.availableImages,E.actor,$)),a(U,Z)};"parsing"===A.status?A.reloadCallback=R:"done"===A.status&&(A.vectorTile?A.parse(A.vectorTile,this.layerIndex,this.availableImages,this.actor,R):R())}}abortTile(c,a){const p=c.uid,y=this.loading[p];y&&(y.abort&&y.abort(),delete this.loading[p]),a()}removeTile(c,a){const p=this.loaded,y=c.uid;p&&p[y]&&delete p[y],a()}},C.WritingMode=Lt,C.ZoomHistory=Nr,C.add=function(c,a,p){return c[0]=a[0]+p[0],c[1]=a[1]+p[1],c[2]=a[2]+p[2],c},C.addDynamicAttributes=yf,C.altitudeFromMercatorZ=Im,C.asyncAll=nr,C.bezier=bn,C.bindAll=ct,C.boundsAttributes=Ym,C.bufferConvexPolygon=function(c,a){const p=[];for(let y=0;y<c.length;y++){const E=Rn(y-1,-1,c.length-1),A=Rn(y+1,-1,c.length-1),R=c[y],U=c[A],Z=c[E].sub(R).unit(),$=U.sub(R).unit(),re=$.angleWithSep(Z.x,Z.y),ae=Z.add($).unit().mult(-1*a/Math.sin(re/2));p.push(R.add(ae))}return p},C.cacheEntryPossiblyAdded=function(c){be++,be>Ll&&(c.getActor().send("enforceCacheSizeLimit",Jl),be=0)},C.clamp=an,C.clearTileCache=function(c){const a=Ke.caches.delete(_h);c&&a.catch(c).then(()=>c())},C.clipLine=uu,C.clone=function(c){var a=new po(3);return a[0]=c[0],a[1]=c[1],a[2]=c[2],a},C.clone$1=function(c){var a=new po(16);return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15],a},C.clone$2=vr,C.collisionCircleLayout=l0,C.config=Ar,C.conjugate=function(c,a){return c[0]=-a[0],c[1]=-a[1],c[2]=-a[2],c[3]=a[3],c},C.copy=function(c,a){return c[0]=a[0],c[1]=a[1],c[2]=a[2],c},C.create=Gf,C.create$1=function(){var c=new po(16);return po!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},C.create$2=Cv,C.createExpression=Cl,C.createLayout=ft,C.createStyleLayer=function(c){return"custom"===c.type?new Wm(c):new im[c.type](c)},C.cross=function(c,a,p){var y=a[0],E=a[1],A=a[2],R=p[0],U=p[1],Z=p[2];return c[0]=E*Z-A*U,c[1]=A*R-y*Z,c[2]=y*U-E*R,c},C.degToRad=fn,C.div=function(c,a,p){return c[0]=a[0]/p[0],c[1]=a[1]/p[1],c[2]=a[2]/p[2],c},C.dot=function(c,a){return c[0]*a[0]+c[1]*a[1]+c[2]*a[2]},C.dot$1=function(c,a){return c[0]*a[0]+c[1]*a[1]+c[2]*a[2]+c[3]*a[3]},C.ease=Pn,C.easeCubicInOut=Dt,C.emitValidationErrors=Yo,C.endsWith=Vt,C.enforceCacheSizeLimit=function(c){Da(),Bs&&Bs.then(a=>{a.keys().then(p=>{for(let y=0;y<p.length-c;y++)a.delete(p[y])})})},C.evaluateSizeForFeature=Zm,C.evaluateSizeForZoom=ts,C.evaluateVariableOffset=Gp,C.evented=G,C.exactEquals=function(c,a){return c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2]&&c[3]===a[3]},C.exactEquals$1=function(c,a){return c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2]},C.exported=zs,C.exported$1=Tc,C.extend=jn,C.filterObject=fr,C.fromMat4=function(c,a){return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[4],c[4]=a[5],c[5]=a[6],c[6]=a[8],c[7]=a[9],c[8]=a[10],c},C.fromQuat=function(c,a){var p=a[0],y=a[1],E=a[2],A=a[3],R=p+p,U=y+y,Z=E+E,$=p*R,re=y*R,ae=y*U,ue=E*R,Ce=E*U,ke=E*Z,Ve=A*R,We=A*U,rt=A*Z;return c[0]=1-ae-ke,c[1]=re+rt,c[2]=ue-We,c[3]=0,c[4]=re-rt,c[5]=1-$-ke,c[6]=Ce+Ve,c[7]=0,c[8]=ue+We,c[9]=Ce-Ve,c[10]=1-$-ae,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},C.fromRotation=function(c,a){var p=Math.sin(a),y=Math.cos(a);return c[0]=y,c[1]=p,c[2]=0,c[3]=-p,c[4]=y,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},C.fromScaling=function(c,a){return c[0]=a[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=a[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=a[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},C.furthestTileCorner=function(c){const a=Math.round((c+45+360)%360/90)%4;return _t[a]},C.getAABBPointSquareDist=function(c,a,p){let y=0;for(let E=0;E<2;++E){const A=p?p[E]:0;c[E]>A&&(y+=(c[E]-A)*(c[E]-A)),a[E]<A&&(y+=(A-a[E])*(A-a[E]))}return y},C.getAnchorAlignment=Ci,C.getAnchorJustification=ff,C.getBounds=function(c){let a=1/0,p=1/0,y=-1/0,E=-1/0;for(const A of c)a=Math.min(a,A.x),p=Math.min(p,A.y),y=Math.max(y,A.x),E=Math.max(E,A.y);return{min:new it(a,p),max:new it(y,E)}},C.getImage=Be,C.getJSON=function(c,a){return te(jn(c,{type:"json"}),a)},C.getMapSessionAPI=Qc,C.getPerformanceMeasurement=Vv,C.getProjection=function(c){const a=Hv[c.name];if(!a)throw new Error(`Invalid projection name: ${c.name}`);return a.conic?function(p,y){if(y.parallels&&Math.abs(y.parallels[0]+y.parallels[1])<.01){let E=function(A){const R=Math.max(.01,Math.cos(fn(A))),U=1/(2*Math.max(Math.PI*R,1/R));return{wrap:!0,project(Z,$){const re=fn(Z)*R,ae=Math.sin(fn($))/R;return{x:re*U+.5,y:-ae*U+.5}},unproject(Z,$){const re=-($-.5)/U,ae=an(et((Z-.5)/U)/R,-180,180),ue=Math.asin(an(re*R,-1,1)),Ce=an(et(ue),-85.051129,od);return new qo(ae,Ce)}}}(y.parallels[0]);if("lambertConformalConic"===y.name){const{project:A,unproject:R}=Hv.mercator;E={wrap:!0,project:A,unproject:R}}return jn({},p,y,E)}return jn({},p,y)}(a,c):a},C.getRTLTextPluginStatus=W,C.getReferrer=se,C.getTilePoint=function(c,{x:a,y:p},y=0){return new it(((a-y)*c.scale-c.x)*Bi,(p*c.scale-c.y)*Bi)},C.getTileVec3=function(c,a,p=0){return qf(((a.x-p)*c.scale-c.x)*Bi,(a.y*c.scale-c.y)*Bi,Im(a.z,a.y))},C.getVideo=function(c,a){const p=Ke.document.createElement("video");p.muted=!0,p.onloadstart=function(){a(null,p)};for(let y=0;y<c.length;y++){const E=Ke.document.createElement("source");pe(c[y])||(p.crossOrigin="Anonymous"),E.src=c[y],p.appendChild(E)}return{cancel:()=>{}}},C.identity=Pd,C.identity$1=Hf,C.invert=function(c,a){var p=a[0],y=a[1],E=a[2],A=a[3],R=a[4],U=a[5],Z=a[6],$=a[7],re=a[8],ae=a[9],ue=a[10],Ce=a[11],ke=a[12],Ve=a[13],We=a[14],rt=a[15],ht=p*U-y*R,vt=p*Z-E*R,Tt=p*$-A*R,Ct=y*Z-E*U,kt=y*$-A*U,ln=E*$-A*Z,Yt=re*Ve-ae*ke,Kn=re*We-ue*ke,In=re*rt-Ce*ke,hn=ae*We-ue*Ve,Tn=ae*rt-Ce*Ve,Ln=ue*rt-Ce*We,yn=ht*Ln-vt*Tn+Tt*hn+Ct*In-kt*Kn+ln*Yt;return yn?(c[0]=(U*Ln-Z*Tn+$*hn)*(yn=1/yn),c[1]=(E*Tn-y*Ln-A*hn)*yn,c[2]=(Ve*ln-We*kt+rt*Ct)*yn,c[3]=(ue*kt-ae*ln-Ce*Ct)*yn,c[4]=(Z*In-R*Ln-$*Kn)*yn,c[5]=(p*Ln-E*In+A*Kn)*yn,c[6]=(We*Tt-ke*ln-rt*vt)*yn,c[7]=(re*ln-ue*Tt+Ce*vt)*yn,c[8]=(R*Tn-U*In+$*Yt)*yn,c[9]=(y*In-p*Tn-A*Yt)*yn,c[10]=(ke*kt-Ve*Tt+rt*ht)*yn,c[11]=(ae*Tt-re*kt-Ce*ht)*yn,c[12]=(U*Kn-R*hn-Z*Yt)*yn,c[13]=(p*hn-y*Kn+E*Yt)*yn,c[14]=(Ve*vt-ke*Ct-We*ht)*yn,c[15]=(re*Ct-ae*vt+ue*ht)*yn,c):null},C.isMapAuthenticated=function(c){return Nu.has(c)},C.isMapboxURL=la,C.latFromMercatorY=Dd,C.len=Fa,C.length=Cg,C.length$1=function(c){return Math.hypot(c[0],c[1],c[2],c[3])},C.loadVectorTile=qv,C.makeRequest=te,C.mercatorXfromLng=dy,C.mercatorYfromLat=Du,C.mercatorZfromAltitude=wg,C.mul=function(c,a,p){return c[0]=a[0]*p[0],c[1]=a[1]*p[1],c[2]=a[2]*p[2],c[3]=a[3]*p[3],c},C.mul$1=G_,C.mul$2=yy,C.multiply=Ev,C.multiply$1=Sv,C.nextPowerOfTwo=Es,C.normalize=Rm,C.normalize$1=function(c,a){var p=a[0],y=a[1],E=a[2],A=a[3],R=p*p+y*y+E*E+A*A;return R>0&&(R=1/Math.sqrt(R)),c[0]=p*R,c[1]=y*R,c[2]=E*R,c[3]=A*R,c},C.number=ii,C.ortho=function(c,a,p,y,E,A,R){var U=1/(a-p),Z=1/(y-E),$=1/(A-R);return c[0]=-2*U,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*Z,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*$,c[11]=0,c[12]=(a+p)*U,c[13]=(E+y)*Z,c[14]=(R+A)*$,c[15]=1,c},C.pbf=Up,C.perspective=function(c,a,p,y,E){var A,R=1/Math.tan(a/2);return c[0]=R/p,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=R,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,null!=E&&E!==1/0?(c[10]=(E+y)*(A=1/(y-E)),c[14]=2*E*y*A):(c[10]=-1,c[14]=-2*y),c},C.pick=function(c,a){const p={};for(let y=0;y<a.length;y++){const E=a[y];E in c&&(p[E]=c[E])}return p},C.plugin=ee,C.pointGeometry=it,C.polygonIntersectsBox=wv,C.polygonIntersectsPolygon=Dm,C.polygonizeBounds=function(c,a,p=0,y=!0){const E=new it(p,p),A=c.sub(E),R=a.add(E),U=[A,new it(R.x,A.y),R,new it(A.x,R.y)];return y&&U.push(A),U},C.posAttributes=qd,C.postMapLoadEvent=Mc,C.postTurnstileEvent=Jc,C.potpack=st,C.prevPowerOfTwo=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))},C.radToDeg=et,C.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],C.registerForPluginStateChange=function(c){return c({pluginStatus:x,pluginURL:M}),G.on("pluginStateChange",c),c},C.removeAuthState=function(c){Nu.delete(c)},C.renderColorRamp=Mv,C.rotateX=function(c,a,p){var y=Math.sin(p),E=Math.cos(p),A=a[4],R=a[5],U=a[6],Z=a[7],$=a[8],re=a[9],ae=a[10],ue=a[11];return a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]),c[4]=A*E+$*y,c[5]=R*E+re*y,c[6]=U*E+ae*y,c[7]=Z*E+ue*y,c[8]=$*E-A*y,c[9]=re*E-R*y,c[10]=ae*E-U*y,c[11]=ue*E-Z*y,c},C.rotateX$1=Fm,C.rotateY=function(c,a,p){var y=Math.sin(p),E=Math.cos(p),A=a[0],R=a[1],U=a[2],Z=a[3],$=a[8],re=a[9],ae=a[10],ue=a[11];return a!==c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]),c[0]=A*E-$*y,c[1]=R*E-re*y,c[2]=U*E-ae*y,c[3]=Z*E-ue*y,c[8]=A*y+$*E,c[9]=R*y+re*E,c[10]=U*y+ae*E,c[11]=Z*y+ue*E,c},C.rotateZ=function(c,a,p){var y=Math.sin(p),E=Math.cos(p),A=a[0],R=a[1],U=a[2],Z=a[3],$=a[4],re=a[5],ae=a[6],ue=a[7];return a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]),c[0]=A*E+$*y,c[1]=R*E+re*y,c[2]=U*E+ae*y,c[3]=Z*E+ue*y,c[4]=$*E-A*y,c[5]=re*E-R*y,c[6]=ae*E-U*y,c[7]=ue*E-Z*y,c},C.rotateZ$1=function(c,a,p){p*=.5;var y=a[0],E=a[1],A=a[2],R=a[3],U=Math.sin(p),Z=Math.cos(p);return c[0]=y*Z+E*U,c[1]=E*Z-y*U,c[2]=A*Z+R*U,c[3]=R*Z-A*U,c},C.scale=function(c,a,p){return c[0]=a[0]*p,c[1]=a[1]*p,c[2]=a[2]*p,c},C.scale$1=function(c,a,p){var y=p[0],E=p[1],A=p[2];return c[0]=a[0]*y,c[1]=a[1]*y,c[2]=a[2]*y,c[3]=a[3]*y,c[4]=a[4]*E,c[5]=a[5]*E,c[6]=a[6]*E,c[7]=a[7]*E,c[8]=a[8]*A,c[9]=a[9]*A,c[10]=a[10]*A,c[11]=a[11]*A,c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c},C.scale$2=function(c,a,p){return c[0]=a[0]*p,c[1]=a[1]*p,c[2]=a[2]*p,c[3]=a[3]*p,c},C.scaleAndAdd=Zf,C.setCacheLimits=function(c,a){Jl=c,Ll=a},C.setRTLTextPlugin=function(c,a,p=!1){if(x===j||x===f||x===l)throw new Error("setRTLTextPlugin cannot be called multiple times.");M=zs.resolveURL(c),x=j,d=a,B(),p||Y()},C.smoothstep=function(c,a,p){return(p=an((p-c)/(a-c),0,1))*p*(3-2*p)},C.spec=Je,C.storeAuthState=function(c,a){a?Nu.add(c):Nu.delete(c)},C.sub=Tv,C.subtract=q_,C.symbolSize=Lg,C.tileTransform=om,C.transformMat3=function(c,a,p){var y=a[0],E=a[1],A=a[2];return c[0]=y*p[0]+E*p[3]+A*p[6],c[1]=y*p[1]+E*p[4]+A*p[7],c[2]=y*p[2]+E*p[5]+A*p[8],c},C.transformMat4=Lm,C.transformMat4$1=function(c,a,p){var y=a[0],E=a[1],A=a[2],R=p[3]*y+p[7]*E+p[11]*A+p[15];return c[0]=(p[0]*y+p[4]*E+p[8]*A+p[12])/(R=R||1),c[1]=(p[1]*y+p[5]*E+p[9]*A+p[13])/R,c[2]=(p[2]*y+p[6]*E+p[10]*A+p[14])/R,c},C.transformQuat=Om,C.translate=function(c,a,p){var y,E,A,R,U,Z,$,re,ae,ue,Ce,ke,Ve=p[0],We=p[1],rt=p[2];return a===c?(c[12]=a[0]*Ve+a[4]*We+a[8]*rt+a[12],c[13]=a[1]*Ve+a[5]*We+a[9]*rt+a[13],c[14]=a[2]*Ve+a[6]*We+a[10]*rt+a[14],c[15]=a[3]*Ve+a[7]*We+a[11]*rt+a[15]):(E=a[1],A=a[2],R=a[3],U=a[4],Z=a[5],$=a[6],re=a[7],ae=a[8],ue=a[9],Ce=a[10],ke=a[11],c[0]=y=a[0],c[1]=E,c[2]=A,c[3]=R,c[4]=U,c[5]=Z,c[6]=$,c[7]=re,c[8]=ae,c[9]=ue,c[10]=Ce,c[11]=ke,c[12]=y*Ve+U*We+ae*rt+a[12],c[13]=E*Ve+Z*We+ue*rt+a[13],c[14]=A*Ve+$*We+Ce*rt+a[14],c[15]=R*Ve+re*We+ke*rt+a[15]),c},C.triggerPluginCompletionEvent=D,C.uniqueId=sr,C.validateCustomStyleLayer=function(c){const a=[],p=c.id;return void 0===p&&a.push({message:`layers.${p}: missing required property "id"`}),void 0===c.render&&a.push({message:`layers.${p}: missing required method "render"`}),c.renderingMode&&"2d"!==c.renderingMode&&"3d"!==c.renderingMode&&a.push({message:`layers.${p}: property "renderingMode" must be either "2d" or "3d"`}),a},C.validateFog=id,C.validateLight=Yh,C.validateStyle=uc,C.values=dr,C.vectorTile=jp,C.version="2.6.1",C.warnOnce=Ui,C.window=Ke,C.wrap=Rn}),Jt(0,function(C){function ut(se){const te=typeof se;if("number"===te||"boolean"===te||"string"===te||null==se)return JSON.stringify(se);if(Array.isArray(se)){let ve="[";for(const pe of se)ve+=`${ut(pe)},`;return`${ve}]`}const oe=Object.keys(se).sort();let me="{";for(let ve=0;ve<oe.length;ve++)me+=`${JSON.stringify(oe[ve])}:${ut(se[oe[ve]])},`;return`${me}}`}function tn(se){let te="";for(const oe of C.refProperties)te+=`/${ut(se[oe])}`;return te}class Et{constructor(te){this.keyCache={},te&&this.replace(te)}replace(te){this._layerConfigs={},this._layers={},this.update(te,[])}update(te,oe){for(const ve of te)this._layerConfigs[ve.id]=ve,(this._layers[ve.id]=C.createStyleLayer(ve)).compileFilter(),this.keyCache[ve.id]&&delete this.keyCache[ve.id];for(const ve of oe)delete this.keyCache[ve],delete this._layerConfigs[ve],delete this._layers[ve];this.familiesBySource={};const me=function(ve,pe){const Se={};for(let Ze=0;Ze<ve.length;Ze++){const Be=pe&&pe[ve[Ze].id]||tn(ve[Ze]);pe&&(pe[ve[Ze].id]=Be);let lt=Se[Be];lt||(lt=Se[Be]=[]),lt.push(ve[Ze])}const He=[];for(const Ze in Se)He.push(Se[Ze]);return He}(C.values(this._layerConfigs),this.keyCache);for(const ve of me){const pe=ve.map(Rt=>this._layers[Rt.id]),Se=pe[0];if("none"===Se.visibility)continue;const He=Se.source||"";let Ze=this.familiesBySource[He];Ze||(Ze=this.familiesBySource[He]={});const Be=Se.sourceLayer||"_geojsonTileLayer";let lt=Ze[Be];lt||(lt=Ze[Be]=[]),lt.push(pe)}}}const{ImageBitmap:it}=C.window;class Ge{loadTile(te,oe){const{uid:me,encoding:ve,rawImageData:pe,padding:Se,buildQuadTree:He}=te,Ze=it&&pe instanceof it?this.getImageData(pe,Se):pe;oe(null,new C.DEMData(me,Ze,ve,Se<1,He))}getImageData(te,oe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);const me=this.offscreenCanvasContext.getImageData(-oe,-oe,te.width+2*oe,te.height+2*oe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new C.RGBAImage({width:me.width,height:me.height},me.data)}}var Ke=function se(te,oe){var me,ve=te&&te.type;if("FeatureCollection"===ve)for(me=0;me<te.features.length;me++)se(te.features[me],oe);else if("GeometryCollection"===ve)for(me=0;me<te.geometries.length;me++)se(te.geometries[me],oe);else if("Feature"===ve)se(te.geometry,oe);else if("Polygon"===ve)Wt(te.coordinates,oe);else if("MultiPolygon"===ve)for(me=0;me<te.coordinates.length;me++)Wt(te.coordinates[me],oe);return te};function Wt(se,te){if(0!==se.length){on(se[0],te);for(var oe=1;oe<se.length;oe++)on(se[oe],!te)}}function on(se,te){for(var oe=0,me=0,ve=0,pe=se.length,Se=pe-1;ve<pe;Se=ve++){var He=(se[ve][0]-se[Se][0])*(se[Se][1]+se[ve][1]),Ze=oe+He;me+=Math.abs(oe)>=Math.abs(He)?oe-Ze+He:He-Ze+oe,oe=Ze}oe+me>=0!=!!te&&se.reverse()}const Cn=C.vectorTile.VectorTileFeature.prototype.toGeoJSON;class fn{constructor(te){this._feature=te,this.extent=C.EXTENT,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(1===this._feature.type){const te=[];for(const oe of this._feature.geometry)te.push([new C.pointGeometry(oe[0],oe[1])]);return te}{const te=[];for(const oe of this._feature.geometry){const me=[];for(const ve of oe)me.push(new C.pointGeometry(ve[0],ve[1]));te.push(me)}return te}}toGeoJSON(te,oe,me){return Cn.call(this,te,oe,me)}}class et{constructor(te){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=C.EXTENT,this.length=te.length,this._features=te}feature(te){return new fn(this._features[te])}}var _t=C.vectorTile.VectorTileFeature,Dt=bn;function bn(se,te){this.options=te||{},this.features=se,this.length=se.length}function Pn(se,te){this.id="number"==typeof se.id?se.id:void 0,this.type=se.type,this.rawGeometry=1===se.type?[se.geometry]:se.geometry,this.properties=se.tags,this.extent=te||4096}bn.prototype.feature=function(se){return new Pn(this.features[se],this.options.extent)},Pn.prototype.loadGeometry=function(){var se=this.rawGeometry;this.geometry=[];for(var te=0;te<se.length;te++){for(var oe=se[te],me=[],ve=0;ve<oe.length;ve++)me.push(new C.pointGeometry(oe[ve][0],oe[ve][1]));this.geometry.push(me)}return this.geometry},Pn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var se=this.geometry,te=1/0,oe=-1/0,me=1/0,ve=-1/0,pe=0;pe<se.length;pe++)for(var Se=se[pe],He=0;He<Se.length;He++){var Ze=Se[He];te=Math.min(te,Ze.x),oe=Math.max(oe,Ze.x),me=Math.min(me,Ze.y),ve=Math.max(ve,Ze.y)}return[te,me,oe,ve]},Pn.prototype.toGeoJSON=_t.prototype.toGeoJSON;var an=nr,Rn=Dt;function nr(se){var te=new C.pbf;return function(oe,me){for(var ve in oe.layers)me.writeMessage(3,dr,oe.layers[ve])}(se,te),te.finish()}function dr(se,te){var oe;te.writeVarintField(15,se.version||1),te.writeStringField(1,se.name||""),te.writeVarintField(5,se.extent||4096);var me={keys:[],values:[],keycache:{},valuecache:{}};for(oe=0;oe<se.length;oe++)me.feature=se.feature(oe),te.writeMessage(2,jn,me);var ve=me.keys;for(oe=0;oe<ve.length;oe++)te.writeStringField(3,ve[oe]);var pe=me.values;for(oe=0;oe<pe.length;oe++)te.writeMessage(4,je,pe[oe])}function jn(se,te){var oe=se.feature;void 0!==oe.id&&te.writeVarintField(1,oe.id),te.writeMessage(2,pn,se),te.writeVarintField(3,oe.type),te.writeMessage(4,Es,oe)}function pn(se,te){var oe=se.feature,me=se.keys,ve=se.values,pe=se.keycache,Se=se.valuecache;for(var He in oe.properties){var Ze=oe.properties[He],Be=pe[He];if(null!==Ze){void 0===Be&&(me.push(He),pe[He]=Be=me.length-1),te.writeVarint(Be);var lt=typeof Ze;"string"!==lt&&"boolean"!==lt&&"number"!==lt&&(Ze=JSON.stringify(Ze));var Rt=lt+":"+Ze,xt=Se[Rt];void 0===xt&&(ve.push(Ze),Se[Rt]=xt=ve.length-1),te.writeVarint(xt)}}}function sr(se,te){return(te<<3)+(7&se)}function qr(se){return se<<1^se>>31}function Es(se,te){for(var oe=se.loadGeometry(),me=se.type,ve=0,pe=0,Se=oe.length,He=0;He<Se;He++){var Ze=oe[He],Be=1;1===me&&(Be=Ze.length),te.writeVarint(sr(1,Be));for(var lt=3===me?Ze.length-1:Ze.length,Rt=0;Rt<lt;Rt++){1===Rt&&1!==me&&te.writeVarint(sr(2,lt-1));var xt=Ze[Rt].x-ve,Xt=Ze[Rt].y-pe;te.writeVarint(qr(xt)),te.writeVarint(qr(Xt)),ve+=xt,pe+=Xt}3===me&&te.writeVarint(sr(7,1))}}function je(se,te){var oe=typeof se;"string"===oe?te.writeStringField(1,se):"boolean"===oe?te.writeBooleanField(7,se):"number"===oe&&(se%1!=0?te.writeDoubleField(3,se):se<0?te.writeSVarintField(6,se):te.writeVarintField(5,se))}function ct(se,te,oe,me,ve,pe){if(ve-me<=oe)return;const Se=me+ve>>1;Vt(se,te,Se,me,ve,pe%2),ct(se,te,oe,me,Se-1,pe+1),ct(se,te,oe,Se+1,ve,pe+1)}function Vt(se,te,oe,me,ve,pe){for(;ve>me;){if(ve-me>600){const Be=ve-me+1,lt=oe-me+1,Rt=Math.log(Be),xt=.5*Math.exp(2*Rt/3),Xt=.5*Math.sqrt(Rt*xt*(Be-xt)/Be)*(lt-Be/2<0?-1:1);Vt(se,te,oe,Math.max(me,Math.floor(oe-lt*xt/Be+Xt)),Math.min(ve,Math.floor(oe+(Be-lt)*xt/Be+Xt)),pe)}const Se=te[2*oe+pe];let He=me,Ze=ve;for(Pr(se,te,me,oe),te[2*ve+pe]>Se&&Pr(se,te,me,ve);He<Ze;){for(Pr(se,te,He,Ze),He++,Ze--;te[2*He+pe]<Se;)He++;for(;te[2*Ze+pe]>Se;)Ze--}te[2*me+pe]===Se?Pr(se,te,me,Ze):(Ze++,Pr(se,te,Ze,ve)),Ze<=oe&&(me=Ze+1),oe<=Ze&&(ve=Ze-1)}}function Pr(se,te,oe,me){fr(se,oe,me),fr(te,2*oe,2*me),fr(te,2*oe+1,2*me+1)}function fr(se,te,oe){const me=se[te];se[te]=se[oe],se[oe]=me}function vr(se,te,oe,me){const ve=se-oe,pe=te-me;return ve*ve+pe*pe}an.fromVectorTileJs=nr,an.fromGeojsonVt=function(se,te){te=te||{};var oe={};for(var me in se)oe[me]=new Dt(se[me].features,te),oe[me].name=me,oe[me].version=te.version,oe[me].extent=te.extent;return nr({layers:oe})},an.GeoJSONWrapper=Rn;const Er=se=>se[0],Ui=se=>se[1];class Wo{constructor(te,oe=Er,me=Ui,ve=64,pe=Float64Array){this.nodeSize=ve,this.points=te;const Se=te.length<65536?Uint16Array:Uint32Array,He=this.ids=new Se(te.length),Ze=this.coords=new pe(2*te.length);for(let Be=0;Be<te.length;Be++)He[Be]=Be,Ze[2*Be]=oe(te[Be]),Ze[2*Be+1]=me(te[Be]);ct(He,Ze,ve,0,He.length-1,0)}range(te,oe,me,ve){return function(pe,Se,He,Ze,Be,lt,Rt){const xt=[0,pe.length-1,0],Xt=[];let mt,Je;for(;xt.length;){const ot=xt.pop(),On=xt.pop(),Bn=xt.pop();if(On-Bn<=Rt){for(let Ft=Bn;Ft<=On;Ft++)mt=Se[2*Ft],Je=Se[2*Ft+1],mt>=He&&mt<=Be&&Je>=Ze&&Je<=lt&&Xt.push(pe[Ft]);continue}const sn=Math.floor((Bn+On)/2);mt=Se[2*sn],Je=Se[2*sn+1],mt>=He&&mt<=Be&&Je>=Ze&&Je<=lt&&Xt.push(pe[sn]);const br=(ot+1)%2;(0===ot?He<=mt:Ze<=Je)&&(xt.push(Bn),xt.push(sn-1),xt.push(br)),(0===ot?Be>=mt:lt>=Je)&&(xt.push(sn+1),xt.push(On),xt.push(br))}return Xt}(this.ids,this.coords,te,oe,me,ve,this.nodeSize)}within(te,oe,me){return function(ve,pe,Se,He,Ze,Be){const lt=[0,ve.length-1,0],Rt=[],xt=Ze*Ze;for(;lt.length;){const Xt=lt.pop(),mt=lt.pop(),Je=lt.pop();if(mt-Je<=Be){for(let br=Je;br<=mt;br++)vr(pe[2*br],pe[2*br+1],Se,He)<=xt&&Rt.push(ve[br]);continue}const ot=Math.floor((Je+mt)/2),On=pe[2*ot],Bn=pe[2*ot+1];vr(On,Bn,Se,He)<=xt&&Rt.push(ve[ot]);const sn=(Xt+1)%2;(0===Xt?Se-Ze<=On:He-Ze<=Bn)&&(lt.push(Je),lt.push(ot-1),lt.push(sn)),(0===Xt?Se+Ze>=On:He+Ze>=Bn)&&(lt.push(ot+1),lt.push(mt),lt.push(sn))}return Rt}(this.ids,this.coords,te,oe,me,this.nodeSize)}}const Xi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:se=>se},Vi=Math.fround||(Zr=new Float32Array(1),se=>(Zr[0]=+se,Zr[0]));var Zr;class gl{constructor(te){this.options=Ar(Object.create(Xi),te),this.trees=new Array(this.options.maxZoom+1)}load(te){const{log:oe,minZoom:me,maxZoom:ve,nodeSize:pe}=this.options;oe&&console.time("total time");const Se=`prepare ${te.length} points`;oe&&console.time(Se),this.points=te;let He=[];for(let Ze=0;Ze<te.length;Ze++)te[Ze].geometry&&He.push(yl(te[Ze],Ze));this.trees[ve+1]=new Wo(He,Tc,ol,pe,Float32Array),oe&&console.timeEnd(Se);for(let Ze=ve;Ze>=me;Ze--){const Be=+Date.now();He=this._cluster(He,Ze),this.trees[Ze]=new Wo(He,Tc,ol,pe,Float32Array),oe&&console.log("z%d: %d clusters in %dms",Ze,He.length,+Date.now()-Be)}return oe&&console.timeEnd("total time"),this}getClusters(te,oe){let me=((te[0]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,te[1]));let pe=180===te[2]?180:((te[2]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)me=-180,pe=180;else if(me>pe){const lt=this.getClusters([me,ve,180,Se],oe),Rt=this.getClusters([-180,ve,pe,Se],oe);return lt.concat(Rt)}const He=this.trees[this._limitZoom(oe)],Ze=He.range(di(me),zs(Se),di(pe),zs(ve)),Be=[];for(const lt of Ze){const Rt=He.points[lt];Be.push(Rt.numPoints?Sc(Rt):this.points[Rt.index])}return Be}getChildren(te){const oe=this._getOriginId(te),me=this._getOriginZoom(te),ve="No cluster with the specified id.",pe=this.trees[me];if(!pe)throw new Error(ve);const Se=pe.points[oe];if(!Se)throw new Error(ve);const He=this.options.radius/(this.options.extent*Math.pow(2,me-1)),Ze=pe.within(Se.x,Se.y,He),Be=[];for(const lt of Ze){const Rt=pe.points[lt];Rt.parentId===te&&Be.push(Rt.numPoints?Sc(Rt):this.points[Rt.index])}if(0===Be.length)throw new Error(ve);return Be}getLeaves(te,oe,me){const ve=[];return this._appendLeaves(ve,te,oe=oe||10,me=me||0,0),ve}getTile(te,oe,me){const ve=this.trees[this._limitZoom(te)],pe=Math.pow(2,te),{extent:Se,radius:He}=this.options,Ze=He/Se,Be=(me-Ze)/pe,lt=(me+1+Ze)/pe,Rt={features:[]};return this._addTileFeatures(ve.range((oe-Ze)/pe,Be,(oe+1+Ze)/pe,lt),ve.points,oe,me,pe,Rt),0===oe&&this._addTileFeatures(ve.range(1-Ze/pe,Be,1,lt),ve.points,pe,me,pe,Rt),oe===pe-1&&this._addTileFeatures(ve.range(0,Be,Ze/pe,lt),ve.points,-1,me,pe,Rt),Rt.features.length?Rt:null}getClusterExpansionZoom(te){let oe=this._getOriginZoom(te)-1;for(;oe<=this.options.maxZoom;){const me=this.getChildren(te);if(oe++,1!==me.length)break;te=me[0].properties.cluster_id}return oe}_appendLeaves(te,oe,me,ve,pe){const Se=this.getChildren(oe);for(const He of Se){const Ze=He.properties;if(Ze&&Ze.cluster?pe+Ze.point_count<=ve?pe+=Ze.point_count:pe=this._appendLeaves(te,Ze.cluster_id,me,ve,pe):pe<ve?pe++:te.push(He),te.length===me)break}return pe}_addTileFeatures(te,oe,me,ve,pe,Se){for(const He of te){const Ze=oe[He],Be=Ze.numPoints;let lt,Rt,xt;if(Be)lt=Yl(Ze),Rt=Ze.x,xt=Ze.y;else{const Je=this.points[Ze.index];lt=Je.properties,Rt=di(Je.geometry.coordinates[0]),xt=zs(Je.geometry.coordinates[1])}const Xt={type:1,geometry:[[Math.round(this.options.extent*(Rt*pe-me)),Math.round(this.options.extent*(xt*pe-ve))]],tags:lt};let mt;Be?mt=Ze.id:this.options.generateId?mt=Ze.index:this.points[Ze.index].id&&(mt=this.points[Ze.index].id),void 0!==mt&&(Xt.id=mt),Se.features.push(Xt)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(+te,this.options.maxZoom+1))}_cluster(te,oe){const me=[],{radius:ve,extent:pe,reduce:Se,minPoints:He}=this.options,Ze=ve/(pe*Math.pow(2,oe));for(let Be=0;Be<te.length;Be++){const lt=te[Be];if(lt.zoom<=oe)continue;lt.zoom=oe;const Rt=this.trees[oe+1],xt=Rt.within(lt.x,lt.y,Ze),Xt=lt.numPoints||1;let mt=Xt;for(const Je of xt){const ot=Rt.points[Je];ot.zoom>oe&&(mt+=ot.numPoints||1)}if(mt>Xt&&mt>=He){let Je=lt.x*Xt,ot=lt.y*Xt,On=Se&&Xt>1?this._map(lt,!0):null;const Bn=(Be<<5)+(oe+1)+this.points.length;for(const sn of xt){const br=Rt.points[sn];if(br.zoom<=oe)continue;br.zoom=oe;const Ft=br.numPoints||1;Je+=br.x*Ft,ot+=br.y*Ft,br.parentId=Bn,Se&&(On||(On=this._map(lt,!0)),Se(On,this._map(br)))}lt.parentId=Bn,me.push(Ir(Je/mt,ot/mt,Bn,mt,On))}else if(me.push(lt),mt>1)for(const Je of xt){const ot=Rt.points[Je];ot.zoom<=oe||(ot.zoom=oe,me.push(ot))}}return me}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,oe){if(te.numPoints)return oe?Ar({},te.properties):te.properties;const me=this.points[te.index].properties,ve=this.options.map(me);return oe&&ve===me?Ar({},ve):ve}}function Ir(se,te,oe,me,ve){return{x:Vi(se),y:Vi(te),zoom:1/0,id:oe,parentId:-1,numPoints:me,properties:ve}}function yl(se,te){const[oe,me]=se.geometry.coordinates;return{x:Vi(di(oe)),y:Vi(zs(me)),zoom:1/0,index:te,parentId:-1}}function Sc(se){return{type:"Feature",id:se.id,properties:Yl(se),geometry:{type:"Point",coordinates:[(te=se.x,360*(te-.5)),ss(se.y)]}};var te}function Yl(se){const te=se.numPoints,oe=te>=1e4?`${Math.round(te/1e3)}k`:te>=1e3?Math.round(te/100)/10+"k":te;return Ar(Ar({},se.properties),{cluster:!0,cluster_id:se.id,point_count:te,point_count_abbreviated:oe})}function di(se){return se/360+.5}function zs(se){const te=Math.sin(se*Math.PI/180),oe=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return oe<0?0:oe>1?1:oe}function ss(se){const te=(180-360*se)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function Ar(se,te){for(const oe in te)se[oe]=te[oe];return se}function Tc(se){return se.x}function ol(se){return se.y}function vl(se,te,oe,me){for(var ve,pe=me,Se=oe-te>>1,He=oe-te,Ze=se[te],Be=se[te+1],lt=se[oe],Rt=se[oe+1],xt=te+3;xt<oe;xt+=3){var Xt=Rl(se[xt],se[xt+1],Ze,Be,lt,Rt);if(Xt>pe)ve=xt,pe=Xt;else if(Xt===pe){var mt=Math.abs(xt-Se);mt<He&&(ve=xt,He=mt)}}pe>me&&(ve-te>3&&vl(se,te,ve,me),se[ve+2]=pe,oe-ve>3&&vl(se,ve,oe,me))}function Rl(se,te,oe,me,ve,pe){var Se=ve-oe,He=pe-me;if(0!==Se||0!==He){var Ze=((se-oe)*Se+(te-me)*He)/(Se*Se+He*He);Ze>1?(oe=ve,me=pe):Ze>0&&(oe+=Se*Ze,me+=He*Ze)}return(Se=se-oe)*Se+(He=te-me)*He}function Ol(se,te,oe,me){var ve={id:void 0===se?null:se,type:te,geometry:oe,tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(pe){var Se=pe.geometry,He=pe.type;if("Point"===He||"MultiPoint"===He||"LineString"===He)gu(pe,Se);else if("Polygon"===He||"MultiLineString"===He)for(var Ze=0;Ze<Se.length;Ze++)gu(pe,Se[Ze]);else if("MultiPolygon"===He)for(Ze=0;Ze<Se.length;Ze++)for(var Be=0;Be<Se[Ze].length;Be++)gu(pe,Se[Ze][Be])}(ve),ve}function gu(se,te){for(var oe=0;oe<te.length;oe+=3)se.minX=Math.min(se.minX,te[oe]),se.minY=Math.min(se.minY,te[oe+1]),se.maxX=Math.max(se.maxX,te[oe]),se.maxY=Math.max(se.maxY,te[oe+1])}function _l(se,te,oe,me){if(te.geometry){var ve=te.geometry.coordinates,pe=te.geometry.type,Se=Math.pow(oe.tolerance/((1<<oe.maxZoom)*oe.extent),2),He=[],Ze=te.id;if(oe.promoteId?Ze=te.properties[oe.promoteId]:oe.generateId&&(Ze=me||0),"Point"===pe)Na(ve,He);else if("MultiPoint"===pe)for(var Be=0;Be<ve.length;Be++)Na(ve[Be],He);else if("LineString"===pe)la(ve,He,Se,!1);else if("MultiLineString"===pe){if(oe.lineMetrics){for(Be=0;Be<ve.length;Be++)la(ve[Be],He=[],Se,!1),se.push(Ol(Ze,"LineString",He,te.properties));return}al(ve,He,Se,!1)}else if("Polygon"===pe)al(ve,He,Se,!0);else{if("MultiPolygon"!==pe){if("GeometryCollection"===pe){for(Be=0;Be<te.geometry.geometries.length;Be++)_l(se,{id:Ze,geometry:te.geometry.geometries[Be],properties:te.properties},oe,me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Be=0;Be<ve.length;Be++){var lt=[];al(ve[Be],lt,Se,!0),He.push(lt)}}se.push(Ol(Ze,pe,He,te.properties))}}function Na(se,te){te.push(Uh(se[0])),te.push(Ys(se[1])),te.push(0)}function la(se,te,oe,me){for(var ve,pe,Se=0,He=0;He<se.length;He++){var Ze=Uh(se[He][0]),Be=Ys(se[He][1]);te.push(Ze),te.push(Be),te.push(0),He>0&&(Se+=me?(ve*Be-Ze*pe)/2:Math.sqrt(Math.pow(Ze-ve,2)+Math.pow(Be-pe,2))),ve=Ze,pe=Be}var lt=te.length-3;te[2]=1,vl(te,0,lt,oe),te[lt+2]=1,te.size=Math.abs(Se),te.start=0,te.end=te.size}function al(se,te,oe,me){for(var ve=0;ve<se.length;ve++){var pe=[];la(se[ve],pe,oe,me),te.push(pe)}}function Uh(se){return se/360+.5}function Ys(se){var te=Math.sin(se*Math.PI/180),oe=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return oe<0?0:oe>1?1:oe}function Ns(se,te,oe,me,ve,pe,Se,He){if(me/=te,pe>=(oe/=te)&&Se<me)return se;if(Se<oe||pe>=me)return null;for(var Ze=[],Be=0;Be<se.length;Be++){var lt=se[Be],Rt=lt.geometry,xt=lt.type,Xt=0===ve?lt.minX:lt.minY,mt=0===ve?lt.maxX:lt.maxY;if(Xt>=oe&&mt<me)Ze.push(lt);else if(!(mt<oe||Xt>=me)){var Je=[];if("Point"===xt||"MultiPoint"===xt)Kc(Rt,Je,oe,me,ve);else if("LineString"===xt)Ic(Rt,Je,oe,me,ve,!1,He.lineMetrics);else if("MultiLineString"===xt)Jc(Rt,Je,oe,me,ve,!1);else if("Polygon"===xt)Jc(Rt,Je,oe,me,ve,!0);else if("MultiPolygon"===xt)for(var ot=0;ot<Rt.length;ot++){var On=[];Jc(Rt[ot],On,oe,me,ve,!0),On.length&&Je.push(On)}if(Je.length){if(He.lineMetrics&&"LineString"===xt){for(ot=0;ot<Je.length;ot++)Ze.push(Ol(lt.id,xt,Je[ot],lt.tags));continue}"LineString"!==xt&&"MultiLineString"!==xt||(1===Je.length?(xt="LineString",Je=Je[0]):xt="MultiLineString"),"Point"!==xt&&"MultiPoint"!==xt||(xt=3===Je.length?"Point":"MultiPoint"),Ze.push(Ol(lt.id,xt,Je,lt.tags))}}}return Ze.length?Ze:null}function Kc(se,te,oe,me,ve){for(var pe=0;pe<se.length;pe+=3){var Se=se[pe+ve];Se>=oe&&Se<=me&&(te.push(se[pe]),te.push(se[pe+1]),te.push(se[pe+2]))}}function Ic(se,te,oe,me,ve,pe,Se){for(var He,Ze,Be=Vh(se),lt=0===ve?Mc:Ss,Rt=se.start,xt=0;xt<se.length-3;xt+=3){var Xt=se[xt],mt=se[xt+1],Je=se[xt+2],ot=se[xt+3],On=se[xt+4],Bn=0===ve?Xt:mt,sn=0===ve?ot:On,br=!1;Se&&(He=Math.sqrt(Math.pow(Xt-ot,2)+Math.pow(mt-On,2))),Bn<oe?sn>oe&&(Ze=lt(Be,Xt,mt,ot,On,oe),Se&&(Be.start=Rt+He*Ze)):Bn>me?sn<me&&(Ze=lt(Be,Xt,mt,ot,On,me),Se&&(Be.start=Rt+He*Ze)):Qu(Be,Xt,mt,Je),sn<oe&&Bn>=oe&&(Ze=lt(Be,Xt,mt,ot,On,oe),br=!0),sn>me&&Bn<=me&&(Ze=lt(Be,Xt,mt,ot,On,me),br=!0),!pe&&br&&(Se&&(Be.end=Rt+He*Ze),te.push(Be),Be=Vh(se)),Se&&(Rt+=He)}var Ft=se.length-3;Xt=se[Ft],mt=se[Ft+1],Je=se[Ft+2],(Bn=0===ve?Xt:mt)>=oe&&Bn<=me&&Qu(Be,Xt,mt,Je),Ft=Be.length-3,pe&&Ft>=3&&(Be[Ft]!==Be[0]||Be[Ft+1]!==Be[1])&&Qu(Be,Be[0],Be[1],Be[2]),Be.length&&te.push(Be)}function Vh(se){var te=[];return te.size=se.size,te.start=se.start,te.end=se.end,te}function Jc(se,te,oe,me,ve,pe){for(var Se=0;Se<se.length;Se++)Ic(se[Se],te,oe,me,ve,pe,!1)}function Qu(se,te,oe,me){se.push(te),se.push(oe),se.push(me)}function Mc(se,te,oe,me,ve,pe){var Se=(pe-te)/(me-te);return se.push(pe),se.push(oe+(ve-oe)*Se),se.push(1),Se}function Ss(se,te,oe,me,ve,pe){var Se=(pe-oe)/(ve-oe);return se.push(te+(me-te)*Se),se.push(pe),se.push(1),Se}function Qc(se,te){for(var oe=[],me=0;me<se.length;me++){var ve,pe=se[me],Se=pe.type;if("Point"===Se||"MultiPoint"===Se||"LineString"===Se)ve=Nu(pe.geometry,te);else if("MultiLineString"===Se||"Polygon"===Se){ve=[];for(var He=0;He<pe.geometry.length;He++)ve.push(Nu(pe.geometry[He],te))}else if("MultiPolygon"===Se)for(ve=[],He=0;He<pe.geometry.length;He++){for(var Ze=[],Be=0;Be<pe.geometry[He].length;Be++)Ze.push(Nu(pe.geometry[He][Be],te));ve.push(Ze)}oe.push(Ol(pe.id,Se,ve,pe.tags))}return oe}function Nu(se,te){var oe=[];oe.size=se.size,void 0!==se.start&&(oe.start=se.start,oe.end=se.end);for(var me=0;me<se.length;me+=3)oe.push(se[me]+te,se[me+1],se[me+2]);return oe}function _h(se,te){if(se.transformed)return se;var oe,me,ve,pe=1<<se.z,Se=se.x,He=se.y;for(oe=0;oe<se.features.length;oe++){var Ze=se.features[oe],Be=Ze.geometry,lt=Ze.type;if(Ze.geometry=[],1===lt)for(me=0;me<Be.length;me+=2)Ze.geometry.push(Bs(Be[me],Be[me+1],te,pe,Se,He));else for(me=0;me<Be.length;me++){var Rt=[];for(ve=0;ve<Be[me].length;ve+=2)Rt.push(Bs(Be[me][ve],Be[me][ve+1],te,pe,Se,He));Ze.geometry.push(Rt)}}return se.transformed=!0,se}function Bs(se,te,oe,me,ve,pe){return[Math.round(oe*(se*me-ve)),Math.round(oe*(te*me-pe))]}function Kl(se,te,oe,me,ve){for(var pe=te===ve.maxZoom?0:ve.tolerance/((1<<te)*ve.extent),Se={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:oe,y:me,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},He=0;He<se.length;He++){Se.numFeatures++,Jl(Se,se[He],pe,ve);var Ze=se[He].minX,Be=se[He].minY,lt=se[He].maxX,Rt=se[He].maxY;Ze<Se.minX&&(Se.minX=Ze),Be<Se.minY&&(Se.minY=Be),lt>Se.maxX&&(Se.maxX=lt),Rt>Se.maxY&&(Se.maxY=Rt)}return Se}function Jl(se,te,oe,me){var ve=te.geometry,pe=te.type,Se=[];if("Point"===pe||"MultiPoint"===pe)for(var He=0;He<ve.length;He+=3)Se.push(ve[He]),Se.push(ve[He+1]),se.numPoints++,se.numSimplified++;else if("LineString"===pe)Ll(Se,ve,se,oe,!1,!1);else if("MultiLineString"===pe||"Polygon"===pe)for(He=0;He<ve.length;He++)Ll(Se,ve[He],se,oe,"Polygon"===pe,0===He);else if("MultiPolygon"===pe)for(var Ze=0;Ze<ve.length;Ze++){var Be=ve[Ze];for(He=0;He<Be.length;He++)Ll(Se,Be[He],se,oe,!0,0===He)}if(Se.length){var lt=te.tags||null;if("LineString"===pe&&me.lineMetrics){for(var Rt in lt={},te.tags)lt[Rt]=te.tags[Rt];lt.mapbox_clip_start=ve.start/ve.size,lt.mapbox_clip_end=ve.end/ve.size}var xt={geometry:Se,type:"Polygon"===pe||"MultiPolygon"===pe?3:"LineString"===pe||"MultiLineString"===pe?2:1,tags:lt};null!==te.id&&(xt.id=te.id),se.features.push(xt)}}function Ll(se,te,oe,me,ve,pe){var Se=me*me;if(me>0&&te.size<(ve?Se:me))oe.numPoints+=te.length/3;else{for(var He=[],Ze=0;Ze<te.length;Ze+=3)(0===me||te[Ze+2]>Se)&&(oe.numSimplified++,He.push(te[Ze]),He.push(te[Ze+1])),oe.numPoints++;ve&&function(Be,lt){for(var Rt=0,xt=0,Xt=Be.length,mt=Xt-2;xt<Xt;mt=xt,xt+=2)Rt+=(Be[xt]-Be[mt])*(Be[xt+1]+Be[mt+1]);if(Rt>0===lt)for(xt=0,Xt=Be.length;xt<Xt/2;xt+=2){var Je=Be[xt],ot=Be[xt+1];Be[xt]=Be[Xt-2-xt],Be[xt+1]=Be[Xt-1-xt],Be[Xt-2-xt]=Je,Be[Xt-1-xt]=ot}}(He,pe),se.push(He)}}function Da(se,te){var oe=(te=this.options=function(ve,pe){for(var Se in pe)ve[Se]=pe[Se];return ve}(Object.create(this.options),te)).debug;if(oe&&console.time("preprocess data"),te.maxZoom<0||te.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(te.promoteId&&te.generateId)throw new Error("promoteId and generateId cannot be used together.");var ve,pe,Se,He,Ze,Be,me=function(ve,pe){var Se=[];if("FeatureCollection"===ve.type)for(var He=0;He<ve.features.length;He++)_l(Se,ve.features[He],pe,He);else _l(Se,"Feature"===ve.type?ve:{geometry:ve},pe);return Se}(se,te);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",te.indexMaxZoom,te.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ve=me,pe=te,Se=pe.buffer/pe.extent,He=ve,Ze=Ns(ve,1,-1-Se,Se,0,-1,2,pe),Be=Ns(ve,1,1-Se,2+Se,0,-1,2,pe),(Ze||Be)&&(He=Ns(ve,1,-Se,1+Se,0,-1,2,pe)||[],Ze&&(He=Qc(Ze,1).concat(He)),Be&&(He=He.concat(Qc(Be,-1)))),me=He).length&&this.splitTile(me,0,0,0),oe&&(me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Bo(se,te,oe){return 32*((1<<se)*oe+te)+se}function be(se,te){const oe=se.tileID.canonical;if(!this._geoJSONIndex)return te(null,null);const me=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);if(!me)return te(null,null);const ve=new et(me.features);let pe=an(ve);0===pe.byteOffset&&pe.byteLength===pe.buffer.byteLength||(pe=new Uint8Array(pe)),te(null,{vectorTile:ve,rawData:pe.buffer})}Da.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Da.prototype.splitTile=function(se,te,oe,me,ve,pe,Se){for(var He=[se,te,oe,me],Ze=this.options,Be=Ze.debug;He.length;){me=He.pop(),oe=He.pop(),te=He.pop(),se=He.pop();var lt=1<<te,Rt=Bo(te,oe,me),xt=this.tiles[Rt];if(!xt&&(Be>1&&console.time("creation"),xt=this.tiles[Rt]=Kl(se,te,oe,me,Ze),this.tileCoords.push({z:te,x:oe,y:me}),Be)){Be>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",te,oe,me,xt.numFeatures,xt.numPoints,xt.numSimplified),console.timeEnd("creation"));var Xt="z"+te;this.stats[Xt]=(this.stats[Xt]||0)+1,this.total++}if(xt.source=se,ve){if(te===Ze.maxZoom||te===ve)continue;var mt=1<<ve-te;if(oe!==Math.floor(pe/mt)||me!==Math.floor(Se/mt))continue}else if(te===Ze.indexMaxZoom||xt.numPoints<=Ze.indexMaxPoints)continue;if(xt.source=null,0!==se.length){Be>1&&console.time("clipping");var Je,ot,On,Bn,sn,br,Ft=.5*Ze.buffer/Ze.extent,mr=.5-Ft,or=.5+Ft,qt=1+Ft;Je=ot=On=Bn=null,sn=Ns(se,lt,oe-Ft,oe+or,0,xt.minX,xt.maxX,Ze),br=Ns(se,lt,oe+mr,oe+qt,0,xt.minX,xt.maxX,Ze),se=null,sn&&(Je=Ns(sn,lt,me-Ft,me+or,1,xt.minY,xt.maxY,Ze),ot=Ns(sn,lt,me+mr,me+qt,1,xt.minY,xt.maxY,Ze),sn=null),br&&(On=Ns(br,lt,me-Ft,me+or,1,xt.minY,xt.maxY,Ze),Bn=Ns(br,lt,me+mr,me+qt,1,xt.minY,xt.maxY,Ze),br=null),Be>1&&console.timeEnd("clipping"),He.push(Je||[],te+1,2*oe,2*me),He.push(ot||[],te+1,2*oe,2*me+1),He.push(On||[],te+1,2*oe+1,2*me),He.push(Bn||[],te+1,2*oe+1,2*me+1)}}},Da.prototype.getTile=function(se,te,oe){var me=this.options,ve=me.extent,pe=me.debug;if(se<0||se>24)return null;var Se=1<<se,He=Bo(se,te=(te%Se+Se)%Se,oe);if(this.tiles[He])return _h(this.tiles[He],ve);pe>1&&console.log("drilling down to z%d-%d-%d",se,te,oe);for(var Ze,Be=se,lt=te,Rt=oe;!Ze&&Be>0;)Be--,lt=Math.floor(lt/2),Rt=Math.floor(Rt/2),Ze=this.tiles[Bo(Be,lt,Rt)];return Ze&&Ze.source?(pe>1&&console.log("found parent tile z%d-%d-%d",Be,lt,Rt),pe>1&&console.time("drilling down"),this.splitTile(Ze.source,Be,lt,Rt,se,te,oe),pe>1&&console.timeEnd("drilling down"),this.tiles[He]?_h(this.tiles[He],ve):null):null};class De extends C.VectorTileWorkerSource{constructor(te,oe,me,ve,pe){super(te,oe,me,ve,be),pe&&(this.loadGeoJSON=pe)}loadData(te,oe){const me=te&&te.request,ve=me&&me.collectResourceTiming;this.loadGeoJSON(te,(pe,Se)=>{if(pe||!Se)return oe(pe);if("object"!=typeof Se)return oe(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));{Ke(Se,!0);try{if(te.filter){const Ze=C.createExpression(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ze.result)throw new Error(Ze.value.map(lt=>`${lt.key}: ${lt.message}`).join(", "));const Be=Se.features.filter(lt=>Ze.value.evaluate({zoom:0},lt));Se={type:"FeatureCollection",features:Be}}this._geoJSONIndex=te.cluster?new gl(function({superclusterOptions:Ze,clusterProperties:Be}){if(!Be||!Ze)return Ze;const lt={},Rt={},xt={accumulated:null,zoom:0},Xt={properties:null},mt=Object.keys(Be);for(const Je of mt){const[ot,On]=Be[Je],Bn=C.createExpression(On),sn=C.createExpression("string"==typeof ot?[ot,["accumulated"],["get",Je]]:ot);lt[Je]=Bn.value,Rt[Je]=sn.value}return Ze.map=Je=>{Xt.properties=Je;const ot={};for(const On of mt)ot[On]=lt[On].evaluate(xt,Xt);return ot},Ze.reduce=(Je,ot)=>{Xt.properties=ot;for(const On of mt)xt.accumulated=Je[On],Je[On]=Rt[On].evaluate(xt,Xt)},Ze}(te)).load(Se.features):new Da(Ze=Se,te.geojsonVtOptions)}catch(Ze){return oe(Ze)}this.loaded={};const He={};if(ve){const Ze=C.getPerformanceMeasurement(me);Ze&&(He.resourceTiming={},He.resourceTiming[te.source]=JSON.parse(JSON.stringify(Ze)))}oe(null,He)}var Ze})}reloadTile(te,oe){const me=this.loaded;return me&&me[te.uid]?super.reloadTile(te,oe):this.loadTile(te,oe)}loadGeoJSON(te,oe){if(te.request)C.getJSON(te.request,oe);else{if("string"!=typeof te.data)return oe(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));try{return oe(null,JSON.parse(te.data))}catch(me){return oe(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(te,oe){try{oe(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(me){oe(me)}}getClusterChildren(te,oe){try{oe(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(me){oe(me)}}getClusterLeaves(te,oe){try{oe(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(me){oe(me)}}}class Oe{constructor(te){this.self=te,this.actor=new C.Actor(te,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=C.getProjection({name:"mercator"}),this.workerSourceTypes={vector:C.VectorTileWorkerSource,geojson:De},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(oe,me)=>{if(this.workerSourceTypes[oe])throw new Error(`Worker source with name "${oe}" already registered.`);this.workerSourceTypes[oe]=me},this.self.registerRTLTextPlugin=oe=>{if(C.plugin.isParsed())throw new Error("RTL text plugin already registered.");C.plugin.applyArabicShaping=oe.applyArabicShaping,C.plugin.processBidirectionalText=oe.processBidirectionalText,C.plugin.processStyledBidirectionalText=oe.processStyledBidirectionalText}}clearCaches(te,oe,me){delete this.layerIndexes[te],delete this.availableImages[te],delete this.workerSources[te],delete this.demWorkerSources[te],me()}checkIfReady(te,oe,me){me()}setReferrer(te,oe){this.referrer=oe}spriteLoaded(te,oe){this.isSpriteLoaded[te]=oe;for(const me in this.workerSources[te]){const ve=this.workerSources[te][me];for(const pe in ve)ve[pe]instanceof C.VectorTileWorkerSource&&(ve[pe].isSpriteLoaded=oe,ve[pe].fire(new C.Event("isSpriteLoaded")))}}setImages(te,oe,me){this.availableImages[te]=oe;for(const ve in this.workerSources[te]){const pe=this.workerSources[te][ve];for(const Se in pe)pe[Se].availableImages=oe}me()}enableTerrain(te,oe,me){this.terrain=oe,me()}setProjection(te,oe){this.projections[te]=C.getProjection(oe)}setLayers(te,oe,me){this.getLayerIndex(te).replace(oe),me()}updateLayers(te,oe,me){this.getLayerIndex(te).update(oe.layers,oe.removedIds),me()}loadTile(te,oe,me){const ve=this.enableTerrain?C.extend({enableTerrain:this.terrain},oe):oe;ve.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,oe.type,oe.source).loadTile(ve,me)}loadDEMTile(te,oe,me){const ve=this.enableTerrain?C.extend({buildQuadTree:this.terrain},oe):oe;this.getDEMWorkerSource(te,oe.source).loadTile(ve,me)}reloadTile(te,oe,me){const ve=this.enableTerrain?C.extend({enableTerrain:this.terrain},oe):oe;ve.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,oe.type,oe.source).reloadTile(ve,me)}abortTile(te,oe,me){this.getWorkerSource(te,oe.type,oe.source).abortTile(oe,me)}removeTile(te,oe,me){this.getWorkerSource(te,oe.type,oe.source).removeTile(oe,me)}removeSource(te,oe,me){if(!this.workerSources[te]||!this.workerSources[te][oe.type]||!this.workerSources[te][oe.type][oe.source])return;const ve=this.workerSources[te][oe.type][oe.source];delete this.workerSources[te][oe.type][oe.source],void 0!==ve.removeSource?ve.removeSource(oe,me):me()}loadWorkerSource(te,oe,me){try{this.self.importScripts(oe.url),me()}catch(ve){me(ve.toString())}}syncRTLPluginState(te,oe,me){try{C.plugin.setState(oe);const ve=C.plugin.getPluginURL();if(C.plugin.isLoaded()&&!C.plugin.isParsed()&&null!=ve){this.self.importScripts(ve);const pe=C.plugin.isParsed();me(pe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ve}`),pe)}}catch(ve){me(ve.toString())}}getAvailableImages(te){let oe=this.availableImages[te];return oe||(oe=[]),oe}getLayerIndex(te){let oe=this.layerIndexes[te];return oe||(oe=this.layerIndexes[te]=new Et),oe}getWorkerSource(te,oe,me){return this.workerSources[te]||(this.workerSources[te]={}),this.workerSources[te][oe]||(this.workerSources[te][oe]={}),this.workerSources[te][oe][me]||(this.workerSources[te][oe][me]=new this.workerSourceTypes[oe]({send:(ve,pe,Se,He,Ze,Be)=>{this.actor.send(ve,pe,Se,te,Ze,Be)},scheduler:this.actor.scheduler},this.getLayerIndex(te),this.getAvailableImages(te),this.isSpriteLoaded[te])),this.workerSources[te][oe][me]}getDEMWorkerSource(te,oe){return this.demWorkerSources[te]||(this.demWorkerSources[te]={}),this.demWorkerSources[te][oe]||(this.demWorkerSources[te][oe]=new Ge),this.demWorkerSources[te][oe]}enforceCacheSizeLimit(te,oe){C.enforceCacheSizeLimit(oe)}getWorkerPerformanceMetrics(te,oe,me){me(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Oe(self)),Oe}),Jt(0,function(C){var ut=tn;function tn(f){return l=f,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,M,D=new Blob([""],{type:"text/javascript"}),B=URL.createObjectURL(D);try{M=new Worker(B),x=!0}catch(G){x=!1}return M&&M.terminate(),URL.revokeObjectURL(B),x}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var x=document.createElement("canvas");x.width=x.height=1;var M=x.getContext("2d");if(!M)return!1;var D=M.getImageData(0,0,1,1);return D&&D.width===x.width}()||(void 0===Et[d=l&&l.failIfMajorPerformanceCaveat]&&(Et[d]=function(x){var M,B,G,W,D=(B=x,G=document.createElement("canvas"),(W=Object.create(tn.webGLContextAttributes)).failIfMajorPerformanceCaveat=B,G.getContext("webgl",W)||G.getContext("experimental-webgl",W));if(!D)return!1;try{M=D.createShader(D.VERTEX_SHADER)}catch(B){return!1}return!(!M||D.isContextLost())&&(D.shaderSource(M,"void main() {}"),D.compileShader(M),!0===D.getShaderParameter(M,D.COMPILE_STATUS))}(d)),!Et[d]||document.documentMode));var l,d}var Et={};function it(f,l){if(Array.isArray(f)){if(!Array.isArray(l)||f.length!==l.length)return!1;for(let d=0;d<f.length;d++)if(!it(f[d],l[d]))return!1;return!0}if("object"==typeof f&&null!==f&&null!==l){if("object"!=typeof l||Object.keys(f).length!==Object.keys(l).length)return!1;for(const d in f)if(!it(f[d],l[d]))return!1;return!0}return f===l}tn.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ge={create:function(f,l,d){const x=C.window.document.createElement(f);return void 0!==l&&(x.className=l),d&&d.appendChild(x),x},createNS:function(f,l){return C.window.document.createElementNS(f,l)}},Ke=C.window.document&&C.window.document.documentElement.style,Wt=Ke&&void 0!==Ke.userSelect?"userSelect":"WebkitUserSelect";let on;Ge.disableDrag=function(){Ke&&Wt&&(on=Ke[Wt],Ke[Wt]="none")},Ge.enableDrag=function(){Ke&&Wt&&(Ke[Wt]=on)},Ge.setTransform=function(f,l){f.style.transform=l};let Cn=!1;try{const f=Object.defineProperty({},"passive",{get(){Cn=!0}});C.window.addEventListener("test",f,f),C.window.removeEventListener("test",f,f)}catch(f){Cn=!1}Ge.addEventListener=function(f,l,d,x={}){f.addEventListener(l,d,"passive"in x&&Cn?x:x.capture)},Ge.removeEventListener=function(f,l,d,x={}){f.removeEventListener(l,d,"passive"in x&&Cn?x:x.capture)};const fn=function(f){f.preventDefault(),f.stopPropagation(),C.window.removeEventListener("click",fn,!0)};function et(f,l,d){const x=f.offsetWidth===l.width?1:f.offsetWidth/l.width;return new C.pointGeometry((d.clientX-l.left)*x,(d.clientY-l.top)*x)}function _t(f,l){var d=l[0],x=l[1],M=l[2],D=l[3],B=d*D-M*x;return B?(f[0]=D*(B=1/B),f[1]=-x*B,f[2]=-M*B,f[3]=d*B,f):null}Ge.suppressClick=function(){C.window.addEventListener("click",fn,!0),C.window.setTimeout(()=>{C.window.removeEventListener("click",fn,!0)},0)},Ge.mousePos=function(f,l){const d=f.getBoundingClientRect();return et(f,d,l)},Ge.touchPos=function(f,l){const d=f.getBoundingClientRect(),x=[];for(let M=0;M<l.length;M++)x.push(et(f,d,l[M]));return x},Ge.mouseButton=function(f){return void 0!==C.window.InstallTrigger&&2===f.button&&f.ctrlKey&&C.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button},Ge.remove=function(f){f.parentNode&&f.parentNode.removeChild(f)};class Dt{constructor(l,d){this.pos=l,this.dir=d}intersectsPlane(l,d,x){const M=C.dot(d,this.dir);if(Math.abs(M)<1e-6)return!1;const D=C.dot(C.sub(C.create(),l,this.pos),d)/M,B=C.scaleAndAdd(C.create(),this.pos,this.dir,D);return C.copy(x,B),!0}}class bn{constructor(l,d){this.points=l,this.planes=d}static fromInvProjectionMatrix(l,d,x){const M=Math.pow(2,x),D=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(G=>{const W=C.transformMat4([],G,l),Y=1/W[3]/d*M;return C.mul(W,W,[Y,Y,1/W[3],Y])}),B=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(G=>{const W=C.sub([],D[G[0]],D[G[1]]),Y=C.sub([],D[G[2]],D[G[1]]),ee=C.normalize([],C.cross([],W,Y)),Q=-C.dot(ee,D[G[1]]);return ee.concat(Q)});return new bn(D,B)}}class Pn{constructor(l,d){this.min=l,this.max=d,this.center=C.scale([],C.add([],this.min,this.max),.5)}quadrant(l){const d=[l%2==0,l<2],x=C.clone(this.min),M=C.clone(this.max);for(let D=0;D<d.length;D++)x[D]=d[D]?this.min[D]:this.center[D],M[D]=d[D]?this.center[D]:this.max[D];return M[2]=this.max[2],new Pn(x,M)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}distanceZ(l){return Math.max(Math.min(this.max[2],l[2]),this.min[2])-l[2]}intersects(l){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let x=!0;for(let M=0;M<l.planes.length;M++){const D=l.planes[M];let B=0;for(let G=0;G<d.length;G++)B+=C.dot$1(D,d[G])>=0;if(0===B)return 0;B!==d.length&&(x=!1)}if(x)return 2;for(let M=0;M<3;M++){let D=Number.MAX_VALUE,B=-Number.MAX_VALUE;for(let G=0;G<l.points.length;G++){const W=l.points[G][M]-this.min[M];D=Math.min(D,W),B=Math.max(B,W)}if(B<0||D>this.max[M]-this.min[M])return 0}return 1}}function an(f){const{userImage:l}=f;return!!(l&&l.render&&l.render())&&(f.data.replace(new Uint8Array(l.data.buffer)),!0)}class Rn extends C.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new C.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:d,callback:x}of this.requestors)this._notify(d,x);this.requestors=[]}}getImage(l){return this.images[l]}addImage(l,d){this._validate(l,d)&&(this.images[l]=d)}_validate(l,d){let x=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new C.ErrorEvent(new Error(`Image "${l}" has invalid "stretchX" value`))),x=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new C.ErrorEvent(new Error(`Image "${l}" has invalid "stretchY" value`))),x=!1),this._validateContent(d.content,d)||(this.fire(new C.ErrorEvent(new Error(`Image "${l}" has invalid "content" value`))),x=!1),x}_validateStretch(l,d){if(!l)return!0;let x=0;for(const M of l){if(M[0]<x||M[1]<M[0]||d<M[1])return!1;x=M[1]}return!0}_validateContent(l,d){return!(l&&(4!==l.length||l[0]<0||d.data.width<l[0]||l[1]<0||d.data.height<l[1]||l[2]<0||d.data.width<l[2]||l[3]<0||d.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,d){d.version=this.images[l].version+1,this.images[l]=d,this.updatedImages[l]=!0}removeImage(l){const d=this.images[l];delete this.images[l],delete this.patterns[l],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l,d){let x=!0;if(!this.isLoaded())for(const M of l)this.images[M]||(x=!1);this.isLoaded()||x?this._notify(l,d):this.requestors.push({ids:l,callback:d})}_notify(l,d){const x={};for(const M of l){this.images[M]||this.fire(new C.Event("styleimagemissing",{id:M}));const D=this.images[M];D?x[M]={data:D.data.clone(),pixelRatio:D.pixelRatio,sdf:D.sdf,version:D.version,stretchX:D.stretchX,stretchY:D.stretchY,content:D.content,hasRenderCallback:Boolean(D.userImage&&D.userImage.render)}:C.warnOnce(`Image "${M}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,x)}getPixelSize(){const{width:l,height:d}=this.atlasImage;return{width:l,height:d}}getPattern(l){const d=this.patterns[l],x=this.getImage(l);if(!x)return null;if(d&&d.position.version===x.version)return d.position;if(d)d.position.version=x.version;else{const M={w:x.data.width+2,h:x.data.height+2,x:0,y:0},D=new C.ImagePosition(M,x);this.patterns[l]={bin:M,position:D}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const d=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new C.Texture(l,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const D in this.patterns)l.push(this.patterns[D].bin);const{w:d,h:x}=C.potpack(l),M=this.atlasImage;M.resize({width:d||1,height:x||1});for(const D in this.patterns){const{bin:B}=this.patterns[D],G=B.x+1,W=B.y+1,Y=this.images[D].data,ee=Y.width,Q=Y.height;C.RGBAImage.copy(Y,M,{x:0,y:0},{x:G,y:W},{width:ee,height:Q}),C.RGBAImage.copy(Y,M,{x:0,y:Q-1},{x:G,y:W-1},{width:ee,height:1}),C.RGBAImage.copy(Y,M,{x:0,y:0},{x:G,y:W+Q},{width:ee,height:1}),C.RGBAImage.copy(Y,M,{x:ee-1,y:0},{x:G-1,y:W},{width:1,height:Q}),C.RGBAImage.copy(Y,M,{x:0,y:0},{x:G+ee,y:W},{width:1,height:Q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const d of l){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const x=this.images[d];an(x)&&this.updateImage(d,x)}}}const nr=new C.Properties({anchor:new C.DataConstantProperty(C.spec.light.anchor),position:new class{constructor(){this.specification=C.spec.light.position}possiblyEvaluate(f,l){return function([d,x,M]){const D=C.degToRad(x+90),B=C.degToRad(M);return{x:d*Math.cos(D)*Math.sin(B),y:d*Math.sin(D)*Math.sin(B),z:d*Math.cos(B),azimuthal:x,polar:M}}(f.expression.evaluate(l))}interpolate(f,l,d){return{x:C.number(f.x,l.x,d),y:C.number(f.y,l.y,d),z:C.number(f.z,l.z,d),azimuthal:C.number(f.azimuthal,l.azimuthal,d),polar:C.number(f.polar,l.polar,d)}}},color:new C.DataConstantProperty(C.spec.light.color),intensity:new C.DataConstantProperty(C.spec.light.intensity)}),dr="-transition";class jn extends C.Evented{constructor(l){super(),this._transitionable=new C.Transitionable(nr),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,d={}){if(!this._validate(C.validateLight,l,d))for(const x in l){const M=l[x];C.endsWith(x,dr)?this._transitionable.setTransition(x.slice(0,-dr.length),M):this._transitionable.setValue(x,M)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,x){return(!x||!1!==x.validate)&&C.emitValidationErrors(this,l.call(C.validateStyle,C.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:C.spec})))}}const pn=new C.Properties({source:new C.DataConstantProperty(C.spec.terrain.source),exaggeration:new C.DataConstantProperty(C.spec.terrain.exaggeration)}),sr="-transition";class qr extends C.Evented{constructor(l){super(),this._transitionable=new C.Transitionable(pn),this.set(l),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(l){for(const d in l){const x=l[d];C.endsWith(d,sr)?this._transitionable.setTransition(d.slice(0,-sr.length),x):this._transitionable.setValue(d,x)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}}function Es(f,l,d,x){const M=C.smoothstep(45,65,d),[D,B]=je(f,x),G=C.length(l);let W=1-Math.min(1,Math.exp((G-D)/(B-D)*-6));return W*=W*W,W=Math.min(1,1.00747*W),W*M*f.alpha}function je(f,l){const d=.5/Math.tan(.5*l);return[f.range[0]+d,f.range[1]+d]}const ct=new C.Properties({range:new C.DataConstantProperty(C.spec.fog.range),color:new C.DataConstantProperty(C.spec.fog.color),"horizon-blend":new C.DataConstantProperty(C.spec.fog["horizon-blend"])}),Vt="-transition";class Pr extends C.Evented{constructor(l,d){super(),this._transitionable=new C.Transitionable(ct),this.set(l),this._transitioning=this._transitionable.untransitioned(),this._transform=d}isSoftDisabled(){return"mercator"!==this._transform.projection.name}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,d={}){if(!this._validate(C.validateFog,l,d))for(const x in l){const M=l[x];C.endsWith(x,Vt)?this._transitionable.setTransition(x.slice(0,-Vt.length),M):this._transitionable.setValue(x,M)}}getOpacity(l){if(this.isSoftDisabled())return 0;const d=this.properties&&this.properties.get("color")||1;return C.smoothstep(45,65,l)*d.a}getOpacityAtLatLng(l,d){return this.isSoftDisabled()?0:function(x,M,D){const B=C.MercatorCoordinate.fromLngLat(M),G=D.elevation?D.elevation.getAtPointOrZero(B):0,W=[B.x,B.y,G];return C.transformMat4$1(W,W,D.mercatorFogMatrix),Es(x,W,D.pitch,D._fov)}(this.state,l,d)}getFovAdjustedRange(l){return this.isSoftDisabled()?[0,1]:je(this.state,l)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,x){return(!x||!1!==x.validate)&&C.emitValidationErrors(this,l.call(C.validateStyle,C.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:C.spec})))}}class fr{constructor(l,d){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=C.uniqueId();const x=this.workerPool.acquire(this.id);for(let M=0;M<x.length;M++){const D=new fr.Actor(x[M],d,this.id);D.name=`Worker ${M}`,this.actors.push(D)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(l,d,x){C.asyncAll(this.actors,(M,D)=>{M.send(l,d,D)},x=x||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(l=>{l.remove()}),this.actors=[],this.workerPool.release(this.id)}}function vr(f,l,d){return l*(C.EXTENT/(f.tileSize*Math.pow(2,d-f.tileID.overscaledZ)))}fr.Actor=C.Actor;class Er{constructor(l,d,x,M){this.screenBounds=l,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=x,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(D=>M.pointCoordinate3D(D)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(l,d){let x,M;if(l instanceof C.pointGeometry||"number"==typeof l[0]){const D=C.pointGeometry.convert(l);x=[C.pointGeometry.convert(l)],M=d.isPointAboveHorizon(D)}else{const D=C.pointGeometry.convert(l[0]),B=C.pointGeometry.convert(l[1]);x=[D,B],M=C.polygonizeBounds(D,B).every(G=>d.isPointAboveHorizon(G))}return new Er(x,d.getCameraPoint(),M,d)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(l){return C.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const d=this.screenBounds[0],x=1===this.screenBounds.length?this.screenBounds[0].add(new C.pointGeometry(1,1)):this.screenBounds[1],M=C.polygonizeBounds(d,x,0,!1);return this.cameraPoint.y>x.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<x.x?M.splice(3,0,this.cameraPoint):this.cameraPoint.x>=x.x?M[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(M[3]=this.cameraPoint)),C.bufferConvexPolygon(M,l)}containsTile(l,d,x){const M=l.queryPadding+1,D=l.tileID.wrap,B=x?this._bufferedCameraMercator(M,d).map(ge=>C.getTilePoint(l.tileTransform,ge,D)):this._bufferedScreenMercator(M,d).map(ge=>C.getTilePoint(l.tileTransform,ge,D)),G=this.screenGeometryMercator.map(ge=>C.getTileVec3(l.tileTransform,ge,D)),W=G.map(ge=>new C.pointGeometry(ge[0],ge[1])),Y=d.getFreeCameraOptions().position||new C.MercatorCoordinate(0,0,0),ee=C.getTileVec3(l.tileTransform,Y,D),Q=G.map(ge=>{const xe=C.sub(ge,ge,ee);return C.normalize(xe,xe),new Dt(ee,xe)}),le=vr(l,1,d.zoom);if(C.polygonIntersectsBox(B,0,0,C.EXTENT,C.EXTENT))return{queryGeometry:this,tilespaceGeometry:W,tilespaceRays:Q,bufferedTilespaceGeometry:B,bufferedTilespaceBounds:(de=C.getBounds(B),de.min.x=C.clamp(de.min.x,0,C.EXTENT),de.min.y=C.clamp(de.min.y,0,C.EXTENT),de.max.x=C.clamp(de.max.x,0,C.EXTENT),de.max.y=C.clamp(de.max.y,0,C.EXTENT),de),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:le};var de}_bufferedScreenMercator(l,d){const x=Ui(l);if(this._screenRaycastCache[x])return this._screenRaycastCache[x];{const M=this.bufferedScreenGeometry(l).map(D=>d.pointCoordinate3D(D));return this._screenRaycastCache[x]=M,M}}_bufferedCameraMercator(l,d){const x=Ui(l);if(this._cameraRaycastCache[x])return this._cameraRaycastCache[x];{const M=this.bufferedCameraGeometry(l).map(D=>d.pointCoordinate3D(D));return this._cameraRaycastCache[x]=M,M}}}function Ui(f){return 100*f|0}function Wo(f,l,d){const x=function(M,D){if(M)return d(M);if(D){const B=C.pick(C.extend(D,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);D.vector_layers&&(B.vectorLayers=D.vector_layers,B.vectorLayerIds=B.vectorLayers.map(G=>G.id)),B.tiles=l.canonicalizeTileset(B,f.url),d(null,B)}};return f.url?C.getJSON(l.transformRequest(l.normalizeSourceURL(f.url),C.ResourceType.Source),x):C.exported.frame(()=>x(null,f))}class Xi{constructor(l,d,x){this.bounds=C.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=d||0,this.maxzoom=x||24}validateBounds(l){return Array.isArray(l)&&4===l.length?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const d=Math.pow(2,l.z),x=Math.floor(C.mercatorXfromLng(this.bounds.getWest())*d),M=Math.floor(C.mercatorYfromLat(this.bounds.getNorth())*d),D=Math.ceil(C.mercatorXfromLng(this.bounds.getEast())*d),B=Math.ceil(C.mercatorYfromLat(this.bounds.getSouth())*d);return l.x>=x&&l.x<D&&l.y>=M&&l.y<B}}class Vi{constructor(l,d,x){this.context=l;const M=l.gl;this.buffer=M.createBuffer(),this.dynamicDraw=Boolean(x),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),M.bufferData(M.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Zr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class gl{constructor(l,d,x,M){this.length=d.length,this.attributes=x,this.itemSize=d.bytesPerElement,this.dynamicDraw=M,this.context=l;const D=l.gl;this.buffer=D.createBuffer(),l.bindVertexBuffer.set(this.buffer),D.bufferData(D.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?D.DYNAMIC_DRAW:D.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,d){for(let x=0;x<this.attributes.length;x++){const M=d.attributes[this.attributes[x].name];void 0!==M&&l.enableVertexAttribArray(M)}}setVertexAttribPointers(l,d,x){for(let M=0;M<this.attributes.length;M++){const D=this.attributes[M],B=d.attributes[D.name];void 0!==B&&l.vertexAttribPointer(B,D.components,l[Zr[D.type]],!1,this.itemSize,D.offset+this.itemSize*(x||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ir{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class yl extends Ir{getDefault(){return C.Color.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Sc extends Ir{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Yl extends Ir{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class di extends Ir{getDefault(){return[!0,!0,!0,!0]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class zs extends Ir{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class ss extends Ir{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class Ar extends Ir{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const d=this.current;(l.func!==d.func||l.ref!==d.ref||l.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Tc extends Ir{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class ol extends Ir{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=l,this.dirty=!1}}class vl extends Ir{getDefault(){return[0,1]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class Rl extends Ir{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=l,this.dirty=!1}}class Ol extends Ir{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class gu extends Ir{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.BLEND):d.disable(d.BLEND),this.current=l,this.dirty=!1}}class _l extends Ir{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class Na extends Ir{getDefault(){return C.Color.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class la extends Ir{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class al extends Ir{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=l,this.dirty=!1}}class Uh extends Ir{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Ys extends Ir{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class Ns extends Ir{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class Kc extends Ir{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class Ic extends Ir{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Vh extends Ir{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Jc extends Ir{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Qu extends Ir{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Mc extends Ir{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Ss extends Ir{getDefault(){return null}set(l){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Qc extends Ir{constructor(l){super(l),this.vao=l.extVertexArrayObject}getDefault(){return null}set(l){this.vao&&(l!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(l),this.current=l,this.dirty=!1)}}class Nu extends Ir{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class _h extends Ir{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Bs extends Ir{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Kl extends Ir{constructor(l,d){super(l),this.context=l,this.parent=d}getDefault(){return null}}class Jl extends Kl{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Ll extends Kl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Da extends Ll{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Bo{constructor(l,d,x,M){this.context=l,this.width=d,this.height=x;const D=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new Jl(l,D),M&&(this.depthAttachment=new Ll(l,D))}destroy(){const l=this.context.gl,d=this.colorAttachment.get();if(d&&l.deleteTexture(d),this.depthAttachment){const x=this.depthAttachment.get();x&&l.deleteRenderbuffer(x)}l.deleteFramebuffer(this.framebuffer)}}class be{constructor(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new yl(this),this.clearDepth=new Sc(this),this.clearStencil=new Yl(this),this.colorMask=new di(this),this.depthMask=new zs(this),this.stencilMask=new ss(this),this.stencilFunc=new Ar(this),this.stencilOp=new Tc(this),this.stencilTest=new ol(this),this.depthRange=new vl(this),this.depthTest=new Rl(this),this.depthFunc=new Ol(this),this.blend=new gu(this),this.blendFunc=new _l(this),this.blendColor=new Na(this),this.blendEquation=new la(this),this.cullFace=new al(this),this.cullFaceSide=new Uh(this),this.frontFace=new Ys(this),this.program=new Ns(this),this.activeTexture=new Kc(this),this.viewport=new Ic(this),this.bindFramebuffer=new Vh(this),this.bindRenderbuffer=new Jc(this),this.bindTexture=new Qu(this),this.bindVertexBuffer=new Mc(this),this.bindElementBuffer=new Ss(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Qc(this),this.pixelStoreUnpack=new Nu(this),this.pixelStoreUnpackPremultiplyAlpha=new _h(this),this.pixelStoreUnpackFlipY=new Bs(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,d){return new Vi(this,l,d)}createVertexBuffer(l,d,x){return new gl(this,l,d,x)}createRenderbuffer(l,d,x){const M=this.gl,D=M.createRenderbuffer();return this.bindRenderbuffer.set(D),M.renderbufferStorage(M.RENDERBUFFER,l,d,x),this.bindRenderbuffer.set(null),D}createFramebuffer(l,d,x){return new Bo(this,l,d,x)}clear({color:l,depth:d,stencil:x}){const M=this.gl;let D=0;l&&(D|=M.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),void 0!==d&&(D|=M.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),void 0!==x&&(D|=M.STENCIL_BUFFER_BIT,this.clearStencil.set(x),this.stencilMask.set(255)),M.clear(D)}setCullFace(l){!1===l.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){it(l.blendFunction,C.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class De extends C.Evented{constructor(l,d,x,M){super(),this.id=l,this.dispatcher=x,this.setEventedParent(M),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=C.extend({type:"raster"},d),C.extend(this,C.pick(d,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new C.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Wo(this._options,this.map._requestManager,(l,d)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new C.ErrorEvent(l)):d&&(C.extend(this,d),d.bounds&&(this.tileBounds=new Xi(d.bounds,this.minzoom,this.maxzoom)),C.postTurnstileEvent(d.tiles),this.fire(new C.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new C.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return C.extend({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,d){const x=C.exported.devicePixelRatio>=2,M=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),x,this.tileSize);l.request=C.getImage(this.map._requestManager.transformRequest(M,C.ResourceType.Tile),(D,B,G,W)=>{if(delete l.request,l.aborted)l.state="unloaded",d(null);else if(D)l.state="errored",d(D);else if(B){this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:G,expires:W});const Y=this.map.painter.context,ee=Y.gl;l.texture=this.map.painter.getTileTexture(B.width),l.texture?l.texture.update(B,{useMipmap:!0}):(l.texture=new C.Texture(Y,B,ee.RGBA,{useMipmap:!0}),l.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),Y.extTextureFilterAnisotropic&&ee.texParameterf(ee.TEXTURE_2D,Y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Y.extTextureFilterAnisotropicMax)),l.state="loaded",C.cacheEntryPossiblyAdded(this.dispatcher),d(null)}})}abortTile(l,d){l.request&&(l.request.cancel(),delete l.request),d()}unloadTile(l,d){l.texture&&this.map.painter.saveTileTexture(l.texture),d()}hasTransition(){return!1}}let Oe;class se extends C.Evented{constructor(l,d,x,M){super(),this.id=l,this.dispatcher=x,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(M),this.options=d}load(l,d){this._loaded=!1,this.fire(new C.Event("dataloading",{dataType:"source"})),this.url=this.options.url,C.getImage(this.map._requestManager.transformRequest(this.url,C.ResourceType.Image),(x,M)=>{this._loaded=!0,x?this.fire(new C.ErrorEvent(x)):M&&(this.image=C.exported.getImageData(M),l&&(this.coordinates=l),d&&d(),this._finishLoading())})}loaded(){return this._loaded}updateImage(l){return this.image&&l.url?(this.options.url=l.url,this.load(l.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new C.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}setCoordinates(l){this.coordinates=l,delete this._boundsArray;const d=l.map(C.MercatorCoordinate.fromLngLat);return this.tileID=function(x){let M=1/0,D=1/0,B=-1/0,G=-1/0;for(const Q of x)M=Math.min(M,Q.x),D=Math.min(D,Q.y),B=Math.max(B,Q.x),G=Math.max(G,Q.y);const W=Math.max(B-M,G-D),Y=Math.max(0,Math.floor(-Math.log(W)/Math.LN2)),ee=Math.pow(2,Y);return new C.CanonicalTileID(Y,Math.floor((M+B)/2*ee),Math.floor((D+G)/2*ee))}(d),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new C.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const l=C.tileTransform(this.tileID,this.map.transform.projection),d=this.coordinates.map(x=>{const M=l.projection.project(x[0],x[1]);return C.getTilePoint(l,M)._round()});return this._boundsArray=new C.StructArrayLayout4i8,this._boundsArray.emplaceBack(d[0].x,d[0].y,0,0),this._boundsArray.emplaceBack(d[1].x,d[1].y,C.EXTENT,0),this._boundsArray.emplaceBack(d[3].x,d[3].y,0,C.EXTENT),this._boundsArray.emplaceBack(d[2].x,d[2].y,C.EXTENT,C.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const l=this.map.painter.context,d=l.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,C.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=C.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new C.Texture(l,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));for(const x in this.tiles){const M=this.tiles[x];"loaded"!==M.state&&(M.state="loaded",M.texture=this.texture)}}loadTile(l,d){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},d(null)):(l.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const te={vector:class extends C.Evented{constructor(f,l,d,x){if(super(),this.id=f,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,C.extend(this,C.pick(l,["url","scheme","tileSize","promoteId"])),this._options=C.extend({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new C.DedupedRequest}load(){this._loaded=!1,this.fire(new C.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Wo(this._options,this.map._requestManager,(f,l)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new C.ErrorEvent(f)):l&&(C.extend(this,l),l.bounds&&(this.tileBounds=new Xi(l.bounds,this.minzoom,this.maxzoom)),C.postTurnstileEvent(l.tiles,this.map._requestManager._customAccessToken),this.fire(new C.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new C.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}onAdd(f){this.map=f,this.load()}setSourceProperty(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f();const l=this.map.style._getSourceCaches(this.id);for(const d of l)d.clearTiles();this.load()}setTiles(f){return this.setSourceProperty(()=>{this._options.tiles=f}),this}setUrl(f){return this.setSourceProperty(()=>{this.url=f,this._options.url=f}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return C.extend({},this._options)}loadTile(f,l){const d=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(d,C.ResourceType.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:C.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:f.isSymbolTile};if(x.request.collectResourceTiming=this._collectResourceTiming,f.actor&&"expired"!==f.state)"loading"===f.state?f.reloadCallback=l:f.request=f.actor.send("reloadTile",x,M.bind(this));else if(f.actor=this._tileWorkers[d]=this._tileWorkers[d]||this.dispatcher.getActor(),this.dispatcher.ready)f.request=f.actor.send("loadTile",x,M.bind(this),void 0,!0);else{const D=C.loadVectorTile.call({deduped:this._deduped},x,(B,G)=>{B||!G?M.call(this,B):(x.data={cacheControl:G.cacheControl,expires:G.expires,rawData:G.rawData.slice(0)},f.actor&&f.actor.send("loadTile",x,M.bind(this),void 0,!0))},!0);f.request={cancel:D}}function M(D,B){return delete f.request,f.aborted?l(null):D&&404!==D.status?l(D):(B&&B.resourceTiming&&(f.resourceTiming=B.resourceTiming),this.map._refreshExpiredTiles&&B&&f.setExpiryData(B),f.loadVectorData(B,this.map.painter),C.cacheEntryPossiblyAdded(this.dispatcher),l(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id})}unloadTile(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:De,"raster-dem":class extends De{constructor(f,l,d,x){super(f,l,d,x),this.type="raster-dem",this.maxzoom=22,this._options=C.extend({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(f,l){const d=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function x(M,D){M&&(f.state="errored",l(M)),D&&(f.dem=D,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",l(null))}f.request=C.getImage(this.map._requestManager.transformRequest(d,C.ResourceType.Tile),function(M,D,B,G){if(delete f.request,f.aborted)f.state="unloaded",l(null);else if(M)f.state="errored",l(M);else if(D){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:B,expires:G});const W=C.window.ImageBitmap&&D instanceof C.window.ImageBitmap&&(null==Oe&&(Oe=C.window.OffscreenCanvas&&new C.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof C.window.createImageBitmap),Oe),Y=1-(D.width-C.prevPowerOfTwo(D.width))/2;Y<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const ee=W?D:C.exported.getImageData(D,Y),Q={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:ee,encoding:this.encoding,padding:Y};f.actor&&"expired"!==f.state||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",Q,x.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const l=f.canonical,d=Math.pow(2,l.z),x=(l.x-1+d)%d,M=0===l.x?f.wrap-1:f.wrap,D=(l.x+1+d)%d,B=l.x+1===d?f.wrap+1:f.wrap,G={};return G[new C.OverscaledTileID(f.overscaledZ,M,l.z,x,l.y).key]={backfilled:!1},G[new C.OverscaledTileID(f.overscaledZ,B,l.z,D,l.y).key]={backfilled:!1},l.y>0&&(G[new C.OverscaledTileID(f.overscaledZ,M,l.z,x,l.y-1).key]={backfilled:!1},G[new C.OverscaledTileID(f.overscaledZ,f.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},G[new C.OverscaledTileID(f.overscaledZ,B,l.z,D,l.y-1).key]={backfilled:!1}),l.y+1<d&&(G[new C.OverscaledTileID(f.overscaledZ,M,l.z,x,l.y+1).key]={backfilled:!1},G[new C.OverscaledTileID(f.overscaledZ,f.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},G[new C.OverscaledTileID(f.overscaledZ,B,l.z,D,l.y+1).key]={backfilled:!1}),G}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends C.Evented{constructor(f,l,d,x){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(x),this._data=l.data,this._options=C.extend({},l),this._collectResourceTiming=l.collectResourceTiming,void 0!==l.maxzoom&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const M=C.EXTENT/this.tileSize;this.workerOptions=C.extend({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(void 0!==l.buffer?l.buffer:128)*M,tolerance:(void 0!==l.tolerance?l.tolerance:.375)*M,extent:C.EXTENT,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:void 0!==l.clusterMaxZoom?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:C.EXTENT,radius:(void 0!==l.clusterRadius?l.clusterRadius:50)*M,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},l),this}getClusterChildren(f,l){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},l),this}getClusterLeaves(f,l,d,x){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:l,offset:d},x),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new C.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=C.extend({},this.workerOptions),l=this._data;"string"==typeof l?(f.request=this.map._requestManager.transformRequest(C.exported.resolveURL(l),C.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(d,x)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new C.ErrorEvent(d));else{const M={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(M.resourceTiming=x.resourceTiming[this.id]),this.fire(new C.Event("data",M)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,l){const d=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(d,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:C.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(x,M)=>(delete f.request,f.unloadVectorData(),f.aborted?l(null):x?l(x):(f.loadVectorData(M,this.map.painter,"reloadTile"===d),l(null))),void 0,"loadTile"===d)}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return C.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends se{constructor(f,l,d,x){super(f,l,d,x),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const l of f.urls)this.urls.push(this.map._requestManager.transformRequest(l,C.ResourceType.Source).url);C.getVideo(this.urls,(l,d)=>{this._loaded=!0,l?this.fire(new C.ErrorEvent(l)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const l=this.video.seekable;f<l.start(0)||f>l.end(0)?this.fire(new C.ErrorEvent(new C.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const f=this.map.painter.context,l=f.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,C.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=C.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new C.Texture(f,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));for(const d in this.tiles){const x=this.tiles[d];"loaded"!==x.state&&(x.state="loaded",x.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:se,canvas:class extends se{constructor(f,l,d,x){super(f,l,d,x),l.coordinates?Array.isArray(l.coordinates)&&4===l.coordinates.length&&!l.coordinates.some(M=>!Array.isArray(M)||2!==M.length||M.some(D=>"number"!=typeof D))||this.fire(new C.ErrorEvent(new C.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new C.ErrorEvent(new C.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),l.animate&&"boolean"!=typeof l.animate&&this.fire(new C.ErrorEvent(new C.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),l.canvas?"string"==typeof l.canvas||l.canvas instanceof C.window.HTMLCanvasElement||this.fire(new C.ErrorEvent(new C.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new C.ErrorEvent(new C.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=l,this.animate=void 0===l.animate||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof C.window.HTMLCanvasElement?this.options.canvas:C.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new C.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const l=this.map.painter.context,d=l.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,C.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=C.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new C.Texture(l,this.canvas,d.RGBA,{premultiply:!0});for(const x in this.tiles){const M=this.tiles[x];"loaded"!==M.state&&(M.state="loaded",M.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}}},oe=function(f,l,d,x){const M=new te[l.type](f,l,d,x);if(M.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${M.id}`);return C.bindAll(["load","abort","unload","serialize","prepare"],M),M};function me(f,l){const d=C.identity([]);return C.scale$1(d,d,[.5*f.width,.5*-f.height,1]),C.translate(d,d,[1,-1,0]),C.multiply(d,d,f.calculateProjMatrix(l.toUnwrapped()))}function ve(f,l,d,x,M,D,B,G=!1){const W=f.tilesIn(x,B,G);W.sort(Se);const Y=[];for(const Q of W)Y.push({wrappedTileID:Q.tile.tileID.wrapped().key,queryResults:Q.tile.queryRenderedFeatures(l,d,f._state,Q,M,D,me(f.transform,Q.tile.tileID),G)});const ee=function(Q){const le={},de={};for(const ge of Q){const xe=ge.queryResults,Te=ge.wrappedTileID,Ee=de[Te]=de[Te]||{};for(const Pe in xe){const Le=xe[Pe],Me=Ee[Pe]=Ee[Pe]||{},Ue=le[Pe]=le[Pe]||[];for(const Ye of Le)Me[Ye.featureIndex]||(Me[Ye.featureIndex]=!0,Ue.push(Ye))}}return le}(Y);for(const Q in ee)ee[Q].forEach(le=>{const de=le.feature,ge=f.getFeatureState(de.layer["source-layer"],de.id);de.source=de.layer.source,de.layer["source-layer"]&&(de.sourceLayer=de.layer["source-layer"]),de.state=ge});return ee}function pe(f,l){const d=f.getRenderableIds().map(D=>f.getTileByID(D)),x=[],M={};for(let D=0;D<d.length;D++){const B=d[D],G=B.tileID.canonical.key;M[G]||(M[G]=!0,B.querySourceFeatures(x,l))}return x}function Se(f,l){const d=f.tileID,x=l.tileID;return d.overscaledZ-x.overscaledZ||d.canonical.y-x.canonical.y||d.wrap-x.wrap||d.canonical.x-x.canonical.x}function He(){return null!=j.workerClass?new j.workerClass:new C.window.Worker(j.workerUrl)}const Ze="mapboxgl_preloaded_worker_pool";class Be{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<Be.workerCount;)this.workers.push(new He);return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],0===this.numActive()&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ze]}numActive(){return Object.keys(this.active).length}}let lt;function Rt(){return lt||(lt=new Be),lt}function xt(f,l){const d={};for(const x in f)"ref"!==x&&(d[x]=f[x]);return C.refProperties.forEach(x=>{x in l&&(d[x]=l[x])}),d}function Xt(f){f=f.slice();const l=Object.create(null);for(let d=0;d<f.length;d++)l[f[d].id]=f[d];for(let d=0;d<f.length;d++)"ref"in f[d]&&(f[d]=xt(f[d],l[f[d].ref]));return f}Be.workerCount=2;const mt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Je(f,l,d){d.push({command:mt.addSource,args:[f,l[f]]})}function ot(f,l,d){l.push({command:mt.removeSource,args:[f]}),d[f]=!0}function On(f,l,d,x){ot(f,d,x),Je(f,l,d)}function Bn(f,l,d){let x;for(x in f[d])if(f[d].hasOwnProperty(x)&&"data"!==x&&!it(f[d][x],l[d][x]))return!1;for(x in l[d])if(l[d].hasOwnProperty(x)&&"data"!==x&&!it(f[d][x],l[d][x]))return!1;return!0}function sn(f,l,d,x,M,D){let B;for(B in l=l||{},f=f||{})f.hasOwnProperty(B)&&(it(f[B],l[B])||d.push({command:D,args:[x,B,l[B],M]}));for(B in l)l.hasOwnProperty(B)&&!f.hasOwnProperty(B)&&(it(f[B],l[B])||d.push({command:D,args:[x,B,l[B],M]}))}function br(f){return f.id}function Ft(f,l){return f[l.id]=l,f}class mr{constructor(l,d){this.reset(l,d)}reset(l,d){this.points=l||[],this._distances=[0];for(let x=1;x<this.points.length;x++)this._distances[x]=this._distances[x-1]+this.points[x].dist(this.points[x-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(1===this.points.length)return this.points[0];l=C.clamp(l,0,1);let d=1,x=this._distances[d];const M=l*this.paddedLength+this.padding;for(;x<M&&d<this._distances.length;)x=this._distances[++d];const D=d-1,B=this._distances[D],G=x-B,W=G>0?(M-B)/G:0;return this.points[D].mult(1-W).add(this.points[d].mult(W))}}class or{constructor(l,d,x){const M=this.boxCells=[],D=this.circleCells=[];this.xCellCount=Math.ceil(l/x),this.yCellCount=Math.ceil(d/x);for(let B=0;B<this.xCellCount*this.yCellCount;B++)M.push([]),D.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=d,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,d,x,M,D){this._forEachCell(d,x,M,D,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(d),this.bboxes.push(x),this.bboxes.push(M),this.bboxes.push(D)}insertCircle(l,d,x,M){this._forEachCell(d-M,x-M,d+M,x+M,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(d),this.circles.push(x),this.circles.push(M)}_insertBoxCell(l,d,x,M,D,B){this.boxCells[D].push(B)}_insertCircleCell(l,d,x,M,D,B){this.circleCells[D].push(B)}_query(l,d,x,M,D,B){if(x<0||l>this.width||M<0||d>this.height)return!D&&[];const G=[];if(l<=0&&d<=0&&this.width<=x&&this.height<=M){if(D)return!0;for(let W=0;W<this.boxKeys.length;W++)G.push({key:this.boxKeys[W],x1:this.bboxes[4*W],y1:this.bboxes[4*W+1],x2:this.bboxes[4*W+2],y2:this.bboxes[4*W+3]});for(let W=0;W<this.circleKeys.length;W++){const Y=this.circles[3*W],ee=this.circles[3*W+1],Q=this.circles[3*W+2];G.push({key:this.circleKeys[W],x1:Y-Q,y1:ee-Q,x2:Y+Q,y2:ee+Q})}return B?G.filter(B):G}return this._forEachCell(l,d,x,M,this._queryCell,G,{hitTest:D,seenUids:{box:{},circle:{}}},B),D?G.length>0:G}_queryCircle(l,d,x,M,D){const B=l-x,G=l+x,W=d-x,Y=d+x;if(G<0||B>this.width||Y<0||W>this.height)return!M&&[];const ee=[];return this._forEachCell(B,W,G,Y,this._queryCellCircle,ee,{hitTest:M,circle:{x:l,y:d,radius:x},seenUids:{box:{},circle:{}}},D),M?ee.length>0:ee}query(l,d,x,M,D){return this._query(l,d,x,M,!1,D)}hitTest(l,d,x,M,D){return this._query(l,d,x,M,!0,D)}hitTestCircle(l,d,x,M){return this._queryCircle(l,d,x,!0,M)}_queryCell(l,d,x,M,D,B,G,W){const Y=G.seenUids,ee=this.boxCells[D];if(null!==ee){const le=this.bboxes;for(const de of ee)if(!Y.box[de]){Y.box[de]=!0;const ge=4*de;if(l<=le[ge+2]&&d<=le[ge+3]&&x>=le[ge+0]&&M>=le[ge+1]&&(!W||W(this.boxKeys[de]))){if(G.hitTest)return B.push(!0),!0;B.push({key:this.boxKeys[de],x1:le[ge],y1:le[ge+1],x2:le[ge+2],y2:le[ge+3]})}}}const Q=this.circleCells[D];if(null!==Q){const le=this.circles;for(const de of Q)if(!Y.circle[de]){Y.circle[de]=!0;const ge=3*de;if(this._circleAndRectCollide(le[ge],le[ge+1],le[ge+2],l,d,x,M)&&(!W||W(this.circleKeys[de]))){if(G.hitTest)return B.push(!0),!0;{const xe=le[ge],Te=le[ge+1],Ee=le[ge+2];B.push({key:this.circleKeys[de],x1:xe-Ee,y1:Te-Ee,x2:xe+Ee,y2:Te+Ee})}}}}}_queryCellCircle(l,d,x,M,D,B,G,W){const Y=G.circle,ee=G.seenUids,Q=this.boxCells[D];if(null!==Q){const de=this.bboxes;for(const ge of Q)if(!ee.box[ge]){ee.box[ge]=!0;const xe=4*ge;if(this._circleAndRectCollide(Y.x,Y.y,Y.radius,de[xe+0],de[xe+1],de[xe+2],de[xe+3])&&(!W||W(this.boxKeys[ge])))return B.push(!0),!0}}const le=this.circleCells[D];if(null!==le){const de=this.circles;for(const ge of le)if(!ee.circle[ge]){ee.circle[ge]=!0;const xe=3*ge;if(this._circlesCollide(de[xe],de[xe+1],de[xe+2],Y.x,Y.y,Y.radius)&&(!W||W(this.circleKeys[ge])))return B.push(!0),!0}}}_forEachCell(l,d,x,M,D,B,G,W){const Y=this._convertToXCellCoord(l),ee=this._convertToYCellCoord(d),Q=this._convertToXCellCoord(x),le=this._convertToYCellCoord(M);for(let de=Y;de<=Q;de++)for(let ge=ee;ge<=le;ge++)if(D.call(this,l,d,x,M,this.xCellCount*ge+de,B,G,W))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,d,x,M,D,B){const G=M-l,W=D-d,Y=x+B;return Y*Y>G*G+W*W}_circleAndRectCollide(l,d,x,M,D,B,G){const W=(B-M)/2,Y=Math.abs(l-(M+W));if(Y>W+x)return!1;const ee=(G-D)/2,Q=Math.abs(d-(D+ee));if(Q>ee+x)return!1;if(Y<=W||Q<=ee)return!0;const le=Y-W,de=Q-ee;return le*le+de*de<=x*x}}const qt=Math.tan(85*Math.PI/180);function ur(f,l,d,x,M){const D=C.create$1();if(l){const B=_t([],M);D[0]=B[0],D[1]=B[1],D[4]=B[2],D[5]=B[3],d||C.rotateZ(D,D,x.angle)}else C.multiply(D,x.labelPlaneMatrix,f);return D}function wn(f,l,d,x,M){if(l){const D=C.clone$1(f),B=C.identity([]);return B[0]=M[0],B[1]=M[1],B[4]=M[2],B[5]=M[3],C.multiply(D,D,B),d||C.rotateZ(D,D,-x.angle),D}return x.glCoordMatrix}function ri(f,l,d=0){const x=[f.x,f.y,d,1];d?C.transformMat4(x,x,l):xl(x,x,l);const M=x[3];return{point:new C.pointGeometry(x[0]/M,x[1]/M),signedDistanceFromCamera:M}}function Yr(f,l){return Math.min(.5+f/l*.5,1.5)}function lr(f,l){const d=f[0]/f[3],x=f[1]/f[3];return d>=-l[0]&&d<=l[0]&&x>=-l[1]&&x<=l[1]}function ni(f,l,d,x,M,D,B,G,W){const Y=x?f.textSizeData:f.iconSizeData,ee=C.evaluateSizeForZoom(Y,d.transform.zoom),Q=[256/d.width*2+1,256/d.height*2+1],le=x?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;le.clear();const de=f.lineVertexArray,ge=x?f.text.placedSymbolArray:f.icon.placedSymbolArray,xe=d.transform.width/d.transform.height;let Te=!1;for(let Ee=0;Ee<ge.length;Ee++){const Pe=ge.get(Ee);if(Pe.writingMode!==C.WritingMode.vertical||Te||0!==Ee&&ge.get(Ee-1).writingMode===C.WritingMode.horizontal||(Te=!0),Pe.hidden||Pe.writingMode===C.WritingMode.vertical&&!Te){Fr(Pe.numGlyphs,le);continue}Te=!1;const Le=new C.pointGeometry(Pe.tileAnchorX,Pe.tileAnchorY),Me=W?W(Le):0,Ue=[Le.x,Le.y,Me],Ye=[...Ue,1];if(C.transformMat4(Ye,Ye,l),!lr(Ye,Q)){Fr(Pe.numGlyphs,le);continue}const yt=Yr(d.transform.cameraToCenterDistance,Ye[3]),gt=C.evaluateSizeForFeature(Y,ee,Pe),Ot=B?gt/yt:gt*yt,dt=ri(new C.pointGeometry(Ue[0],Ue[1]),M,Ue[2]);if(dt.signedDistanceFromCamera<=0){Fr(Pe.numGlyphs,le);continue}let Nt={};const wt=B?null:W,Zt=Ro(Pe,Ot,!1,G,l,M,D,f.glyphOffsetArray,de,le,dt.point,Le,Nt,xe,wt);Te=Zt.useVertical,wt&&Zt.needsFlipping&&(Nt={}),(Zt.notEnoughRoom||Te||Zt.needsFlipping&&Ro(Pe,Ot,!0,G,l,M,D,f.glyphOffsetArray,de,le,dt.point,Le,Nt,xe,wt).notEnoughRoom)&&Fr(Pe.numGlyphs,le)}x?f.text.dynamicLayoutVertexBuffer.updateData(le):f.icon.dynamicLayoutVertexBuffer.updateData(le)}function Kr(f,l,d,x,M,D,B,G,W,Y,ee,Q,le){const de=G.glyphStartIndex+G.numGlyphs,ge=G.lineStartIndex,xe=G.lineStartIndex+G.lineLength,Te=l.getoffsetX(G.glyphStartIndex),Ee=l.getoffsetX(de-1),Pe=js(f*Te,d,x,M,D,B,G.segment,ge,xe,W,Y,ee,Q,le,!0);if(!Pe)return null;const Le=js(f*Ee,d,x,M,D,B,G.segment,ge,xe,W,Y,ee,Q,le,!0);return Le?{first:Pe,last:Le}:null}function yo(f,l,d,x){return f.writingMode===C.WritingMode.horizontal&&Math.abs(d.y-l.y)>Math.abs(d.x-l.x)*x?{useVertical:!0}:f.writingMode===C.WritingMode.vertical?l.y<d.y?{needsFlipping:!0}:null:0!==f.flipState&&function(M,D,B){const G=(D.x-M.x)*B;return 0===G||Math.abs((D.y-M.y)/G)>qt}(l,d,x)?1===f.flipState?{needsFlipping:!0}:null:l.x>d.x?{needsFlipping:!0}:null}function Ro(f,l,d,x,M,D,B,G,W,Y,ee,Q,le,de,ge){const xe=l/24,Te=f.lineOffsetX*xe,Ee=f.lineOffsetY*xe;let Pe;if(f.numGlyphs>1){const Le=f.glyphStartIndex+f.numGlyphs,Me=f.lineStartIndex,Ue=f.lineStartIndex+f.lineLength,Ye=Kr(xe,G,Te,Ee,d,ee,Q,f,W,D,le,ge,!1);if(!Ye)return{notEnoughRoom:!0};const yt=ri(Ye.first.point,B).point,gt=ri(Ye.last.point,B).point;if(x&&!d){const Ot=yo(f,yt,gt,de);if(f.flipState=Ot&&Ot.needsFlipping?1:2,Ot)return Ot}Pe=[Ye.first];for(let Ot=f.glyphStartIndex+1;Ot<Le-1;Ot++)Pe.push(js(xe*G.getoffsetX(Ot),Te,Ee,d,ee,Q,f.segment,Me,Ue,W,D,le,ge,!1,!1));Pe.push(Ye.last)}else{if(x&&!d){const Me=ri(Q,M).point,Ue=f.lineStartIndex+f.segment+1,Ye=new C.pointGeometry(W.getx(Ue),W.gety(Ue)),yt=ri(Ye,M),gt=yo(f,Me,yt.signedDistanceFromCamera>0?yt.point:fi(Q,Ye,Me,1,M,void 0),de);if(f.flipState=gt&&gt.needsFlipping?1:2,gt)return gt}const Le=js(xe*G.getoffsetX(f.glyphStartIndex),Te,Ee,d,ee,Q,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,W,D,le,ge,!1,!1);if(!Le)return{notEnoughRoom:!0};Pe=[Le]}for(const Le of Pe)C.addDynamicAttributes(Y,Le.point,Le.angle);return{}}function gi(f,l,d){const x={x:f.x,y:f.y,z:0};if(!d)return ri(x,l,x.z);const M=d(f);return ri(new C.pointGeometry(x.x,x.y),l,x.z+M)}function fi(f,l,d,x,M,D){const B=gi(f.add(f.sub(l)._unit()),M,D).point,G=d.sub(B);return d.add(G._mult(x/G.mag()))}function js(f,l,d,x,M,D,B,G,W,Y,ee,Q,le,de,ge){const xe=x?f-l:f+l;let Te=xe>0?1:-1,Ee=0;x&&(Te*=-1,Ee=Math.PI),Te<0&&(Ee+=Math.PI);let Pe=Te>0?G+B:G+B+1,Le=M,Me=M,Ue=0,Ye=0;const yt=Math.abs(xe),gt=[],Ot=[];let dt=D;const Nt=()=>{const mn=Pe-Te;return 0===Ue?D:new C.pointGeometry(Y.getx(mn),Y.gety(mn))},wt=()=>fi(Nt(),dt,Me,yt-Ue+1,ee,le);for(;Ue+Ye<=yt;){if(Pe+=Te,Pe<G||Pe>=W)return null;if(Me=Le,gt.push(Le),de&&Ot.push(dt||Nt()),Le=Q[Pe],void 0===Le){dt=new C.pointGeometry(Y.getx(Pe),Y.gety(Pe));const mn=gi(dt,ee,le);Le=mn.signedDistanceFromCamera>0?Q[Pe]=mn.point:wt()}else dt=null;Ue+=Ye,Ye=Me.dist(Le)}ge&&le&&(dt=dt||new C.pointGeometry(Y.getx(Pe),Y.gety(Pe)),Q[Pe]=Le=void 0===Q[Pe]?Le:wt(),Ye=Me.dist(Le));const Zt=(yt-Ue)/Ye,ft=Le.sub(Me),Gt=ft.mult(Zt)._add(Me);d&&Gt._add(ft._unit()._perp()._mult(d*Te));const Qt=Ee+Math.atan2(Le.y-Me.y,Le.x-Me.x);return gt.push(Gt),de&&(dt=dt||new C.pointGeometry(Y.getx(Pe),Y.gety(Pe)),Ot.push(function(mn,Hn,gr){const wr=1-gr;return new C.pointGeometry(mn.x*wr+Hn.x*gr,mn.y*wr+Hn.y*gr)}(Ot.length>0?Ot[Ot.length-1]:dt,dt,Zt))),{point:Gt,angle:Qt,path:gt,tilePath:Ot}}const Ya=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Fr(f,l){for(let d=0;d<f;d++){const x=l.length;l.resize(x+4),l.float32.set(Ya,3*x)}}function xl(f,l,d){const x=l[0],M=l[1];return f[0]=d[0]*x+d[4]*M+d[12],f[1]=d[1]*x+d[5]*M+d[13],f[3]=d[3]*x+d[7]*M+d[15],f}const Oi=100;class Mn{constructor(l,d,x=new or(l.width+200,l.height+200,25),M=new or(l.width+200,l.height+200,25)){this.transform=l,this.grid=x,this.ignoredGrid=M,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Oi,this.screenBottomBoundary=l.height+Oi,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=d}placeCollisionBox(l,d,x,M,D,B,G){let W=d.projectedAnchorZ;d.elevation&&(W+=d.elevation);const Y=this.projectAndGetPerspectiveRatio(B,d.projectedAnchorX,d.projectedAnchorY,W,d.tileID),ee=D*Y.perspectiveRatio,Q=(d.x1*l+x.x-d.padding)*ee+Y.point.x,le=(d.y1*l+x.y-d.padding)*ee+Y.point.y,de=(d.x2*l+x.x+d.padding)*ee+Y.point.x,ge=(d.y2*l+x.y+d.padding)*ee+Y.point.y,xe=Y.perspectiveRatio<=.55||Y.aboveHorizon;return!this.isInsideGrid(Q,le,de,ge)||!M&&this.grid.hitTest(Q,le,de,ge,G)||xe?{box:[],offscreen:!1}:{box:[Q,le,de,ge],offscreen:this.isOffscreen(Q,le,de,ge)}}placeCollisionCircles(l,d,x,M,D,B,G,W,Y,ee,Q,le,de,ge){const xe=[],Te=this.transform.elevation,Ee=Te?wt=>Te.getAtTileOffset(ge,wt.x,wt.y):wt=>0,Pe=new C.pointGeometry(d.tileAnchorX,d.tileAnchorY),Le=Ee(Pe),Me=this.projectAndGetPerspectiveRatio(B,Pe.x,Pe.y,Le,ge),{perspectiveRatio:Ue}=Me,Ye=(ee?D/Ue:D*Ue)/C.ONE_EM,yt=ri(Pe,G,Le).point,gt=Me.signedDistanceFromCamera>0?Kr(Ye,M,d.lineOffsetX*Ye,d.lineOffsetY*Ye,!1,yt,Pe,d,x,G,{},Te&&!ee?Ee:null,ee&&!!Te):null;let Ot=!1,dt=!1,Nt=!0;if(gt&&!Me.aboveHorizon){const wt=.5*le*Ue+de,Zt=new C.pointGeometry(-100,-100),ft=new C.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Gt=new mr,Qt=gt.first,mn=gt.last;let Hn=[];for(let tr=Qt.path.length-1;tr>=1;tr--)Hn.push(Qt.path[tr]);for(let tr=1;tr<mn.path.length;tr++)Hn.push(mn.path[tr]);const gr=2.5*wt;if(W){const tr=Hn.map(Te?(Cr,Wr)=>{const Zi=Ee(Wr<Qt.path.length-1?Qt.tilePath[Qt.path.length-1-Wr]:mn.tilePath[Wr-Qt.path.length+2]);return ri(Cr,W,Zi)}:Cr=>ri(Cr,W));Hn=tr.some(Cr=>Cr.signedDistanceFromCamera<=0)?[]:tr.map(Cr=>Cr.point)}let wr=[];if(Hn.length>0){const tr=Hn[0].clone(),Cr=Hn[0].clone();for(let Wr=1;Wr<Hn.length;Wr++)tr.x=Math.min(tr.x,Hn[Wr].x),tr.y=Math.min(tr.y,Hn[Wr].y),Cr.x=Math.max(Cr.x,Hn[Wr].x),Cr.y=Math.max(Cr.y,Hn[Wr].y);wr=tr.x>=Zt.x&&Cr.x<=ft.x&&tr.y>=Zt.y&&Cr.y<=ft.y?[Hn]:Cr.x<Zt.x||tr.x>ft.x||Cr.y<Zt.y||tr.y>ft.y?[]:C.clipLine([Hn],Zt.x,Zt.y,ft.x,ft.y)}for(const tr of wr){Gt.reset(tr,.25*wt);let Cr=0;Cr=Gt.length<=.5*wt?1:Math.ceil(Gt.paddedLength/gr)+1;for(let Wr=0;Wr<Cr;Wr++){const Zi=Wr/Math.max(Cr-1,1),ha=Gt.lerp(Zi),Do=ha.x+Oi,xo=ha.y+Oi;xe.push(Do,xo,wt,0);const Ko=Do-wt,va=xo-wt,Tu=Do+wt,O=xo+wt;if(Nt=Nt&&this.isOffscreen(Ko,va,Tu,O),dt=dt||this.isInsideGrid(Ko,va,Tu,O),!l&&this.grid.hitTestCircle(Do,xo,wt,Q)&&(Ot=!0,!Y))return{circles:[],offscreen:!1,collisionDetected:Ot}}}}return{circles:!Y&&Ot||!dt?[]:xe,offscreen:Nt,collisionDetected:Ot}}queryRenderedSymbols(l){if(0===l.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const d=[];let x=1/0,M=1/0,D=-1/0,B=-1/0;for(const ee of l){const Q=new C.pointGeometry(ee.x+Oi,ee.y+Oi);x=Math.min(x,Q.x),M=Math.min(M,Q.y),D=Math.max(D,Q.x),B=Math.max(B,Q.y),d.push(Q)}const G=this.grid.query(x,M,D,B).concat(this.ignoredGrid.query(x,M,D,B)),W={},Y={};for(const ee of G){const Q=ee.key;if(void 0===W[Q.bucketInstanceId]&&(W[Q.bucketInstanceId]={}),W[Q.bucketInstanceId][Q.featureIndex])continue;const le=[new C.pointGeometry(ee.x1,ee.y1),new C.pointGeometry(ee.x2,ee.y1),new C.pointGeometry(ee.x2,ee.y2),new C.pointGeometry(ee.x1,ee.y2)];C.polygonIntersectsPolygon(d,le)&&(W[Q.bucketInstanceId][Q.featureIndex]=!0,void 0===Y[Q.bucketInstanceId]&&(Y[Q.bucketInstanceId]=[]),Y[Q.bucketInstanceId].push(Q.featureIndex))}return Y}insertCollisionBox(l,d,x,M,D){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:x,featureIndex:M,collisionGroupID:D},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,d,x,M,D){const B=d?this.ignoredGrid:this.grid,G={bucketInstanceId:x,featureIndex:M,collisionGroupID:D};for(let W=0;W<l.length;W+=4)B.insertCircle(G,l[W],l[W+1],l[W+2])}projectAndGetPerspectiveRatio(l,d,x,M,D){const B=[d,x,M||0,1];let G=!1;if(M||this.transform.pitch>0){C.transformMat4(B,B,l);let W=!1;this.fogState&&D&&(W=function(Y,ee,Q,le,de,ge){const xe=ge.calculateFogTileMatrix(de),Te=[ee,Q,le];return C.transformMat4$1(Te,Te,xe),Es(Y,Te,ge.pitch,ge._fov)}(this.fogState,d,x,M||0,D.toUnwrapped(),this.transform)>.9),G=B[2]>B[3]||W}else xl(B,B,l);return{point:new C.pointGeometry((B[0]/B[3]+1)/2*this.transform.width+Oi,(-B[1]/B[3]+1)/2*this.transform.height+Oi),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/B[3]*.5,1.5),signedDistanceFromCamera:B[3],aboveHorizon:G}}isOffscreen(l,d,x,M){return x<Oi||l>=this.screenRightBoundary||M<Oi||d>this.screenBottomBoundary}isInsideGrid(l,d,x,M){return x>=0&&l<this.gridRightBoundary&&M>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const l=C.identity([]);return C.translate(l,l,[-100,-100,0]),l}}class Ai{constructor(l,d,x,M){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?d:-d))):M&&x?1:0,this.placed=x}isHidden(){return 0===this.opacity&&!this.placed}}class ls{constructor(l,d,x,M,D,B=!1){this.text=new Ai(l?l.text:null,d,x,D),this.icon=new Ai(l?l.icon:null,d,M,D),this.clipped=B}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ga{constructor(l,d,x,M=!1){this.text=l,this.icon=d,this.skipFade=x,this.clipped=M}}class $o{constructor(){this.invProjMatrix=C.create$1(),this.viewportMatrix=C.create$1(),this.circles=[]}}class Ts{constructor(l,d,x,M,D){this.bucketInstanceId=l,this.featureIndex=d,this.sourceLayerIndex=x,this.bucketIndex=M,this.tileID=D}}class Ka{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const d=++this.maxGroupID;this.collisionGroups[l]={ID:d,predicate:x=>x.collisionGroupID===d}}return this.collisionGroups[l]}}function xi(f,l,d,x,M){const{horizontalAlign:D,verticalAlign:B}=C.getAnchorAlignment(f),G=-(D-.5)*l,W=-(B-.5)*d,Y=C.evaluateVariableOffset(f,x);return new C.pointGeometry(G+Y[0]*M,W+Y[1]*M)}function ua(f,l,d,x,M){const D=new C.pointGeometry(f,l);return d&&D._rotate(x?M:-M),D}class no{constructor(l,d,x,M,D){this.transform=l.clone(),this.collisionIndex=new Mn(this.transform,D),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Ka(x),this.collisionCircleArrays={},this.prevPlacement=M,M&&(M.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,d,x,M){const D=x.getBucket(d),B=x.latestFeatureIndex;if(!D||!B||d.id!==D.layerIds[0])return;const G=D.layers[0].layout,W=x.collisionBoxArray,Y=Math.pow(2,this.transform.zoom-x.tileID.overscaledZ),ee=x.tileSize/C.EXTENT,Q=x.tileID.toUnwrapped(),le=this.transform.calculateProjMatrix(Q),de="map"===G.get("text-pitch-alignment"),ge="map"===G.get("text-rotation-alignment");d.compileFilter();const xe=d.dynamicFilter(),Te=d.dynamicFilterNeedsFeature(),Ee=this.transform.calculatePixelsToTileUnitsMatrix(x),Pe=ur(le,de,ge,this.transform,Ee);let Le=null;if(de){const Ye=wn(le,de,ge,this.transform,Ee);Le=C.multiply([],this.transform.labelPlaneMatrix,Ye)}let Me=null;xe&&x.latestFeatureIndex&&(Me={unwrappedTileID:Q,dynamicFilter:xe,dynamicFilterNeedsFeature:Te,featureIndex:x.latestFeatureIndex}),this.retainedQueryData[D.bucketInstanceId]=new Ts(D.bucketInstanceId,B,D.sourceLayerIndex,D.index,x.tileID);const Ue={bucket:D,layout:G,posMatrix:le,textLabelPlaneMatrix:Pe,labelToScreenMatrix:Le,clippingData:Me,scale:Y,textPixelRatio:ee,holdingForFade:x.holdingForFade(),collisionBoxArray:W,partiallyEvaluatedTextSize:C.evaluateSizeForZoom(D.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:C.evaluateSizeForZoom(D.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(D.sourceID)};if(M)for(const Ye of D.sortKeyRanges){const{sortKey:yt,symbolInstanceStart:gt,symbolInstanceEnd:Ot}=Ye;l.push({sortKey:yt,symbolInstanceStart:gt,symbolInstanceEnd:Ot,parameters:Ue})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:D.symbolInstances.length,parameters:Ue})}attemptAnchorPlacement(l,d,x,M,D,B,G,W,Y,ee,Q,le,de,ge,xe,Te,Ee,Pe){const Le=[le.textOffset0,le.textOffset1],Me=xi(l,x,M,Le,D),Ue=this.collisionIndex.placeCollisionBox(D,d,ua(Me.x,Me.y,B,G,this.transform.angle),Q,W,Y,ee.predicate);if((!Te||0!==this.collisionIndex.placeCollisionBox(ge.getSymbolInstanceIconSize(Pe,this.transform.zoom,de),Te,ua(Me.x,Me.y,B,G,this.transform.angle),Q,W,Y,ee.predicate).box.length)&&Ue.box.length>0){let Ye;return this.prevPlacement&&this.prevPlacement.variableOffsets[le.crossTileID]&&this.prevPlacement.placements[le.crossTileID]&&this.prevPlacement.placements[le.crossTileID].text&&(Ye=this.prevPlacement.variableOffsets[le.crossTileID].anchor),this.variableOffsets[le.crossTileID]={textOffset:Le,width:x,height:M,anchor:l,textScale:D,prevAnchor:Ye},this.markUsedJustification(ge,l,le,xe),ge.allowVerticalPlacement&&(this.markUsedOrientation(ge,xe,le),this.placedOrientations[le.crossTileID]=xe),{shift:Me,placedGlyphBoxes:Ue}}}placeLayerBucketPart(l,d,x,M){const{bucket:D,layout:B,posMatrix:G,textLabelPlaneMatrix:W,labelToScreenMatrix:Y,clippingData:ee,textPixelRatio:Q,holdingForFade:le,collisionBoxArray:de,partiallyEvaluatedTextSize:ge,partiallyEvaluatedIconSize:xe,collisionGroup:Te}=l.parameters,Ee=B.get("text-optional"),Pe=B.get("icon-optional"),Le=B.get("text-allow-overlap"),Me=B.get("icon-allow-overlap"),Ue="map"===B.get("text-rotation-alignment"),Ye="map"===B.get("text-pitch-alignment"),yt="none"!==B.get("icon-text-fit"),gt="viewport-y"===B.get("symbol-z-order"),Ot=Le&&(Me||!D.hasIconData()||Pe),dt=Me&&(Le||!D.hasTextData()||Ee);!D.collisionArrays&&de&&D.deserializeCollisionBoxes(de),x&&M&&D.updateCollisionDebugBuffers(this.transform.zoom,de);const Nt=(wt,Zt,ft)=>{if(ee){const O={zoom:this.transform.zoom,pitch:this.transform.pitch};let P=null;if(ee.dynamicFilterNeedsFeature){const z=this.retainedQueryData[D.bucketInstanceId];P=ee.featureIndex.loadFeature({featureIndex:wt.featureIndex,bucketIndex:z.bucketIndex,sourceLayerIndex:z.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,ee.dynamicFilter)(O,P,this.retainedQueryData[D.bucketInstanceId].tileID.canonical,new C.pointGeometry(wt.tileAnchorX,wt.tileAnchorY),this.transform.calculateDistanceTileData(ee.unwrappedTileID)))return this.placements[wt.crossTileID]=new ga(!1,!1,!1,!0),void(d[wt.crossTileID]=!0)}if(d[wt.crossTileID])return;if(le)return void(this.placements[wt.crossTileID]=new ga(!1,!1,!1));let Gt=!1,Qt=!1,mn=!0,Hn=null,gr={box:null,offscreen:null},wr={box:null,offscreen:null},tr=null,Cr=null,Wr=null,Zi=0,ha=0,Do=0;ft.textFeatureIndex?Zi=ft.textFeatureIndex:wt.useRuntimeCollisionCircles&&(Zi=wt.featureIndex),ft.verticalTextFeatureIndex&&(ha=ft.verticalTextFeatureIndex);const xo=O=>{O.tileID=this.retainedQueryData[D.bucketInstanceId].tileID,(this.transform.elevation||O.elevation)&&(O.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[D.bucketInstanceId].tileID,O.tileAnchorX,O.tileAnchorY):0)},Ko=ft.textBox;if(Ko){xo(Ko);const O=z=>{let K=C.WritingMode.horizontal;if(D.allowVerticalPlacement&&!z&&this.prevPlacement){const he=this.prevPlacement.placedOrientations[wt.crossTileID];he&&(this.placedOrientations[wt.crossTileID]=he,K=he,this.markUsedOrientation(D,K,wt))}return K},P=(z,K)=>{if(D.allowVerticalPlacement&&wt.numVerticalGlyphVertices>0&&ft.verticalTextBox){for(const he of D.writingModes)if(he===C.WritingMode.vertical?(gr=K(),wr=gr):gr=z(),gr&&gr.box&&gr.box.length)break}else gr=z()};if(B.get("text-variable-anchor")){let z=B.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[wt.crossTileID]){const fe=this.prevPlacement.variableOffsets[wt.crossTileID];z.indexOf(fe.anchor)>0&&(z=z.filter(Ie=>Ie!==fe.anchor),z.unshift(fe.anchor))}const K=(fe,Ie,Fe)=>{const at=D.getSymbolInstanceTextSize(ge,wt,this.transform.zoom,Zt),nt=(fe.x2-fe.x1)*at+2*fe.padding,jt=(fe.y2-fe.y1)*at+2*fe.padding,Pt=yt&&!Me?Ie:null;Pt&&xo(Pt);let cn={box:[],offscreen:!1};const Sn=Le?2*z.length:z.length;for(let ar=0;ar<Sn;++ar){const xn=this.attemptAnchorPlacement(z[ar%z.length],fe,nt,jt,at,Ue,Ye,Q,G,Te,ar>=z.length,wt,Zt,D,Fe,Pt,ge,xe);if(xn&&(cn=xn.placedGlyphBoxes,cn&&cn.box&&cn.box.length)){Gt=!0,Hn=xn.shift;break}}return cn};P(()=>K(Ko,ft.iconBox,C.WritingMode.horizontal),()=>{const fe=ft.verticalTextBox;return fe&&xo(fe),D.allowVerticalPlacement&&!(gr&&gr.box&&gr.box.length)&&wt.numVerticalGlyphVertices>0&&fe?K(fe,ft.verticalIconBox,C.WritingMode.vertical):{box:null,offscreen:null}}),gr&&(Gt=gr.box,mn=gr.offscreen);const he=O(gr&&gr.box);if(!Gt&&this.prevPlacement){const fe=this.prevPlacement.variableOffsets[wt.crossTileID];fe&&(this.variableOffsets[wt.crossTileID]=fe,this.markUsedJustification(D,fe.anchor,wt,he))}}else{const z=(K,he)=>{const fe=D.getSymbolInstanceTextSize(ge,wt,this.transform.zoom,Zt),Ie=this.collisionIndex.placeCollisionBox(fe,K,new C.pointGeometry(0,0),Le,Q,G,Te.predicate);return Ie&&Ie.box&&Ie.box.length&&(this.markUsedOrientation(D,he,wt),this.placedOrientations[wt.crossTileID]=he),Ie};P(()=>z(Ko,C.WritingMode.horizontal),()=>{const K=ft.verticalTextBox;return D.allowVerticalPlacement&&wt.numVerticalGlyphVertices>0&&K?(xo(K),z(K,C.WritingMode.vertical)):{box:null,offscreen:null}}),O(gr&&gr.box&&gr.box.length)}}if(tr=gr,Gt=tr&&tr.box&&tr.box.length>0,mn=tr&&tr.offscreen,wt.useRuntimeCollisionCircles){const O=D.text.placedSymbolArray.get(wt.centerJustifiedTextSymbolIndex>=0?wt.centerJustifiedTextSymbolIndex:wt.verticalPlacedTextSymbolIndex),P=C.evaluateSizeForFeature(D.textSizeData,ge,O),z=B.get("text-padding");Cr=this.collisionIndex.placeCollisionCircles(Le,O,D.lineVertexArray,D.glyphOffsetArray,P,G,W,Y,x,Ye,Te.predicate,wt.collisionCircleDiameter*P/C.ONE_EM,z,this.retainedQueryData[D.bucketInstanceId].tileID),Gt=Le||Cr.circles.length>0&&!Cr.collisionDetected,mn=mn&&Cr.offscreen}if(ft.iconFeatureIndex&&(Do=ft.iconFeatureIndex),ft.iconBox){const O=P=>{xo(P);const z=yt&&Hn?ua(Hn.x,Hn.y,Ue,Ye,this.transform.angle):new C.pointGeometry(0,0),K=D.getSymbolInstanceIconSize(xe,this.transform.zoom,Zt);return this.collisionIndex.placeCollisionBox(K,P,z,Me,Q,G,Te.predicate)};wr&&wr.box&&wr.box.length&&ft.verticalIconBox?(Wr=O(ft.verticalIconBox),Qt=Wr.box.length>0):(Wr=O(ft.iconBox),Qt=Wr.box.length>0),mn=mn&&Wr.offscreen}const va=Ee||0===wt.numHorizontalGlyphVertices&&0===wt.numVerticalGlyphVertices,Tu=Pe||0===wt.numIconVertices;if(va||Tu?Tu?va||(Qt=Qt&&Gt):Gt=Qt&&Gt:Qt=Gt=Qt&&Gt,Gt&&tr&&tr.box&&this.collisionIndex.insertCollisionBox(tr.box,B.get("text-ignore-placement"),D.bucketInstanceId,wr&&wr.box&&ha?ha:Zi,Te.ID),Qt&&Wr&&this.collisionIndex.insertCollisionBox(Wr.box,B.get("icon-ignore-placement"),D.bucketInstanceId,Do,Te.ID),Cr&&(Gt&&this.collisionIndex.insertCollisionCircles(Cr.circles,B.get("text-ignore-placement"),D.bucketInstanceId,Zi,Te.ID),x)){const O=D.bucketInstanceId;let P=this.collisionCircleArrays[O];void 0===P&&(P=this.collisionCircleArrays[O]=new $o);for(let z=0;z<Cr.circles.length;z+=4)P.circles.push(Cr.circles[z+0]),P.circles.push(Cr.circles[z+1]),P.circles.push(Cr.circles[z+2]),P.circles.push(Cr.collisionDetected?1:0)}this.placements[wt.crossTileID]=new ga(Gt||Ot,Qt||dt,mn||D.justReloaded),d[wt.crossTileID]=!0};if(gt){const wt=D.getSortedSymbolIndexes(this.transform.angle);for(let Zt=wt.length-1;Zt>=0;--Zt){const ft=wt[Zt];Nt(D.symbolInstances.get(ft),ft,D.collisionArrays[ft])}}else for(let wt=l.symbolInstanceStart;wt<l.symbolInstanceEnd;wt++)Nt(D.symbolInstances.get(wt),wt,D.collisionArrays[wt]);if(x&&D.bucketInstanceId in this.collisionCircleArrays){const wt=this.collisionCircleArrays[D.bucketInstanceId];C.invert(wt.invProjMatrix,G),wt.viewportMatrix=this.collisionIndex.getViewportMatrix()}D.justReloaded=!1}markUsedJustification(l,d,x,M){let D;D=M===C.WritingMode.vertical?x.verticalPlacedTextSymbolIndex:{left:x.leftJustifiedTextSymbolIndex,center:x.centerJustifiedTextSymbolIndex,right:x.rightJustifiedTextSymbolIndex}[C.getAnchorJustification(d)];const B=[x.leftJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.rightJustifiedTextSymbolIndex,x.verticalPlacedTextSymbolIndex];for(const G of B)G>=0&&(l.text.placedSymbolArray.get(G).crossTileID=D>=0&&G!==D?0:x.crossTileID)}markUsedOrientation(l,d,x){const M=d===C.WritingMode.horizontal||d===C.WritingMode.horizontalOnly?d:0,D=d===C.WritingMode.vertical?d:0,B=[x.leftJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.rightJustifiedTextSymbolIndex];for(const G of B)l.text.placedSymbolArray.get(G).placedOrientation=M;x.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(x.verticalPlacedTextSymbolIndex).placedOrientation=D)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let x=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const M=d?d.symbolFadeChange(l):1,D=d?d.opacities:{},B=d?d.variableOffsets:{},G=d?d.placedOrientations:{};for(const W in this.placements){const Y=this.placements[W],ee=D[W];ee?(this.opacities[W]=new ls(ee,M,Y.text,Y.icon,null,Y.clipped),x=x||Y.text!==ee.text.placed||Y.icon!==ee.icon.placed):(this.opacities[W]=new ls(null,M,Y.text,Y.icon,Y.skipFade,Y.clipped),x=x||Y.text||Y.icon)}for(const W in D){const Y=D[W];if(!this.opacities[W]){const ee=new ls(Y,M,!1,!1);ee.isHidden()||(this.opacities[W]=ee,x=x||Y.text.placed||Y.icon.placed)}}for(const W in B)this.variableOffsets[W]||!this.opacities[W]||this.opacities[W].isHidden()||(this.variableOffsets[W]=B[W]);for(const W in G)this.placedOrientations[W]||!this.opacities[W]||this.opacities[W].isHidden()||(this.placedOrientations[W]=G[W]);x?this.lastPlacementChangeTime=l:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:l)}updateLayerOpacities(l,d){const x={};for(const M of d){const D=M.getBucket(l);D&&M.latestFeatureIndex&&l.id===D.layerIds[0]&&this.updateBucketOpacities(D,x,M.collisionBoxArray)}}updateBucketOpacities(l,d,x){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const M=l.layers[0].layout,D=!!l.layers[0].dynamicFilter(),B=new ls(null,0,!1,!1,!0),G=M.get("text-allow-overlap"),W=M.get("icon-allow-overlap"),Y=M.get("text-variable-anchor"),ee="map"===M.get("text-rotation-alignment"),Q="map"===M.get("text-pitch-alignment"),le="none"!==M.get("icon-text-fit"),de=new ls(null,0,G&&(W||!l.hasIconData()||M.get("icon-optional")),W&&(G||!l.hasTextData()||M.get("text-optional")),!0);!l.collisionArrays&&x&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(x);const ge=(xe,Te,Ee)=>{for(let Pe=0;Pe<Te/4;Pe++)xe.opacityVertexArray.emplaceBack(Ee)};for(let xe=0;xe<l.symbolInstances.length;xe++){const Te=l.symbolInstances.get(xe),{numHorizontalGlyphVertices:Ee,numVerticalGlyphVertices:Pe,crossTileID:Le}=Te;let Me=this.opacities[Le];d[Le]?Me=B:Me||(Me=de,this.opacities[Le]=Me),d[Le]=!0;const Ue=Te.numIconVertices>0,Ye=this.placedOrientations[Te.crossTileID],yt=Ye===C.WritingMode.vertical,gt=Ye===C.WritingMode.horizontal||Ye===C.WritingMode.horizontalOnly;if(Ee>0||Pe>0){const Ot=Gh(Me.text);ge(l.text,Ee,yt?Yi:Ot),ge(l.text,Pe,gt?Yi:Ot);const dt=Me.text.isHidden();[Te.rightJustifiedTextSymbolIndex,Te.centerJustifiedTextSymbolIndex,Te.leftJustifiedTextSymbolIndex].forEach(Zt=>{Zt>=0&&(l.text.placedSymbolArray.get(Zt).hidden=dt||yt?1:0)}),Te.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(Te.verticalPlacedTextSymbolIndex).hidden=dt||gt?1:0);const Nt=this.variableOffsets[Te.crossTileID];Nt&&this.markUsedJustification(l,Nt.anchor,Te,Ye);const wt=this.placedOrientations[Te.crossTileID];wt&&(this.markUsedJustification(l,"left",Te,wt),this.markUsedOrientation(l,wt,Te))}if(Ue){const Ot=Gh(Me.icon);Te.placedIconSymbolIndex>=0&&(ge(l.icon,Te.numIconVertices,yt?Yi:Ot),l.icon.placedSymbolArray.get(Te.placedIconSymbolIndex).hidden=Me.icon.isHidden()),Te.verticalPlacedIconSymbolIndex>=0&&(ge(l.icon,Te.numVerticalIconVertices,gt?Yi:Ot),l.icon.placedSymbolArray.get(Te.verticalPlacedIconSymbolIndex).hidden=Me.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const Ot=l.collisionArrays[xe];if(Ot){let dt=new C.pointGeometry(0,0),Nt=!0;if(Ot.textBox||Ot.verticalTextBox){if(Y){const Zt=this.variableOffsets[Le];Zt?(dt=xi(Zt.anchor,Zt.width,Zt.height,Zt.textOffset,Zt.textScale),ee&&dt._rotate(Q?this.transform.angle:-this.transform.angle)):Nt=!1}D&&(Nt=!Me.clipped),Ot.textBox&&ro(l.textCollisionBox.collisionVertexArray,Me.text.placed,!Nt||yt,dt.x,dt.y),Ot.verticalTextBox&&ro(l.textCollisionBox.collisionVertexArray,Me.text.placed,!Nt||gt,dt.x,dt.y)}const wt=Nt&&Boolean(!gt&&Ot.verticalIconBox);Ot.iconBox&&ro(l.iconCollisionBox.collisionVertexArray,Me.icon.placed,wt,le?dt.x:0,le?dt.y:0),Ot.verticalIconBox&&ro(l.iconCollisionBox.collisionVertexArray,Me.icon.placed,!wt,le?dt.x:0,le?dt.y:0)}}}if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const xe=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=xe.invProjMatrix,l.placementViewportMatrix=xe.viewportMatrix,l.collisionCircleArray=xe.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return 0===this.fadeDuration?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,d){const x=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*x>l}setStale(){this.stale=!0}}function ro(f,l,d,x,M){f.emplaceBack(l?1:0,d?1:0,x||0,M||0),f.emplaceBack(l?1:0,d?1:0,x||0,M||0),f.emplaceBack(l?1:0,d?1:0,x||0,M||0),f.emplaceBack(l?1:0,d?1:0,x||0,M||0)}const xh=Math.pow(2,25),Ac=Math.pow(2,24),ec=Math.pow(2,17),kp=Math.pow(2,16),sf=Math.pow(2,9),Us=Math.pow(2,8),Uf=Math.pow(2,1);function Gh(f){if(0===f.opacity&&!f.placed)return 0;if(1===f.opacity&&f.placed)return 4294967295;const l=f.placed?1:0,d=Math.floor(127*f.opacity);return d*xh+l*Ac+d*ec+l*kp+d*sf+l*Us+d*Uf+l}const Yi=0;class Eo{constructor(l){this._sortAcrossTiles="viewport-y"!==l.layout.get("symbol-z-order")&&void 0!==l.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,d,x,M,D){const B=this._bucketParts;for(;this._currentTileIndex<l.length;)if(d.getBucketParts(B,M,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,D())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,B.sort((G,W)=>G.sortKey-W.sortKey));this._currentPartIndex<B.length;){const G=B[this._currentPartIndex];if(d.placeLayerBucketPart(G,this._seenCrossTileIDs,x,0===G.symbolInstanceStart),this._currentPartIndex++,D())return!0}return!1}}class tc{constructor(l,d,x,M,D,B,G,W){this.placement=new no(l,D,B,G,W),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=x,this._showCollisionBoxes=M,this._done=!1}isDone(){return this._done}continuePlacement(l,d,x){const M=C.exported.now(),D=()=>{const B=C.exported.now()-M;return!this._forceFullPlacement&&B>2};for(;this._currentPlacementIndex>=0;){const B=d[l[this._currentPlacementIndex]],G=this.placement.collisionIndex.transform.zoom;if("symbol"===B.type&&(!B.minzoom||B.minzoom<=G)&&(!B.maxzoom||B.maxzoom>G)){if(this._inProgressLayer||(this._inProgressLayer=new Eo(B)),this._inProgressLayer.continuePlacement(x[B.source],this.placement,this._showCollisionBoxes,B,D))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const Sd=512/C.EXTENT/2;class eh{constructor(l,d,x){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=x;for(let M=0;M<d.length;M++){const D=d.get(M),B=D.key;this.indexedSymbolInstances[B]||(this.indexedSymbolInstances[B]=[]),this.indexedSymbolInstances[B].push({crossTileID:D.crossTileID,coord:this.getScaledCoordinates(D,l)})}}getScaledCoordinates(l,d){const x=Sd/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*C.EXTENT+l.tileAnchorX)*x),y:Math.floor((d.canonical.y*C.EXTENT+l.tileAnchorY)*x)}}findMatches(l,d,x){const M=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let D=0;D<l.length;D++){const B=l.get(D);if(B.crossTileID)continue;const G=this.indexedSymbolInstances[B.key];if(!G)continue;const W=this.getScaledCoordinates(B,d);for(const Y of G)if(Math.abs(Y.coord.x-W.x)<=M&&Math.abs(Y.coord.y-W.y)<=M&&!x[Y.crossTileID]){x[Y.crossTileID]=!0,B.crossTileID=Y.crossTileID;break}}}}class Hr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ql{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const d=Math.round((l-this.lng)/360);if(0!==d)for(const x in this.indexes){const M=this.indexes[x],D={};for(const B in M){const G=M[B];G.tileID=G.tileID.unwrapTo(G.tileID.wrap+d),D[G.tileID.key]=G}this.indexes[x]=D}this.lng=l}addBucket(l,d,x){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let D=0;D<d.symbolInstances.length;D++)d.symbolInstances.get(D).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const M=this.usedCrossTileIDs[l.overscaledZ];for(const D in this.indexes){const B=this.indexes[D];if(Number(D)>l.overscaledZ)for(const G in B){const W=B[G];W.tileID.isChildOf(l)&&W.findMatches(d.symbolInstances,l,M)}else{const G=B[l.scaledTo(Number(D)).key];G&&G.findMatches(d.symbolInstances,l,M)}}for(let D=0;D<d.symbolInstances.length;D++){const B=d.symbolInstances.get(D);B.crossTileID||(B.crossTileID=x.generate(),M[B.crossTileID]=!0)}return void 0===this.indexes[l.overscaledZ]&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new eh(l,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(l,d){for(const x in d.indexedSymbolInstances)for(const M of d.indexedSymbolInstances[x])delete this.usedCrossTileIDs[l][M.crossTileID]}removeStaleBuckets(l){let d=!1;for(const x in this.indexes){const M=this.indexes[x];for(const D in M)l[M[D].bucketInstanceId]||(this.removeBucketCrossTileIDs(x,M[D]),delete M[D],d=!0)}return d}}class io{constructor(){this.layerIndexes={},this.crossTileIDs=new Hr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,d,x){let M=this.layerIndexes[l.id];void 0===M&&(M=this.layerIndexes[l.id]=new Ql);let D=!1;const B={};M.handleWrapJump(x);for(const G of d){const W=G.getBucket(l);W&&l.id===W.layerIds[0]&&(W.bucketInstanceId||(W.bucketInstanceId=++this.maxBucketInstanceId),M.addBucket(G.tileID,W,this.crossTileIDs)&&(D=!0),B[W.bucketInstanceId]=!0)}return M.removeStaleBuckets(B)&&(D=!0),D}pruneUnusedLayers(l){const d={};l.forEach(x=>{d[x]=!0});for(const x in this.layerIndexes)d[x]||delete this.layerIndexes[x]}}const Fl=(f,l)=>C.emitValidationErrors(f,l&&l.filter(d=>"source.canvas"!==d.identifier)),up=C.pick(mt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),bh=C.pick(mt,["setCenter","setZoom","setBearing","setPitch"]),Dc=function(){const f={},l=C.spec.$version;for(const d in C.spec.$root){const x=C.spec.$root[d];if(x.required){let M=null;M="version"===d?l:"array"===x.type?[]:{},null!=M&&(f[d]=M)}}return f}(),kc={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class wa extends C.Evented{constructor(l,d={}){super(),this.map=l,this.dispatcher=new fr(Rt(),this),this.imageManager=new Rn,this.imageManager.setEventedParent(this),this.glyphManager=new C.GlyphManager(l._requestManager,d.localFontFamily?C.LocalGlyphMode.all:d.localIdeographFontFamily?C.LocalGlyphMode.ideographs:C.LocalGlyphMode.none,d.localFontFamily||d.localIdeographFontFamily),this.lineAtlas=new C.LineAtlas(256,512),this.crossTileSymbolIndex=new io,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new C.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",C.getReferrer());const x=this;this._rtlTextPluginCallback=wa.registerForPluginStateChange(M=>{x.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:M.pluginStatus,pluginURL:M.pluginURL},(D,B)=>{if(C.triggerPluginCompletionEvent(D),B&&B.every(G=>G))for(const G in x._sourceCaches){const W=x._sourceCaches[G],Y=W.getSource().type;"vector"!==Y&&"geojson"!==Y||W.reload()}})}),this.on("data",M=>{if("source"!==M.dataType||"metadata"!==M.sourceDataType)return;const D=this.getSource(M.sourceId);if(D&&D.vectorLayerIds)for(const B in this._layers){const G=this._layers[B];G.source===D.id&&this._validateLayer(G)}})}loadURL(l,d={}){this.fire(new C.Event("dataloading",{dataType:"style"}));const x="boolean"==typeof d.validate?d.validate:!C.isMapboxURL(l);l=this.map._requestManager.normalizeStyleURL(l,d.accessToken);const M=this.map._requestManager.transformRequest(l,C.ResourceType.Style);this._request=C.getJSON(M,(D,B)=>{this._request=null,D?this.fire(new C.ErrorEvent(D)):B&&this._load(B,x)})}loadJSON(l,d={}){this.fire(new C.Event("dataloading",{dataType:"style"})),this._request=C.exported.frame(()=>{this._request=null,this._load(l,!1!==d.validate)})}loadEmpty(){this.fire(new C.Event("dataloading",{dataType:"style"})),this._load(Dc,!1)}_updateLayerCount(l,d){const x=d?1:-1;l.is3D()&&(this._num3DLayers+=x),"circle"===l.type&&(this._numCircleLayers+=x),"symbol"===l.type&&(this._numSymbolLayers+=x)}_load(l,d){if(d&&Fl(this,C.validateStyle(l)))return;this._loaded=!0,this.stylesheet=l,this.updateProjection();for(const M in l.sources)this.addSource(M,l.sources[M],{validate:!1});this._changed=!1,l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(l.glyphs);const x=Xt(this.stylesheet.layers);this._order=x.map(M=>M.id),this._layers={},this._serializedLayers={};for(let M of x)M=C.createStyleLayer(M),M.setEventedParent(this,{layer:{id:M.id}}),this._layers[M.id]=M,this._serializedLayers[M.id]=M.serialize(),this._updateLayerCount(M,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new jn(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new C.Event("data",{dataType:"style"})),this.fire(new C.Event("style.load"))}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const l=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0));if(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),l){this.map.painter.clearBackgroundTiles();for(const d in this._sourceCaches)this._sourceCaches[d].clearTiles();this.map._update(!0)}}_loadSprite(l){this._spriteRequest=function(d,x,M){let D,B,G;const W=C.exported.devicePixelRatio>1?"@2x":"";let Y=C.getJSON(x.transformRequest(x.normalizeSpriteURL(d,W,".json"),C.ResourceType.SpriteJSON),(le,de)=>{Y=null,G||(G=le,D=de,Q())}),ee=C.getImage(x.transformRequest(x.normalizeSpriteURL(d,W,".png"),C.ResourceType.SpriteImage),(le,de)=>{ee=null,G||(G=le,B=de,Q())});function Q(){if(G)M(G);else if(D&&B){const le=C.exported.getImageData(B),de={};for(const ge in D){const{width:xe,height:Te,x:Ee,y:Pe,sdf:Le,pixelRatio:Me,stretchX:Ue,stretchY:Ye,content:yt}=D[ge],gt=new C.RGBAImage({width:xe,height:Te});C.RGBAImage.copy(le,gt,{x:Ee,y:Pe},{x:0,y:0},{width:xe,height:Te}),de[ge]={data:gt,pixelRatio:Me,sdf:Le,stretchX:Ue,stretchY:Ye,content:yt}}M(null,de)}}return{cancel(){Y&&(Y.cancel(),Y=null),ee&&(ee.cancel(),ee=null)}}}(l,this.map._requestManager,(d,x)=>{if(this._spriteRequest=null,d)this.fire(new C.ErrorEvent(d));else if(x)for(const M in x)this.imageManager.addImage(M,x[M]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new C.Event("data",{dataType:"style"}))})}_validateLayer(l){const d=this.getSource(l.source);if(!d)return;const x=l.sourceLayer;x&&("geojson"===d.type||d.vectorLayerIds&&-1===d.vectorLayerIds.indexOf(x))&&this.fire(new C.ErrorEvent(new Error(`Source layer "${x}" does not exist on source "${d.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(l){const d=[];for(const x of l){const M=this._layers[x];"custom"!==M.type&&d.push(M.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(l){return!!this.terrain&&kc[l.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(l){if(!this._loaded)return;const d=this._changed;if(this._changed){const M=Object.keys(this._updatedLayers),D=Object.keys(this._removedLayers);(M.length||D.length)&&this._updateWorkerLayers(M,D);for(const B in this._updatedSources){const G=this._updatedSources[B];"reload"===G?this._reloadSource(B):"clear"===G&&this._clearSource(B)}this._updateTilesForChangedImages();for(const B in this._updatedPaintProps)this._layers[B].updateTransitions(l);this.light.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._resetUpdates()}const x={};for(const M in this._sourceCaches){const D=this._sourceCaches[M];x[M]=D.used,D.used=!1}for(const M of this._order){const D=this._layers[M];if(D.recalculate(l,this._availableImages),!D.isHidden(l.zoom)){const G=this._getLayerSourceCache(D);G&&(G.used=!0)}const B=this.map.painter;if(B){const G=D.getProgramIds();if(!G)continue;const W=D.getProgramConfiguration(l.zoom);for(const Y of G)B.useProgram(Y,W)}}for(const M in x){const D=this._sourceCaches[M];x[M]!==D.used&&D.getSource().fire(new C.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:D.getSource().id}))}this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new C.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateWorkerLayers(l,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(l),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(l){if(this._checkLoaded(),Fl(this,C.validateStyle(l)))return!1;(l=C.clone$2(l)).layers=Xt(l.layers);const d=function(M,D){if(!M)return[{command:mt.setStyle,args:[D]}];let B=[];try{if(!it(M.version,D.version))return[{command:mt.setStyle,args:[D]}];it(M.center,D.center)||B.push({command:mt.setCenter,args:[D.center]}),it(M.zoom,D.zoom)||B.push({command:mt.setZoom,args:[D.zoom]}),it(M.bearing,D.bearing)||B.push({command:mt.setBearing,args:[D.bearing]}),it(M.pitch,D.pitch)||B.push({command:mt.setPitch,args:[D.pitch]}),it(M.sprite,D.sprite)||B.push({command:mt.setSprite,args:[D.sprite]}),it(M.glyphs,D.glyphs)||B.push({command:mt.setGlyphs,args:[D.glyphs]}),it(M.transition,D.transition)||B.push({command:mt.setTransition,args:[D.transition]}),it(M.light,D.light)||B.push({command:mt.setLight,args:[D.light]}),it(M.fog,D.fog)||B.push({command:mt.setFog,args:[D.fog]}),it(M.projection,D.projection)||B.push({command:mt.setProjection,args:[D.projection]});const G={},W=[];!function(Q,le,de,ge){let xe;for(xe in le=le||{},Q=Q||{})Q.hasOwnProperty(xe)&&(le.hasOwnProperty(xe)||ot(xe,de,ge));for(xe in le)le.hasOwnProperty(xe)&&(Q.hasOwnProperty(xe)?it(Q[xe],le[xe])||("geojson"===Q[xe].type&&"geojson"===le[xe].type&&Bn(Q,le,xe)?de.push({command:mt.setGeoJSONSourceData,args:[xe,le[xe].data]}):On(xe,le,de,ge)):Je(xe,le,de))}(M.sources,D.sources,W,G);const Y=[];M.layers&&M.layers.forEach(Q=>{G[Q.source]?B.push({command:mt.removeLayer,args:[Q.id]}):Y.push(Q)});let ee=M.terrain;ee&&G[ee.source]&&(B.push({command:mt.setTerrain,args:[void 0]}),ee=void 0),B=B.concat(W),it(ee,D.terrain)||B.push({command:mt.setTerrain,args:[D.terrain]}),function(Q,le,de){le=le||[];const ge=(Q=Q||[]).map(br),xe=le.map(br),Te=Q.reduce(Ft,{}),Ee=le.reduce(Ft,{}),Pe=ge.slice(),Le=Object.create(null);let Me,Ue,Ye,yt,gt,Ot,dt;for(Me=0,Ue=0;Me<ge.length;Me++)Ye=ge[Me],Ee.hasOwnProperty(Ye)?Ue++:(de.push({command:mt.removeLayer,args:[Ye]}),Pe.splice(Pe.indexOf(Ye,Ue),1));for(Me=0,Ue=0;Me<xe.length;Me++)Ye=xe[xe.length-1-Me],Pe[Pe.length-1-Me]!==Ye&&(Te.hasOwnProperty(Ye)?(de.push({command:mt.removeLayer,args:[Ye]}),Pe.splice(Pe.lastIndexOf(Ye,Pe.length-Ue),1)):Ue++,Ot=Pe[Pe.length-Me],de.push({command:mt.addLayer,args:[Ee[Ye],Ot]}),Pe.splice(Pe.length-Me,0,Ye),Le[Ye]=!0);for(Me=0;Me<xe.length;Me++)if(Ye=xe[Me],yt=Te[Ye],gt=Ee[Ye],!Le[Ye]&&!it(yt,gt))if(it(yt.source,gt.source)&&it(yt["source-layer"],gt["source-layer"])&&it(yt.type,gt.type)){for(dt in sn(yt.layout,gt.layout,de,Ye,null,mt.setLayoutProperty),sn(yt.paint,gt.paint,de,Ye,null,mt.setPaintProperty),it(yt.filter,gt.filter)||de.push({command:mt.setFilter,args:[Ye,gt.filter]}),it(yt.minzoom,gt.minzoom)&&it(yt.maxzoom,gt.maxzoom)||de.push({command:mt.setLayerZoomRange,args:[Ye,gt.minzoom,gt.maxzoom]}),yt)yt.hasOwnProperty(dt)&&"layout"!==dt&&"paint"!==dt&&"filter"!==dt&&"metadata"!==dt&&"minzoom"!==dt&&"maxzoom"!==dt&&(0===dt.indexOf("paint.")?sn(yt[dt],gt[dt],de,Ye,dt.slice(6),mt.setPaintProperty):it(yt[dt],gt[dt])||de.push({command:mt.setLayerProperty,args:[Ye,dt,gt[dt]]}));for(dt in gt)gt.hasOwnProperty(dt)&&!yt.hasOwnProperty(dt)&&"layout"!==dt&&"paint"!==dt&&"filter"!==dt&&"metadata"!==dt&&"minzoom"!==dt&&"maxzoom"!==dt&&(0===dt.indexOf("paint.")?sn(yt[dt],gt[dt],de,Ye,dt.slice(6),mt.setPaintProperty):it(yt[dt],gt[dt])||de.push({command:mt.setLayerProperty,args:[Ye,dt,gt[dt]]}))}else de.push({command:mt.removeLayer,args:[Ye]}),Ot=Pe[Pe.lastIndexOf(Ye)+1],de.push({command:mt.addLayer,args:[gt,Ot]})}(Y,D.layers,B)}catch(G){console.warn("Unable to compute style diff:",G),B=[{command:mt.setStyle,args:[D]}]}return B}(this.serialize(),l).filter(M=>!(M.command in bh));if(0===d.length)return!1;const x=d.filter(M=>!(M.command in up));if(x.length>0)throw new Error(`Unimplemented: ${x.map(M=>M.command).join(", ")}.`);return d.forEach(M=>{"setTransition"!==M.command&&this[M.command].apply(this,M.args)}),this.stylesheet=l,!0}addImage(l,d){if(this.getImage(l))return this.fire(new C.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(l,d),this._afterImageUpdated(l)}updateImage(l,d){this.imageManager.updateImage(l,d)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new C.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new C.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(l,d,x={}){if(this._checkLoaded(),void 0!==this.getSource(l))throw new Error("There is already a source with this ID");if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(C.validateStyle.source,`sources.${l}`,d,null,x))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const M=oe(l,d,this.dispatcher,this);M.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:M.serialize(),sourceId:l}));const D=B=>{const G=(B?"symbol:":"other:")+l,W=this._sourceCaches[G]=new C.SourceCache(G,M,B);(B?this._symbolSourceCaches:this._otherSourceCaches)[l]=W,W.style=this,W.onAdd(this.map)};D(!1),"vector"!==d.type&&"geojson"!==d.type||D(!0),M.onAdd&&M.onAdd(this.map),this._changed=!0}removeSource(l){this._checkLoaded();const d=this.getSource(l);if(void 0===d)throw new Error("There is no source with this ID");for(const M in this._layers)if(this._layers[M].source===l)return this.fire(new C.ErrorEvent(new Error(`Source "${l}" cannot be removed while layer "${M}" is using it.`)));if(this.terrain&&this.terrain.get().source===l)return this.fire(new C.ErrorEvent(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const x=this._getSourceCaches(l);for(const M of x)delete this._sourceCaches[M.id],delete this._updatedSources[M.id],M.fire(new C.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:M.getSource().id})),M.setEventedParent(null),M.clearTiles();delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,d){this._checkLoaded(),this.getSource(l).setData(d),this._changed=!0}getSource(l){const d=this._getSourceCache(l);return d&&d.getSource()}addLayer(l,d,x={}){this._checkLoaded();const M=l.id;if(this.getLayer(M))return void this.fire(new C.ErrorEvent(new Error(`Layer with id "${M}" already exists on this map`)));let D;if("custom"===l.type){if(Fl(this,C.validateCustomStyleLayer(l)))return;D=C.createStyleLayer(l)}else{if("object"==typeof l.source&&(this.addSource(M,l.source),l=C.clone$2(l),l=C.extend(l,{source:M})),this._validate(C.validateStyle.layer,`layers.${M}`,l,{arrayIndex:-1},x))return;D=C.createStyleLayer(l),this._validateLayer(D),D.setEventedParent(this,{layer:{id:M}}),this._serializedLayers[D.id]=D.serialize(),this._updateLayerCount(D,!0)}const B=d?this._order.indexOf(d):this._order.length;if(d&&-1===B)return void this.fire(new C.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`)));this._order.splice(B,0,M),this._layerOrderChanged=!0,this._layers[M]=D;const G=this._getLayerSourceCache(D);if(this._removedLayers[M]&&D.source&&G&&"custom"!==D.type){const W=this._removedLayers[M];delete this._removedLayers[M],W.type!==D.type?this._updatedSources[D.source]="clear":(this._updatedSources[D.source]="reload",G.pause())}this._updateLayer(D),D.onAdd&&D.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(l,d){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new C.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===d)return;const x=this._order.indexOf(l);this._order.splice(x,1);const M=d?this._order.indexOf(d):this._order.length;d&&-1===M?this.fire(new C.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`))):(this._order.splice(M,0,l),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(l){this._checkLoaded();const d=this._layers[l];if(!d)return void this.fire(new C.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be removed.`)));d.setEventedParent(null),this._updateLayerCount(d,!1);const x=this._order.indexOf(l);this._order.splice(x,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=d,delete this._layers[l],delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],d.onRemove&&d.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(l){return this._layers[l]}hasLayer(l){return l in this._layers}hasLayerType(l){for(const d in this._layers)if(this._layers[d].type===l)return!0;return!1}setLayerZoomRange(l,d,x){this._checkLoaded();const M=this.getLayer(l);M?M.minzoom===d&&M.maxzoom===x||(null!=d&&(M.minzoom=d),null!=x&&(M.maxzoom=x),this._updateLayer(M)):this.fire(new C.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(l,d,x={}){this._checkLoaded();const M=this.getLayer(l);if(M){if(!it(M.filter,d))return null==d?(M.filter=void 0,void this._updateLayer(M)):void(this._validate(C.validateStyle.filter,`layers.${M.id}.filter`,d,{layerType:M.type},x)||(M.filter=C.clone$2(d),this._updateLayer(M)))}else this.fire(new C.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be filtered.`)))}getFilter(l){return C.clone$2(this.getLayer(l).filter)}setLayoutProperty(l,d,x,M={}){this._checkLoaded();const D=this.getLayer(l);D?it(D.getLayoutProperty(d),x)||(D.setLayoutProperty(d,x,M),this._updateLayer(D)):this.fire(new C.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(l,d){const x=this.getLayer(l);if(x)return x.getLayoutProperty(d);this.fire(new C.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style.`)))}setPaintProperty(l,d,x,M={}){this._checkLoaded();const D=this.getLayer(l);D?it(D.getPaintProperty(d),x)||(D.setPaintProperty(d,x,M)&&this._updateLayer(D),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new C.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(l,d){return this.getLayer(l).getPaintProperty(d)}setFeatureState(l,d){this._checkLoaded();const x=l.source,M=l.sourceLayer,D=this.getSource(x);if(void 0===D)return void this.fire(new C.ErrorEvent(new Error(`The source '${x}' does not exist in the map's style.`)));const B=D.type;if("geojson"===B&&M)return void this.fire(new C.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===B&&!M)return void this.fire(new C.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===l.id&&this.fire(new C.ErrorEvent(new Error("The feature id parameter must be provided.")));const G=this._getSourceCaches(x);for(const W of G)W.setFeatureState(M,l.id,d)}removeFeatureState(l,d){this._checkLoaded();const x=l.source,M=this.getSource(x);if(void 0===M)return void this.fire(new C.ErrorEvent(new Error(`The source '${x}' does not exist in the map's style.`)));const D=M.type,B="vector"===D?l.sourceLayer:void 0;if("vector"===D&&!B)return void this.fire(new C.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&"string"!=typeof l.id&&"number"!=typeof l.id)return void this.fire(new C.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const G=this._getSourceCaches(x);for(const W of G)W.removeFeatureState(B,l.id,d)}getFeatureState(l){this._checkLoaded();const d=l.source,x=l.sourceLayer,M=this.getSource(d);if(void 0!==M){if("vector"!==M.type||x)return void 0===l.id&&this.fire(new C.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(d)[0].getFeatureState(x,l.id);this.fire(new C.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new C.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return C.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const l={};for(const d in this._sourceCaches){const x=this._sourceCaches[d].getSource();l[x.id]||(l[x.id]=x.serialize())}return C.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:l,layers:this._serializeLayers(this._order)},d=>void 0!==d)}_updateLayer(l){this._updatedLayers[l.id]=!0;const d=this._getLayerSourceCache(l);l.source&&!this._updatedSources[l.source]&&d&&"raster"!==d.getSource().type&&(this._updatedSources[l.source]="reload",d.pause()),this._changed=!0,l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const d=B=>"fill-extrusion"===this._layers[B].type,x={},M=[];for(let B=this._order.length-1;B>=0;B--){const G=this._order[B];if(d(G)){x[G]=B;for(const W of l){const Y=W[G];if(Y)for(const ee of Y)M.push(ee)}}}M.sort((B,G)=>G.intersectionZ-B.intersectionZ);const D=[];for(let B=this._order.length-1;B>=0;B--){const G=this._order[B];if(d(G))for(let W=M.length-1;W>=0;W--){const Y=M[W].feature;if(x[Y.layer.id]<B)break;D.push(Y),M.pop()}else for(const W of l){const Y=W[G];if(Y)for(const ee of Y)D.push(ee.feature)}}return D}queryRenderedFeatures(l,d,x){d&&d.filter&&this._validate(C.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);const M={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new C.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const W of d.layers){const Y=this._layers[W];if(!Y)return this.fire(new C.ErrorEvent(new Error(`The layer '${W}' does not exist in the map's style and cannot be queried for features.`))),[];M[Y.source]=!0}}const D=[];d.availableImages=this._availableImages;const B=d&&d.layers?d.layers.some(W=>{const Y=this.getLayer(W);return Y&&Y.is3D()}):this.has3DLayers(),G=Er.createFromScreenPoints(l,x);for(const W in this._sourceCaches){const Y=this._sourceCaches[W].getSource().id;d.layers&&!M[Y]||D.push(ve(this._sourceCaches[W],this._layers,this._serializedLayers,G,d,x,B,!!this.map._showQueryGeometry))}return this.placement&&D.push(function(W,Y,ee,Q,le,de,ge){const xe={},Te=de.queryRenderedSymbols(Q),Ee=[];for(const Pe of Object.keys(Te).map(Number))Ee.push(ge[Pe]);Ee.sort(Se);for(const Pe of Ee){const Le=Pe.featureIndex.lookupSymbolFeatures(Te[Pe.bucketInstanceId],Y,Pe.bucketIndex,Pe.sourceLayerIndex,le.filter,le.layers,le.availableImages,W);for(const Me in Le){const Ue=xe[Me]=xe[Me]||[],Ye=Le[Me];Ye.sort((yt,gt)=>{const Ot=Pe.featureSortOrder;if(Ot){const dt=Ot.indexOf(yt.featureIndex);return Ot.indexOf(gt.featureIndex)-dt}return gt.featureIndex-yt.featureIndex});for(const yt of Ye)Ue.push(yt)}}for(const Pe in xe)xe[Pe].forEach(Le=>{const Me=Le.feature,Ue=ee(W[Pe]).getFeatureState(Me.layer["source-layer"],Me.id);Me.source=Me.layer.source,Me.layer["source-layer"]&&(Me.sourceLayer=Me.layer["source-layer"]),Me.state=Ue});return xe}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),G.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(D)}querySourceFeatures(l,d){d&&d.filter&&this._validate(C.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);const x=this._getSourceCaches(l);let M=[];for(const D of x)M=M.concat(pe(D,d));return M}addSourceType(l,d,x){return wa.getSourceType(l)?x(new Error(`A source type called "${l}" already exists.`)):(wa.setSourceType(l,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:d.workerSourceURL},x):x(null,null))}getLight(){return this.light.getLight()}setLight(l,d={}){this._checkLoaded();const x=this.light.getLight();let M=!1;for(const B in l)if(!it(l[B],x[B])){M=!0;break}if(!M)return;const D={now:C.exported.now(),transition:C.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,d),this.light.updateTransitions(D)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(l){if(this._checkLoaded(),!l)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if("object"==typeof l.source){const d="terrain-dem-src";this.addSource(d,l.source),l=C.clone$2(l),l=C.extend(l,{source:d})}if(!this._validate(C.validateStyle.terrain,"terrain",l)){if(this.terrain){const d=this.terrain,x=d.get();for(const M in l)if(!it(l[M],x[M])){d.set(l),this.stylesheet.terrain=l;const D={now:C.exported.now(),transition:C.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(D);break}}else this._createTerrain(l);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(l){const d=this.fog=new Pr(l,this.map.transform);this.stylesheet.fog=l;const x={now:C.exported.now(),transition:C.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(x)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog,x=d.get();for(const M in l)if(!it(l[M],x[M])){d.set(l),this.stylesheet.fog=l;const D={now:C.exported.now(),transition:C.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(D);break}}else this._createFog(l);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const l=this._order.filter(x=>this.isLayerDraped(this._layers[x])),d=this._order.filter(x=>!this.isLayerDraped(this._layers[x]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...d)}_createTerrain(l){const d=this.terrain=new qr(l);this.stylesheet.terrain=l,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const x={now:C.exported.now(),transition:C.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(x)}_force3DLayerUpdate(){for(const l in this._layers){const d=this._layers[l];"fill-extrusion"===d.type&&this._updateLayer(d)}}_validate(l,d,x,M,D={}){return(!D||!1!==D.validate)&&Fl(this,l.call(C.validateStyle,C.extend({key:d,style:this.serialize(),value:x,styleSpec:C.spec},M)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),C.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._layers)this._layers[l].setEventedParent(null);for(const l in this._sourceCaches)this._sourceCaches[l].clearTiles(),this._sourceCaches[l].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(l){const d=this._getSourceCaches(l);for(const x of d)x.clearTiles()}_reloadSource(l){const d=this._getSourceCaches(l);for(const x of d)x.resume(),x.reload()}_updateSources(l){for(const d in this._sourceCaches)this._sourceCaches[d].update(l)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const d=this._sourceCaches[l];d.resume(),d.reload()}}_updatePlacement(l,d,x,M,D=!1){let B=!1,G=!1;const W={};for(const Y of this._order){const ee=this._layers[Y];if("symbol"!==ee.type)continue;if(!W[ee.source]){const le=this._getLayerSourceCache(ee);if(!le)continue;W[ee.source]=le.getRenderableIds(!0).map(de=>le.getTileByID(de)).sort((de,ge)=>ge.tileID.overscaledZ-de.tileID.overscaledZ||(de.tileID.isLessThan(ge.tileID)?-1:1))}const Q=this.crossTileSymbolIndex.addLayer(ee,W[ee.source],l.center.lng);B=B||Q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),D=D||this._layerOrderChanged||0===x,this._layerOrderChanged&&this.fire(new C.Event("neworder")),(D||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(C.exported.now(),l.zoom))&&(this.pauseablePlacement=new tc(l,this._order,D,d,x,M,this.placement,this.fog&&!this.fog.isSoftDisabled()?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,W),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(C.exported.now()),G=!0),B&&this.pauseablePlacement.placement.setStale()),G||B)for(const Y of this._order){const ee=this._layers[Y];"symbol"===ee.type&&this.placement.updateLayerOpacities(ee,W[ee.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(C.exported.now())}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,d,x){this.imageManager.getImages(d.icons,x),this._updateTilesForChangedImages();const M=D=>{D&&D.setDependencies(d.tileID.key,d.type,d.icons)};M(this._otherSourceCaches[d.source]),M(this._symbolSourceCaches[d.source])}getGlyphs(l,d,x){this.glyphManager.getGlyphs(d.stacks,x)}getResource(l,d,x){return C.makeRequest(d,x)}_getSourceCache(l){return this._otherSourceCaches[l]}_getLayerSourceCache(l){return"symbol"===l.type?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}_getSourceCaches(l){const d=[];return this._otherSourceCaches[l]&&d.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&d.push(this._symbolSourceCaches[l]),d}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}}wa.getSourceType=function(f){return te[f]},wa.setSourceType=function(f,l){te[f]=l},wa.registerForPluginStateChange=C.registerForPluginStateChange;var ca="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",qh="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let wh={},oi={};wh=Li("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else \nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),oi=Li("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const nc=Li("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nreturn mix(globe,mercator,t);\n#else\nreturn globe;\n#endif\n}vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Ch=ca;var eu={background:Li("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Li("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Li("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Li("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Li("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));vec3 globePos=a_pos_3+xAxis*extrude.x+yAxis*extrude.y+elevationVector(tilePos)*elevation(tilePos);vec3 mercPos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+xAxis*extrude.x+yAxis*extrude.y;vec3 pos=mix_globe_mercator(globePos,mercPos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Li("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Li("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Li("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Li("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:Li("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Li("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Li("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Li("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Li("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Li("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Li("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Li("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Li("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Li("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Li("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Li("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Li("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Li("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Li("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Li("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Li("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",qh),skyboxGradient:Li("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",qh),skyboxCapture:Li("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Li("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {vec4 color=texture2D(u_image0,v_pos0);gl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:Li("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}"),globeDepth:Li("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying float v_depth;void main() {vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);v_depth=gl_Position.z/gl_Position.w;}")};function Li(f,l,d){const x=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,M=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,D=l.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),B=f.match(M),G=l.match(M),W=ca.match(M);let Y=G?G.concat(B):B;d||(wh.staticUniforms&&(Y=wh.staticUniforms.concat(Y)),oi.staticUniforms&&(Y=oi.staticUniforms.concat(Y))),Y&&(Y=Y.concat(W));const ee={};return{fragmentSource:f=f.replace(x,(Q,le,de,ge,xe)=>(ee[xe]=!0,"define"===le?`\n#ifndef HAS_UNIFORM_u_${xe}\nvarying ${de} ${ge} ${xe};\n#else\nuniform ${de} ${ge} u_${xe};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${xe}\n    ${de} ${ge} ${xe} = u_${xe};\n#endif\n`)),vertexSource:l=l.replace(x,(Q,le,de,ge,xe)=>{const Te="float"===ge?"vec2":"vec4",Ee=xe.match(/color/)?"color":Te;return ee[xe]?"define"===le?`\n#ifndef HAS_UNIFORM_u_${xe}\nuniform lowp float u_${xe}_t;\nattribute ${de} ${Te} a_${xe};\nvarying ${de} ${ge} ${xe};\n#else\nuniform ${de} ${ge} u_${xe};\n#endif\n`:"vec4"===Ee?`\n#ifndef HAS_UNIFORM_u_${xe}\n    ${xe} = a_${xe};\n#else\n    ${de} ${ge} ${xe} = u_${xe};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${xe}\n    ${xe} = unpack_mix_${Ee}(a_${xe}, u_${xe}_t);\n#else\n    ${de} ${ge} ${xe} = u_${xe};\n#endif\n`:"define"===le?`\n#ifndef HAS_UNIFORM_u_${xe}\nuniform lowp float u_${xe}_t;\nattribute ${de} ${Te} a_${xe};\n#else\nuniform ${de} ${ge} u_${xe};\n#endif\n`:"vec4"===Ee?`\n#ifndef HAS_UNIFORM_u_${xe}\n    ${de} ${ge} ${xe} = a_${xe};\n#else\n    ${de} ${ge} ${xe} = u_${xe};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${xe}\n    ${de} ${ge} ${xe} = unpack_mix_${Ee}(a_${xe}, u_${xe}_t);\n#else\n    ${de} ${ge} ${xe} = u_${xe};\n#endif\n`}),staticAttributes:D,staticUniforms:Y}}class Pp{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,d,x,M,D,B,G,W){this.context=l;let Y=this.boundPaintVertexBuffers.length!==M.length;for(let ee=0;!Y&&ee<M.length;ee++)this.boundPaintVertexBuffers[ee]!==M[ee]&&(Y=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===x&&!Y&&this.boundIndexBuffer===D&&this.boundVertexOffset===B&&this.boundDynamicVertexBuffer===G&&this.boundDynamicVertexBuffer2===W?(l.bindVertexArrayOES.set(this.vao),G&&G.bind(),D&&D.dynamicDraw&&D.bind(),W&&W.bind()):this.freshBind(d,x,M,D,B,G,W)}freshBind(l,d,x,M,D,B,G){let W;const Y=l.numAttributes,ee=this.context,Q=ee.gl;if(ee.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ee.extVertexArrayObject.createVertexArrayOES(),ee.bindVertexArrayOES.set(this.vao),W=0,this.boundProgram=l,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=x,this.boundIndexBuffer=M,this.boundVertexOffset=D,this.boundDynamicVertexBuffer=B,this.boundDynamicVertexBuffer2=G;else{W=ee.currentNumAttributes||0;for(let le=Y;le<W;le++)Q.disableVertexAttribArray(le)}d.enableAttributes(Q,l);for(const le of x)le.enableAttributes(Q,l);B&&B.enableAttributes(Q,l),G&&G.enableAttributes(Q,l),d.bind(),d.setVertexAttribPointers(Q,l,D);for(const le of x)le.bind(),le.setVertexAttribPointers(Q,l,D);B&&(B.bind(),B.setVertexAttribPointers(Q,l,D)),M&&M.bind(),G&&(G.bind(),G.setVertexAttribPointers(Q,l,D)),ee.currentNumAttributes=Y}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Bu(f,l){const d=Math.pow(2,l.canonical.z),x=l.canonical.y;return[new C.MercatorCoordinate(0,x/d).toLngLat().lat,new C.MercatorCoordinate(0,(x+1)/d).toLngLat().lat]}function Is(f,l,d,x,M,D,B){const G=f.context,W=G.gl,Y=d.fbo;if(!Y)return;f.prepareDrawTile(l);const ee=f.useProgram("hillshade");G.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_2D,Y.colorAttachment.get());const Q=((xe,Te,Ee,Pe)=>{const Le=Ee.paint.get("hillshade-shadow-color"),Me=Ee.paint.get("hillshade-highlight-color"),Ue=Ee.paint.get("hillshade-accent-color");let Ye=Ee.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===Ee.paint.get("hillshade-illumination-anchor")&&(Ye-=xe.transform.angle);const yt=!xe.options.moving;return{u_matrix:Pe||xe.transform.calculateProjMatrix(Te.tileID.toUnwrapped(),yt),u_image:0,u_latrange:Bu(0,Te.tileID),u_light:[Ee.paint.get("hillshade-exaggeration"),Ye],u_shadow:Le,u_highlight:Me,u_accent:Ue}})(f,d,x,f.terrain?l.projMatrix:null);f.prepareDrawProgram(G,ee,l.toUnwrapped());const{tileBoundsBuffer:le,tileBoundsIndexBuffer:de,tileBoundsSegments:ge}=f.getTileBoundsBuffers(d);ee.draw(G,W.TRIANGLES,M,D,B,C.CullFaceMode.disabled,Q,x.id,le,de,ge)}function Eh(f,l,d){if(!l.needsDEMTextureUpload)return;const x=f.context,M=x.gl;x.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||f.getTileTexture(d.stride);const D=d.getPixels();l.demTexture?l.demTexture.update(D,{premultiply:!1}):l.demTexture=new C.Texture(x,D,M.RGBA,{premultiply:!1}),l.needsDEMTextureUpload=!1}function rc(f,l,d,x,M,D){const B=f.context,G=B.gl;if(!l.dem)return;const W=l.dem;if(B.activeTexture.set(G.TEXTURE1),Eh(f,l,W),!l.demTexture)return;l.demTexture.bind(G.NEAREST,G.CLAMP_TO_EDGE);const Y=W.dim;B.activeTexture.set(G.TEXTURE0);let ee=l.fbo;if(!ee){const ge=new C.Texture(B,{width:Y,height:Y,data:null},G.RGBA);ge.bind(G.LINEAR,G.CLAMP_TO_EDGE),ee=l.fbo=B.createFramebuffer(Y,Y,!0),ee.colorAttachment.set(ge.texture)}B.bindFramebuffer.set(ee.framebuffer),B.viewport.set([0,0,Y,Y]);const{tileBoundsBuffer:Q,tileBoundsIndexBuffer:le,tileBoundsSegments:de}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(B,G.TRIANGLES,x,M,D,C.CullFaceMode.disabled,((ge,xe)=>{const Te=xe.stride,Ee=C.create$1();return C.ortho(Ee,0,C.EXTENT,-C.EXTENT,0,0,1),C.translate(Ee,Ee,[0,-C.EXTENT,0]),{u_matrix:Ee,u_image:1,u_dimension:[Te,Te],u_zoom:ge.overscaledZ,u_unpack:xe.unpackVector}})(l.tileID,W),d.id,Q,le,de),l.needsHillshadePrepare=!1}const ii=(f,l)=>({u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_image0:new C.Uniform1i(f,l.u_image0),u_skirt_height:new C.Uniform1f(f,l.u_skirt_height)}),th=(f,l)=>({u_matrix:f,u_image0:0,u_skirt_height:l}),ka=new class{constructor(){this.operations={}}newMorphing(f,l,d,x,M){if(f in this.operations){const D=this.operations[f];D.to.tileID.key!==d.tileID.key&&(D.queued=d)}else this.operations[f]={startTime:x,phase:0,duration:M,from:l,to:d,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const l=this.operations[f];return{from:l.from,to:l.to,phase:l.phase}}update(f){for(const l in this.operations){const d=this.operations[l];for(d.phase=(f-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,f)){delete this.operations[l];break}}}_nextOp(f,l){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=l,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Zh={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ic(f,l){const d=1<<f.z;return!l&&(0===f.x||f.x===d-1)||0===f.y||f.y===d-1}const Di=f=>({u_matrix:f});function Sh(f,l,d,x,M){if(M>0){const D=C.exported.now(),B=(D-f.timeAdded)/M,G=l?(D-l.timeAdded)/M:-1,W=d.getSource(),Y=x.coveringZoomLevel({tileSize:W.tileSize,roundZoom:W.roundZoom}),ee=!l||Math.abs(l.tileID.overscaledZ-Y)>Math.abs(f.tileID.overscaledZ-Y),Q=ee&&f.refreshedUponExpiration?1:C.clamp(ee?B:1-G,0,1);return f.refreshedUponExpiration&&B>=1&&(f.refreshedUponExpiration=!1),l?{opacity:1,mix:1-Q}:{opacity:Q,mix:0}}return{opacity:1,mix:0}}class oc extends C.SourceCache{constructor(l){const d=oe("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new fr(Rt(),null),l.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,d,x){if(l.freezeTileCoverage)return;this.transform=l;const M=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((D,B)=>{if(D[B.key]="",!this._tiles[B.key]){const G=new C.Tile(B,this._source.tileSize*B.overscaleFactor(),l.tileZoom);G.state="loaded",this._tiles[B.key]=G}return D},{});for(const D in this._tiles)D in M||(this.freeFBO(D),this._tiles[D].unloadVectorData(),delete this._tiles[D])}freeFBO(l){const d=this.proxyCachedFBO[l];if(void 0!==d){const x=Object.values(d);this.renderCachePool.push(...x),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ya extends C.OverscaledTileID{constructor(l,d,x){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=d,this.projMatrix=x}}class uo extends C.Elevation{constructor(l,d){super(),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[x,M,D]=function(W){const Y=new C.StructArrayLayout4i8,ee=new C.StructArrayLayout3ui6,Q=131;Y.reserve(17161),ee.reserve(33800);const le=C.EXTENT/128,de=C.EXTENT+le/2,ge=de+le;for(let Te=-le;Te<ge;Te+=le)for(let Ee=-le;Ee<ge;Ee+=le){const Pe=Ee<0||Ee>de||Te<0||Te>de?24575:0,Le=C.clamp(Math.round(Ee),0,C.EXTENT),Me=C.clamp(Math.round(Te),0,C.EXTENT);Y.emplaceBack(Le+Pe,Me,Le,Me)}const xe=(Te,Ee)=>{const Pe=Ee*Q+Te;ee.emplaceBack(Pe+1,Pe,Pe+Q),ee.emplaceBack(Pe+Q,Pe+Q+1,Pe+1)};for(let Te=1;Te<129;Te++)for(let Ee=1;Ee<129;Ee++)xe(Ee,Te);return[0,129].forEach(Te=>{for(let Ee=0;Ee<130;Ee++)xe(Ee,Te),xe(Te,Ee)}),[Y,ee,32768]}(),B=l.context;this.gridBuffer=B.createVertexBuffer(x,C.boundsAttributes.members),this.gridIndexBuffer=B.createIndexBuffer(M),this.gridSegments=C.SegmentVector.simpleSegment(0,0,x.length,M.length),this.gridNoSkirtSegments=C.SegmentVector.simpleSegment(0,0,x.length,D),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new oc(d.map),this.orthoMatrix=C.create$1(),C.ortho(this.orthoMatrix,0,C.EXTENT,0,C.EXTENT,0,1);const G=B.gl;this._overlapStencilMode=new C.StencilMode({func:G.GEQUAL,mask:255},0,255,G.KEEP,G.KEEP,G.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),l.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=l,this._checkRenderCacheEfficiency()}update(l,d,x){if(l&&l.terrain){this._style!==l&&(this.style=l),this.enabled=!0;const M=l.terrain.properties;this.sourceCache=l._getSourceCache(M.get("source")),this._exaggeration=M.get("exaggeration");const D=()=>{this.sourceCache.used&&C.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const B=this.sourceCache.getSource().tileSize/128,G=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(d,B*G,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,D(),this._initializing=!0),D(),d.updateElevation(!x),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const l=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==l.efficiency&&C.warnOnce(`Terrain render cache efficiency is not optimal (${l.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${l.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(l){l.coord&&"source"===l.dataType?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):"style"===l.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._sourceCaches)this._style._sourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,x=this.painter.transform;this._initializing&&(this._initializing=0===x._centerAltitude&&-1===this.getAtPointOrZero(C.MercatorCoordinate.fromLngLat(x.center),-1),this._emptyDEMTextureDirty=!this._initializing);const M=this.proxyCoords=d.getIds().map(W=>{const Y=d.getTileByID(W).tileID;return Y.projMatrix=x.calculateProjMatrix(Y.toUnwrapped()),Y});(function(W,Y){const ee=Y.transform.pointCoordinate(Y.transform.getCameraPoint()),Q=new C.pointGeometry(ee.x,ee.y);W.sort((le,de)=>{if(de.overscaledZ-le.overscaledZ)return de.overscaledZ-le.overscaledZ;const ge=new C.pointGeometry(le.canonical.x+(1<<le.canonical.z)*le.wrap,le.canonical.y),xe=new C.pointGeometry(de.canonical.x+(1<<de.canonical.z)*de.wrap,de.canonical.y),Te=Q.mult(1<<le.canonical.z);return Te.x-=.5,Te.y-=.5,Te.distSqr(ge)-Te.distSqr(xe)})})(M,this.painter),this._previousZoom=x.zoom;const D=this.proxyToSource||{};this.proxyToSource={},M.forEach(W=>{this.proxyToSource[W.key]={}}),this.terrainTileForTile={};const B=this._style._sourceCaches;for(const W in B){const Y=B[W];if(!Y.used||(Y!==this.sourceCache&&(this._findCoveringTileCache[Y.id]={}),this._setupProxiedCoordsForOrtho(Y,l[W],D),Y.usedForTerrain))continue;const ee=l[W];Y.getSource().reparseOverscaled&&this._assignTerrainTiles(ee)}this.proxiedCoords[d.id]=M.map(W=>new ya(W,W.key,this.orthoMatrix)),this._assignTerrainTiles(M),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(D),this.renderingToTexture=!1,this._updateTimestamp=C.exported.now();const G={};this._visibleDemTiles=[];for(const W of this.proxyCoords){const Y=this.terrainTileForTile[W.key];if(!Y)continue;const ee=Y.tileID.key;ee in G||(this._visibleDemTiles.push(Y),G[ee]=ee)}}_assignTerrainTiles(l){this._initializing||l.forEach(d=>{if(this.terrainTileForTile[d.key])return;const x=this._findTileCoveringTileID(d,this.sourceCache);x&&(this.terrainTileForTile[d.key]=x)})}_prepareDEMTextures(){const l=this.painter.context,d=l.gl;for(const x in this.terrainTileForTile){const M=this.terrainTileForTile[x],D=M.dem;!D||M.demTexture&&!M.needsDEMTextureUpload||(l.activeTexture.set(d.TEXTURE1),Eh(this.painter,M,D))}}_prepareDemTileUniforms(l,d,x,M){if(!d||null==d.demTexture)return!1;const D=l.tileID.canonical,B=Math.pow(2,d.tileID.canonical.z-D.z),G=M||"";return x[`u_dem_tl${G}`]=[D.x*B%1,D.y*B%1],x[`u_dem_scale${G}`]=B,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let l=0;const d=this._visibleDemTiles.reduce((x,M)=>{if(!M.dem)return x;const D=M.dem.tree.minimums[0];return D>0&&l++,x+D},0);return l?d/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,d=l.gl;l.activeTexture.set(d.TEXTURE2);const x=this._getLoadedAreaMinimum(),M={width:1,height:1,data:new Uint8Array(C.DEMData.pack(x,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let D=this._emptyDEMTexture;return D?D.update(M,{premultiply:!1}):D=this._emptyDEMTexture=new C.Texture(l,M,d.RGBA,{premultiply:!1}),D}setupElevationDraw(l,d,x){const M=this.painter.context,D=M.gl,B=(G=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:C.DEMData.getUnpackVector(G),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var G;B.u_dem_size=this.sourceCache.getSource().tileSize,B.u_exaggeration=this.exaggeration();let W=null,Y=null,ee=1;if(x&&x.morphing&&this._useVertexMorphing){const Q=x.morphing.srcDemTile,le=x.morphing.dstDemTile;ee=x.morphing.phase,Q&&le&&(this._prepareDemTileUniforms(l,Q,B,"_prev")&&(Y=Q),this._prepareDemTileUniforms(l,le,B)&&(W=le))}if(Y&&W?(M.activeTexture.set(D.TEXTURE2),W.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE,D.NEAREST),M.activeTexture.set(D.TEXTURE4),Y.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE,D.NEAREST),B.u_dem_lerp=ee):(W=this.terrainTileForTile[l.tileID.key],M.activeTexture.set(D.TEXTURE2),(this._prepareDemTileUniforms(l,W,B)?W.demTexture:this.emptyDEMTexture).bind(D.NEAREST,D.CLAMP_TO_EDGE)),x&&x.useDepthForOcclusion&&(M.activeTexture.set(D.TEXTURE3),this._depthTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE),B.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),x&&x.useMeterToDem&&W){const Q=(1<<W.tileID.canonical.z)*C.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;B.u_meter_to_dem=Q}x&&x.labelPlaneMatrixInv&&(B.u_label_plane_matrix_inv=x.labelPlaneMatrixInv),d.setTerrainUniformValues(M,B)}renderToBackBuffer(l){const d=this.painter,x=this.painter.context;0!==l.length&&(x.bindFramebuffer.set(null),x.viewport.set([0,0,d.width,d.height]),this.renderingToTexture=!1,function(M,D,B,G,W){const Y=M.context,ee=Y.gl;let Q,le;const de=M.options.showTerrainWireframe?2:0,ge=(Le,Me)=>{if(le===Le)return;const Ue=[Zh[Le]];Me&&Ue.push(Zh[de]),Q=M.useProgram("terrainRaster",null,Ue),le=Le},xe=M.colorModeForRenderPass(),Te=new C.DepthMode(ee.LEQUAL,C.DepthMode.ReadWrite,M.depthRangeFor3D);ka.update(W);const Ee=M.transform,Pe=6*Math.pow(1.5,22-Ee.zoom)*D.exaggeration();(de?[!1,!0]:[!1]).forEach(Le=>{le=-1;const Me=Le?ee.LINES:ee.TRIANGLES,[Ue,Ye]=Le?D.getWirefameBuffer():[D.gridIndexBuffer,D.gridSegments];for(const Ot of G){const dt=B.getTile(Ot),Nt=C.StencilMode.disabled,wt=D.prevTerrainTileForTile[Ot.key],Zt=D.terrainTileForTile[Ot.key];gt=Zt,null!=(yt=wt)&&null!=gt&&yt.hasData()&&gt.hasData()&&null!=yt.demTexture&&null!=gt.demTexture&&yt.tileID.key!==gt.tileID.key&&ka.newMorphing(Ot.key,wt,Zt,W,250),Y.activeTexture.set(ee.TEXTURE0),dt.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const ft=ka.getMorphValuesForProxy(Ot.key),Gt=ft?1:0;let Qt;ft&&(Qt={morphing:{srcDemTile:ft.from,dstDemTile:ft.to,phase:C.easeCubicInOut(ft.phase)}});const mn=th(Ot.projMatrix,ic(Ot.canonical,Ee.renderWorldCopies)?Pe/10:Pe);ge(Gt,Le),D.setupElevationDraw(dt,Q,Qt),M.prepareDrawProgram(Y,Q,Ot.toUnwrapped()),Q.draw(Y,Me,Te,Nt,xe,C.CullFaceMode.backCCW,mn,"terrain_raster",D.gridBuffer,Ue,Ye)}var yt,gt})}(d,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,l.splice(0,l.length))}renderBatch(l){if(0===this._drapedRenderBatches.length)return l+1;this.renderingToTexture=!0;const d=this.painter,x=this.painter.context,M=this.proxySourceCache,D=this.proxiedCoords[M.id],B=this._drapedRenderBatches.shift(),G=[],W=d.style.order;let Y=0;for(const ee of D){const Q=M.getTileByID(ee.proxyTileKey),le=M.proxyCachedFBO[ee.key]?M.proxyCachedFBO[ee.key][l]:void 0,de=void 0!==le?M.renderCache[le]:this.pool[Y++],ge=void 0!==le;if(Q.texture=de.tex,ge&&!de.dirty){G.push(Q.tileID);continue}let xe;x.bindFramebuffer.set(de.fb.framebuffer),this.renderedToTile=!1,de.dirty&&(x.clear({color:C.Color.transparent}),de.dirty=!1);for(let Te=B.start;Te<=B.end;++Te){const Ee=d.style._layers[W[Te]];if(Ee.isHidden(d.transform.zoom))continue;const Pe=d.style._getLayerSourceCache(Ee),Le=Pe?this.proxyToSource[ee.key][Pe.id]:[ee];if(!Le)continue;const Me=Le;x.viewport.set([0,0,de.fb.width,de.fb.height]),xe!==(Pe?Pe.id:null)&&(this._setupStencil(de,Le,Ee,Pe),xe=Pe?Pe.id:null),d.renderLayer(d,Pe,Ee,Me)}this.renderedToTile?(de.dirty=!0,G.push(Q.tileID)):ge||--Y,5===Y&&(Y=0,this.renderToBackBuffer(G))}return this.renderToBackBuffer(G),this.renderingToTexture=!1,x.bindFramebuffer.set(null),x.viewport.set([0,0,d.width,d.height]),B.end+1}postRender(){}renderCacheEfficiency(l){const d=l.order.length;if(0===d)return{efficiency:100};let x,M=0,D=0,B=!1;for(let G=0;G<d;++G){const W=l._layers[l.order[G]];this._style.isLayerDraped(W)?(B&&++M,++D):B||(B=!0,x=W.id)}return 0===D?{efficiency:100}:{efficiency:100*(1-M/D),firstUndrapedLayer:x}}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{l=Math.min(l,d.dem.tree.minimums[0])}),0===l?l:(l-30)*this._exaggeration}raycast(l,d,x){if(!this._visibleDemTiles)return null;const M=this._visibleDemTiles.filter(D=>D.dem).map(D=>{const B=D.tileID,G=Math.pow(2,B.overscaledZ),{x:W,y:Y}=B.canonical,ee=W/G,Q=(W+1)/G,le=Y/G,de=(Y+1)/G;return{minx:ee,miny:le,maxx:Q,maxy:de,t:D.dem.tree.raycastRoot(ee,le,Q,de,l,d,x),tile:D}});M.sort((D,B)=>(null!==D.t?D.t:Number.MAX_VALUE)-(null!==B.t?B.t:Number.MAX_VALUE));for(const D of M){if(null==D.t)return null;const B=D.tile.dem.tree.raycast(D.minx,D.miny,D.maxx,D.maxy,l,d,x);if(null!=B)return B}return null}_createFBO(){const l=this.painter.context,d=l.gl,x=this.drapeBufferSize;l.activeTexture.set(d.TEXTURE0);const M=new C.Texture(l,{width:x[0],height:x[1],data:null},d.RGBA);M.bind(d.LINEAR,d.CLAMP_TO_EDGE);const D=l.createFramebuffer(x[0],x[1],!1);return D.colorAttachment.set(M.texture),D.depthAttachment=new Da(l,D.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,x[0],x[1]),this._stencilRef=0,D.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):D.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&!l.extTextureFilterAnisotropicForceOff&&d.texParameterf(d.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:D,tex:M,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const d=this._style._layers[l],x=d.isHidden(this.painter.transform.zoom),M=d.getCrossfadeParameters(),D=!!M&&1!==M.t,B=d.hasTransition();return"custom"!==d.type&&!x&&(D||B)})}_clearRasterFadeFromRenderCache(){let l=!1;for(const d in this._style._sourceCaches)if(this._style._sourceCaches[d]._source instanceof De){l=!0;break}if(l)for(let d=0;d<this._style.order.length;++d){const x=this._style._layers[this._style.order[d]],M=x.isHidden(this.painter.transform.zoom),D=this._style._getLayerSourceCache(x);if("raster"!==x.type||M||!D)continue;const B=x.paint.get("raster-fade-duration");for(const G of this.proxyCoords){const W=this.proxyToSource[G.key][D.id];if(W)for(const Y of W){const ee=Sh(D.getTile(Y),D.findLoadedParent(Y,0),D,this.painter.transform,B);(1!==ee.opacity||0!==ee.mix)&&this._clearRenderCacheForTile(D.id,Y)}}}}_setupDrapedRenderBatches(){const l=this._style.order,d=l.length;if(0===d)return;const x=[];let M,D=0,B=this._style._layers[l[D]];for(;!this._style.isLayerDraped(B)&&B.isHidden(this.painter.transform.zoom)&&++D<d;)B=this._style._layers[l[D]];for(;D<d;++D){const G=this._style._layers[l[D]];G.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(G)?void 0===M&&(M=D):void 0!==M&&(x.push({start:M,end:D-1}),M=void 0))}void 0!==M&&x.push({start:M,end:D-1}),this._drapedRenderBatches=x}_setupRenderCache(l){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const B=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let G=0;G<B.length;++G){const W=Object.values(B[G]);d.renderCachePool.push(...W)}}return}this._clearRasterFadeFromRenderCache();const x=this.proxyCoords,M=this._tilesDirty;for(let B=x.length-1;B>=0;B--){const G=x[B];if(d.getTileByID(G.key),void 0!==d.proxyCachedFBO[G.key]){const W=l[G.key],Y=this.proxyToSource[G.key];let ee=0;for(const Q in Y){const le=Y[Q],de=W[Q];if(!de||de.length!==le.length||le.some((ge,xe)=>ge!==de[xe]||M[Q]&&M[Q].hasOwnProperty(ge.key))){ee=-1;break}++ee}for(const Q in d.proxyCachedFBO[G.key])d.renderCache[d.proxyCachedFBO[G.key][Q]].dirty=ee<0||ee!==Object.values(W).length}}const D=[...this._drapedRenderBatches];D.sort((B,G)=>G.end-G.start-(B.end-B.start));for(const B of D)for(const G of x){if(d.proxyCachedFBO[G.key])continue;let W=d.renderCachePool.pop();void 0===W&&d.renderCache.length<50&&(W=d.renderCache.length,d.renderCache.push(this._createFBO())),void 0!==W&&(d.proxyCachedFBO[G.key]={},d.proxyCachedFBO[G.key][B.start]=W,d.renderCache[W].dirty=!0)}this._tilesDirty={}}_setupStencil(l,d,x,M){if(!M||!this._sourceTilesOverlap[M.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const D=this.painter.context,B=D.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let G;if(x.isTileClipped())G=d.length,this._overlapStencilMode.test={func:B.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);G=1,this._overlapStencilMode.test={func:B.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+G>255&&(D.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=G,this._overlapStencilMode.ref=this._stencilRef,x.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):C.StencilMode.disabled}_renderTileClippingMasks(l,d){const x=this.painter,M=this.painter.context,D=M.gl;x._tileClippingMaskIDs={},M.setColorMode(C.ColorMode.disabled),M.setDepthMode(C.DepthMode.disabled);const B=x.useProgram("clippingMask");for(const G of l){const W=x._tileClippingMaskIDs[G.key]=--d;B.draw(M,D.TRIANGLES,C.DepthMode.disabled,new C.StencilMode({func:D.ALWAYS,mask:0},W,255,D.KEEP,D.KEEP,D.REPLACE),C.ColorMode.disabled,C.CullFaceMode.disabled,Di(G.projMatrix),"$clipping",x.tileExtentBuffer,x.quadTriangleIndexBuffer,x.tileExtentSegments)}}pointCoordinate(l){const d=this.painter.transform;if(l.x<0||l.x>d.width||l.y<0||l.y>d.height)return null;const x=[l.x,l.y,1,1];C.transformMat4(x,x,d.pixelMatrixInverse),C.scale$2(x,x,1/x[3]),x[0]/=d.worldSize,x[1]/=d.worldSize;const M=d._camera.position,D=C.mercatorZfromAltitude(1,d.center.lat),B=[M[0],M[1],M[2]/D,0],G=C.subtract([],x.slice(0,3),B);C.normalize(G,G);const W=this.raycast(B,G,this._exaggeration);return null!==W&&W?(C.scaleAndAdd(B,B,G,W),B[3]=B[2],B[2]*=D,B):null}drawDepth(){const l=this.painter,d=l.context,x=this.proxySourceCache,M=Math.ceil(l.width),D=Math.ceil(l.height);if(!this._depthFBO||this._depthFBO.width===M&&this._depthFBO.height===D||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const B=d.gl,G=d.createFramebuffer(M,D,!0);d.activeTexture.set(B.TEXTURE0);const W=new C.Texture(d,{width:M,height:D,data:null},B.RGBA);W.bind(B.NEAREST,B.CLAMP_TO_EDGE),G.colorAttachment.set(W.texture);const Y=d.createRenderbuffer(d.gl.DEPTH_COMPONENT16,M,D);G.depthAttachment.set(Y),this._depthFBO=G,this._depthTexture=W}d.bindFramebuffer.set(this._depthFBO.framebuffer),d.viewport.set([0,0,M,D]),function(B,G,W,Y){const ee=B.context,Q=ee.gl;ee.clear({depth:1});const le=B.useProgram("terrainDepth"),de=new C.DepthMode(Q.LESS,C.DepthMode.ReadWrite,B.depthRangeFor3D);for(const ge of Y){const xe=W.getTile(ge),Te=th(ge.projMatrix,0);G.setupElevationDraw(xe,le),le.draw(ee,Q.TRIANGLES,de,C.StencilMode.disabled,C.ColorMode.unblended,C.CullFaceMode.backCCW,Te,"terrain_depth",G.gridBuffer,G.gridIndexBuffer,G.gridNoSkirtSegments)}}(l,this,x,this.proxyCoords)}_setupProxiedCoordsForOrtho(l,d,x){if(l.getSource()instanceof se)return this._setupProxiedCoordsForImageSource(l,d,x);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const M=this.proxiedCoords[l.id]=[],D=this.proxyCoords;for(let G=0;G<D.length;G++){const W=D[G],Y=this._findTileCoveringTileID(W,l);if(Y){const ee=this._createProxiedId(W,Y,x[W.key]&&x[W.key][l.id]);M.push(ee),this.proxyToSource[W.key][l.id]=[ee]}}let B=!1;for(let G=0;G<d.length;G++){const W=l.getTile(d[G]);if(!W||!W.hasData())continue;const Y=this._findTileCoveringTileID(W.tileID,this.proxySourceCache);if(Y&&Y.tileID.canonical.z!==W.tileID.canonical.z){const ee=this.proxyToSource[Y.tileID.key][l.id],Q=this._createProxiedId(Y.tileID,W,x[Y.tileID.key]&&x[Y.tileID.key][l.id]);ee?ee.splice(ee.length-1,0,Q):this.proxyToSource[Y.tileID.key][l.id]=[Q],M.push(Q),B=!0}}this._sourceTilesOverlap[l.id]=B}_setupProxiedCoordsForImageSource(l,d,x){if(!l.getSource().loaded())return;const M=this.proxiedCoords[l.id]=[],D=this.proxyCoords,B=l.getSource(),G=new C.pointGeometry(B.tileID.x,B.tileID.y)._div(1<<B.tileID.z),W=B.coordinates.map(C.MercatorCoordinate.fromLngLat).reduce((ee,Q)=>(ee.min.x=Math.min(ee.min.x,Q.x-G.x),ee.min.y=Math.min(ee.min.y,Q.y-G.y),ee.max.x=Math.max(ee.max.x,Q.x-G.x),ee.max.y=Math.max(ee.max.y,Q.y-G.y),ee),{min:new C.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new C.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),Y=(ee,Q)=>{const le=ee.wrap+ee.canonical.x/(1<<ee.canonical.z),de=ee.canonical.y/(1<<ee.canonical.z),ge=C.EXTENT/(1<<ee.canonical.z),xe=Q.wrap+Q.canonical.x/(1<<Q.canonical.z),Te=Q.canonical.y/(1<<Q.canonical.z);return le+ge<xe+W.min.x||le>xe+W.max.x||de+ge<Te+W.min.y||de>Te+W.max.y};for(let ee=0;ee<D.length;ee++){const Q=D[ee];for(let le=0;le<d.length;le++){const de=l.getTile(d[le]);if(!de||!de.hasData()||Y(Q,de.tileID))continue;const ge=this._createProxiedId(Q,de,x[Q.key]&&x[Q.key][l.id]),xe=this.proxyToSource[Q.key][l.id];xe?xe.push(ge):this.proxyToSource[Q.key][l.id]=[ge],M.push(ge)}}}_createProxiedId(l,d,x){let M=this.orthoMatrix;if(x){const D=x.find(B=>B.key===d.tileID.key);if(D)return D}if(d.tileID.key!==l.key){const D=l.canonical.z-d.tileID.canonical.z;let B,G,W;M=C.create$1();const Y=d.tileID.wrap-l.wrap<<l.overscaledZ;D>0?(B=C.EXTENT>>D,G=B*((d.tileID.canonical.x<<D)-l.canonical.x+Y),W=B*((d.tileID.canonical.y<<D)-l.canonical.y)):(B=C.EXTENT<<-D,G=C.EXTENT*(d.tileID.canonical.x-(l.canonical.x+Y<<-D)),W=C.EXTENT*(d.tileID.canonical.y-(l.canonical.y<<-D))),C.ortho(M,0,B,0,B,0,1),C.translate(M,M,[G,W,0])}return new ya(d.tileID,l.key,M)}_findTileCoveringTileID(l,d){let x=d.getTile(l);if(x&&x.hasData())return x;const M=this._findCoveringTileCache[d.id],D=M[l.key];if(x=D?d.getTileByID(D):null,x&&x.hasData()||null===D)return x;let B=x?x.tileID:l,G=B.overscaledZ;const W=d.getSource().minzoom,Y=[];if(!D){const Q=d.getSource().maxzoom;if(l.canonical.z>=Q){const le=l.canonical.z-Q;d.getSource().reparseOverscaled?(G=Math.max(l.canonical.z+2,d.transform.tileZoom),B=new C.OverscaledTileID(G,l.wrap,Q,l.canonical.x>>le,l.canonical.y>>le)):0!==le&&(G=Q,B=new C.OverscaledTileID(G,l.wrap,Q,l.canonical.x>>le,l.canonical.y>>le))}B.key!==l.key&&(Y.push(B.key),x=d.getTile(B))}const ee=Q=>{Y.forEach(le=>{M[le]=Q}),Y.length=0};for(G-=1;G>=W&&(!x||!x.hasData());G--){x&&ee(x.tileID.key);const Q=B.calculateScaledKey(G);if(x=d.getTileByID(Q),x&&x.hasData())break;const le=M[Q];if(null===le)break;void 0===le?Y.push(Q):x=d.getTileByID(le)}return ee(x?x.tileID.key:null),x&&x.hasData()?x:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(l){this.renderedToTile=!0}_clearRenderCacheForTile(l,d){let x=this._tilesDirty[l];x||(x=this._tilesDirty[l]={}),x[d.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const l=function(d){let x,M,D;const B=new C.StructArrayLayout2ui4,G=131;for(M=1;M<129;M++){for(x=1;x<129;x++)D=M*G+x,B.emplaceBack(D,D+1),B.emplaceBack(D,D+G),B.emplaceBack(D+1,D+G),128===M&&B.emplaceBack(D+G,D+G+1);B.emplaceBack(D+1,D+1+G)}return B}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(l),this.wireframeSegments=C.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,l.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function yu(f){const l=[];for(let d=0;d<f.length;d++){if(null===f[d])continue;const x=f[d].split(" ");l.push(x.pop())}return l}class tu{static cacheKey(l,d,x){let M=`${l}${x?x.cacheKey:""}`;for(const D of d)M+=`/${D}`;return M}constructor(l,d,x,M,D,B){const G=l.gl;this.program=G.createProgram();const W=yu(x.staticAttributes),Y=M?M.getBinderAttributes():[],ee=W.concat(Y),Q=x.staticUniforms?yu(x.staticUniforms):[],le=M?M.getBinderUniforms():[],de=Q.concat(le),ge=[];for(const Ue of de)ge.indexOf(Ue)<0&&ge.push(Ue);let xe=M?M.defines():[];xe=xe.concat(B.map(Ue=>`#define ${Ue}`));const Te=xe.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ch,nc.fragmentSource,oi.fragmentSource,x.fragmentSource).join("\n"),Ee=xe.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ch,nc.vertexSource,oi.vertexSource,wh.vertexSource,x.vertexSource).join("\n"),Pe=G.createShader(G.FRAGMENT_SHADER);if(G.isContextLost())return void(this.failedToCreate=!0);G.shaderSource(Pe,Te),G.compileShader(Pe),G.attachShader(this.program,Pe);const Le=G.createShader(G.VERTEX_SHADER);if(G.isContextLost())return void(this.failedToCreate=!0);G.shaderSource(Le,Ee),G.compileShader(Le),G.attachShader(this.program,Le),this.attributes={};const Me={};this.numAttributes=ee.length;for(let Ue=0;Ue<this.numAttributes;Ue++)ee[Ue]&&(G.bindAttribLocation(this.program,Ue,ee[Ue]),this.attributes[ee[Ue]]=Ue);G.linkProgram(this.program),G.deleteShader(Le),G.deleteShader(Pe);for(let Ue=0;Ue<ge.length;Ue++){const Ye=ge[Ue];if(Ye&&!Me[Ye]){const yt=G.getUniformLocation(this.program,Ye);yt&&(Me[Ye]=yt)}}var Ue,Ye;this.fixedUniforms=D(l,Me),this.binderUniforms=M?M.getUniforms(l,Me):[],-1!==B.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new C.Uniform1i(Ue=l,(Ye=Me).u_dem),u_dem_prev:new C.Uniform1i(Ue,Ye.u_dem_prev),u_dem_unpack:new C.Uniform4f(Ue,Ye.u_dem_unpack),u_dem_tl:new C.Uniform2f(Ue,Ye.u_dem_tl),u_dem_scale:new C.Uniform1f(Ue,Ye.u_dem_scale),u_dem_tl_prev:new C.Uniform2f(Ue,Ye.u_dem_tl_prev),u_dem_scale_prev:new C.Uniform1f(Ue,Ye.u_dem_scale_prev),u_dem_size:new C.Uniform1f(Ue,Ye.u_dem_size),u_dem_lerp:new C.Uniform1f(Ue,Ye.u_dem_lerp),u_exaggeration:new C.Uniform1f(Ue,Ye.u_exaggeration),u_depth:new C.Uniform1i(Ue,Ye.u_depth),u_depth_size_inv:new C.Uniform2f(Ue,Ye.u_depth_size_inv),u_meter_to_dem:new C.Uniform1f(Ue,Ye.u_meter_to_dem),u_label_plane_matrix_inv:new C.UniformMatrix4f(Ue,Ye.u_label_plane_matrix_inv),u_tile_tl_up:new C.Uniform3f(Ue,Ye.u_tile_tl_up),u_tile_tr_up:new C.Uniform3f(Ue,Ye.u_tile_tr_up),u_tile_br_up:new C.Uniform3f(Ue,Ye.u_tile_br_up),u_tile_bl_up:new C.Uniform3f(Ue,Ye.u_tile_bl_up),u_tile_up_scale:new C.Uniform1f(Ue,Ye.u_tile_up_scale)}),-1!==B.indexOf("FOG")&&(this.fogUniforms=((Ue,Ye)=>({u_fog_matrix:new C.UniformMatrix4f(Ue,Ye.u_fog_matrix),u_fog_range:new C.Uniform2f(Ue,Ye.u_fog_range),u_fog_color:new C.Uniform4f(Ue,Ye.u_fog_color),u_fog_horizon_blend:new C.Uniform1f(Ue,Ye.u_fog_horizon_blend),u_fog_temporal_offset:new C.Uniform1f(Ue,Ye.u_fog_temporal_offset)}))(l,Me))}setTerrainUniformValues(l,d){if(!this.terrainUniforms)return;const x=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const M in d)x[M].set(d[M])}}setFogUniformValues(l,d){if(!this.fogUniforms)return;const x=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const M in d)x[M].location&&x[M].set(d[M])}}draw(l,d,x,M,D,B,G,W,Y,ee,Q,le,de,ge,xe,Te){const Ee=l.gl;if(this.failedToCreate)return;l.program.set(this.program),l.setDepthMode(x),l.setStencilMode(M),l.setColorMode(D),l.setCullFace(B);for(const Le in this.fixedUniforms)this.fixedUniforms[Le].set(G[Le]);ge&&ge.setUniforms(l,this.binderUniforms,le,{zoom:de});const Pe={[Ee.LINES]:2,[Ee.TRIANGLES]:3,[Ee.LINE_STRIP]:1}[d];for(const Le of Q.get()){const Me=Le.vaos||(Le.vaos={});(Me[W]||(Me[W]=new Pp)).bind(l,this,Y,ge?ge.getPaintVertexBuffers():[],ee,Le.vertexOffset,xe,Te),Ee.drawElements(d,Le.primitiveLength*Pe,Ee.UNSIGNED_SHORT,Le.primitiveOffset*Pe*2)}}}function Th(f,l,d){const x=1/vr(d,1,l.transform.tileZoom),M=Math.pow(2,d.tileID.overscaledZ),D=d.tileSize*Math.pow(2,l.transform.tileZoom)/M,B=D*(d.tileID.canonical.x+d.tileID.wrap*M),G=D*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[x,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[B>>16,G>>16],u_pixel_coord_lower:[65535&B,65535&G]}}const Oo=(f,l,d,x)=>{const M=l.style.light,D=M.properties.get("position"),B=[D.x,D.y,D.z],G=C.create$2();"viewport"===M.properties.get("anchor")&&(C.fromRotation(G,-l.transform.angle),C.transformMat3(B,B,G));const W=M.properties.get("color");return{u_matrix:f,u_lightpos:B,u_lightintensity:M.properties.get("intensity"),u_lightcolor:[W.r,W.g,W.b],u_vertical_gradient:+d,u_opacity:x}},bl=(f,l,d,x,M,D,B)=>C.extend(Oo(f,l,d,x),Th(D,l,B),{u_height_factor:-Math.pow(2,M.overscaledZ)/B.tileSize/8}),Pc=f=>({u_matrix:f}),ju=(f,l,d,x)=>C.extend(Pc(f),Th(d,l,x)),eo=(f,l)=>({u_matrix:f,u_world:l}),Td=(f,l,d,x,M)=>C.extend(ju(f,l,d,x),{u_world:M}),zl=(f,l,d,x)=>{const M=f.transform;let D;return D="map"===x.paint.get("circle-pitch-alignment")?M.calculatePixelsToTileUnitsMatrix(d):new Float32Array([M.pixelsToGLUnits[0],0,0,M.pixelsToGLUnits[1]]),{u_camera_to_center_distance:M.cameraToCenterDistance,u_matrix:f.translatePosMatrix(l.projMatrix,d,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_device_pixel_ratio:C.exported.devicePixelRatio,u_extrude_scale:D}},nd=f=>{const l=[];return"map"===f.paint.get("circle-pitch-alignment")&&l.push("PITCH_WITH_MAP"),"map"===f.paint.get("circle-pitch-scale")&&l.push("SCALE_WITH_MAP"),l},nu=(f,l,d)=>{const x=C.EXTENT/d.tileSize;return{u_matrix:f,u_camera_to_center_distance:l.cameraToCenterDistance,u_extrude_scale:[l.pixelsToGLUnits[0]/x,l.pixelsToGLUnits[1]/x]}},Gi=(f,l,d=1)=>({u_matrix:f,u_color:l,u_overlay:0,u_overlay_scale:d}),Rc=(f,l,d,x)=>({u_matrix:f,u_extrude_scale:vr(l,1,d),u_intensity:x}),Hh=(f,l,d,x,M,D)=>{const B=f.transform,G=B.calculatePixelsToTileUnitsMatrix(l),W={u_matrix:Ca(f,l,d,M),u_pixels_to_tile_units:G,u_device_pixel_ratio:C.exported.devicePixelRatio,u_units_to_pixels:[1/B.pixelsToGLUnits[0],1/B.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:D,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0};if(Nl(d)){const Y=Ms(l,f.transform);W.u_texsize=l.lineAtlasTexture.size,W.u_scale=[Y,x.fromScale,x.toScale],W.u_mix=x.t}return W},Pa=(f,l,d,x,M)=>{const D=f.transform,B=Ms(l,D);return{u_matrix:Ca(f,l,d,M),u_texsize:l.imageAtlasTexture.size,u_pixels_to_tile_units:D.calculatePixelsToTileUnitsMatrix(l),u_device_pixel_ratio:C.exported.devicePixelRatio,u_image:0,u_scale:[B,x.fromScale,x.toScale],u_fade:x.t,u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]]}};function Ms(f,l){return 1/vr(f,1,l.tileZoom)}function Ca(f,l,d,x){return f.translatePosMatrix(x||l.tileID.projMatrix,l,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const vu=f=>{const l=[];return Nl(f)&&l.push("RENDER_LINE_DASH"),f.paint.get("line-gradient")&&l.push("RENDER_LINE_GRADIENT"),l};function Nl(f){const l=f.paint.get("line-dasharray").value;return l.value||"constant"!==l.kind}const Ks=(f,l,d,x,M)=>{return{u_matrix:f,u_tl_parent:l,u_scale_parent:d,u_buffer_scale:1,u_fade_t:x.mix,u_opacity:x.opacity*M.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:M.paint.get("raster-brightness-min"),u_brightness_high:M.paint.get("raster-brightness-max"),u_saturation_factor:(B=M.paint.get("raster-saturation"),B>0?1-1/(1.001-B):-B),u_contrast_factor:(D=M.paint.get("raster-contrast"),D>0?1/(1-D):1+D),u_spin_weights:Uu(M.paint.get("raster-hue-rotate"))};var D,B};function Uu(f){f*=Math.PI/180;const l=Math.sin(f),d=Math.cos(f);return[(2*d+1)/3,(-Math.sqrt(3)*l-d+1)/3,(Math.sqrt(3)*l-d+1)/3]}const Oc=(f,l,d,x,M,D,B,G,W,Y,ee,Q,le,de)=>{const ge=M.transform;return{u_is_size_zoom_constant:+("constant"===f||"source"===f),u_is_size_feature_constant:+("constant"===f||"camera"===f),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:ge.cameraToCenterDistance,u_pitch:ge.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:ge.width/ge.height,u_fade_change:M.options.fadeDuration?M.symbolFadeChange:1,u_matrix:D,u_label_plane_matrix:B,u_coord_matrix:G,u_is_text:+W,u_pitch_with_map:+x,u_texsize:Y,u_tile_id:ee,u_zoom_transition:Q,u_inv_rot_matrix:le,u_merc_center:de,u_texture:0}},Ki=(f,l,d,x,M,D,B,G,W,Y,ee,Q,le,de,ge)=>{const{cameraToCenterDistance:xe,_pitch:Te}=M.transform;return C.extend(Oc(f,l,d,x,M,D,B,G,W,Y,Q,le,de,ge),{u_gamma_scale:x?xe*Math.cos(M.terrain?0:Te):1,u_device_pixel_ratio:C.exported.devicePixelRatio,u_is_halo:+ee})},Ih=(f,l,d,x,M,D,B,G,W,Y,ee,Q,le,de)=>C.extend(Ki(f,l,d,x,M,D,B,G,!0,W,!0,ee,Q,le,de),{u_texsize_icon:Y,u_texture_icon:1}),Vs=(f,l,d)=>({u_matrix:f,u_opacity:l,u_color:d}),Ba=(f,l,d,x,M,D)=>C.extend(function(B,G,W,Y){const ee=W.imageManager.getPattern(B.from.toString()),Q=W.imageManager.getPattern(B.to.toString()),{width:le,height:de}=W.imageManager.getPixelSize(),ge=Math.pow(2,Y.tileID.overscaledZ),xe=Y.tileSize*Math.pow(2,W.transform.tileZoom)/ge,Te=xe*(Y.tileID.canonical.x+Y.tileID.wrap*ge),Ee=xe*Y.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ee.tl,u_pattern_br_a:ee.br,u_pattern_tl_b:Q.tl,u_pattern_br_b:Q.br,u_texsize:[le,de],u_mix:G.t,u_pattern_size_a:ee.displaySize,u_pattern_size_b:Q.displaySize,u_scale_a:G.fromScale,u_scale_b:G.toScale,u_tile_units_to_pixels:1/vr(Y,1,W.transform.tileZoom),u_pixel_coord_upper:[Te>>16,Ee>>16],u_pixel_coord_lower:[65535&Te,65535&Ee]}}(x,D,d,M),{u_matrix:f,u_opacity:l}),Rp={fillExtrusion:(f,l)=>({u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_lightpos:new C.Uniform3f(f,l.u_lightpos),u_lightintensity:new C.Uniform1f(f,l.u_lightintensity),u_lightcolor:new C.Uniform3f(f,l.u_lightcolor),u_vertical_gradient:new C.Uniform1f(f,l.u_vertical_gradient),u_opacity:new C.Uniform1f(f,l.u_opacity)}),fillExtrusionPattern:(f,l)=>({u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_lightpos:new C.Uniform3f(f,l.u_lightpos),u_lightintensity:new C.Uniform1f(f,l.u_lightintensity),u_lightcolor:new C.Uniform3f(f,l.u_lightcolor),u_vertical_gradient:new C.Uniform1f(f,l.u_vertical_gradient),u_height_factor:new C.Uniform1f(f,l.u_height_factor),u_image:new C.Uniform1i(f,l.u_image),u_texsize:new C.Uniform2f(f,l.u_texsize),u_pixel_coord_upper:new C.Uniform2f(f,l.u_pixel_coord_upper),u_pixel_coord_lower:new C.Uniform2f(f,l.u_pixel_coord_lower),u_scale:new C.Uniform3f(f,l.u_scale),u_fade:new C.Uniform1f(f,l.u_fade),u_opacity:new C.Uniform1f(f,l.u_opacity)}),fill:(f,l)=>({u_matrix:new C.UniformMatrix4f(f,l.u_matrix)}),fillPattern:(f,l)=>({u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_image:new C.Uniform1i(f,l.u_image),u_texsize:new C.Uniform2f(f,l.u_texsize),u_pixel_coord_upper:new C.Uniform2f(f,l.u_pixel_coord_upper),u_pixel_coord_lower:new C.Uniform2f(f,l.u_pixel_coord_lower),u_scale:new C.Uniform3f(f,l.u_scale),u_fade:new C.Uniform1f(f,l.u_fade)}),fillOutline:(f,l)=>({u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_world:new C.Uniform2f(f,l.u_world)}),fillOutlinePattern:(f,l)=>({u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_world:new C.Uniform2f(f,l.u_world),u_image:new C.Uniform1i(f,l.u_image),u_texsize:new C.Uniform2f(f,l.u_texsize),u_pixel_coord_upper:new C.Uniform2f(f,l.u_pixel_coord_upper),u_pixel_coord_lower:new C.Uniform2f(f,l.u_pixel_coord_lower),u_scale:new C.Uniform3f(f,l.u_scale),u_fade:new C.Uniform1f(f,l.u_fade)}),circle:(f,l)=>({u_camera_to_center_distance:new C.Uniform1f(f,l.u_camera_to_center_distance),u_extrude_scale:new C.UniformMatrix2f(f,l.u_extrude_scale),u_device_pixel_ratio:new C.Uniform1f(f,l.u_device_pixel_ratio),u_matrix:new C.UniformMatrix4f(f,l.u_matrix)}),collisionBox:(f,l)=>({u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_camera_to_center_distance:new C.Uniform1f(f,l.u_camera_to_center_distance),u_extrude_scale:new C.Uniform2f(f,l.u_extrude_scale)}),collisionCircle:(f,l)=>({u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_inv_matrix:new C.UniformMatrix4f(f,l.u_inv_matrix),u_camera_to_center_distance:new C.Uniform1f(f,l.u_camera_to_center_distance),u_viewport_size:new C.Uniform2f(f,l.u_viewport_size)}),debug:(f,l)=>({u_color:new C.UniformColor(f,l.u_color),u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_overlay:new C.Uniform1i(f,l.u_overlay),u_overlay_scale:new C.Uniform1f(f,l.u_overlay_scale)}),clippingMask:(f,l)=>({u_matrix:new C.UniformMatrix4f(f,l.u_matrix)}),heatmap:(f,l)=>({u_extrude_scale:new C.Uniform1f(f,l.u_extrude_scale),u_intensity:new C.Uniform1f(f,l.u_intensity),u_matrix:new C.UniformMatrix4f(f,l.u_matrix)}),heatmapTexture:(f,l)=>({u_image:new C.Uniform1i(f,l.u_image),u_color_ramp:new C.Uniform1i(f,l.u_color_ramp),u_opacity:new C.Uniform1f(f,l.u_opacity)}),hillshade:(f,l)=>({u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_image:new C.Uniform1i(f,l.u_image),u_latrange:new C.Uniform2f(f,l.u_latrange),u_light:new C.Uniform2f(f,l.u_light),u_shadow:new C.UniformColor(f,l.u_shadow),u_highlight:new C.UniformColor(f,l.u_highlight),u_accent:new C.UniformColor(f,l.u_accent)}),hillshadePrepare:(f,l)=>({u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_image:new C.Uniform1i(f,l.u_image),u_dimension:new C.Uniform2f(f,l.u_dimension),u_zoom:new C.Uniform1f(f,l.u_zoom),u_unpack:new C.Uniform4f(f,l.u_unpack)}),line:(f,l)=>({u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_pixels_to_tile_units:new C.UniformMatrix2f(f,l.u_pixels_to_tile_units),u_device_pixel_ratio:new C.Uniform1f(f,l.u_device_pixel_ratio),u_units_to_pixels:new C.Uniform2f(f,l.u_units_to_pixels),u_dash_image:new C.Uniform1i(f,l.u_dash_image),u_gradient_image:new C.Uniform1i(f,l.u_gradient_image),u_image_height:new C.Uniform1f(f,l.u_image_height),u_texsize:new C.Uniform2f(f,l.u_texsize),u_scale:new C.Uniform3f(f,l.u_scale),u_mix:new C.Uniform1f(f,l.u_mix)}),linePattern:(f,l)=>({u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_texsize:new C.Uniform2f(f,l.u_texsize),u_pixels_to_tile_units:new C.UniformMatrix2f(f,l.u_pixels_to_tile_units),u_device_pixel_ratio:new C.Uniform1f(f,l.u_device_pixel_ratio),u_image:new C.Uniform1i(f,l.u_image),u_units_to_pixels:new C.Uniform2f(f,l.u_units_to_pixels),u_scale:new C.Uniform3f(f,l.u_scale),u_fade:new C.Uniform1f(f,l.u_fade)}),raster:(f,l)=>({u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_tl_parent:new C.Uniform2f(f,l.u_tl_parent),u_scale_parent:new C.Uniform1f(f,l.u_scale_parent),u_buffer_scale:new C.Uniform1f(f,l.u_buffer_scale),u_fade_t:new C.Uniform1f(f,l.u_fade_t),u_opacity:new C.Uniform1f(f,l.u_opacity),u_image0:new C.Uniform1i(f,l.u_image0),u_image1:new C.Uniform1i(f,l.u_image1),u_brightness_low:new C.Uniform1f(f,l.u_brightness_low),u_brightness_high:new C.Uniform1f(f,l.u_brightness_high),u_saturation_factor:new C.Uniform1f(f,l.u_saturation_factor),u_contrast_factor:new C.Uniform1f(f,l.u_contrast_factor),u_spin_weights:new C.Uniform3f(f,l.u_spin_weights)}),symbolIcon:(f,l)=>({u_is_size_zoom_constant:new C.Uniform1i(f,l.u_is_size_zoom_constant),u_is_size_feature_constant:new C.Uniform1i(f,l.u_is_size_feature_constant),u_size_t:new C.Uniform1f(f,l.u_size_t),u_size:new C.Uniform1f(f,l.u_size),u_camera_to_center_distance:new C.Uniform1f(f,l.u_camera_to_center_distance),u_pitch:new C.Uniform1f(f,l.u_pitch),u_rotate_symbol:new C.Uniform1i(f,l.u_rotate_symbol),u_aspect_ratio:new C.Uniform1f(f,l.u_aspect_ratio),u_fade_change:new C.Uniform1f(f,l.u_fade_change),u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_label_plane_matrix:new C.UniformMatrix4f(f,l.u_label_plane_matrix),u_coord_matrix:new C.UniformMatrix4f(f,l.u_coord_matrix),u_is_text:new C.Uniform1i(f,l.u_is_text),u_pitch_with_map:new C.Uniform1i(f,l.u_pitch_with_map),u_texsize:new C.Uniform2f(f,l.u_texsize),u_tile_id:new C.Uniform3f(f,l.u_tile_id),u_zoom_transition:new C.Uniform1f(f,l.u_zoom_transition),u_inv_rot_matrix:new C.UniformMatrix4f(f,l.u_inv_rot_matrix),u_merc_center:new C.Uniform2f(f,l.u_merc_center),u_texture:new C.Uniform1i(f,l.u_texture)}),symbolSDF:(f,l)=>({u_is_size_zoom_constant:new C.Uniform1i(f,l.u_is_size_zoom_constant),u_is_size_feature_constant:new C.Uniform1i(f,l.u_is_size_feature_constant),u_size_t:new C.Uniform1f(f,l.u_size_t),u_size:new C.Uniform1f(f,l.u_size),u_camera_to_center_distance:new C.Uniform1f(f,l.u_camera_to_center_distance),u_pitch:new C.Uniform1f(f,l.u_pitch),u_rotate_symbol:new C.Uniform1i(f,l.u_rotate_symbol),u_aspect_ratio:new C.Uniform1f(f,l.u_aspect_ratio),u_fade_change:new C.Uniform1f(f,l.u_fade_change),u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_label_plane_matrix:new C.UniformMatrix4f(f,l.u_label_plane_matrix),u_coord_matrix:new C.UniformMatrix4f(f,l.u_coord_matrix),u_is_text:new C.Uniform1i(f,l.u_is_text),u_pitch_with_map:new C.Uniform1i(f,l.u_pitch_with_map),u_texsize:new C.Uniform2f(f,l.u_texsize),u_texture:new C.Uniform1i(f,l.u_texture),u_gamma_scale:new C.Uniform1f(f,l.u_gamma_scale),u_device_pixel_ratio:new C.Uniform1f(f,l.u_device_pixel_ratio),u_tile_id:new C.Uniform3f(f,l.u_tile_id),u_zoom_transition:new C.Uniform1f(f,l.u_zoom_transition),u_inv_rot_matrix:new C.UniformMatrix4f(f,l.u_inv_rot_matrix),u_merc_center:new C.Uniform2f(f,l.u_merc_center),u_is_halo:new C.Uniform1i(f,l.u_is_halo)}),symbolTextAndIcon:(f,l)=>({u_is_size_zoom_constant:new C.Uniform1i(f,l.u_is_size_zoom_constant),u_is_size_feature_constant:new C.Uniform1i(f,l.u_is_size_feature_constant),u_size_t:new C.Uniform1f(f,l.u_size_t),u_size:new C.Uniform1f(f,l.u_size),u_camera_to_center_distance:new C.Uniform1f(f,l.u_camera_to_center_distance),u_pitch:new C.Uniform1f(f,l.u_pitch),u_rotate_symbol:new C.Uniform1i(f,l.u_rotate_symbol),u_aspect_ratio:new C.Uniform1f(f,l.u_aspect_ratio),u_fade_change:new C.Uniform1f(f,l.u_fade_change),u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_label_plane_matrix:new C.UniformMatrix4f(f,l.u_label_plane_matrix),u_coord_matrix:new C.UniformMatrix4f(f,l.u_coord_matrix),u_is_text:new C.Uniform1i(f,l.u_is_text),u_pitch_with_map:new C.Uniform1i(f,l.u_pitch_with_map),u_texsize:new C.Uniform2f(f,l.u_texsize),u_texsize_icon:new C.Uniform2f(f,l.u_texsize_icon),u_texture:new C.Uniform1i(f,l.u_texture),u_texture_icon:new C.Uniform1i(f,l.u_texture_icon),u_gamma_scale:new C.Uniform1f(f,l.u_gamma_scale),u_device_pixel_ratio:new C.Uniform1f(f,l.u_device_pixel_ratio),u_is_halo:new C.Uniform1i(f,l.u_is_halo)}),background:(f,l)=>({u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_opacity:new C.Uniform1f(f,l.u_opacity),u_color:new C.UniformColor(f,l.u_color)}),backgroundPattern:(f,l)=>({u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_opacity:new C.Uniform1f(f,l.u_opacity),u_image:new C.Uniform1i(f,l.u_image),u_pattern_tl_a:new C.Uniform2f(f,l.u_pattern_tl_a),u_pattern_br_a:new C.Uniform2f(f,l.u_pattern_br_a),u_pattern_tl_b:new C.Uniform2f(f,l.u_pattern_tl_b),u_pattern_br_b:new C.Uniform2f(f,l.u_pattern_br_b),u_texsize:new C.Uniform2f(f,l.u_texsize),u_mix:new C.Uniform1f(f,l.u_mix),u_pattern_size_a:new C.Uniform2f(f,l.u_pattern_size_a),u_pattern_size_b:new C.Uniform2f(f,l.u_pattern_size_b),u_scale_a:new C.Uniform1f(f,l.u_scale_a),u_scale_b:new C.Uniform1f(f,l.u_scale_b),u_pixel_coord_upper:new C.Uniform2f(f,l.u_pixel_coord_upper),u_pixel_coord_lower:new C.Uniform2f(f,l.u_pixel_coord_lower),u_tile_units_to_pixels:new C.Uniform1f(f,l.u_tile_units_to_pixels)}),terrainRaster:ii,terrainDepth:ii,skybox:(f,l)=>({u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_sun_direction:new C.Uniform3f(f,l.u_sun_direction),u_cubemap:new C.Uniform1i(f,l.u_cubemap),u_opacity:new C.Uniform1f(f,l.u_opacity),u_temporal_offset:new C.Uniform1f(f,l.u_temporal_offset)}),skyboxGradient:(f,l)=>({u_matrix:new C.UniformMatrix4f(f,l.u_matrix),u_color_ramp:new C.Uniform1i(f,l.u_color_ramp),u_center_direction:new C.Uniform3f(f,l.u_center_direction),u_radius:new C.Uniform1f(f,l.u_radius),u_opacity:new C.Uniform1f(f,l.u_opacity),u_temporal_offset:new C.Uniform1f(f,l.u_temporal_offset)}),skyboxCapture:(f,l)=>({u_matrix_3f:new C.UniformMatrix3f(f,l.u_matrix_3f),u_sun_direction:new C.Uniform3f(f,l.u_sun_direction),u_sun_intensity:new C.Uniform1f(f,l.u_sun_intensity),u_color_tint_r:new C.Uniform4f(f,l.u_color_tint_r),u_color_tint_m:new C.Uniform4f(f,l.u_color_tint_m),u_luminance:new C.Uniform1f(f,l.u_luminance)})};let As;function Qn(f,l,d,x,M,D,B){const G=f.context,W=G.gl,Y=f.useProgram("collisionBox"),ee=[];let Q=0,le=0;for(let Le=0;Le<x.length;Le++){const Me=x[Le],Ue=l.getTile(Me),Ye=Ue.getBucket(d);if(!Ye)continue;let yt=Me.projMatrix;0===M[0]&&0===M[1]||(yt=f.translatePosMatrix(Me.projMatrix,Ue,M,D));const gt=B?Ye.textCollisionBox:Ye.iconCollisionBox,Ot=Ye.collisionCircleArray;if(Ot.length>0){const dt=C.create$1(),Nt=yt;C.mul$1(dt,Ye.placementInvProjMatrix,f.transform.glCoordMatrix),C.mul$1(dt,dt,Ye.placementViewportMatrix),ee.push({circleArray:Ot,circleOffset:le,transform:Nt,invTransform:dt}),Q+=Ot.length/4,le=Q}gt&&(f.terrain&&f.terrain.setupElevationDraw(Ue,Y),Y.draw(G,W.LINES,C.DepthMode.disabled,C.StencilMode.disabled,f.colorModeForRenderPass(),C.CullFaceMode.disabled,nu(yt,f.transform,Ue),d.id,gt.layoutVertexBuffer,gt.indexBuffer,gt.segments,null,f.transform.zoom,null,gt.collisionVertexBuffer,gt.collisionVertexBufferExt))}if(!B||!ee.length)return;const de=f.useProgram("collisionCircle"),ge=new C.StructArrayLayout2f1f2i16;ge.resize(4*Q),ge._trim();let xe=0;for(const Le of ee)for(let Me=0;Me<Le.circleArray.length/4;Me++){const Ue=4*Me,Ye=Le.circleArray[Ue+0],yt=Le.circleArray[Ue+1],gt=Le.circleArray[Ue+2],Ot=Le.circleArray[Ue+3];ge.emplace(xe++,Ye,yt,gt,Ot,0),ge.emplace(xe++,Ye,yt,gt,Ot,1),ge.emplace(xe++,Ye,yt,gt,Ot,2),ge.emplace(xe++,Ye,yt,gt,Ot,3)}(!As||As.length<2*Q)&&(As=function(Le){const Me=2*Le,Ue=new C.StructArrayLayout3ui6;Ue.resize(Me),Ue._trim();for(let Ye=0;Ye<Me;Ye++){const yt=6*Ye;Ue.uint16[yt+0]=4*Ye+0,Ue.uint16[yt+1]=4*Ye+1,Ue.uint16[yt+2]=4*Ye+2,Ue.uint16[yt+3]=4*Ye+2,Ue.uint16[yt+4]=4*Ye+3,Ue.uint16[yt+5]=4*Ye+0}return Ue}(Q));const Te=G.createIndexBuffer(As,!0),Ee=G.createVertexBuffer(ge,C.collisionCircleLayout.members,!0);for(const Le of ee){const Me={u_matrix:Le.transform,u_inv_matrix:Le.invTransform,u_camera_to_center_distance:(Pe=f.transform).cameraToCenterDistance,u_viewport_size:[Pe.width,Pe.height]};de.draw(G,W.TRIANGLES,C.DepthMode.disabled,C.StencilMode.disabled,f.colorModeForRenderPass(),C.CullFaceMode.disabled,Me,d.id,Ee,Te,C.SegmentVector.simpleSegment(0,2*Le.circleOffset,Le.circleArray.length,Le.circleArray.length/2),null,f.transform.zoom,null,null,null)}var Pe;Ee.destroy(),Te.destroy()}const ui=C.identity(new Float32Array(16));function So(f,l,d,x,M,D){const{horizontalAlign:B,verticalAlign:G}=C.getAnchorAlignment(f),W=-(B-.5)*l,Y=-(G-.5)*d,ee=C.evaluateVariableOffset(f,x);return new C.pointGeometry((W/M+ee[0])*D,(Y/M+ee[1])*D)}function Gs(f,l,d,x,M,D,B,G,W,Y,ee,Q){const le=f.text.placedSymbolArray,de=f.text.dynamicLayoutVertexArray,ge=f.icon.dynamicLayoutVertexArray,xe={};de.clear();for(let Te=0;Te<le.length;Te++){const Ee=le.get(Te),Pe=f.allowVerticalPlacement&&!Ee.placedOrientation,Le=Ee.hidden||!Ee.crossTileID||Pe?null:x[Ee.crossTileID];if(Le){const Me=new C.pointGeometry(Ee.tileAnchorX,Ee.tileAnchorY),Ue=Q(Me),Ye=ri(Me,d?G:B,Ue),yt=Yr(D.cameraToCenterDistance,Ye.signedDistanceFromCamera);let gt=M.evaluateSizeForFeature(f.textSizeData,Y,Ee)*yt/C.ONE_EM;d&&(gt*=f.tilePixelRatio/W);const{width:Ot,height:dt,anchor:Nt,textOffset:wt,textScale:Zt}=Le,ft=So(Nt,Ot,dt,wt,Zt,gt),Gt=d?ri(Me.add(ft),B,Ue).point:Ye.point.add(l?ft.rotate(-D.angle):ft),Qt=f.allowVerticalPlacement&&Ee.placedOrientation===C.WritingMode.vertical?Math.PI/2:0;for(let mn=0;mn<Ee.numGlyphs;mn++)C.addDynamicAttributes(de,Gt,Qt);ee&&Ee.associatedIconIndex>=0&&(xe[Ee.associatedIconIndex]={shiftedAnchor:Gt,angle:Qt})}else Fr(Ee.numGlyphs,de)}if(ee){ge.clear();const Te=f.icon.placedSymbolArray;for(let Ee=0;Ee<Te.length;Ee++){const Pe=Te.get(Ee);if(Pe.hidden)Fr(Pe.numGlyphs,ge);else{const Le=xe[Ee];if(Le)for(let Me=0;Me<Pe.numGlyphs;Me++)C.addDynamicAttributes(ge,Le.shiftedAnchor,Le.angle);else Fr(Pe.numGlyphs,ge)}}f.icon.dynamicLayoutVertexBuffer.updateData(ge)}f.text.dynamicLayoutVertexBuffer.updateData(de)}function ru(f,l,d){return d.iconsInText&&l?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Ao(f,l,d,x,M,D,B,G,W,Y,ee,Q){const le=f.context,de=le.gl,ge=f.transform,xe="map"===G,Te="map"===W,Ee=xe&&"point"!==d.layout.get("symbol-placement"),Pe=xe&&!Te&&!Ee,Le=void 0!==d.layout.get("symbol-sort-key").constantOr(1);let Me=!1;const Ue=f.depthModeForSublayer(0,C.DepthMode.ReadOnly),Ye=[0,0],yt=d.layout.get("text-variable-anchor"),gt=[],Ot=[];f.terrain&&Te&&Ot.push("PITCH_WITH_MAP_TERRAIN"),Ee&&Ot.push("PROJECTED_POS_ON_VIEWPORT");for(const dt of x){const Nt=l.getTile(dt),wt=Nt.getBucket(d);if(!wt)continue;const Zt=M?wt.text:wt.icon;if(!Zt||!Zt.segments.get().length)continue;const ft=Zt.programConfigurations.get(d.id),Gt=M||wt.sdfIcons,Qt=M?wt.textSizeData:wt.iconSizeData,mn=Te||0!==ge.pitch,Hn=f.useProgram(ru(Gt,M,wt),ft,Ot),gr=C.evaluateSizeForZoom(Qt,ge.zoom),wr=[dt.canonical.x,dt.canonical.y,1<<dt.canonical.z];let tr,Cr,Wr,Zi,ha=[0,0],Do=null;if(M){if(Cr=Nt.glyphAtlasTexture,Wr=de.LINEAR,tr=Nt.glyphAtlasTexture.size,wt.iconsInText){ha=Nt.imageAtlasTexture.size,Do=Nt.imageAtlasTexture;const at="composite"===Qt.kind||"camera"===Qt.kind;Zi=mn||f.options.rotating||f.options.zooming||at?de.LINEAR:de.NEAREST}}else{const at=1!==d.layout.get("icon-size").constantOr(0)||wt.iconsNeedLinear;Cr=Nt.imageAtlasTexture,Wr=Gt||f.options.rotating||f.options.zooming||at||mn?de.LINEAR:de.NEAREST,tr=Nt.imageAtlasTexture.size}const xo=f.transform.calculatePixelsToTileUnitsMatrix(Nt),Ko=ur(dt.projMatrix,Te,xe,f.transform,xo),va=f.terrain&&Te&&Ee?C.invert(new Float32Array(16),Ko):ui,Tu=wn(dt.projMatrix,Te,xe,f.transform,xo),O=yt&&wt.hasTextData(),P="none"!==d.layout.get("icon-text-fit")&&O&&wt.hasIconData();if(Ee){const at=ge.elevation;ni(wt,dt.projMatrix,f,M,Ko,Tu,Te,Y,at?nt=>at.getAtTileOffset(dt,nt.x,nt.y):null)}const z=f.translatePosMatrix(dt.projMatrix,Nt,D,B),K=Ee||M&&yt||P?ui:Ko,he=f.translatePosMatrix(Tu,Nt,D,B,!0),fe=Gt&&0!==d.paint.get(M?"text-halo-width":"icon-halo-width").constantOr(1);let Ie;Ie=Gt?wt.iconsInText?Ih(Qt.kind,gr,Pe,Te,f,z,K,he,tr,ha,wr,0,f.identityMat,Ye):Ki(Qt.kind,gr,Pe,Te,f,z,K,he,M,tr,!0,wr,0,f.identityMat,Ye):Oc(Qt.kind,gr,Pe,Te,f,z,K,he,M,tr,wr,0,f.identityMat,Ye);const Fe={program:Hn,buffers:Zt,uniformValues:Ie,atlasTexture:Cr,atlasTextureIcon:Do,atlasInterpolation:Wr,atlasInterpolationIcon:Zi,isSDF:Gt,hasHalo:fe,tile:Nt,labelPlaneMatrixInv:va};if(Le&&wt.canOverlap){Me=!0;const at=Zt.segments.get();for(const nt of at)gt.push({segments:new C.SegmentVector([nt]),sortKey:nt.sortKey,state:Fe})}else gt.push({segments:Zt.segments,sortKey:0,state:Fe})}Me&&gt.sort((dt,Nt)=>dt.sortKey-Nt.sortKey);for(const dt of gt){const Nt=dt.state;if(f.terrain&&f.terrain.setupElevationDraw(Nt.tile,Nt.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:Nt.labelPlaneMatrixInv}),le.activeTexture.set(de.TEXTURE0),Nt.atlasTexture.bind(Nt.atlasInterpolation,de.CLAMP_TO_EDGE),Nt.atlasTextureIcon&&(le.activeTexture.set(de.TEXTURE1),Nt.atlasTextureIcon&&Nt.atlasTextureIcon.bind(Nt.atlasInterpolationIcon,de.CLAMP_TO_EDGE)),Nt.isSDF){const wt=Nt.uniformValues;Nt.hasHalo&&(wt.u_is_halo=1,Bl(Nt.buffers,dt.segments,d,f,Nt.program,Ue,ee,Q,wt)),wt.u_is_halo=0}Bl(Nt.buffers,dt.segments,d,f,Nt.program,Ue,ee,Q,Nt.uniformValues)}}function Bl(f,l,d,x,M,D,B,G,W){const Y=x.context;M.draw(Y,Y.gl.TRIANGLES,D,B,G,C.CullFaceMode.disabled,W,d.id,f.layoutVertexBuffer,f.indexBuffer,l,d.paint,x.transform.zoom,f.programConfigurations.get(d.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Xo(f,l,d,x,M,D,B){const G=f.context.gl,W=d.paint.get("fill-pattern"),Y=W&&W.constantOr(1),ee=d.getCrossfadeParameters();let Q,le,de,ge,xe;B?(le=Y&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Q=G.LINES):(le=Y?"fillPattern":"fill",Q=G.TRIANGLES);for(const Te of x){const Ee=l.getTile(Te);if(Y&&!Ee.patternsLoaded())continue;const Pe=Ee.getBucket(d);if(!Pe)continue;f.prepareDrawTile(Te);const Le=Pe.programConfigurations.get(d.id),Me=f.useProgram(le,Le);Y&&(f.context.activeTexture.set(G.TEXTURE0),Ee.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Le.updatePaintBuffers(ee));const Ue=W.constantOr(null);if(Ue&&Ee.imageAtlas){const yt=Ee.imageAtlas,gt=yt.patternPositions[Ue.to.toString()],Ot=yt.patternPositions[Ue.from.toString()];gt&&Ot&&Le.setConstantPatternPositions(gt,Ot)}const Ye=f.translatePosMatrix(Te.projMatrix,Ee,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(B){ge=Pe.indexBuffer2,xe=Pe.segments2;const yt=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[G.drawingBufferWidth,G.drawingBufferHeight];de="fillOutlinePattern"===le&&Y?Td(Ye,f,ee,Ee,yt):eo(Ye,yt)}else ge=Pe.indexBuffer,xe=Pe.segments,de=Y?ju(Ye,f,ee,Ee):Pc(Ye);f.prepareDrawProgram(f.context,Me,Te.toUnwrapped()),Me.draw(f.context,Q,M,f.stencilModeForClipping(Te),D,C.CullFaceMode.disabled,de,d.id,Pe.layoutVertexBuffer,ge,xe,d.paint,f.transform.zoom,Le)}}function wl(f,l,d,x,M,D,B){const G=f.context,W=G.gl,Y=d.paint.get("fill-extrusion-pattern"),ee=Y.constantOr(1),Q=d.getCrossfadeParameters(),le=d.paint.get("fill-extrusion-opacity");for(const de of x){const ge=l.getTile(de),xe=ge.getBucket(d);if(!xe)continue;const Te=xe.programConfigurations.get(d.id),Ee=f.useProgram(ee?"fillExtrusionPattern":"fillExtrusion",Te);if(f.terrain){const Ye=f.terrain;if(!xe.enableTerrain)continue;if(Ye.setupElevationDraw(ge,Ee,{useMeterToDem:!0}),sl(G,l,de,xe,d,Ye),!xe.centroidVertexBuffer){const yt=Ee.attributes.a_centroid_pos;void 0!==yt&&W.vertexAttrib2f(yt,0,0)}}ee&&(f.context.activeTexture.set(W.TEXTURE0),ge.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Te.updatePaintBuffers(Q));const Pe=Y.constantOr(null);if(Pe&&ge.imageAtlas){const Ye=ge.imageAtlas,yt=Ye.patternPositions[Pe.to.toString()],gt=Ye.patternPositions[Pe.from.toString()];yt&&gt&&Te.setConstantPatternPositions(yt,gt)}const Le=f.translatePosMatrix(de.projMatrix,ge,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Me=d.paint.get("fill-extrusion-vertical-gradient"),Ue=ee?bl(Le,f,Me,le,de,Q,ge):Oo(Le,f,Me,le);f.prepareDrawProgram(G,Ee,de.toUnwrapped()),Ee.draw(G,G.gl.TRIANGLES,M,D,B,C.CullFaceMode.backCCW,Ue,d.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,d.paint,f.transform.zoom,Te,f.terrain?xe.centroidVertexBuffer:null)}}function sl(f,l,d,x,M,D){const B=[Ee=>{let Pe=Ee.canonical.x-1,Le=Ee.wrap;return Pe<0&&(Pe=(1<<Ee.canonical.z)-1,Le--),new C.OverscaledTileID(Ee.overscaledZ,Le,Ee.canonical.z,Pe,Ee.canonical.y)},Ee=>{let Pe=Ee.canonical.x+1,Le=Ee.wrap;return Pe===1<<Ee.canonical.z&&(Pe=0,Le++),new C.OverscaledTileID(Ee.overscaledZ,Le,Ee.canonical.z,Pe,Ee.canonical.y)},Ee=>new C.OverscaledTileID(Ee.overscaledZ,Ee.wrap,Ee.canonical.z,Ee.canonical.x,(0===Ee.canonical.y?1<<Ee.canonical.z:Ee.canonical.y)-1),Ee=>new C.OverscaledTileID(Ee.overscaledZ,Ee.wrap,Ee.canonical.z,Ee.canonical.x,Ee.canonical.y===(1<<Ee.canonical.z)-1?0:Ee.canonical.y+1)],G=Ee=>{const Pe=l.getSource().maxzoom,Le=yt=>{const gt=l.getTileByID(yt);if(gt&&gt.hasData())return gt.getBucket(M)};let Me,Ue,Ye;return(Ee.overscaledZ===Ee.canonical.z||Ee.overscaledZ>=Pe)&&(Me=Le(Ee.key)),Ee.overscaledZ>=Pe&&(Ue=Le(Ee.calculateScaledKey(Ee.overscaledZ+1))),Ee.overscaledZ>Pe&&(Ye=Le(Ee.calculateScaledKey(Ee.overscaledZ-1))),Me||Ue||Ye},W=[0,0,0],Y=(Ee,Pe)=>(W[0]=Math.min(Ee.min.y,Pe.min.y),W[1]=Math.max(Ee.max.y,Pe.max.y),W[2]=C.EXTENT-Pe.min.x>Ee.max.x?Pe.min.x-C.EXTENT:Ee.max.x,W),ee=(Ee,Pe)=>(W[0]=Math.min(Ee.min.x,Pe.min.x),W[1]=Math.max(Ee.max.x,Pe.max.x),W[2]=C.EXTENT-Pe.min.y>Ee.max.y?Pe.min.y-C.EXTENT:Ee.max.y,W),Q=[(Ee,Pe)=>Y(Ee,Pe),(Ee,Pe)=>Y(Pe,Ee),(Ee,Pe)=>ee(Ee,Pe),(Ee,Pe)=>ee(Pe,Ee)],le=new C.pointGeometry(0,0);let de,ge,xe;const Te=(Ee,Pe,Le,Me,Ue)=>{const Ye=[[Me?Le:Ee,Me?Ee:Le,0],[Me?Le:Pe,Me?Pe:Le,0]],yt=Ue<0?C.EXTENT+Ue:Ue,gt=[Me?yt:(Ee+Pe)/2,Me?(Ee+Pe)/2:yt,0];return 0===Le&&Ue<0||0!==Le&&Ue>0?D.getForTilePoints(xe,[gt],!0,ge):Ye.push(gt),D.getForTilePoints(d,Ye,!0,de),Math.max(Ye[0][2],Ye[1][2],gt[2])/D.exaggeration()};for(let Ee=0;Ee<4;Ee++){const Pe=x.borders[Ee];if(0===Pe.length&&(x.borderDone[Ee]=!0),x.borderDone[Ee])continue;const Le=xe=B[Ee](d),Me=G(Le);if(!(Me&&Me.enableTerrain&&(ge=D.findDEMTileFor(Le),ge&&ge.dem)))continue;if(!de){const gt=D.findDEMTileFor(d);if(!gt||!gt.dem)return;de=gt}const Ue=(Ee<2?1:5)-Ee,Ye=Me.borders[Ue];let yt=0;for(let gt=0;gt<Pe.length;gt++){const Ot=x.featuresOnBorder[Pe[gt]],dt=Ot.borders[Ee];let Nt;for(;yt<Ye.length&&(Nt=Me.featuresOnBorder[Ye[yt]],!(Nt.borders[Ue][1]>dt[0]+3));)Me.borderDone[Ue]||Me.encodeCentroid(void 0,Nt,!1),yt++;if(Nt&&yt<Ye.length){const wt=yt;let Zt=0;for(;!(Nt.borders[Ue][0]>dt[1]-3)&&(Zt++,++yt!==Ye.length);)Nt=Me.featuresOnBorder[Ye[yt]];if(Nt=Me.featuresOnBorder[Ye[wt]],Ot.intersectsCount()>1||Nt.intersectsCount()>1||1!==Zt){1!==Zt&&(yt=wt),x.encodeCentroid(void 0,Ot,!1),Me.borderDone[Ue]||Me.encodeCentroid(void 0,Nt,!1);continue}const ft=Q[Ee](Ot,Nt),Gt=Ee%2?C.EXTENT-1:0;le.x=Te(ft[0],Math.min(C.EXTENT-1,ft[1]),Gt,Ee<2,ft[2]),le.y=0,x.encodeCentroid(le,Ot,!1),Me.borderDone[Ue]||Me.encodeCentroid(le,Nt,!1)}else x.encodeCentroid(void 0,Ot,!1)}x.borderDone[Ee]=x.needsCentroidUpdate=!0,Me.borderDone[Ue]||(Me.borderDone[Ue]=Me.needsCentroidUpdate=!0)}(x.needsCentroidUpdate||!x.centroidVertexBuffer&&0!==x.centroidVertexArray.length)&&x.uploadCentroid(f)}const bi=new C.Color(1,0,0,1),Ji=new C.Color(0,1,0,1),ac=new C.Color(0,0,1,1),Lc=new C.Color(1,0,1,1),sc=new C.Color(0,1,1,1);function ja(f,l,d,x){Vu(f,0,l+d/2,f.transform.width,d,x)}function cp(f,l,d,x){Vu(f,l-d/2,0,d,f.transform.height,x)}function Vu(f,l,d,x,M,D){const B=f.context,G=B.gl;G.enable(G.SCISSOR_TEST),G.scissor(l*C.exported.devicePixelRatio,d*C.exported.devicePixelRatio,x*C.exported.devicePixelRatio,M*C.exported.devicePixelRatio),B.clear({color:D}),G.disable(G.SCISSOR_TEST)}function Gu(f,l,d){const x=f.context,M=x.gl,D=d.projMatrix,B=f.useProgram("debug"),G=l.getTileByID(d.key);f.terrain&&f.terrain.setupElevationDraw(G,B);const W=C.DepthMode.disabled,Y=C.StencilMode.disabled,ee=f.colorModeForRenderPass(),Q="$debug";x.activeTexture.set(M.TEXTURE0),f.emptyTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),G._makeDebugTileBoundsBuffers(f.context,f.transform.projection);const le=G._tileDebugBuffer||f.debugBuffer,de=G._tileDebugIndexBuffer||f.debugIndexBuffer,ge=G._tileDebugSegments||f.debugSegments;B.draw(x,M.LINE_STRIP,W,Y,ee,C.CullFaceMode.disabled,Gi(D,C.Color.red),Q,le,de,ge);const xe=G.latestRawTileData,Te=Math.floor((xe&&xe.byteLength||0)/1024),Ee=l.getTile(d).tileSize,Pe=512/Math.min(Ee,512)*(d.overscaledZ/f.transform.zoom)*.5;let Le=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(Le+=` => ${d.overscaledZ}`),function(Me,Ue){Me.initDebugOverlayCanvas();const Ye=Me.debugOverlayCanvas,yt=Me.context.gl,gt=Me.debugOverlayCanvas.getContext("2d");gt.clearRect(0,0,Ye.width,Ye.height),gt.shadowColor="white",gt.shadowBlur=2,gt.lineWidth=1.5,gt.strokeStyle="white",gt.textBaseline="top",gt.font="bold 36px Open Sans, sans-serif",gt.fillText(Ue,5,5),gt.strokeText(Ue,5,5),Me.debugOverlayTexture.update(Ye),Me.debugOverlayTexture.bind(yt.LINEAR,yt.CLAMP_TO_EDGE)}(f,`${Le} ${Te}kb`),B.draw(x,M.TRIANGLES,W,Y,C.ColorMode.alphaBlended,C.CullFaceMode.disabled,Gi(D,C.Color.transparent,Pe),Q,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments)}const vo=C.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Op}=vo;function qu(f,l,d,x){f.emplaceBack(l,d,x)}class Cl{constructor(l){this.vertexArray=new C.StructArrayLayout3f12,this.indices=new C.StructArrayLayout3ui6,qu(this.vertexArray,-1,-1,1),qu(this.vertexArray,1,-1,1),qu(this.vertexArray,-1,1,1),qu(this.vertexArray,1,1,1),qu(this.vertexArray,-1,-1,-1),qu(this.vertexArray,1,-1,-1),qu(this.vertexArray,-1,1,-1),qu(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,Op),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=C.SegmentVector.simpleSegment(0,0,36,12)}}function us(f,l,d,x,M,D){const B=f.gl,G=l.paint.get("sky-atmosphere-color"),W=l.paint.get("sky-atmosphere-halo-color"),Y=l.paint.get("sky-atmosphere-sun-intensity"),ee={u_matrix_3f:C.fromMat4([],x),u_sun_direction:M,u_sun_intensity:Y,u_color_tint_r:[(ge=G).r,ge.g,ge.b,ge.a],u_color_tint_m:[(xe=W).r,xe.g,xe.b,xe.a],u_luminance:5e-5};var ge,xe;B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,B.TEXTURE_CUBE_MAP_POSITIVE_X+D,l.skyboxTexture,0),d.draw(f,B.TRIANGLES,C.DepthMode.disabled,C.StencilMode.disabled,C.ColorMode.unblended,C.CullFaceMode.frontCW,ee,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const nh={symbol:function(f,l,d,x,M){if("translucent"!==f.renderPass)return;const D=C.StencilMode.disabled,B=f.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(G,W,Y,ee,Q,le,de){const ge=W.transform,xe="map"===Q,Te="map"===le;for(const Ee of G){const Pe=ee.getTile(Ee),Le=Pe.getBucket(Y);if(!Le||!Le.text||!Le.text.segments.get().length)continue;const Me=C.evaluateSizeForZoom(Le.textSizeData,ge.zoom),Ue=W.transform.calculatePixelsToTileUnitsMatrix(Pe),Ye=ur(Ee.projMatrix,Te,xe,W.transform,Ue),yt="none"!==Y.layout.get("icon-text-fit")&&Le.hasIconData();if(Me){const gt=Math.pow(2,ge.zoom-Pe.tileID.overscaledZ),Ot=ge.elevation;Gs(Le,xe,Te,de,C.symbolSize,ge,Ye,Ee.projMatrix,gt,Me,yt,Ot?dt=>Ot.getAtTileOffset(Ee,dt.x,dt.y):dt=>0)}}}(x,f,d,l,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),M),0!==d.paint.get("icon-opacity").constantOr(1)&&Ao(f,l,d,x,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),D,B),0!==d.paint.get("text-opacity").constantOr(1)&&Ao(f,l,d,x,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),D,B),l.map.showCollisionBoxes&&(Qn(f,l,d,x,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),Qn(f,l,d,x,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(f,l,d,x){if("translucent"!==f.renderPass)return;const M=d.paint.get("circle-opacity"),D=d.paint.get("circle-stroke-width"),B=d.paint.get("circle-stroke-opacity"),G=void 0!==d.layout.get("circle-sort-key").constantOr(1);if(0===M.constantOr(1)&&(0===D.constantOr(1)||0===B.constantOr(1)))return;const W=f.context,Y=W.gl,ee=f.depthModeForSublayer(0,C.DepthMode.ReadOnly),Q=C.StencilMode.disabled,le=f.colorModeForRenderPass(),de=[];for(let ge=0;ge<x.length;ge++){const xe=x[ge],Te=l.getTile(xe),Ee=Te.getBucket(d);if(!Ee)continue;const Pe=Ee.programConfigurations.get(d.id),Le=nd(d),Me={programConfiguration:Pe,program:f.useProgram("circle",Pe,Le),layoutVertexBuffer:Ee.layoutVertexBuffer,indexBuffer:Ee.indexBuffer,uniformValues:zl(f,xe,Te,d),tile:Te};if(G){const Ue=Ee.segments.get();for(const Ye of Ue)de.push({segments:new C.SegmentVector([Ye]),sortKey:Ye.sortKey,state:Me})}else de.push({segments:Ee.segments,sortKey:0,state:Me})}G&&de.sort((ge,xe)=>ge.sortKey-xe.sortKey);for(const ge of de){const{programConfiguration:xe,program:Te,layoutVertexBuffer:Ee,indexBuffer:Pe,uniformValues:Le,tile:Me}=ge.state,Ue=ge.segments;f.terrain&&f.terrain.setupElevationDraw(Me,Te,{useDepthForOcclusion:!0}),f.prepareDrawProgram(W,Te,Me.tileID.toUnwrapped()),Te.draw(W,Y.TRIANGLES,ee,Q,le,C.CullFaceMode.disabled,Le,d.id,Ee,Pe,Ue,d.paint,f.transform.zoom,xe)}},heatmap:function(f,l,d,x){if(0!==d.paint.get("heatmap-opacity"))if("offscreen"===f.renderPass){const M=f.context,D=M.gl,B=C.StencilMode.disabled,G=new C.ColorMode([D.ONE,D.ONE],C.Color.transparent,[!0,!0,!0,!0]);(function(W,Y,ee){const Q=W.gl;W.activeTexture.set(Q.TEXTURE1),W.viewport.set([0,0,Y.width/4,Y.height/4]);let le=ee.heatmapFbo;if(le)Q.bindTexture(Q.TEXTURE_2D,le.colorAttachment.get()),W.bindFramebuffer.set(le.framebuffer);else{const de=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,de),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),le=ee.heatmapFbo=W.createFramebuffer(Y.width/4,Y.height/4,!1),function(ge,xe,Te,Ee){const Pe=ge.gl;Pe.texImage2D(Pe.TEXTURE_2D,0,Pe.RGBA,xe.width/4,xe.height/4,0,Pe.RGBA,ge.extRenderToTextureHalfFloat?ge.extTextureHalfFloat.HALF_FLOAT_OES:Pe.UNSIGNED_BYTE,null),Ee.colorAttachment.set(Te)}(W,Y,de,le)}})(M,f,d),M.clear({color:C.Color.transparent});for(let W=0;W<x.length;W++){const Y=x[W];if(l.hasRenderableParent(Y))continue;const ee=l.getTile(Y),Q=ee.getBucket(d);if(!Q)continue;const le=Q.programConfigurations.get(d.id),de=f.useProgram("heatmap",le),{zoom:ge}=f.transform;f.terrain&&f.terrain.setupElevationDraw(ee,de),f.prepareDrawProgram(M,de,Y.toUnwrapped()),de.draw(M,D.TRIANGLES,C.DepthMode.disabled,B,G,C.CullFaceMode.disabled,Rc(Y.projMatrix,ee,ge,d.paint.get("heatmap-intensity")),d.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,d.paint,f.transform.zoom,le)}M.viewport.set([0,0,f.width,f.height])}else"translucent"===f.renderPass&&(f.context.setColorMode(f.colorModeForRenderPass()),function(M,D){const B=M.context,G=B.gl,W=D.heatmapFbo;if(!W)return;B.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,W.colorAttachment.get()),B.activeTexture.set(G.TEXTURE1);let Y=D.colorRampTexture;Y||(Y=D.colorRampTexture=new C.Texture(B,D.colorRamp,G.RGBA)),Y.bind(G.LINEAR,G.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(B,G.TRIANGLES,C.DepthMode.disabled,C.StencilMode.disabled,M.colorModeForRenderPass(),C.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:D.paint.get("heatmap-opacity")},D.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,D.paint,M.transform.zoom)}(f,d))},line:function(f,l,d,x){if("translucent"!==f.renderPass)return;const M=d.paint.get("line-opacity"),D=d.paint.get("line-width");if(0===M.constantOr(1)||0===D.constantOr(1))return;const B=f.depthModeForSublayer(0,C.DepthMode.ReadOnly),G=f.colorModeForRenderPass(),W=d.paint.get("line-dasharray"),Y=W.constantOr(1),ee=d.layout.get("line-cap"),Q=d.paint.get("line-pattern"),le=Q.constantOr(1),de=d.paint.get("line-gradient"),ge=d.getCrossfadeParameters(),xe=le?"linePattern":"line",Te=f.context,Ee=Te.gl;for(const Pe of x){const Le=l.getTile(Pe);if(le&&!Le.patternsLoaded())continue;const Me=Le.getBucket(d);if(!Me)continue;f.prepareDrawTile(Pe);const Ue=Me.programConfigurations.get(d.id),Ye=vu(d),yt=f.useProgram(xe,Ue,Ye),gt=Q.constantOr(null);if(gt&&Le.imageAtlas){const Zt=Le.imageAtlas,ft=Zt.patternPositions[gt.to.toString()],Gt=Zt.patternPositions[gt.from.toString()];ft&&Gt&&Ue.setConstantPatternPositions(ft,Gt)}const Ot=W.constantOr(null),dt=ee.constantOr(null);if(!le&&Ot&&dt&&Le.lineAtlas){const Zt=Le.lineAtlas,ft=Zt.getDash(Ot.to,dt),Gt=Zt.getDash(Ot.from,dt);ft&&Gt&&Ue.setConstantPatternPositions(ft,Gt)}const Nt=f.terrain?Pe.projMatrix:null,wt=le?Pa(f,Le,d,ge,Nt):Hh(f,Le,d,ge,Nt,Me.lineClipsArray.length);if(de){const Zt=Me.gradients[d.id];let ft=Zt.texture;if(d.gradientVersion!==Zt.version){let Gt=256;if(d.stepInterpolant){const Qt=l.getSource().maxzoom,mn=Pe.canonical.z===Qt?Math.ceil(1<<f.transform.maxZoom-Pe.canonical.z):1;Gt=C.clamp(C.nextPowerOfTwo(Me.maxLineLength/C.EXTENT*1024*mn),256,Te.maxTextureSize)}Zt.gradient=C.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Gt,image:Zt.gradient||void 0,clips:Me.lineClipsArray}),Zt.texture?Zt.texture.update(Zt.gradient):Zt.texture=new C.Texture(Te,Zt.gradient,Ee.RGBA),Zt.version=d.gradientVersion,ft=Zt.texture}Te.activeTexture.set(Ee.TEXTURE1),ft.bind(d.stepInterpolant?Ee.NEAREST:Ee.LINEAR,Ee.CLAMP_TO_EDGE)}Y&&(Te.activeTexture.set(Ee.TEXTURE0),Le.lineAtlasTexture.bind(Ee.LINEAR,Ee.REPEAT),Ue.updatePaintBuffers(ge)),le&&(Te.activeTexture.set(Ee.TEXTURE0),Le.imageAtlasTexture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE),Ue.updatePaintBuffers(ge)),f.prepareDrawProgram(Te,yt,Pe.toUnwrapped()),yt.draw(Te,Ee.TRIANGLES,B,f.stencilModeForClipping(Pe),G,C.CullFaceMode.disabled,wt,d.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,d.paint,f.transform.zoom,Ue,Me.layoutVertexBuffer2)}},fill:function(f,l,d,x){const M=d.paint.get("fill-color"),D=d.paint.get("fill-opacity");if(0===D.constantOr(1))return;const B=f.colorModeForRenderPass(),G=d.paint.get("fill-pattern"),W=f.opaquePassEnabledForLayer()&&!G.constantOr(1)&&1===M.constantOr(C.Color.transparent).a&&1===D.constantOr(0)?"opaque":"translucent";if(f.renderPass===W){const Y=f.depthModeForSublayer(1,"opaque"===f.renderPass?C.DepthMode.ReadWrite:C.DepthMode.ReadOnly);Xo(f,l,d,x,Y,B,!1)}if("translucent"===f.renderPass&&d.paint.get("fill-antialias")){const Y=f.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,C.DepthMode.ReadOnly);Xo(f,l,d,x,Y,B,!0)}},"fill-extrusion":function(f,l,d,x){const M=d.paint.get("fill-extrusion-opacity");if(0!==M&&"translucent"===f.renderPass){const D=new C.DepthMode(f.context.gl.LEQUAL,C.DepthMode.ReadWrite,f.depthRangeFor3D);if(1!==M||d.paint.get("fill-extrusion-pattern").constantOr(1))wl(f,l,d,x,D,C.StencilMode.disabled,C.ColorMode.disabled),wl(f,l,d,x,D,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const B=f.colorModeForRenderPass();wl(f,l,d,x,D,C.StencilMode.disabled,B)}}},hillshade:function(f,l,d,x){if("offscreen"!==f.renderPass&&"translucent"!==f.renderPass)return;const M=f.context,D=f.depthModeForSublayer(0,C.DepthMode.ReadOnly),B=f.colorModeForRenderPass(),G=f.terrain&&f.terrain.renderingToTexture,[W,Y]="translucent"!==f.renderPass||G?[{},x]:f.stencilConfigForOverlap(x);for(const ee of Y){const Q=l.getTile(ee);if(Q.needsHillshadePrepare&&"offscreen"===f.renderPass)rc(f,Q,d,D,C.StencilMode.disabled,B);else if("translucent"===f.renderPass){const le=G&&f.terrain?f.terrain.stencilModeForRTTOverlap(ee):W[ee.overscaledZ];Is(f,ee,Q,d,D,le,B)}}M.viewport.set([0,0,f.width,f.height])},raster:function(f,l,d,x,M,D){if("translucent"!==f.renderPass||0===d.paint.get("raster-opacity")||!x.length)return;const B=f.context,G=B.gl,W=l.getSource(),Y=f.useProgram("raster"),ee=f.colorModeForRenderPass(),Q=f.terrain&&f.terrain.renderingToTexture,[le,de]=W instanceof se||Q?[{},x]:f.stencilConfigForOverlap(x),ge=de[de.length-1].overscaledZ,xe=!f.options.moving;for(const Te of de){const Ee=Q?C.DepthMode.disabled:f.depthModeForSublayer(Te.overscaledZ-ge,1===d.paint.get("raster-opacity")?C.DepthMode.ReadWrite:C.DepthMode.ReadOnly,G.LESS),Pe=Te.toUnwrapped(),Le=l.getTile(Te);if(Q&&(!Le||!Le.hasData()))continue;const Me=Q?Te.projMatrix:f.transform.calculateProjMatrix(Pe,xe),Ue=f.terrain&&Q?f.terrain.stencilModeForRTTOverlap(Te):le[Te.overscaledZ],Ye=D?0:d.paint.get("raster-fade-duration");Le.registerFadeDuration(Ye);const yt=l.findLoadedParent(Te,0),gt=Sh(Le,yt,l,f.transform,Ye);let Ot,dt;f.terrain&&f.terrain.prepareDrawTile(Te);const Nt="nearest"===d.paint.get("raster-resampling")?G.NEAREST:G.LINEAR;B.activeTexture.set(G.TEXTURE0),Le.texture.bind(Nt,G.CLAMP_TO_EDGE),B.activeTexture.set(G.TEXTURE1),yt?(yt.texture.bind(Nt,G.CLAMP_TO_EDGE),Ot=Math.pow(2,yt.tileID.overscaledZ-Le.tileID.overscaledZ),dt=[Le.tileID.canonical.x*Ot%1,Le.tileID.canonical.y*Ot%1]):Le.texture.bind(Nt,G.CLAMP_TO_EDGE);const wt=Ks(Me,dt||[0,0],Ot||1,gt,d);if(f.prepareDrawProgram(B,Y,Pe),W instanceof se)Y.draw(B,G.TRIANGLES,Ee,C.StencilMode.disabled,ee,C.CullFaceMode.disabled,wt,d.id,W.boundsBuffer,f.quadTriangleIndexBuffer,W.boundsSegments);else{const{tileBoundsBuffer:Zt,tileBoundsIndexBuffer:ft,tileBoundsSegments:Gt}=f.getTileBoundsBuffers(Le);Y.draw(B,G.TRIANGLES,Ee,Ue,ee,C.CullFaceMode.disabled,wt,d.id,Zt,ft,Gt)}}},background:function(f,l,d,x){const M=d.paint.get("background-color"),D=d.paint.get("background-opacity");if(0===D)return;const B=f.context,G=B.gl,W=f.transform,Y=W.tileSize,ee=d.paint.get("background-pattern");if(f.isPatternMissing(ee))return;const Q=!ee&&1===M.a&&1===D&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==Q)return;const le=C.StencilMode.disabled,de=f.depthModeForSublayer(0,"opaque"===Q?C.DepthMode.ReadWrite:C.DepthMode.ReadOnly),ge=f.colorModeForRenderPass(),xe=f.useProgram(ee?"backgroundPattern":"background");let Te,Ee=x;Ee||(Te=f.getBackgroundTiles(),Ee=Object.values(Te).map(Le=>Le.tileID)),ee&&(B.activeTexture.set(G.TEXTURE0),f.imageManager.bind(f.context));const Pe=d.getCrossfadeParameters();for(const Le of Ee){const Me=Le.toUnwrapped(),Ue=x?Le.projMatrix:f.transform.calculateProjMatrix(Me);f.prepareDrawTile(Le);const Ye=l?l.getTile(Le):Te?Te[Le.key]:new C.Tile(Le,Y,W.zoom,f),yt=ee?Ba(Ue,D,f,ee,{tileID:Le,tileSize:Y},Pe):Vs(Ue,D,M);f.prepareDrawProgram(B,xe,Me);const{tileBoundsBuffer:gt,tileBoundsIndexBuffer:Ot,tileBoundsSegments:dt}=f.getTileBoundsBuffers(Ye);xe.draw(B,G.TRIANGLES,de,le,ge,C.CullFaceMode.disabled,yt,d.id,gt,Ot,dt)}},sky:function(f,l,d){const x=f.transform,M="mercator"===x.projection.name?1:C.smoothstep(7,8,x.zoom),D=d.paint.get("sky-opacity")*M;if(0===D)return;const B=f.context,G=d.paint.get("sky-type"),W=new C.DepthMode(B.gl.LEQUAL,C.DepthMode.ReadOnly,[0,1]),Y=f.frameCounter/1e3%1;"atmosphere"===G?"offscreen"===f.renderPass?d.needsSkyboxCapture(f)&&(function(ee,Q,le,de){const ge=ee.context,xe=ge.gl;let Te=Q.skyboxFbo;if(!Te){Te=Q.skyboxFbo=ge.createFramebuffer(32,32,!1),Q.skyboxGeometry=new Cl(ge),Q.skyboxTexture=ge.gl.createTexture(),xe.bindTexture(xe.TEXTURE_CUBE_MAP,Q.skyboxTexture),xe.texParameteri(xe.TEXTURE_CUBE_MAP,xe.TEXTURE_WRAP_S,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_CUBE_MAP,xe.TEXTURE_WRAP_T,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_CUBE_MAP,xe.TEXTURE_MIN_FILTER,xe.LINEAR),xe.texParameteri(xe.TEXTURE_CUBE_MAP,xe.TEXTURE_MAG_FILTER,xe.LINEAR);for(let Me=0;Me<6;++Me)xe.texImage2D(xe.TEXTURE_CUBE_MAP_POSITIVE_X+Me,0,xe.RGBA,32,32,0,xe.RGBA,xe.UNSIGNED_BYTE,null)}ge.bindFramebuffer.set(Te.framebuffer),ge.viewport.set([0,0,32,32]);const Ee=Q.getCenter(ee,!0),Pe=ee.useProgram("skyboxCapture"),Le=new Float64Array(16);C.identity(Le),C.rotateY(Le,Le,.5*-Math.PI),us(ge,Q,Pe,Le,Ee,0),C.identity(Le),C.rotateY(Le,Le,.5*Math.PI),us(ge,Q,Pe,Le,Ee,1),C.identity(Le),C.rotateX(Le,Le,.5*-Math.PI),us(ge,Q,Pe,Le,Ee,2),C.identity(Le),C.rotateX(Le,Le,.5*Math.PI),us(ge,Q,Pe,Le,Ee,3),C.identity(Le),us(ge,Q,Pe,Le,Ee,4),C.identity(Le),C.rotateY(Le,Le,Math.PI),us(ge,Q,Pe,Le,Ee,5),ge.viewport.set([0,0,ee.width,ee.height])}(f,d),d.markSkyboxValid(f)):"sky"===f.renderPass&&function(ee,Q,le,de,ge){const xe=ee.context,Te=xe.gl,Ee=ee.transform,Pe=ee.useProgram("skybox");xe.activeTexture.set(Te.TEXTURE0),Te.bindTexture(Te.TEXTURE_CUBE_MAP,Q.skyboxTexture);const Le={u_matrix:Ee.skyboxMatrix,u_sun_direction:Q.getCenter(ee,!1),u_cubemap:0,u_opacity:de,u_temporal_offset:ge};ee.prepareDrawProgram(xe,Pe),Pe.draw(xe,Te.TRIANGLES,le,C.StencilMode.disabled,ee.colorModeForRenderPass(),C.CullFaceMode.backCW,Le,"skybox",Q.skyboxGeometry.vertexBuffer,Q.skyboxGeometry.indexBuffer,Q.skyboxGeometry.segment)}(f,d,W,D,Y):"gradient"===G&&"sky"===f.renderPass&&function(ee,Q,le,de,ge){const xe=ee.context,Te=xe.gl,Ee=ee.transform,Pe=ee.useProgram("skyboxGradient");Q.skyboxGeometry||(Q.skyboxGeometry=new Cl(xe)),xe.activeTexture.set(Te.TEXTURE0);let Le=Q.colorRampTexture;Le||(Le=Q.colorRampTexture=new C.Texture(xe,Q.colorRamp,Te.RGBA)),Le.bind(Te.LINEAR,Te.CLAMP_TO_EDGE);const Me=(Ue=Ee.skyboxMatrix,Ye=Q.getCenter(ee,!1),yt=Q.paint.get("sky-gradient-radius"),gt=de,Ot=ge,{u_matrix:Ue,u_color_ramp:0,u_center_direction:Ye,u_radius:C.degToRad(yt),u_opacity:gt,u_temporal_offset:Ot});var Ue,Ye,yt,gt,Ot;ee.prepareDrawProgram(xe,Pe),Pe.draw(xe,Te.TRIANGLES,le,C.StencilMode.disabled,ee.colorModeForRenderPass(),C.CullFaceMode.backCW,Me,"skyboxGradient",Q.skyboxGeometry.vertexBuffer,Q.skyboxGeometry.indexBuffer,Q.skyboxGeometry.segment)}(f,d,W,D,Y)},debug:function(f,l,d){for(let x=0;x<d.length;x++)Gu(f,l,d[x])},custom:function(f,l,d){const x=f.context,M=d.implementation;if("mercator"===f.transform.projection.name){if("offscreen"===f.renderPass){const D=M.prerender;D&&(f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),D.call(M,x.gl,f.transform.customLayerMatrix()),x.setDirty(),f.setBaseState())}else if("translucent"===f.renderPass){f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),x.setStencilMode(C.StencilMode.disabled);const D="3d"===M.renderingMode?new C.DepthMode(f.context.gl.LEQUAL,C.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,C.DepthMode.ReadOnly);x.setDepthMode(D),M.render(x.gl,f.transform.customLayerMatrix()),x.setDirty(),f.setBaseState(),x.bindFramebuffer.set(null)}}else C.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.")}};class Wh{constructor(l,d){this.context=new be(l),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=C.SourceCache.maxUnderzooming+C.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new io,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(l,d){const x=!!l&&!!l.terrain&&"mercator"===this.transform.projection.name;if(!(x||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new uo(this,l));const M=this._terrain;this.transform.elevation=x?M:null,M.update(l,this.transform,d)}_updateFog(l){const d=l.fog;if(!d||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[x,M]=d.getFovAdjustedRange(this.transform._fov);if(x>M)return void(this.transform.fogCullDistSq=null);const D=x+.78*(M-x);this.transform.fogCullDistSq=D*D}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(l,d){if(this.width=l*C.exported.devicePixelRatio,this.height=d*C.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const x of this.style.order)this.style._layers[x].resize()}setup(){const l=this.context,d=new C.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(C.EXTENT,0),d.emplaceBack(0,C.EXTENT),d.emplaceBack(C.EXTENT,C.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(d,C.posAttributes.members),this.tileExtentSegments=C.SegmentVector.simpleSegment(0,0,4,2);const x=new C.StructArrayLayout2i4;x.emplaceBack(0,0),x.emplaceBack(C.EXTENT,0),x.emplaceBack(0,C.EXTENT),x.emplaceBack(C.EXTENT,C.EXTENT),this.debugBuffer=l.createVertexBuffer(x,C.posAttributes.members),this.debugSegments=C.SegmentVector.simpleSegment(0,0,4,5);const M=new C.StructArrayLayout2i4;M.emplaceBack(-1,-1),M.emplaceBack(1,-1),M.emplaceBack(-1,1),M.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(M,C.posAttributes.members),this.viewportSegments=C.SegmentVector.simpleSegment(0,0,4,2);const D=new C.StructArrayLayout4i8;D.emplaceBack(0,0,0,0),D.emplaceBack(C.EXTENT,0,C.EXTENT,0),D.emplaceBack(0,C.EXTENT,0,C.EXTENT),D.emplaceBack(C.EXTENT,C.EXTENT,C.EXTENT,C.EXTENT),this.mercatorBoundsBuffer=l.createVertexBuffer(D,C.boundsAttributes.members),this.mercatorBoundsSegments=C.SegmentVector.simpleSegment(0,0,4,2);const B=new C.StructArrayLayout3ui6;B.emplaceBack(0,1,2),B.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(B);const G=new C.StructArrayLayout1ui2;for(const Y of[0,1,3,2,0])G.emplaceBack(Y);this.debugIndexBuffer=l.createIndexBuffer(G),this.emptyTexture=new C.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA),this.identityMat=C.create$1();const W=this.context.gl;this.stencilClearMode=new C.StencilMode({func:W.ALWAYS,mask:0},0,255,W.ZERO,W.ZERO,W.ZERO),this.loadTimeStamps.push(C.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context,d=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(l,d.TRIANGLES,C.DepthMode.disabled,this.stencilClearMode,C.ColorMode.disabled,C.CullFaceMode.disabled,Di(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,d,x){if(!(d&&this.currentStencilSource!==d.id&&l.isTileClipped()&&x&&x.length))return;this.currentStencilSource=d.id;const M=this.context,D=M.gl;this.nextStencilID+x.length>256&&this.clearStencil(),M.setColorMode(C.ColorMode.disabled),M.setDepthMode(C.DepthMode.disabled);const B=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const G of x){const W=d.getTile(G),Y=this._tileClippingMaskIDs[G.key]=this.nextStencilID++,{tileBoundsBuffer:ee,tileBoundsIndexBuffer:Q,tileBoundsSegments:le}=this.getTileBoundsBuffers(W);B.draw(M,D.TRIANGLES,C.DepthMode.disabled,new C.StencilMode({func:D.ALWAYS,mask:0},Y,255,D.KEEP,D.KEEP,D.REPLACE),C.ColorMode.disabled,C.CullFaceMode.disabled,Di(G.projMatrix),"$clipping",ee,Q,le)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,d=this.context.gl;return new C.StencilMode({func:d.NOTEQUAL,mask:255},l,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const d=this.context.gl;return new C.StencilMode({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(l){const d=this.context.gl,x=l.sort((B,G)=>G.overscaledZ-B.overscaledZ),M=x[x.length-1].overscaledZ,D=x[0].overscaledZ-M+1;if(D>1){this.currentStencilSource=void 0,this.nextStencilID+D>256&&this.clearStencil();const B={};for(let G=0;G<D;G++)B[G+M]=new C.StencilMode({func:d.GEQUAL,mask:255},G+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=D,[B,x]}return[{[M]:C.StencilMode.disabled},x]}colorModeForRenderPass(){const l=this.context.gl;if(this._showOverdrawInspector){const d=1/8;return new C.ColorMode([l.CONSTANT_COLOR,l.ONE],new C.Color(d,d,d,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?C.ColorMode.unblended:C.ColorMode.alphaBlended}depthModeForSublayer(l,d,x){if(!this.opaquePassEnabledForLayer())return C.DepthMode.disabled;const M=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new C.DepthMode(x||this.context.gl.LEQUAL,d,[M,M])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,d){this.style=l,this.options=d,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(C.exported.now()),this.imageManager.beginFrame();const x=this.style.order,M=this.style._sourceCaches;for(const Y in M){const ee=M[Y];ee.used&&ee.prepare(this.context)}const D={},B={},G={};for(const Y in M){const ee=M[Y];D[Y]=ee.getVisibleCoordinates(),B[Y]=D[Y].slice().reverse(),G[Y]=ee.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Y=0;Y<x.length;Y++)if(this.style._layers[x[Y]].is3D()){this.opaquePassCutoff=Y;break}if(this.terrain&&(this.terrain.updateTileBinding(G),this.opaquePassCutoff=0),!C.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const Y of x){const ee=this.style._layers[Y],Q=l._getLayerSourceCache(ee);if(!ee.hasOffscreenPass()||ee.isHidden(this.transform.zoom))continue;const le=Q?B[Q.id]:void 0;("custom"===ee.type||ee.isSky()||le&&le.length)&&this.renderLayer(this,Q,ee,le)}this.depthRangeFor3D=[0,1-(l.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let W=C.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(W=this.style.fog.properties.get("color")),this.context.clear({color:d.showOverdrawInspector?C.Color.black:W,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const Y=this.style._layers[x[this.currentLayer]],ee=l._getLayerSourceCache(Y);if(Y.isSky())continue;const Q=ee?B[ee.id]:void 0;this._renderTileClippingMasks(Y,ee,Q),this.renderLayer(this,ee,Y,Q)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const Y=this.style._layers[x[this.currentLayer]],ee=l._getLayerSourceCache(Y);Y.isSky()&&this.renderLayer(this,ee,Y,ee?B[ee.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<x.length;){const Y=this.style._layers[x[this.currentLayer]],ee=l._getLayerSourceCache(Y);if(Y.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(Y)){if(Y.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const Q=ee?("symbol"===Y.type?G:B)[ee.id]:void 0;this._renderTileClippingMasks(Y,ee,ee?D[ee.id]:void 0),this.renderLayer(this,ee,Y,Q),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let Y=null;C.values(this.style._layers).forEach(ee=>{const Q=l._getLayerSourceCache(ee);Q&&!ee.isHidden(this.transform.zoom)&&(!Y||Y.getSource().maxzoom<Q.getSource().maxzoom)&&(Y=Q)}),Y&&this.options.showTileBoundaries&&nh.debug(this,Y,Y.getVisibleCoordinates())}this.options.showPadding&&function(Y){const ee=Y.transform.padding;ja(Y,Y.transform.height-(ee.top||0),3,bi),ja(Y,ee.bottom||0,3,Ji),cp(Y,ee.left||0,3,ac),cp(Y,Y.transform.width-(ee.right||0),3,Lc);const Q=Y.transform.centerPoint;var le,de,ge,xe;Vu(le=Y,(de=Q.x)-1,(ge=Y.transform.height-Q.y)-10,2,20,xe=sc),Vu(le,de-10,ge-1,20,2,xe)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%C.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(C.window.performance.now()),this.saveCanvasCopy())}renderLayer(l,d,x,M){x.isHidden(this.transform.zoom)||("background"===x.type||"sky"===x.type||"custom"===x.type||M&&M.length)&&(this.id=x.id,this.gpuTimingStart(x),nh[x.type](l,d,x,M,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery;let x=this.gpuTimers[l.id];x||(x=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),x.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,x.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}queryGpuTimers(l){const d={};for(const x in l){const M=l[x],D=this.context.extTimerQuery,B=D.getQueryObjectEXT(M.query,D.QUERY_RESULT_EXT)/1e6;D.deleteQueryEXT(M.query),d[x]=B}return d}translatePosMatrix(l,d,x,M,D){if(!x[0]&&!x[1])return l;const B=D?"map"===M?this.transform.angle:0:"viewport"===M?-this.transform.angle:0;if(B){const Y=Math.sin(B),ee=Math.cos(B);x=[x[0]*ee-x[1]*Y,x[0]*Y+x[1]*ee]}const G=[D?x[0]:vr(d,x[0],this.transform.zoom),D?x[1]:vr(d,x[1],this.transform.zoom),0],W=new Float32Array(16);return C.translate(W,l,G),W}saveTileTexture(l){const d=this._tileTextures[l.size[0]];d?d.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const d=this._tileTextures[l];return d&&d.length>0?d.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const d=this.imageManager.getPattern(l.from.toString()),x=this.imageManager.getPattern(l.to.toString());return!d||!x}currentGlobalDefines(){const l=this.terrain&&this.terrain.renderingToTexture,d=this.style&&this.style.fog,x=[];return this.terrain&&!this.terrain.renderingToTexture&&x.push("TERRAIN"),d&&!l&&0!==d.getOpacity(this.transform.pitch)&&x.push("FOG"),l&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}useProgram(l,d,x){this.cache=this.cache||{};const M=x||[],D=this.currentGlobalDefines().concat(M),B=tu.cacheKey(l,D,d);return this.cache[B]||(this.cache[B]=new tu(this.context,l,eu[l],d,Rp[l],D)),this.cache[B]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=C.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new C.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(l){this.terrain&&this.terrain.prepareDrawTile(l)}prepareDrawProgram(l,d,x){if(this.terrain&&this.terrain.renderingToTexture)return;const M=this.style.fog;if(M){const D=M.getOpacity(this.transform.pitch);0!==D&&d.setFogUniformValues(l,((B,G,W,Y)=>{const ee=G.properties.get("color"),Q=B.frameCounter/1e3%1,le=[ee.r/ee.a,ee.g/ee.a,ee.b/ee.a,Y];return{u_fog_matrix:W?B.transform.calculateFogTileMatrix(W):B.identityMat,u_fog_range:G.getFovAdjustedRange(B.transform._fov),u_fog_color:le,u_fog_horizon_blend:G.properties.get("horizon-blend"),u_fog_temporal_offset:Q}})(this,M,x,D))}}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const l=this.context.gl,d=l.createTexture();return l.bindTexture(l.TEXTURE_2D,d),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&0!==l.getOpacity(this.transform.pitch)}getBackgroundTiles(){const l=this._backgroundTiles,d=this._backgroundTiles={},x=this.transform.coveringTiles({tileSize:512});for(const M of x)d[M.key]=l[M.key]||new C.Tile(M,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}}class jl{constructor(l=0,d=0,x=0,M=0){if(isNaN(l)||l<0||isNaN(d)||d<0||isNaN(x)||x<0||isNaN(M)||M<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=d,this.left=x,this.right=M}interpolate(l,d,x){return null!=d.top&&null!=l.top&&(this.top=C.number(l.top,d.top,x)),null!=d.bottom&&null!=l.bottom&&(this.bottom=C.number(l.bottom,d.bottom,x)),null!=d.left&&null!=l.left&&(this.left=C.number(l.left,d.left,x)),null!=d.right&&null!=l.right&&(this.right=C.number(l.right,d.right,x)),this}getCenter(l,d){const x=C.clamp((this.left+l-this.right)/2,0,l),M=C.clamp((this.top+d-this.bottom)/2,0,d);return new C.pointGeometry(x,M)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new jl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function cs(f,l){return[f[4*l],f[4*l+1],f[4*l+2],f[4*l+3]]}function El(f,l,d){f[4*l+0]=d[0],f[4*l+1]=d[1],f[4*l+2]=d[2],f[4*l+3]=d[3]}function _o(f,l){const d=cs(f,3);C.fromQuat(f,l),El(f,3,d)}function $h(f,l){El(f,3,[l[0],l[1],l[2],1])}function Zu(f,l){const d=C.identity$1([]);return C.rotateZ$1(d,d,-l),C.rotateX$1(d,d,-f),d}function iu(f,l){const d=[f[0],f[1],0],x=[l[0],l[1],0];if(C.length(d)>=1e-15){const B=C.normalize([],d);C.scale(x,B,C.dot(x,B)),l[0]=x[0],l[1]=x[1]}const M=C.cross([],l,f);if(C.len(M)<1e-15)return null;const D=Math.atan2(-M[1],M[0]);return Zu(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),D)}class qi{constructor(l,d){this.position=l,this.orientation=d}get position(){return this._position}set position(l){this._position=this._renderWorldCopies?function(d){if(!d)return;const x=Array.isArray(d)?new C.MercatorCoordinate(d[0],d[1],d[2]):d;return x.x=C.wrap(x.x,0,1),x}(l):l}lookAtPoint(l,d){if(this.orientation=null,!this.position)return;const x=this._elevation?this._elevation.getAtPointOrZero(C.MercatorCoordinate.fromLngLat(l)):0,M=this.position,D=C.MercatorCoordinate.fromLngLat(l,x),B=[D.x-M.x,D.y-M.y,D.z-M.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=iu(B,d)}setPitchBearing(l,d){this.orientation=Zu(C.degToRad(l),C.degToRad(-d))}}class yi{constructor(l,d){this._transform=C.identity([]),this._orientation=C.identity$1([]),d&&(this._orientation=d,_o(this._transform,this._orientation)),l&&$h(this._transform,l)}get mercatorPosition(){const l=this.position;return new C.MercatorCoordinate(l[0],l[1],l[2])}get position(){const l=cs(this._transform,3);return[l[0],l[1],l[2]]}set position(l){$h(this._transform,l)}get orientation(){return this._orientation}set orientation(l){this._orientation=l,_o(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,d){this._orientation=Zu(l,d),_o(this._transform,this._orientation)}forward(){const l=cs(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=cs(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=cs(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,d){const x=new Float64Array(16);return C.invert(x,this.getWorldToCamera(l,d)),x}getWorldToCameraPosition(l,d,x){const M=this.position;C.scale(M,M,-l);const D=new Float64Array(16);return C.fromScaling(D,[x,x,x]),C.translate(D,D,M),D[10]*=d,D}getWorldToCamera(l,d){const x=new Float64Array(16),M=new Float64Array(4),D=this.position;return C.conjugate(M,this._orientation),C.scale(D,D,-l),C.fromQuat(x,M),C.translate(x,x,D),x[1]*=-1,x[5]*=-1,x[9]*=-1,x[13]*=-1,x[8]*=d,x[9]*=d,x[10]*=d,x[11]*=d,x}getCameraToClipPerspective(l,d,x,M){const D=new Float64Array(16);return C.perspective(D,l,d,x,M),D}getDistanceToElevation(l){const d=0===l?0:C.mercatorZfromAltitude(l,this.position[1]),x=this.forward();return(d-this.position[2])/x[2]}clone(){return new yi([...this.position],[...this.orientation])}}function ou(f,l){const d=rd(f),x=function(D,B,G,W,Y){const ee=new C.LngLat(G.lng-180*_u,G.lat),Q=new C.LngLat(G.lng+180*_u,G.lat),le=D.project(ee.lng,ee.lat),de=D.project(Q.lng,Q.lat),ge=-Math.atan2(de.y-le.y,de.x-le.x),xe=C.MercatorCoordinate.fromLngLat(G);xe.y=C.clamp(xe.y,-.999975,.999975);const Te=xe.toLngLat(),Ee=D.project(Te.lng,Te.lat),Pe=C.MercatorCoordinate.fromLngLat(Te);Pe.x+=_u;const Le=Pe.toLngLat(),Me=D.project(Le.lng,Le.lat),Ue=Lp(Me.x-Ee.x,Me.y-Ee.y,ge),Ye=C.MercatorCoordinate.fromLngLat(Te);Ye.y+=_u;const yt=Ye.toLngLat(),gt=D.project(yt.lng,yt.lat),Ot=Lp(gt.x-Ee.x,gt.y-Ee.y,ge),dt=Math.abs(Ue.x)/Math.abs(Ot.y),Nt=C.identity([]);C.rotateZ(Nt,Nt,-ge*(1-(Y?0:W)));const wt=C.identity([]);return C.scale$1(wt,wt,[1,1-(1-dt)*W,1]),wt[4]=-Ot.x/Ot.y*W,C.rotateZ(wt,wt,ge),C.multiply(wt,Nt,wt),wt}(f.projection,0,f.center,d,l),M=Sl(f);return C.scale$1(x,x,[M,M,1]),x}function Sl(f){const l=f.projection,d=rd(f),x=vi(l,f.center),M=vi(l,C.LngLat.convert(l.center));return Math.pow(2,x*d+(1-d)*M)}function rd(f){const l=f.projection.range;if(!l)return 0;const d=Math.max(f.width,f.height),x=Math.log(d/1024)/Math.LN2;return C.smoothstep(l[0]+x,l[1]+x,f.zoom)}const _u=1/4e4;function vi(f,l){const d=C.clamp(l.lat,-C.MAX_MERCATOR_LATITUDE,C.MAX_MERCATOR_LATITUDE),x=new C.LngLat(l.lng-180*_u,d),M=new C.LngLat(l.lng+180*_u,d),D=f.project(x.lng,d),B=f.project(M.lng,d),G=C.MercatorCoordinate.fromLngLat(x),W=C.MercatorCoordinate.fromLngLat(M),Y=B.x-D.x,ee=B.y-D.y,Q=W.x-G.x,le=W.y-G.y,de=Math.sqrt((Q*Q+le*le)/(Y*Y+ee*ee));return Math.log(de)/Math.LN2}function Lp(f,l,d){const x=Math.cos(d),M=Math.sin(d);return{x:f*x-l*M,y:f*M+l*x}}class hp{constructor(l,d,x,M,D){this.tileSize=512,this._renderWorldCopies=void 0===D||D,this._minZoom=l||0,this._maxZoom=d||22,this._minPitch=null==x?0:x,this._maxPitch=null==M?60:M,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new C.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new jl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new yi,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const l=new hp(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l.tileSize=this.tileSize,l.setMaxBounds(this.getMaxBounds()),l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._cameraZoom=this._cameraZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._averageElevation=this._averageElevation,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.setProjection(this.getProjection()),l}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,l?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(l){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),l&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return C.pick(this.projection,["name","center","parallels"])}setProjection(l){null==l&&(l={name:"mercator"}),this.projectionOptions=l;const d=this.projection?this.getProjection():void 0;return this.projection=C.getProjection(l),!it(d,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.wrap}set renderWorldCopies(l){void 0===l?l=!0:null===l&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return C.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return C.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new C.pointGeometry(this.width,this.height)}get bearing(){return C.wrap(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const d=-l*Math.PI/180;var x,M,D,B,G,W,Y,ee,Q,le;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(x=new C.ARRAY_TYPE(4),C.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0),x[0]=1,x[3]=1,x),M=this.rotationMatrix,B=this.angle,G=(D=this.rotationMatrix)[0],W=D[1],Y=D[2],ee=D[3],Q=Math.sin(B),le=Math.cos(B),M[0]=G*le+Y*Q,M[1]=W*le+ee*Q,M[2]=G*-Q+Y*le,M[3]=W*-Q+ee*le)}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const d=C.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(l){const d=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return-1===l?(this._cameraZoom=null,!1):(this._centerAltitude=l,!0)}_updateCameraOnTerrain(){const l=this.cameraToCenterDistance/this.worldSize,d=C.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(d+l)}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],x=this.horizonLineFromTop();let M=0,D=0;for(let B=0;B<d.length;B++){const G=new C.pointGeometry(d[B][0]*this.width,x+d[B][1]*(this.height-x)),W=l.pointCoordinate(G);if(!W)continue;const Y=1/Math.hypot(W[0]-this._camera.position[0],W[1]-this._camera.position[1]);M+=W[3]*Y,D+=Y}return 0===D?NaN:M/D}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const l=this._cameraZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),x=C.mercatorZfromAltitude(d,this.center.lat),M=this._mercatorZfromZoom(l),D=this._mercatorZfromZoom(this._maxZoom),B=Math.max(M-x,D);this._setZoom(this._zoomFromMercatorZ(B))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let x;x=l.z<this._camera.position[2]?[d.x,d.y,d.z]:[l.x,l.y,l.z];const M=C.length(C.sub([],this._camera.position,x));return C.clamp(this._zoomFromMercatorZ(M),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let d=!1;if(l.orientation&&!C.exactEquals(l.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(l.orientation)),l.position){const x=[l.position.x,l.position.y,l.position.z];C.exactEquals$1(x,this._camera.position)||(this._setCameraPosition(x),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,d=new qi;return d.position=new C.MercatorCoordinate(l[0],l[1],l[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(l){if(!C.length$1(l))return!1;C.normalize$1(l,l);const d=C.transformQuat([],[0,0,-1],l),x=C.transformQuat([],[0,-1,0],l);if(x[2]<0)return!1;const M=iu(d,x);return!!M&&(this._camera.orientation=M,!0)}_setCameraPosition(l){const d=this.zoomScale(this.minZoom)*this.tileSize,x=this.zoomScale(this.maxZoom)*this.tileSize,M=this.cameraToCenterDistance;l[2]=C.clamp(l[2],M/x,M/d),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,d,x){this._unmodified=!1,this._edgeInsets.interpolate(l,d,x),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const d=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(l){const d=[new C.UnwrappedTileID(0,l)];if(this.renderWorldCopies){const x=this.pointCoordinate(new C.pointGeometry(0,0)),M=this.pointCoordinate(new C.pointGeometry(this.width,0)),D=this.pointCoordinate(new C.pointGeometry(this.width,this.height)),B=this.pointCoordinate(new C.pointGeometry(0,this.height)),G=Math.floor(Math.min(x.x,M.x,D.x,B.x)),W=Math.floor(Math.max(x.x,M.x,D.x,B.x)),Y=1;for(let ee=G-Y;ee<=W+Y;ee++)0!==ee&&d.push(new C.UnwrappedTileID(ee,l))}return d}coveringTiles(l){let d=this.coveringZoomLevel(l);const x=d,M=this.elevation&&!l.isTerrainDEM,D="mercator"===this.projection.name;if(void 0!==l.minzoom&&d<l.minzoom)return[];void 0!==l.maxzoom&&d>l.maxzoom&&(d=l.maxzoom);const B=this.locationCoordinate(this.center),G=1<<d,W=[G*B.x,G*B.y,0],Y=bn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d),ee=this.pointCoordinate(this.getCameraPoint()),Q=G*C.mercatorZfromAltitude(1,this.center.lat),le=this._camera.position[2]/C.mercatorZfromAltitude(1,this.center.lat),de=[G*ee.x,G*ee.y,le],ge=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),xe=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&D?d:0,Te=l.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Ee=l.isTerrainDEM?-Te:this._elevation?this._elevation.getMinElevationBelowMSL():0,Pe=Sl(this),Le=ft=>{const Gt=1/4e4,Qt=new C.MercatorCoordinate(ft.x+Gt,ft.y,ft.z),mn=new C.MercatorCoordinate(ft.x,ft.y+Gt,ft.z),Hn=ft.toLngLat(),gr=Qt.toLngLat(),wr=mn.toLngLat(),tr=this.locationCoordinate(Hn),Cr=this.locationCoordinate(gr),Wr=this.locationCoordinate(wr),Zi=Math.hypot(Cr.x-tr.x,Cr.y-tr.y),ha=Math.hypot(Wr.x-tr.x,Wr.y-tr.y);return Math.sqrt(Zi*ha)*Pe/Gt},Me=(ft,Gt,Qt,mn,Hn,gr)=>{const wr=C.tileTransform({z:ft,x:Gt,y:Qt},this.projection);return new Pn([(mn+wr.x/wr.scale)*G,G*(wr.y/wr.scale),Hn],[(mn+wr.x2/wr.scale)*G,G*(wr.y2/wr.scale),gr])},Ue=ft=>({aabb:Me(0,0,0,ft,Ee,Te),zoom:0,x:0,y:0,wrap:ft,fullyVisible:!1}),Ye=[];let yt=[];const gt=d,Ot=l.reparseOverscaled?x:d,dt=ft=>{if(!this._elevation||!ft.tileID)return;const Gt=this._elevation.getMinMaxForTile(ft.tileID),Qt=ft.aabb;Gt?(Qt.min[2]=Gt.min,Qt.max[2]=Gt.max,Qt.center[2]=(Qt.min[2]+Qt.max[2])/2):(ft.shouldSplit=Zt(ft),ft.shouldSplit||(Qt.min[2]=Qt.max[2]=Qt.center[2]=this._centerAltitude))},Nt=ft=>ft*ft,wt=Nt((le-this._centerAltitude)*Q),Zt=ft=>{if(ft.zoom<xe)return!0;if(ft.zoom===gt)return!1;if(null!=ft.shouldSplit)return ft.shouldSplit;const Gt=ft.aabb.distanceX(de),Qt=ft.aabb.distanceY(de);let mn=wt;M&&(mn=Nt(ft.aabb.distanceZ(de)*Q));let Hn=1;if(!D&&x<=5){const wr=Math.pow(2,ft.zoom),tr=Le(new C.MercatorCoordinate((ft.x+.5)/wr,(ft.y+.5)/wr));Hn=tr>.85?1:tr}const gr=Gt*Gt+Qt*Qt+mn;return gr<Nt((1<<gt-ft.zoom)*ge*Hn*((wr,tr)=>{if(tr*Nt(.707)<wr)return 1;const Cr=Math.sqrt(tr/wr);return Cr/(1.4144271570014144+(Math.pow(1.1,Cr-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(mn,wt),gr))};if(this.renderWorldCopies)for(let ft=1;ft<=3;ft++)Ye.push(Ue(-ft)),Ye.push(Ue(ft));for(Ye.push(Ue(0));Ye.length>0;){const ft=Ye.pop(),Gt=ft.x,Qt=ft.y;let mn=ft.fullyVisible;if(!mn){const Hn=ft.aabb.intersects(Y);if(0===Hn)continue;mn=2===Hn}if(ft.zoom!==gt&&Zt(ft))for(let Hn=0;Hn<4;Hn++){const gr=(Gt<<1)+Hn%2,wr=(Qt<<1)+(Hn>>1),tr={aabb:"mercator"===this.projection.name?ft.aabb.quadrant(Hn):Me(ft.zoom+1,gr,wr,ft.wrap,0,0),zoom:ft.zoom+1,x:gr,y:wr,wrap:ft.wrap,fullyVisible:mn,tileID:void 0,shouldSplit:void 0};M&&(tr.tileID=new C.OverscaledTileID(ft.zoom+1===gt?Ot:ft.zoom+1,ft.wrap,ft.zoom+1,gr,wr),dt(tr)),Ye.push(tr)}else{const Hn=ft.zoom===gt?Ot:ft.zoom;if(l.minzoom&&l.minzoom>Hn)continue;const gr=W[0]-(.5+Gt+(ft.wrap<<ft.zoom))*(1<<d-ft.zoom),wr=W[1]-.5-Qt,tr=ft.tileID?ft.tileID:new C.OverscaledTileID(Hn,ft.wrap,ft.zoom,Gt,Qt);yt.push({tileID:tr,distanceSq:gr*gr+wr*wr})}}if(this.fogCullDistSq){const ft=this.fogCullDistSq,Gt=this.horizonLineFromTop();yt=yt.filter(Qt=>{const mn=[0,0,0,1],Hn=[C.EXTENT,C.EXTENT,0,1],gr=this.calculateFogTileMatrix(Qt.tileID.toUnwrapped());C.transformMat4(mn,mn,gr),C.transformMat4(Hn,Hn,gr);const wr=C.getAABBPointSquareDist(mn,Hn);if(0===wr)return!0;let tr=!1;const Cr=this._elevation;if(Cr&&wr>ft&&0!==Gt){const Wr=this.calculateProjMatrix(Qt.tileID.toUnwrapped());let Zi;l.isTerrainDEM||(Zi=Cr.getMinMaxForTile(Qt.tileID)),Zi||(Zi={min:Ee,max:Te});const ha=C.furthestTileCorner(this.rotation),Do=[ha[0]*C.EXTENT,ha[1]*C.EXTENT,Zi.max];C.transformMat4$1(Do,Do,Wr),tr=(1-Do[1])*this.height*.5<Gt}return wr<ft||tr})}return yt.sort((ft,Gt)=>ft.distanceSq-Gt.distanceSq).map(ft=>ft.tileID)}resize(l,d){this.width=l,this.height=d,this.pixelsToGLUnits=[2/l,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const d=C.clamp(l.lat,-C.MAX_MERCATOR_LATITUDE,C.MAX_MERCATOR_LATITUDE),x=this.projection.project(l.lng,d);return new C.pointGeometry(x.x*this.worldSize,x.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(l,d){const x=this.pointCoordinate(d),M=this.pointCoordinate(this.centerPoint),D=this.locationCoordinate(l);this.setLocation(new C.MercatorCoordinate(D.x-(x.x-M.x),D.y-(x.y-M.y)))}setLocation(l){this.center=this.coordinateLocation(l),this.renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(l){return this._coordinatePoint(this.locationCoordinate(l),!1)}locationPoint3D(l){return this._coordinatePoint(this.locationCoordinate(l),!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,d){const x=d?C.mercatorZfromAltitude(d,l.lat):void 0,M=this.projection.project(l.lng,l.lat);return new C.MercatorCoordinate(M.x,M.y,x)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,d){const x=null!=d?d:this._centerAltitude,M=[l.x,l.y,0,1],D=[l.x,l.y,1,1];C.transformMat4(M,M,this.pixelMatrixInverse),C.transformMat4(D,D,this.pixelMatrixInverse);const B=D[3];C.scale$2(M,M,1/M[3]),C.scale$2(D,D,1/B);const G=M[2],W=D[2];return{p0:M,p1:D,t:G===W?0:(x-G)/(W-G)}}screenPointToMercatorRay(l){const d=[l.x,l.y,0,1],x=[l.x,l.y,1,1];return C.transformMat4(d,d,this.pixelMatrixInverse),C.transformMat4(x,x,this.pixelMatrixInverse),C.scale$2(d,d,1/d[3]),C.scale$2(x,x,1/x[3]),d[2]=C.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,x[2]=C.mercatorZfromAltitude(x[2],this._center.lat)*this.worldSize,C.scale$2(d,d,1/this.worldSize),C.scale$2(x,x,1/this.worldSize),new Dt([d[0],d[1],d[2]],C.normalize([],C.sub([],x,d)))}rayIntersectionCoordinate(l){const{p0:d,p1:x,t:M}=l,D=C.mercatorZfromAltitude(d[2],this._center.lat),B=C.mercatorZfromAltitude(x[2],this._center.lat);return new C.MercatorCoordinate(C.number(d[0],x[0],M)/this.worldSize,C.number(d[1],x[1],M)/this.worldSize,C.number(D,B,M))}pointCoordinate(l,d=this._centerAltitude){const x=this.horizonLineFromTop(!1),M=new C.pointGeometry(l.x,Math.max(x,l.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(M,d))}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);const d=this.elevation;let x=this.elevation.pointCoordinate(l);if(x)return new C.MercatorCoordinate(x[0],x[1],x[2]);let M=0,D=this.horizonLineFromTop();if(l.y>D)return this.pointCoordinate(l);const B=.02*D,G=l.clone();for(let W=0;W<10&&D-M>B;W++){G.y=C.number(M,D,.66);const Y=d.pointCoordinate(G);Y?(D=G.y,x=Y):M=G.y}return x?new C.MercatorCoordinate(x[0],x[1],x[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){if(this.elevation)return!this.elevation.pointCoordinate(l);{const d=this.horizonLineFromTop();return l.y<d}}_coordinatePoint(l,d){const x=d&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,M=[l.x*this.worldSize,l.y*this.worldSize,x+l.toAltitude(),1];return C.transformMat4(M,M,this.pixelMatrix),M[3]>0?new C.pointGeometry(M[0]/M[3],M[1]/M[3]):new C.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(l,d){const x=new C.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),M=new C.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),D=new C.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),B=new C.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let G=this.pointCoordinate(x,l),W=this.pointCoordinate(M,l);const Y=this.pointCoordinate(D,d),ee=this.pointCoordinate(B,d),Q=(le,de)=>(de.y-le.y)/(de.x-le.x);return G.y>1&&W.y>=0?G=new C.MercatorCoordinate((1-ee.y)/Q(ee,G)+ee.x,1):G.y<0&&W.y<=1&&(G=new C.MercatorCoordinate(-ee.y/Q(ee,G)+ee.x,0)),W.y>1&&G.y>=0?W=new C.MercatorCoordinate((1-Y.y)/Q(Y,W)+Y.x,1):W.y<0&&G.y<=1&&(W=new C.MercatorCoordinate(-Y.y/Q(Y,W)+Y.x,0)),(new C.LngLatBounds).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(Y))}_getBounds3D(){const l=this.elevation,d=l.visibleDemTiles.reduce((x,M)=>{if(M.dem){const D=M.dem.tree;x.min=Math.min(x.min,D.minimums[0]),x.max=Math.max(x.max,D.maximums[0])}return x},{min:Number.MAX_VALUE,max:0});return this._getBounds(d.min*l.exaggeration(),d.max*l.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(l=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,x=this.height/2-d*(1-this._horizonShift);return l?Math.max(0,x):x}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-C.MAX_MERCATOR_LATITUDE,this.maxLat=C.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=C.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=C.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=C.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=C.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,d){let x,M,D;const B=l.canonical,G=C.identity(new Float64Array(16));if("mercator"===this.projection.name)x=d/this.zoomScale(B.z),M=(B.x+Math.pow(2,B.z)*l.wrap)*x,D=B.y*x;else{const W=C.tileTransform(B,this.projection);x=1,M=W.x+l.wrap*W.scale,D=W.y,C.scale$1(G,G,[x/W.scale,x/W.scale,this.pixelsPerMeter/this.worldSize])}return C.translate(G,G,[M,D,0]),C.scale$1(G,G,[x/C.EXTENT,x/C.EXTENT,1]),G}calculateDistanceTileData(l){const d=l.key,x=this._distanceTileDataCache;if(x[d])return x[d];const M=l.canonical,D=1/this.height,B=this.cameraWorldSize/this.zoomScale(M.z),G=(M.x+Math.pow(2,M.z)*l.wrap)*B,W=M.y*B,Y=this.point,ee=this.angle,Q=Math.sin(-ee),le=-Math.cos(-ee);return x[d]={bearing:[Q,le],center:[(Y.x-G)*D,(Y.y-W)*D],scale:B/C.EXTENT*D},x[d]}calculateFogTileMatrix(l){const d=l.key,x=this._fogTileMatrixCache;if(x[d])return x[d];const M=this.calculatePosMatrix(l,this.cameraWorldSize);return C.multiply(M,this.worldToFogMatrix,M),x[d]=new Float32Array(M),x[d]}calculateProjMatrix(l,d=!1){const x=l.key,M=d?this._alignedProjMatrixCache:this._projMatrixCache;if(M[x])return M[x];const D=this.calculatePosMatrix(l,this.worldSize);return C.multiply(D,"mercator"===this.projection.name?d?this.alignedProjMatrix:this.projMatrix:this.mercatorMatrix,D),M[x]=new Float32Array(D),M[x]}calculatePixelsToTileUnitsMatrix(l){const d=l.tileID.key,x=this._pixelsToTileUnitsCache;if(x[d])return x[d];const M=function(D,B){const{scale:G}=D.tileTransform,W=G*C.EXTENT/(D.tileSize*Math.pow(2,B.zoom-D.tileID.overscaledZ+D.tileID.canonical.z));return Y=new Float32Array(4),le=(ee=B.inverseAdjustmentMatrix)[1],de=ee[2],ge=ee[3],Te=(Q=[W,W])[1],Y[0]=ee[0]*(xe=Q[0]),Y[1]=le*xe,Y[2]=de*Te,Y[3]=ge*Te,Y;var Y,ee,Q,le,de,ge,xe,Te}(l,this);return x[d]=M,x[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const l=this._elevation;this._updateCameraState();const d=this._camera.position,x=this._camera.forward();if(d[2]<=0||x[2]>=0)return;const M=C.mercatorZfromAltitude(1,this._center.lat);d[2]/=M,x[2]/=M,C.normalize(x,x);const D=l.raycast(d,x,l.exaggeration());if(D){const B=C.scaleAndAdd([],d,x,D),G=new C.MercatorCoordinate(B[0],B[1],C.mercatorZfromAltitude(B[2],C.latFromMercatorY(B[1]))),W=this._camera.position,Y=G.z+C.length([G.x-W[0],G.y-W[1],G.z-W[2]]);this._cameraZoom=this._zoomFromMercatorZ(Y),this._centerAltitude=G.toAltitude(),this._center=this.coordinateLocation(G),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const l=this._elevation;this._updateCameraState();const d=l.getAtPointOrZero(this._camera.mercatorPosition),x=this._minimumHeightOverTerrain()*Math.cos(C.degToRad(this._maxPitch)),M=C.mercatorZfromAltitude(d,this._center.lat),D=this._camera.position[2]-M;if(D<x){const B=this.locationCoordinate(this._center,this._centerAltitude),G=this._camera.mercatorPosition,W=[B.x-G.x,B.y-G.y,B.z-G.z],Y=C.length(W);W[2]-=x-D;const ee=C.length(W);if(0===ee)return;C.scale(W,W,Y/ee),this._camera.position=[B.x-W[0],B.y-W[1],B.z-W[2]],this._camera.orientation=iu(W,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,"mercator"!==this.projection.name){const Q=this.center;return Q.lat=C.clamp(Q.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(Q.lng=C.clamp(Q.lng,this.minLng,this.maxLng)),this.center=Q,void(this._constraining=!1)}const l=this._unmodified,{x:d,y:x}=this.point;let M=0,D=d,B=x;const G=this.width/2,W=this.height/2,Y=this.worldMinY*this.scale,ee=this.worldMaxY*this.scale;if(x-W<Y&&(B=Y+W),x+W>ee&&(B=ee-W),ee-Y<this.height&&(M=Math.max(M,this.height/(ee-Y)),B=(ee+Y)/2),this.maxBounds||!this.renderWorldCopies){const Q=this.worldMinX*this.scale,le=this.worldMaxX*this.scale,de=this.worldSize/2-(Q+le)/2;D=(d+de+this.worldSize)%this.worldSize-de,D-G<Q&&(D=Q+G),D+G>le&&(D=le-G),le-Q<this.width&&(M=Math.max(M,this.width/(le-Q)),D=(le+Q)/2)}D===d&&B===x||(this.center=this.unproject(new C.pointGeometry(D,B))),M&&(this.zoom+=this.scaleZoom(M)),this._constrainCameraAltitude(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const d=this.pixelsPerMeter;this._updateCameraState();const x=Math.PI/2+this._pitch,M=this.fovAboveCenter,D=this.elevation?this.elevation.getMinElevationBelowMSL()*d:0,B=(this._camera.position[2]*this.worldSize-D)/Math.cos(this._pitch),G=Math.sin(M)*B/Math.sin(C.clamp(Math.PI-x-M,.01,Math.PI-.01)),W=this.point,Y=W.x,ee=W.y,Q=Math.cos(Math.PI/2-this._pitch)*G+B,le=Math.min(1.01*Q,B*(1/this._horizonShift)),de=this.height/50,ge=this._camera.getWorldToCamera(this.worldSize,d),xe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,de,le);xe[8]=2*-l.x/this.width,xe[9]=2*l.y/this.height;let Te=C.mul$1([],xe,ge);if("mercator"!==this.projection.name){const Nt=this.locationCoordinate(this.center),wt=C.identity([]);C.translate(wt,wt,[Nt.x*this.worldSize,Nt.y*this.worldSize,0]),C.multiply(wt,wt,ou(this)),C.translate(wt,wt,[-Nt.x*this.worldSize,-Nt.y*this.worldSize,0]),C.multiply(Te,Te,wt),this.inverseAdjustmentMatrix=function(Zt){const ft=ou(Zt,!0);return _t([],[ft[0],ft[1],ft[4],ft[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=C.scale$1([],Te,[this.worldSize,this.worldSize,this.worldSize/d]),this.projMatrix=Te,this.invProjMatrix=C.invert(new Float64Array(16),this.projMatrix);const Ee=new Float32Array(16);C.identity(Ee),C.scale$1(Ee,Ee,[1,-1,1]),C.rotateX(Ee,Ee,this._pitch),C.rotateZ(Ee,Ee,this.angle);const Pe=C.perspective(new Float32Array(16),this._fov,this.width/this.height,de,le),Le=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Pe[8]=2*-l.x/this.width,Pe[9]=2*(l.y+Le)/this.height,this.skyboxMatrix=C.multiply(Ee,Pe,Ee);const Me=this.width%2/2,Ue=this.height%2/2,Ye=Math.cos(this.angle),yt=Math.sin(this.angle),gt=Y-Math.round(Y)+Ye*Me+yt*Ue,Ot=ee-Math.round(ee)+Ye*Ue+yt*Me,dt=new Float64Array(Te);if(C.translate(dt,dt,[gt>.5?gt-1:gt,Ot>.5?Ot-1:Ot,0]),this.alignedProjMatrix=dt,Te=C.create$1(),C.scale$1(Te,Te,[this.width/2,-this.height/2,1]),C.translate(Te,Te,[1,-1,0]),this.labelPlaneMatrix=Te,Te=C.create$1(),C.scale$1(Te,Te,[1,-1,1]),C.translate(Te,Te,[-1,-1,0]),C.scale$1(Te,Te,[2/this.width,2/this.height,1]),this.glCoordMatrix=Te,this.pixelMatrix=C.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},Te=C.invert(new Float64Array(16),this.pixelMatrix),!Te)throw new Error("failed to invert matrix");this.pixelMatrixInverse=Te,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSize,d=this.cameraPixelsPerMeter,x=this._camera.position,M=1/this.height,D=[l,l,d];C.scale(D,D,M),C.scale(x,x,-1),C.multiply$1(x,x,D);const B=C.create$1();C.translate(B,B,x),C.scale$1(B,B,D),this.mercatorFogMatrix=B,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,d,M)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const l=this._camera.forward(),d=this.cameraToCenterDistance,x=this.point,M=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-C.mercatorZfromAltitude(this._centerAltitude,this.center.lat),D=this.cameraToCenterDistance/M;this._camera.position=[x.x/this.worldSize-l[0]*d/D,x.y/this.worldSize-l[1]*d/D,C.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-l[2]*d/D]}_translateCameraConstrained(l){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),x=l[2];let M=1;x>0&&(M=Math.min((d-this._camera.position[2])/x,1)),this._camera.position=C.scaleAndAdd([],this._camera.position,l,M),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,d=this._camera.forward(),{pitch:x,bearing:M}=this._camera.getPitchBearing(),D=C.mercatorZfromAltitude(this._centerAltitude,this.center.lat),B=this._mercatorZfromZoom(this._maxZoom)*Math.cos(C.degToRad(this._maxPitch)),G=Math.max((l[2]-D)/Math.cos(x),B),W=this._zoomFromMercatorZ(G);C.scaleAndAdd(l,l,d,G),this._pitch=C.clamp(x,C.degToRad(this.minPitch),C.degToRad(this.maxPitch)),this.angle=C.wrap(M,-Math.PI,Math.PI),this._setZoom(C.clamp(W,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new C.MercatorCoordinate(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}_terrainEnabled(){return!(!this._elevation||"mercator"!==this.projection.name&&(C.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(l,d){const x=Math.min(l.x,d.x),M=Math.max(l.x,d.x),D=Math.min(l.y,d.y),B=Math.max(l.y,d.y);if(D<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const G=[new C.pointGeometry(x,D),new C.pointGeometry(M,B),new C.pointGeometry(x,B),new C.pointGeometry(M,D)],W=this.renderWorldCopies?-3:0,Y=this.renderWorldCopies?4:1;for(const ee of G){const Q=this.pointRayIntersection(ee);if(Q.t<0)return!0;const le=this.rayIntersectionCoordinate(Q);if(le.x<W||le.y<0||le.x>Y||le.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+C.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new C.pointGeometry(0,0),new C.pointGeometry(this.width,this.height))}zoomDeltaToMovement(l,d){const x=C.length(C.sub([],this._camera.position,l)),M=this._zoomFromMercatorZ(x)+d;return x-this._mercatorZfromZoom(M)}getCameraPoint(){const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new C.pointGeometry(0,l))}}function Xh(f,l){let d=!1,x=null;const M=()=>{x=null,d&&(f(),x=setTimeout(M,l),d=!1)};return()=>(d=!0,x||M(),x)}class lc{constructor(l){this._hashName=l&&encodeURIComponent(l),C.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Xh(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,C.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return C.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(l){const d=this._map.getCenter(),x=Math.round(100*this._map.getZoom())/100,M=Math.ceil((x*Math.LN2+Math.log(512/360/.5))/Math.LN10),D=Math.pow(10,M),B=Math.round(d.lng*D)/D,G=Math.round(d.lat*D)/D,W=this._map.getBearing(),Y=this._map.getPitch();let ee="";if(ee+=l?`/${B}/${G}/${x}`:`${x}/${G}/${B}`,(W||Y)&&(ee+="/"+Math.round(10*W)/10),Y&&(ee+=`/${Math.round(Y)}`),this._hashName){const Q=this._hashName;let le=!1;const de=C.window.location.hash.slice(1).split("&").map(ge=>{const xe=ge.split("=")[0];return xe===Q?(le=!0,`${xe}=${ee}`):ge}).filter(ge=>ge);return le||de.push(`${Q}=${ee}`),`#${de.join("&")}`}return`#${ee}`}_getCurrentHash(){const l=C.window.location.hash.replace("#","");if(this._hashName){let d;return l.split("&").map(x=>x.split("=")).forEach(x=>{x[0]===this._hashName&&(d=x)}),(d&&d[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._getCurrentHash();if(l.length>=3&&!l.some(d=>isNaN(d))){const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:d,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const l=C.window.location.href.replace(/(#.+)?$/,this.getHashString());C.window.history.replaceState(C.window.history.state,null,l)}}const hs={linearity:.3,easing:C.bezier(0,0,.3,1)},xu=C.extend({deceleration:2500,maxSpeed:1400},hs),Fp=C.extend({deceleration:20,maxSpeed:1400},hs),Ra=C.extend({deceleration:1e3,maxSpeed:360},hs),Ul=C.extend({deceleration:1e3,maxSpeed:90},hs);class $n{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:C.exported.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,d=C.exported.now();for(;l.length>0&&d-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new C.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:D}of this._inertiaBuffer)d.zoom+=D.zoomDelta||0,d.bearing+=D.bearingDelta||0,d.pitch+=D.pitchDelta||0,D.panDelta&&d.pan._add(D.panDelta),D.around&&(d.around=D.around),D.pinchAround&&(d.pinchAround=D.pinchAround);const x=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,M={};if(d.pan.mag()){const D=Ds(d.pan.mag(),x,C.extend({},xu,l||{}));M.offset=d.pan.mult(D.amount/d.pan.mag()),M.center=this._map.transform.center,Hu(M,D)}if(d.zoom){const D=Ds(d.zoom,x,Fp);M.zoom=this._map.transform.zoom+D.amount,Hu(M,D)}if(d.bearing){const D=Ds(d.bearing,x,Ra);M.bearing=this._map.transform.bearing+C.clamp(D.amount,-179,179),Hu(M,D)}if(d.pitch){const D=Ds(d.pitch,x,Ul);M.pitch=this._map.transform.pitch+D.amount,Hu(M,D)}if(M.zoom||M.bearing){const D=void 0===d.pinchAround?d.around:d.pinchAround;M.around=D?this._map.unproject(D):this._map.getCenter()}return this.clear(),C.extend(M,{noMoveStart:!0})}}function Hu(f,l){(!f.duration||f.duration<l.duration)&&(f.duration=l.duration,f.easing=l.easing)}function Ds(f,l,d){const{maxSpeed:x,linearity:M,deceleration:D}=d,B=C.clamp(f*M/(l/1e3),-x,x),G=Math.abs(B)/(D*M);return{easing:d.easing,duration:1e3*G,amount:B*(G/2)}}class Ua extends C.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,x,M={}){const D=Ge.mousePos(d.getCanvasContainer(),x),B=d.unproject(D);super(l,C.extend({point:D,lngLat:B,originalEvent:x},M)),this._defaultPrevented=!1,this.target=d}}class Lo extends C.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,x){const M="touchend"===l?x.changedTouches:x.touches,D=Ge.touchPos(d.getCanvasContainer(),M),B=D.map(W=>d.unproject(W)),G=D.reduce((W,Y,ee,Q)=>W.add(Y.div(Q.length)),new C.pointGeometry(0,0));super(l,{points:D,point:G,lngLats:B,lngLat:d.unproject(G),originalEvent:x}),this._defaultPrevented=!1}}class bu extends C.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,x){super(l,{originalEvent:x}),this._defaultPrevented=!1}}class qs{constructor(l,d){this._map=l,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new bu(l.type,this._map,l))}mousedown(l,d){return this._mousedownPos=d,this._firePreventable(new Ua(l.type,this._map,l))}mouseup(l){this._map.fire(new Ua(l.type,this._map,l))}preclick(l){const d=C.extend({},l);d.type="preclick",this._map.fire(new Ua(d.type,this._map,d))}click(l,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(l),this._map.fire(new Ua(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new Ua(l.type,this._map,l))}mouseover(l){this._map.fire(new Ua(l.type,this._map,l))}mouseout(l){this._map.fire(new Ua(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Lo(l.type,this._map,l))}touchmove(l){this._map.fire(new Lo(l.type,this._map,l))}touchend(l){this._map.fire(new Lo(l.type,this._map,l))}touchcancel(l){this._map.fire(new Lo(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class er{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(l){this._map.fire(new Ua(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ua("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new Ua(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class rh{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,d){this.isEnabled()&&l.shiftKey&&0===l.button&&(Ge.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(l,d){if(!this._active)return;const x=d;if(this._lastPos.equals(x)||!this._box&&x.dist(this._startPos)<this._clickTolerance)return;const M=this._startPos;this._lastPos=x,this._box||(this._box=Ge.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const D=Math.min(M.x,x.x),B=Math.max(M.x,x.x),G=Math.min(M.y,x.y),W=Math.max(M.y,x.y);this._map._requestDomTask(()=>{this._box&&(Ge.setTransform(this._box,`translate(${D}px,${G}px)`),this._box.style.width=B-D+"px",this._box.style.height=W-G+"px")})}mouseupWindow(l,d){if(!this._active||0!==l.button)return;const x=this._startPos,M=d;if(this.reset(),Ge.suppressClick(),x.x!==M.x||x.y!==M.y)return this._map.fire(new C.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:D=>D.fitScreenCoordinates(x,M,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&27===l.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(Ge.remove(this._box),this._box=null),Ge.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,d){return this._map.fire(new C.Event(l,{originalEvent:d}))}}function Mh(f,l){const d={};for(let x=0;x<f.length;x++)d[f[x].identifier]=l[x];return d}class wu{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,d,x){(this.centroid||x.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=l.timeStamp),x.length===this.numTouches&&(this.centroid=function(M){const D=new C.pointGeometry(0,0);for(const B of M)D._add(B);return D.div(M.length)}(d),this.touches=Mh(x,d)))}touchmove(l,d,x){if(this.aborted||!this.centroid)return;const M=Mh(x,d);for(const D in this.touches){const B=this.touches[D],G=M[D];(!G||G.dist(B)>30)&&(this.aborted=!0)}}touchend(l,d,x){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),0===x.length){const M=!this.aborted&&this.centroid;if(this.reset(),M)return M}}}class Oa{constructor(l){this.singleTap=new wu(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,d,x){this.singleTap.touchstart(l,d,x)}touchmove(l,d,x){this.singleTap.touchmove(l,d,x)}touchend(l,d,x){const M=this.singleTap.touchend(l,d,x);if(M){const D=l.timeStamp-this.lastTime<500,B=!this.lastTap||this.lastTap.dist(M)<30;if(D&&B||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=M,this.count===this.numTaps)return this.reset(),M}}}class ks{constructor(){this._zoomIn=new Oa({numTouches:1,numTaps:2}),this._zoomOut=new Oa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,d,x){this._zoomIn.touchstart(l,d,x),this._zoomOut.touchstart(l,d,x)}touchmove(l,d,x){this._zoomIn.touchmove(l,d,x),this._zoomOut.touchmove(l,d,x)}touchend(l,d,x){const M=this._zoomIn.touchend(l,d,x),D=this._zoomOut.touchend(l,d,x);return M?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:B=>B.easeTo({duration:300,zoom:B.getZoom()+1,around:B.unproject(M)},{originalEvent:l})}):D?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:B=>B.easeTo({duration:300,zoom:B.getZoom()-1,around:B.unproject(D)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Cu={0:1,2:2};class Tl{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(l,d){return!1}_move(l,d){return{}}mousedown(l,d){if(this._lastPoint)return;const x=Ge.mouseButton(l);this._correctButton(l,x)&&(this._lastPoint=d,this._eventButton=x)}mousemoveWindow(l,d){const x=this._lastPoint;if(x)if(l.preventDefault(),function(M,D){const B=Cu[D];return void 0===M.buttons||(M.buttons&B)!==B}(l,this._eventButton))this.reset();else if(this._moved||!(d.dist(x)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(x,d)}mouseupWindow(l){this._lastPoint&&Ge.mouseButton(l)===this._eventButton&&(this._moved&&Ge.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ll extends Tl{mousedown(l,d){super.mousedown(l,d),this._lastPoint&&(this._active=!0)}_correctButton(l,d){return 0===d&&!l.ctrlKey}_move(l,d){return{around:d,panDelta:d.sub(l)}}}class Js extends Tl{_correctButton(l,d){return 0===d&&l.ctrlKey||2===d}_move(l,d){const x=.8*(d.x-l.x);if(x)return this._active=!0,{bearingDelta:x}}contextmenu(l){l.preventDefault()}}class uc extends Tl{_correctButton(l,d){return 0===d&&l.ctrlKey||2===d}_move(l,d){const x=-.5*(d.y-l.y);if(x)return this._active=!0,{pitchDelta:x}}contextmenu(l){l.preventDefault()}}class Yh{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),C.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new C.pointGeometry(0,0)}touchstart(l,d,x){return this._calculateTransform(l,d,x)}touchmove(l,d,x){if(this._active&&!(x.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===x.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.preventDefault(),this._calculateTransform(l,d,x)}}touchend(l,d,x){this._calculateTransform(l,d,x),this._active&&x.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,d,x){x.length>0&&(this._active=!0);const M=Mh(x,d),D=new C.pointGeometry(0,0),B=new C.pointGeometry(0,0);let G=0;for(const Y in M){const ee=M[Y],Q=this._touches[Y];Q&&(D._add(ee),B._add(ee.sub(Q)),G++,M[Y]=ee)}if(this._touches=M,G<this._minTouches||!B.mag())return;const W=B.div(G);return this._sum._add(W),this._sum.mag()<this._clickTolerance?void 0:{around:D.div(G),panDelta:W}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ge.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class id{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(l){}_move(l,d,x){return{}}touchstart(l,d,x){this._firstTwoTouches||x.length<2||(this._firstTwoTouches=[x[0].identifier,x[1].identifier],this._start([d[0],d[1]]))}touchmove(l,d,x){if(!this._firstTwoTouches)return;l.preventDefault();const[M,D]=this._firstTwoTouches,B=to(x,d,M),G=to(x,d,D);if(!B||!G)return;const W=this._aroundCenter?null:B.add(G).div(2);return this._move([B,G],W,l)}touchend(l,d,x){if(!this._firstTwoTouches)return;const[M,D]=this._firstTwoTouches,B=to(x,d,M),G=to(x,d,D);B&&G||(this._active&&Ge.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&"center"===l.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function to(f,l,d){for(let x=0;x<f.length;x++)if(f[x].identifier===d)return l[x]}function ih(f,l){return Math.log(f/l)/Math.LN2}class Yo extends id{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,d){const x=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(ih(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ih(this._distance,x),pinchAround:d}}}function Vr(f,l){return 180*f.angleWith(l)/Math.PI}class ki extends id{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,d){const x=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Vr(this._vector,x),pinchAround:d}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const d=25/(Math.PI*this._minDiameter)*360,x=Vr(l,this._startVector);return Math.abs(x)<d}}function La(f){return Math.abs(f.y)>Math.abs(f.x)}class ps extends id{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(l){this._lastPoints=l,La(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,d,x){const M=l[0].sub(this._lastPoints[0]),D=l[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&x.touches.length<3)&&(this._valid=this.gestureBeginsVertically(M,D,x.timeStamp),this._valid))return this._lastPoints=l,this._active=!0,{pitchDelta:(M.y+D.y)/2*-.5}}gestureBeginsVertically(l,d,x){if(void 0!==this._valid)return this._valid;const M=l.mag()>=2,D=d.mag()>=2;if(!M&&!D)return;if(!M||!D)return void 0===this._firstMove&&(this._firstMove=x),x-this._firstMove<100&&void 0;const B=l.y>0==d.y>0;return La(l)&&La(d)&&B}}const Ja={panStep:100,bearingStep:15,pitchStep:10};class Zn{constructor(){const l=Ja;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let d=0,x=0,M=0,D=0,B=0;switch(l.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:l.shiftKey?x=-1:(l.preventDefault(),D=-1);break;case 39:l.shiftKey?x=1:(l.preventDefault(),D=1);break;case 38:l.shiftKey?M=1:(l.preventDefault(),B=-1);break;case 40:l.shiftKey?M=-1:(l.preventDefault(),B=1);break;default:return}return this._rotationDisabled&&(x=0,M=0),{cameraAnimation:G=>{const W=G.getZoom();G.easeTo({duration:300,easeId:"keyboardHandler",easing:Wu,zoom:d?Math.round(W)+d*(l.shiftKey?2:1):W,bearing:G.getBearing()+x*this._bearingStep,pitch:G.getPitch()+M*this._pitchStep,offset:[-D*this._panStep,-B*this._panStep],center:G.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Wu(f){return f*(2-f)}const ds=4.000244140625;class ta{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,C.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&"center"===l.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=l.deltaMode===C.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const x=C.exported.now(),M=x-(this._lastWheelEventTime||0);this._lastWheelEventTime=x,0!==d&&d%ds==0?this._type="wheel":0!==d&&Math.abs(d)<4?this._type="trackpad":M>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(M*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),l.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=l,this._delta-=d,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=Ge.mousePos(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform,d=()=>l._terrainEnabled()?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(0!==this._delta){const W="wheel"===this._type&&Math.abs(this._delta)>ds?this._wheelZoomRate:this._defaultZoomRate;let Y=2/(1+Math.exp(-Math.abs(this._delta*W)));this._delta<0&&0!==Y&&(Y=1/Y);const ee=d(),Q=Math.pow(2,ee),le="number"==typeof this._targetZoom?l.zoomScale(this._targetZoom):Q;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(le*Y))),"wheel"===this._type&&(this._startZoom=d(),this._easing=this._smoothOutEasing(200)),this._delta=0}const x="number"==typeof this._targetZoom?this._targetZoom:d(),M=this._startZoom,D=this._easing;let B,G=!1;if("wheel"===this._type&&M&&D){const W=Math.min((C.exported.now()-this._lastWheelEventTime)/200,1),Y=D(W);B=C.number(M,x,Y),W<1?this._frameId||(this._frameId=!0):G=!0}else B=x,G=!0;return this._active=!0,G&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!G,zoomDelta:B-d(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let d=C.ease;if(this._prevEase){const x=this._prevEase,M=(C.exported.now()-x.start)/x.duration,D=x.easing(M+.01)-x.easing(M),B=.27/Math.sqrt(D*D+1e-4)*.01,G=Math.sqrt(.0729-B*B);d=C.bezier(B,G,.25,1)}return this._prevEase={start:C.exported.now(),duration:l,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ge.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(C.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!C.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Un{constructor(l,d){this._clickZoom=l,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Nr{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,d){return l.preventDefault(),{cameraAnimation:x=>{x.easeTo({duration:300,zoom:x.getZoom()+(l.shiftKey?-1:1),around:x.unproject(d)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vl{constructor(){this._tap=new Oa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(l,d,x){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?x.length>0&&(this._swipePoint=d[0],this._swipeTouch=x[0].identifier):this._tap.touchstart(l,d,x))}touchmove(l,d,x){if(this._tapTime){if(this._swipePoint){if(x[0].identifier!==this._swipeTouch)return;const M=d[0],D=M.y-this._swipePoint.y;return this._swipePoint=M,l.preventDefault(),this._active=!0,{zoomDelta:D/128}}}else this._tap.touchmove(l,d,x)}touchend(l,d,x){this._tapTime?this._swipePoint&&0===x.length&&this.reset():this._tap.touchend(l,d,x)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ps{constructor(l,d,x){this._el=l,this._mousePan=d,this._touchPan=x}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class $u{constructor(l,d,x){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=d,this._mousePitch=x}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Rs{constructor(l,d,x,M){this._el=l,this._touchZoom=d,this._touchRotate=x,this._tapDragZoom=M,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Lr=f=>f.zoom||f.drag||f.pitch||f.rotate;class Vf extends C.Event{}class Eu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,d){const x=C.sub([],d,l);this.radius=C.length(x[2]<0?C.div([],x,this.constants):[x[0],x[1],0])}projectRay(l){C.div(l,l,this.constants),C.normalize(l,l),C.mul$2(l,l,this.constants);const d=C.scale([],l,this.radius);if(d[2]>0){const x=C.scale([],[0,0,1],C.dot(d,[0,0,1])),M=C.scale([],C.normalize([],[d[0],d[1],0]),this.radius),D=C.add([],d,C.scale([],C.sub([],C.add([],M,x),d),2));d[0]=D[0],d[1]=D[1]}return d}}function co(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Ea{constructor(l,d){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new $n(l),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Eu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),C.bindAll(["handleEvent","handleWindowEvent"],this);const x=this._el;this._listeners=[[x,"touchstart",{passive:!0}],[x,"touchmove",{passive:!1}],[x,"touchend",void 0],[x,"touchcancel",void 0],[x,"mousedown",void 0],[x,"mousemove",void 0],[x,"mouseup",void 0],[C.window.document,"mousemove",{capture:!0}],[C.window.document,"mouseup",void 0],[x,"mouseover",void 0],[x,"mouseout",void 0],[x,"dblclick",void 0],[x,"click",void 0],[x,"keydown",{capture:!1}],[x,"keyup",void 0],[x,"wheel",{passive:!1}],[x,"contextmenu",void 0],[C.window,"blur",void 0]];for(const[M,D,B]of this._listeners)Ge.addEventListener(M,D,M===C.window.document?this.handleWindowEvent:this.handleEvent,B)}destroy(){for(const[l,d,x]of this._listeners)Ge.removeEventListener(l,d,l===C.window.document?this.handleWindowEvent:this.handleEvent,x)}_addDefaultHandlers(l){const d=this._map,x=d.getCanvasContainer();this._add("mapEvent",new qs(d,l));const M=d.boxZoom=new rh(d,l);this._add("boxZoom",M);const D=new ks,B=new Nr;d.doubleClickZoom=new Un(B,D),this._add("tapZoom",D),this._add("clickZoom",B);const G=new Vl;this._add("tapDragZoom",G);const W=d.touchPitch=new ps(d);this._add("touchPitch",W);const Y=new Js(l),ee=new uc(l);d.dragRotate=new $u(l,Y,ee),this._add("mouseRotate",Y,["mousePitch"]),this._add("mousePitch",ee,["mouseRotate"]);const Q=new ll(l),le=new Yh(d,l);d.dragPan=new Ps(x,Q,le),this._add("mousePan",Q),this._add("touchPan",le,["touchZoom","touchRotate"]);const de=new ki,ge=new Yo;d.touchZoomRotate=new Rs(x,ge,de,G),this._add("touchRotate",de,["touchPan","touchZoom"]),this._add("touchZoom",ge,["touchPan","touchRotate"]),this._add("blockableMapEvent",new er(d));const xe=d.scrollZoom=new ta(d,this);this._add("scrollZoom",xe,["mousePan"]);const Te=d.keyboard=new Zn;this._add("keyboard",Te);for(const Ee of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[Ee]&&d[Ee].enable(l[Ee])}_add(l,d,x){this._handlers.push({handlerName:l,handler:d,allowed:x}),this._handlersById[l]=d}stop(l){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Lr(this._eventsInProgress))||this.isZooming()}_blockedByActive(l,d,x){for(const M in l)if(M!==x&&(!d||d.indexOf(M)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const d=[];for(const x of l)this._el.contains(x.target)&&d.push(x);return d}handleEvent(l,d){this._updatingCamera=!0;const x="renderFrame"===l.type,M=x?void 0:l,D={needsRenderFrame:!1},B={},G={},W=l.touches?this._getMapTouches(l.touches):void 0,Y=W?Ge.touchPos(this._el,W):x?void 0:Ge.mousePos(this._el,l);for(const{handlerName:le,handler:de,allowed:ge}of this._handlers){if(!de.isEnabled())continue;let xe;this._blockedByActive(G,ge,le)?de.reset():de[d||l.type]&&(xe=de[d||l.type](l,Y,W),this.mergeHandlerResult(D,B,xe,le,M),xe&&xe.needsRenderFrame&&this._triggerRenderFrame()),(xe||de.isActive())&&(G[le]=de)}const ee={};for(const le in this._previousActiveHandlers)G[le]||(ee[le]=M);this._previousActiveHandlers=G,(Object.keys(ee).length||co(D))&&(this._changes.push([D,B,ee]),this._triggerRenderFrame()),(Object.keys(G).length||co(D))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Q}=D;Q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Q(this._map))}mergeHandlerResult(l,d,x,M,D){if(!x)return;C.extend(l,x);const B={handlerName:M,originalEvent:x.originalEvent||D};void 0!==x.zoomDelta&&(d.zoom=B),void 0!==x.panDelta&&(d.drag=B),void 0!==x.pitchDelta&&(d.pitch=B),void 0!==x.bearingDelta&&(d.rotate=B)}_applyChanges(){const l={},d={},x={};for(const[M,D,B]of this._changes)M.panDelta&&(l.panDelta=(l.panDelta||new C.pointGeometry(0,0))._add(M.panDelta)),M.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+M.zoomDelta),M.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+M.bearingDelta),M.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+M.pitchDelta),void 0!==M.around&&(l.around=M.around),void 0!==M.aroundCoord&&(l.aroundCoord=M.aroundCoord),void 0!==M.pinchAround&&(l.pinchAround=M.pinchAround),M.noInertia&&(l.noInertia=M.noInertia),C.extend(d,D),C.extend(x,B);this._updateMapTransform(l,d,x),this._changes=[]}_updateMapTransform(l,d,x){const M=this._map,D=M.transform,B=Pe=>[Pe.x,Pe.y,Pe.z];if((Pe=>{const Le=this._eventsInProgress.drag;return Le&&!this._handlersById[Le.handlerName].isActive()})()&&!co(l)){const Pe=D.zoom;D.cameraElevationReference="sea",D.recenterOnTerrain(),D.cameraElevationReference="ground",Pe!==D.zoom&&this._map._update(!0)}if(!co(l))return this._fireEvents(d,x,!0);let{panDelta:G,zoomDelta:W,bearingDelta:Y,pitchDelta:ee,around:Q,aroundCoord:le,pinchAround:de}=l;void 0!==de&&(Q=de),(Pe=>d.drag&&!this._eventsInProgress.drag)()&&Q&&(this._dragOrigin=B(D.pointCoordinate3D(Q)),this._trackingEllipsoid.setup(D._camera.position,this._dragOrigin)),D.cameraElevationReference="sea",M._stop(!0),Q=Q||M.transform.centerPoint,Y&&(D.bearing+=Y),ee&&(D.pitch+=ee),D._updateCameraState();const ge=[0,0,0];if(G){const Pe=D.screenPointToMercatorRay(Q),Le=D.screenPointToMercatorRay(Q.sub(G)),Me=this._trackingEllipsoid.projectRay(Pe.dir),Ue=this._trackingEllipsoid.projectRay(Le.dir);ge[0]=Ue[0]-Me[0],ge[1]=Ue[1]-Me[1]}const xe=D.zoom,Te=[0,0,0];if(W){const Pe=B(le||D.pointCoordinate3D(Q)),Le={dir:C.normalize([],C.sub([],Pe,D._camera.position))},Me=D.screenPointToMercatorRay(D.centerPoint);if(Le.dir[2]<0){const Ue=C.altitudeFromMercatorZ(Pe[2],Pe[1]),Ye=D.rayIntersectionCoordinate(D.pointRayIntersection(D.centerPoint,Ue)),yt=D.zoomDeltaToMovement(B(Ye),W)*(Me.dir[2]/Le.dir[2]);C.scale(Te,Le.dir,yt)}else if(D._terrainEnabled()){const Ue=D.zoomDeltaToMovement(Pe,W);C.scale(Te,Le.dir,Ue)}}const Ee=C.add(ge,ge,Te);D._translateCameraConstrained(Ee),W&&Math.abs(D.zoom-xe)>1e-4&&D.recenterOnTerrain(),D.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(d,x,!0)}_fireEvents(l,d,x){const M=Lr(this._eventsInProgress),D=Lr(l),B={};for(const ee in l){const{originalEvent:Q}=l[ee];this._eventsInProgress[ee]||(B[`${ee}start`]=Q),this._eventsInProgress[ee]=l[ee]}!M&&D&&this._fireEvent("movestart",D.originalEvent);for(const ee in B)this._fireEvent(ee,B[ee]);D&&this._fireEvent("move",D.originalEvent);for(const ee in l){const{originalEvent:Q}=l[ee];this._fireEvent(ee,Q)}const G={};let W;for(const ee in this._eventsInProgress){const{handlerName:Q,originalEvent:le}=this._eventsInProgress[ee];this._handlersById[Q].isActive()||(delete this._eventsInProgress[ee],W=d[Q]||le,G[`${ee}end`]=W)}for(const ee in G)this._fireEvent(ee,G[ee]);const Y=Lr(this._eventsInProgress);if(x&&(M||D)&&!Y){this._updatingCamera=!0;const ee=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Q=le=>0!==le&&-this._bearingSnap<le&&le<this._bearingSnap;ee?(Q(ee.bearing||this._map.getBearing())&&(ee.bearing=0),this._map.easeTo(ee,{originalEvent:W})):(this._map.fire(new C.Event("moveend",{originalEvent:W})),Q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,d){this._map.fire(new C.Event(l,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new Vf("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const pp="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class oh extends C.Evented{constructor(l,d){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=d.bearingSnap,C.bindAll(["_renderFrameCallback"],this)}getCenter(){return new C.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(l,d){return this.jumpTo({center:l},d)}panBy(l,d,x){return l=C.pointGeometry.convert(l).mult(-1),this.panTo(this.transform.center,C.extend({offset:l},d),x)}panTo(l,d,x){return this.easeTo(C.extend({center:l},d),x)}getZoom(){return this.transform.zoom}setZoom(l,d){return this.jumpTo({zoom:l},d),this}zoomTo(l,d,x){return this.easeTo(C.extend({zoom:l},d),x)}zoomIn(l,d){return this.zoomTo(this.getZoom()+1,l,d),this}zoomOut(l,d){return this.zoomTo(this.getZoom()-1,l,d),this}getBearing(){return this.transform.bearing}setBearing(l,d){return this.jumpTo({bearing:l},d),this}getPadding(){return this.transform.padding}setPadding(l,d){return this.jumpTo({padding:l},d),this}rotateTo(l,d,x){return this.easeTo(C.extend({bearing:l},d),x)}resetNorth(l,d){return this.rotateTo(0,C.extend({duration:1e3},l),d),this}resetNorthPitch(l,d){return this.easeTo(C.extend({bearing:0,pitch:0,duration:1e3},l),d),this}snapToNorth(l,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,d):this}getPitch(){return this.transform.pitch}setPitch(l,d){return this.jumpTo({pitch:l},d),this}cameraForBounds(l,d){l=C.LngLatBounds.convert(l);const x=d&&d.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),x,d)}_extendCameraOptions(l){const d={top:0,bottom:0,right:0,left:0};if("number"==typeof(l=C.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding){const x=l.padding;l.padding={top:x,bottom:x,right:x,left:x}}return l.padding=C.extend(d,l.padding),l}_cameraForBoxAndBearing(l,d,x,M){const D=this._extendCameraOptions(M),B=this.transform,G=B.padding,W=B.project(C.LngLat.convert(l)),Y=B.project(C.LngLat.convert(d)),ee=W.rotate(-C.degToRad(x)),Q=Y.rotate(-C.degToRad(x)),le=new C.pointGeometry(Math.max(ee.x,Q.x),Math.max(ee.y,Q.y)),de=new C.pointGeometry(Math.min(ee.x,Q.x),Math.min(ee.y,Q.y)),ge=le.sub(de),xe=(B.width-(G.left+G.right+D.padding.left+D.padding.right))/ge.x,Te=(B.height-(G.top+G.bottom+D.padding.top+D.padding.bottom))/ge.y;if(Te<0||xe<0)return void C.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ee=Math.min(B.scaleZoom(B.scale*Math.min(xe,Te)),D.maxZoom),Pe="number"==typeof D.offset.x?new C.pointGeometry(D.offset.x,D.offset.y):C.pointGeometry.convert(D.offset),Le=new C.pointGeometry((D.padding.left-D.padding.right)/2,(D.padding.top-D.padding.bottom)/2).rotate(x*Math.PI/180),Me=Pe.add(Le).mult(B.scale/B.zoomScale(Ee));return{center:B.unproject(W.add(Y).div(2).sub(Me)),zoom:Ee,bearing:x}}_cameraForBox(l,d,x,M,D){const B=this._extendCameraOptions(D);x=x||0,M=M||0,l=C.LngLat.convert(l),d=C.LngLat.convert(d);const G=this.transform.clone();G.padding=B.padding;const W=this.getFreeCameraOptions(),Y=new C.LngLat(.5*(l.lng+d.lng),.5*(l.lat+d.lat)),ee=.5*(x+M);if(G._camera.position[2]<C.mercatorZfromAltitude(ee,Y.lat))return void C.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");W.lookAtPoint(Y),G.setFreeCameraOptions(W);const Q=C.MercatorCoordinate.fromLngLat(l),le=C.MercatorCoordinate.fromLngLat(d),de=G.pointRayIntersection(G.centerPoint,ee),ge=[(xe=G.rayIntersectionCoordinate(de)).x,xe.y,xe.z];var xe;const Te=G.screenPointToMercatorRay(G.centerPoint);let Ee,Pe=0;do{const Le=Math.floor(G.zoom),Me=1<<Le,Ue=Math.min(Me*Q.x,Me*le.x),Ye=Math.min(Me*Q.y,Me*le.y),yt=Math.max(Me*Q.x,Me*le.x),gt=Math.max(Me*Q.y,Me*le.y),Ot=new Pn([Ue,Ye,x],[yt,gt,M]),dt=bn.fromInvProjectionMatrix(G.invProjMatrix,G.worldSize,Le);if(2!==Ot.intersects(dt)){Ee&&(G._camera.position=C.scaleAndAdd([],G._camera.position,Te.dir,-Ee),G._updateStateFromCamera());break}const Nt=C.sub([],G._camera.position,ge);Ee=.5*C.length(Nt),G._camera.position=C.scaleAndAdd([],G._camera.position,Te.dir,Ee);try{G._updateStateFromCamera()}catch(wt){return void C.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++Pe<10);return{center:G.center,zoom:G.zoom,bearing:G.bearing,pitch:G.pitch}}fitBounds(l,d,x){return this._fitInternal(this.cameraForBounds(l,d),d,x)}_raycastElevationBox(l,d){const x=this.transform.elevation;if(!x)return;const M=new C.pointGeometry(l.x,d.y),D=new C.pointGeometry(d.x,l.y),B=x.pointCoordinate(l);if(!B)return;const G=x.pointCoordinate(d);if(!G)return;const W=x.pointCoordinate(M);if(!W)return;const Y=x.pointCoordinate(D);if(!Y)return;const ee=new C.MercatorCoordinate(B[0],B[1]).toLngLat(),Q=new C.MercatorCoordinate(G[0],G[1]).toLngLat(),le=new C.MercatorCoordinate(W[0],W[1]).toLngLat(),de=new C.MercatorCoordinate(Y[0],Y[1]).toLngLat(),ge=Math.min(ee.lng,Math.min(Q.lng,Math.min(le.lng,de.lng))),xe=Math.min(ee.lat,Math.min(Q.lat,Math.min(le.lat,de.lat))),Te=Math.max(ee.lng,Math.max(Q.lng,Math.max(le.lng,de.lng))),Ee=Math.max(ee.lat,Math.max(Q.lat,Math.max(le.lat,de.lat))),Pe=Math.min(B[3],Math.min(G[3],Math.min(W[3],Y[3]))),Le=Math.max(B[3],Math.max(G[3],Math.max(W[3],Y[3])));return{minLngLat:new C.LngLat(ge,xe),maxLngLat:new C.LngLat(Te,Ee),minAltitude:Pe,maxAltitude:Le}}fitScreenCoordinates(l,d,x,M,D){let B,G,W,Y;const ee=C.pointGeometry.convert(l),Q=C.pointGeometry.convert(d),le=this._raycastElevationBox(ee,Q);if(le)B=le.minLngLat,G=le.maxLngLat,W=le.minAltitude,Y=le.maxAltitude;else{if(this.transform.anyCornerOffEdge(ee,Q))return this;B=this.transform.pointLocation(ee),G=this.transform.pointLocation(Q)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(C.pointGeometry.convert(l)),this.transform.pointLocation(C.pointGeometry.convert(d)),x,M):this._cameraForBox(B,G,W,Y,M),M,D)}_fitInternal(l,d,x){return l?(delete(d=C.extend(l,d)).padding,d.linear?this.easeTo(d,x):this.flyTo(d,x)):this}jumpTo(l,d){this.stop();const x=this.transform;let M=!1,D=!1,B=!1;return"zoom"in l&&x.zoom!==+l.zoom&&(M=!0,x.zoom=+l.zoom),void 0!==l.center&&(x.center=C.LngLat.convert(l.center)),"bearing"in l&&x.bearing!==+l.bearing&&(D=!0,x.bearing=+l.bearing),"pitch"in l&&x.pitch!==+l.pitch&&(B=!0,x.pitch=+l.pitch),null==l.padding||x.isPaddingEqual(l.padding)||(x.padding=l.padding),this.fire(new C.Event("movestart",d)).fire(new C.Event("move",d)),M&&this.fire(new C.Event("zoomstart",d)).fire(new C.Event("zoom",d)).fire(new C.Event("zoomend",d)),D&&this.fire(new C.Event("rotatestart",d)).fire(new C.Event("rotate",d)).fire(new C.Event("rotateend",d)),B&&this.fire(new C.Event("pitchstart",d)).fire(new C.Event("pitch",d)).fire(new C.Event("pitchend",d)),this.fire(new C.Event("moveend",d))}getFreeCameraOptions(){return"mercator"!==this.transform.projection.name&&C.warnOnce(pp),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,d){const x=this.transform;if("mercator"!==x.projection.name)return void C.warnOnce(pp);this.stop();const M=x.zoom,D=x.pitch,B=x.bearing;x.setFreeCameraOptions(l);const G=M!==x.zoom,W=D!==x.pitch,Y=B!==x.bearing;return this.fire(new C.Event("movestart",d)).fire(new C.Event("move",d)),G&&this.fire(new C.Event("zoomstart",d)).fire(new C.Event("zoom",d)).fire(new C.Event("zoomend",d)),Y&&this.fire(new C.Event("rotatestart",d)).fire(new C.Event("rotate",d)).fire(new C.Event("rotateend",d)),W&&this.fire(new C.Event("pitchstart",d)).fire(new C.Event("pitch",d)).fire(new C.Event("pitchend",d)),this.fire(new C.Event("moveend",d)),this}easeTo(l,d){this._stop(!1,l.easeId),(!1===(l=C.extend({offset:[0,0],duration:500,easing:C.ease},l)).animate||!l.essential&&C.exported.prefersReducedMotion)&&(l.duration=0);const x=this.transform,M=this.getZoom(),D=this.getBearing(),B=this.getPitch(),G=this.getPadding(),W="zoom"in l?+l.zoom:M,Y="bearing"in l?this._normalizeBearing(l.bearing,D):D,ee="pitch"in l?+l.pitch:B,Q="padding"in l?l.padding:x.padding,le=C.pointGeometry.convert(l.offset);let de=x.centerPoint.add(le);const ge=x.pointLocation(de),xe=C.LngLat.convert(l.center||ge);this._normalizeCenter(xe);const Te=x.project(ge),Ee=x.project(xe).sub(Te),Pe=x.zoomScale(W-M);let Le,Me;l.around&&(Le=C.LngLat.convert(l.around),Me=x.locationPoint(Le));const Ue={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||W!==M,this._rotating=this._rotating||D!==Y,this._pitching=this._pitching||ee!==B,this._padding=!x.isPaddingEqual(Q),this._easeId=l.easeId,this._prepareEase(d,l.noMoveStart,Ue),this._ease(Ye=>{if(this._zooming&&(x.zoom=C.number(M,W,Ye)),this._rotating&&(x.bearing=C.number(D,Y,Ye)),this._pitching&&(x.pitch=C.number(B,ee,Ye)),this._padding&&(x.interpolatePadding(G,Q,Ye),de=x.centerPoint.add(le)),Le)x.setLocationAtPoint(Le,Me);else{const yt=x.zoomScale(x.zoom-M),gt=W>M?Math.min(2,Pe):Math.max(.5,Pe),Ot=Math.pow(gt,1-Ye),dt=x.unproject(Te.add(Ee.mult(Ye*Ot)).mult(yt));x.setLocationAtPoint(x.renderWorldCopies?dt.wrap():dt,de)}this._fireMoveEvents(d)},Ye=>{x.recenterOnTerrain(),this._afterEase(d,Ye)},l),this}_prepareEase(l,d,x={}){this._moving=!0,this.transform.cameraElevationReference="sea",d||x.moving||this.fire(new C.Event("movestart",l)),this._zooming&&!x.zooming&&this.fire(new C.Event("zoomstart",l)),this._rotating&&!x.rotating&&this.fire(new C.Event("rotatestart",l)),this._pitching&&!x.pitching&&this.fire(new C.Event("pitchstart",l))}_fireMoveEvents(l){this.fire(new C.Event("move",l)),this._zooming&&this.fire(new C.Event("zoom",l)),this._rotating&&this.fire(new C.Event("rotate",l)),this._pitching&&this.fire(new C.Event("pitch",l))}_afterEase(l,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId,this.transform.cameraElevationReference="ground";const x=this._zooming,M=this._rotating,D=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,x&&this.fire(new C.Event("zoomend",l)),M&&this.fire(new C.Event("rotateend",l)),D&&this.fire(new C.Event("pitchend",l)),this.fire(new C.Event("moveend",l))}flyTo(l,d){if(!l.essential&&C.exported.prefersReducedMotion){const Gt=C.pick(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Gt,d)}this.stop(),l=C.extend({offset:[0,0],speed:1.2,curve:1.42,easing:C.ease},l);const x=this.transform,M=this.getZoom(),D=this.getBearing(),B=this.getPitch(),G=this.getPadding(),W="zoom"in l?C.clamp(+l.zoom,x.minZoom,x.maxZoom):M,Y="bearing"in l?this._normalizeBearing(l.bearing,D):D,ee="pitch"in l?+l.pitch:B,Q="padding"in l?l.padding:x.padding,le=x.zoomScale(W-M),de=C.pointGeometry.convert(l.offset);let ge=x.centerPoint.add(de);const xe=x.pointLocation(ge),Te=C.LngLat.convert(l.center||xe);this._normalizeCenter(Te);const Ee=x.project(xe),Pe=x.project(Te).sub(Ee);let Le=l.curve;const Me=Math.max(x.width,x.height),Ue=Me/le,Ye=Pe.mag();if("minZoom"in l){const Gt=C.clamp(Math.min(l.minZoom,M,W),x.minZoom,x.maxZoom),Qt=Me/x.zoomScale(Gt-M);Le=Math.sqrt(Qt/Ye*2)}const yt=Le*Le;function gt(Gt){const Qt=(Ue*Ue-Me*Me+(Gt?-1:1)*yt*yt*Ye*Ye)/(2*(Gt?Ue:Me)*yt*Ye);return Math.log(Math.sqrt(Qt*Qt+1)-Qt)}function Ot(Gt){return(Math.exp(Gt)-Math.exp(-Gt))/2}function dt(Gt){return(Math.exp(Gt)+Math.exp(-Gt))/2}const Nt=gt(0);let wt=function(Gt){return dt(Nt)/dt(Nt+Le*Gt)},Zt=function(Gt){return Me*((dt(Nt)*(Ot(Qt=Nt+Le*Gt)/dt(Qt))-Ot(Nt))/yt)/Ye;var Qt},ft=(gt(1)-Nt)/Le;if(Math.abs(Ye)<1e-6||!isFinite(ft)){if(Math.abs(Me-Ue)<1e-6)return this.easeTo(l,d);const Gt=Ue<Me?-1:1;ft=Math.abs(Math.log(Ue/Me))/Le,Zt=function(){return 0},wt=function(Qt){return Math.exp(Gt*Le*Qt)}}return l.duration="duration"in l?+l.duration:1e3*ft/("screenSpeed"in l?+l.screenSpeed/Le:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=D!==Y,this._pitching=ee!==B,this._padding=!x.isPaddingEqual(Q),this._prepareEase(d,!1),this._ease(Gt=>{const Qt=Gt*ft,mn=1/wt(Qt);x.zoom=1===Gt?W:M+x.scaleZoom(mn),this._rotating&&(x.bearing=C.number(D,Y,Gt)),this._pitching&&(x.pitch=C.number(B,ee,Gt)),this._padding&&(x.interpolatePadding(G,Q,Gt),ge=x.centerPoint.add(de));const Hn=1===Gt?Te:x.unproject(Ee.add(Pe.mult(Zt(Qt))).mult(mn));x.setLocationAtPoint(x.renderWorldCopies?Hn.wrap():Hn,ge),x._updateCenterElevation(),this._fireMoveEvents(d)},()=>this._afterEase(d),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const x=this._onEaseEnd;delete this._onEaseEnd,x.call(this,d)}if(!l){const x=this.handlers;x&&x.stop(!1)}return this}_ease(l,d,x){!1===x.animate||0===x.duration?(l(1),d()):(this._easeStart=C.exported.now(),this._easeOptions=x,this._onEaseFrame=l,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((C.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,d){l=C.wrap(l,-180,180);const x=Math.abs(l-d);return Math.abs(l-360-d)<x&&(l-=360),Math.abs(l+360-d)<x&&(l+=360),l}_normalizeCenter(l){const d=this.transform;if(!d.renderWorldCopies||d.maxBounds)return;const x=l.lng-d.center.lng;l.lng+=x>180?-360:x<-180?360:0}}class cc{constructor(l={}){this.options=l,C.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const d=this.options&&this.options.compact;return this._map=l,this._container=Ge.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ge.create("button","mapboxgl-ctrl-attrib-button",this._container),Ge.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ge.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===d&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){Ge.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(l,d){const x=this._map._getUIString(`AttributionControl.${d}`);l.setAttribute("aria-label",x),l.firstElementChild&&l.firstElementChild.setAttribute("title",x)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||C.config.ACCESS_TOKEN}];if(l){const x=d.reduce((M,D,B)=>(D.value&&(M+=`${D.key}=${D.value}${B<d.length-1?"&":""}`),M),"?");l.href=`${C.config.FEEDBACK_URL}/${x}${this._map._hash?this._map._hash.getHashString(!0):""}`,l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}}_updateData(l){!l||"metadata"!==l.sourceDataType&&"visibility"!==l.sourceDataType&&"style"!==l.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(M=>"string"!=typeof M?"":M)):"string"==typeof this.options.customAttribution&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const M=this._map.style.stylesheet;this.styleOwner=M.owner,this.styleId=M.id}const d=this._map.style._sourceCaches;for(const M in d){const D=d[M];if(D.used){const B=D.getSource();B.attribution&&l.indexOf(B.attribution)<0&&l.push(B.attribution)}}l.sort((M,D)=>M.length-D.length),l=l.filter((M,D)=>{for(let B=D+1;B<l.length;B++)if(l[B].indexOf(M)>=0)return!1;return!0});const x=l.join(" | ");x!==this._attribHTML&&(this._attribHTML=x,l.length?(this._innerContainer.innerHTML=x,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class gn{constructor(){C.bindAll(["_updateLogo"],this),C.bindAll(["_updateCompact"],this)}onAdd(l){this._map=l,this._container=Ge.create("div","mapboxgl-ctrl");const d=Ge.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Ge.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&"metadata"!==l.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(0===Object.entries(l).length)return!0;for(const d in l){const x=l[d].getSource();if(x.hasOwnProperty("mapbox_logo")&&!x.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const d=l[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class Ni{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const d=++this._id;return this._queue.push({callback:l,id:d,cancelled:!1}),d}remove(l){const d=this._currentlyRunning,x=d?this._queue.concat(d):this._queue;for(const M of x)if(M.id===l)return void(M.cancelled=!0)}run(l=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const x of d)if(!x.cancelled&&(x.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Rr(f,l,d){if(f=new C.LngLat(f.lng,f.lat),l){const x=new C.LngLat(f.lng-360,f.lat),M=new C.LngLat(f.lng+360,f.lat),D=360*Math.ceil(Math.abs(f.lng-d.center.lng)/360),B=d.locationPoint(f).distSqr(l),G=l.x<0||l.y<0||l.x>d.width||l.y>d.height;d.locationPoint(x).distSqr(l)<B&&(G||Math.abs(x.lng-d.center.lng)<D)?f=x:d.locationPoint(M).distSqr(l)<B&&(G||Math.abs(M.lng-d.center.lng)<D)&&(f=M)}for(;Math.abs(f.lng-d.center.lng)>180;){const x=d.locationPoint(f);if(x.x>=0&&x.y>=0&&x.x<=d.width&&x.y<=d.height)break;f.lng>d.center.lng?f.lng-=360:f.lng+=360}return f}const jo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Fc extends C.Evented{constructor(l,d){if(super(),(l instanceof C.window.HTMLElement||d)&&(l=C.extend({element:l},d)),C.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&"auto"!==l.pitchAlignment?l.pitchAlignment:this._rotationAlignment,l&&l.element)this._element=l.element,this._offset=C.pointGeometry.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ge.create("div"),this._element.setAttribute("aria-label","Map marker");const M=Ge.createNS("http://www.w3.org/2000/svg","svg"),D=41,B=27;M.setAttributeNS(null,"display","block"),M.setAttributeNS(null,"height",`${D}px`),M.setAttributeNS(null,"width",`${B}px`),M.setAttributeNS(null,"viewBox",`0 0 ${B} ${D}`);const G=Ge.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"stroke","none"),G.setAttributeNS(null,"stroke-width","1"),G.setAttributeNS(null,"fill","none"),G.setAttributeNS(null,"fill-rule","evenodd");const W=Ge.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"fill-rule","nonzero");const Y=Ge.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(3.0, 29.0)"),Y.setAttributeNS(null,"fill","#000000");const ee=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Le of ee){const Me=Ge.createNS("http://www.w3.org/2000/svg","ellipse");Me.setAttributeNS(null,"opacity","0.04"),Me.setAttributeNS(null,"cx","10.5"),Me.setAttributeNS(null,"cy","5.80029008"),Me.setAttributeNS(null,"rx",Le.rx),Me.setAttributeNS(null,"ry",Le.ry),Y.appendChild(Me)}const Q=Ge.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"fill",this._color);const le=Ge.createNS("http://www.w3.org/2000/svg","path");le.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Q.appendChild(le);const de=Ge.createNS("http://www.w3.org/2000/svg","g");de.setAttributeNS(null,"opacity","0.25"),de.setAttributeNS(null,"fill","#000000");const ge=Ge.createNS("http://www.w3.org/2000/svg","path");ge.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),de.appendChild(ge);const xe=Ge.createNS("http://www.w3.org/2000/svg","g");xe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),xe.setAttributeNS(null,"fill","#FFFFFF");const Te=Ge.createNS("http://www.w3.org/2000/svg","g");Te.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Ee=Ge.createNS("http://www.w3.org/2000/svg","circle");Ee.setAttributeNS(null,"fill","#000000"),Ee.setAttributeNS(null,"opacity","0.25"),Ee.setAttributeNS(null,"cx","5.5"),Ee.setAttributeNS(null,"cy","5.5"),Ee.setAttributeNS(null,"r","5.4999962");const Pe=Ge.createNS("http://www.w3.org/2000/svg","circle");Pe.setAttributeNS(null,"fill","#FFFFFF"),Pe.setAttributeNS(null,"cx","5.5"),Pe.setAttributeNS(null,"cy","5.5"),Pe.setAttributeNS(null,"r","5.4999962"),Te.appendChild(Ee),Te.appendChild(Pe),W.appendChild(Y),W.appendChild(Q),W.appendChild(de),W.appendChild(xe),W.appendChild(Te),M.appendChild(W),M.setAttributeNS(null,"height",D*this._scale+"px"),M.setAttributeNS(null,"width",B*this._scale+"px"),this._element.appendChild(M),this._offset=C.pointGeometry.convert(l&&l.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",M=>{M.preventDefault()}),this._element.addEventListener("mousedown",M=>{M.preventDefault()});const x=this._element.classList;for(const M in jo)x.remove(`mapboxgl-marker-anchor-${M}`);x.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(l){return this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),Ge.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=C.LngLat.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const d=38.1,x=13.5,M=Math.sqrt(Math.pow(x,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-d],"bottom-left":[M,-1*(d-x+M)],"bottom-right":[-M,-1*(d-x+M)],left:[x,-1*(d-x)],right:[-x,-1*(d-x)]}:this._offset}this._popup=l,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const d=l.code,x=l.charCode||l.keyCode;"Space"!==d&&"Enter"!==d&&32!==x&&13!==x||this.togglePopup()}_onMapClick(l){const d=l.originalEvent.target,x=this._element;this._popup&&(d===x||x.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const l=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(l))return void this._clearFadeTimer();const d=this._map.unproject(l);let x=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const D=this._map.getFreeCameraOptions();if(D.position){const B=D.position.toLngLat();x=B.distanceTo(d)<.9*B.distanceTo(this._lngLat)}}const M=(1-this._map._queryFogOpacity(d))*(x?.2:1);this._element.style.opacity=`${M}`,this._popup&&this._popup._setOpacity(`${M}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(l){const d=this._map.transform;return!!l&&l.x>=0&&l.x<d.width&&l.y>=0&&l.y<d.height}_update(l){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Rr(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let d="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?d=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let x="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?x="rotateX(0deg)":"map"===this._pitchAlignment&&(x=`rotateX(${this._map.getPitch()}deg)`),l&&"moveend"!==l.type||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&Ge.setTransform(this._element,`${jo[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${x} ${d}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const l=this._map.transform,d=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&d._rotate(l.angle),"map"===this._pitchAlignment&&(d.y*=Math.cos(l._pitch)),d}getOffset(){return this._offset}setOffset(l){return this._offset=C.pointGeometry.convert(l),this._update(),this}_onMove(l){if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=l.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=l.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new C.Event("dragstart"))),this.fire(new C.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new C.Event("dragend")),this._state="inactive"}_addDragHandler(l){this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=l.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&"auto"!==l?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class ah{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const d=C.easeCubicInOut((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,d,x){this._start=this.getValue(d),this._end=l,this._startTime=d,this._endTime=d+x}}const Su={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:hc,HTMLElement:pc,ImageBitmap:oo}=C.window,ho={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function fs(f){f.parentNode&&f.parentNode.removeChild(f)}const sh={showCompass:!0,showZoom:!0,visualizePitch:!1};class Va{constructor(l,d,x=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new Js({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,x&&(this.mousePitch=new uc({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),C.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Ge.addEventListener(d,"mousedown",this.mousedown),Ge.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),Ge.addEventListener(d,"touchmove",this.touchmove),Ge.addEventListener(d,"touchend",this.touchend),Ge.addEventListener(d,"touchcancel",this.reset)}down(l,d){this.mouseRotate.mousedown(l,d),this.mousePitch&&this.mousePitch.mousedown(l,d),Ge.disableDrag()}move(l,d){const x=this.map,M=this.mouseRotate.mousemoveWindow(l,d);if(M&&M.bearingDelta&&x.setBearing(x.getBearing()+M.bearingDelta),this.mousePitch){const D=this.mousePitch.mousemoveWindow(l,d);D&&D.pitchDelta&&x.setPitch(x.getPitch()+D.pitchDelta)}}off(){const l=this.element;Ge.removeEventListener(l,"mousedown",this.mousedown),Ge.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),Ge.removeEventListener(l,"touchmove",this.touchmove),Ge.removeEventListener(l,"touchend",this.touchend),Ge.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){Ge.enableDrag(),Ge.removeEventListener(C.window,"mousemove",this.mousemove),Ge.removeEventListener(C.window,"mouseup",this.mouseup)}mousedown(l){this.down(C.extend({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),Ge.mousePos(this.element,l)),Ge.addEventListener(C.window,"mousemove",this.mousemove),Ge.addEventListener(C.window,"mouseup",this.mouseup)}mousemove(l){this.move(l,Ge.mousePos(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){1!==l.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ge.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){1!==l.targetTouches.length?this.reset():(this._lastPos=Ge.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){0===l.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Ga={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let dc,au=0,Qs=!1;const Kh={maxWidth:100,unit:"metric"};function v(f,l,d){const x=d&&d.maxWidth||100,M=f._container.getBoundingClientRect().height/2,D=f.unproject([0,M]),B=f.unproject([x,M]),G=D.distanceTo(B);if(d&&"imperial"===d.unit){const W=3.2808*G;W>5280?w(l,x,W/5280,f._getUIString("ScaleControl.Miles"),f):w(l,x,W,f._getUIString("ScaleControl.Feet"),f)}else d&&"nautical"===d.unit?w(l,x,G/1852,f._getUIString("ScaleControl.NauticalMiles"),f):G>=1e3?w(l,x,G/1e3,f._getUIString("ScaleControl.Kilometers"),f):w(l,x,G,f._getUIString("ScaleControl.Meters"),f)}function w(f,l,d,x,M){const D=function(G){const W=Math.pow(10,`${Math.floor(G)}`.length-1);let Y=G/W;return Y=Y>=10?10:Y>=5?5:Y>=3?3:Y>=2?2:Y>=1?1:function(ee){const Q=Math.pow(10,Math.ceil(-Math.log(ee)/Math.LN10));return Math.round(ee*Q)/Q}(Y),W*Y}(d),B=D/d;M._requestDomTask(()=>{f.style.width=l*B+"px",f.innerHTML=`${D}&nbsp;${x}`})}const _={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},I=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),j={version:C.version,supported:ut,setRTLTextPlugin:C.setRTLTextPlugin,getRTLTextPluginStatus:C.getRTLTextPluginStatus,Map:class extends oh{constructor(f){if(null!=(f=C.extend({},ho,f)).minZoom&&null!=f.maxZoom&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=f.minPitch&&null!=f.maxPitch&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=f.minPitch&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=f.maxPitch&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new hp(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._renderTaskQueue=new Ni,this._domRenderTaskQueue=new Ni,this._controls=[],this._markers=[],this._mapId=C.uniqueId(),this._locale=C.extend({},Su,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new ah(0),this._requestManager=new C.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,"string"==typeof f.container){if(this._container=C.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof pc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),C.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==C.window&&(C.window.addEventListener("online",this._onWindowOnline,!1),C.window.addEventListener("resize",this._onWindowResize,!1),C.window.addEventListener("orientationchange",this._onWindowResize,!1),C.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Ea(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new lc("string"==typeof f.hash&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,C.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new cc({customAttribution:f.customAttribution})),this._logoControl=new gn,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update("style"===l.dataType),this.fire(new C.Event(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new C.Event(`${l.dataType}dataloading`,l))})}_getMapId(){return this._mapId}addControl(f,l){if(void 0===l&&(l=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new C.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=f.onAdd(this);this._controls.push(f);const x=this._controlPositions[l];return-1!==l.indexOf("bottom")?x.insertBefore(d,x.firstChild):x.appendChild(d),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new C.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(f);return l>-1&&this._controls.splice(l,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){const[l,d]=this._containerDimensions();if(l===this.transform.width&&d===this.transform.height)return this;this._resizeCanvas(l,d),this.transform.resize(l,d),this.painter.resize(Math.ceil(l),Math.ceil(d));const x=!this._moving;return x&&this.fire(new C.Event("movestart",f)).fire(new C.Event("move",f)),this.fire(new C.Event("resize",f)),x&&this.fire(new C.Event("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(C.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=null==f?-2:f)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new C.Event("zoomstart")).fire(new C.Event("zoom")).fire(new C.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=null==f?22:f)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new C.Event("zoomstart")).fire(new C.Event("zoom")).fire(new C.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=null==f?0:f)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new C.Event("pitchstart")).fire(new C.Event("pitch")).fire(new C.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=null==f?85:f)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new C.Event("pitchstart")).fire(new C.Event("pitch")).fire(new C.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}getProjection(){return this.transform.getProjection()}setProjection(f){this._lazyInitEmptyStyle(),"string"==typeof f&&(f={name:f}),this._runtimeProjection=f,this.style.updateProjection()}project(f){return this.transform.locationPoint3D(C.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(C.pointGeometry.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(f,l,d){if("mouseenter"===f||"mouseover"===f){let x=!1;const M=B=>{const G=l.filter(Y=>this.getLayer(Y)),W=G.length?this.queryRenderedFeatures(B.point,{layers:G}):[];W.length?x||(x=!0,d.call(this,new Ua(f,this,B.originalEvent,{features:W}))):x=!1},D=()=>{x=!1};return{layers:new Set(l),listener:d,delegates:{mousemove:M,mouseout:D}}}if("mouseleave"===f||"mouseout"===f){let x=!1;const M=B=>{const G=l.filter(W=>this.getLayer(W));(G.length?this.queryRenderedFeatures(B.point,{layers:G}):[]).length?x=!0:x&&(x=!1,d.call(this,new Ua(f,this,B.originalEvent)))},D=B=>{x&&(x=!1,d.call(this,new Ua(f,this,B.originalEvent)))};return{layers:new Set(l),listener:d,delegates:{mousemove:M,mouseout:D}}}{const x=M=>{const D=l.filter(G=>this.getLayer(G)),B=D.length?this.queryRenderedFeatures(M.point,{layers:D}):[];B.length&&(M.features=B,d.call(this,M),delete M.features)};return{layers:new Set(l),listener:d,delegates:{[f]:x}}}}on(f,l,d){if(void 0===d)return super.on(f,l);Array.isArray(l)||(l=[l]);const x=this._createDelegatedListener(f,l,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(x);for(const M in x.delegates)this.on(M,x.delegates[M]);return this}once(f,l,d){if(void 0===d)return super.once(f,l);Array.isArray(l)||(l=[l]);const x=this._createDelegatedListener(f,l,d);for(const M in x.delegates)this.once(M,x.delegates[M]);return this}off(f,l,d){if(void 0===d)return super.off(f,l);l=new Set(Array.isArray(l)?l:[l]);const x=(D,B)=>{if(D.size!==B.size)return!1;for(const G of D)if(!B.has(G))return!1;return!0},M=this._delegatedListeners?this._delegatedListeners[f]:void 0;return M&&(D=>{for(let B=0;B<D.length;B++){const G=D[B];if(G.listener===d&&x(G.layers,l)){for(const W in G.delegates)this.off(W,G.delegates[W]);return D.splice(B,1),this}}})(M),this}queryRenderedFeatures(f,l){return this.style?(void 0!==l||void 0===f||f instanceof C.pointGeometry||Array.isArray(f)||(l=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],l=l||{},this.transform)):[]}querySourceFeatures(f,l){return this.style.querySourceFeatures(f,l)}queryTerrainElevation(f,l){const d=this.transform.elevation;return d?(l=C.extend({},{exaggerated:!0},l),d.getAtPoint(C.MercatorCoordinate.fromLngLat(f),null,l.exaggerated)):null}setStyle(f,l){return!1!==(l=C.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l)).diff&&l.localIdeographFontFamily===this._localIdeographFontFamily&&l.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(f,l))}_getUIString(f){const l=this._locale[f];if(null==l)throw new Error(`Missing UI string '${f}'`);return l}_updateStyle(f,l){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),f&&(this.style=new wa(this,l||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof f?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new wa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,l){if("string"==typeof f){const d=this._requestManager.normalizeStyleURL(f),x=this._requestManager.transformRequest(d,C.ResourceType.Style);C.getJSON(x,(M,D)=>{M?this.fire(new C.ErrorEvent(M)):D&&this._updateDiff(D,l)})}else"object"==typeof f&&this._updateDiff(f,l)}_updateDiff(f,l){try{this.style.setState(f)&&this._update(!0)}catch(d){C.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(f,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():C.warnOnce("There is no style added to the map.")}addSource(f,l){return this._lazyInitEmptyStyle(),this.style.addSource(f,l),this._update(!0)}isSourceLoaded(f){const l=this.style&&this.style._getSourceCaches(f);if(0!==l.length)return l.every(d=>d.loaded());this.fire(new C.ErrorEvent(new Error(`There is no source with ID '${f}'`)))}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const l in f){const d=f[l]._tiles;for(const x in d){const M=d[x];if("loaded"!==M.state&&"errored"!==M.state)return!1}}return!0}addSourceType(f,l,d){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,l,d)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,l,{pixelRatio:d=1,sdf:x=!1,stretchX:M,stretchY:D,content:B}={}){if(this._lazyInitEmptyStyle(),l instanceof hc||oo&&l instanceof oo){const{width:G,height:W,data:Y}=C.exported.getImageData(l);this.style.addImage(f,{data:new C.RGBAImage({width:G,height:W},Y),pixelRatio:d,stretchX:M,stretchY:D,content:B,sdf:x,version:0})}else{if(void 0===l.width||void 0===l.height)return this.fire(new C.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:G,height:W,data:Y}=l,ee=l;this.style.addImage(f,{data:new C.RGBAImage({width:G,height:W},new Uint8Array(Y)),pixelRatio:d,stretchX:M,stretchY:D,content:B,sdf:x,version:0,userImage:ee}),ee.onAdd&&ee.onAdd(this,f)}}}updateImage(f,l){const d=this.style.getImage(f);if(!d)return this.fire(new C.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=l instanceof hc||oo&&l instanceof oo?C.exported.getImageData(l):l,{width:M,height:D,data:B}=x;return void 0===M||void 0===D?this.fire(new C.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):M!==d.data.width||D!==d.data.height?this.fire(new C.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(d.data.replace(B,!(l instanceof hc||oo&&l instanceof oo)),void this.style.updateImage(f,d))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new C.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,l){C.getImage(this._requestManager.transformRequest(f,C.ResourceType.Image),(d,x)=>{l(d,x instanceof hc?C.exported.getImageData(x):x)})}listImages(){return this.style.listImages()}addLayer(f,l){return this._lazyInitEmptyStyle(),this.style.addLayer(f,l),this._update(!0)}moveLayer(f,l){return this.style.moveLayer(f,l),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,l,d){return this.style.setLayerZoomRange(f,l,d),this._update(!0)}setFilter(f,l,d={}){return this.style.setFilter(f,l,d),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,l,d,x={}){return this.style.setPaintProperty(f,l,d,x),this._update(!0)}getPaintProperty(f,l){return this.style.getPaintProperty(f,l)}setLayoutProperty(f,l,d,x={}){return this.style.setLayoutProperty(f,l,d,x),this._update(!0)}getLayoutProperty(f,l){return this.style.getLayoutProperty(f,l)}setLight(f,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,l),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(C.LngLat.convert(f),this.transform):0}setFeatureState(f,l){return this.style.setFeatureState(f,l),this._update()}removeFeatureState(f,l){return this.style.removeFeatureState(f,l),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_containerDimensions(){let f=0,l=0;return this._container&&(f=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300),[f,l]}_detectMissingCSS(){"rgb(250, 128, 114)"!==C.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&C.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ge.create("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=Ge.create("div","mapboxgl-canvas-container",f);this._interactive&&l.classList.add("mapboxgl-interactive"),this._canvas=Ge.create("canvas","mapboxgl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions();this._resizeCanvas(d[0],d[1]);const x=this._controlContainer=Ge.create("div","mapboxgl-control-container",f),M=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(D=>{M[D]=Ge.create("div",`mapboxgl-ctrl-${D}`,x)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,l){const d=C.exported.devicePixelRatio||1;this._canvas.width=d*Math.ceil(f),this._canvas.height=d*Math.ceil(l),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${l}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const l=this._markers.indexOf(f);-1!==l&&this._markers.splice(l,1)}_setupPainter(){const f=C.extend({},ut.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);l?(C.storeAuthState(l,!0),this.painter=new Wh(l,this.transform),this.on("data",d=>{"source"===d.dataType&&this.painter.setTileLoadedFlag(!0)}),C.exported$1.testSupport(l)):this.fire(new C.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new C.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new C.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let l;const d=this.painter.context.extTimerQuery,x=C.exported.now();this.listens("gpu-timing-frame")&&(l=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,l));let M=this._updateAverageElevation(x);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;let D=!1;const B=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const W=this.transform.zoom,Y=this.transform.pitch,ee=C.exported.now();this.style.zoomHistory.update(W,ee);const Q=new C.EvaluationParameters(W,{now:ee,fadeDuration:B,pitch:Y,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),le=Q.crossFadingFactor();1===le&&le===this._crossFadingFactor||(D=!0,this._crossFadingFactor=le),this.style.update(Q)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,B,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:B,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new C.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new C.Event("load"))),this.style&&(this.style.hasTransitions()||D)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const W=C.exported.now()-x;d.endQueryEXT(d.TIME_ELAPSED_EXT,l),setTimeout(()=>{const Y=d.getQueryObjectEXT(l,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(l),this.fire(new C.Event("gpu-timing-frame",{cpuTime:W,gpuTime:Y}))},50)}if(this.listens("gpu-timing-layer")){const W=this.painter.collectGpuTimers();setTimeout(()=>{const Y=this.painter.queryGpuTimers(W);this.fire(new C.Event("gpu-timing-layer",{layerTimes:Y}))},50)}const G=this._sourcesDirty||this._styleDirty||this._placementDirty||M;if(G||this._repaint)this.triggerRepaint();else{const W=!this.isMoving()&&this.loaded();if(W&&(M=this._updateAverageElevation(x,!0)),M)this.triggerRepaint();else if(this._triggerFrame(!1),W&&(this.fire(new C.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const Y=this._calculateSpeedIndex();this.fire(new C.Event("speedindexcompleted",{speedIndex:Y})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||G||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const f of this._markers)f._update()}_updateAverageElevation(f,l=!1){const d=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&d(0);if((l||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const x=this.transform.averageElevation;let M=this.transform.sampleAverageElevation();isNaN(M)?M=0:this._averageElevationLastSampledAt=f;const D=Math.abs(x-M);if(D>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(M),d(M);this._averageElevation.easeTo(M,f,300)}else if(D>1e-4)return this._averageElevation.jumpTo(M),d(M)}return!!this._averageElevation.isEasing(f)&&d(this._averageElevation.getValue(f))}_authenticate(){C.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===C.AUTH_ERR_MSG||401===f.status)){const l=this.painter.context.gl;C.storeAuthState(l,!1),this._logoControl instanceof gn&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new C.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),C.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const d=this.painter.context.gl,x=d.createFramebuffer();function M(D){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,D,0);const B=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,B),B}return d.bindFramebuffer(d.FRAMEBUFFER,x),this._canvasPixelComparison(M(f),l.canvasCopies.map(M),l.timeStamps)}_canvasPixelComparison(f,l,d){let x=d[1]-d[0];const M=f.length/4;for(let D=0;D<l.length;D++){const B=l[D];let G=0;for(let W=0;W<B.length;W+=4)B[W]===f[W]&&B[W+1]===f[W+1]&&B[W+2]===f[W+2]&&B[W+3]===f[W+3]&&(G+=1);x+=(d[D+2]-d[D+1])*(1-G/M)}return x}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.clearWorkerCaches(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==C.window&&(C.window.removeEventListener("resize",this._onWindowResize,!1),C.window.removeEventListener("orientationchange",this._onWindowResize,!1),C.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),C.window.removeEventListener("online",this._onWindowOnline,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),fs(this._canvasContainer),fs(this._controlContainer),fs(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),C.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new C.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=C.exported.frame(l=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(l)}))}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}_setCacheLimits(f,l){C.setCacheLimits(f,l)}get version(){return C.version}},NavigationControl:class{constructor(f){this.options=C.extend({},sh,f),this._container=Ge.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(C.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),Ge.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),Ge.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(C.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=Ge.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const f=this._map.getZoom(),l=f===this._map.getMaxZoom(),d=f===this._map.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const f=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=f)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Va(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Ge.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,l){const d=Ge.create("button",f,this._container);return d.type="button",d.addEventListener("click",l),d}_setButtonTitle(f,l){const d=this._map._getUIString(`NavigationControl.${l}`);f.setAttribute("aria-label",d),f.firstElementChild&&f.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends C.Evented{constructor(f){super(),this.options=C.extend({},Ga,f),C.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Xh(this._updateMarkerRotation,20)}onAdd(f){var l;return this._map=f,this._container=Ge.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),l=this._setupUI,void 0!==dc?l(dc):void 0!==C.window.navigator.permissions?C.window.navigator.permissions.query({name:"geolocation"}).then(d=>{dc="denied"!==d.state,l(dc)}):(dc=!!C.window.navigator.geolocation,l(dc)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(C.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Ge.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,au=0,Qs=!1}_isOutOfMapMaxBounds(f){const l=this._map.getMaxBounds(),d=f.coords;return l&&(d.longitude<l.getWest()||d.longitude>l.getEast()||d.latitude<l.getSouth()||d.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new C.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(f),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new C.Event("geolocate",f)),this._finish()}}_updateCamera(f){const l=new C.LngLat(f.coords.longitude,f.coords.latitude),d=f.coords.accuracy,x=this._map.getBearing(),M=C.extend({bearing:x},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(d),M,{geolocateSource:!0})}_updateMarker(f){if(f){const l=new C.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map._container.getBoundingClientRect().height/2,l=this._map.unproject([0,f]),d=this._map.unproject([100,f]),x=l.distanceTo(d)/100,M=Math.ceil(2*this._accuracy/x);this._circleElement.style.width=`${M}px`,this._circleElement.style.height=`${M}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(1===f.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===f.code&&Qs)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new C.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=Ge.create("button","mapboxgl-ctrl-geolocate",this._container),Ge.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===f){C.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ge.create("div","mapboxgl-user-location"),this._dotElement.appendChild(Ge.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ge.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Fc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ge.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Fc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||"ACTIVE_LOCK"!==this._watchState||l.originalEvent&&"resize"===l.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new C.Event("trackuserlocationend")))})}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:!0===f.absolute&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return C.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new C.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":au--,Qs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new C.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new C.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),au++,au>1?(f={maximumAge:6e5,timeout:0},Qs=!0):(f=this.options.positionOptions,Qs=!1),this._geolocationWatchID=C.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else C.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{C.window.addEventListener("ondeviceorientationabsolute"in C.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==C.window.DeviceMotionEvent&&"function"==typeof C.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(l=>{"granted"===l&&f()}).catch(console.error):f()}_clearWatch(){C.window.navigator.geolocation.clearWatch(this._geolocationWatchID),C.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),C.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:cc,ScaleControl:class{constructor(f){this.options=C.extend({},Kh,f),C.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){v(this._map,this._container,this.options)}onAdd(f){return this._map=f,this._container=Ge.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Ge.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(f){this.options.unit=f,v(this._map,this._container,this.options)}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof C.window.HTMLElement?this._container=f.container:C.warnOnce("Full screen control 'container' must be a DOM element.")),C.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in C.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in C.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ge.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",C.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){Ge.remove(this._controlContainer),this._map=null,C.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!C.window.document.fullscreenEnabled&&!C.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=Ge.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ge.create("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden",!0),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),C.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(C.window.document.fullscreenElement||C.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?C.window.document.exitFullscreen?C.window.document.exitFullscreen():C.window.document.webkitCancelFullScreen&&C.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends C.Evented{constructor(f){super(),this.options=C.extend(Object.create(_),f),C.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new C.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&Ge.remove(this._content),this._container&&(Ge.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new C.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=C.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(C.window.document.createTextNode(f))}setHTML(f){const l=C.window.document.createDocumentFragment(),d=C.window.document.createElement("body");let x;for(d.innerHTML=f;x=d.firstChild,x;)l.appendChild(x);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Ge.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._container&&this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._container&&this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let l;return this._classList.delete(f)?l=!1:(this._classList.add(f),l=!0),this._container&&this._updateClassList(),l}_createCloseButton(){this.options.closeButton&&(this._closeButton=Ge.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(f){this._update(f.point)}_onMouseMove(f){this._update(f.point)}_onDrag(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const l=this._pos,d=this._container.offsetWidth,x=this._container.offsetHeight;let M;return M=l.y+f.bottom.y<x?["top"]:l.y>this._map.transform.height-x?["bottom"]:[],l.x<d/2?M.push("left"):l.x>this._map.transform.width-d/2&&M.push("right"),0===M.length?"bottom":M.join("-")}_updateClassList(){const f=[...this._classList];f.push("mapboxgl-popup"),this._anchor&&f.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&f.push("mapboxgl-popup-track-pointer"),this._container.className=f.join(" ")}_update(f){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=Ge.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Ge.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Rr(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||f){const l=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),d=function(D){if(D||(D=new C.pointGeometry(0,0)),"number"==typeof D){const B=Math.round(Math.sqrt(.5*Math.pow(D,2)));return{center:new C.pointGeometry(0,0),top:new C.pointGeometry(0,D),"top-left":new C.pointGeometry(B,B),"top-right":new C.pointGeometry(-B,B),bottom:new C.pointGeometry(0,-D),"bottom-left":new C.pointGeometry(B,-B),"bottom-right":new C.pointGeometry(-B,-B),left:new C.pointGeometry(D,0),right:new C.pointGeometry(-D,0)}}if(D instanceof C.pointGeometry||Array.isArray(D)){const B=C.pointGeometry.convert(D);return{center:B,top:B,"top-left":B,"top-right":B,bottom:B,"bottom-left":B,"bottom-right":B,left:B,right:B}}return{center:C.pointGeometry.convert(D.center||[0,0]),top:C.pointGeometry.convert(D.top||[0,0]),"top-left":C.pointGeometry.convert(D["top-left"]||[0,0]),"top-right":C.pointGeometry.convert(D["top-right"]||[0,0]),bottom:C.pointGeometry.convert(D.bottom||[0,0]),"bottom-left":C.pointGeometry.convert(D["bottom-left"]||[0,0]),"bottom-right":C.pointGeometry.convert(D["bottom-right"]||[0,0]),left:C.pointGeometry.convert(D.left||[0,0]),right:C.pointGeometry.convert(D.right||[0,0])}}(this.options.offset),x=this._anchor=this._getAnchor(d),M=l.add(d[x]).round();this._map._requestDomTask(()=>{this._container&&x&&Ge.setTransform(this._container,`${jo[x]} translate(${M.x}px,${M.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(I);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._content&&(this._content.style.opacity=f),this._tip&&(this._tip.style.opacity=f)}},Marker:Fc,Style:wa,LngLat:C.LngLat,LngLatBounds:C.LngLatBounds,Point:C.pointGeometry,MercatorCoordinate:C.MercatorCoordinate,FreeCameraOptions:qi,Evented:C.Evented,config:C.config,prewarm:function(){Rt().acquire(Ze)},clearPrewarmedResources:function(){const f=lt;f&&(f.isPreloaded()&&1===f.numActive()?(f.release(Ze),lt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return C.config.ACCESS_TOKEN},set accessToken(f){C.config.ACCESS_TOKEN=f},get baseApiUrl(){return C.config.API_URL},set baseApiUrl(f){C.config.API_URL=f},get workerCount(){return Be.workerCount},set workerCount(f){Be.workerCount=f},get maxParallelImageRequests(){return C.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){C.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){C.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:C.exported.setNow,restoreNow:C.exported.restoreNow};return j}),Ut}()},728:xr=>{var Gr={thin:100,hairline:100,"ultra-light":100,"extra-light":100,light:200,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,heavy:800,black:800,"extra-bold":800,"ultra-black":900,"extra-black":900,"ultra-bold":900,"heavy-black":900,fat:900,poster:900},Ut=/(italic|oblique)$/i,Jt={};xr.exports=function(L,C,ut){var tn=Jt[L];if(!tn){Array.isArray(L)||(L=[L]);for(var Et=400,it="normal",Ge=[],on=0,Cn=L.length;on<Cn;++on){var et=L[on].split(" "),_t=et[et.length-1].toLowerCase();for(var Dt in"normal"==_t||"italic"==_t||"oblique"==_t?(it=_t,et.pop(),_t=et[et.length-1].toLowerCase()):Ut.test(_t)&&(_t=_t.replace(Ut,""),it=et[et.length-1].replace(_t,"")),Gr)if(_t==Dt||_t==Dt.replace("-","")||_t==Dt.replace("-"," ")){Et=Gr[Dt],et.pop();break}"number"==typeof _t&&(Et=_t);var bn=et.join(" ").replace("Klokantech Noto Sans","Noto Sans");-1!==bn.indexOf(" ")&&(bn='"'+bn+'"'),Ge.push(bn)}tn=Jt[L]=[it,Et,Ge]}return tn[0]+" "+tn[1]+" "+C+"px"+(ut?"/"+ut:"")+" "+tn[2]}},347:function(xr){xr.exports=function(){"use strict";var Gr,Ht,Ut;function Jt(L,C){if(Gr)if(Ht){var ut="var sharedChunk = {}; ("+Gr+")(sharedChunk); ("+Ht+")(sharedChunk);",tn={};Gr(tn),Ut=C(tn),"undefined"!=typeof window&&(Ut.workerUrl=window.URL.createObjectURL(new Blob([ut],{type:"text/javascript"})))}else Ht=C;else Gr=C}return Jt(0,function(L){function C(s,h){return s(h={exports:{}},h.exports),h.exports}var ut=tn;function tn(s,h,g,S){this.cx=3*s,this.bx=3*(g-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*h,this.by=3*(S-h)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=S,this.p2x=g,this.p2y=S}tn.prototype.sampleCurveX=function(s){return((this.ax*s+this.bx)*s+this.cx)*s},tn.prototype.sampleCurveY=function(s){return((this.ay*s+this.by)*s+this.cy)*s},tn.prototype.sampleCurveDerivativeX=function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},tn.prototype.solveCurveX=function(s,h){var g,S,k,N,q;for(void 0===h&&(h=1e-6),k=s,q=0;q<8;q++){if(N=this.sampleCurveX(k)-s,Math.abs(N)<h)return k;var X=this.sampleCurveDerivativeX(k);if(Math.abs(X)<1e-6)break;k-=N/X}if((k=s)<(g=0))return g;if(k>(S=1))return S;for(;g<S;){if(N=this.sampleCurveX(k),Math.abs(N-s)<h)return k;s>N?g=k:S=k,k=.5*(S-g)+g}return k},tn.prototype.solve=function(s,h){return this.sampleCurveY(this.solveCurveX(s,h))};var Et=it;function it(s,h){this.x=s,this.y=h}it.prototype={clone:function(){return new it(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,h){return this.clone()._rotateAround(s,h)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var h=s.x-this.x,g=s.y-this.y;return h*h+g*g},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,h){return Math.atan2(this.x*h-this.y*s,this.x*s+this.y*h)},_matMult:function(s){var h=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=h,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var h=Math.cos(s),g=Math.sin(s),S=g*this.x+h*this.y;return this.x=h*this.x-g*this.y,this.y=S,this},_rotateAround:function(s,h){var g=Math.cos(s),S=Math.sin(s),k=h.y+S*(this.x-h.x)+g*(this.y-h.y);return this.x=h.x+g*(this.x-h.x)-S*(this.y-h.y),this.y=k,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},it.convert=function(s){return s instanceof it?s:Array.isArray(s)?new it(s[0],s[1]):s};var Ge="undefined"!=typeof self?self:{},Ke=Math.pow(2,53)-1;function Wt(s,h,g,S){var k=new ut(s,h,g,S);return function(N){return k.solve(N)}}var on=Wt(.25,.1,.25,1);function Cn(s,h,g){return Math.min(g,Math.max(h,s))}function fn(s,h,g){var S=g-h,k=((s-h)%S+S)%S+h;return k===h?g:k}function et(s){for(var h=[],g=arguments.length-1;g-- >0;)h[g]=arguments[g+1];for(var S=0,k=h;S<k.length;S+=1){var N=k[S];for(var q in N)s[q]=N[q]}return s}var _t=1;function Dt(){return _t++}function bn(){return function s(h){return h?(h^16*Math.random()>>h/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function Pn(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function an(s,h){s.forEach(function(g){h[g]&&(h[g]=h[g].bind(h))})}function Rn(s,h){return-1!==s.indexOf(h,s.length-h.length)}function nr(s,h,g){var S={};for(var k in s)S[k]=h.call(g||this,s[k],k,s);return S}function dr(s,h,g){var S={};for(var k in s)h.call(g||this,s[k],k,s)&&(S[k]=s[k]);return S}function jn(s){return Array.isArray(s)?s.map(jn):"object"==typeof s&&s?nr(s,jn):s}var pn={};function sr(s){pn[s]||("undefined"!=typeof console&&console.warn(s),pn[s]=!0)}function qr(s,h,g){return(g.y-s.y)*(h.x-s.x)>(h.y-s.y)*(g.x-s.x)}function Es(s){for(var h=0,g=0,S=s.length,k=S-1,N=void 0,q=void 0;g<S;k=g++)h+=((q=s[k]).x-(N=s[g]).x)*(N.y+q.y);return h}function je(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function ct(s){var h={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(S,k,N,q){var X=N||q;return h[k]=!X||X.toLowerCase(),""}),h["max-age"]){var g=parseInt(h["max-age"],10);isNaN(g)?delete h["max-age"]:h["max-age"]=g}return h}var Vt=null;function Pr(s){if(null==Vt){var h=s.navigator?s.navigator.userAgent:null;Vt=!!s.safari||!(!h||!(/\b(iPad|iPhone|iPod)\b/.test(h)||h.match("Safari")&&!h.match("Chrome")))}return Vt}function fr(s){try{var h=Ge[s];return h.setItem("_mapbox_test_",1),h.removeItem("_mapbox_test_"),!0}catch(g){return!1}}var vr,Er,Ui,Wo,Xi=Ge.performance&&Ge.performance.now?Ge.performance.now.bind(Ge.performance):Date.now.bind(Date),Vi=Ge.requestAnimationFrame||Ge.mozRequestAnimationFrame||Ge.webkitRequestAnimationFrame||Ge.msRequestAnimationFrame,Zr=Ge.cancelAnimationFrame||Ge.mozCancelAnimationFrame||Ge.webkitCancelAnimationFrame||Ge.msCancelAnimationFrame,gl={now:Xi,frame:function(s){var h=Vi(s);return{cancel:function(){return Zr(h)}}},getImageData:function(s,h){void 0===h&&(h=0);var g=Ge.document.createElement("canvas"),S=g.getContext("2d");if(!S)throw new Error("failed to create canvas 2d context");return g.width=s.width,g.height=s.height,S.drawImage(s,0,0,s.width,s.height),S.getImageData(-h,-h,s.width+2*h,s.height+2*h)},resolveURL:function(s){return vr||(vr=Ge.document.createElement("a")),vr.href=s,vr.href},hardwareConcurrency:Ge.navigator&&Ge.navigator.hardwareConcurrency||4,get devicePixelRatio(){return Ge.devicePixelRatio},get prefersReducedMotion(){return!!Ge.matchMedia&&(null==Er&&(Er=Ge.matchMedia("(prefers-reduced-motion: reduce)")),Er.matches)}},Ir={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},yl={supported:!1,testSupport:function(s){!Sc&&Wo&&(Yl?di(s):Ui=s)}},Sc=!1,Yl=!1;function di(s){var h=s.createTexture();s.bindTexture(s.TEXTURE_2D,h);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,Wo),s.isContextLost())return;yl.supported=!0}catch(g){}s.deleteTexture(h),Sc=!0}Ge.document&&((Wo=Ge.document.createElement("img")).onload=function(){Ui&&di(Ui),Ui=null,Yl=!0},Wo.onerror=function(){Sc=!0,Ui=null},Wo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var zs="01",ss=function(s,h){this._transformRequestFn=s,this._customAccessToken=h,this._createSkuToken()};function Ar(s){return 0===s.indexOf("mapbox:")}ss.prototype._createSkuToken=function(){var s=function(){for(var h="",g=0;g<10;g++)h+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",zs,h].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt},ss.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},ss.prototype.transformRequest=function(s,h){return this._transformRequestFn&&this._transformRequestFn(s,h)||{url:s}},ss.prototype.normalizeStyleURL=function(s,h){if(!Ar(s))return s;var g=Rl(s);return g.path="/styles/v1"+g.path,this._makeAPIURL(g,this._customAccessToken||h)},ss.prototype.normalizeGlyphsURL=function(s,h){if(!Ar(s))return s;var g=Rl(s);return g.path="/fonts/v1"+g.path,this._makeAPIURL(g,this._customAccessToken||h)},ss.prototype.normalizeSourceURL=function(s,h){if(!Ar(s))return s;var g=Rl(s);return g.path="/v4/"+g.authority+".json",g.params.push("secure"),this._makeAPIURL(g,this._customAccessToken||h)},ss.prototype.normalizeSpriteURL=function(s,h,g,S){var k=Rl(s);return Ar(s)?(k.path="/styles/v1"+k.path+"/sprite"+h+g,this._makeAPIURL(k,this._customAccessToken||S)):(k.path+=""+h+g,Ol(k))},ss.prototype.normalizeTileURL=function(s,h){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Ar(s))return s;var g=Rl(s);g.path=g.path.replace(/(\.(png|jpg)\d*)(?=$)/,(gl.devicePixelRatio>=2||512===h?"@2x":"")+(yl.supported?".webp":"$1")),g.path=g.path.replace(/^.+\/v4\//,"/"),g.path="/v4"+g.path;var S=this._customAccessToken||function(k){for(var N=0,q=k;N<q.length;N+=1){var X=q[N].match(/^access_token=(.*)$/);if(X)return X[1]}return null}(g.params)||Ir.ACCESS_TOKEN;return Ir.REQUIRE_ACCESS_TOKEN&&S&&this._skuToken&&g.params.push("sku="+this._skuToken),this._makeAPIURL(g,S)},ss.prototype.canonicalizeTileURL=function(s,h){var g=Rl(s);if(!g.path.match(/(^\/v4\/)/)||!g.path.match(/\.[\w]+$/))return s;var S="mapbox://tiles/";S+=g.path.replace("/v4/","");var k=g.params;return h&&(k=k.filter(function(N){return!N.match(/^access_token=/)})),k.length&&(S+="?"+k.join("&")),S},ss.prototype.canonicalizeTileset=function(s,h){for(var g=!!h&&Ar(h),S=[],k=0,N=s.tiles||[];k<N.length;k+=1){var q=N[k];ol(q)?S.push(this.canonicalizeTileURL(q,g)):S.push(q)}return S},ss.prototype._makeAPIURL=function(s,h){var g="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",S=Rl(Ir.API_URL);if(s.protocol=S.protocol,s.authority=S.authority,"http"===s.protocol){var k=s.params.indexOf("secure");k>=0&&s.params.splice(k,1)}if("/"!==S.path&&(s.path=""+S.path+s.path),!Ir.REQUIRE_ACCESS_TOKEN)return Ol(s);if(!(h=h||Ir.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+g);if("s"===h[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+g);return s.params=s.params.filter(function(N){return-1===N.indexOf("access_token")}),s.params.push("access_token="+h),Ol(s)},ss.prototype.setTransformRequest=function(s){this._transformRequestFn=s};var Tc=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function ol(s){return Tc.test(s)}var vl=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Rl(s){var h=s.match(vl);if(!h)throw new Error("Unable to parse URL object");return{protocol:h[1],authority:h[2],path:h[3]||"/",params:h[4]?h[4].split("&"):[]}}function Ol(s){var h=s.params.length?"?"+s.params.join("&"):"";return s.protocol+"://"+s.authority+s.path+h}function gu(s){if(!s)return null;var h=s.split(".");if(!h||3!==h.length)return null;try{return JSON.parse(decodeURIComponent(Ge.atob(h[1]).split("").map(function(g){return"%"+("00"+g.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(g){return null}}var _l=function(s){this.type=s,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};_l.prototype.getStorageKey=function(s){var h,g=gu(Ir.ACCESS_TOKEN);return h=g&&g.u?Ge.btoa(encodeURIComponent(g.u).replace(/%([0-9A-F]{2})/g,function(S,k){return String.fromCharCode(Number("0x"+k))})):Ir.ACCESS_TOKEN||"",s?"mapbox.eventData."+s+":"+h:"mapbox.eventData:"+h},_l.prototype.fetchEventData=function(){var s=fr("localStorage"),h=this.getStorageKey(),g=this.getStorageKey("uuid");if(s)try{var S=Ge.localStorage.getItem(h);S&&(this.eventData=JSON.parse(S));var k=Ge.localStorage.getItem(g);k&&(this.anonId=k)}catch(N){sr("Unable to read from LocalStorage")}},_l.prototype.saveEventData=function(){var s=fr("localStorage"),h=this.getStorageKey(),g=this.getStorageKey("uuid");if(s)try{Ge.localStorage.setItem(g,this.anonId),Object.keys(this.eventData).length>=1&&Ge.localStorage.setItem(h,JSON.stringify(this.eventData))}catch(S){sr("Unable to write to LocalStorage")}},_l.prototype.processRequests=function(s){},_l.prototype.postEvent=function(s,h,g,S){var k=this;if(Ir.EVENTS_URL){var N=Rl(Ir.EVENTS_URL);N.params.push("access_token="+(S||Ir.ACCESS_TOKEN||""));var q={event:this.type,created:new Date(s).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.15.2",skuId:zs,userId:this.anonId},X=h?et(q,h):q,ie={url:Ol(N),headers:{"Content-Type":"text/plain"},body:JSON.stringify([X])};this.pendingRequest=be(ie,function(ce){k.pendingRequest=null,g(ce),k.saveEventData(),k.processRequests(S)})}},_l.prototype.queueRequest=function(s,h){this.queue.push(s),this.processRequests(h)};var Na,la,al=function(s){function h(){s.call(this,"map.load"),this.success={},this.skuToken=""}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.postMapLoadEvent=function(g,S,k,N){this.skuToken=k,(Ir.EVENTS_URL&&N||Ir.ACCESS_TOKEN&&Array.isArray(g)&&g.some(function(q){return Ar(q)||ol(q)}))&&this.queueRequest({id:S,timestamp:Date.now()},N)},h.prototype.processRequests=function(g){var S=this;if(!this.pendingRequest&&0!==this.queue.length){var k=this.queue.shift(),N=k.id,q=k.timestamp;N&&this.success[N]||(this.anonId||this.fetchEventData(),Pn(this.anonId)||(this.anonId=bn()),this.postEvent(q,{skuToken:this.skuToken},function(X){X||N&&(S.success[N]=!0)},g))}},h}(_l),Uh=new(function(s){function h(g){s.call(this,"appUserTurnstile"),this._customAccessToken=g}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.postTurnstileEvent=function(g,S){Ir.EVENTS_URL&&Ir.ACCESS_TOKEN&&Array.isArray(g)&&g.some(function(k){return Ar(k)||ol(k)})&&this.queueRequest(Date.now(),S)},h.prototype.processRequests=function(g){var S=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var k=gu(Ir.ACCESS_TOKEN),N=k?k.u:Ir.ACCESS_TOKEN,q=N!==this.eventData.tokenU;Pn(this.anonId)||(this.anonId=bn(),q=!0);var X=this.queue.shift();if(this.eventData.lastSuccess){var ie=new Date(this.eventData.lastSuccess),ce=new Date(X),ye=(X-this.eventData.lastSuccess)/864e5;q=q||ye>=1||ye<-1||ie.getDate()!==ce.getDate()}else q=!0;if(!q)return this.processRequests();this.postEvent(X,{"enabled.telemetry":!1},function(_e){_e||(S.eventData.lastSuccess=X,S.eventData.tokenU=N)},g)}},h}(_l)),Ys=Uh.postTurnstileEvent.bind(Uh),Ns=new al,Kc=Ns.postMapLoadEvent.bind(Ns),Ic=500,Vh=50;function Jc(){Ge.caches&&!Na&&(Na=Ge.caches.open("mapbox-tiles"))}function Qu(s){var h=s.indexOf("?");return h<0?s:s.slice(0,h)}var Mc,Ss=1/0;function Qc(){return null==Mc&&(Mc=Ge.OffscreenCanvas&&new Ge.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof Ge.createImageBitmap),Mc}var Nu={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Nu);var _h=function(s){function h(g,S,k){401===S&&ol(k)&&(g+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),s.call(this,g),this.status=S,this.url=k,this.name=this.constructor.name,this.message=g}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},h}(Error),Bs=je()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===Ge.location.protocol?Ge.parent:Ge).location.href};function Kl(s,h){var g,S=new Ge.AbortController,k=new Ge.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:Bs(),signal:S.signal}),N=!1,q=!1,X=(g=k.url).indexOf("sku=")>0&&ol(g);"json"===s.type&&k.headers.set("Accept","application/json");var ie=function(ye,_e,Ae){if(!q){if(ye&&"SecurityError"!==ye.message&&sr(ye),_e&&Ae)return ce(_e);var ze=Date.now();Ge.fetch(k).then(function(Xe){if(Xe.ok){var Qe=X?Xe.clone():null;return ce(Xe,Qe,ze)}return h(new _h(Xe.statusText,Xe.status,s.url))}).catch(function(Xe){20!==Xe.code&&h(new Error(Xe.message))})}},ce=function(ye,_e,Ae){("arrayBuffer"===s.type?ye.arrayBuffer():"json"===s.type?ye.json():ye.text()).then(function(ze){q||(_e&&Ae&&function(Xe,Qe,pt){if(Jc(),Na){var st={status:Qe.status,statusText:Qe.statusText,headers:new Ge.Headers};Qe.headers.forEach(function(At,Lt){return st.headers.set(Lt,At)});var St=ct(Qe.headers.get("Cache-Control")||"");St["no-store"]||(St["max-age"]&&st.headers.set("Expires",new Date(pt+1e3*St["max-age"]).toUTCString()),new Date(st.headers.get("Expires")).getTime()-pt<42e4||function(At,Lt){if(void 0===la)try{new Response(new ReadableStream),la=!0}catch(zt){la=!1}la?Lt(At.body):At.blob().then(Lt)}(Qe,function(At){var Lt=new Ge.Response(At,st);Jc(),Na&&Na.then(function(zt){return zt.put(Qu(Xe.url),Lt)}).catch(function(zt){return sr(zt.message)})}))}}(k,_e,Ae),N=!0,h(null,ze,ye.headers.get("Cache-Control"),ye.headers.get("Expires")))}).catch(function(ze){q||h(new Error(ze.message))})};return X?function(ye,_e){if(Jc(),!Na)return _e(null);var Ae=Qu(ye.url);Na.then(function(ze){ze.match(Ae).then(function(Xe){var Qe=function(pt){if(!pt)return!1;var st=new Date(pt.headers.get("Expires")||0),St=ct(pt.headers.get("Cache-Control")||"");return st>Date.now()&&!St["no-cache"]}(Xe);ze.delete(Ae),Qe&&ze.put(Ae,Xe.clone()),_e(null,Xe,Qe)}).catch(_e)}).catch(_e)}(k,ie):ie(null,null),{cancel:function(){q=!0,N||S.abort()}}}var Jl,Ll,Da=function(s,h){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){if(je()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,h);if(!je()){var g=s.url.substring(0,s.url.indexOf("://"));return(Ir.REGISTERED_PROTOCOLS[g]||Kl)(s,h)}}if(!(/^file:/.test(S=s.url)||/^file:/.test(Bs())&&!/^\w+:/.test(S))){if(Ge.fetch&&Ge.Request&&Ge.AbortController&&Ge.Request.prototype.hasOwnProperty("signal"))return Kl(s,h);if(je()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,h,void 0,!0)}var S;return function(k,N){var q=new Ge.XMLHttpRequest;for(var X in q.open(k.method||"GET",k.url,!0),"arrayBuffer"===k.type&&(q.responseType="arraybuffer"),k.headers)q.setRequestHeader(X,k.headers[X]);return"json"===k.type&&(q.responseType="text",q.setRequestHeader("Accept","application/json")),q.withCredentials="include"===k.credentials,q.onerror=function(){N(new Error(q.statusText))},q.onload=function(){if((q.status>=200&&q.status<300||0===q.status)&&null!==q.response){var ie=q.response;if("json"===k.type)try{ie=JSON.parse(q.response)}catch(ce){return N(ce)}N(null,ie,q.getResponseHeader("Cache-Control"),q.getResponseHeader("Expires"))}else N(new _h(q.statusText,q.status,k.url))},q.send(k.body),{cancel:function(){return q.abort()}}}(s,h)},Bo=function(s,h){return Da(et(s,{type:"arrayBuffer"}),h)},be=function(s,h){return Da(et(s,{method:"POST"}),h)},De="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Jl=[],Ll=0;var Oe=function(s,h){if(yl.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),Ll>=Ir.MAX_PARALLEL_IMAGE_REQUESTS){var g={requestParameters:s,callback:h,cancelled:!1,cancel:function(){this.cancelled=!0}};return Jl.push(g),g}Ll++;var S=!1,k=function(){if(!S)for(S=!0,Ll--;Jl.length&&Ll<Ir.MAX_PARALLEL_IMAGE_REQUESTS;){var q=Jl.shift();q.cancelled||(q.cancel=Oe(q.requestParameters,q.callback).cancel)}},N=Bo(s,function(q,X,ie,ce){var _e,Ae;k(),q?h(q):X&&(Qc()?(_e=h,Ae=new Ge.Blob([new Uint8Array(X)],{type:"image/png"}),Ge.createImageBitmap(Ae).then(function(ze){_e(null,ze)}).catch(function(ze){_e(new Error("Could not load image because of "+ze.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})):function(ye,_e,Ae,ze){var Xe=new Ge.Image,Qe=Ge.URL;Xe.onload=function(){_e(null,Xe),Qe.revokeObjectURL(Xe.src),Xe.onload=null,Ge.requestAnimationFrame(function(){Xe.src=De})},Xe.onerror=function(){return _e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var pt=new Ge.Blob([new Uint8Array(ye)],{type:"image/png"});Xe.cacheControl=Ae,Xe.expires=ze,Xe.src=ye.byteLength?Qe.createObjectURL(pt):De}(X,h,ie,ce))});return{cancel:function(){N.cancel(),k()}}};function se(s,h,g){g[s]&&-1!==g[s].indexOf(h)||(g[s]=g[s]||[],g[s].push(h))}function te(s,h,g){if(g&&g[s]){var S=g[s].indexOf(h);-1!==S&&g[s].splice(S,1)}}var oe=function(s,h){void 0===h&&(h={}),et(this,h),this.type=s},me=function(s){function h(g,S){void 0===S&&(S={}),s.call(this,"error",et({error:g},S))}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h}(oe),ve=function(){};ve.prototype.on=function(s,h){return this._listeners=this._listeners||{},se(s,h,this._listeners),this},ve.prototype.off=function(s,h){return te(s,h,this._listeners),te(s,h,this._oneTimeListeners),this},ve.prototype.once=function(s,h){return this._oneTimeListeners=this._oneTimeListeners||{},se(s,h,this._oneTimeListeners),this},ve.prototype.fire=function(s,h){"string"==typeof s&&(s=new oe(s,h||{}));var g=s.type;if(this.listens(g)){s.target=this;for(var S=0,k=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];S<k.length;S+=1)k[S].call(this,s);for(var N=0,q=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];N<q.length;N+=1){var X=q[N];te(g,X,this._oneTimeListeners),X.call(this,s)}var ie=this._eventedParent;ie&&(et(s,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),ie.fire(s))}else s instanceof me&&console.error(s.error);return this},ve.prototype.listens=function(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)},ve.prototype.setEventedParent=function(s,h){return this._eventedParent=s,this._eventedParentData=h,this};var pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Se=function(s,h,g,S){this.message=(s?s+": ":"")+g,S&&(this.identifier=S),null!=h&&h.__line__&&(this.line=h.__line__)};function He(s){var h=s.value;return h?[new Se(s.key,h,"constants have been deprecated as of v8")]:[]}function Ze(s){for(var h=[],g=arguments.length-1;g-- >0;)h[g]=arguments[g+1];for(var S=0,k=h;S<k.length;S+=1){var N=k[S];for(var q in N)s[q]=N[q]}return s}function Be(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function lt(s){if(Array.isArray(s))return s.map(lt);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){var h={};for(var g in s)h[g]=lt(s[g]);return h}return Be(s)}var Rt=function(s){function h(g,S){s.call(this,S),this.message=S,this.key=g}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h}(Error),xt=function(s,h){void 0===h&&(h=[]),this.parent=s,this.bindings={};for(var g=0,S=h;g<S.length;g+=1){var k=S[g];this.bindings[k[0]]=k[1]}};xt.prototype.concat=function(s){return new xt(this,s)},xt.prototype.get=function(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(s+" not found in scope.")},xt.prototype.has=function(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)};var Xt={kind:"null"},mt={kind:"number"},Je={kind:"string"},ot={kind:"boolean"},On={kind:"color"},Bn={kind:"object"},sn={kind:"value"},br={kind:"collator"},Ft={kind:"formatted"},mr={kind:"resolvedImage"};function or(s,h){return{kind:"array",itemType:s,N:h}}function qt(s){if("array"===s.kind){var h=qt(s.itemType);return"number"==typeof s.N?"array<"+h+", "+s.N+">":"value"===s.itemType.kind?"array":"array<"+h+">"}return s.kind}var ur=[Xt,mt,Je,ot,On,Ft,Bn,or(sn),mr];function wn(s,h){if("error"===h.kind)return null;if("array"===s.kind){if("array"===h.kind&&(0===h.N&&"value"===h.itemType.kind||!wn(s.itemType,h.itemType))&&("number"!=typeof s.N||s.N===h.N))return null}else{if(s.kind===h.kind)return null;if("value"===s.kind)for(var g=0,S=ur;g<S.length;g+=1)if(!wn(S[g],h))return null}return"Expected "+qt(s)+" but found "+qt(h)+" instead."}function ri(s,h){return h.some(function(g){return g.kind===s.kind})}function Yr(s,h){return h.some(function(g){return"null"===g?null===s:"array"===g?Array.isArray(s):"object"===g?s&&!Array.isArray(s)&&"object"==typeof s:g===typeof s})}var lr=C(function(s,h){var g={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function S(X){return(X=Math.round(X))<0?0:X>255?255:X}function k(X){return S("%"===X[X.length-1]?parseFloat(X)/100*255:parseInt(X))}function N(X){return(ie="%"===X[X.length-1]?parseFloat(X)/100:parseFloat(X))<0?0:ie>1?1:ie;var ie}function q(X,ie,ce){return ce<0?ce+=1:ce>1&&(ce-=1),6*ce<1?X+(ie-X)*ce*6:2*ce<1?ie:3*ce<2?X+(ie-X)*(2/3-ce)*6:X}try{h.parseCSSColor=function(X){var ie,ce=X.replace(/ /g,"").toLowerCase();if(ce in g)return g[ce].slice();if("#"===ce[0])return 4===ce.length?(ie=parseInt(ce.substr(1),16))>=0&&ie<=4095?[(3840&ie)>>4|(3840&ie)>>8,240&ie|(240&ie)>>4,15&ie|(15&ie)<<4,1]:null:7===ce.length&&(ie=parseInt(ce.substr(1),16))>=0&&ie<=16777215?[(16711680&ie)>>16,(65280&ie)>>8,255&ie,1]:null;var ye=ce.indexOf("("),_e=ce.indexOf(")");if(-1!==ye&&_e+1===ce.length){var Ae=ce.substr(0,ye),ze=ce.substr(ye+1,_e-(ye+1)).split(","),Xe=1;switch(Ae){case"rgba":if(4!==ze.length)return null;Xe=N(ze.pop());case"rgb":return 3!==ze.length?null:[k(ze[0]),k(ze[1]),k(ze[2]),Xe];case"hsla":if(4!==ze.length)return null;Xe=N(ze.pop());case"hsl":if(3!==ze.length)return null;var Qe=(parseFloat(ze[0])%360+360)%360/360,pt=N(ze[1]),st=N(ze[2]),St=st<=.5?st*(pt+1):st+pt-st*pt,At=2*st-St;return[S(255*q(At,St,Qe+1/3)),S(255*q(At,St,Qe)),S(255*q(At,St,Qe-1/3)),Xe];default:return null}}return null}}catch(X){}}).parseCSSColor,ni=function(s,h,g,S){void 0===S&&(S=1),this.r=s,this.g=h,this.b=g,this.a=S};ni.parse=function(s){if(s){if(s instanceof ni)return s;if("string"==typeof s){var h=lr(s);if(h)return new ni(h[0]/255*h[3],h[1]/255*h[3],h[2]/255*h[3],h[3])}}},ni.prototype.toString=function(){var s=this.toArray(),h=s[1],g=s[2],S=s[3];return"rgba("+Math.round(s[0])+","+Math.round(h)+","+Math.round(g)+","+S+")"},ni.prototype.toArray=function(){var s=this.a;return 0===s?[0,0,0,0]:[255*this.r/s,255*this.g/s,255*this.b/s,s]},ni.black=new ni(0,0,0,1),ni.white=new ni(1,1,1,1),ni.transparent=new ni(0,0,0,0),ni.red=new ni(1,0,0,1);var Kr=function(s,h,g){this.sensitivity=s?h?"variant":"case":h?"accent":"base",this.locale=g,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Kr.prototype.compare=function(s,h){return this.collator.compare(s,h)},Kr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var yo=function(s,h,g,S,k){this.text=s,this.image=h,this.scale=g,this.fontStack=S,this.textColor=k},Ro=function(s){this.sections=s};Ro.fromString=function(s){return new Ro([new yo(s,null,null,null,null)])},Ro.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some(function(s){return 0!==s.text.length||s.image&&0!==s.image.name.length})},Ro.factory=function(s){return s instanceof Ro?s:Ro.fromString(s)},Ro.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map(function(s){return s.text}).join("")},Ro.prototype.serialize=function(){for(var s=["format"],h=0,g=this.sections;h<g.length;h+=1){var S=g[h];if(S.image)s.push(["image",S.image.name]);else{s.push(S.text);var k={};S.fontStack&&(k["text-font"]=["literal",S.fontStack.split(",")]),S.scale&&(k["font-scale"]=S.scale),S.textColor&&(k["text-color"]=["rgba"].concat(S.textColor.toArray())),s.push(k)}}return s};var gi=function(s){this.name=s.name,this.available=s.available};function fi(s,h,g,S){return"number"==typeof s&&s>=0&&s<=255&&"number"==typeof h&&h>=0&&h<=255&&"number"==typeof g&&g>=0&&g<=255?void 0===S||"number"==typeof S&&S>=0&&S<=1?null:"Invalid rgba value ["+[s,h,g,S].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof S?[s,h,g,S]:[s,h,g]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function js(s){if(null===s||"string"==typeof s||"boolean"==typeof s||"number"==typeof s||s instanceof ni||s instanceof Kr||s instanceof Ro||s instanceof gi)return!0;if(Array.isArray(s)){for(var h=0,g=s;h<g.length;h+=1)if(!js(g[h]))return!1;return!0}if("object"==typeof s){for(var S in s)if(!js(s[S]))return!1;return!0}return!1}function Ya(s){if(null===s)return Xt;if("string"==typeof s)return Je;if("boolean"==typeof s)return ot;if("number"==typeof s)return mt;if(s instanceof ni)return On;if(s instanceof Kr)return br;if(s instanceof Ro)return Ft;if(s instanceof gi)return mr;if(Array.isArray(s)){for(var h,g=s.length,S=0,k=s;S<k.length;S+=1){var N=Ya(k[S]);if(h){if(h===N)continue;h=sn;break}h=N}return or(h||sn,g)}return Bn}function Fr(s){var h=typeof s;return null===s?"":"string"===h||"number"===h||"boolean"===h?String(s):s instanceof ni||s instanceof Ro||s instanceof gi?s.toString():JSON.stringify(s)}gi.prototype.toString=function(){return this.name},gi.fromString=function(s){return s?new gi({name:s,available:!1}):null},gi.prototype.serialize=function(){return["image",this.name]};var xl=function(s,h){this.type=s,this.value=h};xl.parse=function(s,h){if(2!==s.length)return h.error("'literal' expression requires exactly one argument, but found "+(s.length-1)+" instead.");if(!js(s[1]))return h.error("invalid value");var g=s[1],S=Ya(g),k=h.expectedType;return"array"!==S.kind||0!==S.N||!k||"array"!==k.kind||"number"==typeof k.N&&0!==k.N||(S=k),new xl(S,g)},xl.prototype.evaluate=function(){return this.value},xl.prototype.eachChild=function(){},xl.prototype.outputDefined=function(){return!0},xl.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ni?["rgba"].concat(this.value.toArray()):this.value instanceof Ro?this.value.serialize():this.value};var Oi=function(s){this.name="ExpressionEvaluationError",this.message=s};Oi.prototype.toJSON=function(){return this.message};var Mn={string:Je,number:mt,boolean:ot,object:Bn},Ai=function(s,h){this.type=s,this.args=h};Ai.parse=function(s,h){if(s.length<2)return h.error("Expected at least one argument.");var g,S=1,k=s[0];if("array"===k){var N,q;if(s.length>2){var X=s[1];if("string"!=typeof X||!(X in Mn)||"object"===X)return h.error('The item type argument of "array" must be one of string, number, boolean',1);N=Mn[X],S++}else N=sn;if(s.length>3){if(null!==s[2]&&("number"!=typeof s[2]||s[2]<0||s[2]!==Math.floor(s[2])))return h.error('The length argument to "array" must be a positive integer literal',2);q=s[2],S++}g=or(N,q)}else g=Mn[k];for(var ie=[];S<s.length;S++){var ce=h.parse(s[S],S,sn);if(!ce)return null;ie.push(ce)}return new Ai(g,ie)},Ai.prototype.evaluate=function(s){for(var h=0;h<this.args.length;h++){var g=this.args[h].evaluate(s);if(!wn(this.type,Ya(g)))return g;if(h===this.args.length-1)throw new Oi("Expected value to be of type "+qt(this.type)+", but found "+qt(Ya(g))+" instead.")}return null},Ai.prototype.eachChild=function(s){this.args.forEach(s)},Ai.prototype.outputDefined=function(){return this.args.every(function(s){return s.outputDefined()})},Ai.prototype.serialize=function(){var s=this.type,h=[s.kind];if("array"===s.kind){var g=s.itemType;if("string"===g.kind||"number"===g.kind||"boolean"===g.kind){h.push(g.kind);var S=s.N;("number"==typeof S||this.args.length>1)&&h.push(S)}}return h.concat(this.args.map(function(k){return k.serialize()}))};var ls=function(s){this.type=Ft,this.sections=s};ls.parse=function(s,h){if(s.length<2)return h.error("Expected at least one argument.");var g=s[1];if(!Array.isArray(g)&&"object"==typeof g)return h.error("First argument must be an image or text section.");for(var S=[],k=!1,N=1;N<=s.length-1;++N){var q=s[N];if(k&&"object"==typeof q&&!Array.isArray(q)){k=!1;var X=null;if(q["font-scale"]&&!(X=h.parse(q["font-scale"],1,mt)))return null;var ie=null;if(q["text-font"]&&!(ie=h.parse(q["text-font"],1,or(Je))))return null;var ce=null;if(q["text-color"]&&!(ce=h.parse(q["text-color"],1,On)))return null;var ye=S[S.length-1];ye.scale=X,ye.font=ie,ye.textColor=ce}else{var _e=h.parse(s[N],1,sn);if(!_e)return null;var Ae=_e.type.kind;if("string"!==Ae&&"value"!==Ae&&"null"!==Ae&&"resolvedImage"!==Ae)return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");k=!0,S.push({content:_e,scale:null,font:null,textColor:null})}}return new ls(S)},ls.prototype.evaluate=function(s){return new Ro(this.sections.map(function(h){var g=h.content.evaluate(s);return Ya(g)===mr?new yo("",g,null,null,null):new yo(Fr(g),null,h.scale?h.scale.evaluate(s):null,h.font?h.font.evaluate(s).join(","):null,h.textColor?h.textColor.evaluate(s):null)}))},ls.prototype.eachChild=function(s){for(var h=0,g=this.sections;h<g.length;h+=1){var S=g[h];s(S.content),S.scale&&s(S.scale),S.font&&s(S.font),S.textColor&&s(S.textColor)}},ls.prototype.outputDefined=function(){return!1},ls.prototype.serialize=function(){for(var s=["format"],h=0,g=this.sections;h<g.length;h+=1){var S=g[h];s.push(S.content.serialize());var k={};S.scale&&(k["font-scale"]=S.scale.serialize()),S.font&&(k["text-font"]=S.font.serialize()),S.textColor&&(k["text-color"]=S.textColor.serialize()),s.push(k)}return s};var ga=function(s){this.type=mr,this.input=s};ga.parse=function(s,h){if(2!==s.length)return h.error("Expected two arguments.");var g=h.parse(s[1],1,Je);return g?new ga(g):h.error("No image name provided.")},ga.prototype.evaluate=function(s){var h=this.input.evaluate(s),g=gi.fromString(h);return g&&s.availableImages&&(g.available=s.availableImages.indexOf(h)>-1),g},ga.prototype.eachChild=function(s){s(this.input)},ga.prototype.outputDefined=function(){return!1},ga.prototype.serialize=function(){return["image",this.input.serialize()]};var $o={"to-boolean":ot,"to-color":On,"to-number":mt,"to-string":Je},Ts=function(s,h){this.type=s,this.args=h};Ts.parse=function(s,h){if(s.length<2)return h.error("Expected at least one argument.");var g=s[0];if(("to-boolean"===g||"to-string"===g)&&2!==s.length)return h.error("Expected one argument.");for(var S=$o[g],k=[],N=1;N<s.length;N++){var q=h.parse(s[N],N,sn);if(!q)return null;k.push(q)}return new Ts(S,k)},Ts.prototype.evaluate=function(s){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(s));if("color"===this.type.kind){for(var h,g,S=0,k=this.args;S<k.length;S+=1){if(g=null,(h=k[S].evaluate(s))instanceof ni)return h;if("string"==typeof h){var N=s.parseColor(h);if(N)return N}else if(Array.isArray(h)&&!(g=h.length<3||h.length>4?"Invalid rbga value "+JSON.stringify(h)+": expected an array containing either three or four numeric values.":fi(h[0],h[1],h[2],h[3])))return new ni(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new Oi(g||"Could not parse color from value '"+("string"==typeof h?h:String(JSON.stringify(h)))+"'")}if("number"===this.type.kind){for(var q=null,X=0,ie=this.args;X<ie.length;X+=1){if(null===(q=ie[X].evaluate(s)))return 0;var ce=Number(q);if(!isNaN(ce))return ce}throw new Oi("Could not convert "+JSON.stringify(q)+" to number.")}return"formatted"===this.type.kind?Ro.fromString(Fr(this.args[0].evaluate(s))):"resolvedImage"===this.type.kind?gi.fromString(Fr(this.args[0].evaluate(s))):Fr(this.args[0].evaluate(s))},Ts.prototype.eachChild=function(s){this.args.forEach(s)},Ts.prototype.outputDefined=function(){return this.args.every(function(s){return s.outputDefined()})},Ts.prototype.serialize=function(){if("formatted"===this.type.kind)return new ls([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ga(this.args[0]).serialize();var s=["to-"+this.type.kind];return this.eachChild(function(h){s.push(h.serialize())}),s};var Ka=["Unknown","Point","LineString","Polygon"],xi=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};xi.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},xi.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?Ka[this.feature.type]:this.feature.type:null},xi.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},xi.prototype.canonicalID=function(){return this.canonical},xi.prototype.properties=function(){return this.feature&&this.feature.properties||{}},xi.prototype.parseColor=function(s){var h=this._parseColorCache[s];return h||(h=this._parseColorCache[s]=ni.parse(s)),h};var ua=function(s,h,g,S){this.name=s,this.type=h,this._evaluate=g,this.args=S};ua.prototype.evaluate=function(s){return this._evaluate(s,this.args)},ua.prototype.eachChild=function(s){this.args.forEach(s)},ua.prototype.outputDefined=function(){return!1},ua.prototype.serialize=function(){return[this.name].concat(this.args.map(function(s){return s.serialize()}))},ua.parse=function(s,h){var g,S=s[0],k=ua.definitions[S];if(!k)return h.error('Unknown expression "'+S+'". If you wanted a literal array, use ["literal", [...]].',0);for(var N=Array.isArray(k)?k[0]:k.type,q=Array.isArray(k)?[[k[1],k[2]]]:k.overloads,X=q.filter(function(Dr){var Yn=Dr[0];return!Array.isArray(Yn)||Yn.length===s.length-1}),ie=null,ce=0,ye=X;ce<ye.length;ce+=1){var _e=ye[ce],Ae=_e[0],ze=_e[1];ie=new Dc(h.registry,h.path,null,h.scope);for(var Xe=[],Qe=!1,pt=1;pt<s.length;pt++){var st=s[pt],St=Array.isArray(Ae)?Ae[pt-1]:Ae.type,At=ie.parse(st,1+Xe.length,St);if(!At){Qe=!0;break}Xe.push(At)}if(!Qe)if(Array.isArray(Ae)&&Ae.length!==Xe.length)ie.error("Expected "+Ae.length+" arguments, but found "+Xe.length+" instead.");else{for(var Lt=0;Lt<Xe.length;Lt++){var zt=Array.isArray(Ae)?Ae[Lt]:Ae.type,nn=Xe[Lt];ie.concat(Lt+1).checkSubtype(zt,nn.type)}if(0===ie.errors.length)return new ua(S,N,ze,Xe)}}if(1===X.length)(g=h.errors).push.apply(g,ie.errors);else{for(var An=(X.length?X:q).map(function(Dr){var Yn;return Yn=Dr[0],Array.isArray(Yn)?"("+Yn.map(qt).join(", ")+")":"("+qt(Yn.type)+"...)"}).join(" | "),zn=[],_r=1;_r<s.length;_r++){var Gn=h.parse(s[_r],1+zn.length);if(!Gn)return null;zn.push(qt(Gn.type))}h.error("Expected arguments of type "+An+", but found ("+zn.join(", ")+") instead.")}return null},ua.register=function(s,h){for(var g in ua.definitions=h,h)s[g]=ua};var no=function(s,h,g){this.type=br,this.locale=g,this.caseSensitive=s,this.diacriticSensitive=h};function ro(s,h){s[0]=Math.min(s[0],h[0]),s[1]=Math.min(s[1],h[1]),s[2]=Math.max(s[2],h[0]),s[3]=Math.max(s[3],h[1])}function xh(s,h){return!(s[0]<=h[0]||s[2]>=h[2]||s[1]<=h[1]||s[3]>=h[3])}function Ac(s,h){var g=(180+s[0])/360,S=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,k=Math.pow(2,h.z);return[Math.round(g*k*8192),Math.round(S*k*8192)]}function ec(s,h,g){return h[1]>s[1]!=g[1]>s[1]&&s[0]<(g[0]-h[0])*(s[1]-h[1])/(g[1]-h[1])+h[0]}function kp(s,h){for(var g,S,k,N,q,X,ie,ce=!1,ye=0,_e=h.length;ye<_e;ye++)for(var Ae=h[ye],ze=0,Xe=Ae.length;ze<Xe-1;ze++){if((N=(g=s)[0]-(S=Ae[ze])[0])*(ie=g[1]-(k=Ae[ze+1])[1])-(X=g[0]-k[0])*(q=g[1]-S[1])==0&&N*X<=0&&q*ie<=0)return!1;ec(s,Ae[ze],Ae[ze+1])&&(ce=!ce)}return ce}function sf(s,h){for(var g=0;g<h.length;g++)if(kp(s,h[g]))return!0;return!1}function Us(s,h,g,S){var k=S[0]-g[0],N=S[1]-g[1],q=(s[0]-g[0])*N-k*(s[1]-g[1]),X=(h[0]-g[0])*N-k*(h[1]-g[1]);return q>0&&X<0||q<0&&X>0}function Uf(s,h,g){for(var S=0,k=g;S<k.length;S+=1)for(var N=k[S],q=0;q<N.length-1;++q)if((_e=[(ye=N[q+1])[0]-(ce=N[q])[0],ye[1]-ce[1]])[0]*(Ae=[(ie=h)[0]-(X=s)[0],ie[1]-X[1]])[1]-_e[1]*Ae[0]!=0&&Us(X,ie,ce,ye)&&Us(ce,ye,X,ie))return!0;var X,ie,ce,ye,_e,Ae;return!1}function Gh(s,h){for(var g=0;g<s.length;++g)if(!kp(s[g],h))return!1;for(var S=0;S<s.length-1;++S)if(Uf(s[S],s[S+1],h))return!1;return!0}function Yi(s,h){for(var g=0;g<h.length;g++)if(Gh(s,h[g]))return!0;return!1}function Eo(s,h,g){for(var S=[],k=0;k<s.length;k++){for(var N=[],q=0;q<s[k].length;q++){var X=Ac(s[k][q],g);ro(h,X),N.push(X)}S.push(N)}return S}function tc(s,h,g){for(var S=[],k=0;k<s.length;k++){var N=Eo(s[k],h,g);S.push(N)}return S}function Sd(s,h,g,S){if(s[0]<g[0]||s[0]>g[2]){var k=.5*S,N=s[0]-g[0]>k?-S:g[0]-s[0]>k?S:0;0===N&&(N=s[0]-g[2]>k?-S:g[2]-s[0]>k?S:0),s[0]+=N}ro(h,s)}function eh(s,h,g,S){for(var k=8192*Math.pow(2,S.z),N=[8192*S.x,8192*S.y],q=[],X=0,ie=s;X<ie.length;X+=1)for(var ce=0,ye=ie[X];ce<ye.length;ce+=1){var _e=ye[ce],Ae=[_e.x+N[0],_e.y+N[1]];Sd(Ae,h,g,k),q.push(Ae)}return q}function Hr(s,h,g,S){for(var k,N=8192*Math.pow(2,S.z),q=[8192*S.x,8192*S.y],X=[],ie=0,ce=s;ie<ce.length;ie+=1){for(var ye=[],_e=0,Ae=ce[ie];_e<Ae.length;_e+=1){var ze=Ae[_e],Xe=[ze.x+q[0],ze.y+q[1]];ro(h,Xe),ye.push(Xe)}X.push(ye)}if(h[2]-h[0]<=N/2){(k=h)[0]=k[1]=1/0,k[2]=k[3]=-1/0;for(var Qe=0,pt=X;Qe<pt.length;Qe+=1)for(var st=0,St=pt[Qe];st<St.length;st+=1)Sd(St[st],h,g,N)}return X}no.parse=function(s,h){if(2!==s.length)return h.error("Expected one argument.");var g=s[1];if("object"!=typeof g||Array.isArray(g))return h.error("Collator options argument must be an object.");var S=h.parse(void 0!==g["case-sensitive"]&&g["case-sensitive"],1,ot);if(!S)return null;var k=h.parse(void 0!==g["diacritic-sensitive"]&&g["diacritic-sensitive"],1,ot);if(!k)return null;var N=null;return g.locale&&!(N=h.parse(g.locale,1,Je))?null:new no(S,k,N)},no.prototype.evaluate=function(s){return new Kr(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)},no.prototype.eachChild=function(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)},no.prototype.outputDefined=function(){return!1},no.prototype.serialize=function(){var s={};return s["case-sensitive"]=this.caseSensitive.serialize(),s["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(s.locale=this.locale.serialize()),["collator",s]};var Ql=function(s,h){this.type=ot,this.geojson=s,this.geometries=h};function io(s){if(s instanceof ua&&("get"===s.name&&1===s.args.length||"feature-state"===s.name||"has"===s.name&&1===s.args.length||"properties"===s.name||"geometry-type"===s.name||"id"===s.name||/^filter-/.test(s.name))||s instanceof Ql)return!1;var h=!0;return s.eachChild(function(g){h&&!io(g)&&(h=!1)}),h}function Fl(s){if(s instanceof ua&&"feature-state"===s.name)return!1;var h=!0;return s.eachChild(function(g){h&&!Fl(g)&&(h=!1)}),h}function up(s,h){if(s instanceof ua&&h.indexOf(s.name)>=0)return!1;var g=!0;return s.eachChild(function(S){g&&!up(S,h)&&(g=!1)}),g}Ql.parse=function(s,h){if(2!==s.length)return h.error("'within' expression requires exactly one argument, but found "+(s.length-1)+" instead.");if(js(s[1])){var g=s[1];if("FeatureCollection"===g.type)for(var S=0;S<g.features.length;++S){var k=g.features[S].geometry.type;if("Polygon"===k||"MultiPolygon"===k)return new Ql(g,g.features[S].geometry)}else if("Feature"===g.type){var N=g.geometry.type;if("Polygon"===N||"MultiPolygon"===N)return new Ql(g,g.geometry)}else if("Polygon"===g.type||"MultiPolygon"===g.type)return new Ql(g,g)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Ql.prototype.evaluate=function(s){if(null!=s.geometry()&&null!=s.canonicalID()){if("Point"===s.geometryType())return function(h,g){var S=[1/0,1/0,-1/0,-1/0],k=[1/0,1/0,-1/0,-1/0],N=h.canonicalID();if("Polygon"===g.type){var q=Eo(g.coordinates,k,N),X=eh(h.geometry(),S,k,N);if(!xh(S,k))return!1;for(var ie=0,ce=X;ie<ce.length;ie+=1)if(!kp(ce[ie],q))return!1}if("MultiPolygon"===g.type){var ye=tc(g.coordinates,k,N),_e=eh(h.geometry(),S,k,N);if(!xh(S,k))return!1;for(var Ae=0,ze=_e;Ae<ze.length;Ae+=1)if(!sf(ze[Ae],ye))return!1}return!0}(s,this.geometries);if("LineString"===s.geometryType())return function(h,g){var S=[1/0,1/0,-1/0,-1/0],k=[1/0,1/0,-1/0,-1/0],N=h.canonicalID();if("Polygon"===g.type){var q=Eo(g.coordinates,k,N),X=Hr(h.geometry(),S,k,N);if(!xh(S,k))return!1;for(var ie=0,ce=X;ie<ce.length;ie+=1)if(!Gh(ce[ie],q))return!1}if("MultiPolygon"===g.type){var ye=tc(g.coordinates,k,N),_e=Hr(h.geometry(),S,k,N);if(!xh(S,k))return!1;for(var Ae=0,ze=_e;Ae<ze.length;Ae+=1)if(!Yi(ze[Ae],ye))return!1}return!0}(s,this.geometries)}return!1},Ql.prototype.eachChild=function(){},Ql.prototype.outputDefined=function(){return!0},Ql.prototype.serialize=function(){return["within",this.geojson]};var bh=function(s,h){this.type=h.type,this.name=s,this.boundExpression=h};bh.parse=function(s,h){if(2!==s.length||"string"!=typeof s[1])return h.error("'var' expression requires exactly one string literal argument.");var g=s[1];return h.scope.has(g)?new bh(g,h.scope.get(g)):h.error('Unknown variable "'+g+'". Make sure "'+g+'" has been bound in an enclosing "let" expression before using it.',1)},bh.prototype.evaluate=function(s){return this.boundExpression.evaluate(s)},bh.prototype.eachChild=function(){},bh.prototype.outputDefined=function(){return!1},bh.prototype.serialize=function(){return["var",this.name]};var Dc=function(s,h,g,S,k){void 0===h&&(h=[]),void 0===S&&(S=new xt),void 0===k&&(k=[]),this.registry=s,this.path=h,this.key=h.map(function(N){return"["+N+"]"}).join(""),this.scope=S,this.errors=k,this.expectedType=g};function kc(s,h){for(var g,S=s.length-1,k=0,N=S,q=0;k<=N;)if((g=s[q=Math.floor((k+N)/2)])<=h){if(q===S||h<s[q+1])return q;k=q+1}else{if(!(g>h))throw new Oi("Input is not a number.");N=q-1}return 0}Dc.prototype.parse=function(s,h,g,S,k){return void 0===k&&(k={}),h?this.concat(h,g,S)._parse(s,k):this._parse(s,k)},Dc.prototype._parse=function(s,h){function g(ce,ye,_e){return"assert"===_e?new Ai(ye,[ce]):"coerce"===_e?new Ts(ye,[ce]):ce}if(null!==s&&"string"!=typeof s&&"boolean"!=typeof s&&"number"!=typeof s||(s=["literal",s]),Array.isArray(s)){if(0===s.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var S=s[0];if("string"!=typeof S)return this.error("Expression name must be a string, but found "+typeof S+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var k=this.registry[S];if(k){var N=k.parse(s,this);if(!N)return null;if(this.expectedType){var q=this.expectedType,X=N.type;if("string"!==q.kind&&"number"!==q.kind&&"boolean"!==q.kind&&"object"!==q.kind&&"array"!==q.kind||"value"!==X.kind)if("color"!==q.kind&&"formatted"!==q.kind&&"resolvedImage"!==q.kind||"value"!==X.kind&&"string"!==X.kind){if(this.checkSubtype(q,X))return null}else N=g(N,q,h.typeAnnotation||"coerce");else N=g(N,q,h.typeAnnotation||"assert")}if(!(N instanceof xl)&&"resolvedImage"!==N.type.kind&&function ce(ye){if(ye instanceof bh)return ce(ye.boundExpression);if(ye instanceof ua&&"error"===ye.name||ye instanceof no||ye instanceof Ql)return!1;var _e=ye instanceof Ts||ye instanceof Ai,Ae=!0;return ye.eachChild(function(ze){Ae=_e?Ae&&ce(ze):Ae&&ze instanceof xl}),!!Ae&&io(ye)&&up(ye,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(N)){var ie=new xi;try{N=new xl(N.type,N.evaluate(ie))}catch(ce){return this.error(ce.message),null}}return N}return this.error('Unknown expression "'+S+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(void 0===s?"'undefined' value invalid. Use null instead.":"object"==typeof s?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof s+" instead.")},Dc.prototype.concat=function(s,h,g){var S="number"==typeof s?this.path.concat(s):this.path,k=g?this.scope.concat(g):this.scope;return new Dc(this.registry,S,h||null,k,this.errors)},Dc.prototype.error=function(s){for(var h=[],g=arguments.length-1;g-- >0;)h[g]=arguments[g+1];var S=""+this.key+h.map(function(k){return"["+k+"]"}).join("");this.errors.push(new Rt(S,s))},Dc.prototype.checkSubtype=function(s,h){var g=wn(s,h);return g&&this.error(g),g};var wa=function(s,h,g){this.type=s,this.input=h,this.labels=[],this.outputs=[];for(var S=0,k=g;S<k.length;S+=1){var N=k[S],q=N[1];this.labels.push(N[0]),this.outputs.push(q)}};function ca(s,h,g){return s*(1-g)+h*g}wa.parse=function(s,h){if(s.length-1<4)return h.error("Expected at least 4 arguments, but found only "+(s.length-1)+".");if((s.length-1)%2!=0)return h.error("Expected an even number of arguments.");var g=h.parse(s[1],1,mt);if(!g)return null;var S=[],k=null;h.expectedType&&"value"!==h.expectedType.kind&&(k=h.expectedType);for(var N=1;N<s.length;N+=2){var q=1===N?-1/0:s[N],X=s[N+1],ie=N,ce=N+1;if("number"!=typeof q)return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ie);if(S.length&&S[S.length-1][0]>=q)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',ie);var ye=h.parse(X,ce,k);if(!ye)return null;k=k||ye.type,S.push([q,ye])}return new wa(k,g,S)},wa.prototype.evaluate=function(s){var h=this.labels,g=this.outputs;if(1===h.length)return g[0].evaluate(s);var S=this.input.evaluate(s);if(S<=h[0])return g[0].evaluate(s);var k=h.length;return S>=h[k-1]?g[k-1].evaluate(s):g[kc(h,S)].evaluate(s)},wa.prototype.eachChild=function(s){s(this.input);for(var h=0,g=this.outputs;h<g.length;h+=1)s(g[h])},wa.prototype.outputDefined=function(){return this.outputs.every(function(s){return s.outputDefined()})},wa.prototype.serialize=function(){for(var s=["step",this.input.serialize()],h=0;h<this.labels.length;h++)h>0&&s.push(this.labels[h]),s.push(this.outputs[h].serialize());return s};var qh=Object.freeze({__proto__:null,number:ca,color:function(s,h,g){return new ni(ca(s.r,h.r,g),ca(s.g,h.g,g),ca(s.b,h.b,g),ca(s.a,h.a,g))},array:function(s,h,g){return s.map(function(S,k){return ca(S,h[k],g)})}}),wh=6/29*3*(6/29),oi=Math.PI/180,nc=180/Math.PI;function Ch(s){return s>.008856451679035631?Math.pow(s,1/3):s/wh+4/29}function eu(s){return s>6/29?s*s*s:wh*(s-4/29)}function Li(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Pp(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Bu(s){var h=Pp(s.r),g=Pp(s.g),S=Pp(s.b),k=Ch((.4124564*h+.3575761*g+.1804375*S)/.95047),N=Ch((.2126729*h+.7151522*g+.072175*S)/1);return{l:116*N-16,a:500*(k-N),b:200*(N-Ch((.0193339*h+.119192*g+.9503041*S)/1.08883)),alpha:s.a}}function Is(s){var h=(s.l+16)/116,g=isNaN(s.a)?h:h+s.a/500,S=isNaN(s.b)?h:h-s.b/200;return h=1*eu(h),g=.95047*eu(g),S=1.08883*eu(S),new ni(Li(3.2404542*g-1.5371385*h-.4985314*S),Li(-.969266*g+1.8760108*h+.041556*S),Li(.0556434*g-.2040259*h+1.0572252*S),s.alpha)}function Eh(s,h,g){var S=h-s;return s+g*(S>180||S<-180?S-360*Math.round(S/360):S)}var rc={forward:Bu,reverse:Is,interpolate:function(s,h,g){return{l:ca(s.l,h.l,g),a:ca(s.a,h.a,g),b:ca(s.b,h.b,g),alpha:ca(s.alpha,h.alpha,g)}}},ii={forward:function(s){var h=Bu(s),g=h.l,S=h.a,k=h.b,N=Math.atan2(k,S)*nc;return{h:N<0?N+360:N,c:Math.sqrt(S*S+k*k),l:g,alpha:s.a}},reverse:function(s){var h=s.h*oi,g=s.c;return Is({l:s.l,a:Math.cos(h)*g,b:Math.sin(h)*g,alpha:s.alpha})},interpolate:function(s,h,g){return{h:Eh(s.h,h.h,g),c:ca(s.c,h.c,g),l:ca(s.l,h.l,g),alpha:ca(s.alpha,h.alpha,g)}}},th=Object.freeze({__proto__:null,lab:rc,hcl:ii}),ka=function(s,h,g,S,k){this.type=s,this.operator=h,this.interpolation=g,this.input=S,this.labels=[],this.outputs=[];for(var N=0,q=k;N<q.length;N+=1){var X=q[N],ie=X[1];this.labels.push(X[0]),this.outputs.push(ie)}};function Zh(s,h,g,S){var k=S-g,N=s-g;return 0===k?0:1===h?N/k:(Math.pow(h,N)-1)/(Math.pow(h,k)-1)}ka.interpolationFactor=function(s,h,g,S){var k=0;if("exponential"===s.name)k=Zh(h,s.base,g,S);else if("linear"===s.name)k=Zh(h,1,g,S);else if("cubic-bezier"===s.name){var N=s.controlPoints;k=new ut(N[0],N[1],N[2],N[3]).solve(Zh(h,1,g,S))}return k},ka.parse=function(s,h){var g=s[0],S=s[1],k=s[2],N=s.slice(3);if(!Array.isArray(S)||0===S.length)return h.error("Expected an interpolation type expression.",1);if("linear"===S[0])S={name:"linear"};else if("exponential"===S[0]){var q=S[1];if("number"!=typeof q)return h.error("Exponential interpolation requires a numeric base.",1,1);S={name:"exponential",base:q}}else{if("cubic-bezier"!==S[0])return h.error("Unknown interpolation type "+String(S[0]),1,0);var X=S.slice(1);if(4!==X.length||X.some(function(pt){return"number"!=typeof pt||pt<0||pt>1}))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);S={name:"cubic-bezier",controlPoints:X}}if(s.length-1<4)return h.error("Expected at least 4 arguments, but found only "+(s.length-1)+".");if((s.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(!(k=h.parse(k,2,mt)))return null;var ie=[],ce=null;"interpolate-hcl"===g||"interpolate-lab"===g?ce=On:h.expectedType&&"value"!==h.expectedType.kind&&(ce=h.expectedType);for(var ye=0;ye<N.length;ye+=2){var _e=N[ye],Ae=N[ye+1],ze=ye+3,Xe=ye+4;if("number"!=typeof _e)return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ze);if(ie.length&&ie[ie.length-1][0]>=_e)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ze);var Qe=h.parse(Ae,Xe,ce);if(!Qe)return null;ce=ce||Qe.type,ie.push([_e,Qe])}return"number"===ce.kind||"color"===ce.kind||"array"===ce.kind&&"number"===ce.itemType.kind&&"number"==typeof ce.N?new ka(ce,g,S,k,ie):h.error("Type "+qt(ce)+" is not interpolatable.")},ka.prototype.evaluate=function(s){var h=this.labels,g=this.outputs;if(1===h.length)return g[0].evaluate(s);var S=this.input.evaluate(s);if(S<=h[0])return g[0].evaluate(s);var k=h.length;if(S>=h[k-1])return g[k-1].evaluate(s);var N=kc(h,S),q=ka.interpolationFactor(this.interpolation,S,h[N],h[N+1]),X=g[N].evaluate(s),ie=g[N+1].evaluate(s);return"interpolate"===this.operator?qh[this.type.kind.toLowerCase()](X,ie,q):"interpolate-hcl"===this.operator?ii.reverse(ii.interpolate(ii.forward(X),ii.forward(ie),q)):rc.reverse(rc.interpolate(rc.forward(X),rc.forward(ie),q))},ka.prototype.eachChild=function(s){s(this.input);for(var h=0,g=this.outputs;h<g.length;h+=1)s(g[h])},ka.prototype.outputDefined=function(){return this.outputs.every(function(s){return s.outputDefined()})},ka.prototype.serialize=function(){var s;s="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var h=[this.operator,s,this.input.serialize()],g=0;g<this.labels.length;g++)h.push(this.labels[g],this.outputs[g].serialize());return h};var ic=function(s,h){this.type=s,this.args=h};ic.parse=function(s,h){if(s.length<2)return h.error("Expectected at least one argument.");var g=null,S=h.expectedType;S&&"value"!==S.kind&&(g=S);for(var k=[],N=0,q=s.slice(1);N<q.length;N+=1){var X=h.parse(q[N],1+k.length,g,void 0,{typeAnnotation:"omit"});if(!X)return null;g=g||X.type,k.push(X)}var ie=S&&k.some(function(ce){return wn(S,ce.type)});return new ic(ie?sn:g,k)},ic.prototype.evaluate=function(s){for(var h,g=null,S=0,k=0,N=this.args;k<N.length&&(S++,(g=N[k].evaluate(s))&&g instanceof gi&&!g.available&&(h||(h=g.name),g=null,S===this.args.length&&(g=h)),null===g);k+=1);return g},ic.prototype.eachChild=function(s){this.args.forEach(s)},ic.prototype.outputDefined=function(){return this.args.every(function(s){return s.outputDefined()})},ic.prototype.serialize=function(){var s=["coalesce"];return this.eachChild(function(h){s.push(h.serialize())}),s};var Di=function(s,h){this.type=h.type,this.bindings=[].concat(s),this.result=h};Di.prototype.evaluate=function(s){return this.result.evaluate(s)},Di.prototype.eachChild=function(s){for(var h=0,g=this.bindings;h<g.length;h+=1)s(g[h][1]);s(this.result)},Di.parse=function(s,h){if(s.length<4)return h.error("Expected at least 3 arguments, but found "+(s.length-1)+" instead.");for(var g=[],S=1;S<s.length-1;S+=2){var k=s[S];if("string"!=typeof k)return h.error("Expected string, but found "+typeof k+" instead.",S);if(/[^a-zA-Z0-9_]/.test(k))return h.error("Variable names must contain only alphanumeric characters or '_'.",S);var N=h.parse(s[S+1],S+1);if(!N)return null;g.push([k,N])}var q=h.parse(s[s.length-1],s.length-1,h.expectedType,g);return q?new Di(g,q):null},Di.prototype.outputDefined=function(){return this.result.outputDefined()},Di.prototype.serialize=function(){for(var s=["let"],h=0,g=this.bindings;h<g.length;h+=1){var S=g[h];s.push(S[0],S[1].serialize())}return s.push(this.result.serialize()),s};var Sh=function(s,h,g){this.type=s,this.index=h,this.input=g};Sh.parse=function(s,h){if(3!==s.length)return h.error("Expected 2 arguments, but found "+(s.length-1)+" instead.");var g=h.parse(s[1],1,mt),S=h.parse(s[2],2,or(h.expectedType||sn));return g&&S?new Sh(S.type.itemType,g,S):null},Sh.prototype.evaluate=function(s){var h=this.index.evaluate(s),g=this.input.evaluate(s);if(h<0)throw new Oi("Array index out of bounds: "+h+" < 0.");if(h>=g.length)throw new Oi("Array index out of bounds: "+h+" > "+(g.length-1)+".");if(h!==Math.floor(h))throw new Oi("Array index must be an integer, but found "+h+" instead.");return g[h]},Sh.prototype.eachChild=function(s){s(this.index),s(this.input)},Sh.prototype.outputDefined=function(){return!1},Sh.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var oc=function(s,h){this.type=ot,this.needle=s,this.haystack=h};oc.parse=function(s,h){if(3!==s.length)return h.error("Expected 2 arguments, but found "+(s.length-1)+" instead.");var g=h.parse(s[1],1,sn),S=h.parse(s[2],2,sn);return g&&S?ri(g.type,[ot,Je,mt,Xt,sn])?new oc(g,S):h.error("Expected first argument to be of type boolean, string, number or null, but found "+qt(g.type)+" instead"):null},oc.prototype.evaluate=function(s){var h=this.needle.evaluate(s),g=this.haystack.evaluate(s);if(!g)return!1;if(!Yr(h,["boolean","string","number","null"]))throw new Oi("Expected first argument to be of type boolean, string, number or null, but found "+qt(Ya(h))+" instead.");if(!Yr(g,["string","array"]))throw new Oi("Expected second argument to be of type array or string, but found "+qt(Ya(g))+" instead.");return g.indexOf(h)>=0},oc.prototype.eachChild=function(s){s(this.needle),s(this.haystack)},oc.prototype.outputDefined=function(){return!0},oc.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var ya=function(s,h,g){this.type=mt,this.needle=s,this.haystack=h,this.fromIndex=g};ya.parse=function(s,h){if(s.length<=2||s.length>=5)return h.error("Expected 3 or 4 arguments, but found "+(s.length-1)+" instead.");var g=h.parse(s[1],1,sn),S=h.parse(s[2],2,sn);if(!g||!S)return null;if(!ri(g.type,[ot,Je,mt,Xt,sn]))return h.error("Expected first argument to be of type boolean, string, number or null, but found "+qt(g.type)+" instead");if(4===s.length){var k=h.parse(s[3],3,mt);return k?new ya(g,S,k):null}return new ya(g,S)},ya.prototype.evaluate=function(s){var h=this.needle.evaluate(s),g=this.haystack.evaluate(s);if(!Yr(h,["boolean","string","number","null"]))throw new Oi("Expected first argument to be of type boolean, string, number or null, but found "+qt(Ya(h))+" instead.");if(!Yr(g,["string","array"]))throw new Oi("Expected second argument to be of type array or string, but found "+qt(Ya(g))+" instead.");if(this.fromIndex){var S=this.fromIndex.evaluate(s);return g.indexOf(h,S)}return g.indexOf(h)},ya.prototype.eachChild=function(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)},ya.prototype.outputDefined=function(){return!1},ya.prototype.serialize=function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var s=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),s]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var uo=function(s,h,g,S,k,N){this.inputType=s,this.type=h,this.input=g,this.cases=S,this.outputs=k,this.otherwise=N};uo.parse=function(s,h){if(s.length<5)return h.error("Expected at least 4 arguments, but found only "+(s.length-1)+".");if(s.length%2!=1)return h.error("Expected an even number of arguments.");var g,S;h.expectedType&&"value"!==h.expectedType.kind&&(S=h.expectedType);for(var k={},N=[],q=2;q<s.length-1;q+=2){var X=s[q],ie=s[q+1];Array.isArray(X)||(X=[X]);var ce=h.concat(q);if(0===X.length)return ce.error("Expected at least one branch label.");for(var ye=0,_e=X;ye<_e.length;ye+=1){var Ae=_e[ye];if("number"!=typeof Ae&&"string"!=typeof Ae)return ce.error("Branch labels must be numbers or strings.");if("number"==typeof Ae&&Math.abs(Ae)>Number.MAX_SAFE_INTEGER)return ce.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof Ae&&Math.floor(Ae)!==Ae)return ce.error("Numeric branch labels must be integer values.");if(g){if(ce.checkSubtype(g,Ya(Ae)))return null}else g=Ya(Ae);if(void 0!==k[String(Ae)])return ce.error("Branch labels must be unique.");k[String(Ae)]=N.length}var ze=h.parse(ie,q,S);if(!ze)return null;S=S||ze.type,N.push(ze)}var Xe=h.parse(s[1],1,sn);if(!Xe)return null;var Qe=h.parse(s[s.length-1],s.length-1,S);return Qe?"value"!==Xe.type.kind&&h.concat(1).checkSubtype(g,Xe.type)?null:new uo(g,S,Xe,k,N,Qe):null},uo.prototype.evaluate=function(s){var h=this.input.evaluate(s);return(Ya(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(s)},uo.prototype.eachChild=function(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)},uo.prototype.outputDefined=function(){return this.outputs.every(function(s){return s.outputDefined()})&&this.otherwise.outputDefined()},uo.prototype.serialize=function(){for(var s=this,h=["match",this.input.serialize()],g=[],S={},k=0,N=Object.keys(this.cases).sort();k<N.length;k+=1){var q=N[k];void 0===(_e=S[this.cases[q]])?(S[this.cases[q]]=g.length,g.push([this.cases[q],[q]])):g[_e][1].push(q)}for(var X=function(ze){return"number"===s.inputType.kind?Number(ze):ze},ie=0,ce=g;ie<ce.length;ie+=1){var ye=ce[ie],_e=ye[0],Ae=ye[1];h.push(1===Ae.length?X(Ae[0]):Ae.map(X)),h.push(this.outputs[outputIndex$1].serialize())}return h.push(this.otherwise.serialize()),h};var yu=function(s,h,g){this.type=s,this.branches=h,this.otherwise=g};yu.parse=function(s,h){if(s.length<4)return h.error("Expected at least 3 arguments, but found only "+(s.length-1)+".");if(s.length%2!=0)return h.error("Expected an odd number of arguments.");var g;h.expectedType&&"value"!==h.expectedType.kind&&(g=h.expectedType);for(var S=[],k=1;k<s.length-1;k+=2){var N=h.parse(s[k],k,ot);if(!N)return null;var q=h.parse(s[k+1],k+1,g);if(!q)return null;S.push([N,q]),g=g||q.type}var X=h.parse(s[s.length-1],s.length-1,g);return X?new yu(g,S,X):null},yu.prototype.evaluate=function(s){for(var h=0,g=this.branches;h<g.length;h+=1){var S=g[h],k=S[1];if(S[0].evaluate(s))return k.evaluate(s)}return this.otherwise.evaluate(s)},yu.prototype.eachChild=function(s){for(var h=0,g=this.branches;h<g.length;h+=1){var S=g[h],k=S[1];s(S[0]),s(k)}s(this.otherwise)},yu.prototype.outputDefined=function(){return this.branches.every(function(s){return s[1].outputDefined()})&&this.otherwise.outputDefined()},yu.prototype.serialize=function(){var s=["case"];return this.eachChild(function(h){s.push(h.serialize())}),s};var tu=function(s,h,g,S){this.type=s,this.input=h,this.beginIndex=g,this.endIndex=S};function Th(s,h){return"=="===s||"!="===s?"boolean"===h.kind||"string"===h.kind||"number"===h.kind||"null"===h.kind||"value"===h.kind:"string"===h.kind||"number"===h.kind||"value"===h.kind}function Oo(s,h,g,S){return 0===S.compare(h,g)}function bl(s,h,g){var S="=="!==s&&"!="!==s;return function(){function k(N,q,X){this.type=ot,this.lhs=N,this.rhs=q,this.collator=X,this.hasUntypedArgument="value"===N.type.kind||"value"===q.type.kind}return k.parse=function(N,q){if(3!==N.length&&4!==N.length)return q.error("Expected two or three arguments.");var X=N[0],ie=q.parse(N[1],1,sn);if(!ie)return null;if(!Th(X,ie.type))return q.concat(1).error('"'+X+"\" comparisons are not supported for type '"+qt(ie.type)+"'.");var ce=q.parse(N[2],2,sn);if(!ce)return null;if(!Th(X,ce.type))return q.concat(2).error('"'+X+"\" comparisons are not supported for type '"+qt(ce.type)+"'.");if(ie.type.kind!==ce.type.kind&&"value"!==ie.type.kind&&"value"!==ce.type.kind)return q.error("Cannot compare types '"+qt(ie.type)+"' and '"+qt(ce.type)+"'.");S&&("value"===ie.type.kind&&"value"!==ce.type.kind?ie=new Ai(ce.type,[ie]):"value"!==ie.type.kind&&"value"===ce.type.kind&&(ce=new Ai(ie.type,[ce])));var ye=null;if(4===N.length){if("string"!==ie.type.kind&&"string"!==ce.type.kind&&"value"!==ie.type.kind&&"value"!==ce.type.kind)return q.error("Cannot use collator to compare non-string types.");if(!(ye=q.parse(N[3],3,br)))return null}return new k(ie,ce,ye)},k.prototype.evaluate=function(N){var q=this.lhs.evaluate(N),X=this.rhs.evaluate(N);if(S&&this.hasUntypedArgument){var ie=Ya(q),ce=Ya(X);if(ie.kind!==ce.kind||"string"!==ie.kind&&"number"!==ie.kind)throw new Oi('Expected arguments for "'+s+'" to be (string, string) or (number, number), but found ('+ie.kind+", "+ce.kind+") instead.")}if(this.collator&&!S&&this.hasUntypedArgument){var ye=Ya(q),_e=Ya(X);if("string"!==ye.kind||"string"!==_e.kind)return h(N,q,X)}return this.collator?g(N,q,X,this.collator.evaluate(N)):h(N,q,X)},k.prototype.eachChild=function(N){N(this.lhs),N(this.rhs),this.collator&&N(this.collator)},k.prototype.outputDefined=function(){return!0},k.prototype.serialize=function(){var N=[s];return this.eachChild(function(q){N.push(q.serialize())}),N},k}()}tu.parse=function(s,h){if(s.length<=2||s.length>=5)return h.error("Expected 3 or 4 arguments, but found "+(s.length-1)+" instead.");var g=h.parse(s[1],1,sn),S=h.parse(s[2],2,mt);if(!g||!S)return null;if(!ri(g.type,[or(sn),Je,sn]))return h.error("Expected first argument to be of type array or string, but found "+qt(g.type)+" instead");if(4===s.length){var k=h.parse(s[3],3,mt);return k?new tu(g.type,g,S,k):null}return new tu(g.type,g,S)},tu.prototype.evaluate=function(s){var h=this.input.evaluate(s),g=this.beginIndex.evaluate(s);if(!Yr(h,["string","array"]))throw new Oi("Expected first argument to be of type array or string, but found "+qt(Ya(h))+" instead.");if(this.endIndex){var S=this.endIndex.evaluate(s);return h.slice(g,S)}return h.slice(g)},tu.prototype.eachChild=function(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)},tu.prototype.outputDefined=function(){return!1},tu.prototype.serialize=function(){if(null!=this.endIndex&&void 0!==this.endIndex){var s=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),s]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Pc=bl("==",function(s,h,g){return h===g},Oo),ju=bl("!=",function(s,h,g){return h!==g},function(s,h,g,S){return!Oo(0,h,g,S)}),eo=bl("<",function(s,h,g){return h<g},function(s,h,g,S){return S.compare(h,g)<0}),Td=bl(">",function(s,h,g){return h>g},function(s,h,g,S){return S.compare(h,g)>0}),zl=bl("<=",function(s,h,g){return h<=g},function(s,h,g,S){return S.compare(h,g)<=0}),nd=bl(">=",function(s,h,g){return h>=g},function(s,h,g,S){return S.compare(h,g)>=0}),nu=function(s,h,g,S,k){this.type=Je,this.number=s,this.locale=h,this.currency=g,this.minFractionDigits=S,this.maxFractionDigits=k};nu.parse=function(s,h){if(3!==s.length)return h.error("Expected two arguments.");var g=h.parse(s[1],1,mt);if(!g)return null;var S=s[2];if("object"!=typeof S||Array.isArray(S))return h.error("NumberFormat options argument must be an object.");var k=null;if(S.locale&&!(k=h.parse(S.locale,1,Je)))return null;var N=null;if(S.currency&&!(N=h.parse(S.currency,1,Je)))return null;var q=null;if(S["min-fraction-digits"]&&!(q=h.parse(S["min-fraction-digits"],1,mt)))return null;var X=null;return S["max-fraction-digits"]&&!(X=h.parse(S["max-fraction-digits"],1,mt))?null:new nu(g,k,N,q,X)},nu.prototype.evaluate=function(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))},nu.prototype.eachChild=function(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)},nu.prototype.outputDefined=function(){return!1},nu.prototype.serialize=function(){var s={};return this.locale&&(s.locale=this.locale.serialize()),this.currency&&(s.currency=this.currency.serialize()),this.minFractionDigits&&(s["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(s["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),s]};var Gi=function(s){this.type=mt,this.input=s};Gi.parse=function(s,h){if(2!==s.length)return h.error("Expected 1 argument, but found "+(s.length-1)+" instead.");var g=h.parse(s[1],1);return g?"array"!==g.type.kind&&"string"!==g.type.kind&&"value"!==g.type.kind?h.error("Expected argument of type string or array, but found "+qt(g.type)+" instead."):new Gi(g):null},Gi.prototype.evaluate=function(s){var h=this.input.evaluate(s);if("string"==typeof h||Array.isArray(h))return h.length;throw new Oi("Expected value to be of type string or array, but found "+qt(Ya(h))+" instead.")},Gi.prototype.eachChild=function(s){s(this.input)},Gi.prototype.outputDefined=function(){return!1},Gi.prototype.serialize=function(){var s=["length"];return this.eachChild(function(h){s.push(h.serialize())}),s};var Rc={"==":Pc,"!=":ju,">":Td,"<":eo,">=":nd,"<=":zl,array:Ai,at:Sh,boolean:Ai,case:yu,coalesce:ic,collator:no,format:ls,image:ga,in:oc,"index-of":ya,interpolate:ka,"interpolate-hcl":ka,"interpolate-lab":ka,length:Gi,let:Di,literal:xl,match:uo,number:Ai,"number-format":nu,object:Ai,slice:tu,step:wa,string:Ai,"to-boolean":Ts,"to-color":Ts,"to-number":Ts,"to-string":Ts,var:bh,within:Ql};function Hh(s,h){var g=h[0],S=h[1],k=h[2],N=h[3];g=g.evaluate(s),S=S.evaluate(s),k=k.evaluate(s);var q=N?N.evaluate(s):1,X=fi(g,S,k,q);if(X)throw new Oi(X);return new ni(g/255*q,S/255*q,k/255*q,q)}function Pa(s,h){return s in h}function Ms(s,h){var g=h[s];return void 0===g?null:g}function Ca(s){return{type:s}}function vu(s){return{result:"success",value:s}}function Nl(s){return{result:"error",value:s}}function Ks(s){return"data-driven"===s["property-type"]||"cross-faded-data-driven"===s["property-type"]}function Uu(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function Oc(s){return!!s.expression&&s.expression.interpolated}function Ki(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":null===s?"null":typeof s}function Ih(s){return"object"==typeof s&&null!==s&&!Array.isArray(s)}function Vs(s){return s}function Ba(s,h,g){return void 0!==s?s:void 0!==h?h:void 0!==g?g:void 0}function Rp(s,h,g,S,k){return Ba(typeof g===k?S[g]:void 0,s.default,h.default)}function As(s,h,g){if("number"!==Ki(g))return Ba(s.default,h.default);var S=s.stops.length;if(1===S||g<=s.stops[0][0])return s.stops[0][1];if(g>=s.stops[S-1][0])return s.stops[S-1][1];var k=kc(s.stops.map(function(N){return N[0]}),g);return s.stops[k][1]}function Qn(s,h,g){var S=void 0!==s.base?s.base:1;if("number"!==Ki(g))return Ba(s.default,h.default);var k=s.stops.length;if(1===k||g<=s.stops[0][0])return s.stops[0][1];if(g>=s.stops[k-1][0])return s.stops[k-1][1];var Ae,ze,Qe,pt,N=kc(s.stops.map(function(_e){return _e[0]}),g),q=(Ae=S,pt=g-(ze=s.stops[N][0]),0==(Qe=s.stops[N+1][0]-ze)?0:1===Ae?pt/Qe:(Math.pow(Ae,pt)-1)/(Math.pow(Ae,Qe)-1)),X=s.stops[N][1],ie=s.stops[N+1][1],ce=qh[h.type]||Vs;if(s.colorSpace&&"rgb"!==s.colorSpace){var ye=th[s.colorSpace];ce=function(_e,Ae){return ye.reverse(ye.interpolate(ye.forward(_e),ye.forward(Ae),q))}}return"function"==typeof X.evaluate?{evaluate:function(){for(var _e=[],Ae=arguments.length;Ae--;)_e[Ae]=arguments[Ae];var ze=X.evaluate.apply(void 0,_e),Xe=ie.evaluate.apply(void 0,_e);if(void 0!==ze&&void 0!==Xe)return ce(ze,Xe,q)}}:ce(X,ie,q)}function ui(s,h,g){return"color"===h.type?g=ni.parse(g):"formatted"===h.type?g=Ro.fromString(g.toString()):"resolvedImage"===h.type?g=gi.fromString(g.toString()):Ki(g)===h.type||"enum"===h.type&&h.values[g]||(g=void 0),Ba(g,s.default,h.default)}ua.register(Rc,{error:[{kind:"error"},[Je],function(s,h){throw new Oi(h[0].evaluate(s))}],typeof:[Je,[sn],function(s,h){return qt(Ya(h[0].evaluate(s)))}],"to-rgba":[or(mt,4),[On],function(s,h){return h[0].evaluate(s).toArray()}],rgb:[On,[mt,mt,mt],Hh],rgba:[On,[mt,mt,mt,mt],Hh],has:{type:ot,overloads:[[[Je],function(s,h){return Pa(h[0].evaluate(s),s.properties())}],[[Je,Bn],function(s,h){var g=h[1];return Pa(h[0].evaluate(s),g.evaluate(s))}]]},get:{type:sn,overloads:[[[Je],function(s,h){return Ms(h[0].evaluate(s),s.properties())}],[[Je,Bn],function(s,h){var g=h[1];return Ms(h[0].evaluate(s),g.evaluate(s))}]]},"feature-state":[sn,[Je],function(s,h){return Ms(h[0].evaluate(s),s.featureState||{})}],properties:[Bn,[],function(s){return s.properties()}],"geometry-type":[Je,[],function(s){return s.geometryType()}],id:[sn,[],function(s){return s.id()}],zoom:[mt,[],function(s){return s.globals.zoom}],"heatmap-density":[mt,[],function(s){return s.globals.heatmapDensity||0}],"line-progress":[mt,[],function(s){return s.globals.lineProgress||0}],accumulated:[sn,[],function(s){return void 0===s.globals.accumulated?null:s.globals.accumulated}],"+":[mt,Ca(mt),function(s,h){for(var g=0,S=0,k=h;S<k.length;S+=1)g+=k[S].evaluate(s);return g}],"*":[mt,Ca(mt),function(s,h){for(var g=1,S=0,k=h;S<k.length;S+=1)g*=k[S].evaluate(s);return g}],"-":{type:mt,overloads:[[[mt,mt],function(s,h){var g=h[1];return h[0].evaluate(s)-g.evaluate(s)}],[[mt],function(s,h){return-h[0].evaluate(s)}]]},"/":[mt,[mt,mt],function(s,h){var g=h[1];return h[0].evaluate(s)/g.evaluate(s)}],"%":[mt,[mt,mt],function(s,h){var g=h[1];return h[0].evaluate(s)%g.evaluate(s)}],ln2:[mt,[],function(){return Math.LN2}],pi:[mt,[],function(){return Math.PI}],e:[mt,[],function(){return Math.E}],"^":[mt,[mt,mt],function(s,h){var g=h[1];return Math.pow(h[0].evaluate(s),g.evaluate(s))}],sqrt:[mt,[mt],function(s,h){return Math.sqrt(h[0].evaluate(s))}],log10:[mt,[mt],function(s,h){return Math.log(h[0].evaluate(s))/Math.LN10}],ln:[mt,[mt],function(s,h){return Math.log(h[0].evaluate(s))}],log2:[mt,[mt],function(s,h){return Math.log(h[0].evaluate(s))/Math.LN2}],sin:[mt,[mt],function(s,h){return Math.sin(h[0].evaluate(s))}],cos:[mt,[mt],function(s,h){return Math.cos(h[0].evaluate(s))}],tan:[mt,[mt],function(s,h){return Math.tan(h[0].evaluate(s))}],asin:[mt,[mt],function(s,h){return Math.asin(h[0].evaluate(s))}],acos:[mt,[mt],function(s,h){return Math.acos(h[0].evaluate(s))}],atan:[mt,[mt],function(s,h){return Math.atan(h[0].evaluate(s))}],min:[mt,Ca(mt),function(s,h){return Math.min.apply(Math,h.map(function(g){return g.evaluate(s)}))}],max:[mt,Ca(mt),function(s,h){return Math.max.apply(Math,h.map(function(g){return g.evaluate(s)}))}],abs:[mt,[mt],function(s,h){return Math.abs(h[0].evaluate(s))}],round:[mt,[mt],function(s,h){var g=h[0].evaluate(s);return g<0?-Math.round(-g):Math.round(g)}],floor:[mt,[mt],function(s,h){return Math.floor(h[0].evaluate(s))}],ceil:[mt,[mt],function(s,h){return Math.ceil(h[0].evaluate(s))}],"filter-==":[ot,[Je,sn],function(s,h){var g=h[0],S=h[1];return s.properties()[g.value]===S.value}],"filter-id-==":[ot,[sn],function(s,h){var g=h[0];return s.id()===g.value}],"filter-type-==":[ot,[Je],function(s,h){var g=h[0];return s.geometryType()===g.value}],"filter-<":[ot,[Je,sn],function(s,h){var g=h[0],S=h[1],k=s.properties()[g.value],N=S.value;return typeof k==typeof N&&k<N}],"filter-id-<":[ot,[sn],function(s,h){var g=h[0],S=s.id(),k=g.value;return typeof S==typeof k&&S<k}],"filter->":[ot,[Je,sn],function(s,h){var g=h[0],S=h[1],k=s.properties()[g.value],N=S.value;return typeof k==typeof N&&k>N}],"filter-id->":[ot,[sn],function(s,h){var g=h[0],S=s.id(),k=g.value;return typeof S==typeof k&&S>k}],"filter-<=":[ot,[Je,sn],function(s,h){var g=h[0],S=h[1],k=s.properties()[g.value],N=S.value;return typeof k==typeof N&&k<=N}],"filter-id-<=":[ot,[sn],function(s,h){var g=h[0],S=s.id(),k=g.value;return typeof S==typeof k&&S<=k}],"filter->=":[ot,[Je,sn],function(s,h){var g=h[0],S=h[1],k=s.properties()[g.value],N=S.value;return typeof k==typeof N&&k>=N}],"filter-id->=":[ot,[sn],function(s,h){var g=h[0],S=s.id(),k=g.value;return typeof S==typeof k&&S>=k}],"filter-has":[ot,[sn],function(s,h){return h[0].value in s.properties()}],"filter-has-id":[ot,[],function(s){return null!==s.id()&&void 0!==s.id()}],"filter-type-in":[ot,[or(Je)],function(s,h){return h[0].value.indexOf(s.geometryType())>=0}],"filter-id-in":[ot,[or(sn)],function(s,h){return h[0].value.indexOf(s.id())>=0}],"filter-in-small":[ot,[Je,or(sn)],function(s,h){var g=h[0];return h[1].value.indexOf(s.properties()[g.value])>=0}],"filter-in-large":[ot,[Je,or(sn)],function(s,h){var g=h[0],S=h[1];return function(k,N,q,X){for(;q<=X;){var ie=q+X>>1;if(N[ie]===k)return!0;N[ie]>k?X=ie-1:q=ie+1}return!1}(s.properties()[g.value],S.value,0,S.value.length-1)}],all:{type:ot,overloads:[[[ot,ot],function(s,h){var g=h[1];return h[0].evaluate(s)&&g.evaluate(s)}],[Ca(ot),function(s,h){for(var g=0,S=h;g<S.length;g+=1)if(!S[g].evaluate(s))return!1;return!0}]]},any:{type:ot,overloads:[[[ot,ot],function(s,h){var g=h[1];return h[0].evaluate(s)||g.evaluate(s)}],[Ca(ot),function(s,h){for(var g=0,S=h;g<S.length;g+=1)if(S[g].evaluate(s))return!0;return!1}]]},"!":[ot,[ot],function(s,h){return!h[0].evaluate(s)}],"is-supported-script":[ot,[Je],function(s,h){var g=s.globals&&s.globals.isSupportedScript;return!g||g(h[0].evaluate(s))}],upcase:[Je,[Je],function(s,h){return h[0].evaluate(s).toUpperCase()}],downcase:[Je,[Je],function(s,h){return h[0].evaluate(s).toLowerCase()}],concat:[Je,Ca(sn),function(s,h){return h.map(function(g){return Fr(g.evaluate(s))}).join("")}],"resolved-locale":[Je,[br],function(s,h){return h[0].evaluate(s).resolvedLocale()}]});var So=function(s,h){var g;this.expression=s,this._warningHistory={},this._evaluator=new xi,this._defaultValue=h?"color"===(g=h).type&&Ih(g.default)?new ni(0,0,0,0):"color"===g.type?ni.parse(g.default)||null:void 0===g.default?null:g.default:null,this._enumValues=h&&"enum"===h.type?h.values:null};function Gs(s){return Array.isArray(s)&&s.length>0&&"string"==typeof s[0]&&s[0]in Rc}function ru(s,h){var k,N,g=new Dc(Rc,[],h?(N={color:On,string:Je,number:mt,enum:Je,boolean:ot,formatted:Ft,resolvedImage:mr},"array"===(k=h).type?or(N[k.value]||sn,k.length):N[k.type]):void 0),S=g.parse(s,void 0,void 0,void 0,h&&"string"===h.type?{typeAnnotation:"coerce"}:void 0);return S?vu(new So(S,h)):Nl(g.errors)}So.prototype.evaluateWithoutErrorHandling=function(s,h,g,S,k,N){return this._evaluator.globals=s,this._evaluator.feature=h,this._evaluator.featureState=g,this._evaluator.canonical=S,this._evaluator.availableImages=k||null,this._evaluator.formattedSection=N,this.expression.evaluate(this._evaluator)},So.prototype.evaluate=function(s,h,g,S,k,N){this._evaluator.globals=s,this._evaluator.feature=h||null,this._evaluator.featureState=g||null,this._evaluator.canonical=S,this._evaluator.availableImages=k||null,this._evaluator.formattedSection=N||null;try{var q=this.expression.evaluate(this._evaluator);if(null==q||"number"==typeof q&&q!=q)return this._defaultValue;if(this._enumValues&&!(q in this._enumValues))throw new Oi("Expected value to be one of "+Object.keys(this._enumValues).map(function(X){return JSON.stringify(X)}).join(", ")+", but found "+JSON.stringify(q)+" instead.");return q}catch(X){return this._warningHistory[X.message]||(this._warningHistory[X.message]=!0,"undefined"!=typeof console&&console.warn(X.message)),this._defaultValue}};var Ao=function(s,h){this.kind=s,this._styleExpression=h,this.isStateDependent="constant"!==s&&!Fl(h.expression)};Ao.prototype.evaluateWithoutErrorHandling=function(s,h,g,S,k,N){return this._styleExpression.evaluateWithoutErrorHandling(s,h,g,S,k,N)},Ao.prototype.evaluate=function(s,h,g,S,k,N){return this._styleExpression.evaluate(s,h,g,S,k,N)};var Bl=function(s,h,g,S){this.kind=s,this.zoomStops=g,this._styleExpression=h,this.isStateDependent="camera"!==s&&!Fl(h.expression),this.interpolationType=S};function Xo(s,h){if("error"===(s=ru(s,h)).result)return s;var g=s.value.expression,S=io(g);if(!S&&!Ks(h))return Nl([new Rt("","data expressions not supported")]);var k=up(g,["zoom"]);if(!k&&!Uu(h))return Nl([new Rt("","zoom expressions not supported")]);var N=function q(X){var ie=null;if(X instanceof Di)ie=q(X.result);else if(X instanceof ic)for(var ce=0,ye=X.args;ce<ye.length&&!(ie=q(ye[ce]));ce+=1);else(X instanceof wa||X instanceof ka)&&X.input instanceof ua&&"zoom"===X.input.name&&(ie=X);return ie instanceof Rt||X.eachChild(function(_e){var Ae=q(_e);Ae instanceof Rt?ie=Ae:!ie&&Ae?ie=new Rt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):ie&&Ae&&ie!==Ae&&(ie=new Rt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),ie}(g);return N||k?N instanceof Rt?Nl([N]):N instanceof ka&&!Oc(h)?Nl([new Rt("",'"interpolate" expressions cannot be used with this property')]):vu(N?new Bl(S?"camera":"composite",s.value,N.labels,N instanceof ka?N.interpolation:void 0):new Ao(S?"constant":"source",s.value)):Nl([new Rt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Bl.prototype.evaluateWithoutErrorHandling=function(s,h,g,S,k,N){return this._styleExpression.evaluateWithoutErrorHandling(s,h,g,S,k,N)},Bl.prototype.evaluate=function(s,h,g,S,k,N){return this._styleExpression.evaluate(s,h,g,S,k,N)},Bl.prototype.interpolationFactor=function(s,h,g){return this.interpolationType?ka.interpolationFactor(this.interpolationType,s,h,g):0};var wl=function(s,h){this._parameters=s,this._specification=h,Ze(this,function g(S,k){var N,q,X,ie="color"===k.type,ce=S.stops&&"object"==typeof S.stops[0][0],ye=ce||!(ce||void 0!==S.property),_e=S.type||(Oc(k)?"exponential":"interval");if(ie&&((S=Ze({},S)).stops&&(S.stops=S.stops.map(function(Gn){return[Gn[0],ni.parse(Gn[1])]})),S.default=ni.parse(S.default?S.default:k.default)),S.colorSpace&&"rgb"!==S.colorSpace&&!th[S.colorSpace])throw new Error("Unknown color space: "+S.colorSpace);if("exponential"===_e)N=Qn;else if("interval"===_e)N=As;else if("categorical"===_e){N=Rp,q=Object.create(null);for(var Ae=0,ze=S.stops;Ae<ze.length;Ae+=1){var Xe=ze[Ae];q[Xe[0]]=Xe[1]}X=typeof S.stops[0][0]}else{if("identity"!==_e)throw new Error('Unknown function type "'+_e+'"');N=ui}if(ce){for(var Qe={},pt=[],st=0;st<S.stops.length;st++){var St=S.stops[st],At=St[0].zoom;void 0===Qe[At]&&(Qe[At]={zoom:At,type:S.type,property:S.property,default:S.default,stops:[]},pt.push(At)),Qe[At].stops.push([St[0].value,St[1]])}for(var Lt=[],zt=0,nn=pt;zt<nn.length;zt+=1){var An=nn[zt];Lt.push([Qe[An].zoom,g(Qe[An],k)])}var zn={name:"linear"};return{kind:"composite",interpolationType:zn,interpolationFactor:ka.interpolationFactor.bind(void 0,zn),zoomStops:Lt.map(function(Gn){return Gn[0]}),evaluate:function(Gn,Dr){var Yn=Gn.zoom;return Qn({stops:Lt,base:S.base},k,Yn).evaluate(Yn,Dr)}}}if(ye){var _r="exponential"===_e?{name:"exponential",base:void 0!==S.base?S.base:1}:null;return{kind:"camera",interpolationType:_r,interpolationFactor:ka.interpolationFactor.bind(void 0,_r),zoomStops:S.stops.map(function(Gn){return Gn[0]}),evaluate:function(Gn){return N(S,k,Gn.zoom,q,X)}}}return{kind:"source",evaluate:function(Gn,Dr){var Yn=Dr&&Dr.properties?Dr.properties[S.property]:void 0;return void 0===Yn?Ba(S.default,k.default):N(S,k,Yn,q,X)}}}(this._parameters,this._specification))};function sl(s){var h=s.key,g=s.value,S=s.valueSpec||{},k=s.objectElementValidators||{},N=s.style,q=s.styleSpec,X=[],ie=Ki(g);if("object"!==ie)return[new Se(h,g,"object expected, "+ie+" found")];for(var ce in g){var ye=ce.split(".")[0],_e=S[ye]||S["*"],Ae=void 0;if(k[ye])Ae=k[ye];else if(S[ye])Ae=yi;else if(k["*"])Ae=k["*"];else{if(!S["*"]){X.push(new Se(h,g[ce],'unknown property "'+ce+'"'));continue}Ae=yi}X=X.concat(Ae({key:(h&&h+".")+ce,value:g[ce],valueSpec:_e,style:N,styleSpec:q,object:g,objectKey:ce},g))}for(var ze in S)k[ze]||S[ze].required&&void 0===S[ze].default&&void 0===g[ze]&&X.push(new Se(h,g,'missing required property "'+ze+'"'));return X}function bi(s){var h=s.value,g=s.valueSpec,S=s.style,k=s.styleSpec,N=s.key,q=s.arrayElementValidator||yi;if("array"!==Ki(h))return[new Se(N,h,"array expected, "+Ki(h)+" found")];if(g.length&&h.length!==g.length)return[new Se(N,h,"array length "+g.length+" expected, length "+h.length+" found")];if(g["min-length"]&&h.length<g["min-length"])return[new Se(N,h,"array length at least "+g["min-length"]+" expected, length "+h.length+" found")];var X={type:g.value,values:g.values};k.$version<7&&(X.function=g.function),"object"===Ki(g.value)&&(X=g.value);for(var ie=[],ce=0;ce<h.length;ce++)ie=ie.concat(q({array:h,arrayIndex:ce,value:h[ce],valueSpec:X,style:S,styleSpec:k,key:N+"["+ce+"]"}));return ie}function Ji(s){var h=s.key,g=s.value,S=s.valueSpec,k=Ki(g);return"number"===k&&g!=g&&(k="NaN"),"number"!==k?[new Se(h,g,"number expected, "+k+" found")]:"minimum"in S&&g<S.minimum?[new Se(h,g,g+" is less than the minimum value "+S.minimum)]:"maximum"in S&&g>S.maximum?[new Se(h,g,g+" is greater than the maximum value "+S.maximum)]:[]}function ac(s){var h,g,S,k=s.valueSpec,N=Be(s.value.type),q={},X="categorical"!==N&&void 0===s.value.property,ie=!X,ce="array"===Ki(s.value.stops)&&"array"===Ki(s.value.stops[0])&&"object"===Ki(s.value.stops[0][0]),ye=sl({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(ze){if("identity"===N)return[new Se(ze.key,ze.value,'identity function may not have a "stops" property')];var Xe=[],Qe=ze.value;return Xe=Xe.concat(bi({key:ze.key,value:Qe,valueSpec:ze.valueSpec,style:ze.style,styleSpec:ze.styleSpec,arrayElementValidator:_e})),"array"===Ki(Qe)&&0===Qe.length&&Xe.push(new Se(ze.key,Qe,"array must have at least one stop")),Xe},default:function(ze){return yi({key:ze.key,value:ze.value,valueSpec:k,style:ze.style,styleSpec:ze.styleSpec})}}});return"identity"===N&&X&&ye.push(new Se(s.key,s.value,'missing required property "property"')),"identity"===N||s.value.stops||ye.push(new Se(s.key,s.value,'missing required property "stops"')),"exponential"===N&&s.valueSpec.expression&&!Oc(s.valueSpec)&&ye.push(new Se(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(ie&&!Ks(s.valueSpec)?ye.push(new Se(s.key,s.value,"property functions not supported")):X&&!Uu(s.valueSpec)&&ye.push(new Se(s.key,s.value,"zoom functions not supported"))),"categorical"!==N&&!ce||void 0!==s.value.property||ye.push(new Se(s.key,s.value,'"property" property is required')),ye;function _e(ze){var Xe=[],Qe=ze.value,pt=ze.key;if("array"!==Ki(Qe))return[new Se(pt,Qe,"array expected, "+Ki(Qe)+" found")];if(2!==Qe.length)return[new Se(pt,Qe,"array length 2 expected, length "+Qe.length+" found")];if(ce){if("object"!==Ki(Qe[0]))return[new Se(pt,Qe,"object expected, "+Ki(Qe[0])+" found")];if(void 0===Qe[0].zoom)return[new Se(pt,Qe,"object stop key must have zoom")];if(void 0===Qe[0].value)return[new Se(pt,Qe,"object stop key must have value")];if(S&&S>Be(Qe[0].zoom))return[new Se(pt,Qe[0].zoom,"stop zoom values must appear in ascending order")];Be(Qe[0].zoom)!==S&&(S=Be(Qe[0].zoom),g=void 0,q={}),Xe=Xe.concat(sl({key:pt+"[0]",value:Qe[0],valueSpec:{zoom:{}},style:ze.style,styleSpec:ze.styleSpec,objectElementValidators:{zoom:Ji,value:Ae}}))}else Xe=Xe.concat(Ae({key:pt+"[0]",value:Qe[0],valueSpec:{},style:ze.style,styleSpec:ze.styleSpec},Qe));return Gs(lt(Qe[1]))?Xe.concat([new Se(pt+"[1]",Qe[1],"expressions are not allowed in function stops.")]):Xe.concat(yi({key:pt+"[1]",value:Qe[1],valueSpec:k,style:ze.style,styleSpec:ze.styleSpec}))}function Ae(ze,Xe){var Qe=Ki(ze.value),pt=Be(ze.value),st=null!==ze.value?ze.value:Xe;if(h){if(Qe!==h)return[new Se(ze.key,st,Qe+" stop domain type must match previous stop domain type "+h)]}else h=Qe;if("number"!==Qe&&"string"!==Qe&&"boolean"!==Qe)return[new Se(ze.key,st,"stop domain value must be a number, string, or boolean")];if("number"!==Qe&&"categorical"!==N){var St="number expected, "+Qe+" found";return Ks(k)&&void 0===N&&(St+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Se(ze.key,st,St)]}return"categorical"!==N||"number"!==Qe||isFinite(pt)&&Math.floor(pt)===pt?"categorical"!==N&&"number"===Qe&&void 0!==g&&pt<g?[new Se(ze.key,st,"stop domain values must appear in ascending order")]:(g=pt,"categorical"===N&&pt in q?[new Se(ze.key,st,"stop domain values must be unique")]:(q[pt]=!0,[])):[new Se(ze.key,st,"integer expected, found "+pt)]}}function Lc(s){var h=("property"===s.expressionContext?Xo:ru)(lt(s.value),s.valueSpec);if("error"===h.result)return h.value.map(function(S){return new Se(""+s.key+S.key,s.value,S.message)});var g=h.value.expression||h.value._styleExpression.expression;if("property"===s.expressionContext&&"text-font"===s.propertyKey&&!g.outputDefined())return[new Se(s.key,s.value,'Invalid data expression for "'+s.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===s.expressionContext&&"layout"===s.propertyType&&!Fl(g))return[new Se(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===s.expressionContext&&!Fl(g))return[new Se(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&0===s.expressionContext.indexOf("cluster")){if(!up(g,["zoom","feature-state"]))return[new Se(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===s.expressionContext&&!io(g))return[new Se(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function sc(s){var h=s.key,g=s.value,S=s.valueSpec,k=[];return Array.isArray(S.values)?-1===S.values.indexOf(Be(g))&&k.push(new Se(h,g,"expected one of ["+S.values.join(", ")+"], "+JSON.stringify(g)+" found")):-1===Object.keys(S.values).indexOf(Be(g))&&k.push(new Se(h,g,"expected one of ["+Object.keys(S.values).join(", ")+"], "+JSON.stringify(g)+" found")),k}function ja(s){if(!0===s||!1===s)return!0;if(!Array.isArray(s)||0===s.length)return!1;switch(s[0]){case"has":return s.length>=2&&"$id"!==s[1]&&"$type"!==s[1];case"in":return s.length>=3&&("string"!=typeof s[1]||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==s.length||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(var h=0,g=s.slice(1);h<g.length;h+=1){var S=g[h];if(!ja(S)&&"boolean"!=typeof S)return!1}return!0;default:return!0}}wl.deserialize=function(s){return new wl(s._parameters,s._specification)},wl.serialize=function(s){return{_parameters:s._parameters,_specification:s._specification}};var cp={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Vu(s){if(null==s)return{filter:function(){return!0},needGeometry:!1};ja(s)||(s=vo(s));var h=ru(s,cp);if("error"===h.result)throw new Error(h.value.map(function(g){return g.key+": "+g.message}).join(", "));return{filter:function(g,S,k){return h.value.evaluate(g,S,{},k)},needGeometry:function g(S){if(!Array.isArray(S))return!1;if("within"===S[0])return!0;for(var k=1;k<S.length;k++)if(g(S[k]))return!0;return!1}(s)}}function Gu(s,h){return s<h?-1:s>h?1:0}function vo(s){if(!s)return!0;var h,g=s[0];return s.length<=1?"any"!==g:"=="===g?Op(s[1],s[2],"=="):"!="===g?us(Op(s[1],s[2],"==")):"<"===g||">"===g||"<="===g||">="===g?Op(s[1],s[2],g):"any"===g?(h=s.slice(1),["any"].concat(h.map(vo))):"all"===g?["all"].concat(s.slice(1).map(vo)):"none"===g?["all"].concat(s.slice(1).map(vo).map(us)):"in"===g?qu(s[1],s.slice(2)):"!in"===g?us(qu(s[1],s.slice(2))):"has"===g?Cl(s[1]):"!has"===g?us(Cl(s[1])):"within"!==g||s}function Op(s,h,g){switch(s){case"$type":return["filter-type-"+g,h];case"$id":return["filter-id-"+g,h];default:return["filter-"+g,s,h]}}function qu(s,h){if(0===h.length)return!1;switch(s){case"$type":return["filter-type-in",["literal",h]];case"$id":return["filter-id-in",["literal",h]];default:return h.length>200&&!h.some(function(g){return typeof g!=typeof h[0]})?["filter-in-large",s,["literal",h.sort(Gu)]]:["filter-in-small",s,["literal",h]]}}function Cl(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function us(s){return["!",s]}function nh(s){return ja(lt(s.value))?Lc(Ze({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function h(g){var S=g.value,k=g.key;if("array"!==Ki(S))return[new Se(k,S,"array expected, "+Ki(S)+" found")];var N,q=g.styleSpec,X=[];if(S.length<1)return[new Se(k,S,"filter array must have at least 1 element")];switch(X=X.concat(sc({key:k+"[0]",value:S[0],valueSpec:q.filter_operator,style:g.style,styleSpec:g.styleSpec})),Be(S[0])){case"<":case"<=":case">":case">=":S.length>=2&&"$type"===Be(S[1])&&X.push(new Se(k,S,'"$type" cannot be use with operator "'+S[0]+'"'));case"==":case"!=":3!==S.length&&X.push(new Se(k,S,'filter array for operator "'+S[0]+'" must have 3 elements'));case"in":case"!in":S.length>=2&&"string"!==(N=Ki(S[1]))&&X.push(new Se(k+"[1]",S[1],"string expected, "+N+" found"));for(var ie=2;ie<S.length;ie++)N=Ki(S[ie]),"$type"===Be(S[1])?X=X.concat(sc({key:k+"["+ie+"]",value:S[ie],valueSpec:q.geometry_type,style:g.style,styleSpec:g.styleSpec})):"string"!==N&&"number"!==N&&"boolean"!==N&&X.push(new Se(k+"["+ie+"]",S[ie],"string, number, or boolean expected, "+N+" found"));break;case"any":case"all":case"none":for(var ce=1;ce<S.length;ce++)X=X.concat(h({key:k+"["+ce+"]",value:S[ce],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":N=Ki(S[1]),2!==S.length?X.push(new Se(k,S,'filter array for "'+S[0]+'" operator must have 2 elements')):"string"!==N&&X.push(new Se(k+"[1]",S[1],"string expected, "+N+" found"));break;case"within":N=Ki(S[1]),2!==S.length?X.push(new Se(k,S,'filter array for "'+S[0]+'" operator must have 2 elements')):"object"!==N&&X.push(new Se(k+"[1]",S[1],"object expected, "+N+" found"))}return X}(s)}function Wh(s,h){var g=s.key,S=s.style,k=s.styleSpec,N=s.value,q=s.objectKey,X=k[h+"_"+s.layerType];if(!X)return[];var ie=q.match(/^(.*)-transition$/);if("paint"===h&&ie&&X[ie[1]]&&X[ie[1]].transition)return yi({key:g,value:N,valueSpec:k.transition,style:S,styleSpec:k});var ce,ye=s.valueSpec||X[q];if(!ye)return[new Se(g,N,'unknown property "'+q+'"')];if("string"===Ki(N)&&Ks(ye)&&!ye.tokens&&(ce=/^{([^}]+)}$/.exec(N)))return[new Se(g,N,'"'+q+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(ce[1])+" }`.")];var _e=[];return"symbol"===s.layerType&&("text-field"===q&&S&&!S.glyphs&&_e.push(new Se(g,N,'use of "text-field" requires a style "glyphs" property')),"text-font"===q&&Ih(lt(N))&&"identity"===Be(N.type)&&_e.push(new Se(g,N,'"text-font" does not support identity functions'))),_e.concat(yi({key:s.key,value:N,valueSpec:ye,style:S,styleSpec:k,expressionContext:"property",propertyType:h,propertyKey:q}))}function jl(s){return Wh(s,"paint")}function cs(s){return Wh(s,"layout")}function El(s){var h=[],g=s.value,S=s.key,k=s.style,N=s.styleSpec;g.type||g.ref||h.push(new Se(S,g,'either "type" or "ref" is required'));var q,X=Be(g.type),ie=Be(g.ref);if(g.id)for(var ce=Be(g.id),ye=0;ye<s.arrayIndex;ye++){var _e=k.layers[ye];Be(_e.id)===ce&&h.push(new Se(S,g.id,'duplicate layer id "'+g.id+'", previously used at line '+_e.id.__line__))}if("ref"in g)["type","source","source-layer","filter","layout"].forEach(function(Xe){Xe in g&&h.push(new Se(S,g[Xe],'"'+Xe+'" is prohibited for ref layers'))}),k.layers.forEach(function(Xe){Be(Xe.id)===ie&&(q=Xe)}),q?q.ref?h.push(new Se(S,g.ref,"ref cannot reference another ref layer")):X=Be(q.type):h.push(new Se(S,g.ref,'ref layer "'+ie+'" not found'));else if("background"!==X)if(g.source){var Ae=k.sources&&k.sources[g.source],ze=Ae&&Be(Ae.type);Ae?"vector"===ze&&"raster"===X?h.push(new Se(S,g.source,'layer "'+g.id+'" requires a raster source')):"raster"===ze&&"raster"!==X?h.push(new Se(S,g.source,'layer "'+g.id+'" requires a vector source')):"vector"!==ze||g["source-layer"]?"raster-dem"===ze&&"hillshade"!==X?h.push(new Se(S,g.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==X||!g.paint||!g.paint["line-gradient"]||"geojson"===ze&&Ae.lineMetrics||h.push(new Se(S,g,'layer "'+g.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):h.push(new Se(S,g,'layer "'+g.id+'" must specify a "source-layer"')):h.push(new Se(S,g.source,'source "'+g.source+'" not found'))}else h.push(new Se(S,g,'missing required property "source"'));return h=h.concat(sl({key:S,value:g,valueSpec:N.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return yi({key:S+".type",value:g.type,valueSpec:N.layer.type,style:s.style,styleSpec:s.styleSpec,object:g,objectKey:"type"})},filter:nh,layout:function(Xe){return sl({layer:g,key:Xe.key,value:Xe.value,style:Xe.style,styleSpec:Xe.styleSpec,objectElementValidators:{"*":function(Qe){return cs(Ze({layerType:X},Qe))}}})},paint:function(Xe){return sl({layer:g,key:Xe.key,value:Xe.value,style:Xe.style,styleSpec:Xe.styleSpec,objectElementValidators:{"*":function(Qe){return jl(Ze({layerType:X},Qe))}}})}}}))}function _o(s){var h=s.value,g=s.key,S=Ki(h);return"string"!==S?[new Se(g,h,"string expected, "+S+" found")]:[]}var $h={promoteId:function(s){var h=s.key,g=s.value;if("string"===Ki(g))return _o({key:h,value:g});var S=[];for(var k in g)S.push.apply(S,_o({key:h+"."+k,value:g[k]}));return S}};function Zu(s){var h=s.value,g=s.key,S=s.styleSpec,k=s.style;if(!h.type)return[new Se(g,h,'"type" is required')];var N,q=Be(h.type);switch(q){case"vector":case"raster":case"raster-dem":return sl({key:g,value:h,valueSpec:S["source_"+q.replace("-","_")],style:s.style,styleSpec:S,objectElementValidators:$h});case"geojson":if(N=sl({key:g,value:h,valueSpec:S.source_geojson,style:k,styleSpec:S,objectElementValidators:$h}),h.cluster)for(var X in h.clusterProperties){var ie=h.clusterProperties[X],ce=ie[0],ye="string"==typeof ce?[ce,["accumulated"],["get",X]]:ce;N.push.apply(N,Lc({key:g+"."+X+".map",value:ie[1],expressionContext:"cluster-map"})),N.push.apply(N,Lc({key:g+"."+X+".reduce",value:ye,expressionContext:"cluster-reduce"}))}return N;case"video":return sl({key:g,value:h,valueSpec:S.source_video,style:k,styleSpec:S});case"image":return sl({key:g,value:h,valueSpec:S.source_image,style:k,styleSpec:S});case"canvas":return[new Se(g,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return sc({key:g+".type",value:h.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:k,styleSpec:S})}}function iu(s){var h=s.value,g=s.styleSpec,S=g.light,k=s.style,N=[],q=Ki(h);if(void 0===h)return N;if("object"!==q)return N.concat([new Se("light",h,"object expected, "+q+" found")]);for(var X in h){var ie=X.match(/^(.*)-transition$/);N=N.concat(ie&&S[ie[1]]&&S[ie[1]].transition?yi({key:X,value:h[X],valueSpec:g.transition,style:k,styleSpec:g}):S[X]?yi({key:X,value:h[X],valueSpec:S[X],style:k,styleSpec:g}):[new Se(X,h[X],'unknown property "'+X+'"')])}return N}var qi={"*":function(){return[]},array:bi,boolean:function(s){var h=s.value,g=s.key,S=Ki(h);return"boolean"!==S?[new Se(g,h,"boolean expected, "+S+" found")]:[]},number:Ji,color:function(s){var h=s.key,g=s.value,S=Ki(g);return"string"!==S?[new Se(h,g,"color expected, "+S+" found")]:null===lr(g)?[new Se(h,g,'color expected, "'+g+'" found')]:[]},constants:He,enum:sc,filter:nh,function:ac,layer:El,object:sl,source:Zu,light:iu,string:_o,formatted:function(s){return 0===_o(s).length?[]:Lc(s)},resolvedImage:function(s){return 0===_o(s).length?[]:Lc(s)}};function yi(s){var h=s.value,g=s.valueSpec,S=s.styleSpec;return g.expression&&Ih(Be(h))?ac(s):g.expression&&Gs(lt(h))?Lc(s):g.type&&qi[g.type]?qi[g.type](s):sl(Ze({},s,{valueSpec:g.type?S[g.type]:g}))}function ou(s){var h=s.value,g=s.key,S=_o(s);return S.length||(-1===h.indexOf("{fontstack}")&&S.push(new Se(g,h,'"glyphs" url must include a "{fontstack}" token')),-1===h.indexOf("{range}")&&S.push(new Se(g,h,'"glyphs" url must include a "{range}" token'))),S}function Sl(s,h){void 0===h&&(h=pe);var g=[];return g=g.concat(yi({key:"",value:s,valueSpec:h.$root,styleSpec:h,style:s,objectElementValidators:{glyphs:ou,"*":function(){return[]}}})),s.constants&&(g=g.concat(He({key:"constants",value:s.constants,style:s,styleSpec:h}))),rd(g)}function rd(s){return[].concat(s).sort(function(h,g){return h.line-g.line})}function _u(s){return function(){for(var h=[],g=arguments.length;g--;)h[g]=arguments[g];return rd(s.apply(this,h))}}Sl.source=_u(Zu),Sl.light=_u(iu),Sl.layer=_u(El),Sl.filter=_u(nh),Sl.paintProperty=_u(jl),Sl.layoutProperty=_u(cs);var vi=Sl,Lp=vi.light,hp=vi.paintProperty,Xh=vi.layoutProperty;function lc(s,h){var g=!1;if(h&&h.length)for(var S=0,k=h;S<k.length;S+=1)s.fire(new me(new Error(k[S].message))),g=!0;return g}var hs=xu;function xu(s,h,g){var S=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var k=new Int32Array(this.arrayBuffer);s=k[0],this.d=(h=k[1])+2*(g=k[2]);for(var N=0;N<this.d*this.d;N++){var q=k[3+N],X=k[3+N+1];S.push(q===X?null:k.subarray(q,X))}var ie=k[3+S.length+1];this.keys=k.subarray(k[3+S.length],ie),this.bboxes=k.subarray(ie),this.insert=this._insertReadonly}else{this.d=h+2*g;for(var ce=0;ce<this.d*this.d;ce++)S.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=s,this.padding=g,this.scale=h/s,this.uid=0;var ye=g/h*s;this.min=-ye,this.max=s+ye}xu.prototype.insert=function(s,h,g,S,k){this._forEachCell(h,g,S,k,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(S),this.bboxes.push(k)},xu.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},xu.prototype._insertCell=function(s,h,g,S,k,N){this.cells[k].push(N)},xu.prototype.query=function(s,h,g,S,k){var N=this.min,q=this.max;if(s<=N&&h<=N&&q<=g&&q<=S&&!k)return Array.prototype.slice.call(this.keys);var X=[];return this._forEachCell(s,h,g,S,this._queryCell,X,{},k),X},xu.prototype._queryCell=function(s,h,g,S,k,N,q,X){var ie=this.cells[k];if(null!==ie)for(var ce=this.keys,ye=this.bboxes,_e=0;_e<ie.length;_e++){var Ae=ie[_e];if(void 0===q[Ae]){var ze=4*Ae;(X?X(ye[ze+0],ye[ze+1],ye[ze+2],ye[ze+3]):s<=ye[ze+2]&&h<=ye[ze+3]&&g>=ye[ze+0]&&S>=ye[ze+1])?(q[Ae]=!0,N.push(ce[Ae])):q[Ae]=!1}}},xu.prototype._forEachCell=function(s,h,g,S,k,N,q,X){for(var ie=this._convertToCellCoord(s),ce=this._convertToCellCoord(h),ye=this._convertToCellCoord(g),_e=this._convertToCellCoord(S),Ae=ie;Ae<=ye;Ae++)for(var ze=ce;ze<=_e;ze++){var Xe=this.d*ze+Ae;if((!X||X(this._convertFromCellCoord(Ae),this._convertFromCellCoord(ze),this._convertFromCellCoord(Ae+1),this._convertFromCellCoord(ze+1)))&&k.call(this,s,h,g,S,Xe,N,q,X))return}},xu.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},xu.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},xu.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,h=3+this.cells.length+1+1,g=0,S=0;S<this.cells.length;S++)g+=this.cells[S].length;var k=new Int32Array(h+g+this.keys.length+this.bboxes.length);k[0]=this.extent,k[1]=this.n,k[2]=this.padding;for(var N=h,q=0;q<s.length;q++){var X=s[q];k[3+q]=N,k.set(X,N),N+=X.length}return k[3+s.length]=N,k.set(this.keys,N),k[3+s.length+1]=N+=this.keys.length,k.set(this.bboxes,N),N+=this.bboxes.length,k.buffer};var Fp=Ge.ImageData,Ra=Ge.ImageBitmap,Ul={};function $n(s,h,g){void 0===g&&(g={}),Object.defineProperty(h,"_classRegistryKey",{value:s,writeable:!1}),Ul[s]={klass:h,omit:g.omit||[],shallow:g.shallow||[]}}for(var Hu in $n("Object",Object),hs.serialize=function(s,h){var g=s.toArrayBuffer();return h&&h.push(g),{buffer:g}},hs.deserialize=function(s){return new hs(s.buffer)},$n("Grid",hs),$n("Color",ni),$n("Error",Error),$n("ResolvedImage",gi),$n("StylePropertyFunction",wl),$n("StyleExpression",So,{omit:["_evaluator"]}),$n("ZoomDependentExpression",Bl),$n("ZoomConstantExpression",Ao),$n("CompoundExpression",ua,{omit:["_evaluate"]}),Rc)Rc[Hu]._classRegistryKey||$n("Expression_"+Hu,Rc[Hu]);function Ds(s){return s&&"undefined"!=typeof ArrayBuffer&&(s instanceof ArrayBuffer||s.constructor&&"ArrayBuffer"===s.constructor.name)}function Ua(s){return Ra&&s instanceof Ra}function Lo(s,h){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Ds(s)||Ua(s))return h&&h.push(s),s;if(ArrayBuffer.isView(s)){var g=s;return h&&h.push(g.buffer),g}if(s instanceof Fp)return h&&h.push(s.data.buffer),s;if(Array.isArray(s)){for(var S=[],k=0,N=s;k<N.length;k+=1)S.push(Lo(N[k],h));return S}if("object"==typeof s){var q=s.constructor,X=q._classRegistryKey;if(!X)throw new Error("can't serialize object of unregistered class");var ie=q.serialize?q.serialize(s,h):{};if(!q.serialize){for(var ce in s)if(s.hasOwnProperty(ce)&&!(Ul[X].omit.indexOf(ce)>=0)){var ye=s[ce];ie[ce]=Ul[X].shallow.indexOf(ce)>=0?ye:Lo(ye,h)}s instanceof Error&&(ie.message=s.message)}if(ie.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==X&&(ie.$name=X),ie}throw new Error("can't serialize object of type "+typeof s)}function bu(s){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Ds(s)||Ua(s)||ArrayBuffer.isView(s)||s instanceof Fp)return s;if(Array.isArray(s))return s.map(bu);if("object"==typeof s){var h=s.$name||"Object",g=Ul[h].klass;if(!g)throw new Error("can't deserialize unregistered class "+h);if(g.deserialize)return g.deserialize(s);for(var S=Object.create(g.prototype),k=0,N=Object.keys(s);k<N.length;k+=1){var q=N[k];if("$name"!==q){var X=s[q];S[q]=Ul[h].shallow.indexOf(q)>=0?X:bu(X)}}return S}throw new Error("can't deserialize object of type "+typeof s)}var qs=function(){this.first=!0};qs.prototype.update=function(s,h){var g=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=g,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=g,!0):(this.lastFloorZoom>g?(this.lastIntegerZoom=g+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<g&&(this.lastIntegerZoom=g,this.lastIntegerZoomTime=h),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=g,!0))};var er={"Latin-1 Supplement":function(s){return s>=128&&s<=255},Arabic:function(s){return s>=1536&&s<=1791},"Arabic Supplement":function(s){return s>=1872&&s<=1919},"Arabic Extended-A":function(s){return s>=2208&&s<=2303},"Hangul Jamo":function(s){return s>=4352&&s<=4607},"Unified Canadian Aboriginal Syllabics":function(s){return s>=5120&&s<=5759},Khmer:function(s){return s>=6016&&s<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(s){return s>=6320&&s<=6399},"General Punctuation":function(s){return s>=8192&&s<=8303},"Letterlike Symbols":function(s){return s>=8448&&s<=8527},"Number Forms":function(s){return s>=8528&&s<=8591},"Miscellaneous Technical":function(s){return s>=8960&&s<=9215},"Control Pictures":function(s){return s>=9216&&s<=9279},"Optical Character Recognition":function(s){return s>=9280&&s<=9311},"Enclosed Alphanumerics":function(s){return s>=9312&&s<=9471},"Geometric Shapes":function(s){return s>=9632&&s<=9727},"Miscellaneous Symbols":function(s){return s>=9728&&s<=9983},"Miscellaneous Symbols and Arrows":function(s){return s>=11008&&s<=11263},"CJK Radicals Supplement":function(s){return s>=11904&&s<=12031},"Kangxi Radicals":function(s){return s>=12032&&s<=12255},"Ideographic Description Characters":function(s){return s>=12272&&s<=12287},"CJK Symbols and Punctuation":function(s){return s>=12288&&s<=12351},Hiragana:function(s){return s>=12352&&s<=12447},Katakana:function(s){return s>=12448&&s<=12543},Bopomofo:function(s){return s>=12544&&s<=12591},"Hangul Compatibility Jamo":function(s){return s>=12592&&s<=12687},Kanbun:function(s){return s>=12688&&s<=12703},"Bopomofo Extended":function(s){return s>=12704&&s<=12735},"CJK Strokes":function(s){return s>=12736&&s<=12783},"Katakana Phonetic Extensions":function(s){return s>=12784&&s<=12799},"Enclosed CJK Letters and Months":function(s){return s>=12800&&s<=13055},"CJK Compatibility":function(s){return s>=13056&&s<=13311},"CJK Unified Ideographs Extension A":function(s){return s>=13312&&s<=19903},"Yijing Hexagram Symbols":function(s){return s>=19904&&s<=19967},"CJK Unified Ideographs":function(s){return s>=19968&&s<=40959},"Yi Syllables":function(s){return s>=40960&&s<=42127},"Yi Radicals":function(s){return s>=42128&&s<=42191},"Hangul Jamo Extended-A":function(s){return s>=43360&&s<=43391},"Hangul Syllables":function(s){return s>=44032&&s<=55215},"Hangul Jamo Extended-B":function(s){return s>=55216&&s<=55295},"Private Use Area":function(s){return s>=57344&&s<=63743},"CJK Compatibility Ideographs":function(s){return s>=63744&&s<=64255},"Arabic Presentation Forms-A":function(s){return s>=64336&&s<=65023},"Vertical Forms":function(s){return s>=65040&&s<=65055},"CJK Compatibility Forms":function(s){return s>=65072&&s<=65103},"Small Form Variants":function(s){return s>=65104&&s<=65135},"Arabic Presentation Forms-B":function(s){return s>=65136&&s<=65279},"Halfwidth and Fullwidth Forms":function(s){return s>=65280&&s<=65519}};function rh(s){for(var h=0,g=s;h<g.length;h+=1)if(Mh(g[h].charCodeAt(0)))return!0;return!1}function Mh(s){return!(746!==s&&747!==s&&(s<4352||!(er["Bopomofo Extended"](s)||er.Bopomofo(s)||er["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||er["CJK Compatibility Ideographs"](s)||er["CJK Compatibility"](s)||er["CJK Radicals Supplement"](s)||er["CJK Strokes"](s)||!(!er["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||12336===s)||er["CJK Unified Ideographs Extension A"](s)||er["CJK Unified Ideographs"](s)||er["Enclosed CJK Letters and Months"](s)||er["Hangul Compatibility Jamo"](s)||er["Hangul Jamo Extended-A"](s)||er["Hangul Jamo Extended-B"](s)||er["Hangul Jamo"](s)||er["Hangul Syllables"](s)||er.Hiragana(s)||er["Ideographic Description Characters"](s)||er.Kanbun(s)||er["Kangxi Radicals"](s)||er["Katakana Phonetic Extensions"](s)||er.Katakana(s)&&12540!==s||!(!er["Halfwidth and Fullwidth Forms"](s)||65288===s||65289===s||65293===s||s>=65306&&s<=65310||65339===s||65341===s||65343===s||s>=65371&&s<=65503||65507===s||s>=65512&&s<=65519)||!(!er["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||er["Unified Canadian Aboriginal Syllabics"](s)||er["Unified Canadian Aboriginal Syllabics Extended"](s)||er["Vertical Forms"](s)||er["Yijing Hexagram Symbols"](s)||er["Yi Syllables"](s)||er["Yi Radicals"](s))))}function wu(s){return!(Mh(s)||(h=s,er["Latin-1 Supplement"](h)&&(167===h||169===h||174===h||177===h||188===h||189===h||190===h||215===h||247===h)||er["General Punctuation"](h)&&(8214===h||8224===h||8225===h||8240===h||8241===h||8251===h||8252===h||8258===h||8263===h||8264===h||8265===h||8273===h)||er["Letterlike Symbols"](h)||er["Number Forms"](h)||er["Miscellaneous Technical"](h)&&(h>=8960&&h<=8967||h>=8972&&h<=8991||h>=8996&&h<=9e3||9003===h||h>=9085&&h<=9114||h>=9150&&h<=9165||9167===h||h>=9169&&h<=9179||h>=9186&&h<=9215)||er["Control Pictures"](h)&&9251!==h||er["Optical Character Recognition"](h)||er["Enclosed Alphanumerics"](h)||er["Geometric Shapes"](h)||er["Miscellaneous Symbols"](h)&&!(h>=9754&&h<=9759)||er["Miscellaneous Symbols and Arrows"](h)&&(h>=11026&&h<=11055||h>=11088&&h<=11097||h>=11192&&h<=11243)||er["CJK Symbols and Punctuation"](h)||er.Katakana(h)||er["Private Use Area"](h)||er["CJK Compatibility Forms"](h)||er["Small Form Variants"](h)||er["Halfwidth and Fullwidth Forms"](h)||8734===h||8756===h||8757===h||h>=9984&&h<=10087||h>=10102&&h<=10131||65532===h||65533===h));var h}function Oa(s){return s>=1424&&s<=2303||er["Arabic Presentation Forms-A"](s)||er["Arabic Presentation Forms-B"](s)}function ks(s,h){return!(!h&&Oa(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||er.Khmer(s))}function Cu(s){for(var h=0,g=s;h<g.length;h+=1)if(Oa(g[h].charCodeAt(0)))return!0;return!1}var Tl=null,ll="unavailable",Js=null,uc=function(s){s&&"string"==typeof s&&s.indexOf("NetworkError")>-1&&(ll="error"),Tl&&Tl(s)};function Yh(){id.fire(new oe("pluginStateChange",{pluginStatus:ll,pluginURL:Js}))}var id=new ve,to=function(){return ll},ih=function(){if("deferred"!==ll||!Js)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ll="loading",Yh(),Js&&Bo({url:Js},function(s){s?uc(s):(ll="loaded",Yh())})},Yo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return"loaded"===ll||null!=Yo.applyArabicShaping},isLoading:function(){return"loading"===ll},setState:function(s){ll=s.pluginStatus,Js=s.pluginURL},isParsed:function(){return null!=Yo.applyArabicShaping&&null!=Yo.processBidirectionalText&&null!=Yo.processStyledBidirectionalText},getPluginURL:function(){return Js}},Vr=function(s,h){this.zoom=s,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new qs,this.transition={})};Vr.prototype.isSupportedScript=function(s){return function(h,g){for(var S=0,k=h;S<k.length;S+=1)if(!ks(k[S].charCodeAt(0),g))return!1;return!0}(s,Yo.isLoaded())},Vr.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Vr.prototype.getCrossfadeParameters=function(){var s=this.zoom,h=s-Math.floor(s),g=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*g}:{fromScale:.5,toScale:1,t:1-(1-g)*h}};var ki=function(s,h){this.property=s,this.value=h,this.expression=function(g,S){if(Ih(g))return new wl(g,S);if(Gs(g)){var k=Xo(g,S);if("error"===k.result)throw new Error(k.value.map(function(q){return q.key+": "+q.message}).join(", "));return k.value}var N=g;return"string"==typeof g&&"color"===S.type&&(N=ni.parse(g)),{kind:"constant",evaluate:function(){return N}}}(void 0===h?s.specification.default:h,s.specification)};ki.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},ki.prototype.possiblyEvaluate=function(s,h,g){return this.property.possiblyEvaluate(this,s,h,g)};var La=function(s){this.property=s,this.value=new ki(s,void 0)};La.prototype.transitioned=function(s,h){return new Ja(this.property,this.value,h,et({},s.transition,this.transition),s.now)},La.prototype.untransitioned=function(){return new Ja(this.property,this.value,null,{},0)};var ps=function(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)};ps.prototype.getValue=function(s){return jn(this._values[s].value.value)},ps.prototype.setValue=function(s,h){this._values.hasOwnProperty(s)||(this._values[s]=new La(this._values[s].property)),this._values[s].value=new ki(this._values[s].property,null===h?void 0:jn(h))},ps.prototype.getTransition=function(s){return jn(this._values[s].transition)},ps.prototype.setTransition=function(s,h){this._values.hasOwnProperty(s)||(this._values[s]=new La(this._values[s].property)),this._values[s].transition=jn(h)||void 0},ps.prototype.serialize=function(){for(var s={},h=0,g=Object.keys(this._values);h<g.length;h+=1){var S=g[h],k=this.getValue(S);void 0!==k&&(s[S]=k);var N=this.getTransition(S);void 0!==N&&(s[S+"-transition"]=N)}return s},ps.prototype.transitioned=function(s,h){for(var g=new Zn(this._properties),S=0,k=Object.keys(this._values);S<k.length;S+=1){var N=k[S];g._values[N]=this._values[N].transitioned(s,h._values[N])}return g},ps.prototype.untransitioned=function(){for(var s=new Zn(this._properties),h=0,g=Object.keys(this._values);h<g.length;h+=1){var S=g[h];s._values[S]=this._values[S].untransitioned()}return s};var Ja=function(s,h,g,S,k){this.property=s,this.value=h,this.begin=k+S.delay||0,this.end=this.begin+S.duration||0,s.specification.transition&&(S.delay||S.duration)&&(this.prior=g)};Ja.prototype.possiblyEvaluate=function(s,h,g){var S=s.now||0,k=this.value.possiblyEvaluate(s,h,g),N=this.prior;if(N){if(S>this.end)return this.prior=null,k;if(this.value.isDataDriven())return this.prior=null,k;if(S<this.begin)return N.possiblyEvaluate(s,h,g);var q=(S-this.begin)/(this.end-this.begin);return this.property.interpolate(N.possiblyEvaluate(s,h,g),k,function(X){if(X<=0)return 0;if(X>=1)return 1;var ie=X*X,ce=ie*X;return 4*(X<.5?ce:3*(X-ie)+ce-.75)}(q))}return k};var Zn=function(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)};Zn.prototype.possiblyEvaluate=function(s,h,g){for(var S=new ta(this._properties),k=0,N=Object.keys(this._values);k<N.length;k+=1){var q=N[k];S._values[q]=this._values[q].possiblyEvaluate(s,h,g)}return S},Zn.prototype.hasTransition=function(){for(var s=0,h=Object.keys(this._values);s<h.length;s+=1)if(this._values[h[s]].prior)return!0;return!1};var Wu=function(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues)};Wu.prototype.getValue=function(s){return jn(this._values[s].value)},Wu.prototype.setValue=function(s,h){this._values[s]=new ki(this._values[s].property,null===h?void 0:jn(h))},Wu.prototype.serialize=function(){for(var s={},h=0,g=Object.keys(this._values);h<g.length;h+=1){var S=g[h],k=this.getValue(S);void 0!==k&&(s[S]=k)}return s},Wu.prototype.possiblyEvaluate=function(s,h,g){for(var S=new ta(this._properties),k=0,N=Object.keys(this._values);k<N.length;k+=1){var q=N[k];S._values[q]=this._values[q].possiblyEvaluate(s,h,g)}return S};var ds=function(s,h,g){this.property=s,this.value=h,this.parameters=g};ds.prototype.isConstant=function(){return"constant"===this.value.kind},ds.prototype.constantOr=function(s){return"constant"===this.value.kind?this.value.value:s},ds.prototype.evaluate=function(s,h,g,S){return this.property.evaluate(this.value,this.parameters,s,h,g,S)};var ta=function(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)};ta.prototype.get=function(s){return this._values[s]};var Un=function(s){this.specification=s};Un.prototype.possiblyEvaluate=function(s,h){return s.expression.evaluate(h)},Un.prototype.interpolate=function(s,h,g){var S=qh[this.specification.type];return S?S(s,h,g):s};var Nr=function(s,h){this.specification=s,this.overrides=h};Nr.prototype.possiblyEvaluate=function(s,h,g,S){return new ds(this,"constant"===s.expression.kind||"camera"===s.expression.kind?{kind:"constant",value:s.expression.evaluate(h,null,{},g,S)}:s.expression,h)},Nr.prototype.interpolate=function(s,h,g){if("constant"!==s.value.kind||"constant"!==h.value.kind)return s;if(void 0===s.value.value||void 0===h.value.value)return new ds(this,{kind:"constant",value:void 0},s.parameters);var S=qh[this.specification.type];return S?new ds(this,{kind:"constant",value:S(s.value.value,h.value.value,g)},s.parameters):s},Nr.prototype.evaluate=function(s,h,g,S,k,N){return"constant"===s.kind?s.value:s.evaluate(h,g,S,k,N)};var Vl=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.possiblyEvaluate=function(g,S,k,N){if(void 0===g.value)return new ds(this,{kind:"constant",value:void 0},S);if("constant"===g.expression.kind){var q=g.expression.evaluate(S,null,{},k,N),X="resolvedImage"===g.property.specification.type&&"string"!=typeof q?q.name:q,ie=this._calculate(X,X,X,S);return new ds(this,{kind:"constant",value:ie},S)}if("camera"===g.expression.kind){var ce=this._calculate(g.expression.evaluate({zoom:S.zoom-1}),g.expression.evaluate({zoom:S.zoom}),g.expression.evaluate({zoom:S.zoom+1}),S);return new ds(this,{kind:"constant",value:ce},S)}return new ds(this,g.expression,S)},h.prototype.evaluate=function(g,S,k,N,q,X){if("source"===g.kind){var ie=g.evaluate(S,k,N,q,X);return this._calculate(ie,ie,ie,S)}return"composite"===g.kind?this._calculate(g.evaluate({zoom:Math.floor(S.zoom)-1},k,N),g.evaluate({zoom:Math.floor(S.zoom)},k,N),g.evaluate({zoom:Math.floor(S.zoom)+1},k,N),S):g.value},h.prototype._calculate=function(g,S,k,N){return N.zoom>N.zoomHistory.lastIntegerZoom?{from:g,to:S}:{from:k,to:S}},h.prototype.interpolate=function(g){return g},h}(Nr),Ps=function(s){this.specification=s};Ps.prototype.possiblyEvaluate=function(s,h,g,S){if(void 0!==s.value){if("constant"===s.expression.kind){var k=s.expression.evaluate(h,null,{},g,S);return this._calculate(k,k,k,h)}return this._calculate(s.expression.evaluate(new Vr(Math.floor(h.zoom-1),h)),s.expression.evaluate(new Vr(Math.floor(h.zoom),h)),s.expression.evaluate(new Vr(Math.floor(h.zoom+1),h)),h)}},Ps.prototype._calculate=function(s,h,g,S){return S.zoom>S.zoomHistory.lastIntegerZoom?{from:s,to:h}:{from:g,to:h}},Ps.prototype.interpolate=function(s){return s};var $u=function(s){this.specification=s};$u.prototype.possiblyEvaluate=function(s,h,g,S){return!!s.expression.evaluate(h,null,{},g,S)},$u.prototype.interpolate=function(){return!1};var Rs=function(s){for(var h in this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],s){var g=s[h];g.specification.overridable&&this.overridableProperties.push(h);var S=this.defaultPropertyValues[h]=new ki(g,void 0),k=this.defaultTransitionablePropertyValues[h]=new La(g);this.defaultTransitioningPropertyValues[h]=k.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=S.possiblyEvaluate({})}};$n("DataDrivenProperty",Nr),$n("DataConstantProperty",Un),$n("CrossFadedDataDrivenProperty",Vl),$n("CrossFadedProperty",Ps),$n("ColorRampProperty",$u);var Lr=function(s){function h(g,S){if(s.call(this),this.id=g.id,this.type=g.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},"custom"!==g.type&&(this.metadata=(g=g).metadata,this.minzoom=g.minzoom,this.maxzoom=g.maxzoom,"background"!==g.type&&(this.source=g.source,this.sourceLayer=g["source-layer"],this.filter=g.filter),S.layout&&(this._unevaluatedLayout=new Wu(S.layout)),S.paint)){for(var k in this._transitionablePaint=new ps(S.paint),g.paint)this.setPaintProperty(k,g.paint[k],{validate:!1});for(var N in g.layout)this.setLayoutProperty(N,g.layout[N],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ta(S.paint)}}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},h.prototype.getLayoutProperty=function(g){return"visibility"===g?this.visibility:this._unevaluatedLayout.getValue(g)},h.prototype.setLayoutProperty=function(g,S,k){void 0===k&&(k={}),null!=S&&this._validate(Xh,"layers."+this.id+".layout."+g,g,S,k)||("visibility"!==g?this._unevaluatedLayout.setValue(g,S):this.visibility=S)},h.prototype.getPaintProperty=function(g){return Rn(g,"-transition")?this._transitionablePaint.getTransition(g.slice(0,-"-transition".length)):this._transitionablePaint.getValue(g)},h.prototype.setPaintProperty=function(g,S,k){if(void 0===k&&(k={}),null!=S&&this._validate(hp,"layers."+this.id+".paint."+g,g,S,k))return!1;if(Rn(g,"-transition"))return this._transitionablePaint.setTransition(g.slice(0,-"-transition".length),S||void 0),!1;var N=this._transitionablePaint._values[g],q="cross-faded-data-driven"===N.property.specification["property-type"],X=N.value.isDataDriven(),ie=N.value;this._transitionablePaint.setValue(g,S),this._handleSpecialPaintPropertyUpdate(g);var ce=this._transitionablePaint._values[g].value;return ce.isDataDriven()||X||q||this._handleOverridablePaintPropertyUpdate(g,ie,ce)},h.prototype._handleSpecialPaintPropertyUpdate=function(g){},h.prototype._handleOverridablePaintPropertyUpdate=function(g,S,k){return!1},h.prototype.isHidden=function(g){return!!(this.minzoom&&g<this.minzoom)||!!(this.maxzoom&&g>=this.maxzoom)||"none"===this.visibility},h.prototype.updateTransitions=function(g){this._transitioningPaint=this._transitionablePaint.transitioned(g,this._transitioningPaint)},h.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},h.prototype.recalculate=function(g,S){g.getCrossfadeParameters&&(this._crossfadeParameters=g.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(g,void 0,S)),this.paint=this._transitioningPaint.possiblyEvaluate(g,void 0,S)},h.prototype.serialize=function(){var g={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(g.layout=g.layout||{},g.layout.visibility=this.visibility),dr(g,function(S,k){return!(void 0===S||"layout"===k&&!Object.keys(S).length||"paint"===k&&!Object.keys(S).length)})},h.prototype._validate=function(g,S,k,N,q){return void 0===q&&(q={}),(!q||!1!==q.validate)&&lc(this,g.call(vi,{key:S,layerType:this.type,objectKey:k,value:N,styleSpec:pe,style:{glyphs:!0,sprite:!0}}))},h.prototype.is3D=function(){return!1},h.prototype.isTileClipped=function(){return!1},h.prototype.hasOffscreenPass=function(){return!1},h.prototype.resize=function(){},h.prototype.isStateDependent=function(){for(var g in this.paint._values){var S=this.paint.get(g);if(S instanceof ds&&Ks(S.property.specification)&&("source"===S.value.kind||"composite"===S.value.kind)&&S.value.isStateDependent)return!0}return!1},h}(ve),Vf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Eu=function(s,h){this._structArray=s,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},co=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ea(s,h){void 0===h&&(h=1);var g=0,S=0;return{members:s.map(function(k){var N=Vf[k.type].BYTES_PER_ELEMENT,q=g=pp(g,Math.max(h,N)),X=k.components||1;return S=Math.max(S,N),g+=N*X,{name:k.name,type:k.type,components:X,offset:q}}),size:pp(g,Math.max(S,h)),alignment:h}}function pp(s,h){return Math.ceil(s/h)*h}co.serialize=function(s,h){return s._trim(),h&&(s.isTransferred=!0,h.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}},co.deserialize=function(s){var h=Object.create(this.prototype);return h.arrayBuffer=s.arrayBuffer,h.length=s.length,h.capacity=s.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h},co.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},co.prototype.clear=function(){this.length=0},co.prototype.resize=function(s){this.reserve(s),this.length=s},co.prototype.reserve=function(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}},co.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var oh=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g,S){var k=this.length;return this.resize(k+1),this.emplace(k,g,S)},h.prototype.emplace=function(g,S,k){var N=2*g;return this.int16[N+0]=S,this.int16[N+1]=k,g},h}(co);oh.prototype.bytesPerElement=4,$n("StructArrayLayout2i4",oh);var cc=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g,S,k,N){var q=this.length;return this.resize(q+1),this.emplace(q,g,S,k,N)},h.prototype.emplace=function(g,S,k,N,q){var X=4*g;return this.int16[X+0]=S,this.int16[X+1]=k,this.int16[X+2]=N,this.int16[X+3]=q,g},h}(co);cc.prototype.bytesPerElement=8,$n("StructArrayLayout4i8",cc);var gn=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g,S,k,N,q,X){var ie=this.length;return this.resize(ie+1),this.emplace(ie,g,S,k,N,q,X)},h.prototype.emplace=function(g,S,k,N,q,X,ie){var ce=6*g;return this.int16[ce+0]=S,this.int16[ce+1]=k,this.int16[ce+2]=N,this.int16[ce+3]=q,this.int16[ce+4]=X,this.int16[ce+5]=ie,g},h}(co);gn.prototype.bytesPerElement=12,$n("StructArrayLayout2i4i12",gn);var Ni=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g,S,k,N,q,X){var ie=this.length;return this.resize(ie+1),this.emplace(ie,g,S,k,N,q,X)},h.prototype.emplace=function(g,S,k,N,q,X,ie){var ce=4*g,ye=8*g;return this.int16[ce+0]=S,this.int16[ce+1]=k,this.uint8[ye+4]=N,this.uint8[ye+5]=q,this.uint8[ye+6]=X,this.uint8[ye+7]=ie,g},h}(co);Ni.prototype.bytesPerElement=8,$n("StructArrayLayout2i4ub8",Ni);var Rr=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g,S){var k=this.length;return this.resize(k+1),this.emplace(k,g,S)},h.prototype.emplace=function(g,S,k){var N=2*g;return this.float32[N+0]=S,this.float32[N+1]=k,g},h}(co);Rr.prototype.bytesPerElement=8,$n("StructArrayLayout2f8",Rr);var jo=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g,S,k,N,q,X,ie,ce,ye,_e){var Ae=this.length;return this.resize(Ae+1),this.emplace(Ae,g,S,k,N,q,X,ie,ce,ye,_e)},h.prototype.emplace=function(g,S,k,N,q,X,ie,ce,ye,_e,Ae){var ze=10*g;return this.uint16[ze+0]=S,this.uint16[ze+1]=k,this.uint16[ze+2]=N,this.uint16[ze+3]=q,this.uint16[ze+4]=X,this.uint16[ze+5]=ie,this.uint16[ze+6]=ce,this.uint16[ze+7]=ye,this.uint16[ze+8]=_e,this.uint16[ze+9]=Ae,g},h}(co);jo.prototype.bytesPerElement=20,$n("StructArrayLayout10ui20",jo);var Fc=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g,S,k,N,q,X,ie,ce,ye,_e,Ae,ze){var Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,g,S,k,N,q,X,ie,ce,ye,_e,Ae,ze)},h.prototype.emplace=function(g,S,k,N,q,X,ie,ce,ye,_e,Ae,ze,Xe){var Qe=12*g;return this.int16[Qe+0]=S,this.int16[Qe+1]=k,this.int16[Qe+2]=N,this.int16[Qe+3]=q,this.uint16[Qe+4]=X,this.uint16[Qe+5]=ie,this.uint16[Qe+6]=ce,this.uint16[Qe+7]=ye,this.int16[Qe+8]=_e,this.int16[Qe+9]=Ae,this.int16[Qe+10]=ze,this.int16[Qe+11]=Xe,g},h}(co);Fc.prototype.bytesPerElement=24,$n("StructArrayLayout4i4ui4i24",Fc);var ah=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g,S,k){var N=this.length;return this.resize(N+1),this.emplace(N,g,S,k)},h.prototype.emplace=function(g,S,k,N){var q=3*g;return this.float32[q+0]=S,this.float32[q+1]=k,this.float32[q+2]=N,g},h}(co);ah.prototype.bytesPerElement=12,$n("StructArrayLayout3f12",ah);var Su=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g){var S=this.length;return this.resize(S+1),this.emplace(S,g)},h.prototype.emplace=function(g,S){return this.uint32[1*g+0]=S,g},h}(co);Su.prototype.bytesPerElement=4,$n("StructArrayLayout1ul4",Su);var hc=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g,S,k,N,q,X,ie,ce,ye){var _e=this.length;return this.resize(_e+1),this.emplace(_e,g,S,k,N,q,X,ie,ce,ye)},h.prototype.emplace=function(g,S,k,N,q,X,ie,ce,ye,_e){var Ae=10*g,ze=5*g;return this.int16[Ae+0]=S,this.int16[Ae+1]=k,this.int16[Ae+2]=N,this.int16[Ae+3]=q,this.int16[Ae+4]=X,this.int16[Ae+5]=ie,this.uint32[ze+3]=ce,this.uint16[Ae+8]=ye,this.uint16[Ae+9]=_e,g},h}(co);hc.prototype.bytesPerElement=20,$n("StructArrayLayout6i1ul2ui20",hc);var pc=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g,S,k,N,q,X){var ie=this.length;return this.resize(ie+1),this.emplace(ie,g,S,k,N,q,X)},h.prototype.emplace=function(g,S,k,N,q,X,ie){var ce=6*g;return this.int16[ce+0]=S,this.int16[ce+1]=k,this.int16[ce+2]=N,this.int16[ce+3]=q,this.int16[ce+4]=X,this.int16[ce+5]=ie,g},h}(co);pc.prototype.bytesPerElement=12,$n("StructArrayLayout2i2i2i12",pc);var oo=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g,S,k,N,q){var X=this.length;return this.resize(X+1),this.emplace(X,g,S,k,N,q)},h.prototype.emplace=function(g,S,k,N,q,X){var ie=4*g,ce=8*g;return this.float32[ie+0]=S,this.float32[ie+1]=k,this.float32[ie+2]=N,this.int16[ce+6]=q,this.int16[ce+7]=X,g},h}(co);oo.prototype.bytesPerElement=16,$n("StructArrayLayout2f1f2i16",oo);var ho=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g,S,k,N){var q=this.length;return this.resize(q+1),this.emplace(q,g,S,k,N)},h.prototype.emplace=function(g,S,k,N,q){var X=12*g,ie=3*g;return this.uint8[X+0]=S,this.uint8[X+1]=k,this.float32[ie+1]=N,this.float32[ie+2]=q,g},h}(co);ho.prototype.bytesPerElement=12,$n("StructArrayLayout2ub2f12",ho);var fs=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g,S,k){var N=this.length;return this.resize(N+1),this.emplace(N,g,S,k)},h.prototype.emplace=function(g,S,k,N){var q=3*g;return this.uint16[q+0]=S,this.uint16[q+1]=k,this.uint16[q+2]=N,g},h}(co);fs.prototype.bytesPerElement=6,$n("StructArrayLayout3ui6",fs);var sh=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g,S,k,N,q,X,ie,ce,ye,_e,Ae,ze,Xe,Qe,pt,st,St){var At=this.length;return this.resize(At+1),this.emplace(At,g,S,k,N,q,X,ie,ce,ye,_e,Ae,ze,Xe,Qe,pt,st,St)},h.prototype.emplace=function(g,S,k,N,q,X,ie,ce,ye,_e,Ae,ze,Xe,Qe,pt,st,St,At){var Lt=24*g,zt=12*g,nn=48*g;return this.int16[Lt+0]=S,this.int16[Lt+1]=k,this.uint16[Lt+2]=N,this.uint16[Lt+3]=q,this.uint32[zt+2]=X,this.uint32[zt+3]=ie,this.uint32[zt+4]=ce,this.uint16[Lt+10]=ye,this.uint16[Lt+11]=_e,this.uint16[Lt+12]=Ae,this.float32[zt+7]=ze,this.float32[zt+8]=Xe,this.uint8[nn+36]=Qe,this.uint8[nn+37]=pt,this.uint8[nn+38]=st,this.uint32[zt+10]=St,this.int16[Lt+22]=At,g},h}(co);sh.prototype.bytesPerElement=48,$n("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",sh);var Va=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g,S,k,N,q,X,ie,ce,ye,_e,Ae,ze,Xe,Qe,pt,st,St,At,Lt,zt,nn,An,zn,_r,Gn,Dr,Yn,mi){var $r=this.length;return this.resize($r+1),this.emplace($r,g,S,k,N,q,X,ie,ce,ye,_e,Ae,ze,Xe,Qe,pt,st,St,At,Lt,zt,nn,An,zn,_r,Gn,Dr,Yn,mi)},h.prototype.emplace=function(g,S,k,N,q,X,ie,ce,ye,_e,Ae,ze,Xe,Qe,pt,st,St,At,Lt,zt,nn,An,zn,_r,Gn,Dr,Yn,mi,$r){var rr=34*g,Ci=17*g;return this.int16[rr+0]=S,this.int16[rr+1]=k,this.int16[rr+2]=N,this.int16[rr+3]=q,this.int16[rr+4]=X,this.int16[rr+5]=ie,this.int16[rr+6]=ce,this.int16[rr+7]=ye,this.uint16[rr+8]=_e,this.uint16[rr+9]=Ae,this.uint16[rr+10]=ze,this.uint16[rr+11]=Xe,this.uint16[rr+12]=Qe,this.uint16[rr+13]=pt,this.uint16[rr+14]=st,this.uint16[rr+15]=St,this.uint16[rr+16]=At,this.uint16[rr+17]=Lt,this.uint16[rr+18]=zt,this.uint16[rr+19]=nn,this.uint16[rr+20]=An,this.uint16[rr+21]=zn,this.uint16[rr+22]=_r,this.uint32[Ci+12]=Gn,this.float32[Ci+13]=Dr,this.float32[Ci+14]=Yn,this.float32[Ci+15]=mi,this.float32[Ci+16]=$r,g},h}(co);Va.prototype.bytesPerElement=68,$n("StructArrayLayout8i15ui1ul4f68",Va);var Ga=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g){var S=this.length;return this.resize(S+1),this.emplace(S,g)},h.prototype.emplace=function(g,S){return this.float32[1*g+0]=S,g},h}(co);Ga.prototype.bytesPerElement=4,$n("StructArrayLayout1f4",Ga);var dc=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g,S,k){var N=this.length;return this.resize(N+1),this.emplace(N,g,S,k)},h.prototype.emplace=function(g,S,k,N){var q=3*g;return this.int16[q+0]=S,this.int16[q+1]=k,this.int16[q+2]=N,g},h}(co);dc.prototype.bytesPerElement=6,$n("StructArrayLayout3i6",dc);var au=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g,S,k){var N=this.length;return this.resize(N+1),this.emplace(N,g,S,k)},h.prototype.emplace=function(g,S,k,N){var q=4*g;return this.uint32[2*g+0]=S,this.uint16[q+2]=k,this.uint16[q+3]=N,g},h}(co);au.prototype.bytesPerElement=8,$n("StructArrayLayout1ul2ui8",au);var Qs=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g,S){var k=this.length;return this.resize(k+1),this.emplace(k,g,S)},h.prototype.emplace=function(g,S,k){var N=2*g;return this.uint16[N+0]=S,this.uint16[N+1]=k,g},h}(co);Qs.prototype.bytesPerElement=4,$n("StructArrayLayout2ui4",Qs);var Kh=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g){var S=this.length;return this.resize(S+1),this.emplace(S,g)},h.prototype.emplace=function(g,S){return this.uint16[1*g+0]=S,g},h}(co);Kh.prototype.bytesPerElement=2,$n("StructArrayLayout1ui2",Kh);var v=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},h.prototype.emplaceBack=function(g,S,k,N){var q=this.length;return this.resize(q+1),this.emplace(q,g,S,k,N)},h.prototype.emplace=function(g,S,k,N,q){var X=4*g;return this.float32[X+0]=S,this.float32[X+1]=k,this.float32[X+2]=N,this.float32[X+3]=q,g},h}(co);v.prototype.bytesPerElement=16,$n("StructArrayLayout4f16",v);var w=function(s){function h(){s.apply(this,arguments)}s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h;var g={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return g.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},g.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},g.x1.get=function(){return this._structArray.int16[this._pos2+2]},g.y1.get=function(){return this._structArray.int16[this._pos2+3]},g.x2.get=function(){return this._structArray.int16[this._pos2+4]},g.y2.get=function(){return this._structArray.int16[this._pos2+5]},g.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},g.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},g.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},g.anchorPoint.get=function(){return new Et(this.anchorPointX,this.anchorPointY)},Object.defineProperties(h.prototype,g),h}(Eu);w.prototype.size=20;var _=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.get=function(g){return new w(this,g)},h}(hc);$n("CollisionBoxArray",_);var I=function(s){function h(){s.apply(this,arguments)}s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h;var g={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return g.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},g.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},g.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},g.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},g.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},g.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},g.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},g.segment.get=function(){return this._structArray.uint16[this._pos2+10]},g.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},g.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},g.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},g.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},g.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},g.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},g.placedOrientation.set=function(S){this._structArray.uint8[this._pos1+37]=S},g.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},g.hidden.set=function(S){this._structArray.uint8[this._pos1+38]=S},g.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},g.crossTileID.set=function(S){this._structArray.uint32[this._pos4+10]=S},g.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(h.prototype,g),h}(Eu);I.prototype.size=48;var j=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.get=function(g){return new I(this,g)},h}(sh);$n("PlacedSymbolArray",j);var f=function(s){function h(){s.apply(this,arguments)}s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h;var g={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return g.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},g.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},g.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},g.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},g.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},g.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},g.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},g.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},g.key.get=function(){return this._structArray.uint16[this._pos2+8]},g.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},g.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},g.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},g.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},g.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},g.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},g.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},g.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},g.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},g.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},g.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},g.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},g.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},g.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},g.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},g.crossTileID.set=function(S){this._structArray.uint32[this._pos4+12]=S},g.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},g.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},g.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},g.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(h.prototype,g),h}(Eu);f.prototype.size=68;var l=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.get=function(g){return new f(this,g)},h}(Va);$n("SymbolInstanceArray",l);var d=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.getoffsetX=function(g){return this.float32[1*g+0]},h}(Ga);$n("GlyphOffsetArray",d);var x=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.getx=function(g){return this.int16[3*g+0]},h.prototype.gety=function(g){return this.int16[3*g+1]},h.prototype.gettileUnitDistanceFromAnchor=function(g){return this.int16[3*g+2]},h}(dc);$n("SymbolLineVertexArray",x);var M=function(s){function h(){s.apply(this,arguments)}s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h;var g={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return g.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},g.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},g.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(h.prototype,g),h}(Eu);M.prototype.size=8;var D=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.get=function(g){return new M(this,g)},h}(au);$n("FeatureIndexArray",D);var B=Ea([{name:"a_pos",components:2,type:"Int16"}],4).members,G=function(s){void 0===s&&(s=[]),this.segments=s};function W(s,h){return 256*(s=Cn(Math.floor(s),0,255))+Cn(Math.floor(h),0,255)}G.prototype.prepareSegment=function(s,h,g,S){var k=this.segments[this.segments.length-1];return s>G.MAX_VERTEX_ARRAY_LENGTH&&sr("Max vertices per segment is "+G.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+s),(!k||k.vertexLength+s>G.MAX_VERTEX_ARRAY_LENGTH||k.sortKey!==S)&&(k={vertexOffset:h.length,primitiveOffset:g.length,vertexLength:0,primitiveLength:0},void 0!==S&&(k.sortKey=S),this.segments.push(k)),k},G.prototype.get=function(){return this.segments},G.prototype.destroy=function(){for(var s=0,h=this.segments;s<h.length;s+=1){var g=h[s];for(var S in g.vaos)g.vaos[S].destroy()}},G.simpleSegment=function(s,h,g,S){return new G([{vertexOffset:s,primitiveOffset:h,vertexLength:g,primitiveLength:S,vaos:{},sortKey:0}])},G.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,$n("SegmentVector",G);var Y=Ea([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ee=C(function(s){s.exports=function(h,g){var S,k,N,q,X,ie,ce,ye;for(k=h.length-(S=3&h.length),N=g,X=3432918353,ie=461845907,ye=0;ye<k;)ce=255&h.charCodeAt(ye)|(255&h.charCodeAt(++ye))<<8|(255&h.charCodeAt(++ye))<<16|(255&h.charCodeAt(++ye))<<24,++ye,N=27492+(65535&(q=5*(65535&(N=(N^=ce=(65535&(ce=(ce=(65535&ce)*X+(((ce>>>16)*X&65535)<<16)&4294967295)<<15|ce>>>17))*ie+(((ce>>>16)*ie&65535)<<16)&4294967295)<<13|N>>>19))+((5*(N>>>16)&65535)<<16)&4294967295))+((58964+(q>>>16)&65535)<<16);switch(ce=0,S){case 3:ce^=(255&h.charCodeAt(ye+2))<<16;case 2:ce^=(255&h.charCodeAt(ye+1))<<8;case 1:N^=ce=(65535&(ce=(ce=(65535&(ce^=255&h.charCodeAt(ye)))*X+(((ce>>>16)*X&65535)<<16)&4294967295)<<15|ce>>>17))*ie+(((ce>>>16)*ie&65535)<<16)&4294967295}return N^=h.length,N=2246822507*(65535&(N^=N>>>16))+((2246822507*(N>>>16)&65535)<<16)&4294967295,N=3266489909*(65535&(N^=N>>>13))+((3266489909*(N>>>16)&65535)<<16)&4294967295,(N^=N>>>16)>>>0}}),Q=C(function(s){s.exports=function(h,g){for(var S,k=h.length,N=g^k,q=0;k>=4;)S=1540483477*(65535&(S=255&h.charCodeAt(q)|(255&h.charCodeAt(++q))<<8|(255&h.charCodeAt(++q))<<16|(255&h.charCodeAt(++q))<<24))+((1540483477*(S>>>16)&65535)<<16),N=1540483477*(65535&N)+((1540483477*(N>>>16)&65535)<<16)^(S=1540483477*(65535&(S^=S>>>24))+((1540483477*(S>>>16)&65535)<<16)),k-=4,++q;switch(k){case 3:N^=(255&h.charCodeAt(q+2))<<16;case 2:N^=(255&h.charCodeAt(q+1))<<8;case 1:N=1540483477*(65535&(N^=255&h.charCodeAt(q)))+((1540483477*(N>>>16)&65535)<<16)}return N=1540483477*(65535&(N^=N>>>13))+((1540483477*(N>>>16)&65535)<<16),(N^=N>>>15)>>>0}}),le=ee,de=Q;le.murmur3=ee,le.murmur2=de;var ge=function(){this.ids=[],this.positions=[],this.indexed=!1};ge.prototype.add=function(s,h,g,S){this.ids.push(Te(s)),this.positions.push(h,g,S)},ge.prototype.getPositions=function(s){for(var h=Te(s),g=0,S=this.ids.length-1;g<S;){var k=g+S>>1;this.ids[k]>=h?S=k:g=k+1}for(var N=[];this.ids[g]===h;)N.push({index:this.positions[3*g],start:this.positions[3*g+1],end:this.positions[3*g+2]}),g++;return N},ge.serialize=function(s,h){var g=new Float64Array(s.ids),S=new Uint32Array(s.positions);return function k(N,q,X,ie){for(;X<ie;){for(var ce=N[X+ie>>1],ye=X-1,_e=ie+1;;){do{ye++}while(N[ye]<ce);do{_e--}while(N[_e]>ce);if(ye>=_e)break;Ee(N,ye,_e),Ee(q,3*ye,3*_e),Ee(q,3*ye+1,3*_e+1),Ee(q,3*ye+2,3*_e+2)}_e-X<ie-_e?(k(N,q,X,_e),X=_e+1):(k(N,q,_e+1,ie),ie=_e)}}(g,S,0,g.length-1),h&&h.push(g.buffer,S.buffer),{ids:g,positions:S}},ge.deserialize=function(s){var h=new ge;return h.ids=s.ids,h.positions=s.positions,h.indexed=!0,h};var xe=Math.pow(2,53)-1;function Te(s){var h=+s;return!isNaN(h)&&h<=xe?h:le(String(s))}function Ee(s,h,g){var S=s[h];s[h]=s[g],s[g]=S}$n("FeaturePositionMap",ge);var Pe=function(s,h){this.gl=s.gl,this.location=h},Le=function(s){function h(g,S){s.call(this,g,S),this.current=0}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.set=function(g){this.current!==g&&(this.current=g,this.gl.uniform1i(this.location,g))},h}(Pe),Me=function(s){function h(g,S){s.call(this,g,S),this.current=0}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.set=function(g){this.current!==g&&(this.current=g,this.gl.uniform1f(this.location,g))},h}(Pe),Ue=function(s){function h(g,S){s.call(this,g,S),this.current=[0,0]}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.set=function(g){g[0]===this.current[0]&&g[1]===this.current[1]||(this.current=g,this.gl.uniform2f(this.location,g[0],g[1]))},h}(Pe),Ye=function(s){function h(g,S){s.call(this,g,S),this.current=[0,0,0]}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.set=function(g){g[0]===this.current[0]&&g[1]===this.current[1]&&g[2]===this.current[2]||(this.current=g,this.gl.uniform3f(this.location,g[0],g[1],g[2]))},h}(Pe),yt=function(s){function h(g,S){s.call(this,g,S),this.current=[0,0,0,0]}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.set=function(g){g[0]===this.current[0]&&g[1]===this.current[1]&&g[2]===this.current[2]&&g[3]===this.current[3]||(this.current=g,this.gl.uniform4f(this.location,g[0],g[1],g[2],g[3]))},h}(Pe),gt=function(s){function h(g,S){s.call(this,g,S),this.current=ni.transparent}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.set=function(g){g.r===this.current.r&&g.g===this.current.g&&g.b===this.current.b&&g.a===this.current.a||(this.current=g,this.gl.uniform4f(this.location,g.r,g.g,g.b,g.a))},h}(Pe),Ot=new Float32Array(16),dt=function(s){function h(g,S){s.call(this,g,S),this.current=Ot}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.set=function(g){if(g[12]!==this.current[12]||g[0]!==this.current[0])return this.current=g,void this.gl.uniformMatrix4fv(this.location,!1,g);for(var S=1;S<16;S++)if(g[S]!==this.current[S]){this.current=g,this.gl.uniformMatrix4fv(this.location,!1,g);break}},h}(Pe);function Nt(s){return[W(255*s.r,255*s.g),W(255*s.b,255*s.a)]}var wt=function(s,h,g){this.value=s,this.uniformNames=h.map(function(S){return"u_"+S}),this.type=g};wt.prototype.setUniform=function(s,h,g){s.set(g.constantOr(this.value))},wt.prototype.getBinding=function(s,h,g){return"color"===this.type?new gt(s,h):new Me(s,h)};var Zt=function(s,h){this.uniformNames=h.map(function(g){return"u_"+g}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Zt.prototype.setConstantPatternPositions=function(s,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=s.tlbr},Zt.prototype.setUniform=function(s,h,g,S){var k="u_pattern_to"===S?this.patternTo:"u_pattern_from"===S?this.patternFrom:"u_pixel_ratio_to"===S?this.pixelRatioTo:"u_pixel_ratio_from"===S?this.pixelRatioFrom:null;k&&s.set(k)},Zt.prototype.getBinding=function(s,h,g){return"u_pattern"===g.substr(0,9)?new yt(s,h):new Me(s,h)};var ft=function(s,h,g,S){this.expression=s,this.type=g,this.maxValue=0,this.paintVertexAttributes=h.map(function(k){return{name:"a_"+k,type:"Float32",components:"color"===g?2:1,offset:0}}),this.paintVertexArray=new S};ft.prototype.populatePaintArray=function(s,h,g,S,k){var N=this.paintVertexArray.length,q=this.expression.evaluate(new Vr(0),h,{},S,[],k);this.paintVertexArray.resize(s),this._setPaintValue(N,s,q)},ft.prototype.updatePaintArray=function(s,h,g,S){var k=this.expression.evaluate({zoom:0},g,S);this._setPaintValue(s,h,k)},ft.prototype._setPaintValue=function(s,h,g){if("color"===this.type)for(var S=Nt(g),k=s;k<h;k++)this.paintVertexArray.emplace(k,S[0],S[1]);else{for(var N=s;N<h;N++)this.paintVertexArray.emplace(N,g);this.maxValue=Math.max(this.maxValue,Math.abs(g))}},ft.prototype.upload=function(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ft.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Gt=function(s,h,g,S,k,N){this.expression=s,this.uniformNames=h.map(function(q){return"u_"+q+"_t"}),this.type=g,this.useIntegerZoom=S,this.zoom=k,this.maxValue=0,this.paintVertexAttributes=h.map(function(q){return{name:"a_"+q,type:"Float32",components:"color"===g?4:2,offset:0}}),this.paintVertexArray=new N};Gt.prototype.populatePaintArray=function(s,h,g,S,k){var N=this.expression.evaluate(new Vr(this.zoom),h,{},S,[],k),q=this.expression.evaluate(new Vr(this.zoom+1),h,{},S,[],k),X=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(X,s,N,q)},Gt.prototype.updatePaintArray=function(s,h,g,S){var k=this.expression.evaluate({zoom:this.zoom},g,S),N=this.expression.evaluate({zoom:this.zoom+1},g,S);this._setPaintValue(s,h,k,N)},Gt.prototype._setPaintValue=function(s,h,g,S){if("color"===this.type)for(var k=Nt(g),N=Nt(S),q=s;q<h;q++)this.paintVertexArray.emplace(q,k[0],k[1],N[0],N[1]);else{for(var X=s;X<h;X++)this.paintVertexArray.emplace(X,g,S);this.maxValue=Math.max(this.maxValue,Math.abs(g),Math.abs(S))}},Gt.prototype.upload=function(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Gt.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Gt.prototype.setUniform=function(s,h){var g=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,S=Cn(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);s.set(S)},Gt.prototype.getBinding=function(s,h,g){return new Me(s,h)};var Qt=function(s,h,g,S,k,N){this.expression=s,this.type=h,this.useIntegerZoom=g,this.zoom=S,this.layerId=N,this.zoomInPaintVertexArray=new k,this.zoomOutPaintVertexArray=new k};Qt.prototype.populatePaintArray=function(s,h,g){var S=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(S,s,h.patterns&&h.patterns[this.layerId],g)},Qt.prototype.updatePaintArray=function(s,h,g,S,k){this._setPaintValues(s,h,g.patterns&&g.patterns[this.layerId],k)},Qt.prototype._setPaintValues=function(s,h,g,S){if(S&&g){var k=S[g.min],N=S[g.mid],q=S[g.max];if(k&&N&&q)for(var X=s;X<h;X++)this.zoomInPaintVertexArray.emplace(X,N.tl[0],N.tl[1],N.br[0],N.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],N.pixelRatio,k.pixelRatio),this.zoomOutPaintVertexArray.emplace(X,N.tl[0],N.tl[1],N.br[0],N.br[1],q.tl[0],q.tl[1],q.br[0],q.br[1],N.pixelRatio,q.pixelRatio)}},Qt.prototype.upload=function(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,Y.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,Y.members,this.expression.isStateDependent))},Qt.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var mn=function(s,h,g){this.binders={},this._buffers=[];var S=[];for(var k in s.paint._values)if(g(k)){var N=s.paint.get(k);if(N instanceof ds&&Ks(N.property.specification)){var q=gr(k,s.type),X=N.value,ie=N.property.specification.type,ce=N.property.useIntegerZoom,ye=N.property.specification["property-type"],_e="cross-faded"===ye||"cross-faded-data-driven"===ye;if("constant"===X.kind)this.binders[k]=_e?new Zt(X.value,q):new wt(X.value,q,ie),S.push("/u_"+k);else if("source"===X.kind||_e){var Ae=wr(k,ie,"source");this.binders[k]=_e?new Qt(X,ie,ce,h,Ae,s.id):new ft(X,q,ie,Ae),S.push("/a_"+k)}else{var ze=wr(k,ie,"composite");this.binders[k]=new Gt(X,q,ie,ce,h,ze),S.push("/z_"+k)}}}this.cacheKey=S.sort().join("")};mn.prototype.getMaxValue=function(s){var h=this.binders[s];return h instanceof ft||h instanceof Gt?h.maxValue:0},mn.prototype.populatePaintArrays=function(s,h,g,S,k){for(var N in this.binders){var q=this.binders[N];(q instanceof ft||q instanceof Gt||q instanceof Qt)&&q.populatePaintArray(s,h,g,S,k)}},mn.prototype.setConstantPatternPositions=function(s,h){for(var g in this.binders){var S=this.binders[g];S instanceof Zt&&S.setConstantPatternPositions(s,h)}},mn.prototype.updatePaintArrays=function(s,h,g,S,k){var N=!1;for(var q in s)for(var X=0,ie=h.getPositions(q);X<ie.length;X+=1){var ce=ie[X],ye=g.feature(ce.index);for(var _e in this.binders){var Ae=this.binders[_e];if((Ae instanceof ft||Ae instanceof Gt||Ae instanceof Qt)&&!0===Ae.expression.isStateDependent){var ze=S.paint.get(_e);Ae.expression=ze.value,Ae.updatePaintArray(ce.start,ce.end,ye,s[q],k),N=!0}}}return N},mn.prototype.defines=function(){var s=[];for(var h in this.binders){var g=this.binders[h];(g instanceof wt||g instanceof Zt)&&s.push.apply(s,g.uniformNames.map(function(S){return"#define HAS_UNIFORM_"+S}))}return s},mn.prototype.getBinderAttributes=function(){var s=[];for(var h in this.binders){var g=this.binders[h];if(g instanceof ft||g instanceof Gt)for(var S=0;S<g.paintVertexAttributes.length;S++)s.push(g.paintVertexAttributes[S].name);else if(g instanceof Qt)for(var k=0;k<Y.members.length;k++)s.push(Y.members[k].name)}return s},mn.prototype.getBinderUniforms=function(){var s=[];for(var h in this.binders){var g=this.binders[h];if(g instanceof wt||g instanceof Zt||g instanceof Gt)for(var S=0,k=g.uniformNames;S<k.length;S+=1)s.push(k[S])}return s},mn.prototype.getPaintVertexBuffers=function(){return this._buffers},mn.prototype.getUniforms=function(s,h){var g=[];for(var S in this.binders){var k=this.binders[S];if(k instanceof wt||k instanceof Zt||k instanceof Gt)for(var N=0,q=k.uniformNames;N<q.length;N+=1){var X=q[N];if(h[X]){var ie=k.getBinding(s,h[X],X);g.push({name:X,property:S,binding:ie})}}}return g},mn.prototype.setUniforms=function(s,h,g,S){for(var k=0,N=h;k<N.length;k+=1){var q=N[k],X=q.name,ie=q.property;this.binders[ie].setUniform(q.binding,S,g.get(ie),X)}},mn.prototype.updatePaintBuffers=function(s){for(var h in this._buffers=[],this.binders){var g=this.binders[h];if(s&&g instanceof Qt){var S=2===s.fromScale?g.zoomInPaintVertexBuffer:g.zoomOutPaintVertexBuffer;S&&this._buffers.push(S)}else(g instanceof ft||g instanceof Gt)&&g.paintVertexBuffer&&this._buffers.push(g.paintVertexBuffer)}},mn.prototype.upload=function(s){for(var h in this.binders){var g=this.binders[h];(g instanceof ft||g instanceof Gt||g instanceof Qt)&&g.upload(s)}this.updatePaintBuffers()},mn.prototype.destroy=function(){for(var s in this.binders){var h=this.binders[s];(h instanceof ft||h instanceof Gt||h instanceof Qt)&&h.destroy()}};var Hn=function(s,h,g){void 0===g&&(g=function(){return!0}),this.programConfigurations={};for(var S=0,k=s;S<k.length;S+=1){var N=k[S];this.programConfigurations[N.id]=new mn(N,h,g)}this.needsUpload=!1,this._featureMap=new ge,this._bufferOffset=0};function gr(s,h){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(h+"-","").replace(/-/g,"_")]}function wr(s,h,g){var k={"line-pattern":{source:jo,composite:jo},"fill-pattern":{source:jo,composite:jo},"fill-extrusion-pattern":{source:jo,composite:jo}}[s];return k&&k[g]||{color:{source:Rr,composite:v},number:{source:Ga,composite:Rr}}[h][g]}Hn.prototype.populatePaintArrays=function(s,h,g,S,k,N){for(var q in this.programConfigurations)this.programConfigurations[q].populatePaintArrays(s,h,S,k,N);void 0!==h.id&&this._featureMap.add(h.id,g,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0},Hn.prototype.updatePaintArrays=function(s,h,g,S){for(var k=0,N=g;k<N.length;k+=1){var q=N[k];this.needsUpload=this.programConfigurations[q.id].updatePaintArrays(s,this._featureMap,h,q,S)||this.needsUpload}},Hn.prototype.get=function(s){return this.programConfigurations[s]},Hn.prototype.upload=function(s){if(this.needsUpload){for(var h in this.programConfigurations)this.programConfigurations[h].upload(s);this.needsUpload=!1}},Hn.prototype.destroy=function(){for(var s in this.programConfigurations)this.programConfigurations[s].destroy()},$n("ConstantBinder",wt),$n("CrossFadedConstantBinder",Zt),$n("SourceExpressionBinder",ft),$n("CrossFadedCompositeBinder",Qt),$n("CompositeExpressionBinder",Gt),$n("ProgramConfiguration",mn,{omit:["_buffers"]}),$n("ProgramConfigurationSet",Hn);var tr=Math.pow(2,14)-1,Cr=-tr-1;function Wr(s){for(var h=8192/s.extent,g=s.loadGeometry(),S=0;S<g.length;S++)for(var k=g[S],N=0;N<k.length;N++){var q=k[N],X=Math.round(q.x*h),ie=Math.round(q.y*h);q.x=Cn(X,Cr,tr),q.y=Cn(ie,Cr,tr),(X<q.x||X>q.x+1||ie<q.y||ie>q.y+1)&&sr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return g}function Zi(s,h){return{type:s.type,id:s.id,properties:s.properties,geometry:h?Wr(s):[]}}function ha(s,h,g,S,k){s.emplaceBack(2*h+(S+1)/2,2*g+(k+1)/2)}var Do=function(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(function(h){return h.id}),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new oh,this.indexArray=new fs,this.segments=new G,this.programConfigurations=new Hn(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(function(h){return h.isStateDependent()}).map(function(h){return h.id})};function xo(s,h){for(var g=0;g<s.length;g++)if(fe(h,s[g]))return!0;for(var S=0;S<h.length;S++)if(fe(s,h[S]))return!0;return!!O(s,h)}function Ko(s,h,g){return!!fe(s,h)||!!z(h,s,g)}function va(s,h){if(1===s.length)return he(h,s[0]);for(var g=0;g<h.length;g++)for(var S=h[g],k=0;k<S.length;k++)if(fe(s,S[k]))return!0;for(var N=0;N<s.length;N++)if(he(h,s[N]))return!0;for(var q=0;q<h.length;q++)if(O(s,h[q]))return!0;return!1}function Tu(s,h,g){if(s.length>1){if(O(s,h))return!0;for(var S=0;S<h.length;S++)if(z(h[S],s,g))return!0}for(var k=0;k<s.length;k++)if(z(s[k],h,g))return!0;return!1}function O(s,h){if(0===s.length||0===h.length)return!1;for(var g=0;g<s.length-1;g++)for(var S=s[g],k=s[g+1],N=0;N<h.length-1;N++)if(P(S,k,h[N],h[N+1]))return!0;return!1}function P(s,h,g,S){return qr(s,g,S)!==qr(h,g,S)&&qr(s,h,g)!==qr(s,h,S)}function z(s,h,g){var S=g*g;if(1===h.length)return s.distSqr(h[0])<S;for(var k=1;k<h.length;k++)if(K(s,h[k-1],h[k])<S)return!0;return!1}function K(s,h,g){var S=h.distSqr(g);if(0===S)return s.distSqr(h);var k=((s.x-h.x)*(g.x-h.x)+(s.y-h.y)*(g.y-h.y))/S;return s.distSqr(k<0?h:k>1?g:g.sub(h)._mult(k)._add(h))}function he(s,h){for(var g,S,k,N=!1,q=0;q<s.length;q++)for(var X=0,ie=(g=s[q]).length-1;X<g.length;ie=X++)(S=g[X]).y>h.y!=(k=g[ie]).y>h.y&&h.x<(k.x-S.x)*(h.y-S.y)/(k.y-S.y)+S.x&&(N=!N);return N}function fe(s,h){for(var g=!1,S=0,k=s.length-1;S<s.length;k=S++){var N=s[S],q=s[k];N.y>h.y!=q.y>h.y&&h.x<(q.x-N.x)*(h.y-N.y)/(q.y-N.y)+N.x&&(g=!g)}return g}function Ie(s,h,g){var S=g[0],k=g[2];if(s.x<S.x&&h.x<S.x||s.x>k.x&&h.x>k.x||s.y<S.y&&h.y<S.y||s.y>k.y&&h.y>k.y)return!1;var N=qr(s,h,g[0]);return N!==qr(s,h,g[1])||N!==qr(s,h,g[2])||N!==qr(s,h,g[3])}function Fe(s,h,g){var S=h.paint.get(s).value;return"constant"===S.kind?S.value:g.programConfigurations.get(h.id).getMaxValue(s)}function at(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function nt(s,h,g,S,k){if(!h[0]&&!h[1])return s;var N=Et.convert(h)._mult(k);"viewport"===g&&N._rotate(-S);for(var q=[],X=0;X<s.length;X++)q.push(s[X].sub(N));return q}Do.prototype.populate=function(s,h,g){var S=this.layers[0],k=[],N=null,q=!1;"circle"===S.type&&(q=!(N=S.layout.get("circle-sort-key")).isConstant());for(var X=0,ie=s;X<ie.length;X+=1){var ce=ie[X],ye=ce.feature,_e=ce.id,Ae=ce.index,ze=ce.sourceLayerIndex,Xe=this.layers[0]._featureFilter.needGeometry,Qe=Zi(ye,Xe);if(this.layers[0]._featureFilter.filter(new Vr(this.zoom),Qe,g)){var pt=q?N.evaluate(Qe,{},g):void 0,st={id:_e,properties:ye.properties,type:ye.type,sourceLayerIndex:ze,index:Ae,geometry:Xe?Qe.geometry:Wr(ye),patterns:{},sortKey:pt};k.push(st)}}q&&k.sort(function(_r,Gn){return _r.sortKey-Gn.sortKey});for(var St=0,At=k;St<At.length;St+=1){var Lt=At[St],zt=Lt.geometry,nn=Lt.index,An=Lt.sourceLayerIndex,zn=s[nn].feature;this.addFeature(Lt,zt,nn,g),h.featureIndex.insert(zn,zt,nn,An,this.index)}},Do.prototype.update=function(s,h,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,g)},Do.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Do.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Do.prototype.upload=function(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,B),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0},Do.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Do.prototype.addFeature=function(s,h,g,S){for(var k=0,N=h;k<N.length;k+=1)for(var q=0,X=N[k];q<X.length;q+=1){var ie=X[q],ce=ie.x,ye=ie.y;if(!(ce<0||ce>=8192||ye<0||ye>=8192)){var _e=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),Ae=_e.vertexLength;ha(this.layoutVertexArray,ce,ye,-1,-1),ha(this.layoutVertexArray,ce,ye,1,-1),ha(this.layoutVertexArray,ce,ye,1,1),ha(this.layoutVertexArray,ce,ye,-1,1),this.indexArray.emplaceBack(Ae,Ae+1,Ae+2),this.indexArray.emplaceBack(Ae,Ae+3,Ae+2),_e.vertexLength+=4,_e.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,g,{},S)},$n("CircleBucket",Do,{omit:["layers"]});var jt=new Rs({"circle-sort-key":new Nr(pe.layout_circle["circle-sort-key"])}),Pt={paint:new Rs({"circle-radius":new Nr(pe.paint_circle["circle-radius"]),"circle-color":new Nr(pe.paint_circle["circle-color"]),"circle-blur":new Nr(pe.paint_circle["circle-blur"]),"circle-opacity":new Nr(pe.paint_circle["circle-opacity"]),"circle-translate":new Un(pe.paint_circle["circle-translate"]),"circle-translate-anchor":new Un(pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Un(pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Un(pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Nr(pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Nr(pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Nr(pe.paint_circle["circle-stroke-opacity"])}),layout:jt},cn="undefined"!=typeof Float32Array?Float32Array:Array;function Sn(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function ar(s,h,g){var S=h[0],k=h[1],N=h[2],q=h[3],X=h[4],ie=h[5],ce=h[6],ye=h[7],_e=h[8],Ae=h[9],ze=h[10],Xe=h[11],Qe=h[12],pt=h[13],st=h[14],St=h[15],At=g[0],Lt=g[1],zt=g[2],nn=g[3];return s[0]=At*S+Lt*X+zt*_e+nn*Qe,s[1]=At*k+Lt*ie+zt*Ae+nn*pt,s[2]=At*N+Lt*ce+zt*ze+nn*st,s[3]=At*q+Lt*ye+zt*Xe+nn*St,s[4]=(At=g[4])*S+(Lt=g[5])*X+(zt=g[6])*_e+(nn=g[7])*Qe,s[5]=At*k+Lt*ie+zt*Ae+nn*pt,s[6]=At*N+Lt*ce+zt*ze+nn*st,s[7]=At*q+Lt*ye+zt*Xe+nn*St,s[8]=(At=g[8])*S+(Lt=g[9])*X+(zt=g[10])*_e+(nn=g[11])*Qe,s[9]=At*k+Lt*ie+zt*Ae+nn*pt,s[10]=At*N+Lt*ce+zt*ze+nn*st,s[11]=At*q+Lt*ye+zt*Xe+nn*St,s[12]=(At=g[12])*S+(Lt=g[13])*X+(zt=g[14])*_e+(nn=g[15])*Qe,s[13]=At*k+Lt*ie+zt*Ae+nn*pt,s[14]=At*N+Lt*ce+zt*ze+nn*st,s[15]=At*q+Lt*ye+zt*Xe+nn*St,s}Math.hypot||(Math.hypot=function(){for(var s=arguments,h=0,g=arguments.length;g--;)h+=s[g]*s[g];return Math.sqrt(h)});var xn,s,Xr=ar;function Sr(s,h,g){var S=h[0],k=h[1],N=h[2],q=h[3];return s[0]=g[0]*S+g[4]*k+g[8]*N+g[12]*q,s[1]=g[1]*S+g[5]*k+g[9]*N+g[13]*q,s[2]=g[2]*S+g[6]*k+g[10]*N+g[14]*q,s[3]=g[3]*S+g[7]*k+g[11]*N+g[15]*q,s}xn=new cn(3),cn!=Float32Array&&(xn[0]=0,xn[1]=0,xn[2]=0),s=new cn(4),cn!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0,s[3]=0);var en=(function(){var s=new cn(2);cn!=Float32Array&&(s[0]=0,s[1]=0)}(),function(s){function h(g){s.call(this,g,Pt)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.createBucket=function(g){return new Do(g)},h.prototype.queryRadius=function(g){var S=g;return Fe("circle-radius",this,S)+Fe("circle-stroke-width",this,S)+at(this.paint.get("circle-translate"))},h.prototype.queryIntersectsFeature=function(g,S,k,N,q,X,ie,ce){for(var ye=nt(g,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),X.angle,ie),_e=this.paint.get("circle-radius").evaluate(S,k)+this.paint.get("circle-stroke-width").evaluate(S,k),Ae="map"===this.paint.get("circle-pitch-alignment"),ze=Ae?ye:function(An,zn){return An.map(function(_r){return Vn(_r,zn)})}(ye,ce),Xe=Ae?_e*ie:_e,Qe=0,pt=N;Qe<pt.length;Qe+=1)for(var st=0,St=pt[Qe];st<St.length;st+=1){var At=St[st],Lt=Ae?At:Vn(At,ce),zt=Xe,nn=Sr([],[At.x,At.y,0,1],ce);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?zt*=nn[3]/X.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(zt*=X.cameraToCenterDistance/nn[3]),Ko(ze,Lt,zt))return!0}return!1},h}(Lr));function Vn(s,h){var g=Sr([],[s.x,s.y,0,1],h);return new Et(g[0]/g[3],g[1]/g[3])}var yr=function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h}(Do);function Br(s,h,g,S){var k=h.width,N=h.height;if(S){if(S instanceof Uint8ClampedArray)S=new Uint8Array(S.buffer);else if(S.length!==k*N*g)throw new RangeError("mismatched image size")}else S=new Uint8Array(k*N*g);return s.width=k,s.height=N,s.data=S,s}function ei(s,h,g){var S=h.width,k=h.height;if(S!==s.width||k!==s.height){var N=Br({},{width:S,height:k},g);ci(s,N,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,S),height:Math.min(s.height,k)},g),s.width=S,s.height=k,s.data=N.data}}function ci(s,h,g,S,k,N){if(0===k.width||0===k.height)return h;if(k.width>s.width||k.height>s.height||g.x>s.width-k.width||g.y>s.height-k.height)throw new RangeError("out of range source coordinates for image copy");if(k.width>h.width||k.height>h.height||S.x>h.width-k.width||S.y>h.height-k.height)throw new RangeError("out of range destination coordinates for image copy");for(var q=s.data,X=h.data,ie=0;ie<k.height;ie++)for(var ce=((g.y+ie)*s.width+g.x)*N,ye=((S.y+ie)*h.width+S.x)*N,_e=0;_e<k.width*N;_e++)X[ye+_e]=q[ce+_e];return h}$n("HeatmapBucket",yr,{omit:["layers"]});var qa=function(s,h){Br(this,s,1,h)};qa.prototype.resize=function(s){ei(this,s,1)},qa.prototype.clone=function(){return new qa({width:this.width,height:this.height},new Uint8Array(this.data))},qa.copy=function(s,h,g,S,k){ci(s,h,g,S,k,1)};var ai=function(s,h){Br(this,s,4,h)};ai.prototype.resize=function(s){ei(this,s,4)},ai.prototype.replace=function(s,h){h?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s},ai.prototype.clone=function(){return new ai({width:this.width,height:this.height},new Uint8Array(this.data))},ai.copy=function(s,h,g,S,k){ci(s,h,g,S,k,4)},$n("AlphaImage",qa),$n("RGBAImage",ai);var Iu={paint:new Rs({"heatmap-radius":new Nr(pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Nr(pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Un(pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new $u(pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Un(pe.paint_heatmap["heatmap-opacity"])})};function Xu(s){var h={},g=s.resolution||256,S=s.clips?s.clips.length:1,k=s.image||new ai({width:g,height:S}),N=function(Xe,Qe,pt){h[s.evaluationKey]=pt;var st=s.expression.evaluate(h);k.data[Xe+Qe+0]=Math.floor(255*st.r/st.a),k.data[Xe+Qe+1]=Math.floor(255*st.g/st.a),k.data[Xe+Qe+2]=Math.floor(255*st.b/st.a),k.data[Xe+Qe+3]=Math.floor(255*st.a)};if(s.clips)for(var q=0,X=0;q<S;++q,X+=4*g)for(var ie=0,ce=0;ie<g;ie++,ce+=4){var ye=ie/(g-1),_e=s.clips[q];N(X,ce,_e.start*(1-ye)+_e.end*ye)}else for(var Ae=0,ze=0;Ae<g;Ae++,ze+=4)N(0,ze,Ae/(g-1));return k}var fc=function(s){function h(g){s.call(this,g,Iu),this._updateColorRamp()}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.createBucket=function(g){return new yr(g)},h.prototype._handleSpecialPaintPropertyUpdate=function(g){"heatmap-color"===g&&this._updateColorRamp()},h.prototype._updateColorRamp=function(){this.colorRamp=Xu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},h.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},h.prototype.queryRadius=function(){return 0},h.prototype.queryIntersectsFeature=function(){return!1},h.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},h}(Lr),el={paint:new Rs({"hillshade-illumination-direction":new Un(pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Un(pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Un(pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Un(pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Un(pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Un(pe.paint_hillshade["hillshade-accent-color"])})},Sa=function(s){function h(g){s.call(this,g,el)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},h}(Lr),Mu=Ea([{name:"a_pos",components:2,type:"Int16"}],4).members,Gl=lf,Id=lf;function lf(s,h,g){g=g||2;var S,k,N,q,X,ie,ce,ye=h&&h.length,_e=ye?h[0]*g:s.length,Ae=ao(s,0,_e,g,!0),ze=[];if(!Ae||Ae.next===Ae.prev)return ze;if(ye&&(Ae=function(Qe,pt,st,St){var At,Lt,zt,nn=[];for(At=0,Lt=pt.length;At<Lt;At++)(zt=ao(Qe,pt[At]*St,At<Lt-1?pt[At+1]*St:Qe.length,St,!1))===zt.next&&(zt.steiner=!0),nn.push(su(zt));for(nn.sort(Vo),At=0;At<nn.length;At++)es(nn[At],st),st=hr(st,st.next);return st}(s,h,Ae,g)),s.length>80*g){S=N=s[0],k=q=s[1];for(var Xe=g;Xe<_e;Xe+=g)(X=s[Xe])<S&&(S=X),(ie=s[Xe+1])<k&&(k=ie),X>N&&(N=X),ie>q&&(q=ie);ce=0!==(ce=Math.max(N-S,q-k))?1/ce:0}return ti(Ae,ze,g,S,k,ce),ze}function ao(s,h,g,S,k){var N,q;if(k===yv(s,h,g,S)>0)for(N=h;N<g;N+=S)q=mv(N,s[N],s[N+1],q);else for(N=g-S;N>=h;N-=S)q=mv(N,s[N],s[N+1],q);return q&&na(q,q.next)&&(qo(q),q=q.next),q}function hr(s,h){if(!s)return s;h||(h=s);var g,S=s;do{if(g=!1,S.steiner||!na(S,S.next)&&0!==ko(S.prev,S,S.next))S=S.next;else{if(qo(S),(S=h=S.prev)===S.next)break;g=!0}}while(g||S!==h);return h}function ti(s,h,g,S,k,N,q){if(s){!q&&N&&function(ye,_e,Ae,ze){var Xe=ye;do{null===Xe.z&&(Xe.z=Go(Xe.x,Xe.y,_e,Ae,ze)),Xe.prevZ=Xe.prev,Xe.nextZ=Xe.next,Xe=Xe.next}while(Xe!==ye);Xe.prevZ.nextZ=null,Xe.prevZ=null,function(Qe){var pt,st,St,At,Lt,zt,nn,An,zn=1;do{for(st=Qe,Qe=null,Lt=null,zt=0;st;){for(zt++,St=st,nn=0,pt=0;pt<zn&&(nn++,St=St.nextZ);pt++);for(An=zn;nn>0||An>0&&St;)0!==nn&&(0===An||!St||st.z<=St.z)?(At=st,st=st.nextZ,nn--):(At=St,St=St.nextZ,An--),Lt?Lt.nextZ=At:Qe=At,At.prevZ=Lt,Lt=At;st=St}Lt.nextZ=null,zn*=2}while(zt>1)}(Xe)}(s,S,k,N);for(var X,ie,ce=s;s.prev!==s.next;)if(X=s.prev,ie=s.next,N?Uo(s,S,k,N):wi(s))h.push(X.i/g),h.push(s.i/g),h.push(ie.i/g),qo(s),s=ie.next,ce=ie.next;else if((s=ie)===ce){q?1===q?ti(s=To(hr(s),h,g),h,g,S,k,N,2):2===q&&Qa(s,h,g,S,k,N):ti(hr(s),h,g,S,k,N,1);break}}}function wi(s){var h=s.prev,g=s,S=s.next;if(ko(h,g,S)>=0)return!1;for(var k=s.next.next;k!==s.prev;){if(ms(h.x,h.y,g.x,g.y,S.x,S.y,k.x,k.y)&&ko(k.prev,k,k.next)>=0)return!1;k=k.next}return!0}function Uo(s,h,g,S){var k=s.prev,N=s,q=s.next;if(ko(k,N,q)>=0)return!1;for(var X=k.x>N.x?k.x>q.x?k.x:q.x:N.x>q.x?N.x:q.x,ie=k.y>N.y?k.y>q.y?k.y:q.y:N.y>q.y?N.y:q.y,ce=Go(k.x<N.x?k.x<q.x?k.x:q.x:N.x<q.x?N.x:q.x,k.y<N.y?k.y<q.y?k.y:q.y:N.y<q.y?N.y:q.y,h,g,S),ye=Go(X,ie,h,g,S),_e=s.prevZ,Ae=s.nextZ;_e&&_e.z>=ce&&Ae&&Ae.z<=ye;){if(_e!==s.prev&&_e!==s.next&&ms(k.x,k.y,N.x,N.y,q.x,q.y,_e.x,_e.y)&&ko(_e.prev,_e,_e.next)>=0||(_e=_e.prevZ,Ae!==s.prev&&Ae!==s.next&&ms(k.x,k.y,N.x,N.y,q.x,q.y,Ae.x,Ae.y)&&ko(Ae.prev,Ae,Ae.next)>=0))return!1;Ae=Ae.nextZ}for(;_e&&_e.z>=ce;){if(_e!==s.prev&&_e!==s.next&&ms(k.x,k.y,N.x,N.y,q.x,q.y,_e.x,_e.y)&&ko(_e.prev,_e,_e.next)>=0)return!1;_e=_e.prevZ}for(;Ae&&Ae.z<=ye;){if(Ae!==s.prev&&Ae!==s.next&&ms(k.x,k.y,N.x,N.y,q.x,q.y,Ae.x,Ae.y)&&ko(Ae.prev,Ae,Ae.next)>=0)return!1;Ae=Ae.nextZ}return!0}function To(s,h,g){var S=s;do{var k=S.prev,N=S.next.next;!na(k,N)&&Au(k,S,S.next,N)&&Bi(k,N)&&Bi(N,k)&&(h.push(k.i/g),h.push(S.i/g),h.push(N.i/g),qo(S),qo(S.next),S=s=N),S=S.next}while(S!==s);return hr(S)}function Qa(s,h,g,S,k,N){var q=s;do{for(var X=q.next.next;X!==q.prev;){if(q.i!==X.i&&Ah(q,X)){var ie=Ad(q,X);return q=hr(q,q.next),ie=hr(ie,ie.next),ti(q,h,g,S,k,N),void ti(ie,h,g,S,k,N)}X=X.next}q=q.next}while(q!==s)}function Vo(s,h){return s.x-h.x}function es(s,h){if(h=function(S,k){var N,q=k,X=S.x,ie=S.y,ce=-1/0;do{if(ie<=q.y&&ie>=q.next.y&&q.next.y!==q.y){var ye=q.x+(ie-q.y)*(q.next.x-q.x)/(q.next.y-q.y);if(ye<=X&&ye>ce){if(ce=ye,ye===X){if(ie===q.y)return q;if(ie===q.next.y)return q.next}N=q.x<q.next.x?q:q.next}}q=q.next}while(q!==k);if(!N)return null;if(X===ce)return N;var _e,Ae=N,ze=N.x,Xe=N.y,Qe=1/0;q=N;do{X>=q.x&&q.x>=ze&&X!==q.x&&ms(ie<Xe?X:ce,ie,ze,Xe,ie<Xe?ce:X,ie,q.x,q.y)&&(_e=Math.abs(ie-q.y)/(X-q.x),Bi(q,S)&&(_e<Qe||_e===Qe&&(q.x>N.x||q.x===N.x&&mc(N,q)))&&(N=q,Qe=_e)),q=q.next}while(q!==Ae);return N}(s,h)){var g=Ad(h,s);hr(h,h.next),hr(g,g.next)}}function mc(s,h){return ko(s.prev,s,h.prev)<0&&ko(h.next,s,s.next)<0}function Go(s,h,g,S,k){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-g)*k)|s<<8))|s<<4))|s<<2))|s<<1))|(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=32767*(h-S)*k)|h<<8))|h<<4))|h<<2))|h<<1))<<1}function su(s){var h=s,g=s;do{(h.x<g.x||h.x===g.x&&h.y<g.y)&&(g=h),h=h.next}while(h!==s);return g}function ms(s,h,g,S,k,N,q,X){return(k-q)*(h-X)-(s-q)*(N-X)>=0&&(s-q)*(S-X)-(g-q)*(h-X)>=0&&(g-q)*(N-X)-(k-q)*(S-X)>=0}function Ah(s,h){return s.next.i!==h.i&&s.prev.i!==h.i&&!function(g,S){var k=g;do{if(k.i!==g.i&&k.next.i!==g.i&&k.i!==S.i&&k.next.i!==S.i&&Au(k,k.next,g,S))return!0;k=k.next}while(k!==g);return!1}(s,h)&&(Bi(s,h)&&Bi(h,s)&&function(g,S){var k=g,N=!1,q=(g.x+S.x)/2,X=(g.y+S.y)/2;do{k.y>X!=k.next.y>X&&k.next.y!==k.y&&q<(k.next.x-k.x)*(X-k.y)/(k.next.y-k.y)+k.x&&(N=!N),k=k.next}while(k!==g);return N}(s,h)&&(ko(s.prev,s,h.prev)||ko(s,h.prev,h))||na(s,h)&&ko(s.prev,s,s.next)>0&&ko(h.prev,h,h.next)>0)}function ko(s,h,g){return(h.y-s.y)*(g.x-h.x)-(h.x-s.x)*(g.y-h.y)}function na(s,h){return s.x===h.x&&s.y===h.y}function Au(s,h,g,S){var k=Zs(ko(s,h,g)),N=Zs(ko(s,h,S)),q=Zs(ko(g,S,s)),X=Zs(ko(g,S,h));return k!==N&&q!==X||!(0!==k||!Md(s,g,h))||!(0!==N||!Md(s,S,h))||!(0!==q||!Md(g,s,S))||!(0!==X||!Md(g,h,S))}function Md(s,h,g){return h.x<=Math.max(s.x,g.x)&&h.x>=Math.min(s.x,g.x)&&h.y<=Math.max(s.y,g.y)&&h.y>=Math.min(s.y,g.y)}function Zs(s){return s>0?1:s<0?-1:0}function Bi(s,h){return ko(s.prev,s,s.next)<0?ko(s,h,s.next)>=0&&ko(s,s.prev,h)>=0:ko(s,h,s.prev)<0||ko(s,s.next,h)<0}function Ad(s,h){var g=new gv(s.i,s.x,s.y),S=new gv(h.i,h.x,h.y),k=s.next,N=h.prev;return s.next=h,h.prev=s,g.next=k,k.prev=g,S.next=g,g.prev=S,N.next=S,S.prev=N,S}function mv(s,h,g,S){var k=new gv(s,h,g);return S?(k.next=S.next,k.prev=S,S.next.prev=k,S.next=k):(k.prev=k,k.next=k),k}function qo(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function gv(s,h,g){this.i=s,this.x=h,this.y=g,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function yv(s,h,g,S){for(var k=0,N=h,q=g-S;N<g;N+=S)k+=(s[q]-s[N])*(s[N+1]+s[q+1]),q=N;return k}function dy(s,h,g,S,k){!function N(q,X,ie,ce,ye){for(;ce>ie;){if(ce-ie>600){var _e=ce-ie+1,Ae=X-ie+1,ze=Math.log(_e),Xe=.5*Math.exp(2*ze/3),Qe=.5*Math.sqrt(ze*Xe*(_e-Xe)/_e)*(Ae-_e/2<0?-1:1);N(q,X,Math.max(ie,Math.floor(X-Ae*Xe/_e+Qe)),Math.min(ce,Math.floor(X+(_e-Ae)*Xe/_e+Qe)),ye)}var pt=q[X],st=ie,St=ce;for(Du(q,ie,X),ye(q[ce],pt)>0&&Du(q,ie,ce);st<St;){for(Du(q,st,St),st++,St--;ye(q[st],pt)<0;)st++;for(;ye(q[St],pt)>0;)St--}0===ye(q[ie],pt)?Du(q,ie,St):Du(q,++St,ce),St<=X&&(ie=St+1),X<=St&&(ce=St-1)}}(s,h,g||0,S||s.length-1,k||wg)}function Du(s,h,g){var S=s[h];s[h]=s[g],s[g]=S}function wg(s,h){return s<h?-1:s>h?1:0}function Dh(s,h){var g=s.length;if(g<=1)return[s];for(var S,k,N=[],q=0;q<g;q++){var X=Es(s[q]);0!==X&&(s[q].area=Math.abs(X),void 0===k&&(k=X<0),k===X<0?(S&&N.push(S),S=[s[q]]):S.push(s[q]))}if(S&&N.push(S),h>1)for(var ie=0;ie<N.length;ie++)N[ie].length<=h||(dy(N[ie],h,1,N[ie].length-1,Dd),N[ie]=N[ie].slice(0,h));return N}function Dd(s,h){return h.area-s.area}function Im(s,h,g){for(var S=g.patternDependencies,k=!1,N=0,q=h;N<q.length;N+=1){var X=q[N].paint.get(s+"-pattern");X.isConstant()||(k=!0);var ie=X.constantOr(null);ie&&(k=!0,S[ie.to]=!0,S[ie.from]=!0)}return k}function od(s,h,g,S,k){for(var N=k.patternDependencies,q=0,X=h;q<X.length;q+=1){var ie=X[q],ce=ie.paint.get(s+"-pattern").value;if("constant"!==ce.kind){var ye=ce.evaluate({zoom:S-1},g,{},k.availableImages),_e=ce.evaluate({zoom:S},g,{},k.availableImages),Ae=ce.evaluate({zoom:S+1},g,{},k.availableImages);_e=_e&&_e.name?_e.name:_e,Ae=Ae&&Ae.name?Ae.name:Ae,N[ye=ye&&ye.name?ye.name:ye]=!0,N[_e]=!0,N[Ae]=!0,g.patterns[ie.id]={min:ye,mid:_e,max:Ae}}}return g}lf.deviation=function(s,h,g,S){var k=h&&h.length,N=Math.abs(yv(s,0,k?h[0]*g:s.length,g));if(k)for(var q=0,X=h.length;q<X;q++)N-=Math.abs(yv(s,h[q]*g,q<X-1?h[q+1]*g:s.length,g));var ie=0;for(q=0;q<S.length;q+=3){var ce=S[q]*g,ye=S[q+1]*g,_e=S[q+2]*g;ie+=Math.abs((s[ce]-s[_e])*(s[ye+1]-s[ce+1])-(s[ce]-s[ye])*(s[_e+1]-s[ce+1]))}return 0===N&&0===ie?0:Math.abs((ie-N)/N)},lf.flatten=function(s){for(var h=s[0][0].length,g={vertices:[],holes:[],dimensions:h},S=0,k=0;k<s.length;k++){for(var N=0;N<s[k].length;N++)for(var q=0;q<h;q++)g.vertices.push(s[k][N][q]);k>0&&g.holes.push(S+=s[k-1].length)}return g},Gl.default=Id;var kh=function(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(function(h){return h.id}),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new oh,this.indexArray=new fs,this.indexArray2=new Qs,this.programConfigurations=new Hn(s.layers,s.zoom),this.segments=new G,this.segments2=new G,this.stateDependentLayerIds=this.layers.filter(function(h){return h.isStateDependent()}).map(function(h){return h.id})};kh.prototype.populate=function(s,h,g){this.hasPattern=Im("fill",this.layers,h);for(var S=this.layers[0].layout.get("fill-sort-key"),k=!S.isConstant(),N=[],q=0,X=s;q<X.length;q+=1){var ie=X[q],ce=ie.feature,ye=ie.id,_e=ie.index,Ae=ie.sourceLayerIndex,ze=this.layers[0]._featureFilter.needGeometry,Xe=Zi(ce,ze);if(this.layers[0]._featureFilter.filter(new Vr(this.zoom),Xe,g)){var Qe=k?S.evaluate(Xe,{},g,h.availableImages):void 0,pt={id:ye,properties:ce.properties,type:ce.type,sourceLayerIndex:Ae,index:_e,geometry:ze?Xe.geometry:Wr(ce),patterns:{},sortKey:Qe};N.push(pt)}}k&&N.sort(function(zn,_r){return zn.sortKey-_r.sortKey});for(var st=0,St=N;st<St.length;st+=1){var At=St[st],Lt=At.geometry,zt=At.index,nn=At.sourceLayerIndex;if(this.hasPattern){var An=od("fill",this.layers,At,this.zoom,h);this.patternFeatures.push(An)}else this.addFeature(At,Lt,zt,g,{});h.featureIndex.insert(s[zt].feature,Lt,zt,nn,this.index)}},kh.prototype.update=function(s,h,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,g)},kh.prototype.addFeatures=function(s,h,g){for(var S=0,k=this.patternFeatures;S<k.length;S+=1){var N=k[S];this.addFeature(N,N.geometry,N.index,h,g)}},kh.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},kh.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},kh.prototype.upload=function(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Mu),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0},kh.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},kh.prototype.addFeature=function(s,h,g,S,k){for(var N=0,q=Dh(h,500);N<q.length;N+=1){for(var X=q[N],ie=0,ce=0,ye=X;ce<ye.length;ce+=1)ie+=ye[ce].length;for(var _e=this.segments.prepareSegment(ie,this.layoutVertexArray,this.indexArray),Ae=_e.vertexLength,ze=[],Xe=[],Qe=0,pt=X;Qe<pt.length;Qe+=1){var st=pt[Qe];if(0!==st.length){st!==X[0]&&Xe.push(ze.length/2);var St=this.segments2.prepareSegment(st.length,this.layoutVertexArray,this.indexArray2),At=St.vertexLength;this.layoutVertexArray.emplaceBack(st[0].x,st[0].y),this.indexArray2.emplaceBack(At+st.length-1,At),ze.push(st[0].x),ze.push(st[0].y);for(var Lt=1;Lt<st.length;Lt++)this.layoutVertexArray.emplaceBack(st[Lt].x,st[Lt].y),this.indexArray2.emplaceBack(At+Lt-1,At+Lt),ze.push(st[Lt].x),ze.push(st[Lt].y);St.vertexLength+=st.length,St.primitiveLength+=st.length}}for(var zt=Gl(ze,Xe),nn=0;nn<zt.length;nn+=3)this.indexArray.emplaceBack(Ae+zt[nn],Ae+zt[nn+1],Ae+zt[nn+2]);_e.vertexLength+=ie,_e.primitiveLength+=zt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,g,k,S)},$n("FillBucket",kh,{omit:["layers","patternFeatures"]});var vv=new Rs({"fill-sort-key":new Nr(pe.layout_fill["fill-sort-key"])}),vx={paint:new Rs({"fill-antialias":new Un(pe.paint_fill["fill-antialias"]),"fill-opacity":new Nr(pe.paint_fill["fill-opacity"]),"fill-color":new Nr(pe.paint_fill["fill-color"]),"fill-outline-color":new Nr(pe.paint_fill["fill-outline-color"]),"fill-translate":new Un(pe.paint_fill["fill-translate"]),"fill-translate-anchor":new Un(pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Vl(pe.paint_fill["fill-pattern"])}),layout:vv},_v=function(s){function h(g){s.call(this,g,vx)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.recalculate=function(g,S){s.prototype.recalculate.call(this,g,S);var k=this.paint._values["fill-outline-color"];"constant"===k.value.kind&&void 0===k.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},h.prototype.createBucket=function(g){return new kh(g)},h.prototype.queryRadius=function(){return at(this.paint.get("fill-translate"))},h.prototype.queryIntersectsFeature=function(g,S,k,N,q,X,ie){return va(nt(g,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),X.angle,ie),N)},h.prototype.isTileClipped=function(){return!0},h}(Lr),xv=Ea([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,fy=gc;function gc(s,h,g,S,k){this.properties={},this.extent=g,this.type=0,this._pbf=s,this._geometry=-1,this._keys=S,this._values=k,s.readFields(Mm,this,h)}function Mm(s,h,g){1==s?h.id=g.readVarint():2==s?function(S,k){for(var N=S.readVarint()+S.pos;S.pos<N;){var q=k._keys[S.readVarint()],X=k._values[S.readVarint()];k.properties[q]=X}}(g,h):3==s?h.type=g.readVarint():4==s&&(h._geometry=g.pos)}function uf(s){for(var h,g,S=0,k=0,N=s.length,q=N-1;k<N;q=k++)S+=((g=s[q]).x-(h=s[k]).x)*(h.y+g.y);return S}gc.types=["Unknown","Point","LineString","Polygon"],gc.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var h,g=s.readVarint()+s.pos,S=1,k=0,N=0,q=0,X=[];s.pos<g;){if(k<=0){var ie=s.readVarint();S=7&ie,k=ie>>3}if(k--,1===S||2===S)N+=s.readSVarint(),q+=s.readSVarint(),1===S&&(h&&X.push(h),h=[]),h.push(new Et(N,q));else{if(7!==S)throw new Error("unknown command "+S);h&&h.push(h[0].clone())}}return h&&X.push(h),X},gc.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var h=s.readVarint()+s.pos,g=1,S=0,k=0,N=0,q=1/0,X=-1/0,ie=1/0,ce=-1/0;s.pos<h;){if(S<=0){var ye=s.readVarint();g=7&ye,S=ye>>3}if(S--,1===g||2===g)(k+=s.readSVarint())<q&&(q=k),k>X&&(X=k),(N+=s.readSVarint())<ie&&(ie=N),N>ce&&(ce=N);else if(7!==g)throw new Error("unknown command "+g)}return[q,ie,X,ce]},gc.prototype.toGeoJSON=function(s,h,g){var S,k,N=this.extent*Math.pow(2,g),q=this.extent*s,X=this.extent*h,ie=this.loadGeometry(),ce=gc.types[this.type];function ye(ze){for(var Xe=0;Xe<ze.length;Xe++){var Qe=ze[Xe];ze[Xe]=[360*(Qe.x+q)/N-180,360/Math.PI*Math.atan(Math.exp((180-360*(Qe.y+X)/N)*Math.PI/180))-90]}}switch(this.type){case 1:var _e=[];for(S=0;S<ie.length;S++)_e[S]=ie[S][0];ye(ie=_e);break;case 2:for(S=0;S<ie.length;S++)ye(ie[S]);break;case 3:for(ie=function(ze){var Xe=ze.length;if(Xe<=1)return[ze];for(var Qe,pt,st=[],St=0;St<Xe;St++){var At=uf(ze[St]);0!==At&&(void 0===pt&&(pt=At<0),pt===At<0?(Qe&&st.push(Qe),Qe=[ze[St]]):Qe.push(ze[St]))}return Qe&&st.push(Qe),st}(ie),S=0;S<ie.length;S++)for(k=0;k<ie[S].length;k++)ye(ie[S][k])}1===ie.length?ie=ie[0]:ce="Multi"+ce;var Ae={type:"Feature",geometry:{type:ce,coordinates:ie},properties:this.properties};return"id"in this&&(Ae.id=this.id),Ae};var Am=Dm;function Dm(s,h){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(_x,this,h),this.length=this._features.length}function _x(s,h,g){15===s?h.version=g.readVarint():1===s?h.name=g.readString():5===s?h.extent=g.readVarint():2===s?h._features.push(g.pos):3===s?h._keys.push(g.readString()):4===s&&h._values.push(function(S){for(var k=null,N=S.readVarint()+S.pos;S.pos<N;){var q=S.readVarint()>>3;k=1===q?S.readString():2===q?S.readFloat():3===q?S.readDouble():4===q?S.readVarint64():5===q?S.readVarint():6===q?S.readSVarint():7===q?S.readBoolean():null}return k}(g))}function B_(s,h,g){if(3===s){var S=new Am(g,g.readVarint()+g.pos);S.length&&(h[S.name]=S)}}Dm.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var h=this._pbf.readVarint()+this._pbf.pos;return new fy(this._pbf,h,this.extent,this._keys,this._values)};var km={VectorTile:function(s,h){this.layers=s.readFields(B_,{},h)},VectorTileFeature:fy,VectorTileLayer:Am},my=km.VectorTileFeature.types,bv=Math.pow(2,13);function zp(s,h,g,S,k,N,q,X){s.emplaceBack(h,g,2*Math.floor(S*bv)+q,k*bv*2,N*bv*2,Math.round(X))}var Jh=function(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(function(h){return h.id}),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new gn,this.indexArray=new fs,this.programConfigurations=new Hn(s.layers,s.zoom),this.segments=new G,this.stateDependentLayerIds=this.layers.filter(function(h){return h.isStateDependent()}).map(function(h){return h.id})};function j_(s,h){return s.x===h.x&&(s.x<0||s.x>8192)||s.y===h.y&&(s.y<0||s.y>8192)}Jh.prototype.populate=function(s,h,g){this.features=[],this.hasPattern=Im("fill-extrusion",this.layers,h);for(var S=0,k=s;S<k.length;S+=1){var N=k[S],q=N.feature,X=N.id,ie=N.index,ce=N.sourceLayerIndex,ye=this.layers[0]._featureFilter.needGeometry,_e=Zi(q,ye);if(this.layers[0]._featureFilter.filter(new Vr(this.zoom),_e,g)){var Ae={id:X,sourceLayerIndex:ce,index:ie,geometry:ye?_e.geometry:Wr(q),properties:q.properties,type:q.type,patterns:{}};this.hasPattern?this.features.push(od("fill-extrusion",this.layers,Ae,this.zoom,h)):this.addFeature(Ae,Ae.geometry,ie,g,{}),h.featureIndex.insert(q,Ae.geometry,ie,ce,this.index,!0)}}},Jh.prototype.addFeatures=function(s,h,g){for(var S=0,k=this.features;S<k.length;S+=1){var N=k[S];this.addFeature(N,N.geometry,N.index,h,g)}},Jh.prototype.update=function(s,h,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,g)},Jh.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Jh.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Jh.prototype.upload=function(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,xv),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0},Jh.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Jh.prototype.addFeature=function(s,h,g,S,k){for(var N=0,q=Dh(h,500);N<q.length;N+=1){for(var X=q[N],ie=0,ce=0,ye=X;ce<ye.length;ce+=1)ie+=ye[ce].length;for(var _e=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),Ae=0,ze=X;Ae<ze.length;Ae+=1){var Xe=ze[Ae];if(0!==Xe.length&&!((Ci=Xe).every(function(si){return si.x<0})||Ci.every(function(si){return si.x>8192})||Ci.every(function(si){return si.y<0})||Ci.every(function(si){return si.y>8192})))for(var Qe=0,pt=0;pt<Xe.length;pt++){var st=Xe[pt];if(pt>=1){var St=Xe[pt-1];if(!j_(st,St)){_e.vertexLength+4>G.MAX_VERTEX_ARRAY_LENGTH&&(_e=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var At=st.sub(St)._perp()._unit(),Lt=St.dist(st);Qe+Lt>32768&&(Qe=0),zp(this.layoutVertexArray,st.x,st.y,At.x,At.y,0,0,Qe),zp(this.layoutVertexArray,st.x,st.y,At.x,At.y,0,1,Qe),zp(this.layoutVertexArray,St.x,St.y,At.x,At.y,0,0,Qe+=Lt),zp(this.layoutVertexArray,St.x,St.y,At.x,At.y,0,1,Qe);var zt=_e.vertexLength;this.indexArray.emplaceBack(zt,zt+2,zt+1),this.indexArray.emplaceBack(zt+1,zt+2,zt+3),_e.vertexLength+=4,_e.primitiveLength+=2}}}}if(_e.vertexLength+ie>G.MAX_VERTEX_ARRAY_LENGTH&&(_e=this.segments.prepareSegment(ie,this.layoutVertexArray,this.indexArray)),"Polygon"===my[s.type]){for(var nn=[],An=[],zn=_e.vertexLength,_r=0,Gn=X;_r<Gn.length;_r+=1){var Dr=Gn[_r];if(0!==Dr.length){Dr!==X[0]&&An.push(nn.length/2);for(var Yn=0;Yn<Dr.length;Yn++){var mi=Dr[Yn];zp(this.layoutVertexArray,mi.x,mi.y,0,0,1,1,0),nn.push(mi.x),nn.push(mi.y)}}}for(var $r=Gl(nn,An),rr=0;rr<$r.length;rr+=3)this.indexArray.emplaceBack(zn+$r[rr],zn+$r[rr+2],zn+$r[rr+1]);_e.primitiveLength+=$r.length/3,_e.vertexLength+=ie}}var Ci;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,g,k,S)},$n("FillExtrusionBucket",Jh,{omit:["layers","features"]});var Xn={paint:new Rs({"fill-extrusion-opacity":new Un(pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Nr(pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Un(pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Un(pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Vl(pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Nr(pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Nr(pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Un(pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},wv=function(s){function h(g){s.call(this,g,Xn)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.createBucket=function(g){return new Jh(g)},h.prototype.queryRadius=function(){return at(this.paint.get("fill-extrusion-translate"))},h.prototype.is3D=function(){return!0},h.prototype.queryIntersectsFeature=function(g,S,k,N,q,X,ie,ce){var ye=nt(g,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),X.angle,ie),_e=this.paint.get("fill-extrusion-height").evaluate(S,k),Ae=this.paint.get("fill-extrusion-base").evaluate(S,k),ze=function(Qe,pt,st,St){for(var At=[],Lt=0,zt=Qe;Lt<zt.length;Lt+=1){var nn=zt[Lt],An=[nn.x,nn.y,0,1];Sr(An,An,pt),At.push(new Et(An[0]/An[3],An[1]/An[3]))}return At}(ye,ce),Xe=function(Qe,pt,st,St){for(var At=[],Lt=[],zt=St[8]*pt,nn=St[9]*pt,An=St[10]*pt,zn=St[11]*pt,_r=St[8]*st,Gn=St[9]*st,Dr=St[10]*st,Yn=St[11]*st,mi=0,$r=Qe;mi<$r.length;mi+=1){for(var rr=[],Ci=[],si=0,so=$r[mi];si<so.length;si+=1){var Tr=so[si],ji=Tr.x,Ia=Tr.y,ns=St[0]*ji+St[4]*Ia+St[12],Ha=St[1]*ji+St[5]*Ia+St[13],_a=St[2]*ji+St[6]*Ia+St[14],gs=St[3]*ji+St[7]*Ia+St[15],Hs=_a+An,Os=gs+zn,uu=ns+_r,ys=Ha+Gn,cu=_a+Dr,rs=gs+Yn,vs=new Et((ns+zt)/Os,(Ha+nn)/Os);vs.z=Hs/Os,rr.push(vs);var Ei=new Et(uu/rs,ys/rs);Ei.z=cu/rs,Ci.push(Ei)}At.push(rr),Lt.push(Ci)}return[At,Lt]}(N,Ae,_e,ce);return function(Qe,pt,st){var St=1/0;va(st,pt)&&(St=kd(st,pt[0]));for(var At=0;At<pt.length;At++)for(var Lt=pt[At],zt=Qe[At],nn=0;nn<Lt.length-1;nn++){var An=Lt[nn],zn=[An,Lt[nn+1],zt[nn+1],zt[nn],An];xo(st,zn)&&(St=Math.min(St,kd(st,zn)))}return St!==1/0&&St}(Xe[0],Xe[1],ze)},h}(Lr);function gy(s,h){return s.x*h.x+s.y*h.y}function kd(s,h){if(1===s.length){for(var g,S=0,k=h[S++];!g||k.equals(g);)if(!(g=h[S++]))return 1/0;for(;S<h.length;S++){var N=h[S],q=s[0],X=g.sub(k),ie=N.sub(k),ce=q.sub(k),ye=gy(X,X),_e=gy(X,ie),Ae=gy(ie,ie),ze=gy(ce,X),Xe=gy(ce,ie),Qe=ye*Ae-_e*_e,pt=(Ae*ze-_e*Xe)/Qe,st=(ye*Xe-_e*ze)/Qe,St=k.z*(1-pt-st)+g.z*pt+N.z*st;if(isFinite(St))return St}return 1/0}for(var At=1/0,Lt=0,zt=h;Lt<zt.length;Lt+=1)At=Math.min(At,zt[Lt].z);return At}var cf=Ea([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,U_=Ea([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,V_=km.VectorTileFeature.types,xx=Math.cos(Math.PI/180*37.5),Pm=Math.pow(2,14)/.5,po=function(s){var h=this;this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(function(g){return g.id}),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(g){h.gradients[g.id]={}}),this.layoutVertexArray=new Ni,this.layoutVertexArray2=new Rr,this.indexArray=new fs,this.programConfigurations=new Hn(s.layers,s.zoom),this.segments=new G,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(g){return g.isStateDependent()}).map(function(g){return g.id})};po.prototype.populate=function(s,h,g){this.hasPattern=Im("line",this.layers,h);for(var S=this.layers[0].layout.get("line-sort-key"),k=!S.isConstant(),N=[],q=0,X=s;q<X.length;q+=1){var ie=X[q],ce=ie.feature,ye=ie.id,_e=ie.index,Ae=ie.sourceLayerIndex,ze=this.layers[0]._featureFilter.needGeometry,Xe=Zi(ce,ze);if(this.layers[0]._featureFilter.filter(new Vr(this.zoom),Xe,g)){var Qe=k?S.evaluate(Xe,{},g):void 0,pt={id:ye,properties:ce.properties,type:ce.type,sourceLayerIndex:Ae,index:_e,geometry:ze?Xe.geometry:Wr(ce),patterns:{},sortKey:Qe};N.push(pt)}}k&&N.sort(function(zn,_r){return zn.sortKey-_r.sortKey});for(var st=0,St=N;st<St.length;st+=1){var At=St[st],Lt=At.geometry,zt=At.index,nn=At.sourceLayerIndex;if(this.hasPattern){var An=od("line",this.layers,At,this.zoom,h);this.patternFeatures.push(An)}else this.addFeature(At,Lt,zt,g,{});h.featureIndex.insert(s[zt].feature,Lt,zt,nn,this.index)}},po.prototype.update=function(s,h,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,g)},po.prototype.addFeatures=function(s,h,g){for(var S=0,k=this.patternFeatures;S<k.length;S+=1){var N=k[S];this.addFeature(N,N.geometry,N.index,h,g)}},po.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},po.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},po.prototype.upload=function(s){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,U_)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,cf),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0},po.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},po.prototype.lineFeatureClips=function(s){if(s.properties&&s.properties.hasOwnProperty("mapbox_clip_start")&&s.properties.hasOwnProperty("mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}},po.prototype.addFeature=function(s,h,g,S,k){var N=this.layers[0].layout,q=N.get("line-join").evaluate(s,{}),X=N.get("line-cap"),ie=N.get("line-miter-limit"),ce=N.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(var ye=0,_e=h;ye<_e.length;ye+=1)this.addLine(_e[ye],s,q,X,ie,ce);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,g,k,S)},po.prototype.addLine=function(s,h,g,S,k,N){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var q=0;q<s.length-1;q++)this.totalDistance+=s[q].dist(s[q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var X="Polygon"===V_[h.type],ie=s.length;ie>=2&&s[ie-1].equals(s[ie-2]);)ie--;for(var ce=0;ce<ie-1&&s[ce].equals(s[ce+1]);)ce++;if(!(ie<(X?3:2))){"bevel"===g&&(k=1.05);var ye,_e=this.overscaling<=16?122880/(512*this.overscaling):0,Ae=this.segments.prepareSegment(10*ie,this.layoutVertexArray,this.indexArray),ze=void 0,Xe=void 0,Qe=void 0,pt=void 0;this.e1=this.e2=-1,X&&(pt=s[ce].sub(ye=s[ie-2])._unit()._perp());for(var st=ce;st<ie;st++)if(!(Xe=st===ie-1?X?s[ce+1]:void 0:s[st+1])||!s[st].equals(Xe)){pt&&(Qe=pt),ye&&(ze=ye),ye=s[st],pt=Xe?Xe.sub(ye)._unit()._perp():Qe;var St=(Qe=Qe||pt).add(pt);0===St.x&&0===St.y||St._unit();var At=Qe.x*pt.x+Qe.y*pt.y,Lt=St.x*pt.x+St.y*pt.y,zt=0!==Lt?1/Lt:1/0,nn=2*Math.sqrt(2-2*Lt),An=Lt<xx&&ze&&Xe,zn=Qe.x*pt.y-Qe.y*pt.x>0;if(An&&st>ce){var _r=ye.dist(ze);if(_r>2*_e){var Gn=ye.sub(ye.sub(ze)._mult(_e/_r)._round());this.updateDistance(ze,Gn),this.addCurrentVertex(Gn,Qe,0,0,Ae),ze=Gn}}var Dr=ze&&Xe,Yn=Dr?g:X?"butt":S;if(Dr&&"round"===Yn&&(zt<N?Yn="miter":zt<=2&&(Yn="fakeround")),"miter"===Yn&&zt>k&&(Yn="bevel"),"bevel"===Yn&&(zt>2&&(Yn="flipbevel"),zt<k&&(Yn="miter")),ze&&this.updateDistance(ze,ye),"miter"===Yn)St._mult(zt),this.addCurrentVertex(ye,St,0,0,Ae);else if("flipbevel"===Yn){if(zt>100)St=pt.mult(-1);else{var mi=zt*Qe.add(pt).mag()/Qe.sub(pt).mag();St._perp()._mult(mi*(zn?-1:1))}this.addCurrentVertex(ye,St,0,0,Ae),this.addCurrentVertex(ye,St.mult(-1),0,0,Ae)}else if("bevel"===Yn||"fakeround"===Yn){var $r=-Math.sqrt(zt*zt-1),rr=zn?$r:0,Ci=zn?0:$r;if(ze&&this.addCurrentVertex(ye,Qe,rr,Ci,Ae),"fakeround"===Yn)for(var si=Math.round(180*nn/Math.PI/20),so=1;so<si;so++){var Tr=so/si;if(.5!==Tr){var ji=Tr-.5;Tr+=Tr*ji*(Tr-1)*((1.0904+At*(At*(3.55645-1.43519*At)-3.2452))*ji*ji+(.848013+At*(.215638*At-1.06021)))}var Ia=pt.sub(Qe)._mult(Tr)._add(Qe)._unit()._mult(zn?-1:1);this.addHalfVertex(ye,Ia.x,Ia.y,!1,zn,0,Ae)}Xe&&this.addCurrentVertex(ye,pt,-rr,-Ci,Ae)}else if("butt"===Yn)this.addCurrentVertex(ye,St,0,0,Ae);else if("square"===Yn){var ns=ze?1:-1;this.addCurrentVertex(ye,St,ns,ns,Ae)}else"round"===Yn&&(ze&&(this.addCurrentVertex(ye,Qe,0,0,Ae),this.addCurrentVertex(ye,Qe,1,1,Ae,!0)),Xe&&(this.addCurrentVertex(ye,pt,-1,-1,Ae,!0),this.addCurrentVertex(ye,pt,0,0,Ae)));if(An&&st<ie-1){var Ha=ye.dist(Xe);if(Ha>2*_e){var _a=ye.add(Xe.sub(ye)._mult(_e/Ha)._round());this.updateDistance(ye,_a),this.addCurrentVertex(_a,pt,0,0,Ae),ye=_a}}}}},po.prototype.addCurrentVertex=function(s,h,g,S,k,N){void 0===N&&(N=!1);var q=h.y*S-h.x,X=-h.y-h.x*S;this.addHalfVertex(s,h.x+h.y*g,h.y-h.x*g,N,!1,g,k),this.addHalfVertex(s,q,X,N,!0,-S,k),this.distance>Pm/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(s,h,g,S,k,N))},po.prototype.addHalfVertex=function(s,h,g,S,k,N,q){var X=.5*(this.lineClips?this.scaledDistance*(Pm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s.x<<1)+(S?1:0),(s.y<<1)+(k?1:0),Math.round(63*h)+128,Math.round(63*g)+128,1+(0===N?0:N<0?-1:1)|(63&X)<<2,X>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var ie=q.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,ie),q.primitiveLength++),k?this.e2=ie:this.e1=ie},po.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},po.prototype.updateDistance=function(s,h){this.distance+=s.dist(h),this.updateScaledDistance()},$n("LineBucket",po,{omit:["layers","patternFeatures"]});var Cv=new Rs({"line-cap":new Un(pe.layout_line["line-cap"]),"line-join":new Nr(pe.layout_line["line-join"]),"line-miter-limit":new Un(pe.layout_line["line-miter-limit"]),"line-round-limit":new Un(pe.layout_line["line-round-limit"]),"line-sort-key":new Nr(pe.layout_line["line-sort-key"])}),Pd={paint:new Rs({"line-opacity":new Nr(pe.paint_line["line-opacity"]),"line-color":new Nr(pe.paint_line["line-color"]),"line-translate":new Un(pe.paint_line["line-translate"]),"line-translate-anchor":new Un(pe.paint_line["line-translate-anchor"]),"line-width":new Nr(pe.paint_line["line-width"]),"line-gap-width":new Nr(pe.paint_line["line-gap-width"]),"line-offset":new Nr(pe.paint_line["line-offset"]),"line-blur":new Nr(pe.paint_line["line-blur"]),"line-dasharray":new Ps(pe.paint_line["line-dasharray"]),"line-pattern":new Vl(pe.paint_line["line-pattern"]),"line-gradient":new $u(pe.paint_line["line-gradient"])}),layout:Cv},Ev=new(function(s){function h(){s.apply(this,arguments)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.possiblyEvaluate=function(g,S){return S=new Vr(Math.floor(S.zoom),{now:S.now,fadeDuration:S.fadeDuration,zoomHistory:S.zoomHistory,transition:S.transition}),s.prototype.possiblyEvaluate.call(this,g,S)},h.prototype.evaluate=function(g,S,k,N){return S=et({},S,{zoom:Math.floor(S.zoom)}),s.prototype.evaluate.call(this,g,S,k,N)},h}(Nr))(Pd.paint.properties["line-width"].specification);Ev.useIntegerZoom=!0;var G_=function(s){function h(g){s.call(this,g,Pd),this.gradientVersion=0}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype._handleSpecialPaintPropertyUpdate=function(g){"line-gradient"===g&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof wa,this.gradientVersion=(this.gradientVersion+1)%Ke)},h.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},h.prototype.recalculate=function(g,S){s.prototype.recalculate.call(this,g,S),this.paint._values["line-floorwidth"]=Ev.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,g)},h.prototype.createBucket=function(g){return new po(g)},h.prototype.queryRadius=function(g){var S=g,k=Gf(Fe("line-width",this,S),Fe("line-gap-width",this,S)),N=Fe("line-offset",this,S);return k/2+Math.abs(N)+at(this.paint.get("line-translate"))},h.prototype.queryIntersectsFeature=function(g,S,k,N,q,X,ie){var ce=nt(g,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),X.angle,ie),ye=ie/2*Gf(this.paint.get("line-width").evaluate(S,k),this.paint.get("line-gap-width").evaluate(S,k)),_e=this.paint.get("line-offset").evaluate(S,k);return _e&&(N=function(Ae,ze){for(var Xe=[],Qe=new Et(0,0),pt=0;pt<Ae.length;pt++){for(var st=Ae[pt],St=[],At=0;At<st.length;At++){var Lt=st[At],zt=st[At+1],nn=0===At?Qe:Lt.sub(st[At-1])._unit()._perp(),An=At===st.length-1?Qe:zt.sub(Lt)._unit()._perp(),zn=nn._add(An)._unit();zn._mult(1/(zn.x*An.x+zn.y*An.y)),St.push(zn._mult(ze)._add(Lt))}Xe.push(St)}return Xe}(N,_e*ie)),function(Ae,ze,Xe){for(var Qe=0;Qe<ze.length;Qe++){var pt=ze[Qe];if(Ae.length>=3)for(var st=0;st<pt.length;st++)if(fe(Ae,pt[st]))return!0;if(Tu(Ae,pt,Xe))return!0}return!1}(ce,N,ye)},h.prototype.isTileClipped=function(){return!0},h}(Lr);function Gf(s,h){return h>0?h+2*s:s}var Cg=Ea([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),qf=Ea([{name:"a_projected_pos",components:3,type:"Float32"}],4),q_=(Ea([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ea([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Sv=(Ea([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ea([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Zf=Ea([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Rm(s,h,g){return s.sections.forEach(function(S){var k,q,X;S.text=(k=S.text,q=g,"uppercase"===(X=h.layout.get("text-transform").evaluate(q,{}))?k=k.toLocaleUpperCase():"lowercase"===X&&(k=k.toLocaleLowerCase()),Yo.applyArabicShaping&&(k=Yo.applyArabicShaping(k)),k)}),s}Ea([{name:"triangle",components:3,type:"Uint16"}]),Ea([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ea([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ea([{type:"Float32",name:"offsetX"}]),Ea([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Om={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"},Eg=function(s,h,g,S,k){var N,q,X=8*k-S-1,ie=(1<<X)-1,ce=ie>>1,ye=-7,_e=g?k-1:0,Ae=g?-1:1,ze=s[h+_e];for(_e+=Ae,N=ze&(1<<-ye)-1,ze>>=-ye,ye+=X;ye>0;N=256*N+s[h+_e],_e+=Ae,ye-=8);for(q=N&(1<<-ye)-1,N>>=-ye,ye+=S;ye>0;q=256*q+s[h+_e],_e+=Ae,ye-=8);if(0===N)N=1-ce;else{if(N===ie)return q?NaN:1/0*(ze?-1:1);q+=Math.pow(2,S),N-=ce}return(ze?-1:1)*q*Math.pow(2,N-S)},Tv=function(s,h,g,S,k,N){var q,X,ie,ce=8*N-k-1,ye=(1<<ce)-1,_e=ye>>1,Ae=23===k?Math.pow(2,-24)-Math.pow(2,-77):0,ze=S?0:N-1,Xe=S?1:-1,Qe=h<0||0===h&&1/h<0?1:0;for(h=Math.abs(h),isNaN(h)||h===1/0?(X=isNaN(h)?1:0,q=ye):(q=Math.floor(Math.log(h)/Math.LN2),h*(ie=Math.pow(2,-q))<1&&(q--,ie*=2),(h+=q+_e>=1?Ae/ie:Ae*Math.pow(2,1-_e))*ie>=2&&(q++,ie/=2),q+_e>=ye?(X=0,q=ye):q+_e>=1?(X=(h*ie-1)*Math.pow(2,k),q+=_e):(X=h*Math.pow(2,_e-1)*Math.pow(2,k),q=0));k>=8;s[g+ze]=255&X,ze+=Xe,X/=256,k-=8);for(q=q<<k|X,ce+=k;ce>0;s[g+ze]=255&q,ze+=Xe,q/=256,ce-=8);s[g+ze-Xe]|=128*Qe},yy=Fa;function Fa(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Fa.Varint=0,Fa.Fixed64=1,Fa.Bytes=2,Fa.Fixed32=5;var Lm="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Np(s){return s.type===Fa.Bytes?s.readVarint()+s.pos:s.pos+1}function Fm(s,h,g){var S=h<=16383?1:h<=2097151?2:h<=268435455?3:Math.floor(Math.log(h)/(7*Math.LN2));g.realloc(S);for(var k=g.pos-1;k>=s;k--)g.buf[k+S]=g.buf[k]}function vy(s,h){for(var g=0;g<s.length;g++)h.writeVarint(s[g])}function Wf(s,h){for(var g=0;g<s.length;g++)h.writeSVarint(s[g])}function bx(s,h){for(var g=0;g<s.length;g++)h.writeFloat(s[g])}function Z_(s,h){for(var g=0;g<s.length;g++)h.writeDouble(s[g])}function J1(s,h){for(var g=0;g<s.length;g++)h.writeBoolean(s[g])}function _y(s,h){for(var g=0;g<s.length;g++)h.writeFixed32(s[g])}function xy(s,h){for(var g=0;g<s.length;g++)h.writeSFixed32(s[g])}function by(s,h){for(var g=0;g<s.length;g++)h.writeFixed64(s[g])}function Iv(s,h){for(var g=0;g<s.length;g++)h.writeSFixed64(s[g])}function $f(s,h){return(s[h]|s[h+1]<<8|s[h+2]<<16)+16777216*s[h+3]}function Ph(s,h,g){s[g]=h,s[g+1]=h>>>8,s[g+2]=h>>>16,s[g+3]=h>>>24}function Rh(s,h){return(s[h]|s[h+1]<<8|s[h+2]<<16)+(s[h+3]<<24)}function wx(s,h,g){1===s&&g.readMessage(Mv,h)}function Mv(s,h,g){if(3===s){var S=g.readMessage(Cx,{}),k=S.width,N=S.height,q=S.left,X=S.top,ie=S.advance;h.push({id:S.id,bitmap:new qa({width:k+6,height:N+6},S.bitmap),metrics:{width:k,height:N,left:q,top:X,advance:ie}})}}function Cx(s,h,g){1===s?h.id=g.readVarint():2===s?h.bitmap=g.readBytes():3===s?h.width=g.readVarint():4===s?h.height=g.readVarint():5===s?h.left=g.readSVarint():6===s?h.top=g.readSVarint():7===s&&(h.advance=g.readVarint())}function H_(s){for(var h=0,g=0,S=0,k=s;S<k.length;S+=1){var N=k[S];h+=N.w*N.h,g=Math.max(g,N.w)}s.sort(function(Qe,pt){return pt.h-Qe.h});for(var q=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(h/.95)),g),h:1/0}],X=0,ie=0,ce=0,ye=s;ce<ye.length;ce+=1)for(var _e=ye[ce],Ae=q.length-1;Ae>=0;Ae--){var ze=q[Ae];if(!(_e.w>ze.w||_e.h>ze.h)){if(_e.x=ze.x,_e.y=ze.y,ie=Math.max(ie,_e.y+_e.h),X=Math.max(X,_e.x+_e.w),_e.w===ze.w&&_e.h===ze.h){var Xe=q.pop();Ae<q.length&&(q[Ae]=Xe)}else _e.h===ze.h?(ze.x+=_e.w,ze.w-=_e.w):_e.w===ze.w?(ze.y+=_e.h,ze.h-=_e.h):(q.push({x:ze.x+_e.w,y:ze.y,w:ze.w-_e.w,h:_e.h}),ze.y+=_e.h,ze.h-=_e.h);break}}return{w:X,h:ie,fill:h/(X*ie)||0}}Fa.prototype={destroy:function(){this.buf=null},readFields:function(s,h,g){for(g=g||this.length;this.pos<g;){var S=this.readVarint(),k=S>>3,N=this.pos;this.type=7&S,s(k,h,this),this.pos===N&&this.skip(S)}return h},readMessage:function(s,h){return this.readFields(s,h,this.readVarint()+this.pos)},readFixed32:function(){var s=$f(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Rh(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=$f(this.buf,this.pos)+4294967296*$f(this.buf,this.pos+4);return this.pos+=8,s},readSFixed64:function(){var s=$f(this.buf,this.pos)+4294967296*Rh(this.buf,this.pos+4);return this.pos+=8,s},readFloat:function(){var s=Eg(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=Eg(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var h,g,S=this.buf;return h=127&(g=S[this.pos++]),g<128?h:(h|=(127&(g=S[this.pos++]))<<7,g<128?h:(h|=(127&(g=S[this.pos++]))<<14,g<128?h:(h|=(127&(g=S[this.pos++]))<<21,g<128?h:function(k,N,q){var X,ie,ce=q.buf;if(X=(112&(ie=ce[q.pos++]))>>4,ie<128||(X|=(127&(ie=ce[q.pos++]))<<3,ie<128)||(X|=(127&(ie=ce[q.pos++]))<<10,ie<128)||(X|=(127&(ie=ce[q.pos++]))<<17,ie<128)||(X|=(127&(ie=ce[q.pos++]))<<24,ie<128)||(X|=(1&(ie=ce[q.pos++]))<<31,ie<128))return function(s,h,g){return g?4294967296*h+(s>>>0):4294967296*(h>>>0)+(s>>>0)}(k,X,N);throw new Error("Expected varint not more than 10 bytes")}(h|=(15&(g=S[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var s=this.readVarint()+this.pos,h=this.pos;return this.pos=s,s-h>=12&&Lm?Lm.decode(this.buf.subarray(h,s)):function(g,S,k){for(var N="",q=S;q<k;){var X,ie,ce,ye=g[q],_e=null,Ae=ye>239?4:ye>223?3:ye>191?2:1;if(q+Ae>k)break;1===Ae?ye<128&&(_e=ye):2===Ae?128==(192&(X=g[q+1]))&&(_e=(31&ye)<<6|63&X)<=127&&(_e=null):3===Ae?(ie=g[q+2],128==(192&(X=g[q+1]))&&128==(192&ie)&&((_e=(15&ye)<<12|(63&X)<<6|63&ie)<=2047||_e>=55296&&_e<=57343)&&(_e=null)):4===Ae&&(ie=g[q+2],ce=g[q+3],128==(192&(X=g[q+1]))&&128==(192&ie)&&128==(192&ce)&&((_e=(15&ye)<<18|(63&X)<<12|(63&ie)<<6|63&ce)<=65535||_e>=1114112)&&(_e=null)),null===_e?(_e=65533,Ae=1):_e>65535&&(_e-=65536,N+=String.fromCharCode(_e>>>10&1023|55296),_e=56320|1023&_e),N+=String.fromCharCode(_e),q+=Ae}return N}(this.buf,h,s)},readBytes:function(){var s=this.readVarint()+this.pos,h=this.buf.subarray(this.pos,s);return this.pos=s,h},readPackedVarint:function(s,h){if(this.type!==Fa.Bytes)return s.push(this.readVarint(h));var g=Np(this);for(s=s||[];this.pos<g;)s.push(this.readVarint(h));return s},readPackedSVarint:function(s){if(this.type!==Fa.Bytes)return s.push(this.readSVarint());var h=Np(this);for(s=s||[];this.pos<h;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Fa.Bytes)return s.push(this.readBoolean());var h=Np(this);for(s=s||[];this.pos<h;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Fa.Bytes)return s.push(this.readFloat());var h=Np(this);for(s=s||[];this.pos<h;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Fa.Bytes)return s.push(this.readDouble());var h=Np(this);for(s=s||[];this.pos<h;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Fa.Bytes)return s.push(this.readFixed32());var h=Np(this);for(s=s||[];this.pos<h;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Fa.Bytes)return s.push(this.readSFixed32());var h=Np(this);for(s=s||[];this.pos<h;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Fa.Bytes)return s.push(this.readFixed64());var h=Np(this);for(s=s||[];this.pos<h;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Fa.Bytes)return s.push(this.readSFixed64());var h=Np(this);for(s=s||[];this.pos<h;)s.push(this.readSFixed64());return s},skip:function(s){var h=7&s;if(h===Fa.Varint)for(;this.buf[this.pos++]>127;);else if(h===Fa.Bytes)this.pos=this.readVarint()+this.pos;else if(h===Fa.Fixed32)this.pos+=4;else{if(h!==Fa.Fixed64)throw new Error("Unimplemented type: "+h);this.pos+=8}},writeTag:function(s,h){this.writeVarint(s<<3|h)},realloc:function(s){for(var h=this.length||16;h<this.pos+s;)h*=2;if(h!==this.length){var g=new Uint8Array(h);g.set(this.buf),this.buf=g,this.length=h}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Ph(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Ph(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Ph(this.buf,-1&s,this.pos),Ph(this.buf,Math.floor(s*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Ph(this.buf,-1&s,this.pos),Ph(this.buf,Math.floor(s*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(h,g){var S,k,N,X;if(h>=0?(S=h%4294967296|0,k=h/4294967296|0):(k=~(-h/4294967296),4294967295^(S=~(-h%4294967296))?S=S+1|0:(S=0,k=k+1|0)),h>=0x10000000000000000||h<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");g.realloc(10),N=S,(X=g).buf[X.pos++]=127&N|128,N>>>=7,X.buf[X.pos++]=127&N|128,N>>>=7,X.buf[X.pos++]=127&N|128,N>>>=7,X.buf[X.pos++]=127&N|128,X.buf[X.pos]=127&(N>>>=7),function(N,q){var X=(7&N)<<4;q.buf[q.pos++]|=X|((N>>>=3)?128:0),N&&(q.buf[q.pos++]=127&N|((N>>>=7)?128:0),N&&(q.buf[q.pos++]=127&N|((N>>>=7)?128:0),N&&(q.buf[q.pos++]=127&N|((N>>>=7)?128:0),N&&(q.buf[q.pos++]=127&N|((N>>>=7)?128:0),N&&(q.buf[q.pos++]=127&N)))))}(k,g)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(Boolean(s))},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var h=this.pos;this.pos=function(S,k,N){for(var q,X,ie=0;ie<k.length;ie++){if((q=k.charCodeAt(ie))>55295&&q<57344){if(!X){q>56319||ie+1===k.length?(S[N++]=239,S[N++]=191,S[N++]=189):X=q;continue}if(q<56320){S[N++]=239,S[N++]=191,S[N++]=189,X=q;continue}q=X-55296<<10|q-56320|65536,X=null}else X&&(S[N++]=239,S[N++]=191,S[N++]=189,X=null);q<128?S[N++]=q:(q<2048?S[N++]=q>>6|192:(q<65536?S[N++]=q>>12|224:(S[N++]=q>>18|240,S[N++]=q>>12&63|128),S[N++]=q>>6&63|128),S[N++]=63&q|128)}return N}(this.buf,s,this.pos);var g=this.pos-h;g>=128&&Fm(h,g,this),this.pos=h-1,this.writeVarint(g),this.pos+=g},writeFloat:function(s){this.realloc(4),Tv(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Tv(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var h=s.length;this.writeVarint(h),this.realloc(h);for(var g=0;g<h;g++)this.buf[this.pos++]=s[g]},writeRawMessage:function(s,h){this.pos++;var g=this.pos;s(h,this);var S=this.pos-g;S>=128&&Fm(g,S,this),this.pos=g-1,this.writeVarint(S),this.pos+=S},writeMessage:function(s,h,g){this.writeTag(s,Fa.Bytes),this.writeRawMessage(h,g)},writePackedVarint:function(s,h){h.length&&this.writeMessage(s,vy,h)},writePackedSVarint:function(s,h){h.length&&this.writeMessage(s,Wf,h)},writePackedBoolean:function(s,h){h.length&&this.writeMessage(s,J1,h)},writePackedFloat:function(s,h){h.length&&this.writeMessage(s,bx,h)},writePackedDouble:function(s,h){h.length&&this.writeMessage(s,Z_,h)},writePackedFixed32:function(s,h){h.length&&this.writeMessage(s,_y,h)},writePackedSFixed32:function(s,h){h.length&&this.writeMessage(s,xy,h)},writePackedFixed64:function(s,h){h.length&&this.writeMessage(s,by,h)},writePackedSFixed64:function(s,h){h.length&&this.writeMessage(s,Iv,h)},writeBytesField:function(s,h){this.writeTag(s,Fa.Bytes),this.writeBytes(h)},writeFixed32Field:function(s,h){this.writeTag(s,Fa.Fixed32),this.writeFixed32(h)},writeSFixed32Field:function(s,h){this.writeTag(s,Fa.Fixed32),this.writeSFixed32(h)},writeFixed64Field:function(s,h){this.writeTag(s,Fa.Fixed64),this.writeFixed64(h)},writeSFixed64Field:function(s,h){this.writeTag(s,Fa.Fixed64),this.writeSFixed64(h)},writeVarintField:function(s,h){this.writeTag(s,Fa.Varint),this.writeVarint(h)},writeSVarintField:function(s,h){this.writeTag(s,Fa.Varint),this.writeSVarint(h)},writeStringField:function(s,h){this.writeTag(s,Fa.Bytes),this.writeString(h)},writeFloatField:function(s,h){this.writeTag(s,Fa.Fixed32),this.writeFloat(h)},writeDoubleField:function(s,h){this.writeTag(s,Fa.Fixed64),this.writeDouble(h)},writeBooleanField:function(s,h){this.writeVarintField(s,Boolean(h))}};var Bp=function(s,h){var g=h.pixelRatio,S=h.version,k=h.stretchX,N=h.stretchY,q=h.content;this.paddedRect=s,this.pixelRatio=g,this.stretchX=k,this.stretchY=N,this.content=q,this.version=S},dp={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};dp.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},dp.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},dp.tlbr.get=function(){return this.tl.concat(this.br)},dp.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Bp.prototype,dp);var Sg=function(s,h){var g={},S={};this.haveRenderCallbacks=[];var k=[];this.addImages(s,g,k),this.addImages(h,S,k);var N=H_(k),q=new ai({width:N.w||1,height:N.h||1});for(var X in s){var ie=s[X],ce=g[X].paddedRect;ai.copy(ie.data,q,{x:0,y:0},{x:ce.x+1,y:ce.y+1},ie.data)}for(var ye in h){var _e=h[ye],Ae=S[ye].paddedRect,ze=Ae.x+1,Xe=Ae.y+1,Qe=_e.data.width,pt=_e.data.height;ai.copy(_e.data,q,{x:0,y:0},{x:ze,y:Xe},_e.data),ai.copy(_e.data,q,{x:0,y:pt-1},{x:ze,y:Xe-1},{width:Qe,height:1}),ai.copy(_e.data,q,{x:0,y:0},{x:ze,y:Xe+pt},{width:Qe,height:1}),ai.copy(_e.data,q,{x:Qe-1,y:0},{x:ze-1,y:Xe},{width:1,height:pt}),ai.copy(_e.data,q,{x:0,y:0},{x:ze+Qe,y:Xe},{width:1,height:pt})}this.image=q,this.iconPositions=g,this.patternPositions=S};Sg.prototype.addImages=function(s,h,g){for(var S in s){var k=s[S],N={x:0,y:0,w:k.data.width+2,h:k.data.height+2};g.push(N),h[S]=new Bp(N,k),k.hasRenderCallback&&this.haveRenderCallbacks.push(S)}},Sg.prototype.patchUpdatedImages=function(s,h){for(var g in s.dispatchRenderCallbacks(this.haveRenderCallbacks),s.updatedImages)this.patchUpdatedImage(this.iconPositions[g],s.getImage(g),h),this.patchUpdatedImage(this.patternPositions[g],s.getImage(g),h)},Sg.prototype.patchUpdatedImage=function(s,h,g){if(s&&h&&s.version!==h.version){s.version=h.version;var S=s.tl;g.update(h.data,void 0,{x:S[0],y:S[1]})}},$n("ImagePosition",Bp),$n("ImageAtlas",Sg);var zc={horizontal:1,vertical:2,horizontalOnly:3},zm=function(){this.scale=1,this.fontStack="",this.imageName=null};zm.forText=function(s,h){var g=new zm;return g.scale=s||1,g.fontStack=h,g},zm.forImage=function(s){var h=new zm;return h.imageName=s,h};var tl=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Xf(s,h,g,S,k,N,q,X,ie,ce,ye,_e,Ae,ze,Xe,Qe){var pt,st=tl.fromFeature(s,k);_e===zc.vertical&&st.verticalizePunctuation();var St=Yo.processBidirectionalText,At=Yo.processStyledBidirectionalText;if(St&&1===st.sections.length){pt=[];for(var Lt=0,zt=St(st.toString(),Y_(st,ce,N,h,S,ze,Xe));Lt<zt.length;Lt+=1){var nn=zt[Lt],An=new tl;An.text=nn,An.sections=st.sections;for(var zn=0;zn<nn.length;zn++)An.sectionIndex.push(0);pt.push(An)}}else if(At){pt=[];for(var _r=0,Gn=At(st.text,st.sectionIndex,Y_(st,ce,N,h,S,ze,Xe));_r<Gn.length;_r+=1){var Dr=Gn[_r],Yn=new tl;Yn.text=Dr[0],Yn.sectionIndex=Dr[1],Yn.sections=st.sections,pt.push(Yn)}}else pt=function(rr,Ci){for(var si=[],so=rr.text,Tr=0,ji=0,Ia=Ci;ji<Ia.length;ji+=1){var ns=Ia[ji];si.push(rr.substring(Tr,ns)),Tr=ns}return Tr<so.length&&si.push(rr.substring(Tr,so.length)),si}(st,Y_(st,ce,N,h,S,ze,Xe));var mi=[],$r={positionedLines:mi,text:st.toString(),top:ye[1],bottom:ye[1],left:ye[0],right:ye[0],writingMode:_e,iconsInText:!1,verticalizable:!1};return function(rr,Ci,si,so,Tr,ji,Ia,ns,Ha,_a,gs,Hs){for(var Os=0,uu=-17,ys=0,cu=0,rs="right"===ns?1:"left"===ns?0:.5,vs=0,Ei=0,Jo=Tr;Ei<Jo.length;Ei+=1){var Po=Jo[Ei];Po.trim();var lo=Po.getMaxScale(),Zl=24*(lo-1),nl={positionedGlyphs:[],lineOffset:0};rr.positionedLines[vs]=nl;var Ma=nl.positionedGlyphs,cl=0;if(Po.length()){for(var hu=0;hu<Po.length();hu++){var Io=Po.getSection(hu),Vp=Po.getSectionIndex(hu),ku=Po.getCharCode(hu),fp=0,Qo=null,Gp=null,Qh=null,ff=24,tm=!(Ha===zc.horizontal||!gs&&!Mh(ku)||gs&&(Av[ku]||(tp=ku,er.Arabic(tp)||er["Arabic Supplement"](tp)||er["Arabic Extended-A"](tp)||er["Arabic Presentation Forms-A"](tp)||er["Arabic Presentation Forms-B"](tp))));if(Io.imageName){var ep=so[Io.imageName];if(!ep)continue;Qh=Io.imageName,rr.iconsInText=rr.iconsInText||!0,Gp=ep.paddedRect;var ud=ep.displaySize;Io.scale=24*Io.scale/Hs,fp=Zl+(24-ud[1]*Io.scale),ff=(Qo={width:ud[0],height:ud[1],left:1,top:-3,advance:tm?ud[1]:ud[0]}).advance;var mf=tm?ud[0]*Io.scale-24*lo:ud[1]*Io.scale-24*lo;mf>0&&mf>cl&&(cl=mf)}else{var nm=si[Io.fontStack],gf=nm&&nm[ku];if(gf&&gf.rect)Gp=gf.rect,Qo=gf.metrics;else{var zg=Ci[Io.fontStack],Fi=zg&&zg[ku];if(!Fi)continue;Qo=Fi.metrics}fp=24*(lo-Io.scale)}tm?(rr.verticalizable=!0,Ma.push({glyph:ku,imageName:Qh,x:Os,y:uu+fp,vertical:tm,scale:Io.scale,fontStack:Io.fontStack,sectionIndex:Vp,metrics:Qo,rect:Gp}),Os+=ff*Io.scale+_a):(Ma.push({glyph:ku,imageName:Qh,x:Os,y:uu+fp,vertical:tm,scale:Io.scale,fontStack:Io.fontStack,sectionIndex:Vp,metrics:Qo,rect:Gp}),Os+=Qo.advance*Io.scale+_a)}0!==Ma.length&&(ys=Math.max(Os-_a,ys),wy(Ma,0,Ma.length-1,rs,cl)),Os=0;var rn=ji*lo+cl;nl.lineOffset=Math.max(cl,Zl),uu+=rn,cu=Math.max(rn,cu),++vs}else uu+=ji,++vs}var tp,yf=uu- -17,jd=Tg(Ia),pu=jd.horizontalAlign,Ud=jd.verticalAlign;(function(qp,Hm,uh,vf,_f,rm,Ay,Wm,Bv){var Zp,im=(Hm-uh)*_f;Zp=rm!==Ay?-Wm*vf- -17:(-vf*Bv+.5)*Ay;for(var Vd=0,xf=qp;Vd<xf.length;Vd+=1)for(var cd=0,Ng=xf[Vd].positionedGlyphs;cd<Ng.length;cd+=1){var Gd=Ng[cd];Gd.x+=im,Gd.y+=Zp}})(rr.positionedLines,rs,pu,Ud,ys,cu,ji,yf,Tr.length),rr.top+=-Ud*yf,rr.bottom=rr.top+yf,rr.left+=-pu*ys,rr.right=rr.left+ys}($r,h,g,S,pt,q,X,ie,_e,ce,Ae,Qe),!function(rr){for(var Ci=0,si=rr;Ci<si.length;Ci+=1)if(0!==si[Ci].positionedGlyphs.length)return!1;return!0}(mi)&&$r}tl.fromFeature=function(s,h){for(var g=new tl,S=0;S<s.sections.length;S++){var k=s.sections[S];k.image?g.addImageSection(k):g.addTextSection(k,h)}return g},tl.prototype.length=function(){return this.text.length},tl.prototype.getSection=function(s){return this.sections[this.sectionIndex[s]]},tl.prototype.getSectionIndex=function(s){return this.sectionIndex[s]},tl.prototype.getCharCode=function(s){return this.text.charCodeAt(s)},tl.prototype.verticalizePunctuation=function(){this.text=function(s){for(var h="",g=0;g<s.length;g++){var S=s.charCodeAt(g+1)||null,k=s.charCodeAt(g-1)||null;h+=S&&wu(S)&&!Om[s[g+1]]||k&&wu(k)&&!Om[s[g-1]]||!Om[s[g]]?s[g]:Om[s[g]]}return h}(this.text)},tl.prototype.trim=function(){for(var s=0,h=0;h<this.text.length&&Av[this.text.charCodeAt(h)];h++)s++;for(var g=this.text.length,S=this.text.length-1;S>=0&&S>=s&&Av[this.text.charCodeAt(S)];S--)g--;this.text=this.text.substring(s,g),this.sectionIndex=this.sectionIndex.slice(s,g)},tl.prototype.substring=function(s,h){var g=new tl;return g.text=this.text.substring(s,h),g.sectionIndex=this.sectionIndex.slice(s,h),g.sections=this.sections,g},tl.prototype.toString=function(){return this.text},tl.prototype.getMaxScale=function(){var s=this;return this.sectionIndex.reduce(function(h,g){return Math.max(h,s.sections[g].scale)},0)},tl.prototype.addTextSection=function(s,h){this.text+=s.text,this.sections.push(zm.forText(s.scale,s.fontStack||h));for(var g=this.sections.length-1,S=0;S<s.text.length;++S)this.sectionIndex.push(g)},tl.prototype.addImageSection=function(s){var h=s.image?s.image.name:"";if(0!==h.length){var g=this.getNextImageSectionCharCode();g?(this.text+=String.fromCharCode(g),this.sections.push(zm.forImage(h)),this.sectionIndex.push(this.sections.length-1)):sr("Reached maximum number of images 6401")}else sr("Can't add FormattedSection with an empty image.")},tl.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Av={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Nc={};function W_(s,h,g,S,k,N){if(h.imageName){var q=S[h.imageName];return q?q.displaySize[0]*h.scale*24/N+k:0}var X=g[h.fontStack],ie=X&&X[s];return ie?ie.metrics.advance*h.scale+k:0}function $_(s,h,g,S){var k=Math.pow(s-h,2);return S?s<h?k/2:2*k:k+Math.abs(g)*g}function Ex(s,h,g){var S=0;return 10===s&&(S-=1e4),g&&(S+=150),40!==s&&65288!==s||(S+=50),41!==h&&65289!==h||(S+=50),S}function X_(s,h,g,S,k,N){for(var q=null,X=$_(h,g,k,N),ie=0,ce=S;ie<ce.length;ie+=1){var ye=ce[ie],_e=$_(h-ye.x,g,k,N)+ye.badness;_e<=X&&(q=ye,X=_e)}return{index:s,x:h,priorBreak:q,badness:X}}function Y_(s,h,g,S,k,N,q){if("point"!==N)return[];if(!s)return[];for(var X,ie=[],ce=function(pt,st,St,At,Lt,zt){for(var nn=0,An=0;An<pt.length();An++){var zn=pt.getSection(An);nn+=W_(pt.getCharCode(An),zn,At,Lt,st,zt)}return nn/Math.max(1,Math.ceil(nn/St))}(s,h,g,S,k,q),ye=s.text.indexOf("\u200b")>=0,_e=0,Ae=0;Ae<s.length();Ae++){var ze=s.getSection(Ae),Xe=s.getCharCode(Ae);if(Av[Xe]||(_e+=W_(Xe,ze,S,k,h,q)),Ae<s.length()-1){var Qe=!((X=Xe)<11904||!(er["Bopomofo Extended"](X)||er.Bopomofo(X)||er["CJK Compatibility Forms"](X)||er["CJK Compatibility Ideographs"](X)||er["CJK Compatibility"](X)||er["CJK Radicals Supplement"](X)||er["CJK Strokes"](X)||er["CJK Symbols and Punctuation"](X)||er["CJK Unified Ideographs Extension A"](X)||er["CJK Unified Ideographs"](X)||er["Enclosed CJK Letters and Months"](X)||er["Halfwidth and Fullwidth Forms"](X)||er.Hiragana(X)||er["Ideographic Description Characters"](X)||er["Kangxi Radicals"](X)||er["Katakana Phonetic Extensions"](X)||er.Katakana(X)||er["Vertical Forms"](X)||er["Yi Radicals"](X)||er["Yi Syllables"](X)));(Nc[Xe]||Qe||ze.imageName)&&ie.push(X_(Ae+1,_e,ce,ie,Ex(Xe,s.getCharCode(Ae+1),Qe&&ye),!1))}}return function pt(st){return st?pt(st.priorBreak).concat(st.index):[]}(X_(s.length(),_e,ce,ie,0,!0))}function Tg(s){var h=.5,g=.5;switch(s){case"right":case"top-right":case"bottom-right":h=1;break;case"left":case"top-left":case"bottom-left":h=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":g=1;break;case"top":case"top-right":case"top-left":g=0}return{horizontalAlign:h,verticalAlign:g}}function wy(s,h,g,S,k){if(S||k)for(var N=s[g],q=(s[g].x+N.metrics.advance*N.scale)*S,X=h;X<=g;X++)s[X].x-=q,s[X].y+=k}function hf(s,h,g,S,k,N){var q,X=s.image;if(X.content){var ie=X.content,ce=X.pixelRatio||1;q=[ie[0]/ce,ie[1]/ce,X.displaySize[0]-ie[2]/ce,X.displaySize[1]-ie[3]/ce]}var ye,_e,Ae,ze,Xe=h.left*N,Qe=h.right*N;"width"===g||"both"===g?(ze=k[0]+Xe-S[3],_e=k[0]+Qe+S[1]):_e=(ze=k[0]+(Xe+Qe-X.displaySize[0])/2)+X.displaySize[0];var pt=h.top*N,st=h.bottom*N;return"height"===g||"both"===g?(ye=k[1]+pt-S[0],Ae=k[1]+st+S[2]):Ae=(ye=k[1]+(pt+st-X.displaySize[1])/2)+X.displaySize[1],{image:X,top:ye,right:_e,bottom:Ae,left:ze,collisionPadding:q}}Nc[10]=!0,Nc[32]=!0,Nc[38]=!0,Nc[40]=!0,Nc[41]=!0,Nc[43]=!0,Nc[45]=!0,Nc[47]=!0,Nc[173]=!0,Nc[183]=!0,Nc[8203]=!0,Nc[8208]=!0,Nc[8211]=!0,Nc[8231]=!0;var lh=function(s){function h(g,S,k,N){s.call(this,g,S),this.angle=k,void 0!==N&&(this.segment=N)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.clone=function(){return new h(this.x,this.y,this.angle,this.segment)},h}(Et);function Za(s,h){var g=h.expression;if("constant"===g.kind)return{kind:"constant",layoutSize:g.evaluate(new Vr(s+1))};if("source"===g.kind)return{kind:"source"};for(var S=g.zoomStops,k=g.interpolationType,N=0;N<S.length&&S[N]<=s;)N++;for(var q=N=Math.max(0,N-1);q<S.length&&S[q]<s+1;)q++;q=Math.min(S.length-1,q);var X=S[N],ie=S[q];return"composite"===g.kind?{kind:"composite",minZoom:X,maxZoom:ie,interpolationType:k}:{kind:"camera",minZoom:X,maxZoom:ie,minSize:g.evaluate(new Vr(X)),maxSize:g.evaluate(new Vr(ie)),interpolationType:k}}function Nm(s,h,g){var S=h.uSize,k=g.lowerSize;return"source"===s.kind?k/128:"composite"===s.kind?ca(k/128,g.upperSize/128,h.uSizeT):S}function Cy(s,h){var g=0,S=0;if("constant"===s.kind)S=s.layoutSize;else if("source"!==s.kind){var k=s.interpolationType,N=k?Cn(ka.interpolationFactor(k,h,s.minZoom,s.maxZoom),0,1):0;"camera"===s.kind?S=ca(s.minSize,s.maxSize,N):g=N}return{uSizeT:g,uSize:S}}$n("Anchor",lh);var Ig=Object.freeze({__proto__:null,getSizeData:Za,evaluateSizeForFeature:Nm,evaluateSizeForZoom:Cy,SIZE_PACK_FACTOR:128});function Ey(s,h,g,S,k){if(void 0===h.segment)return!0;for(var N=h,q=h.segment+1,X=0;X>-g/2;){if(--q<0)return!1;X-=s[q].dist(N),N=s[q]}X+=s[q].dist(s[q+1]),q++;for(var ie=[],ce=0;X<g/2;){var ye=s[q],_e=s[q+1];if(!_e)return!1;var Ae=s[q-1].angleTo(ye)-ye.angleTo(_e);for(Ae=Math.abs((Ae+3*Math.PI)%(2*Math.PI)-Math.PI),ie.push({distance:X,angleDelta:Ae}),ce+=Ae;X-ie[0].distance>S;)ce-=ie.shift().angleDelta;if(ce>k)return!1;q++,X+=ye.dist(_e)}return!0}function Mg(s){for(var h=0,g=0;g<s.length-1;g++)h+=s[g].dist(s[g+1]);return h}function K_(s,h,g){return s?.6*h*g:0}function Ag(s,h){return Math.max(s?s.right-s.left:0,h?h.right-h.left:0)}function Yf(s,h,g,S,k,N){for(var q=K_(g,k,N),X=Ag(g,S)*N,ie=0,ce=Mg(s)/2,ye=0;ye<s.length-1;ye++){var _e=s[ye],Ae=s[ye+1],ze=_e.dist(Ae);if(ie+ze>ce){var Xe=(ce-ie)/ze,Qe=ca(_e.x,Ae.x,Xe),pt=ca(_e.y,Ae.y,Xe),st=new lh(Qe,pt,Ae.angleTo(_e),ye);return st._round(),!q||Ey(s,st,X,q,h)?st:void 0}ie+=ze}}function Dg(s,h,g,S,k,N,q,X,ie){var ce=K_(S,N,q),ye=Ag(S,k),_e=ye*q,Ae=0===s[0].x||s[0].x===ie||0===s[0].y||s[0].y===ie;return h-_e<h/4&&(h=_e+h/4),function ze(Xe,Qe,pt,st,St,At,Lt,zt,nn){for(var An=At/2,zn=Mg(Xe),_r=0,Gn=Qe-pt,Dr=[],Yn=0;Yn<Xe.length-1;Yn++){for(var mi=Xe[Yn],$r=Xe[Yn+1],rr=mi.dist($r),Ci=$r.angleTo(mi);Gn+pt<_r+rr;){var si=((Gn+=pt)-_r)/rr,so=ca(mi.x,$r.x,si),Tr=ca(mi.y,$r.y,si);if(so>=0&&so<nn&&Tr>=0&&Tr<nn&&Gn-An>=0&&Gn+An<=zn){var ji=new lh(so,Tr,Ci,Yn);ji._round(),st&&!Ey(Xe,ji,At,st,St)||Dr.push(ji)}}_r+=rr}return zt||Dr.length||Lt||(Dr=ze(Xe,_r/2,pt,st,St,At,Lt,!0,nn)),Dr}(s,Ae?h/2*X%h:(ye/2+2*N)*q*X%h,h,ce,g,_e,Ae,!1,ie)}function Dv(s,h,g,S,k){for(var N=[],q=0;q<s.length;q++)for(var X=s[q],ie=void 0,ce=0;ce<X.length-1;ce++){var ye=X[ce],_e=X[ce+1];ye.x<h&&_e.x<h||(ye.x<h?ye=new Et(h,ye.y+(h-ye.x)/(_e.x-ye.x)*(_e.y-ye.y))._round():_e.x<h&&(_e=new Et(h,ye.y+(h-ye.x)/(_e.x-ye.x)*(_e.y-ye.y))._round()),ye.y<g&&_e.y<g||(ye.y<g?ye=new Et(ye.x+(g-ye.y)/(_e.y-ye.y)*(_e.x-ye.x),g)._round():_e.y<g&&(_e=new Et(ye.x+(g-ye.y)/(_e.y-ye.y)*(_e.x-ye.x),g)._round()),ye.x>=S&&_e.x>=S||(ye.x>=S?ye=new Et(S,ye.y+(S-ye.x)/(_e.x-ye.x)*(_e.y-ye.y))._round():_e.x>=S&&(_e=new Et(S,ye.y+(S-ye.x)/(_e.x-ye.x)*(_e.y-ye.y))._round()),ye.y>=k&&_e.y>=k||(ye.y>=k?ye=new Et(ye.x+(k-ye.y)/(_e.y-ye.y)*(_e.x-ye.x),k)._round():_e.y>=k&&(_e=new Et(ye.x+(k-ye.y)/(_e.y-ye.y)*(_e.x-ye.x),k)._round()),ie&&ye.equals(ie[ie.length-1])||N.push(ie=[ye]),ie.push(_e)))))}return N}function Sx(s,h,g,S){var k=[],N=s.image,q=N.pixelRatio,X=N.paddedRect.w-2,ie=N.paddedRect.h-2,ce=s.right-s.left,ye=s.bottom-s.top,_e=N.stretchX||[[0,X]],Ae=N.stretchY||[[0,ie]],ze=function(so,Tr){return so+Tr[1]-Tr[0]},Xe=_e.reduce(ze,0),Qe=Ae.reduce(ze,0),pt=X-Xe,st=ie-Qe,St=0,At=Xe,Lt=0,zt=Qe,nn=0,An=pt,zn=0,_r=st;if(N.content&&S){var Gn=N.content;St=Bm(_e,0,Gn[0]),Lt=Bm(Ae,0,Gn[1]),At=Bm(_e,Gn[0],Gn[2]),zt=Bm(Ae,Gn[1],Gn[3]),nn=Gn[0]-St,zn=Gn[1]-Lt,An=Gn[2]-Gn[0]-At,_r=Gn[3]-Gn[1]-zt}var Dr=function(so,Tr,ji,Ia){var ns=Sy(so.stretch-St,At,ce,s.left),Ha=Um(so.fixed-nn,An,so.stretch,Xe),_a=Sy(Tr.stretch-Lt,zt,ye,s.top),gs=Um(Tr.fixed-zn,_r,Tr.stretch,Qe),Hs=Sy(ji.stretch-St,At,ce,s.left),Os=Um(ji.fixed-nn,An,ji.stretch,Xe),uu=Sy(Ia.stretch-Lt,zt,ye,s.top),ys=Um(Ia.fixed-zn,_r,Ia.stretch,Qe),cu=new Et(ns,_a),rs=new Et(Hs,_a),vs=new Et(Hs,uu),Ei=new Et(ns,uu),Jo=new Et(Ha/q,gs/q),Po=new Et(Os/q,ys/q),lo=h*Math.PI/180;if(lo){var Zl=Math.sin(lo),nl=Math.cos(lo),Ma=[nl,-Zl,Zl,nl];cu._matMult(Ma),rs._matMult(Ma),Ei._matMult(Ma),vs._matMult(Ma)}var cl=so.stretch+so.fixed,hu=Tr.stretch+Tr.fixed;return{tl:cu,tr:rs,bl:Ei,br:vs,tex:{x:N.paddedRect.x+1+cl,y:N.paddedRect.y+1+hu,w:ji.stretch+ji.fixed-cl,h:Ia.stretch+Ia.fixed-hu},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Jo,pixelOffsetBR:Po,minFontScaleX:An/q/ce,minFontScaleY:_r/q/ye,isSDF:g}};if(S&&(N.stretchX||N.stretchY))for(var Yn=jm(_e,pt,Xe),mi=jm(Ae,st,Qe),$r=0;$r<Yn.length-1;$r++)for(var rr=Yn[$r],Ci=Yn[$r+1],si=0;si<mi.length-1;si++)k.push(Dr(rr,mi[si],Ci,mi[si+1]));else k.push(Dr({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:X+1},{fixed:0,stretch:ie+1}));return k}function Bm(s,h,g){for(var S=0,k=0,N=s;k<N.length;k+=1){var q=N[k];S+=Math.max(h,Math.min(g,q[1]))-Math.max(h,Math.min(g,q[0]))}return S}function jm(s,h,g){for(var S=[{fixed:-1,stretch:0}],k=0,N=s;k<N.length;k+=1){var q=N[k],X=q[0],ie=q[1],ce=S[S.length-1];S.push({fixed:X-ce.stretch,stretch:ce.stretch}),S.push({fixed:X-ce.stretch,stretch:ce.stretch+(ie-X)})}return S.push({fixed:h+1,stretch:g}),S}function Sy(s,h,g,S){return s/h*g+S}function Um(s,h,g,S){return s-h*g/S}var Ty=function(s,h,g,S,k,N,q,X,ie,ce){if(this.boxStartIndex=s.length,ie){var ye=N.top,_e=N.bottom,Ae=N.collisionPadding;Ae&&(ye-=Ae[1],_e+=Ae[3]);var ze=_e-ye;ze>0&&(ze=Math.max(10,ze),this.circleDiameter=ze)}else{var Xe=N.top*q-X,Qe=N.bottom*q+X,pt=N.left*q-X,st=N.right*q+X,St=N.collisionPadding;if(St&&(pt-=St[0]*q,Xe-=St[1]*q,st+=St[2]*q,Qe+=St[3]*q),ce){var At=new Et(pt,Xe),Lt=new Et(st,Xe),zt=new Et(pt,Qe),nn=new Et(st,Qe),An=ce*Math.PI/180;At._rotate(An),Lt._rotate(An),zt._rotate(An),nn._rotate(An),pt=Math.min(At.x,Lt.x,zt.x,nn.x),st=Math.max(At.x,Lt.x,zt.x,nn.x),Xe=Math.min(At.y,Lt.y,zt.y,nn.y),Qe=Math.max(At.y,Lt.y,zt.y,nn.y)}s.emplaceBack(h.x,h.y,pt,Xe,st,Qe,g,S,k)}this.boxEndIndex=s.length},Rd=function(s,h){if(void 0===s&&(s=[]),void 0===h&&(h=Vm),this.data=s,this.length=this.data.length,this.compare=h,this.length>0)for(var g=(this.length>>1)-1;g>=0;g--)this._down(g)};function Vm(s,h){return s<h?-1:s>h?1:0}function Iy(s,h,g){void 0===h&&(h=1),void 0===g&&(g=!1);for(var S=1/0,k=1/0,N=-1/0,q=-1/0,X=s[0],ie=0;ie<X.length;ie++){var ce=X[ie];(!ie||ce.x<S)&&(S=ce.x),(!ie||ce.y<k)&&(k=ce.y),(!ie||ce.x>N)&&(N=ce.x),(!ie||ce.y>q)&&(q=ce.y)}var ye=Math.min(N-S,q-k),_e=ye/2,Ae=new Rd([],kv);if(0===ye)return new Et(S,k);for(var ze=S;ze<N;ze+=ye)for(var Xe=k;Xe<q;Xe+=ye)Ae.push(new Gm(ze+_e,Xe+_e,_e,s));for(var Qe=function(St){for(var At=0,Lt=0,zt=0,nn=St[0],An=0,zn=nn.length,_r=zn-1;An<zn;_r=An++){var Gn=nn[An],Dr=nn[_r],Yn=Gn.x*Dr.y-Dr.x*Gn.y;Lt+=(Gn.x+Dr.x)*Yn,zt+=(Gn.y+Dr.y)*Yn,At+=3*Yn}return new Gm(Lt/At,zt/At,0,St)}(s),pt=Ae.length;Ae.length;){var st=Ae.pop();(st.d>Qe.d||!Qe.d)&&(Qe=st,g&&console.log("found best %d after %d probes",Math.round(1e4*st.d)/1e4,pt)),st.max-Qe.d<=h||(Ae.push(new Gm(st.p.x-(_e=st.h/2),st.p.y-_e,_e,s)),Ae.push(new Gm(st.p.x+_e,st.p.y-_e,_e,s)),Ae.push(new Gm(st.p.x-_e,st.p.y+_e,_e,s)),Ae.push(new Gm(st.p.x+_e,st.p.y+_e,_e,s)),pt+=4)}return g&&(console.log("num probes: "+pt),console.log("best distance: "+Qe.d)),Qe.p}function kv(s,h){return h.max-s.max}function Gm(s,h,g,S){this.p=new Et(s,h),this.h=g,this.d=function(k,N){for(var q=!1,X=1/0,ie=0;ie<N.length;ie++)for(var ce=N[ie],ye=0,_e=ce.length,Ae=_e-1;ye<_e;Ae=ye++){var ze=ce[ye],Xe=ce[Ae];ze.y>k.y!=Xe.y>k.y&&k.x<(Xe.x-ze.x)*(k.y-ze.y)/(Xe.y-ze.y)+ze.x&&(q=!q),X=Math.min(X,K(k,ze,Xe))}return(q?1:-1)*Math.sqrt(X)}(this.p,S),this.max=this.d+this.h*Math.SQRT2}Rd.prototype.push=function(s){this.data.push(s),this.length++,this._up(this.length-1)},Rd.prototype.pop=function(){if(0!==this.length){var s=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),s}},Rd.prototype.peek=function(){return this.data[0]},Rd.prototype._up=function(s){for(var h=this.data,g=this.compare,S=h[s];s>0;){var k=s-1>>1,N=h[k];if(g(S,N)>=0)break;h[s]=N,s=k}h[s]=S},Rd.prototype._down=function(s){for(var h=this.data,g=this.compare,S=this.length>>1,k=h[s];s<S;){var N=1+(s<<1),q=h[N],X=N+1;if(X<this.length&&g(h[X],q)<0&&(N=X,q=h[X]),g(q,k)>=0)break;h[s]=q,s=N}h[s]=k};var Il=Number.POSITIVE_INFINITY;function J_(s,h){return h[1]!==Il?function(g,S,k){var N=0,q=0;switch(S=Math.abs(S),k=Math.abs(k),g){case"top-right":case"top-left":case"top":q=k-7;break;case"bottom-right":case"bottom-left":case"bottom":q=7-k}switch(g){case"top-right":case"bottom-right":case"right":N=-S;break;case"top-left":case"bottom-left":case"left":N=S}return[N,q]}(s,h[0],h[1]):function(g,S){var k=0,N=0;S<0&&(S=0);var q=S/Math.sqrt(2);switch(g){case"top-right":case"top-left":N=q-7;break;case"bottom-right":case"bottom-left":N=7-q;break;case"bottom":N=7-S;break;case"top":N=S-7}switch(g){case"top-right":case"bottom-right":k=-q;break;case"top-left":case"bottom-left":k=q;break;case"left":k=S;break;case"right":k=-S}return[k,N]}(s,h[0])}function Pv(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function qm(s,h,g,S,k,N,q,X,ie,ce,ye,_e,Ae,ze,Xe){var Qe=function(Lt,zt,nn,An,zn,_r,Gn,Dr){for(var Yn=An.layout.get("text-rotate").evaluate(_r,{})*Math.PI/180,mi=[],$r=0,rr=zt.positionedLines;$r<rr.length;$r+=1)for(var Ci=rr[$r],si=0,so=Ci.positionedGlyphs;si<so.length;si+=1){var Tr=so[si];if(Tr.rect){var ji=Tr.rect||{},Ia=4,ns=!0,Ha=1,_a=0,gs=(zn||Dr)&&Tr.vertical,Hs=Tr.metrics.advance*Tr.scale/2;if(Dr&&zt.verticalizable&&(_a=Ci.lineOffset/2-(Tr.imageName?-(24-Tr.metrics.width*Tr.scale)/2:24*(Tr.scale-1))),Tr.imageName){var Os=Gn[Tr.imageName];ns=Os.sdf,Ia=1/(Ha=Os.pixelRatio)}var uu=zn?[Tr.x+Hs,Tr.y]:[0,0],ys=zn?[0,0]:[Tr.x+Hs+nn[0],Tr.y+nn[1]-_a],cu=[0,0];gs&&(cu=ys,ys=[0,0]);var rs=(Tr.metrics.left-Ia)*Tr.scale-Hs+ys[0],vs=(-Tr.metrics.top-Ia)*Tr.scale+ys[1],Ei=rs+ji.w*Tr.scale/Ha,Jo=vs+ji.h*Tr.scale/Ha,Po=new Et(rs,vs),lo=new Et(Ei,vs),Zl=new Et(rs,Jo),nl=new Et(Ei,Jo);if(gs){var Ma=new Et(-Hs,Hs- -17),cl=-Math.PI/2,hu=12-Hs,Io=new Et(22-hu,-(Tr.imageName?hu:0)),Vp=new(Function.prototype.bind.apply(Et,[null].concat(cu)));Po._rotateAround(cl,Ma)._add(Io)._add(Vp),lo._rotateAround(cl,Ma)._add(Io)._add(Vp),Zl._rotateAround(cl,Ma)._add(Io)._add(Vp),nl._rotateAround(cl,Ma)._add(Io)._add(Vp)}if(Yn){var ku=Math.sin(Yn),fp=Math.cos(Yn),Qo=[fp,-ku,ku,fp];Po._matMult(Qo),lo._matMult(Qo),Zl._matMult(Qo),nl._matMult(Qo)}var Gp=new Et(0,0),Qh=new Et(0,0);mi.push({tl:Po,tr:lo,bl:Zl,br:nl,tex:ji,writingMode:zt.writingMode,glyphOffset:uu,sectionIndex:Tr.sectionIndex,isSDF:ns,pixelOffsetTL:Gp,pixelOffsetBR:Qh,minFontScaleX:0,minFontScaleY:0})}}return mi}(0,g,X,k,N,q,S,s.allowVerticalPlacement),pt=s.textSizeData,st=null;"source"===pt.kind?(st=[128*k.layout.get("text-size").evaluate(q,{})])[0]>32640&&sr(s.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):"composite"===pt.kind&&((st=[128*ze.compositeTextSizes[0].evaluate(q,{},Xe),128*ze.compositeTextSizes[1].evaluate(q,{},Xe)])[0]>32640||st[1]>32640)&&sr(s.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),s.addSymbols(s.text,Qe,st,X,N,q,ce,h,ie.lineStartIndex,ie.lineLength,Ae,Xe);for(var St=0,At=ye;St<At.length;St+=1)_e[At[St]]=s.text.placedSymbolArray.length-1;return 4*Qe.length}function pf(s){for(var h in s)return s[h];return null}function Tx(s,h,g,S){var k=s.compareText;if(h in k){for(var N=k[h],q=N.length-1;q>=0;q--)if(S.dist(N[q])<g)return!0}else k[h]=[];return k[h].push(S),!1}var Ix=km.VectorTileFeature.types,Q_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function kg(s,h,g,S,k,N,q,X,ie,ce,ye,_e,Ae){var ze=X?Math.min(32640,Math.round(X[0])):0,Xe=X?Math.min(32640,Math.round(X[1])):0;s.emplaceBack(h,g,Math.round(32*S),Math.round(32*k),N,q,(ze<<1)+(ie?1:0),Xe,16*ce,16*ye,256*_e,256*Ae)}function Rv(s,h,g){s.emplaceBack(h.x,h.y,g),s.emplaceBack(h.x,h.y,g),s.emplaceBack(h.x,h.y,g),s.emplaceBack(h.x,h.y,g)}function Q1(s){for(var h=0,g=s.sections;h<g.length;h+=1)if(Cu(g[h].text))return!0;return!1}var jp=function(s){this.layoutVertexArray=new Fc,this.indexArray=new fs,this.programConfigurations=s,this.segments=new G,this.dynamicLayoutVertexArray=new ah,this.opacityVertexArray=new Su,this.placedSymbolArray=new j};jp.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length},jp.prototype.upload=function(s,h,g,S){this.isEmpty()||(g&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Cg.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,qf.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,Q_,!0),this.opacityVertexBuffer.itemSize=1),(g||S)&&this.programConfigurations.upload(s))},jp.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},$n("SymbolBuffers",jp);var Od=function(s,h,g){this.layoutVertexArray=new s,this.layoutAttributes=h,this.indexArray=new g,this.segments=new G,this.collisionVertexArray=new ho};Od.prototype.upload=function(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,q_.members,!0)},Od.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},$n("CollisionBuffers",Od);var Pi=function(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(function(N){return N.id}),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Sn([]),this.placementViewportMatrix=Sn([]);var h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Za(this.zoom,h["text-size"]),this.iconSizeData=Za(this.zoom,h["icon-size"]);var g=this.layers[0].layout,S=g.get("symbol-sort-key"),k=g.get("symbol-z-order");this.canOverlap=g.get("text-allow-overlap")||g.get("icon-allow-overlap")||g.get("text-ignore-placement")||g.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==k&&!S.isConstant(),this.sortFeaturesByY=("viewport-y"===k||"auto"===k&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===g.get("symbol-placement")&&(this.writingModes=g.get("text-writing-mode").map(function(N){return zc[N]})),this.stateDependentLayerIds=this.layers.filter(function(N){return N.isStateDependent()}).map(function(N){return N.id}),this.sourceID=s.sourceID};Pi.prototype.createArrays=function(){this.text=new jp(new Hn(this.layers,this.zoom,function(s){return/^text/.test(s)})),this.icon=new jp(new Hn(this.layers,this.zoom,function(s){return/^icon/.test(s)})),this.glyphOffsetArray=new d,this.lineVertexArray=new x,this.symbolInstances=new l},Pi.prototype.calculateGlyphDependencies=function(s,h,g,S,k){for(var N=0;N<s.length;N++)if(h[s.charCodeAt(N)]=!0,(g||S)&&k){var q=Om[s.charAt(N)];q&&(h[q.charCodeAt(0)]=!0)}},Pi.prototype.populate=function(s,h,g){var S=this.layers[0],k=S.layout,N=k.get("text-font"),q=k.get("text-field"),X=k.get("icon-image"),ie=("constant"!==q.value.kind||q.value.value instanceof Ro&&!q.value.value.isEmpty()||q.value.value.toString().length>0)&&("constant"!==N.value.kind||N.value.value.length>0),ce="constant"!==X.value.kind||!!X.value.value||Object.keys(X.parameters).length>0,ye=k.get("symbol-sort-key");if(this.features=[],ie||ce){for(var _e=h.iconDependencies,Ae=h.glyphDependencies,ze=h.availableImages,Xe=new Vr(this.zoom),Qe=0,pt=s;Qe<pt.length;Qe+=1){var st=pt[Qe],St=st.feature,At=st.id,Lt=st.index,zt=st.sourceLayerIndex,nn=S._featureFilter.needGeometry,An=Zi(St,nn);if(S._featureFilter.filter(Xe,An,g)){nn||(An.geometry=Wr(St));var zn=void 0;if(ie){var _r=S.getValueAndResolveTokens("text-field",An,g,ze),Gn=Ro.factory(_r);Q1(Gn)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===to()||this.hasRTLText&&Yo.isParsed())&&(zn=Rm(Gn,S,An))}var Dr=void 0;if(ce){var Yn=S.getValueAndResolveTokens("icon-image",An,g,ze);Dr=Yn instanceof gi?Yn:gi.fromString(Yn)}if(zn||Dr){var mi=this.sortFeaturesByKey?ye.evaluate(An,{},g):void 0;if(this.features.push({id:At,text:zn,icon:Dr,index:Lt,sourceLayerIndex:zt,geometry:An.geometry,properties:St.properties,type:Ix[St.type],sortKey:mi}),Dr&&(_e[Dr.name]=!0),zn){var $r=N.evaluate(An,{},g).join(","),rr="map"===k.get("text-rotation-alignment")&&"point"!==k.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(zc.vertical)>=0;for(var Ci=0,si=zn.sections;Ci<si.length;Ci+=1){var so=si[Ci];if(so.image)_e[so.image.name]=!0;else{var Tr=rh(zn.toString()),ji=so.fontStack||$r,Ia=Ae[ji]=Ae[ji]||{};this.calculateGlyphDependencies(so.text,Ia,rr,this.allowVerticalPlacement,Tr)}}}}}}"line"===k.get("symbol-placement")&&(this.features=function(ns){var Ha={},_a={},gs=[],Hs=0;function Os(Ma){gs.push(ns[Ma]),Hs++}function uu(Ma,cl,hu){var Io=_a[Ma];return delete _a[Ma],_a[cl]=Io,gs[Io].geometry[0].pop(),gs[Io].geometry[0]=gs[Io].geometry[0].concat(hu[0]),Io}function ys(Ma,cl,hu){var Io=Ha[cl];return delete Ha[cl],Ha[Ma]=Io,gs[Io].geometry[0].shift(),gs[Io].geometry[0]=hu[0].concat(gs[Io].geometry[0]),Io}function cu(Ma,cl,hu){var Io=hu?cl[0][cl[0].length-1]:cl[0][0];return Ma+":"+Io.x+":"+Io.y}for(var rs=0;rs<ns.length;rs++){var vs=ns[rs],Ei=vs.geometry,Jo=vs.text?vs.text.toString():null;if(Jo){var Po=cu(Jo,Ei),lo=cu(Jo,Ei,!0);if(Po in _a&&lo in Ha&&_a[Po]!==Ha[lo]){var Zl=ys(Po,lo,Ei),nl=uu(Po,lo,gs[Zl].geometry);delete Ha[Po],delete _a[lo],_a[cu(Jo,gs[nl].geometry,!0)]=nl,gs[Zl].geometry=null}else Po in _a?uu(Po,lo,Ei):lo in Ha?ys(Po,lo,Ei):(Os(rs),Ha[Po]=Hs-1,_a[lo]=Hs-1)}else Os(rs)}return gs.filter(function(Ma){return Ma.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(ns,Ha){return ns.sortKey-Ha.sortKey})}},Pi.prototype.update=function(s,h,g){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,h,this.layers,g),this.icon.programConfigurations.updatePaintArrays(s,h,this.layers,g))},Pi.prototype.isEmpty=function(){return 0===this.symbolInstances.length&&!this.hasRTLText},Pi.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Pi.prototype.upload=function(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Pi.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Pi.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Pi.prototype.addToLineVertexArray=function(s,h){var g=this.lineVertexArray.length;if(void 0!==s.segment){for(var S=s.dist(h[s.segment+1]),k=s.dist(h[s.segment]),N={},q=s.segment+1;q<h.length;q++)N[q]={x:h[q].x,y:h[q].y,tileUnitDistanceFromAnchor:S},q<h.length-1&&(S+=h[q+1].dist(h[q]));for(var X=s.segment||0;X>=0;X--)N[X]={x:h[X].x,y:h[X].y,tileUnitDistanceFromAnchor:k},X>0&&(k+=h[X-1].dist(h[X]));for(var ie=0;ie<h.length;ie++){var ce=N[ie];this.lineVertexArray.emplaceBack(ce.x,ce.y,ce.tileUnitDistanceFromAnchor)}}return{lineStartIndex:g,lineLength:this.lineVertexArray.length-g}},Pi.prototype.addSymbols=function(s,h,g,S,k,N,q,X,ie,ce,ye,_e){for(var Ae=s.indexArray,ze=s.layoutVertexArray,Xe=s.segments.prepareSegment(4*h.length,ze,Ae,this.canOverlap?N.sortKey:void 0),Qe=this.glyphOffsetArray.length,pt=Xe.vertexLength,st=this.allowVerticalPlacement&&q===zc.vertical?Math.PI/2:0,St=N.text&&N.text.sections,At=0;At<h.length;At++){var Lt=h[At],zt=Lt.tl,nn=Lt.tr,An=Lt.bl,zn=Lt.br,_r=Lt.tex,Gn=Lt.pixelOffsetTL,Dr=Lt.pixelOffsetBR,Yn=Lt.minFontScaleX,mi=Lt.minFontScaleY,$r=Lt.glyphOffset,rr=Lt.isSDF,Ci=Lt.sectionIndex,si=Xe.vertexLength,so=$r[1];kg(ze,X.x,X.y,zt.x,so+zt.y,_r.x,_r.y,g,rr,Gn.x,Gn.y,Yn,mi),kg(ze,X.x,X.y,nn.x,so+nn.y,_r.x+_r.w,_r.y,g,rr,Dr.x,Gn.y,Yn,mi),kg(ze,X.x,X.y,An.x,so+An.y,_r.x,_r.y+_r.h,g,rr,Gn.x,Dr.y,Yn,mi),kg(ze,X.x,X.y,zn.x,so+zn.y,_r.x+_r.w,_r.y+_r.h,g,rr,Dr.x,Dr.y,Yn,mi),Rv(s.dynamicLayoutVertexArray,X,st),Ae.emplaceBack(si,si+1,si+2),Ae.emplaceBack(si+1,si+2,si+3),Xe.vertexLength+=4,Xe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack($r[0]),At!==h.length-1&&Ci===h[At+1].sectionIndex||s.programConfigurations.populatePaintArrays(ze.length,N,N.index,{},_e,St&&St[Ci])}s.placedSymbolArray.emplaceBack(X.x,X.y,Qe,this.glyphOffsetArray.length-Qe,pt,ie,ce,X.segment,g?g[0]:0,g?g[1]:0,S[0],S[1],q,0,!1,0,ye)},Pi.prototype._addCollisionDebugVertex=function(s,h,g,S,k,N){return h.emplaceBack(0,0),s.emplaceBack(g.x,g.y,S,k,Math.round(N.x),Math.round(N.y))},Pi.prototype.addCollisionDebugVertices=function(s,h,g,S,k,N,q){var X=k.segments.prepareSegment(4,k.layoutVertexArray,k.indexArray),ie=X.vertexLength,ce=k.layoutVertexArray,ye=k.collisionVertexArray,_e=q.anchorX,Ae=q.anchorY;this._addCollisionDebugVertex(ce,ye,N,_e,Ae,new Et(s,h)),this._addCollisionDebugVertex(ce,ye,N,_e,Ae,new Et(g,h)),this._addCollisionDebugVertex(ce,ye,N,_e,Ae,new Et(g,S)),this._addCollisionDebugVertex(ce,ye,N,_e,Ae,new Et(s,S)),X.vertexLength+=4;var ze=k.indexArray;ze.emplaceBack(ie,ie+1),ze.emplaceBack(ie+1,ie+2),ze.emplaceBack(ie+2,ie+3),ze.emplaceBack(ie+3,ie),X.primitiveLength+=4},Pi.prototype.addDebugCollisionBoxes=function(s,h,g,S){for(var k=s;k<h;k++){var N=this.collisionBoxArray.get(k);this.addCollisionDebugVertices(N.x1,N.y1,N.x2,N.y2,S?this.textCollisionBox:this.iconCollisionBox,N.anchorPoint,g)}},Pi.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Od(pc,Sv.members,Qs),this.iconCollisionBox=new Od(pc,Sv.members,Qs);for(var s=0;s<this.symbolInstances.length;s++){var h=this.symbolInstances.get(s);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}},Pi.prototype._deserializeCollisionBoxesForSymbol=function(s,h,g,S,k,N,q,X,ie){for(var ce={},ye=h;ye<g;ye++){var _e=s.get(ye);ce.textBox={x1:_e.x1,y1:_e.y1,x2:_e.x2,y2:_e.y2,anchorPointX:_e.anchorPointX,anchorPointY:_e.anchorPointY},ce.textFeatureIndex=_e.featureIndex;break}for(var Ae=S;Ae<k;Ae++){var ze=s.get(Ae);ce.verticalTextBox={x1:ze.x1,y1:ze.y1,x2:ze.x2,y2:ze.y2,anchorPointX:ze.anchorPointX,anchorPointY:ze.anchorPointY},ce.verticalTextFeatureIndex=ze.featureIndex;break}for(var Xe=N;Xe<q;Xe++){var Qe=s.get(Xe);ce.iconBox={x1:Qe.x1,y1:Qe.y1,x2:Qe.x2,y2:Qe.y2,anchorPointX:Qe.anchorPointX,anchorPointY:Qe.anchorPointY},ce.iconFeatureIndex=Qe.featureIndex;break}for(var pt=X;pt<ie;pt++){var st=s.get(pt);ce.verticalIconBox={x1:st.x1,y1:st.y1,x2:st.x2,y2:st.y2,anchorPointX:st.anchorPointX,anchorPointY:st.anchorPointY},ce.verticalIconFeatureIndex=st.featureIndex;break}return ce},Pi.prototype.deserializeCollisionBoxes=function(s){this.collisionArrays=[];for(var h=0;h<this.symbolInstances.length;h++){var g=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,g.textBoxStartIndex,g.textBoxEndIndex,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g.iconBoxStartIndex,g.iconBoxEndIndex,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex))}},Pi.prototype.hasTextData=function(){return this.text.segments.get().length>0},Pi.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Pi.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Pi.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Pi.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Pi.prototype.addIndicesForPlacedSymbol=function(s,h){for(var g=s.placedSymbolArray.get(h),S=g.vertexStartIndex+4*g.numGlyphs,k=g.vertexStartIndex;k<S;k+=4)s.indexArray.emplaceBack(k,k+1,k+2),s.indexArray.emplaceBack(k+1,k+2,k+3)},Pi.prototype.getSortedSymbolIndexes=function(s){if(this.sortedAngle===s&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var h=Math.sin(s),g=Math.cos(s),S=[],k=[],N=[],q=0;q<this.symbolInstances.length;++q){N.push(q);var X=this.symbolInstances.get(q);S.push(0|Math.round(h*X.anchorX+g*X.anchorY)),k.push(X.featureIndex)}return N.sort(function(ie,ce){return S[ie]-S[ce]||k[ce]-k[ie]}),N},Pi.prototype.addToSortKeyRanges=function(s,h){var g=this.sortKeyRanges[this.sortKeyRanges.length-1];g&&g.sortKey===h?g.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:s,symbolInstanceEnd:s+1})},Pi.prototype.sortFeatures=function(s){var h=this;if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var g=0,S=this.symbolInstanceIndexes;g<S.length;g+=1){var k=this.symbolInstances.get(S[g]);this.featureSortOrder.push(k.featureIndex),[k.rightJustifiedTextSymbolIndex,k.centerJustifiedTextSymbolIndex,k.leftJustifiedTextSymbolIndex].forEach(function(N,q,X){N>=0&&X.indexOf(N)===q&&h.addIndicesForPlacedSymbol(h.text,N)}),k.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,k.verticalPlacedTextSymbolIndex),k.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,k.placedIconSymbolIndex),k.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,k.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},$n("SymbolBucket",Pi,{omit:["layers","collisionBoxArray","features","compareText"]}),Pi.MAX_GLYPHS=65535,Pi.addDynamicAttributes=Rv;var Kf=new Rs({"symbol-placement":new Un(pe.layout_symbol["symbol-placement"]),"symbol-spacing":new Un(pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Un(pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Nr(pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Un(pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Un(pe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Un(pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Un(pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Un(pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Nr(pe.layout_symbol["icon-size"]),"icon-text-fit":new Un(pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Un(pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Nr(pe.layout_symbol["icon-image"]),"icon-rotate":new Nr(pe.layout_symbol["icon-rotate"]),"icon-padding":new Un(pe.layout_symbol["icon-padding"]),"icon-keep-upright":new Un(pe.layout_symbol["icon-keep-upright"]),"icon-offset":new Nr(pe.layout_symbol["icon-offset"]),"icon-anchor":new Nr(pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Un(pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Un(pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Un(pe.layout_symbol["text-rotation-alignment"]),"text-field":new Nr(pe.layout_symbol["text-field"]),"text-font":new Nr(pe.layout_symbol["text-font"]),"text-size":new Nr(pe.layout_symbol["text-size"]),"text-max-width":new Nr(pe.layout_symbol["text-max-width"]),"text-line-height":new Un(pe.layout_symbol["text-line-height"]),"text-letter-spacing":new Nr(pe.layout_symbol["text-letter-spacing"]),"text-justify":new Nr(pe.layout_symbol["text-justify"]),"text-radial-offset":new Nr(pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Un(pe.layout_symbol["text-variable-anchor"]),"text-anchor":new Nr(pe.layout_symbol["text-anchor"]),"text-max-angle":new Un(pe.layout_symbol["text-max-angle"]),"text-writing-mode":new Un(pe.layout_symbol["text-writing-mode"]),"text-rotate":new Nr(pe.layout_symbol["text-rotate"]),"text-padding":new Un(pe.layout_symbol["text-padding"]),"text-keep-upright":new Un(pe.layout_symbol["text-keep-upright"]),"text-transform":new Nr(pe.layout_symbol["text-transform"]),"text-offset":new Nr(pe.layout_symbol["text-offset"]),"text-allow-overlap":new Un(pe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Un(pe.layout_symbol["text-ignore-placement"]),"text-optional":new Un(pe.layout_symbol["text-optional"])}),Pg={paint:new Rs({"icon-opacity":new Nr(pe.paint_symbol["icon-opacity"]),"icon-color":new Nr(pe.paint_symbol["icon-color"]),"icon-halo-color":new Nr(pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Nr(pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Nr(pe.paint_symbol["icon-halo-blur"]),"icon-translate":new Un(pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Un(pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Nr(pe.paint_symbol["text-opacity"]),"text-color":new Nr(pe.paint_symbol["text-color"],{runtimeType:On,getOverride:function(s){return s.textColor},hasOverride:function(s){return!!s.textColor}}),"text-halo-color":new Nr(pe.paint_symbol["text-halo-color"]),"text-halo-width":new Nr(pe.paint_symbol["text-halo-width"]),"text-halo-blur":new Nr(pe.paint_symbol["text-halo-blur"]),"text-translate":new Un(pe.paint_symbol["text-translate"]),"text-translate-anchor":new Un(pe.paint_symbol["text-translate-anchor"])}),layout:Kf},Ld=function(s){this.type=s.property.overrides?s.property.overrides.runtimeType:Xt,this.defaultValue=s};Ld.prototype.evaluate=function(s){if(s.formattedSection){var h=this.defaultValue.property.overrides;if(h&&h.hasOverride(s.formattedSection))return h.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default},Ld.prototype.eachChild=function(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)},Ld.prototype.outputDefined=function(){return!1},Ld.prototype.serialize=function(){return null},$n("FormatSectionOverride",Ld,{omit:["defaultValue"]});var Bc=function(s){function h(g){s.call(this,g,Pg)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.recalculate=function(g,S){if(s.prototype.recalculate.call(this,g,S),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var k=this.layout.get("text-writing-mode");if(k){for(var N=[],q=0,X=k;q<X.length;q+=1){var ie=X[q];N.indexOf(ie)<0&&N.push(ie)}this.layout._values["text-writing-mode"]=N}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},h.prototype.getValueAndResolveTokens=function(g,S,k,N){var ie,q=this.layout.get(g).evaluate(S,{},k,N),X=this._unevaluatedLayout._values[g];return X.isDataDriven()||Gs(X.value)||!q?q:(ie=S.properties,q.replace(/{([^{}]+)}/g,function(ye,_e){return _e in ie?String(ie[_e]):""}))},h.prototype.createBucket=function(g){return new Pi(g)},h.prototype.queryRadius=function(){return 0},h.prototype.queryIntersectsFeature=function(){return!1},h.prototype._setPaintOverrides=function(){for(var g=0,S=Pg.paint.overridableProperties;g<S.length;g+=1){var k=S[g];if(h.hasPaintOverride(this.layout,k)){var N,q=this.paint.get(k),X=new Ld(q),ie=new So(X,q.property.specification);N="constant"===q.value.kind||"source"===q.value.kind?new Ao("source",ie):new Bl("composite",ie,q.value.zoomStops,q.value._interpolationType),this.paint._values[k]=new ds(q.property,N,q.parameters)}}},h.prototype._handleOverridablePaintPropertyUpdate=function(g,S,k){return!(!this.layout||S.isDataDriven()||k.isDataDriven())&&h.hasPaintOverride(this.layout,g)},h.hasPaintOverride=function(g,S){var k=g.get("text-field"),N=Pg.paint.properties[S],q=!1,X=function(ye){for(var _e=0,Ae=ye;_e<Ae.length;_e+=1)if(N.overrides&&N.overrides.hasOverride(Ae[_e]))return void(q=!0)};if("constant"===k.value.kind&&k.value.value instanceof Ro)X(k.value.value.sections);else if("source"===k.value.kind){var ie=function(ye){q||(ye instanceof xl&&Ya(ye.value)===Ft?X(ye.value.sections):ye instanceof ls?X(ye.sections):ye.eachChild(ie))},ce=k.value;ce._styleExpression&&ie(ce._styleExpression.expression)}return q},h}(Lr),Rg={paint:new Rs({"background-color":new Un(pe.paint_background["background-color"]),"background-pattern":new Ps(pe.paint_background["background-pattern"]),"background-opacity":new Un(pe.paint_background["background-opacity"])})},Jf=function(s){function h(g){s.call(this,g,Rg)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h}(Lr),e0={paint:new Rs({"raster-opacity":new Un(pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Un(pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Un(pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Un(pe.paint_raster["raster-brightness-max"]),"raster-saturation":new Un(pe.paint_raster["raster-saturation"]),"raster-contrast":new Un(pe.paint_raster["raster-contrast"]),"raster-resampling":new Un(pe.paint_raster["raster-resampling"]),"raster-fade-duration":new Un(pe.paint_raster["raster-fade-duration"])})},t0=function(s){function h(g){s.call(this,g,e0)}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h}(Lr),n0=function(s){function h(g){s.call(this,g,{}),this.implementation=g}return s&&(h.__proto__=s),(h.prototype=Object.create(s&&s.prototype)).constructor=h,h.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},h.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},h.prototype.recalculate=function(){},h.prototype.updateTransitions=function(){},h.prototype.hasTransition=function(){},h.prototype.serialize=function(){},h.prototype.onAdd=function(g){this.implementation.onAdd&&this.implementation.onAdd(g,g.painter.context.gl)},h.prototype.onRemove=function(g){this.implementation.onRemove&&this.implementation.onRemove(g,g.painter.context.gl)},h}(Lr),Mx={circle:en,heatmap:fc,hillshade:Sa,fill:_v,"fill-extrusion":wv,line:G_,symbol:Bc,background:Jf,raster:t0},Ov=Ge.HTMLImageElement,r0=Ge.HTMLCanvasElement,Lv=Ge.HTMLVideoElement,o0=Ge.ImageData,My=Ge.ImageBitmap,ad=function(s,h,g,S){this.context=s,this.format=g,this.texture=s.gl.createTexture(),this.update(h,S)};ad.prototype.update=function(s,h,g){var S=s.width,k=s.height,N=!(this.size&&this.size[0]===S&&this.size[1]===k||g),q=this.context,X=q.gl;if(this.useMipmap=Boolean(h&&h.useMipmap),X.bindTexture(X.TEXTURE_2D,this.texture),q.pixelStoreUnpackFlipY.set(!1),q.pixelStoreUnpack.set(1),q.pixelStoreUnpackPremultiplyAlpha.set(this.format===X.RGBA&&(!h||!1!==h.premultiply)),N)this.size=[S,k],s instanceof Ov||s instanceof r0||s instanceof Lv||s instanceof o0||My&&s instanceof My?X.texImage2D(X.TEXTURE_2D,0,this.format,this.format,X.UNSIGNED_BYTE,s):X.texImage2D(X.TEXTURE_2D,0,this.format,S,k,0,this.format,X.UNSIGNED_BYTE,s.data);else{var ie=g||{x:0,y:0},ce=ie.x,ye=ie.y;s instanceof Ov||s instanceof r0||s instanceof Lv||s instanceof o0||My&&s instanceof My?X.texSubImage2D(X.TEXTURE_2D,0,ce,ye,X.RGBA,X.UNSIGNED_BYTE,s):X.texSubImage2D(X.TEXTURE_2D,0,ce,ye,S,k,X.RGBA,X.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&X.generateMipmap(X.TEXTURE_2D)},ad.prototype.bind=function(s,h,g){var S=this.context.gl;S.bindTexture(S.TEXTURE_2D,this.texture),g!==S.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(g=S.LINEAR),s!==this.filter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,s),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,g||s),this.filter=s),h!==this.wrap&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,h),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,h),this.wrap=h)},ad.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},ad.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Og=function(s){var h=this;this._callback=s,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){h._triggered=!1,h._callback()})};Og.prototype.trigger=function(){var s=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){s._triggered=!1,s._callback()},0))},Og.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Qf=function(s,h,g){this.target=s,this.parent=h,this.mapId=g,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},an(["receive","process"],this),this.invoker=new Og(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=je()?s:Ge};function Fv(s,h,g){var S=2*Math.PI*6378137/256/Math.pow(2,g);return[s*S-2*Math.PI*6378137/2,h*S-2*Math.PI*6378137/2]}Qf.prototype.send=function(s,h,g,S,k){var N=this;void 0===k&&(k=!1);var q=Math.round(1e18*Math.random()).toString(36).substring(0,10);g&&(this.callbacks[q]=g);var X=Pr(this.globalScope)?void 0:[];return this.target.postMessage({id:q,type:s,hasCallback:!!g,targetMapId:S,mustQueue:k,sourceMapId:this.mapId,data:Lo(h,X)},X),{cancel:function(){g&&delete N.callbacks[q],N.target.postMessage({id:q,type:"<cancel>",targetMapId:S,sourceMapId:N.mapId})}}},Qf.prototype.receive=function(s){var h=s.data,g=h.id;if(g&&(!h.targetMapId||this.mapId===h.targetMapId))if("<cancel>"===h.type){delete this.tasks[g];var S=this.cancelCallbacks[g];delete this.cancelCallbacks[g],S&&S()}else je()||h.mustQueue?(this.tasks[g]=h,this.taskQueue.push(g),this.invoker.trigger()):this.processTask(g,h)},Qf.prototype.process=function(){if(this.taskQueue.length){var s=this.taskQueue.shift(),h=this.tasks[s];delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),h&&this.processTask(s,h)}},Qf.prototype.processTask=function(s,h){var g=this;if("<response>"===h.type){var S=this.callbacks[s];delete this.callbacks[s],S&&(h.error?S(bu(h.error)):S(null,bu(h.data)))}else{var k=!1,N=Pr(this.globalScope)?void 0:[],q=h.hasCallback?function(ye,_e){k=!0,delete g.cancelCallbacks[s],g.target.postMessage({id:s,type:"<response>",sourceMapId:g.mapId,error:ye?Lo(ye):null,data:Lo(_e,N)},N)}:function(ye){k=!0},X=null,ie=bu(h.data);if(this.parent[h.type])X=this.parent[h.type](h.sourceMapId,ie,q);else if(this.parent.getWorkerSource){var ce=h.type.split(".");X=this.parent.getWorkerSource(h.sourceMapId,ce[0],ie.source)[ce[1]](ie,q)}else q(new Error("Could not find function "+h.type));!k&&X&&X.cancel&&(this.cancelCallbacks[s]=X.cancel)}},Qf.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var ul=function(s,h){s&&(h?this.setSouthWest(s).setNorthEast(h):4===s.length?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1]))};ul.prototype.setNorthEast=function(s){return this._ne=s instanceof Ta?new Ta(s.lng,s.lat):Ta.convert(s),this},ul.prototype.setSouthWest=function(s){return this._sw=s instanceof Ta?new Ta(s.lng,s.lat):Ta.convert(s),this},ul.prototype.extend=function(s){var h,g,S=this._sw,k=this._ne;if(s instanceof Ta)h=s,g=s;else{if(!(s instanceof ul))return Array.isArray(s)?4===s.length||s.every(Array.isArray)?this.extend(ul.convert(s)):this.extend(Ta.convert(s)):this;if(g=s._ne,!(h=s._sw)||!g)return this}return S||k?(S.lng=Math.min(h.lng,S.lng),S.lat=Math.min(h.lat,S.lat),k.lng=Math.max(g.lng,k.lng),k.lat=Math.max(g.lat,k.lat)):(this._sw=new Ta(h.lng,h.lat),this._ne=new Ta(g.lng,g.lat)),this},ul.prototype.getCenter=function(){return new Ta((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},ul.prototype.getSouthWest=function(){return this._sw},ul.prototype.getNorthEast=function(){return this._ne},ul.prototype.getNorthWest=function(){return new Ta(this.getWest(),this.getNorth())},ul.prototype.getSouthEast=function(){return new Ta(this.getEast(),this.getSouth())},ul.prototype.getWest=function(){return this._sw.lng},ul.prototype.getSouth=function(){return this._sw.lat},ul.prototype.getEast=function(){return this._ne.lng},ul.prototype.getNorth=function(){return this._ne.lat},ul.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},ul.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},ul.prototype.isEmpty=function(){return!(this._sw&&this._ne)},ul.prototype.contains=function(s){var h=Ta.convert(s),g=h.lng,S=h.lat,k=this._sw.lng<=g&&g<=this._ne.lng;return this._sw.lng>this._ne.lng&&(k=this._sw.lng>=g&&g>=this._ne.lng),this._sw.lat<=S&&S<=this._ne.lat&&k},ul.convert=function(s){return!s||s instanceof ul?s:new ul(s)};var Ta=function(s,h){if(isNaN(s)||isNaN(h))throw new Error("Invalid LngLat object: ("+s+", "+h+")");if(this.lng=+s,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Ta.prototype.wrap=function(){return new Ta(fn(this.lng,-180,180),this.lat)},Ta.prototype.toArray=function(){return[this.lng,this.lat]},Ta.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Ta.prototype.distanceTo=function(s){var h=Math.PI/180,g=this.lat*h,S=s.lat*h,k=Math.sin(g)*Math.sin(S)+Math.cos(g)*Math.cos(S)*Math.cos((s.lng-this.lng)*h);return 6371008.8*Math.acos(Math.min(k,1))},Ta.prototype.toBounds=function(s){void 0===s&&(s=0);var h=360*s/40075017,g=h/Math.cos(Math.PI/180*this.lat);return new ul(new Ta(this.lng-g,this.lat-h),new Ta(this.lng+g,this.lat+h))},Ta.convert=function(s){if(s instanceof Ta)return s;if(Array.isArray(s)&&(2===s.length||3===s.length))return new Ta(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&"object"==typeof s&&null!==s)return new Ta(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var a0=2*Math.PI*6371008.8;function s0(s){return a0*Math.cos(s*Math.PI/180)}function em(s){return(180+s)/360}function zv(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function l0(s,h){return s/s0(h)}function lu(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}var jc=function(s,h,g){void 0===g&&(g=0),this.x=+s,this.y=+h,this.z=+g};jc.fromLngLat=function(s,h){void 0===h&&(h=0);var g=Ta.convert(s);return new jc(em(g.lng),zv(g.lat),l0(h,g.lat))},jc.prototype.toLngLat=function(){return new Ta(360*this.x-180,lu(this.y))},jc.prototype.toAltitude=function(){return this.z*s0(lu(this.y))},jc.prototype.meterInMercatorCoordinateUnits=function(){return 1/a0*(s=lu(this.y),1/Math.cos(s*Math.PI/180));var s};var Fd=function(s,h,g){this.z=s,this.x=h,this.y=g,this.key=Lg(0,s,s,h,g)};Fd.prototype.equals=function(s){return this.z===s.z&&this.x===s.x&&this.y===s.y},Fd.prototype.url=function(s,h){var g,S,k,N,q,X=(S=this.y,k=this.z,N=Fv(256*(g=this.x),256*(S=Math.pow(2,k)-S-1),k),q=Fv(256*(g+1),256*(S+1),k),N[0]+","+N[1]+","+q[0]+","+q[1]),ie=function(ce,ye,_e){for(var Ae,ze="",Xe=ce;Xe>0;Xe--)ze+=(ye&(Ae=1<<Xe-1)?1:0)+(_e&Ae?2:0);return ze}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===h?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",ie).replace("{bbox-epsg-3857}",X)},Fd.prototype.getTilePoint=function(s){var h=Math.pow(2,this.z);return new Et(8192*(s.x*h-this.x),8192*(s.y*h-this.y))},Fd.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Zm=function(s,h){this.wrap=s,this.canonical=h,this.key=Lg(s,h.z,h.z,h.x,h.y)},ts=function(s,h,g,S,k){this.overscaledZ=s,this.wrap=h,this.canonical=new Fd(g,+S,+k),this.key=Lg(h,s,g,S,k)};function Lg(s,h,g,S,k){(s*=2)<0&&(s=-1*s-1);var N=1<<g;return(N*N*s+N*k+S).toString(36)+g.toString(36)+h.toString(36)}ts.prototype.equals=function(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)},ts.prototype.scaledTo=function(s){var h=this.canonical.z-s;return s>this.canonical.z?new ts(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ts(s,this.wrap,s,this.canonical.x>>h,this.canonical.y>>h)},ts.prototype.calculateScaledKey=function(s,h){var g=this.canonical.z-s;return s>this.canonical.z?Lg(this.wrap*+h,s,this.canonical.z,this.canonical.x,this.canonical.y):Lg(this.wrap*+h,s,s,this.canonical.x>>g,this.canonical.y>>g)},ts.prototype.isChildOf=function(s){if(s.wrap!==this.wrap)return!1;var h=this.canonical.z-s.canonical.z;return 0===s.overscaledZ||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>h&&s.canonical.y===this.canonical.y>>h},ts.prototype.children=function(s){if(this.overscaledZ>=s)return[new ts(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var h=this.canonical.z+1,g=2*this.canonical.x,S=2*this.canonical.y;return[new ts(h,this.wrap,h,g,S),new ts(h,this.wrap,h,g+1,S),new ts(h,this.wrap,h,g,S+1),new ts(h,this.wrap,h,g+1,S+1)]},ts.prototype.isLessThan=function(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))},ts.prototype.wrapped=function(){return new ts(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ts.prototype.unwrapTo=function(s){return new ts(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)},ts.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ts.prototype.toUnwrapped=function(){return new Zm(this.wrap,this.canonical)},ts.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ts.prototype.getTilePoint=function(s){return this.canonical.getTilePoint(new jc(s.x-this.wrap,s.y))},$n("CanonicalTileID",Fd),$n("OverscaledTileID",ts,{omit:["posMatrix"]});var zd=function(s,h,g){if(this.uid=s,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(g&&"mapbox"!==g&&"terrarium"!==g)return sr('"'+g+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=h.height;var S=this.dim=h.height-2;this.data=new Uint32Array(h.data.buffer),this.encoding=g||"mapbox";for(var k=0;k<S;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(S,k)]=this.data[this._idx(S-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,S)]=this.data[this._idx(k,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)]};zd.prototype.get=function(s,h){var g=new Uint8Array(this.data.buffer),S=4*this._idx(s,h);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(g[S],g[S+1],g[S+2])},zd.prototype.getUnpackVector=function(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},zd.prototype._idx=function(s,h){if(s<-1||s>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(s+1)},zd.prototype._unpackMapbox=function(s,h,g){return(256*s*256+256*h+g)/10-1e4},zd.prototype._unpackTerrarium=function(s,h,g){return 256*s+h+g/256-32768},zd.prototype.getPixels=function(){return new ai({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},zd.prototype.backfillBorder=function(s,h,g){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");var S=h*this.dim,k=h*this.dim+this.dim,N=g*this.dim,q=g*this.dim+this.dim;switch(h){case-1:S=k-1;break;case 1:k=S+1}switch(g){case-1:N=q-1;break;case 1:q=N+1}for(var X=-h*this.dim,ie=-g*this.dim,ce=N;ce<q;ce++)for(var ye=S;ye<k;ye++)this.data[this._idx(ye,ce)]=s.data[this._idx(ye+X,ce+ie)]},$n("DEMData",zd);var df=function(s){this._stringToNumber={},this._numberToString=[];for(var h=0;h<s.length;h++){var g=s[h];this._stringToNumber[g]=h,this._numberToString[h]=g}};df.prototype.encode=function(s){return this._stringToNumber[s]},df.prototype.decode=function(s){return this._numberToString[s]};var Fg=function(s,h,g,S,k){this.type="Feature",this._vectorTileFeature=s,s._z=h,s._x=g,s._y=S,this.properties=s.properties,this.id=k},Nv={geometry:{configurable:!0}};Nv.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Nv.geometry.set=function(s){this._geometry=s},Fg.prototype.toJSON=function(){var s={geometry:this.geometry};for(var h in this)"_geometry"!==h&&"_vectorTileFeature"!==h&&(s[h]=this[h]);return s},Object.defineProperties(Fg.prototype,Nv);var Nd=function(){this.state={},this.stateChanges={},this.deletedStates={}};Nd.prototype.updateState=function(s,h,g){var S=String(h);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][S]=this.stateChanges[s][S]||{},et(this.stateChanges[s][S],g),null===this.deletedStates[s])for(var k in this.deletedStates[s]={},this.state[s])k!==S&&(this.deletedStates[s][k]=null);else if(this.deletedStates[s]&&null===this.deletedStates[s][S])for(var N in this.deletedStates[s][S]={},this.state[s][S])g[N]||(this.deletedStates[s][S][N]=null);else for(var q in g)this.deletedStates[s]&&this.deletedStates[s][S]&&null===this.deletedStates[s][S][q]&&delete this.deletedStates[s][S][q]},Nd.prototype.removeFeatureState=function(s,h,g){if(null!==this.deletedStates[s]){var S=String(h);if(this.deletedStates[s]=this.deletedStates[s]||{},g&&void 0!==h)null!==this.deletedStates[s][S]&&(this.deletedStates[s][S]=this.deletedStates[s][S]||{},this.deletedStates[s][S][g]=null);else if(void 0!==h)if(this.stateChanges[s]&&this.stateChanges[s][S])for(g in this.deletedStates[s][S]={},this.stateChanges[s][S])this.deletedStates[s][S][g]=null;else this.deletedStates[s][S]=null;else this.deletedStates[s]=null}},Nd.prototype.getState=function(s,h){var g=String(h),S=et({},(this.state[s]||{})[g],(this.stateChanges[s]||{})[g]);if(null===this.deletedStates[s])return{};if(this.deletedStates[s]){var k=this.deletedStates[s][h];if(null===k)return{};for(var N in k)delete S[N]}return S},Nd.prototype.initializeTileState=function(s,h){s.setFeatureState(this.state,h)},Nd.prototype.coalesceChanges=function(s,h){var g={};for(var S in this.stateChanges){this.state[S]=this.state[S]||{};var k={};for(var N in this.stateChanges[S])this.state[S][N]||(this.state[S][N]={}),et(this.state[S][N],this.stateChanges[S][N]),k[N]=this.state[S][N];g[S]=k}for(var q in this.deletedStates){this.state[q]=this.state[q]||{};var X={};if(null===this.deletedStates[q])for(var ie in this.state[q])X[ie]={},this.state[q][ie]={};else for(var ce in this.deletedStates[q]){if(null===this.deletedStates[q][ce])this.state[q][ce]={};else for(var ye=0,_e=Object.keys(this.deletedStates[q][ce]);ye<_e.length;ye+=1)delete this.state[q][ce][_e[ye]];X[ce]=this.state[q][ce]}g[q]=g[q]||{},et(g[q],X)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(g).length)for(var Ae in s)s[Ae].setFeatureState(g,h)};var sd=function(s,h){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new hs(8192,16,0),this.grid3D=new hs(8192,16,0),this.featureIndexArray=new D,this.promoteId=h};function Up(s,h,g,S,k){return nr(s,function(N,q){var X=h instanceof ta?h.get(q):null;return X&&X.evaluate?X.evaluate(g,S,k):X})}function fo(s){for(var h=1/0,g=1/0,S=-1/0,k=-1/0,N=0,q=s;N<q.length;N+=1){var X=q[N];h=Math.min(h,X.x),g=Math.min(g,X.y),S=Math.max(S,X.x),k=Math.max(k,X.y)}return{minX:h,minY:g,maxX:S,maxY:k}}function u0(s,h){return h-s}sd.prototype.insert=function(s,h,g,S,k,N){var q=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(g,S,k);for(var X=N?this.grid3D:this.grid,ie=0;ie<h.length;ie++){for(var ce=h[ie],ye=[1/0,1/0,-1/0,-1/0],_e=0;_e<ce.length;_e++){var Ae=ce[_e];ye[0]=Math.min(ye[0],Ae.x),ye[1]=Math.min(ye[1],Ae.y),ye[2]=Math.max(ye[2],Ae.x),ye[3]=Math.max(ye[3],Ae.y)}ye[0]<8192&&ye[1]<8192&&ye[2]>=0&&ye[3]>=0&&X.insert(q,ye[0],ye[1],ye[2],ye[3])}},sd.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new km.VectorTile(new yy(this.rawTileData)).layers,this.sourceLayerCoder=new df(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},sd.prototype.query=function(s,h,g,S){var k=this;this.loadVTLayers();for(var N=s.params||{},q=8192/s.tileSize/s.scale,X=Vu(N.filter),ie=s.queryGeometry,ce=s.queryPadding*q,ye=fo(ie),_e=this.grid.query(ye.minX-ce,ye.minY-ce,ye.maxX+ce,ye.maxY+ce),Ae=fo(s.cameraQueryGeometry),Xe=0,Qe=this.grid3D.query(Ae.minX-ce,Ae.minY-ce,Ae.maxX+ce,Ae.maxY+ce,function(Lt,zt,nn,An){return function(zn,_r,Gn,Dr,Yn){for(var mi=0,$r=zn;mi<$r.length;mi+=1){var rr=$r[mi];if(_r<=rr.x&&Gn<=rr.y&&Dr>=rr.x&&Yn>=rr.y)return!0}var Ci=[new Et(_r,Gn),new Et(_r,Yn),new Et(Dr,Yn),new Et(Dr,Gn)];if(zn.length>2)for(var si=0,so=Ci;si<so.length;si+=1)if(fe(zn,so[si]))return!0;for(var Tr=0;Tr<zn.length-1;Tr++)if(Ie(zn[Tr],zn[Tr+1],Ci))return!0;return!1}(s.cameraQueryGeometry,Lt-ce,zt-ce,nn+ce,An+ce)});Xe<Qe.length;Xe+=1)_e.push(Qe[Xe]);_e.sort(u0);for(var pt,st={},St=function(Lt){var zt=_e[Lt];if(zt!==pt){pt=zt;var nn=k.featureIndexArray.get(zt),An=null;k.loadMatchingFeature(st,nn.bucketIndex,nn.sourceLayerIndex,nn.featureIndex,X,N.layers,N.availableImages,h,g,S,function(zn,_r,Gn){return An||(An=Wr(zn)),_r.queryIntersectsFeature(ie,zn,Gn,An,k.z,s.transform,q,s.pixelPosMatrix)})}},At=0;At<_e.length;At++)St(At);return st},sd.prototype.loadMatchingFeature=function(s,h,g,S,k,N,q,X,ie,ce,ye){var _e=this.bucketLayerIDs[h];if(!N||function(zn,_r){for(var Gn=0;Gn<zn.length;Gn++)if(_r.indexOf(zn[Gn])>=0)return!0;return!1}(N,_e)){var Ae=this.sourceLayerCoder.decode(g),ze=this.vtLayers[Ae].feature(S);if(k.needGeometry){var Xe=Zi(ze,!0);if(!k.filter(new Vr(this.tileID.overscaledZ),Xe,this.tileID.canonical))return}else if(!k.filter(new Vr(this.tileID.overscaledZ),ze))return;for(var Qe=this.getId(ze,Ae),pt=0;pt<_e.length;pt++){var st=_e[pt];if(!(N&&N.indexOf(st)<0)){var St=X[st];if(St){var At={};void 0!==Qe&&ce&&(At=ce.getState(St.sourceLayer||"_geojsonTileLayer",Qe));var Lt=et({},ie[st]);Lt.paint=Up(Lt.paint,St.paint,ze,At,q),Lt.layout=Up(Lt.layout,St.layout,ze,At,q);var zt=!ye||ye(ze,St,At);if(zt){var nn=new Fg(ze,this.z,this.x,this.y,Qe);nn.layer=Lt;var An=s[st];void 0===An&&(An=s[st]=[]),An.push({featureIndex:S,feature:nn,intersectionZ:zt})}}}}}},sd.prototype.lookupSymbolFeatures=function(s,h,g,S,k,N,q,X){var ie={};this.loadVTLayers();for(var ce=Vu(k),ye=0,_e=s;ye<_e.length;ye+=1)this.loadMatchingFeature(ie,g,S,_e[ye],ce,N,q,X,h);return ie},sd.prototype.hasLayer=function(s){for(var h=0,g=this.bucketLayerIDs;h<g.length;h+=1)for(var S=0,k=g[h];S<k.length;S+=1)if(s===k[S])return!0;return!1},sd.prototype.getId=function(s,h){var g=s.id;return this.promoteId&&"boolean"==typeof(g=s.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[h]])&&(g=Number(g)),g},$n("FeatureIndex",sd,{omit:["rawTileData","sourceLayerCoder"]});var ql=function(s,h){this.tileID=s,this.uid=Dt(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ql.prototype.registerFadeDuration=function(s){var h=s+this.timeAdded;h<gl.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)},ql.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},ql.prototype.loadVectorData=function(s,h,g){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){for(var S in s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(ce,ye){var _e={};if(!ye)return _e;for(var Ae=function(){var Qe=Xe[ze],pt=Qe.layerIds.map(function(At){return ye.getLayer(At)}).filter(Boolean);if(0!==pt.length){Qe.layers=pt,Qe.stateDependentLayerIds&&(Qe.stateDependentLayers=Qe.stateDependentLayerIds.map(function(At){return pt.filter(function(Lt){return Lt.id===At})[0]}));for(var st=0,St=pt;st<St.length;st+=1)_e[St[st].id]=Qe}},ze=0,Xe=ce;ze<Xe.length;ze+=1)Ae();return _e}(s.buckets,h.style),this.hasSymbolBuckets=!1,this.buckets){var k=this.buckets[S];if(k instanceof Pi){if(this.hasSymbolBuckets=!0,!g)break;k.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var N in this.buckets){var q=this.buckets[N];if(q instanceof Pi&&q.hasRTLText){this.hasRTLText=!0,Yo.isLoading()||Yo.isLoaded()||"deferred"!==to()||ih();break}}for(var X in this.queryPadding=0,this.buckets){var ie=this.buckets[X];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(X).queryRadius(ie))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new _},ql.prototype.unloadVectorData=function(){for(var s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ql.prototype.getBucket=function(s){return this.buckets[s.id]},ql.prototype.upload=function(s){for(var h in this.buckets){var g=this.buckets[h];g.uploadPending()&&g.upload(s)}var S=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ad(s,this.imageAtlas.image,S.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ad(s,this.glyphAtlasImage,S.ALPHA),this.glyphAtlasImage=null)},ql.prototype.prepare=function(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)},ql.prototype.queryRenderedFeatures=function(s,h,g,S,k,N,q,X,ie,ce){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:S,cameraQueryGeometry:k,scale:N,tileSize:this.tileSize,pixelPosMatrix:ce,transform:X,params:q,queryPadding:this.queryPadding*ie},s,h,g):{}},ql.prototype.querySourceFeatures=function(s,h){var g=this.latestFeatureIndex;if(g&&g.rawTileData){var S=g.loadVTLayers(),k=h?h.sourceLayer:"",N=S._geojsonTileLayer||S[k];if(N)for(var q=Vu(h&&h.filter),X=this.tileID.canonical,ie=X.z,ce=X.x,ye=X.y,_e={z:ie,x:ce,y:ye},Ae=0;Ae<N.length;Ae++){var ze=N.feature(Ae);if(q.needGeometry){var Xe=Zi(ze,!0);if(!q.filter(new Vr(this.tileID.overscaledZ),Xe,this.tileID.canonical))continue}else if(!q.filter(new Vr(this.tileID.overscaledZ),ze))continue;var Qe=g.getId(ze,k),pt=new Fg(ze,ie,ce,ye,Qe);pt.tile=_e,s.push(pt)}}},ql.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},ql.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ql.prototype.setExpiryData=function(s){var h=this.expirationTime;if(s.cacheControl){var g=ct(s.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){var S=Date.now(),k=!1;if(this.expirationTime>S)k=!1;else if(h)if(this.expirationTime<h)k=!0;else{var N=this.expirationTime-h;N?this.expirationTime=S+Math.max(N,3e4):k=!0}else k=!0;k?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ql.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},ql.prototype.setFeatureState=function(s,h){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(s).length){var g=this.latestFeatureIndex.loadVTLayers();for(var S in this.buckets)if(h.style.hasLayer(S)){var k=this.buckets[S],N=k.layers[0].sourceLayer||"_geojsonTileLayer",q=g[N],X=s[N];if(q&&X&&0!==Object.keys(X).length){k.update(X,q,this.imageAtlas&&this.imageAtlas.patternPositions||{});var ie=h&&h.style&&h.style.getLayer(S);ie&&(this.queryPadding=Math.max(this.queryPadding,ie.queryRadius(k)))}}}},ql.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},ql.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<gl.now()},ql.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ql.prototype.setHoldDuration=function(s){this.symbolFadeHoldUntil=gl.now()+s},ql.prototype.setDependencies=function(s,h){for(var g={},S=0,k=h;S<k.length;S+=1)g[k[S]]=!0;this.dependencies[s]=g},ql.prototype.hasDependency=function(s,h){for(var g=0,S=s;g<S.length;g+=1){var k=this.dependencies[S[g]];if(k)for(var N=0,q=h;N<q.length;N+=1)if(k[q[N]])return!0}return!1};var ld=Ge.performance,Bd=function(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},ld.mark(this._marks.start)};Bd.prototype.finish=function(){ld.mark(this._marks.end);var s=ld.getEntriesByName(this._marks.measure);return 0===s.length&&(ld.measure(this._marks.measure,this._marks.start,this._marks.end),s=ld.getEntriesByName(this._marks.measure),ld.clearMarks(this._marks.start),ld.clearMarks(this._marks.end),ld.clearMeasures(this._marks.measure)),s},L.Actor=Qf,L.AlphaImage=qa,L.CanonicalTileID=Fd,L.CollisionBoxArray=_,L.Color=ni,L.DEMData=zd,L.DataConstantProperty=Un,L.DictionaryCoder=df,L.EXTENT=8192,L.ErrorEvent=me,L.EvaluationParameters=Vr,L.Event=oe,L.Evented=ve,L.FeatureIndex=sd,L.FillBucket=kh,L.FillExtrusionBucket=Jh,L.ImageAtlas=Sg,L.ImagePosition=Bp,L.LineBucket=po,L.LngLat=Ta,L.LngLatBounds=ul,L.MercatorCoordinate=jc,L.ONE_EM=24,L.OverscaledTileID=ts,L.Point=Et,L.Point$1=Et,L.Properties=Rs,L.Protobuf=yy,L.RGBAImage=ai,L.RequestManager=ss,L.RequestPerformance=Bd,L.ResourceType=Nu,L.SegmentVector=G,L.SourceFeatureState=Nd,L.StructArrayLayout1ui2=Kh,L.StructArrayLayout2f1f2i16=oo,L.StructArrayLayout2i4=oh,L.StructArrayLayout3ui6=fs,L.StructArrayLayout4i8=cc,L.SymbolBucket=Pi,L.Texture=ad,L.Tile=ql,L.Transitionable=ps,L.Uniform1f=Me,L.Uniform1i=Le,L.Uniform2f=Ue,L.Uniform3f=Ye,L.Uniform4f=yt,L.UniformColor=gt,L.UniformMatrix4f=dt,L.UnwrappedTileID=Zm,L.ValidationError=Se,L.WritingMode=zc,L.ZoomHistory=qs,L.add=function(s,h,g){return s[0]=h[0]+g[0],s[1]=h[1]+g[1],s[2]=h[2]+g[2],s},L.addDynamicAttributes=Rv,L.asyncAll=function(s,h,g){if(!s.length)return g(null,[]);var S=s.length,k=new Array(s.length),N=null;s.forEach(function(q,X){h(q,function(ie,ce){ie&&(N=ie),k[X]=ce,0==--S&&g(N,k)})})},L.bezier=Wt,L.bindAll=an,L.browser=gl,L.cacheEntryPossiblyAdded=function(s){++Ss>Vh&&(s.getActor().send("enforceCacheSizeLimit",Ic),Ss=0)},L.clamp=Cn,L.clearTileCache=function(s){var h=Ge.caches.delete("mapbox-tiles");s&&h.catch(s).then(function(){return s()})},L.clipLine=Dv,L.clone=function(s){var h=new cn(16);return h[0]=s[0],h[1]=s[1],h[2]=s[2],h[3]=s[3],h[4]=s[4],h[5]=s[5],h[6]=s[6],h[7]=s[7],h[8]=s[8],h[9]=s[9],h[10]=s[10],h[11]=s[11],h[12]=s[12],h[13]=s[13],h[14]=s[14],h[15]=s[15],h},L.clone$1=jn,L.clone$2=function(s){var h=new cn(3);return h[0]=s[0],h[1]=s[1],h[2]=s[2],h},L.collisionCircleLayout=Zf,L.config=Ir,L.create=function(){var s=new cn(16);return cn!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},L.create$1=function(){var s=new cn(9);return cn!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s},L.create$2=function(){var s=new cn(4);return cn!=Float32Array&&(s[1]=0,s[2]=0),s[0]=1,s[3]=1,s},L.createCommonjsModule=C,L.createExpression=ru,L.createLayout=Ea,L.createStyleLayer=function(s){return"custom"===s.type?new n0(s):new Mx[s.type](s)},L.cross=function(s,h,g){var S=h[0],k=h[1],N=h[2],q=g[0],X=g[1],ie=g[2];return s[0]=k*ie-N*X,s[1]=N*q-S*ie,s[2]=S*X-k*q,s},L.deepEqual=function s(h,g){if(Array.isArray(h)){if(!Array.isArray(g)||h.length!==g.length)return!1;for(var S=0;S<h.length;S++)if(!s(h[S],g[S]))return!1;return!0}if("object"==typeof h&&null!==h&&null!==g){if("object"!=typeof g||Object.keys(h).length!==Object.keys(g).length)return!1;for(var k in h)if(!s(h[k],g[k]))return!1;return!0}return h===g},L.dot=function(s,h){return s[0]*h[0]+s[1]*h[1]+s[2]*h[2]},L.dot$1=function(s,h){return s[0]*h[0]+s[1]*h[1]+s[2]*h[2]+s[3]*h[3]},L.ease=on,L.emitValidationErrors=lc,L.endsWith=Rn,L.enforceCacheSizeLimit=function(s){Jc(),Na&&Na.then(function(h){h.keys().then(function(g){for(var S=0;S<g.length-s;S++)h.delete(g[S])})})},L.evaluateSizeForFeature=Nm,L.evaluateSizeForZoom=Cy,L.evaluateVariableOffset=J_,L.evented=id,L.extend=et,L.featureFilter=Vu,L.filterObject=dr,L.fromRotation=function(s,h){var g=Math.sin(h),S=Math.cos(h);return s[0]=S,s[1]=g,s[2]=0,s[3]=-g,s[4]=S,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},L.getAnchorAlignment=Tg,L.getAnchorJustification=Pv,L.getArrayBuffer=Bo,L.getImage=Oe,L.getJSON=function(s,h){return Da(et(s,{type:"json"}),h)},L.getRTLTextPluginStatus=to,L.getReferrer=Bs,L.getVideo=function(s,h){var g,S,k=Ge.document.createElement("video");k.muted=!0,k.onloadstart=function(){h(null,k)};for(var N=0;N<s.length;N++){var q=Ge.document.createElement("source");g=s[N],S=void 0,(S=Ge.document.createElement("a")).href=g,(S.protocol!==Ge.document.location.protocol||S.host!==Ge.document.location.host)&&(k.crossOrigin="Anonymous"),q.src=s[N],k.appendChild(q)}return{cancel:function(){}}},L.identity=Sn,L.invert=function(s,h){var g=h[0],S=h[1],k=h[2],N=h[3],q=h[4],X=h[5],ie=h[6],ce=h[7],ye=h[8],_e=h[9],Ae=h[10],ze=h[11],Xe=h[12],Qe=h[13],pt=h[14],st=h[15],St=g*X-S*q,At=g*ie-k*q,Lt=g*ce-N*q,zt=S*ie-k*X,nn=S*ce-N*X,An=k*ce-N*ie,zn=ye*Qe-_e*Xe,_r=ye*pt-Ae*Xe,Gn=ye*st-ze*Xe,Dr=_e*pt-Ae*Qe,Yn=_e*st-ze*Qe,mi=Ae*st-ze*pt,$r=St*mi-At*Yn+Lt*Dr+zt*Gn-nn*_r+An*zn;return $r?(s[0]=(X*mi-ie*Yn+ce*Dr)*($r=1/$r),s[1]=(k*Yn-S*mi-N*Dr)*$r,s[2]=(Qe*An-pt*nn+st*zt)*$r,s[3]=(Ae*nn-_e*An-ze*zt)*$r,s[4]=(ie*Gn-q*mi-ce*_r)*$r,s[5]=(g*mi-k*Gn+N*_r)*$r,s[6]=(pt*Lt-Xe*An-st*At)*$r,s[7]=(ye*An-Ae*Lt+ze*At)*$r,s[8]=(q*Yn-X*Gn+ce*zn)*$r,s[9]=(S*Gn-g*Yn-N*zn)*$r,s[10]=(Xe*nn-Qe*Lt+st*St)*$r,s[11]=(_e*Lt-ye*nn-ze*St)*$r,s[12]=(X*_r-q*Dr-ie*zn)*$r,s[13]=(g*Dr-S*_r+k*zn)*$r,s[14]=(Qe*At-Xe*zt-pt*St)*$r,s[15]=(ye*zt-_e*At+Ae*St)*$r,s):null},L.isChar=er,L.isMapboxURL=Ar,L.keysDifference=function(s,h){var g=[];for(var S in s)S in h||g.push(S);return g},L.makeRequest=Da,L.mapObject=nr,L.mercatorXfromLng=em,L.mercatorYfromLat=zv,L.mercatorZfromAltitude=l0,L.mul=Xr,L.multiply=ar,L.mvt=km,L.nextPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},L.normalize=function(s,h){var g=h[0],S=h[1],k=h[2],N=g*g+S*S+k*k;return N>0&&(N=1/Math.sqrt(N)),s[0]=h[0]*N,s[1]=h[1]*N,s[2]=h[2]*N,s},L.number=ca,L.offscreenCanvasSupported=Qc,L.ortho=function(s,h,g,S,k,N,q){var X=1/(h-g),ie=1/(S-k),ce=1/(N-q);return s[0]=-2*X,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*ie,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*ce,s[11]=0,s[12]=(h+g)*X,s[13]=(k+S)*ie,s[14]=(q+N)*ce,s[15]=1,s},L.parseGlyphPBF=function(s){return new yy(s).readFields(wx,[])},L.pbf=yy,L.performSymbolLayout=function(s,h,g,S,k,N,q){s.createArrays(),s.tilePixelRatio=8192/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;var X=s.layers[0].layout,ie=s.layers[0]._unevaluatedLayout._values,ce={};if("composite"===s.textSizeData.kind){var ye=s.textSizeData,_e=ye.maxZoom;ce.compositeTextSizes=[ie["text-size"].possiblyEvaluate(new Vr(ye.minZoom),q),ie["text-size"].possiblyEvaluate(new Vr(_e),q)]}if("composite"===s.iconSizeData.kind){var Ae=s.iconSizeData,ze=Ae.maxZoom;ce.compositeIconSizes=[ie["icon-size"].possiblyEvaluate(new Vr(Ae.minZoom),q),ie["icon-size"].possiblyEvaluate(new Vr(ze),q)]}ce.layoutTextSize=ie["text-size"].possiblyEvaluate(new Vr(s.zoom+1),q),ce.layoutIconSize=ie["icon-size"].possiblyEvaluate(new Vr(s.zoom+1),q),ce.textMaxSize=ie["text-size"].possiblyEvaluate(new Vr(18));for(var Xe=24*X.get("text-line-height"),Qe="map"===X.get("text-rotation-alignment")&&"point"!==X.get("symbol-placement"),pt=X.get("text-keep-upright"),st=X.get("text-size"),St=function(){var zt=Lt[At],nn=X.get("text-font").evaluate(zt,{},q).join(","),An=st.evaluate(zt,{},q),zn=ce.layoutTextSize.evaluate(zt,{},q),_r=ce.layoutIconSize.evaluate(zt,{},q),Gn={horizontal:{},vertical:void 0},Dr=zt.text,Yn=[0,0];if(Dr){var mi=Dr.toString(),$r=24*X.get("text-letter-spacing").evaluate(zt,{},q),rr=function(Ei){for(var Jo=0,Po=Ei;Jo<Po.length;Jo+=1)if(lo=Po[Jo].charCodeAt(0),er.Arabic(lo)||er["Arabic Supplement"](lo)||er["Arabic Extended-A"](lo)||er["Arabic Presentation Forms-A"](lo)||er["Arabic Presentation Forms-B"](lo))return!1;var lo;return!0}(mi)?$r:0,Ci=X.get("text-anchor").evaluate(zt,{},q),si=X.get("text-variable-anchor");if(!si){var so=X.get("text-radial-offset").evaluate(zt,{},q);Yn=so?J_(Ci,[24*so,Il]):X.get("text-offset").evaluate(zt,{},q).map(function(Ei){return 24*Ei})}var Tr=Qe?"center":X.get("text-justify").evaluate(zt,{},q),ji=X.get("symbol-placement"),Ia="point"===ji?24*X.get("text-max-width").evaluate(zt,{},q):0,ns=function(){s.allowVerticalPlacement&&rh(mi)&&(Gn.vertical=Xf(Dr,h,g,k,nn,Ia,Xe,Ci,"left",rr,Yn,zc.vertical,!0,ji,zn,An))};if(!Qe&&si){for(var Ha="auto"===Tr?si.map(function(Ei){return Pv(Ei)}):[Tr],_a=!1,gs=0;gs<Ha.length;gs++){var Hs=Ha[gs];if(!Gn.horizontal[Hs])if(_a)Gn.horizontal[Hs]=Gn.horizontal[0];else{var Os=Xf(Dr,h,g,k,nn,Ia,Xe,"center",Hs,rr,Yn,zc.horizontal,!1,ji,zn,An);Os&&(Gn.horizontal[Hs]=Os,_a=1===Os.positionedLines.length)}}ns()}else{"auto"===Tr&&(Tr=Pv(Ci));var uu=Xf(Dr,h,g,k,nn,Ia,Xe,Ci,Tr,rr,Yn,zc.horizontal,!1,ji,zn,An);uu&&(Gn.horizontal[Tr]=uu),ns(),rh(mi)&&Qe&&pt&&(Gn.vertical=Xf(Dr,h,g,k,nn,Ia,Xe,Ci,Tr,rr,Yn,zc.vertical,!1,ji,zn,An))}}var Ei,Jo,lo,Zl,nl,ys=void 0,cu=!1;if(zt.icon&&zt.icon.name){var rs=S[zt.icon.name];rs&&(Ei=k[zt.icon.name],Jo=X.get("icon-offset").evaluate(zt,{},q),lo=Tg(X.get("icon-anchor").evaluate(zt,{},q)),ys={image:Ei,top:nl=Jo[1]-Ei.displaySize[1]*lo.verticalAlign,bottom:nl+Ei.displaySize[1],left:Zl=Jo[0]-Ei.displaySize[0]*lo.horizontalAlign,right:Zl+Ei.displaySize[0]},cu=rs.sdf,void 0===s.sdfIcons?s.sdfIcons=rs.sdf:s.sdfIcons!==rs.sdf&&sr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(rs.pixelRatio!==s.pixelRatio||0!==X.get("icon-rotate").constantOr(1))&&(s.iconsNeedLinear=!0))}var vs=pf(Gn.horizontal)||Gn.vertical;s.iconsInText=!!vs&&vs.iconsInText,(vs||ys)&&function(Ei,Jo,Po,lo,Zl,nl,Ma,cl,hu,Io,Vp){var ku=nl.textMaxSize.evaluate(Jo,{});void 0===ku&&(ku=Ma);var fp,Qo=Ei.layers[0].layout,Gp=Qo.get("icon-offset").evaluate(Jo,{},Vp),Qh=pf(Po.horizontal),ff=Ma/24,tm=Ei.tilePixelRatio*ff,ep=Ei.tilePixelRatio*ku/24,ud=Ei.tilePixelRatio*cl,mf=Ei.tilePixelRatio*Qo.get("symbol-spacing"),nm=Qo.get("text-padding")*Ei.tilePixelRatio,gf=Qo.get("icon-padding")*Ei.tilePixelRatio,zg=Qo.get("text-max-angle")/180*Math.PI,Fi="map"===Qo.get("text-rotation-alignment")&&"point"!==Qo.get("symbol-placement"),rn="map"===Qo.get("icon-rotation-alignment")&&"point"!==Qo.get("symbol-placement"),tp=Qo.get("symbol-placement"),yf=mf/2,jd=Qo.get("icon-text-fit");lo&&"none"!==jd&&(Ei.allowVerticalPlacement&&Po.vertical&&(fp=hf(lo,Po.vertical,jd,Qo.get("icon-text-fit-padding"),Gp,ff)),Qh&&(lo=hf(lo,Qh,jd,Qo.get("icon-text-fit-padding"),Gp,ff)));var pu=function(Ax,om){om.x<0||om.x>=8192||om.y<0||om.y>=8192||function(_s,Oh,c0,rl,Xm,h0,ky,qd,Lh,np,hd,mp,Zd,Py,rp,Ym,Gv,Ry,Oy,Ly,yc,Bg,pd,gp,p0){var jg,Fh,bf,Hd,Km,ch=_s.addToLineVertexArray(Oh,c0),Wd=0,Jm=0,Uc=0,wf=0,dd=-1,ip=-1,Vc={},Fy=le(""),Qm=0,Cf=0;if(void 0===qd._unevaluatedLayout.getValue("text-radial-offset")?(Qm=(jg=qd.layout.get("text-offset").evaluate(yc,{},gp).map(function(ng){return 24*ng}))[0],Cf=jg[1]):(Qm=24*qd.layout.get("text-radial-offset").evaluate(yc,{},gp),Cf=Il),_s.allowVerticalPlacement&&rl.vertical){var zy=qd.layout.get("text-rotate").evaluate(yc,{},gp)+90;Hd=new Ty(Lh,Oh,np,hd,mp,rl.vertical,Zd,Py,rp,zy),ky&&(Km=new Ty(Lh,Oh,np,hd,mp,ky,Gv,Ry,rp,zy))}if(Xm){var am=qd.layout.get("icon-rotate").evaluate(yc,{}),d0="none"!==qd.layout.get("icon-text-fit"),Ny=Sx(Xm,am,pd,d0),f0=ky?Sx(ky,am,pd,d0):void 0;bf=new Ty(Lh,Oh,np,hd,mp,Xm,Gv,Ry,!1,am),Wd=4*Ny.length;var Ug=_s.iconSizeData,sm=null;"source"===Ug.kind?(sm=[128*qd.layout.get("icon-size").evaluate(yc,{})])[0]>32640&&sr(_s.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):"composite"===Ug.kind&&((sm=[128*Bg.compositeIconSizes[0].evaluate(yc,{},gp),128*Bg.compositeIconSizes[1].evaluate(yc,{},gp)])[0]>32640||sm[1]>32640)&&sr(_s.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),_s.addSymbols(_s.icon,Ny,sm,Ly,Oy,yc,!1,Oh,ch.lineStartIndex,ch.lineLength,-1,gp),dd=_s.icon.placedSymbolArray.length-1,f0&&(Jm=4*f0.length,_s.addSymbols(_s.icon,f0,sm,Ly,Oy,yc,zc.vertical,Oh,ch.lineStartIndex,ch.lineLength,-1,gp),ip=_s.icon.placedSymbolArray.length-1)}for(var qv in rl.horizontal){var Vg=rl.horizontal[qv];if(!Fh){Fy=le(Vg.text);var Gg=qd.layout.get("text-rotate").evaluate(yc,{},gp);Fh=new Ty(Lh,Oh,np,hd,mp,Vg,Zd,Py,rp,Gg)}var eg=1===Vg.positionedLines.length;if(Uc+=qm(_s,Oh,Vg,h0,qd,rp,yc,Ym,ch,rl.vertical?zc.horizontal:zc.horizontalOnly,eg?Object.keys(rl.horizontal):[qv],Vc,dd,Bg,gp),eg)break}rl.vertical&&(wf+=qm(_s,Oh,rl.vertical,h0,qd,rp,yc,Ym,ch,zc.vertical,["vertical"],Vc,ip,Bg,gp));var vc=Fh?Fh.boxStartIndex:_s.collisionBoxArray.length,qg=Fh?Fh.boxEndIndex:_s.collisionBoxArray.length,By=Hd?Hd.boxStartIndex:_s.collisionBoxArray.length,eb=Hd?Hd.boxEndIndex:_s.collisionBoxArray.length,tb=bf?bf.boxStartIndex:_s.collisionBoxArray.length,lm=bf?bf.boxEndIndex:_s.collisionBoxArray.length,Zv=Km?Km.boxStartIndex:_s.collisionBoxArray.length,Dx=Km?Km.boxEndIndex:_s.collisionBoxArray.length,yp=-1,tg=function(ng,Hv){return ng&&ng.circleDiameter?Math.max(ng.circleDiameter,Hv):Hv};yp=tg(Fh,yp),yp=tg(Hd,yp),yp=tg(bf,yp);var m0=(yp=tg(Km,yp))>-1?1:0;m0&&(yp*=p0/24),_s.glyphOffsetArray.length>=Pi.MAX_GLYPHS&&sr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==yc.sortKey&&_s.addToSortKeyRanges(_s.symbolInstances.length,yc.sortKey),_s.symbolInstances.emplaceBack(Oh.x,Oh.y,Vc.right>=0?Vc.right:-1,Vc.center>=0?Vc.center:-1,Vc.left>=0?Vc.left:-1,Vc.vertical||-1,dd,ip,Fy,vc,qg,By,eb,tb,lm,Zv,Dx,np,Uc,wf,Wd,Jm,m0,0,Zd,Qm,Cf,yp)}(Ei,om,Ax,Po,lo,Zl,fp,Ei.layers[0],Ei.collisionBoxArray,Jo.index,Jo.sourceLayerIndex,Ei.index,tm,nm,Fi,hu,ud,gf,rn,Gp,Jo,nl,Io,Vp,Ma)};if("line"===tp)for(var Ud=0,qp=Dv(Jo.geometry,0,0,8192,8192);Ud<qp.length;Ud+=1)for(var Hm=qp[Ud],uh=0,vf=Dg(Hm,mf,zg,Po.vertical||Qh,lo,24,ep,Ei.overscaling,8192);uh<vf.length;uh+=1){var _f=vf[uh];Qh&&Tx(Ei,Qh.text,yf,_f)||pu(Hm,_f)}else if("line-center"===tp)for(var rm=0,Ay=Jo.geometry;rm<Ay.length;rm+=1){var Wm=Ay[rm];if(Wm.length>1){var Bv=Yf(Wm,zg,Po.vertical||Qh,lo,24,ep);Bv&&pu(Wm,Bv)}}else if("Polygon"===Jo.type)for(var Zp=0,im=Dh(Jo.geometry,0);Zp<im.length;Zp+=1){var Vd=im[Zp],xf=Iy(Vd,16);pu(Vd[0],new lh(xf.x,xf.y,0))}else if("LineString"===Jo.type)for(var cd=0,Ng=Jo.geometry;cd<Ng.length;cd+=1){var Gd=Ng[cd];pu(Gd,new lh(Gd[0].x,Gd[0].y,0))}else if("Point"===Jo.type)for(var $m=0,Dy=Jo.geometry;$m<Dy.length;$m+=1)for(var jv=0,Uv=Dy[$m];jv<Uv.length;jv+=1){var Vv=Uv[jv];pu([Vv],new lh(Vv.x,Vv.y,0))}}(s,zt,Gn,ys,S,ce,zn,_r,Yn,cu,q)},At=0,Lt=s.features;At<Lt.length;At+=1)St();N&&s.generateCollisionDebugBuffers()},L.perspective=function(s,h,g,S,k){var N,q=1/Math.tan(h/2);return s[0]=q/g,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=q,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,null!=k&&k!==1/0?(s[10]=(k+S)*(N=1/(S-k)),s[14]=2*k*S*N):(s[10]=-1,s[14]=-2*S),s},L.pick=function(s,h){for(var g={},S=0;S<h.length;S++){var k=h[S];k in s&&(g[k]=s[k])}return g},L.plugin=Yo,L.polygonIntersectsPolygon=xo,L.postMapLoadEvent=Kc,L.postTurnstileEvent=Ys,L.potpack=H_,L.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],L.register=$n,L.registerForPluginStateChange=function(s){return s({pluginStatus:ll,pluginURL:Js}),id.on("pluginStateChange",s),s},L.renderColorRamp=Xu,L.rotate=function(s,h,g){var S=h[0],k=h[1],N=h[2],q=h[3],X=Math.sin(g),ie=Math.cos(g);return s[0]=S*ie+N*X,s[1]=k*ie+q*X,s[2]=S*-X+N*ie,s[3]=k*-X+q*ie,s},L.rotateX=function(s,h,g){var S=Math.sin(g),k=Math.cos(g),N=h[4],q=h[5],X=h[6],ie=h[7],ce=h[8],ye=h[9],_e=h[10],Ae=h[11];return h!==s&&(s[0]=h[0],s[1]=h[1],s[2]=h[2],s[3]=h[3],s[12]=h[12],s[13]=h[13],s[14]=h[14],s[15]=h[15]),s[4]=N*k+ce*S,s[5]=q*k+ye*S,s[6]=X*k+_e*S,s[7]=ie*k+Ae*S,s[8]=ce*k-N*S,s[9]=ye*k-q*S,s[10]=_e*k-X*S,s[11]=Ae*k-ie*S,s},L.rotateZ=function(s,h,g){var S=Math.sin(g),k=Math.cos(g),N=h[0],q=h[1],X=h[2],ie=h[3],ce=h[4],ye=h[5],_e=h[6],Ae=h[7];return h!==s&&(s[8]=h[8],s[9]=h[9],s[10]=h[10],s[11]=h[11],s[12]=h[12],s[13]=h[13],s[14]=h[14],s[15]=h[15]),s[0]=N*k+ce*S,s[1]=q*k+ye*S,s[2]=X*k+_e*S,s[3]=ie*k+Ae*S,s[4]=ce*k-N*S,s[5]=ye*k-q*S,s[6]=_e*k-X*S,s[7]=Ae*k-ie*S,s},L.scale=function(s,h,g){var S=g[0],k=g[1],N=g[2];return s[0]=h[0]*S,s[1]=h[1]*S,s[2]=h[2]*S,s[3]=h[3]*S,s[4]=h[4]*k,s[5]=h[5]*k,s[6]=h[6]*k,s[7]=h[7]*k,s[8]=h[8]*N,s[9]=h[9]*N,s[10]=h[10]*N,s[11]=h[11]*N,s[12]=h[12],s[13]=h[13],s[14]=h[14],s[15]=h[15],s},L.scale$1=function(s,h,g){return s[0]=h[0]*g,s[1]=h[1]*g,s[2]=h[2]*g,s[3]=h[3]*g,s},L.scale$2=function(s,h,g){return s[0]=h[0]*g,s[1]=h[1]*g,s[2]=h[2]*g,s},L.setCacheLimits=function(s,h){Ic=s,Vh=h},L.setRTLTextPlugin=function(s,h,g){if(void 0===g&&(g=!1),"deferred"===ll||"loading"===ll||"loaded"===ll)throw new Error("setRTLTextPlugin cannot be called multiple times.");Js=gl.resolveURL(s),ll="deferred",Tl=h,Yh(),g||ih()},L.sphericalToCartesian=function(s){var h=s[0],g=s[1],S=s[2];return g+=90,g*=Math.PI/180,S*=Math.PI/180,{x:h*Math.cos(g)*Math.sin(S),y:h*Math.sin(g)*Math.sin(S),z:h*Math.cos(S)}},L.sqrLen=function(s){var h=s[0],g=s[1];return h*h+g*g},L.styleSpec=pe,L.sub=function(s,h,g){return s[0]=h[0]-g[0],s[1]=h[1]-g[1],s[2]=h[2]-g[2],s},L.symbolSize=Ig,L.transformMat3=function(s,h,g){var S=h[0],k=h[1],N=h[2];return s[0]=S*g[0]+k*g[3]+N*g[6],s[1]=S*g[1]+k*g[4]+N*g[7],s[2]=S*g[2]+k*g[5]+N*g[8],s},L.transformMat4=Sr,L.translate=function(s,h,g){var S,k,N,q,X,ie,ce,ye,_e,Ae,ze,Xe,Qe=g[0],pt=g[1],st=g[2];return h===s?(s[12]=h[0]*Qe+h[4]*pt+h[8]*st+h[12],s[13]=h[1]*Qe+h[5]*pt+h[9]*st+h[13],s[14]=h[2]*Qe+h[6]*pt+h[10]*st+h[14],s[15]=h[3]*Qe+h[7]*pt+h[11]*st+h[15]):(k=h[1],N=h[2],q=h[3],X=h[4],ie=h[5],ce=h[6],ye=h[7],_e=h[8],Ae=h[9],ze=h[10],Xe=h[11],s[0]=S=h[0],s[1]=k,s[2]=N,s[3]=q,s[4]=X,s[5]=ie,s[6]=ce,s[7]=ye,s[8]=_e,s[9]=Ae,s[10]=ze,s[11]=Xe,s[12]=S*Qe+X*pt+_e*st+h[12],s[13]=k*Qe+ie*pt+Ae*st+h[13],s[14]=N*Qe+ce*pt+ze*st+h[14],s[15]=q*Qe+ye*pt+Xe*st+h[15]),s},L.triggerPluginCompletionEvent=uc,L.uniqueId=Dt,L.validateCustomStyleLayer=function(s){var h=[],g=s.id;return void 0===g&&h.push({message:"layers."+g+': missing required property "id"'}),void 0===s.render&&h.push({message:"layers."+g+': missing required method "render"'}),s.renderingMode&&"2d"!==s.renderingMode&&"3d"!==s.renderingMode&&h.push({message:"layers."+g+': property "renderingMode" must be either "2d" or "3d"'}),h},L.validateLight=Lp,L.validateStyle=vi,L.values=function(s){var h=[];for(var g in s)h.push(s[g]);return h},L.vectorTile=km,L.version="1.15.2",L.warnOnce=sr,L.webpSupported=yl,L.window=Ge,L.wrap=fn}),Jt(0,function(L){function C(be){var De=typeof be;if("number"===De||"boolean"===De||"string"===De||null==be)return JSON.stringify(be);if(Array.isArray(be)){for(var Oe="[",se=0,te=be;se<te.length;se+=1)Oe+=C(te[se])+",";return Oe+"]"}for(var oe=Object.keys(be).sort(),me="{",ve=0;ve<oe.length;ve++)me+=JSON.stringify(oe[ve])+":"+C(be[oe[ve]])+",";return me+"}"}function ut(be){for(var De="",Oe=0,se=L.refProperties;Oe<se.length;Oe+=1)De+="/"+C(be[se[Oe]]);return De}var tn=function(be){this.keyCache={},be&&this.replace(be)};tn.prototype.replace=function(be){this._layerConfigs={},this._layers={},this.update(be,[])},tn.prototype.update=function(be,De){for(var Oe=this,se=0,te=be;se<te.length;se+=1){var oe=te[se];this._layerConfigs[oe.id]=oe;var me=this._layers[oe.id]=L.createStyleLayer(oe);me._featureFilter=L.featureFilter(me.filter),this.keyCache[oe.id]&&delete this.keyCache[oe.id]}for(var ve=0,pe=De;ve<pe.length;ve+=1){var Se=pe[ve];delete this.keyCache[Se],delete this._layerConfigs[Se],delete this._layers[Se]}this.familiesBySource={};for(var He=0,Ze=function(Je,ot){for(var On={},Bn=0;Bn<Je.length;Bn++){var sn=ot&&ot[Je[Bn].id]||ut(Je[Bn]);ot&&(ot[Je[Bn].id]=sn);var br=On[sn];br||(br=On[sn]=[]),br.push(Je[Bn])}var Ft=[];for(var mr in On)Ft.push(On[mr]);return Ft}(L.values(this._layerConfigs),this.keyCache);He<Ze.length;He+=1){var Be=Ze[He].map(function(Je){return Oe._layers[Je.id]}),lt=Be[0];if("none"!==lt.visibility){var Rt=lt.source||"",xt=this.familiesBySource[Rt];xt||(xt=this.familiesBySource[Rt]={});var Xt=lt.sourceLayer||"_geojsonTileLayer",mt=xt[Xt];mt||(mt=xt[Xt]=[]),mt.push(Be)}}};var Et=function(be){var De={},Oe=[];for(var se in be){var te=be[se],oe=De[se]={};for(var me in te){var ve=te[+me];if(ve&&0!==ve.bitmap.width&&0!==ve.bitmap.height){var pe={x:0,y:0,w:ve.bitmap.width+2,h:ve.bitmap.height+2};Oe.push(pe),oe[me]={rect:pe,metrics:ve.metrics}}}}var Se=L.potpack(Oe),He=new L.AlphaImage({width:Se.w||1,height:Se.h||1});for(var Ze in be){var Be=be[Ze];for(var lt in Be){var Rt=Be[+lt];if(Rt&&0!==Rt.bitmap.width&&0!==Rt.bitmap.height){var xt=De[Ze][lt].rect;L.AlphaImage.copy(Rt.bitmap,He,{x:0,y:0},{x:xt.x+1,y:xt.y+1},Rt.bitmap)}}}this.image=He,this.positions=De};L.register("GlyphAtlas",Et);var it=function(be){this.tileID=new L.OverscaledTileID(be.tileID.overscaledZ,be.tileID.wrap,be.tileID.canonical.z,be.tileID.canonical.x,be.tileID.canonical.y),this.uid=be.uid,this.zoom=be.zoom,this.pixelRatio=be.pixelRatio,this.tileSize=be.tileSize,this.source=be.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=be.showCollisionBoxes,this.collectResourceTiming=!!be.collectResourceTiming,this.returnDependencies=!!be.returnDependencies,this.promoteId=be.promoteId};function Ge(be,De,Oe){for(var se=new L.EvaluationParameters(De),te=0,oe=be;te<oe.length;te+=1)oe[te].recalculate(se,Oe)}function Ke(be,De){var Oe=L.getArrayBuffer(be.request,function(se,te,oe,me){se?De(se):te&&De(null,{vectorTile:new L.vectorTile.VectorTile(new L.pbf(te)),rawData:te,cacheControl:oe,expires:me})});return function(){Oe.cancel(),De()}}it.prototype.parse=function(be,De,Oe,se,te){var oe=this;this.status="parsing",this.data=be,this.collisionBoxArray=new L.CollisionBoxArray;var me=new L.DictionaryCoder(Object.keys(be.layers).sort()),ve=new L.FeatureIndex(this.tileID,this.promoteId);ve.bucketLayerIDs=[];var pe,Se,He,Ze,Be={},lt={featureIndex:ve,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Oe},Rt=De.familiesBySource[this.source];for(var xt in Rt){var Xt=be.layers[xt];if(Xt){1===Xt.version&&L.warnOnce('Vector tile source "'+this.source+'" layer "'+xt+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var mt=me.encode(xt),Je=[],ot=0;ot<Xt.length;ot++){var On=Xt.feature(ot),Bn=ve.getId(On,xt);Je.push({feature:On,id:Bn,index:ot,sourceLayerIndex:mt})}for(var sn=0,br=Rt[xt];sn<br.length;sn+=1){var Ft=br[sn],mr=Ft[0];mr.minzoom&&this.zoom<Math.floor(mr.minzoom)||mr.maxzoom&&this.zoom>=mr.maxzoom||"none"!==mr.visibility&&(Ge(Ft,this.zoom,Oe),(Be[mr.id]=mr.createBucket({index:ve.bucketLayerIDs.length,layers:Ft,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:mt,sourceID:this.source})).populate(Je,lt,this.tileID.canonical),ve.bucketLayerIDs.push(Ft.map(function(ri){return ri.id})))}}}var or=L.mapObject(lt.glyphDependencies,function(ri){return Object.keys(ri).map(Number)});Object.keys(or).length?se.send("getGlyphs",{uid:this.uid,stacks:or},function(ri,Yr){pe||(pe=ri,Se=Yr,wn.call(oe))}):Se={};var qt=Object.keys(lt.iconDependencies);qt.length?se.send("getImages",{icons:qt,source:this.source,tileID:this.tileID,type:"icons"},function(ri,Yr){pe||(pe=ri,He=Yr,wn.call(oe))}):He={};var ur=Object.keys(lt.patternDependencies);function wn(){if(pe)return te(pe);if(Se&&He&&Ze){var ri=new Et(Se),Yr=new L.ImageAtlas(He,Ze);for(var lr in Be){var ni=Be[lr];ni instanceof L.SymbolBucket?(Ge(ni.layers,this.zoom,Oe),L.performSymbolLayout(ni,Se,ri.positions,He,Yr.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):ni.hasPattern&&(ni instanceof L.LineBucket||ni instanceof L.FillBucket||ni instanceof L.FillExtrusionBucket)&&(Ge(ni.layers,this.zoom,Oe),ni.addFeatures(lt,this.tileID.canonical,Yr.patternPositions))}this.status="done",te(null,{buckets:L.values(Be).filter(function(Kr){return!Kr.isEmpty()}),featureIndex:ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ri.image,imageAtlas:Yr,glyphMap:this.returnDependencies?Se:null,iconMap:this.returnDependencies?He:null,glyphPositions:this.returnDependencies?ri.positions:null})}}ur.length?se.send("getImages",{icons:ur,source:this.source,tileID:this.tileID,type:"patterns"},function(ri,Yr){pe||(pe=ri,Ze=Yr,wn.call(oe))}):Ze={},wn.call(this)};var Wt=function(be,De,Oe,se){this.actor=be,this.layerIndex=De,this.availableImages=Oe,this.loadVectorData=se||Ke,this.loading={},this.loaded={}};Wt.prototype.loadTile=function(be,De){var Oe=this,se=be.uid;this.loading||(this.loading={});var te=!!(be&&be.request&&be.request.collectResourceTiming)&&new L.RequestPerformance(be.request),oe=this.loading[se]=new it(be);oe.abort=this.loadVectorData(be,function(me,ve){if(delete Oe.loading[se],me||!ve)return oe.status="done",Oe.loaded[se]=oe,De(me);var pe=ve.rawData,Se={};ve.expires&&(Se.expires=ve.expires),ve.cacheControl&&(Se.cacheControl=ve.cacheControl);var He={};if(te){var Ze=te.finish();Ze&&(He.resourceTiming=JSON.parse(JSON.stringify(Ze)))}oe.vectorTile=ve.vectorTile,oe.parse(ve.vectorTile,Oe.layerIndex,Oe.availableImages,Oe.actor,function(Be,lt){if(Be||!lt)return De(Be);De(null,L.extend({rawTileData:pe.slice(0)},lt,Se,He))}),Oe.loaded=Oe.loaded||{},Oe.loaded[se]=oe})},Wt.prototype.reloadTile=function(be,De){var Oe=this,se=this.loaded,te=be.uid,oe=this;if(se&&se[te]){var me=se[te];me.showCollisionBoxes=be.showCollisionBoxes;var ve=function(pe,Se){var He=me.reloadCallback;He&&(delete me.reloadCallback,me.parse(me.vectorTile,oe.layerIndex,Oe.availableImages,oe.actor,He)),De(pe,Se)};"parsing"===me.status?me.reloadCallback=ve:"done"===me.status&&(me.vectorTile?me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor,ve):ve())}},Wt.prototype.abortTile=function(be,De){var Oe=this.loading,se=be.uid;Oe&&Oe[se]&&Oe[se].abort&&(Oe[se].abort(),delete Oe[se]),De()},Wt.prototype.removeTile=function(be,De){var Oe=this.loaded,se=be.uid;Oe&&Oe[se]&&delete Oe[se],De()};var on=L.window.ImageBitmap,Cn=function(){this.loaded={}};function fn(be,De){if(0!==be.length){et(be[0],De);for(var Oe=1;Oe<be.length;Oe++)et(be[Oe],!De)}}function et(be,De){for(var Oe=0,se=0,te=be.length,oe=te-1;se<te;oe=se++)Oe+=(be[se][0]-be[oe][0])*(be[oe][1]+be[se][1]);Oe>=0!=!!De&&be.reverse()}Cn.prototype.loadTile=function(be,De){var Oe=be.uid,se=be.encoding,te=be.rawImageData,oe=on&&te instanceof on?this.getImageData(te):te,me=new L.DEMData(Oe,oe,se);this.loaded=this.loaded||{},this.loaded[Oe]=me,De(null,me)},Cn.prototype.getImageData=function(be){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(be.width,be.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=be.width,this.offscreenCanvas.height=be.height,this.offscreenCanvasContext.drawImage(be,0,0,be.width,be.height);var De=this.offscreenCanvasContext.getImageData(-1,-1,be.width+2,be.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new L.RGBAImage({width:De.width,height:De.height},De.data)},Cn.prototype.removeTile=function(be){var De=this.loaded,Oe=be.uid;De&&De[Oe]&&delete De[Oe]};var _t=L.vectorTile.VectorTileFeature.prototype.toGeoJSON,Dt=function(be){this._feature=be,this.extent=L.EXTENT,this.type=be.type,this.properties=be.tags,"id"in be&&!isNaN(be.id)&&(this.id=parseInt(be.id,10))};Dt.prototype.loadGeometry=function(){if(1===this._feature.type){for(var be=[],De=0,Oe=this._feature.geometry;De<Oe.length;De+=1){var se=Oe[De];be.push([new L.Point$1(se[0],se[1])])}return be}for(var te=[],oe=0,me=this._feature.geometry;oe<me.length;oe+=1){for(var ve=[],pe=0,Se=me[oe];pe<Se.length;pe+=1){var He=Se[pe];ve.push(new L.Point$1(He[0],He[1]))}te.push(ve)}return te},Dt.prototype.toGeoJSON=function(be,De,Oe){return _t.call(this,be,De,Oe)};var bn=function(be){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=L.EXTENT,this.length=be.length,this._features=be};bn.prototype.feature=function(be){return new Dt(this._features[be])};var Pn=L.vectorTile.VectorTileFeature,an=Rn;function Rn(be,De){this.options=De||{},this.features=be,this.length=be.length}function nr(be,De){this.id="number"==typeof be.id?be.id:void 0,this.type=be.type,this.rawGeometry=1===be.type?[be.geometry]:be.geometry,this.properties=be.tags,this.extent=De||4096}Rn.prototype.feature=function(be){return new nr(this.features[be],this.options.extent)},nr.prototype.loadGeometry=function(){var be=this.rawGeometry;this.geometry=[];for(var De=0;De<be.length;De++){for(var Oe=be[De],se=[],te=0;te<Oe.length;te++)se.push(new L.Point$1(Oe[te][0],Oe[te][1]));this.geometry.push(se)}return this.geometry},nr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var be=this.geometry,De=1/0,Oe=-1/0,se=1/0,te=-1/0,oe=0;oe<be.length;oe++)for(var me=be[oe],ve=0;ve<me.length;ve++){var pe=me[ve];De=Math.min(De,pe.x),Oe=Math.max(Oe,pe.x),se=Math.min(se,pe.y),te=Math.max(te,pe.y)}return[De,se,Oe,te]},nr.prototype.toGeoJSON=Pn.prototype.toGeoJSON;var dr=pn,jn=an;function pn(be){var De=new L.pbf;return function(Oe,se){for(var te in Oe.layers)se.writeMessage(3,sr,Oe.layers[te])}(be,De),De.finish()}function sr(be,De){var Oe;De.writeVarintField(15,be.version||1),De.writeStringField(1,be.name||""),De.writeVarintField(5,be.extent||4096);var se={keys:[],values:[],keycache:{},valuecache:{}};for(Oe=0;Oe<be.length;Oe++)se.feature=be.feature(Oe),De.writeMessage(2,qr,se);var te=se.keys;for(Oe=0;Oe<te.length;Oe++)De.writeStringField(3,te[Oe]);var oe=se.values;for(Oe=0;Oe<oe.length;Oe++)De.writeMessage(4,Pr,oe[Oe])}function qr(be,De){var Oe=be.feature;void 0!==Oe.id&&De.writeVarintField(1,Oe.id),De.writeMessage(2,Es,be),De.writeVarintField(3,Oe.type),De.writeMessage(4,Vt,Oe)}function Es(be,De){var Oe=be.feature,se=be.keys,te=be.values,oe=be.keycache,me=be.valuecache;for(var ve in Oe.properties){var pe=oe[ve];void 0===pe&&(se.push(ve),oe[ve]=pe=se.length-1),De.writeVarint(pe);var Se=Oe.properties[ve],He=typeof Se;"string"!==He&&"boolean"!==He&&"number"!==He&&(Se=JSON.stringify(Se));var Ze=He+":"+Se,Be=me[Ze];void 0===Be&&(te.push(Se),me[Ze]=Be=te.length-1),De.writeVarint(Be)}}function je(be,De){return(De<<3)+(7&be)}function ct(be){return be<<1^be>>31}function Vt(be,De){for(var Oe=be.loadGeometry(),se=be.type,te=0,oe=0,me=Oe.length,ve=0;ve<me;ve++){var pe=Oe[ve],Se=1;1===se&&(Se=pe.length),De.writeVarint(je(1,Se));for(var He=3===se?pe.length-1:pe.length,Ze=0;Ze<He;Ze++){1===Ze&&1!==se&&De.writeVarint(je(2,He-1));var Be=pe[Ze].x-te,lt=pe[Ze].y-oe;De.writeVarint(ct(Be)),De.writeVarint(ct(lt)),te+=Be,oe+=lt}3===se&&De.writeVarint(je(7,1))}}function Pr(be,De){var Oe=typeof be;"string"===Oe?De.writeStringField(1,be):"boolean"===Oe?De.writeBooleanField(7,be):"number"===Oe&&(be%1!=0?De.writeDoubleField(3,be):be<0?De.writeSVarintField(6,be):De.writeVarintField(5,be))}function fr(be,De,Oe,se){vr(be,Oe,se),vr(De,2*Oe,2*se),vr(De,2*Oe+1,2*se+1)}function vr(be,De,Oe){var se=be[De];be[De]=be[Oe],be[Oe]=se}function Er(be,De,Oe,se){var te=be-Oe,oe=De-se;return te*te+oe*oe}dr.fromVectorTileJs=pn,dr.fromGeojsonVt=function(be,De){De=De||{};var Oe={};for(var se in be)Oe[se]=new an(be[se].features,De),Oe[se].name=se,Oe[se].version=De.version,Oe[se].extent=De.extent;return pn({layers:Oe})},dr.GeoJSONWrapper=jn;var Ui=function(be){return be[0]},Wo=function(be){return be[1]},Xi=function(be,De,Oe,se,te){void 0===De&&(De=Ui),void 0===Oe&&(Oe=Wo),void 0===se&&(se=64),void 0===te&&(te=Float64Array),this.nodeSize=se,this.points=be;for(var oe=be.length<65536?Uint16Array:Uint32Array,me=this.ids=new oe(be.length),ve=this.coords=new te(2*be.length),pe=0;pe<be.length;pe++)me[pe]=pe,ve[2*pe]=De(be[pe]),ve[2*pe+1]=Oe(be[pe]);!function Se(He,Ze,Be,lt,Rt,xt){if(!(Rt-lt<=Be)){var Xt=lt+Rt>>1;(function mt(Je,ot,On,Bn,sn,br){for(;sn>Bn;){if(sn-Bn>600){var Ft=sn-Bn+1,mr=On-Bn+1,or=Math.log(Ft),qt=.5*Math.exp(2*or/3),ur=.5*Math.sqrt(or*qt*(Ft-qt)/Ft)*(mr-Ft/2<0?-1:1);mt(Je,ot,On,Math.max(Bn,Math.floor(On-mr*qt/Ft+ur)),Math.min(sn,Math.floor(On+(Ft-mr)*qt/Ft+ur)),br)}var wn=ot[2*On+br],ri=Bn,Yr=sn;for(fr(Je,ot,Bn,On),ot[2*sn+br]>wn&&fr(Je,ot,Bn,sn);ri<Yr;){for(fr(Je,ot,ri,Yr),ri++,Yr--;ot[2*ri+br]<wn;)ri++;for(;ot[2*Yr+br]>wn;)Yr--}ot[2*Bn+br]===wn?fr(Je,ot,Bn,Yr):fr(Je,ot,++Yr,sn),Yr<=On&&(Bn=Yr+1),On<=Yr&&(sn=Yr-1)}})(He,Ze,Xt,lt,Rt,xt%2),Se(He,Ze,Be,lt,Xt-1,xt+1),Se(He,Ze,Be,Xt+1,Rt,xt+1)}}(me,ve,se,0,me.length-1,0)};Xi.prototype.range=function(be,De,Oe,se){return function(te,oe,me,ve,pe,Se,He){for(var Ze,Be,lt=[0,te.length-1,0],Rt=[];lt.length;){var xt=lt.pop(),Xt=lt.pop(),mt=lt.pop();if(Xt-mt<=He)for(var Je=mt;Je<=Xt;Je++)Be=oe[2*Je+1],(Ze=oe[2*Je])>=me&&Ze<=pe&&Be>=ve&&Be<=Se&&Rt.push(te[Je]);else{var ot=Math.floor((mt+Xt)/2);Be=oe[2*ot+1],(Ze=oe[2*ot])>=me&&Ze<=pe&&Be>=ve&&Be<=Se&&Rt.push(te[ot]);var On=(xt+1)%2;(0===xt?me<=Ze:ve<=Be)&&(lt.push(mt),lt.push(ot-1),lt.push(On)),(0===xt?pe>=Ze:Se>=Be)&&(lt.push(ot+1),lt.push(Xt),lt.push(On))}}return Rt}(this.ids,this.coords,be,De,Oe,se,this.nodeSize)},Xi.prototype.within=function(be,De,Oe){return function(se,te,oe,me,ve,pe){for(var Se=[0,se.length-1,0],He=[],Ze=ve*ve;Se.length;){var Be=Se.pop(),lt=Se.pop(),Rt=Se.pop();if(lt-Rt<=pe)for(var xt=Rt;xt<=lt;xt++)Er(te[2*xt],te[2*xt+1],oe,me)<=Ze&&He.push(se[xt]);else{var Xt=Math.floor((Rt+lt)/2),mt=te[2*Xt],Je=te[2*Xt+1];Er(mt,Je,oe,me)<=Ze&&He.push(se[Xt]);var ot=(Be+1)%2;(0===Be?oe-ve<=mt:me-ve<=Je)&&(Se.push(Rt),Se.push(Xt-1),Se.push(ot)),(0===Be?oe+ve>=mt:me+ve>=Je)&&(Se.push(Xt+1),Se.push(lt),Se.push(ot))}}return He}(this.ids,this.coords,be,De,Oe,this.nodeSize)};var Vi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(be){return be}},Zr=function(be){this.options=zs(Object.create(Vi),be),this.trees=new Array(this.options.maxZoom+1)};function gl(be,De,Oe,se,te){return{x:be,y:De,zoom:1/0,id:Oe,parentId:-1,numPoints:se,properties:te}}function Ir(be,De){var Oe=be.geometry.coordinates,se=Oe[1];return{x:Yl(Oe[0]),y:di(se),zoom:1/0,index:De,parentId:-1}}function yl(be){return{type:"Feature",id:be.id,properties:Sc(be),geometry:{type:"Point",coordinates:[(se=be.x,360*(se-.5)),(De=be.y,Oe=(180-360*De)*Math.PI/180,360*Math.atan(Math.exp(Oe))/Math.PI-90)]}};var De,Oe,se}function Sc(be){var De=be.numPoints,Oe=De>=1e4?Math.round(De/1e3)+"k":De>=1e3?Math.round(De/100)/10+"k":De;return zs(zs({},be.properties),{cluster:!0,cluster_id:be.id,point_count:De,point_count_abbreviated:Oe})}function Yl(be){return be/360+.5}function di(be){var De=Math.sin(be*Math.PI/180),Oe=.5-.25*Math.log((1+De)/(1-De))/Math.PI;return Oe<0?0:Oe>1?1:Oe}function zs(be,De){for(var Oe in De)be[Oe]=De[Oe];return be}function ss(be){return be.x}function Ar(be){return be.y}function Tc(be,De,Oe,se,te,oe){var me=te-Oe,ve=oe-se;if(0!==me||0!==ve){var pe=((be-Oe)*me+(De-se)*ve)/(me*me+ve*ve);pe>1?(Oe=te,se=oe):pe>0&&(Oe+=me*pe,se+=ve*pe)}return(me=be-Oe)*me+(ve=De-se)*ve}function ol(be,De,Oe,se){var te={id:void 0===be?null:be,type:De,geometry:Oe,tags:se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(oe){var me=oe.geometry,ve=oe.type;if("Point"===ve||"MultiPoint"===ve||"LineString"===ve)vl(oe,me);else if("Polygon"===ve||"MultiLineString"===ve)for(var pe=0;pe<me.length;pe++)vl(oe,me[pe]);else if("MultiPolygon"===ve)for(pe=0;pe<me.length;pe++)for(var Se=0;Se<me[pe].length;Se++)vl(oe,me[pe][Se])}(te),te}function vl(be,De){for(var Oe=0;Oe<De.length;Oe+=3)be.minX=Math.min(be.minX,De[Oe]),be.minY=Math.min(be.minY,De[Oe+1]),be.maxX=Math.max(be.maxX,De[Oe]),be.maxY=Math.max(be.maxY,De[Oe+1])}function Rl(be,De,Oe,se){if(De.geometry){var te=De.geometry.coordinates,oe=De.geometry.type,me=Math.pow(Oe.tolerance/((1<<Oe.maxZoom)*Oe.extent),2),ve=[],pe=De.id;if(Oe.promoteId?pe=De.properties[Oe.promoteId]:Oe.generateId&&(pe=se||0),"Point"===oe)Ol(te,ve);else if("MultiPoint"===oe)for(var Se=0;Se<te.length;Se++)Ol(te[Se],ve);else if("LineString"===oe)gu(te,ve,me,!1);else if("MultiLineString"===oe){if(Oe.lineMetrics){for(Se=0;Se<te.length;Se++)gu(te[Se],ve=[],me,!1),be.push(ol(pe,"LineString",ve,De.properties));return}_l(te,ve,me,!1)}else if("Polygon"===oe)_l(te,ve,me,!0);else{if("MultiPolygon"!==oe){if("GeometryCollection"===oe){for(Se=0;Se<De.geometry.geometries.length;Se++)Rl(be,{id:pe,geometry:De.geometry.geometries[Se],properties:De.properties},Oe,se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Se=0;Se<te.length;Se++){var He=[];_l(te[Se],He,me,!0),ve.push(He)}}be.push(ol(pe,oe,ve,De.properties))}}function Ol(be,De){De.push(Na(be[0])),De.push(la(be[1])),De.push(0)}function gu(be,De,Oe,se){for(var te,oe,me=0,ve=0;ve<be.length;ve++){var pe=Na(be[ve][0]),Se=la(be[ve][1]);De.push(pe),De.push(Se),De.push(0),ve>0&&(me+=se?(te*Se-pe*oe)/2:Math.sqrt(Math.pow(pe-te,2)+Math.pow(Se-oe,2))),te=pe,oe=Se}var He=De.length-3;De[2]=1,function Ze(Be,lt,Rt,xt){for(var Xt,mt=xt,Je=Rt-lt>>1,ot=Rt-lt,On=Be[lt],Bn=Be[lt+1],sn=Be[Rt],br=Be[Rt+1],Ft=lt+3;Ft<Rt;Ft+=3){var mr=Tc(Be[Ft],Be[Ft+1],On,Bn,sn,br);if(mr>mt)Xt=Ft,mt=mr;else if(mr===mt){var or=Math.abs(Ft-Je);or<ot&&(Xt=Ft,ot=or)}}mt>xt&&(Xt-lt>3&&Ze(Be,lt,Xt,xt),Be[Xt+2]=mt,Rt-Xt>3&&Ze(Be,Xt,Rt,xt))}(De,0,He,Oe),De[He+2]=1,De.size=Math.abs(me),De.start=0,De.end=De.size}function _l(be,De,Oe,se){for(var te=0;te<be.length;te++){var oe=[];gu(be[te],oe,Oe,se),De.push(oe)}}function Na(be){return be/360+.5}function la(be){var De=Math.sin(be*Math.PI/180),Oe=.5-.25*Math.log((1+De)/(1-De))/Math.PI;return Oe<0?0:Oe>1?1:Oe}function al(be,De,Oe,se,te,oe,me,ve){if(se/=De,oe>=(Oe/=De)&&me<se)return be;if(me<Oe||oe>=se)return null;for(var pe=[],Se=0;Se<be.length;Se++){var He=be[Se],Ze=He.geometry,Be=He.type,lt=0===te?He.minX:He.minY,Rt=0===te?He.maxX:He.maxY;if(lt>=Oe&&Rt<se)pe.push(He);else if(!(Rt<Oe||lt>=se)){var xt=[];if("Point"===Be||"MultiPoint"===Be)Uh(Ze,xt,Oe,se,te);else if("LineString"===Be)Ys(Ze,xt,Oe,se,te,!1,ve.lineMetrics);else if("MultiLineString"===Be)Kc(Ze,xt,Oe,se,te,!1);else if("Polygon"===Be)Kc(Ze,xt,Oe,se,te,!0);else if("MultiPolygon"===Be)for(var Xt=0;Xt<Ze.length;Xt++){var mt=[];Kc(Ze[Xt],mt,Oe,se,te,!0),mt.length&&xt.push(mt)}if(xt.length){if(ve.lineMetrics&&"LineString"===Be){for(Xt=0;Xt<xt.length;Xt++)pe.push(ol(He.id,Be,xt[Xt],He.tags));continue}"LineString"!==Be&&"MultiLineString"!==Be||(1===xt.length?(Be="LineString",xt=xt[0]):Be="MultiLineString"),"Point"!==Be&&"MultiPoint"!==Be||(Be=3===xt.length?"Point":"MultiPoint"),pe.push(ol(He.id,Be,xt,He.tags))}}}return pe.length?pe:null}function Uh(be,De,Oe,se,te){for(var oe=0;oe<be.length;oe+=3){var me=be[oe+te];me>=Oe&&me<=se&&(De.push(be[oe]),De.push(be[oe+1]),De.push(be[oe+2]))}}function Ys(be,De,Oe,se,te,oe,me){for(var ve,pe,Se=Ns(be),He=0===te?Vh:Jc,Ze=be.start,Be=0;Be<be.length-3;Be+=3){var lt=be[Be],Rt=be[Be+1],xt=be[Be+2],Xt=be[Be+3],mt=be[Be+4],Je=0===te?lt:Rt,ot=0===te?Xt:mt,On=!1;me&&(ve=Math.sqrt(Math.pow(lt-Xt,2)+Math.pow(Rt-mt,2))),Je<Oe?ot>Oe&&(pe=He(Se,lt,Rt,Xt,mt,Oe),me&&(Se.start=Ze+ve*pe)):Je>se?ot<se&&(pe=He(Se,lt,Rt,Xt,mt,se),me&&(Se.start=Ze+ve*pe)):Ic(Se,lt,Rt,xt),ot<Oe&&Je>=Oe&&(pe=He(Se,lt,Rt,Xt,mt,Oe),On=!0),ot>se&&Je<=se&&(pe=He(Se,lt,Rt,Xt,mt,se),On=!0),!oe&&On&&(me&&(Se.end=Ze+ve*pe),De.push(Se),Se=Ns(be)),me&&(Ze+=ve)}var Bn=be.length-3;lt=be[Bn],Rt=be[Bn+1],xt=be[Bn+2],(Je=0===te?lt:Rt)>=Oe&&Je<=se&&Ic(Se,lt,Rt,xt),Bn=Se.length-3,oe&&Bn>=3&&(Se[Bn]!==Se[0]||Se[Bn+1]!==Se[1])&&Ic(Se,Se[0],Se[1],Se[2]),Se.length&&De.push(Se)}function Ns(be){var De=[];return De.size=be.size,De.start=be.start,De.end=be.end,De}function Kc(be,De,Oe,se,te,oe){for(var me=0;me<be.length;me++)Ys(be[me],De,Oe,se,te,oe,!1)}function Ic(be,De,Oe,se){be.push(De),be.push(Oe),be.push(se)}function Vh(be,De,Oe,se,te,oe){var me=(oe-De)/(se-De);return be.push(oe),be.push(Oe+(te-Oe)*me),be.push(1),me}function Jc(be,De,Oe,se,te,oe){var me=(oe-Oe)/(te-Oe);return be.push(De+(se-De)*me),be.push(oe),be.push(1),me}function Qu(be,De){for(var Oe=[],se=0;se<be.length;se++){var te,oe=be[se],me=oe.type;if("Point"===me||"MultiPoint"===me||"LineString"===me)te=Mc(oe.geometry,De);else if("MultiLineString"===me||"Polygon"===me){te=[];for(var ve=0;ve<oe.geometry.length;ve++)te.push(Mc(oe.geometry[ve],De))}else if("MultiPolygon"===me)for(te=[],ve=0;ve<oe.geometry.length;ve++){for(var pe=[],Se=0;Se<oe.geometry[ve].length;Se++)pe.push(Mc(oe.geometry[ve][Se],De));te.push(pe)}Oe.push(ol(oe.id,me,te,oe.tags))}return Oe}function Mc(be,De){var Oe=[];Oe.size=be.size,void 0!==be.start&&(Oe.start=be.start,Oe.end=be.end);for(var se=0;se<be.length;se+=3)Oe.push(be[se]+De,be[se+1],be[se+2]);return Oe}function Ss(be,De){if(be.transformed)return be;var Oe,se,te,oe=1<<be.z,me=be.x,ve=be.y;for(Oe=0;Oe<be.features.length;Oe++){var pe=be.features[Oe],Se=pe.geometry,He=pe.type;if(pe.geometry=[],1===He)for(se=0;se<Se.length;se+=2)pe.geometry.push(Qc(Se[se],Se[se+1],De,oe,me,ve));else for(se=0;se<Se.length;se++){var Ze=[];for(te=0;te<Se[se].length;te+=2)Ze.push(Qc(Se[se][te],Se[se][te+1],De,oe,me,ve));pe.geometry.push(Ze)}}return be.transformed=!0,be}function Qc(be,De,Oe,se,te,oe){return[Math.round(Oe*(be*se-te)),Math.round(Oe*(De*se-oe))]}function Nu(be,De,Oe,se,te){for(var oe=De===te.maxZoom?0:te.tolerance/((1<<De)*te.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Oe,y:se,z:De,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ve=0;ve<be.length;ve++){me.numFeatures++,_h(me,be[ve],oe,te);var pe=be[ve].minX,Se=be[ve].minY,He=be[ve].maxX,Ze=be[ve].maxY;pe<me.minX&&(me.minX=pe),Se<me.minY&&(me.minY=Se),He>me.maxX&&(me.maxX=He),Ze>me.maxY&&(me.maxY=Ze)}return me}function _h(be,De,Oe,se){var te=De.geometry,oe=De.type,me=[];if("Point"===oe||"MultiPoint"===oe)for(var ve=0;ve<te.length;ve+=3)me.push(te[ve]),me.push(te[ve+1]),be.numPoints++,be.numSimplified++;else if("LineString"===oe)Bs(me,te,be,Oe,!1,!1);else if("MultiLineString"===oe||"Polygon"===oe)for(ve=0;ve<te.length;ve++)Bs(me,te[ve],be,Oe,"Polygon"===oe,0===ve);else if("MultiPolygon"===oe)for(var pe=0;pe<te.length;pe++){var Se=te[pe];for(ve=0;ve<Se.length;ve++)Bs(me,Se[ve],be,Oe,!0,0===ve)}if(me.length){var He=De.tags||null;if("LineString"===oe&&se.lineMetrics){for(var Ze in He={},De.tags)He[Ze]=De.tags[Ze];He.mapbox_clip_start=te.start/te.size,He.mapbox_clip_end=te.end/te.size}var Be={geometry:me,type:"Polygon"===oe||"MultiPolygon"===oe?3:"LineString"===oe||"MultiLineString"===oe?2:1,tags:He};null!==De.id&&(Be.id=De.id),be.features.push(Be)}}function Bs(be,De,Oe,se,te,oe){var me=se*se;if(se>0&&De.size<(te?me:se))Oe.numPoints+=De.length/3;else{for(var ve=[],pe=0;pe<De.length;pe+=3)(0===se||De[pe+2]>me)&&(Oe.numSimplified++,ve.push(De[pe]),ve.push(De[pe+1])),Oe.numPoints++;te&&function(Se,He){for(var Ze=0,Be=0,lt=Se.length,Rt=lt-2;Be<lt;Rt=Be,Be+=2)Ze+=(Se[Be]-Se[Rt])*(Se[Be+1]+Se[Rt+1]);if(Ze>0===He)for(Be=0,lt=Se.length;Be<lt/2;Be+=2){var xt=Se[Be],Xt=Se[Be+1];Se[Be]=Se[lt-2-Be],Se[Be+1]=Se[lt-1-Be],Se[lt-2-Be]=xt,Se[lt-1-Be]=Xt}}(ve,oe),be.push(ve)}}function Kl(be,De){var Oe=(De=this.options=function(te,oe){for(var me in oe)te[me]=oe[me];return te}(Object.create(this.options),De)).debug;if(Oe&&console.time("preprocess data"),De.maxZoom<0||De.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(De.promoteId&&De.generateId)throw new Error("promoteId and generateId cannot be used together.");var te,oe,me,ve,pe,Se,se=function(te,oe){var me=[];if("FeatureCollection"===te.type)for(var ve=0;ve<te.features.length;ve++)Rl(me,te.features[ve],oe,ve);else Rl(me,"Feature"===te.type?te:{geometry:te},oe);return me}(be,De);this.tiles={},this.tileCoords=[],Oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",De.indexMaxZoom,De.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(te=se,oe=De,me=oe.buffer/oe.extent,ve=te,pe=al(te,1,-1-me,me,0,-1,2,oe),Se=al(te,1,1-me,2+me,0,-1,2,oe),(pe||Se)&&(ve=al(te,1,-me,1+me,0,-1,2,oe)||[],pe&&(ve=Qu(pe,1).concat(ve)),Se&&(ve=ve.concat(Qu(Se,-1)))),se=ve).length&&this.splitTile(se,0,0,0),Oe&&(se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Jl(be,De,Oe){return 32*((1<<be)*Oe+De)+be}function Ll(be,De){var Oe=be.tileID.canonical;if(!this._geoJSONIndex)return De(null,null);var se=this._geoJSONIndex.getTile(Oe.z,Oe.x,Oe.y);if(!se)return De(null,null);var te=new bn(se.features),oe=dr(te);0===oe.byteOffset&&oe.byteLength===oe.buffer.byteLength||(oe=new Uint8Array(oe)),De(null,{vectorTile:te,rawData:oe.buffer})}Zr.prototype.load=function(be){var De=this.options,Oe=De.log,se=De.minZoom,te=De.maxZoom,oe=De.nodeSize;Oe&&console.time("total time");var me="prepare "+be.length+" points";Oe&&console.time(me),this.points=be;for(var ve=[],pe=0;pe<be.length;pe++)be[pe].geometry&&ve.push(Ir(be[pe],pe));this.trees[te+1]=new Xi(ve,ss,Ar,oe,Float32Array),Oe&&console.timeEnd(me);for(var Se=te;Se>=se;Se--){var He=+Date.now();ve=this._cluster(ve,Se),this.trees[Se]=new Xi(ve,ss,Ar,oe,Float32Array),Oe&&console.log("z%d: %d clusters in %dms",Se,ve.length,+Date.now()-He)}return Oe&&console.timeEnd("total time"),this},Zr.prototype.getClusters=function(be,De){var Oe=((be[0]+180)%360+360)%360-180,se=Math.max(-90,Math.min(90,be[1])),te=180===be[2]?180:((be[2]+180)%360+360)%360-180,oe=Math.max(-90,Math.min(90,be[3]));if(be[2]-be[0]>=360)Oe=-180,te=180;else if(Oe>te){var me=this.getClusters([Oe,se,180,oe],De),ve=this.getClusters([-180,se,te,oe],De);return me.concat(ve)}for(var pe=this.trees[this._limitZoom(De)],Se=[],He=0,Ze=pe.range(Yl(Oe),di(oe),Yl(te),di(se));He<Ze.length;He+=1){var Be=pe.points[Ze[He]];Se.push(Be.numPoints?yl(Be):this.points[Be.index])}return Se},Zr.prototype.getChildren=function(be){var De=this._getOriginId(be),Oe=this._getOriginZoom(be),se="No cluster with the specified id.",te=this.trees[Oe];if(!te)throw new Error(se);var oe=te.points[De];if(!oe)throw new Error(se);for(var me=this.options.radius/(this.options.extent*Math.pow(2,Oe-1)),ve=[],pe=0,Se=te.within(oe.x,oe.y,me);pe<Se.length;pe+=1){var He=te.points[Se[pe]];He.parentId===be&&ve.push(He.numPoints?yl(He):this.points[He.index])}if(0===ve.length)throw new Error(se);return ve},Zr.prototype.getLeaves=function(be,De,Oe){var se=[];return this._appendLeaves(se,be,De=De||10,Oe=Oe||0,0),se},Zr.prototype.getTile=function(be,De,Oe){var se=this.trees[this._limitZoom(be)],te=Math.pow(2,be),oe=this.options,me=oe.radius/oe.extent,ve=(Oe-me)/te,pe=(Oe+1+me)/te,Se={features:[]};return this._addTileFeatures(se.range((De-me)/te,ve,(De+1+me)/te,pe),se.points,De,Oe,te,Se),0===De&&this._addTileFeatures(se.range(1-me/te,ve,1,pe),se.points,te,Oe,te,Se),De===te-1&&this._addTileFeatures(se.range(0,ve,me/te,pe),se.points,-1,Oe,te,Se),Se.features.length?Se:null},Zr.prototype.getClusterExpansionZoom=function(be){for(var De=this._getOriginZoom(be)-1;De<=this.options.maxZoom;){var Oe=this.getChildren(be);if(De++,1!==Oe.length)break;be=Oe[0].properties.cluster_id}return De},Zr.prototype._appendLeaves=function(be,De,Oe,se,te){for(var oe=0,me=this.getChildren(De);oe<me.length;oe+=1){var ve=me[oe],pe=ve.properties;if(pe&&pe.cluster?te+pe.point_count<=se?te+=pe.point_count:te=this._appendLeaves(be,pe.cluster_id,Oe,se,te):te<se?te++:be.push(ve),be.length===Oe)break}return te},Zr.prototype._addTileFeatures=function(be,De,Oe,se,te,oe){for(var me=0,ve=be;me<ve.length;me+=1){var pe=De[ve[me]],Se=pe.numPoints,He={type:1,geometry:[[Math.round(this.options.extent*(pe.x*te-Oe)),Math.round(this.options.extent*(pe.y*te-se))]],tags:Se?Sc(pe):this.points[pe.index].properties},Ze=void 0;Se?Ze=pe.id:this.options.generateId?Ze=pe.index:this.points[pe.index].id&&(Ze=this.points[pe.index].id),void 0!==Ze&&(He.id=Ze),oe.features.push(He)}},Zr.prototype._limitZoom=function(be){return Math.max(this.options.minZoom,Math.min(+be,this.options.maxZoom+1))},Zr.prototype._cluster=function(be,De){for(var Oe=[],se=this.options,te=se.reduce,oe=se.minPoints,me=se.radius/(se.extent*Math.pow(2,De)),ve=0;ve<be.length;ve++){var pe=be[ve];if(!(pe.zoom<=De)){pe.zoom=De;for(var Se=this.trees[De+1],He=Se.within(pe.x,pe.y,me),Ze=pe.numPoints||1,Be=Ze,lt=0,Rt=He;lt<Rt.length;lt+=1){var xt=Se.points[Rt[lt]];xt.zoom>De&&(Be+=xt.numPoints||1)}if(Be>=oe){for(var Xt=pe.x*Ze,mt=pe.y*Ze,Je=te&&Ze>1?this._map(pe,!0):null,ot=(ve<<5)+(De+1)+this.points.length,On=0,Bn=He;On<Bn.length;On+=1){var sn=Se.points[Bn[On]];if(!(sn.zoom<=De)){sn.zoom=De;var br=sn.numPoints||1;Xt+=sn.x*br,mt+=sn.y*br,sn.parentId=ot,te&&(Je||(Je=this._map(pe,!0)),te(Je,this._map(sn)))}}pe.parentId=ot,Oe.push(gl(Xt/Be,mt/Be,ot,Be,Je))}else if(Oe.push(pe),Be>1)for(var Ft=0,mr=He;Ft<mr.length;Ft+=1){var or=Se.points[mr[Ft]];or.zoom<=De||(or.zoom=De,Oe.push(or))}}}return Oe},Zr.prototype._getOriginId=function(be){return be-this.points.length>>5},Zr.prototype._getOriginZoom=function(be){return(be-this.points.length)%32},Zr.prototype._map=function(be,De){if(be.numPoints)return De?zs({},be.properties):be.properties;var Oe=this.points[be.index].properties,se=this.options.map(Oe);return De&&se===Oe?zs({},se):se},Kl.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Kl.prototype.splitTile=function(be,De,Oe,se,te,oe,me){for(var ve=[be,De,Oe,se],pe=this.options,Se=pe.debug;ve.length;){se=ve.pop(),Oe=ve.pop(),De=ve.pop(),be=ve.pop();var He=1<<De,Ze=Jl(De,Oe,se),Be=this.tiles[Ze];if(!Be&&(Se>1&&console.time("creation"),Be=this.tiles[Ze]=Nu(be,De,Oe,se,pe),this.tileCoords.push({z:De,x:Oe,y:se}),Se)){Se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",De,Oe,se,Be.numFeatures,Be.numPoints,Be.numSimplified),console.timeEnd("creation"));var lt="z"+De;this.stats[lt]=(this.stats[lt]||0)+1,this.total++}if(Be.source=be,te){if(De===pe.maxZoom||De===te)continue;var Rt=1<<te-De;if(Oe!==Math.floor(oe/Rt)||se!==Math.floor(me/Rt))continue}else if(De===pe.indexMaxZoom||Be.numPoints<=pe.indexMaxPoints)continue;if(Be.source=null,0!==be.length){Se>1&&console.time("clipping");var xt,Xt,mt,Je,ot,On,Bn=.5*pe.buffer/pe.extent,sn=.5-Bn,br=.5+Bn,Ft=1+Bn;xt=Xt=mt=Je=null,ot=al(be,He,Oe-Bn,Oe+br,0,Be.minX,Be.maxX,pe),On=al(be,He,Oe+sn,Oe+Ft,0,Be.minX,Be.maxX,pe),be=null,ot&&(xt=al(ot,He,se-Bn,se+br,1,Be.minY,Be.maxY,pe),Xt=al(ot,He,se+sn,se+Ft,1,Be.minY,Be.maxY,pe),ot=null),On&&(mt=al(On,He,se-Bn,se+br,1,Be.minY,Be.maxY,pe),Je=al(On,He,se+sn,se+Ft,1,Be.minY,Be.maxY,pe),On=null),Se>1&&console.timeEnd("clipping"),ve.push(xt||[],De+1,2*Oe,2*se),ve.push(Xt||[],De+1,2*Oe,2*se+1),ve.push(mt||[],De+1,2*Oe+1,2*se),ve.push(Je||[],De+1,2*Oe+1,2*se+1)}}},Kl.prototype.getTile=function(be,De,Oe){var se=this.options,te=se.extent,oe=se.debug;if(be<0||be>24)return null;var me=1<<be,ve=Jl(be,De=(De%me+me)%me,Oe);if(this.tiles[ve])return Ss(this.tiles[ve],te);oe>1&&console.log("drilling down to z%d-%d-%d",be,De,Oe);for(var pe,Se=be,He=De,Ze=Oe;!pe&&Se>0;)Se--,He=Math.floor(He/2),Ze=Math.floor(Ze/2),pe=this.tiles[Jl(Se,He,Ze)];return pe&&pe.source?(oe>1&&console.log("found parent tile z%d-%d-%d",Se,He,Ze),oe>1&&console.time("drilling down"),this.splitTile(pe.source,Se,He,Ze,be,De,Oe),oe>1&&console.timeEnd("drilling down"),this.tiles[ve]?Ss(this.tiles[ve],te):null):null};var Da=function(be){function De(Oe,se,te,oe){be.call(this,Oe,se,te,Ll),oe&&(this.loadGeoJSON=oe)}return be&&(De.__proto__=be),(De.prototype=Object.create(be&&be.prototype)).constructor=De,De.prototype.loadData=function(Oe,se){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=se,this._pendingLoadDataParams=Oe,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},De.prototype._loadData=function(){var Oe=this;if(this._pendingCallback&&this._pendingLoadDataParams){var se=this._pendingCallback,te=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var oe=!!(te&&te.request&&te.request.collectResourceTiming)&&new L.RequestPerformance(te.request);this.loadGeoJSON(te,function(me,ve){if(me||!ve)return se(me);if("object"!=typeof ve)return se(new Error("Input data given to '"+te.source+"' is not a valid GeoJSON object."));!function Be(lt,Rt){var xt,Xt=lt&&lt.type;if("FeatureCollection"===Xt)for(xt=0;xt<lt.features.length;xt++)Be(lt.features[xt],Rt);else if("GeometryCollection"===Xt)for(xt=0;xt<lt.geometries.length;xt++)Be(lt.geometries[xt],Rt);else if("Feature"===Xt)Be(lt.geometry,Rt);else if("Polygon"===Xt)fn(lt.coordinates,Rt);else if("MultiPolygon"===Xt)for(xt=0;xt<lt.coordinates.length;xt++)fn(lt.coordinates[xt],Rt);return lt}(ve,!0);try{if(te.filter){var pe=L.createExpression(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===pe.result)throw new Error(pe.value.map(function(Be){return Be.key+": "+Be.message}).join(", "));var Se=ve.features.filter(function(Be){return pe.value.evaluate({zoom:0},Be)});ve={type:"FeatureCollection",features:Se}}Oe._geoJSONIndex=te.cluster?new Zr(function(Be){var lt=Be.superclusterOptions,Rt=Be.clusterProperties;if(!Rt||!lt)return lt;for(var xt={},Xt={},mt={accumulated:null,zoom:0},Je={properties:null},ot=Object.keys(Rt),On=0,Bn=ot;On<Bn.length;On+=1){var sn=Bn[On],br=Rt[sn],Ft=br[0],mr=L.createExpression(br[1]),or=L.createExpression("string"==typeof Ft?[Ft,["accumulated"],["get",sn]]:Ft);xt[sn]=mr.value,Xt[sn]=or.value}return lt.map=function(qt){Je.properties=qt;for(var ur={},wn=0,ri=ot;wn<ri.length;wn+=1){var Yr=ri[wn];ur[Yr]=xt[Yr].evaluate(mt,Je)}return ur},lt.reduce=function(qt,ur){Je.properties=ur;for(var wn=0,ri=ot;wn<ri.length;wn+=1){var Yr=ri[wn];mt.accumulated=qt[Yr],qt[Yr]=Xt[Yr].evaluate(mt,Je)}},lt}(te)).load(ve.features):new Kl(Be=ve,te.geojsonVtOptions)}catch(Be){return se(Be)}var Be;Oe.loaded={};var He={};if(oe){var Ze=oe.finish();Ze&&(He.resourceTiming={},He.resourceTiming[te.source]=JSON.parse(JSON.stringify(Ze)))}se(null,He)})}},De.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},De.prototype.reloadTile=function(Oe,se){var te=this.loaded;return te&&te[Oe.uid]?be.prototype.reloadTile.call(this,Oe,se):this.loadTile(Oe,se)},De.prototype.loadGeoJSON=function(Oe,se){if(Oe.request)L.getJSON(Oe.request,se);else{if("string"!=typeof Oe.data)return se(new Error("Input data given to '"+Oe.source+"' is not a valid GeoJSON object."));try{return se(null,JSON.parse(Oe.data))}catch(te){return se(new Error("Input data given to '"+Oe.source+"' is not a valid GeoJSON object."))}}},De.prototype.removeSource=function(Oe,se){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),se()},De.prototype.getClusterExpansionZoom=function(Oe,se){try{se(null,this._geoJSONIndex.getClusterExpansionZoom(Oe.clusterId))}catch(te){se(te)}},De.prototype.getClusterChildren=function(Oe,se){try{se(null,this._geoJSONIndex.getChildren(Oe.clusterId))}catch(te){se(te)}},De.prototype.getClusterLeaves=function(Oe,se){try{se(null,this._geoJSONIndex.getLeaves(Oe.clusterId,Oe.limit,Oe.offset))}catch(te){se(te)}},De}(Wt),Bo=function(be){var De=this;this.self=be,this.actor=new L.Actor(be,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Wt,geojson:Da},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(Oe,se){if(De.workerSourceTypes[Oe])throw new Error('Worker source with name "'+Oe+'" already registered.');De.workerSourceTypes[Oe]=se},this.self.registerRTLTextPlugin=function(Oe){if(L.plugin.isParsed())throw new Error("RTL text plugin already registered.");L.plugin.applyArabicShaping=Oe.applyArabicShaping,L.plugin.processBidirectionalText=Oe.processBidirectionalText,L.plugin.processStyledBidirectionalText=Oe.processStyledBidirectionalText}};return Bo.prototype.setReferrer=function(be,De){this.referrer=De},Bo.prototype.setImages=function(be,De,Oe){for(var se in this.availableImages[be]=De,this.workerSources[be]){var te=this.workerSources[be][se];for(var oe in te)te[oe].availableImages=De}Oe()},Bo.prototype.setLayers=function(be,De,Oe){this.getLayerIndex(be).replace(De),Oe()},Bo.prototype.updateLayers=function(be,De,Oe){this.getLayerIndex(be).update(De.layers,De.removedIds),Oe()},Bo.prototype.loadTile=function(be,De,Oe){this.getWorkerSource(be,De.type,De.source).loadTile(De,Oe)},Bo.prototype.loadDEMTile=function(be,De,Oe){this.getDEMWorkerSource(be,De.source).loadTile(De,Oe)},Bo.prototype.reloadTile=function(be,De,Oe){this.getWorkerSource(be,De.type,De.source).reloadTile(De,Oe)},Bo.prototype.abortTile=function(be,De,Oe){this.getWorkerSource(be,De.type,De.source).abortTile(De,Oe)},Bo.prototype.removeTile=function(be,De,Oe){this.getWorkerSource(be,De.type,De.source).removeTile(De,Oe)},Bo.prototype.removeDEMTile=function(be,De){this.getDEMWorkerSource(be,De.source).removeTile(De)},Bo.prototype.removeSource=function(be,De,Oe){if(this.workerSources[be]&&this.workerSources[be][De.type]&&this.workerSources[be][De.type][De.source]){var se=this.workerSources[be][De.type][De.source];delete this.workerSources[be][De.type][De.source],void 0!==se.removeSource?se.removeSource(De,Oe):Oe()}},Bo.prototype.loadWorkerSource=function(be,De,Oe){try{this.self.importScripts(De.url),Oe()}catch(se){Oe(se.toString())}},Bo.prototype.syncRTLPluginState=function(be,De,Oe){try{L.plugin.setState(De);var se=L.plugin.getPluginURL();if(L.plugin.isLoaded()&&!L.plugin.isParsed()&&null!=se){this.self.importScripts(se);var te=L.plugin.isParsed();Oe(te?void 0:new Error("RTL Text Plugin failed to import scripts from "+se),te)}}catch(oe){Oe(oe.toString())}},Bo.prototype.getAvailableImages=function(be){var De=this.availableImages[be];return De||(De=[]),De},Bo.prototype.getLayerIndex=function(be){var De=this.layerIndexes[be];return De||(De=this.layerIndexes[be]=new tn),De},Bo.prototype.getWorkerSource=function(be,De,Oe){var se=this;return this.workerSources[be]||(this.workerSources[be]={}),this.workerSources[be][De]||(this.workerSources[be][De]={}),this.workerSources[be][De][Oe]||(this.workerSources[be][De][Oe]=new this.workerSourceTypes[De]({send:function(te,oe,me){se.actor.send(te,oe,me,be)}},this.getLayerIndex(be),this.getAvailableImages(be))),this.workerSources[be][De][Oe]},Bo.prototype.getDEMWorkerSource=function(be,De){return this.demWorkerSources[be]||(this.demWorkerSources[be]={}),this.demWorkerSources[be][De]||(this.demWorkerSources[be][De]=new Cn),this.demWorkerSources[be][De]},Bo.prototype.enforceCacheSizeLimit=function(be,De){L.enforceCacheSizeLimit(De)},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Bo(self)),Bo}),Jt(0,function(L){var C=L.createCommonjsModule(function(v){function w(j){return!_(j)}function _(j){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var l,d,x=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(x);try{d=new Worker(M),l=!0}catch(D){l=!1}return d&&d.terminate(),URL.revokeObjectURL(M),l}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var l=document.createElement("canvas");l.width=l.height=1;var d=l.getContext("2d");if(!d)return!1;var x=d.getImageData(0,0,1,1);return x&&x.width===l.width}()?(void 0===I[f=j&&j.failIfMajorPerformanceCaveat]&&(I[f]=function(l){var M,D,B,d=(M=l,D=document.createElement("canvas"),(B=Object.create(w.webGLContextAttributes)).failIfMajorPerformanceCaveat=M,D.probablySupportsContext?D.probablySupportsContext("webgl",B)||D.probablySupportsContext("experimental-webgl",B):D.supportsContext?D.supportsContext("webgl",B)||D.supportsContext("experimental-webgl",B):D.getContext("webgl",B)||D.getContext("experimental-webgl",B));if(!d)return!1;var x=d.createShader(d.VERTEX_SHADER);return!(!x||d.isContextLost())&&(d.shaderSource(x,"void main() {}"),d.compileShader(x),!0===d.getShaderParameter(x,d.COMPILE_STATUS))}(f)),I[f]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var f}v.exports?v.exports=w:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=w,window.mapboxgl.notSupportedReason=_);var I={};w.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),ut={create:function(v,w,_){var I=L.window.document.createElement(v);return void 0!==w&&(I.className=w),_&&_.appendChild(I),I},createNS:function(v,w){return L.window.document.createElementNS(v,w)}},tn=L.window.document&&L.window.document.documentElement.style;function Et(v){if(!tn)return v[0];for(var w=0;w<v.length;w++)if(v[w]in tn)return v[w];return v[0]}var it,Ge=Et(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);ut.disableDrag=function(){tn&&Ge&&(it=tn[Ge],tn[Ge]="none")},ut.enableDrag=function(){tn&&Ge&&(tn[Ge]=it)};var Ke=Et(["transform","WebkitTransform"]);ut.setTransform=function(v,w){v.style[Ke]=w};var Wt=!1;try{var on=Object.defineProperty({},"passive",{get:function(){Wt=!0}});L.window.addEventListener("test",on,on),L.window.removeEventListener("test",on,on)}catch(v){Wt=!1}ut.addEventListener=function(v,w,_,I){void 0===I&&(I={}),v.addEventListener(w,_,"passive"in I&&Wt?I:I.capture)},ut.removeEventListener=function(v,w,_,I){void 0===I&&(I={}),v.removeEventListener(w,_,"passive"in I&&Wt?I:I.capture)};var Cn=function(v){v.preventDefault(),v.stopPropagation(),L.window.removeEventListener("click",Cn,!0)};function fn(v){var w=v.userImage;return!!(w&&w.render&&w.render())&&(v.data.replace(new Uint8Array(w.data.buffer)),!0)}ut.suppressClick=function(){L.window.addEventListener("click",Cn,!0),L.window.setTimeout(function(){L.window.removeEventListener("click",Cn,!0)},0)},ut.mousePos=function(v,w){var _=v.getBoundingClientRect();return new L.Point(w.clientX-_.left-v.clientLeft,w.clientY-_.top-v.clientTop)},ut.touchPos=function(v,w){for(var _=v.getBoundingClientRect(),I=[],j=0;j<w.length;j++)I.push(new L.Point(w[j].clientX-_.left-v.clientLeft,w[j].clientY-_.top-v.clientTop));return I},ut.mouseButton=function(v){return void 0!==L.window.InstallTrigger&&2===v.button&&v.ctrlKey&&L.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:v.button},ut.remove=function(v){v.parentNode&&v.parentNode.removeChild(v)};var et=function(v){function w(){v.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new L.RGBAImage({width:1,height:1}),this.dirty=!0}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.isLoaded=function(){return this.loaded},w.prototype.setLoaded=function(_){if(this.loaded!==_&&(this.loaded=_,_)){for(var I=0,j=this.requestors;I<j.length;I+=1){var f=j[I];this._notify(f.ids,f.callback)}this.requestors=[]}},w.prototype.getImage=function(_){return this.images[_]},w.prototype.addImage=function(_,I){this._validate(_,I)&&(this.images[_]=I)},w.prototype._validate=function(_,I){var j=!0;return this._validateStretch(I.stretchX,I.data&&I.data.width)||(this.fire(new L.ErrorEvent(new Error('Image "'+_+'" has invalid "stretchX" value'))),j=!1),this._validateStretch(I.stretchY,I.data&&I.data.height)||(this.fire(new L.ErrorEvent(new Error('Image "'+_+'" has invalid "stretchY" value'))),j=!1),this._validateContent(I.content,I)||(this.fire(new L.ErrorEvent(new Error('Image "'+_+'" has invalid "content" value'))),j=!1),j},w.prototype._validateStretch=function(_,I){if(!_)return!0;for(var j=0,f=0,l=_;f<l.length;f+=1){var d=l[f];if(d[0]<j||d[1]<d[0]||I<d[1])return!1;j=d[1]}return!0},w.prototype._validateContent=function(_,I){return!(_&&(4!==_.length||_[0]<0||I.data.width<_[0]||_[1]<0||I.data.height<_[1]||_[2]<0||I.data.width<_[2]||_[3]<0||I.data.height<_[3]||_[2]<_[0]||_[3]<_[1]))},w.prototype.updateImage=function(_,I){I.version=this.images[_].version+1,this.images[_]=I,this.updatedImages[_]=!0},w.prototype.removeImage=function(_){var I=this.images[_];delete this.images[_],delete this.patterns[_],I.userImage&&I.userImage.onRemove&&I.userImage.onRemove()},w.prototype.listImages=function(){return Object.keys(this.images)},w.prototype.getImages=function(_,I){var j=!0;if(!this.isLoaded())for(var f=0,l=_;f<l.length;f+=1)this.images[l[f]]||(j=!1);this.isLoaded()||j?this._notify(_,I):this.requestors.push({ids:_,callback:I})},w.prototype._notify=function(_,I){for(var j={},f=0,l=_;f<l.length;f+=1){var d=l[f];this.images[d]||this.fire(new L.Event("styleimagemissing",{id:d}));var x=this.images[d];x?j[d]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:Boolean(x.userImage&&x.userImage.render)}:L.warnOnce('Image "'+d+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}I(null,j)},w.prototype.getPixelSize=function(){var _=this.atlasImage;return{width:_.width,height:_.height}},w.prototype.getPattern=function(_){var I=this.patterns[_],j=this.getImage(_);if(!j)return null;if(I&&I.position.version===j.version)return I.position;if(I)I.position.version=j.version;else{var f={w:j.data.width+2,h:j.data.height+2,x:0,y:0},l=new L.ImagePosition(f,j);this.patterns[_]={bin:f,position:l}}return this._updatePatternAtlas(),this.patterns[_].position},w.prototype.bind=function(_){var I=_.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new L.Texture(_,this.atlasImage,I.RGBA),this.atlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE)},w.prototype._updatePatternAtlas=function(){var _=[];for(var I in this.patterns)_.push(this.patterns[I].bin);var j=L.potpack(_),f=j.w,l=j.h,d=this.atlasImage;for(var x in d.resize({width:f||1,height:l||1}),this.patterns){var M=this.patterns[x].bin,D=M.x+1,B=M.y+1,G=this.images[x].data,W=G.width,Y=G.height;L.RGBAImage.copy(G,d,{x:0,y:0},{x:D,y:B},{width:W,height:Y}),L.RGBAImage.copy(G,d,{x:0,y:Y-1},{x:D,y:B-1},{width:W,height:1}),L.RGBAImage.copy(G,d,{x:0,y:0},{x:D,y:B+Y},{width:W,height:1}),L.RGBAImage.copy(G,d,{x:W-1,y:0},{x:D-1,y:B},{width:1,height:Y}),L.RGBAImage.copy(G,d,{x:0,y:0},{x:D+W,y:B},{width:1,height:Y})}this.dirty=!0},w.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},w.prototype.dispatchRenderCallbacks=function(_){for(var I=0,j=_;I<j.length;I+=1){var f=j[I];if(!this.callbackDispatchedThisFrame[f]){this.callbackDispatchedThisFrame[f]=!0;var l=this.images[f];fn(l)&&this.updateImage(f,l)}}},w}(L.Evented),_t=Pn,Dt=Pn,bn=1e20;function Pn(v,w,_,I,j,f){this.fontSize=v||24,this.buffer=void 0===w?3:w,this.cutoff=I||.25,this.fontFamily=j||"sans-serif",this.fontWeight=f||"normal",this.radius=_||8;var l=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=l,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.d=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Int16Array(l),this.middle=Math.round(l/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function an(v,w,_,I,j,f,l){for(var d=0;d<w;d++){for(var x=0;x<_;x++)I[x]=v[x*w+d];for(Rn(I,j,f,l,_),x=0;x<_;x++)v[x*w+d]=j[x]}for(x=0;x<_;x++){for(d=0;d<w;d++)I[d]=v[x*w+d];for(Rn(I,j,f,l,w),d=0;d<w;d++)v[x*w+d]=Math.sqrt(j[d])}}function Rn(v,w,_,I,j){_[0]=0,I[0]=-bn,I[1]=+bn;for(var f=1,l=0;f<j;f++){for(var d=(v[f]+f*f-(v[_[l]]+_[l]*_[l]))/(2*f-2*_[l]);d<=I[l];)l--,d=(v[f]+f*f-(v[_[l]]+_[l]*_[l]))/(2*f-2*_[l]);_[++l]=f,I[l]=d,I[l+1]=+bn}for(f=0,l=0;f<j;f++){for(;I[l+1]<f;)l++;w[f]=(f-_[l])*(f-_[l])+v[_[l]]}}Pn.prototype.draw=function(v){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(v,this.buffer,this.middle);for(var w=this.ctx.getImageData(0,0,this.size,this.size),_=new Uint8ClampedArray(this.size*this.size),I=0;I<this.size*this.size;I++){var j=w.data[4*I+3]/255;this.gridOuter[I]=1===j?0:0===j?bn:Math.pow(Math.max(0,.5-j),2),this.gridInner[I]=1===j?bn:0===j?0:Math.pow(Math.max(0,j-.5),2)}for(an(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),an(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),I=0;I<this.size*this.size;I++)_[I]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[I]-this.gridInner[I])/this.radius+this.cutoff))));return _},_t.default=Dt;var nr=function(v,w){this.requestManager=v,this.localIdeographFontFamily=w,this.entries={}};nr.prototype.setURL=function(v){this.url=v},nr.prototype.getGlyphs=function(v,w){var _=this,I=[];for(var j in v)for(var f=0,l=v[j];f<l.length;f+=1)I.push({stack:j,id:l[f]});L.asyncAll(I,function(d,x){var M=d.stack,D=d.id,B=_.entries[M];B||(B=_.entries[M]={glyphs:{},requests:{},ranges:{}});var G=B.glyphs[D];if(void 0===G){if(G=_._tinySDF(B,M,D))return B.glyphs[D]=G,void x(null,{stack:M,id:D,glyph:G});var W=Math.floor(D/256);if(256*W>65535)x(new Error("glyphs > 65535 not supported"));else if(B.ranges[W])x(null,{stack:M,id:D,glyph:G});else{var Y=B.requests[W];Y||(Y=B.requests[W]=[],nr.loadGlyphRange(M,W,_.url,_.requestManager,function(ee,Q){if(Q){for(var le in Q)_._doesCharSupportLocalGlyph(+le)||(B.glyphs[+le]=Q[+le]);B.ranges[W]=!0}for(var de=0,ge=Y;de<ge.length;de+=1)(0,ge[de])(ee,Q);delete B.requests[W]})),Y.push(function(ee,Q){ee?x(ee):Q&&x(null,{stack:M,id:D,glyph:Q[D]||null})})}}else x(null,{stack:M,id:D,glyph:G})},function(d,x){if(d)w(d);else if(x){for(var M={},D=0,B=x;D<B.length;D+=1){var G=B[D],W=G.stack,Y=G.id,ee=G.glyph;(M[W]||(M[W]={}))[Y]=ee&&{id:ee.id,bitmap:ee.bitmap.clone(),metrics:ee.metrics}}w(null,M)}})},nr.prototype._doesCharSupportLocalGlyph=function(v){return!!this.localIdeographFontFamily&&(L.isChar["CJK Unified Ideographs"](v)||L.isChar["Hangul Syllables"](v)||L.isChar.Hiragana(v)||L.isChar.Katakana(v))},nr.prototype._tinySDF=function(v,w,_){var I=this.localIdeographFontFamily;if(I&&this._doesCharSupportLocalGlyph(_)){var j=v.tinySDF;if(!j){var f="400";/bold/i.test(w)?f="900":/medium/i.test(w)?f="500":/light/i.test(w)&&(f="200"),j=v.tinySDF=new nr.TinySDF(24,3,8,.25,I,f)}return{id:_,bitmap:new L.AlphaImage({width:30,height:30},j.draw(String.fromCharCode(_))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},nr.loadGlyphRange=function(v,w,_,I,j){var f=256*w,l=f+255,d=I.transformRequest(I.normalizeGlyphsURL(_).replace("{fontstack}",v).replace("{range}",f+"-"+l),L.ResourceType.Glyphs);L.getArrayBuffer(d,function(x,M){if(x)j(x);else if(M){for(var D={},B=0,G=L.parseGlyphPBF(M);B<G.length;B+=1){var W=G[B];D[W.id]=W}j(null,D)}})},nr.TinySDF=_t;var dr=function(){this.specification=L.styleSpec.light.position};dr.prototype.possiblyEvaluate=function(v,w){return L.sphericalToCartesian(v.expression.evaluate(w))},dr.prototype.interpolate=function(v,w,_){return{x:L.number(v.x,w.x,_),y:L.number(v.y,w.y,_),z:L.number(v.z,w.z,_)}};var jn=new L.Properties({anchor:new L.DataConstantProperty(L.styleSpec.light.anchor),position:new dr,color:new L.DataConstantProperty(L.styleSpec.light.color),intensity:new L.DataConstantProperty(L.styleSpec.light.intensity)}),pn=function(v){function w(_){v.call(this),this._transitionable=new L.Transitionable(jn),this.setLight(_),this._transitioning=this._transitionable.untransitioned()}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getLight=function(){return this._transitionable.serialize()},w.prototype.setLight=function(_,I){if(void 0===I&&(I={}),!this._validate(L.validateLight,_,I))for(var j in _){var f=_[j];L.endsWith(j,"-transition")?this._transitionable.setTransition(j.slice(0,-"-transition".length),f):this._transitionable.setValue(j,f)}},w.prototype.updateTransitions=function(_){this._transitioning=this._transitionable.transitioned(_,this._transitioning)},w.prototype.hasTransition=function(){return this._transitioning.hasTransition()},w.prototype.recalculate=function(_){this.properties=this._transitioning.possiblyEvaluate(_)},w.prototype._validate=function(_,I,j){return(!j||!1!==j.validate)&&L.emitValidationErrors(this,_.call(L.validateStyle,L.extend({value:I,style:{glyphs:!0,sprite:!0},styleSpec:L.styleSpec})))},w}(L.Evented),sr=function(v,w){this.width=v,this.height=w,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};sr.prototype.getDash=function(v,w){var _=v.join(",")+String(w);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(v,w)),this.dashEntry[_]},sr.prototype.getDashRanges=function(v,w,_){var I=[],j=v.length%2==1?-v[v.length-1]*_:0,f=v[0]*_,l=!0;I.push({left:j,right:f,isDash:l,zeroLength:0===v[0]});for(var d=v[0],x=1;x<v.length;x++){var M=v[x];I.push({left:j=d*_,right:f=(d+=M)*_,isDash:l=!l,zeroLength:0===M})}return I},sr.prototype.addRoundDash=function(v,w,_){for(var I=w/2,j=-_;j<=_;j++)for(var f=this.width*(this.nextRow+_+j),l=0,d=v[l],x=0;x<this.width;x++){x/d.right>1&&(d=v[++l]);var M=Math.abs(x-d.left),D=Math.abs(x-d.right),B=Math.min(M,D),G=void 0,W=j/_*(I+1);if(d.isDash){var Y=I-Math.abs(W);G=Math.sqrt(B*B+Y*Y)}else G=I-Math.sqrt(B*B+W*W);this.data[f+x]=Math.max(0,Math.min(255,G+128))}},sr.prototype.addRegularDash=function(v){for(var w=v.length-1;w>=0;--w){var _=v[w],I=v[w+1];_.zeroLength?v.splice(w,1):I&&I.isDash===_.isDash&&(I.left=_.left,v.splice(w,1))}var j=v[0],f=v[v.length-1];j.isDash===f.isDash&&(j.left=f.left-this.width,f.right=j.right+this.width);for(var l=this.width*this.nextRow,d=0,x=v[d],M=0;M<this.width;M++){M/x.right>1&&(x=v[++d]);var D=Math.abs(M-x.left),B=Math.abs(M-x.right),G=Math.min(D,B);this.data[l+M]=Math.max(0,Math.min(255,(x.isDash?G:-G)+128))}},sr.prototype.addDash=function(v,w){var _=w?7:0,I=2*_+1;if(this.nextRow+I>this.height)return L.warnOnce("LineAtlas out of space"),null;for(var j=0,f=0;f<v.length;f++)j+=v[f];if(0!==j){var l=this.width/j,d=this.getDashRanges(v,this.width,l);w?this.addRoundDash(d,l,_):this.addRegularDash(d)}var x={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:j};return this.nextRow+=I,this.dirty=!0,x},sr.prototype.bind=function(v){var w=v.gl;this.texture?(w.bindTexture(w.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,w.texSubImage2D(w.TEXTURE_2D,0,0,0,this.width,this.height,w.ALPHA,w.UNSIGNED_BYTE,this.data))):(this.texture=w.createTexture(),w.bindTexture(w.TEXTURE_2D,this.texture),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.REPEAT),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.REPEAT),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.LINEAR),w.texImage2D(w.TEXTURE_2D,0,w.ALPHA,this.width,this.height,0,w.ALPHA,w.UNSIGNED_BYTE,this.data))};var qr=function v(w,_){this.workerPool=w,this.actors=[],this.currentActor=0,this.id=L.uniqueId();for(var I=this.workerPool.acquire(this.id),j=0;j<I.length;j++){var f=new v.Actor(I[j],_,this.id);f.name="Worker "+j,this.actors.push(f)}};function Es(v,w,_){var I=function(j,f){if(j)return _(j);if(f){var l=L.pick(L.extend(f,v),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);f.vector_layers&&(l.vectorLayers=f.vector_layers,l.vectorLayerIds=l.vectorLayers.map(function(d){return d.id})),l.tiles=w.canonicalizeTileset(l,v.url),_(null,l)}};return v.url?L.getJSON(w.transformRequest(w.normalizeSourceURL(v.url),L.ResourceType.Source),I):L.browser.frame(function(){return I(null,v)})}qr.prototype.broadcast=function(v,w,_){L.asyncAll(this.actors,function(I,j){I.send(v,w,j)},_=_||function(){})},qr.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},qr.prototype.remove=function(){this.actors.forEach(function(v){v.remove()}),this.actors=[],this.workerPool.release(this.id)},qr.Actor=L.Actor;var je=function(v,w,_){this.bounds=L.LngLatBounds.convert(this.validateBounds(v)),this.minzoom=w||0,this.maxzoom=_||24};je.prototype.validateBounds=function(v){return Array.isArray(v)&&4===v.length?[Math.max(-180,v[0]),Math.max(-90,v[1]),Math.min(180,v[2]),Math.min(90,v[3])]:[-180,-90,180,90]},je.prototype.contains=function(v){var w=Math.pow(2,v.z),_=Math.floor(L.mercatorXfromLng(this.bounds.getWest())*w),I=Math.floor(L.mercatorYfromLat(this.bounds.getNorth())*w),j=Math.ceil(L.mercatorXfromLng(this.bounds.getEast())*w),f=Math.ceil(L.mercatorYfromLat(this.bounds.getSouth())*w);return v.x>=_&&v.x<j&&v.y>=I&&v.y<f};var ct=function(v){function w(_,I,j,f){if(v.call(this),this.id=_,this.dispatcher=j,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,L.extend(this,L.pick(I,["url","scheme","tileSize","promoteId"])),this._options=L.extend({type:"vector"},I),this._collectResourceTiming=I.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.load=function(){var _=this;this._loaded=!1,this.fire(new L.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Es(this._options,this.map._requestManager,function(I,j){_._tileJSONRequest=null,_._loaded=!0,I?_.fire(new L.ErrorEvent(I)):j&&(L.extend(_,j),j.bounds&&(_.tileBounds=new je(j.bounds,_.minzoom,_.maxzoom)),L.postTurnstileEvent(j.tiles,_.map._requestManager._customAccessToken),L.postMapLoadEvent(j.tiles,_.map._getMapId(),_.map._requestManager._skuToken,_.map._requestManager._customAccessToken),_.fire(new L.Event("data",{dataType:"source",sourceDataType:"metadata"})),_.fire(new L.Event("data",{dataType:"source",sourceDataType:"content"})))})},w.prototype.loaded=function(){return this._loaded},w.prototype.hasTile=function(_){return!this.tileBounds||this.tileBounds.contains(_.canonical)},w.prototype.onAdd=function(_){this.map=_,this.load()},w.prototype.setSourceProperty=function(_){this._tileJSONRequest&&this._tileJSONRequest.cancel(),_(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},w.prototype.setTiles=function(_){var I=this;return this.setSourceProperty(function(){I._options.tiles=_}),this},w.prototype.setUrl=function(_){var I=this;return this.setSourceProperty(function(){I.url=_,I._options.url=_}),this},w.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},w.prototype.serialize=function(){return L.extend({},this._options)},w.prototype.loadTile=function(_,I){var j=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(j,L.ResourceType.Tile),uid:_.uid,tileID:_.tileID,zoom:_.tileID.overscaledZ,tileSize:this.tileSize*_.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:L.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function l(d,x){return delete _.request,_.aborted?I(null):d&&404!==d.status?I(d):(x&&x.resourceTiming&&(_.resourceTiming=x.resourceTiming),this.map._refreshExpiredTiles&&x&&_.setExpiryData(x),_.loadVectorData(x,this.map.painter),L.cacheEntryPossiblyAdded(this.dispatcher),I(null),void(_.reloadCallback&&(this.loadTile(_,_.reloadCallback),_.reloadCallback=null)))}f.request.collectResourceTiming=this._collectResourceTiming,_.actor&&"expired"!==_.state?"loading"===_.state?_.reloadCallback=I:_.request=_.actor.send("reloadTile",f,l.bind(this)):(_.actor=this.dispatcher.getActor(),_.request=_.actor.send("loadTile",f,l.bind(this)))},w.prototype.abortTile=function(_){_.request&&(_.request.cancel(),delete _.request),_.actor&&_.actor.send("abortTile",{uid:_.uid,type:this.type,source:this.id},void 0)},w.prototype.unloadTile=function(_){_.unloadVectorData(),_.actor&&_.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id},void 0)},w.prototype.hasTransition=function(){return!1},w}(L.Evented),Vt=function(v){function w(_,I,j,f){v.call(this),this.id=_,this.dispatcher=j,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=L.extend({type:"raster"},I),L.extend(this,L.pick(I,["url","scheme","tileSize"]))}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.load=function(){var _=this;this._loaded=!1,this.fire(new L.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Es(this._options,this.map._requestManager,function(I,j){_._tileJSONRequest=null,_._loaded=!0,I?_.fire(new L.ErrorEvent(I)):j&&(L.extend(_,j),j.bounds&&(_.tileBounds=new je(j.bounds,_.minzoom,_.maxzoom)),L.postTurnstileEvent(j.tiles),L.postMapLoadEvent(j.tiles,_.map._getMapId(),_.map._requestManager._skuToken),_.fire(new L.Event("data",{dataType:"source",sourceDataType:"metadata"})),_.fire(new L.Event("data",{dataType:"source",sourceDataType:"content"})))})},w.prototype.loaded=function(){return this._loaded},w.prototype.onAdd=function(_){this.map=_,this.load()},w.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},w.prototype.serialize=function(){return L.extend({},this._options)},w.prototype.hasTile=function(_){return!this.tileBounds||this.tileBounds.contains(_.canonical)},w.prototype.loadTile=function(_,I){var j=this,f=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);_.request=L.getImage(this.map._requestManager.transformRequest(f,L.ResourceType.Tile),function(l,d){if(delete _.request,_.aborted)_.state="unloaded",I(null);else if(l)_.state="errored",I(l);else if(d){j.map._refreshExpiredTiles&&_.setExpiryData(d),delete d.cacheControl,delete d.expires;var x=j.map.painter.context,M=x.gl;_.texture=j.map.painter.getTileTexture(d.width),_.texture?_.texture.update(d,{useMipmap:!0}):(_.texture=new L.Texture(x,d,M.RGBA,{useMipmap:!0}),_.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),x.extTextureFilterAnisotropic&&M.texParameterf(M.TEXTURE_2D,x.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,x.extTextureFilterAnisotropicMax)),_.state="loaded",L.cacheEntryPossiblyAdded(j.dispatcher),I(null)}})},w.prototype.abortTile=function(_,I){_.request&&(_.request.cancel(),delete _.request),I()},w.prototype.unloadTile=function(_,I){_.texture&&this.map.painter.saveTileTexture(_.texture),I()},w.prototype.hasTransition=function(){return!1},w}(L.Evented),Pr=function(v){function w(_,I,j,f){v.call(this,_,I,j,f),this.type="raster-dem",this.maxzoom=22,this._options=L.extend({type:"raster-dem"},I),this.encoding=I.encoding||"mapbox"}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},w.prototype.loadTile=function(_,I){var j=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function f(l,d){l&&(_.state="errored",I(l)),d&&(_.dem=d,_.needsHillshadePrepare=!0,_.state="loaded",I(null))}_.request=L.getImage(this.map._requestManager.transformRequest(j,L.ResourceType.Tile),function(l,d){if(delete _.request,_.aborted)_.state="unloaded",I(null);else if(l)_.state="errored",I(l);else if(d){this.map._refreshExpiredTiles&&_.setExpiryData(d),delete d.cacheControl,delete d.expires;var x=L.window.ImageBitmap&&d instanceof L.window.ImageBitmap&&L.offscreenCanvasSupported()?d:L.browser.getImageData(d,1),M={uid:_.uid,coord:_.tileID,source:this.id,rawImageData:x,encoding:this.encoding};_.actor&&"expired"!==_.state||(_.actor=this.dispatcher.getActor(),_.actor.send("loadDEMTile",M,f.bind(this)))}}.bind(this)),_.neighboringTiles=this._getNeighboringTiles(_.tileID)},w.prototype._getNeighboringTiles=function(_){var I=_.canonical,j=Math.pow(2,I.z),f=(I.x-1+j)%j,l=0===I.x?_.wrap-1:_.wrap,d=(I.x+1+j)%j,x=I.x+1===j?_.wrap+1:_.wrap,M={};return M[new L.OverscaledTileID(_.overscaledZ,l,I.z,f,I.y).key]={backfilled:!1},M[new L.OverscaledTileID(_.overscaledZ,x,I.z,d,I.y).key]={backfilled:!1},I.y>0&&(M[new L.OverscaledTileID(_.overscaledZ,l,I.z,f,I.y-1).key]={backfilled:!1},M[new L.OverscaledTileID(_.overscaledZ,_.wrap,I.z,I.x,I.y-1).key]={backfilled:!1},M[new L.OverscaledTileID(_.overscaledZ,x,I.z,d,I.y-1).key]={backfilled:!1}),I.y+1<j&&(M[new L.OverscaledTileID(_.overscaledZ,l,I.z,f,I.y+1).key]={backfilled:!1},M[new L.OverscaledTileID(_.overscaledZ,_.wrap,I.z,I.x,I.y+1).key]={backfilled:!1},M[new L.OverscaledTileID(_.overscaledZ,x,I.z,d,I.y+1).key]={backfilled:!1}),M},w.prototype.unloadTile=function(_){_.demTexture&&this.map.painter.saveTileTexture(_.demTexture),_.fbo&&(_.fbo.destroy(),delete _.fbo),_.dem&&delete _.dem,delete _.neighboringTiles,_.state="unloaded",_.actor&&_.actor.send("removeDEMTile",{uid:_.uid,source:this.id})},w}(Vt),fr=function(v){function w(_,I,j,f){v.call(this),this.id=_,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=j.getActor(),this.setEventedParent(f),this._data=I.data,this._options=L.extend({},I),this._collectResourceTiming=I.collectResourceTiming,this._resourceTiming=[],void 0!==I.maxzoom&&(this.maxzoom=I.maxzoom),I.type&&(this.type=I.type),I.attribution&&(this.attribution=I.attribution),this.promoteId=I.promoteId;var l=L.EXTENT/this.tileSize;this.workerOptions=L.extend({source:this.id,cluster:I.cluster||!1,geojsonVtOptions:{buffer:(void 0!==I.buffer?I.buffer:128)*l,tolerance:(void 0!==I.tolerance?I.tolerance:.375)*l,extent:L.EXTENT,maxZoom:this.maxzoom,lineMetrics:I.lineMetrics||!1,generateId:I.generateId||!1},superclusterOptions:{maxZoom:void 0!==I.clusterMaxZoom?Math.min(I.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,I.clusterMinPoints||2),extent:L.EXTENT,radius:(I.clusterRadius||50)*l,log:!1,generateId:I.generateId||!1},clusterProperties:I.clusterProperties,filter:I.filter},I.workerOptions)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.load=function(){var _=this;this.fire(new L.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(I){if(I)_.fire(new L.ErrorEvent(I));else{var j={dataType:"source",sourceDataType:"metadata"};_._collectResourceTiming&&_._resourceTiming&&_._resourceTiming.length>0&&(j.resourceTiming=_._resourceTiming,_._resourceTiming=[]),_.fire(new L.Event("data",j))}})},w.prototype.onAdd=function(_){this.map=_,this.load()},w.prototype.setData=function(_){var I=this;return this._data=_,this.fire(new L.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(j){if(j)I.fire(new L.ErrorEvent(j));else{var f={dataType:"source",sourceDataType:"content"};I._collectResourceTiming&&I._resourceTiming&&I._resourceTiming.length>0&&(f.resourceTiming=I._resourceTiming,I._resourceTiming=[]),I.fire(new L.Event("data",f))}}),this},w.prototype.getClusterExpansionZoom=function(_,I){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:_,source:this.id},I),this},w.prototype.getClusterChildren=function(_,I){return this.actor.send("geojson.getClusterChildren",{clusterId:_,source:this.id},I),this},w.prototype.getClusterLeaves=function(_,I,j,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:_,limit:I,offset:j},f),this},w.prototype._updateWorkerData=function(_){var I=this;this._loaded=!1;var j=L.extend({},this.workerOptions),f=this._data;"string"==typeof f?(j.request=this.map._requestManager.transformRequest(L.browser.resolveURL(f),L.ResourceType.Source),j.request.collectResourceTiming=this._collectResourceTiming):j.data=JSON.stringify(f),this.actor.send(this.type+".loadData",j,function(l,d){I._removed||d&&d.abandoned||(I._loaded=!0,d&&d.resourceTiming&&d.resourceTiming[I.id]&&(I._resourceTiming=d.resourceTiming[I.id].slice(0)),I.actor.send(I.type+".coalesce",{source:j.source},null),_(l))})},w.prototype.loaded=function(){return this._loaded},w.prototype.loadTile=function(_,I){var j=this,f=_.actor?"reloadTile":"loadTile";_.actor=this.actor,_.request=this.actor.send(f,{type:this.type,uid:_.uid,tileID:_.tileID,zoom:_.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:L.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(l,d){return delete _.request,_.unloadVectorData(),_.aborted?I(null):l?I(l):(_.loadVectorData(d,j.map.painter,"reloadTile"===f),I(null))})},w.prototype.abortTile=function(_){_.request&&(_.request.cancel(),delete _.request),_.aborted=!0},w.prototype.unloadTile=function(_){_.unloadVectorData(),this.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id})},w.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},w.prototype.serialize=function(){return L.extend({},this._options,{type:this.type,data:this._data})},w.prototype.hasTransition=function(){return!1},w}(L.Evented),vr=L.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Er=function(v){function w(_,I,j,f){v.call(this),this.id=_,this.dispatcher=j,this.coordinates=I.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=I}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.load=function(_,I){var j=this;this._loaded=!1,this.fire(new L.Event("dataloading",{dataType:"source"})),this.url=this.options.url,L.getImage(this.map._requestManager.transformRequest(this.url,L.ResourceType.Image),function(f,l){j._loaded=!0,f?j.fire(new L.ErrorEvent(f)):l&&(j.image=l,_&&(j.coordinates=_),I&&I(),j._finishLoading())})},w.prototype.loaded=function(){return this._loaded},w.prototype.updateImage=function(_){var I=this;return this.image&&_.url?(this.options.url=_.url,this.load(_.coordinates,function(){I.texture=null}),this):this},w.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new L.Event("data",{dataType:"source",sourceDataType:"metadata"})))},w.prototype.onAdd=function(_){this.map=_,this.load()},w.prototype.setCoordinates=function(_){var I=this;this.coordinates=_;var j=_.map(L.MercatorCoordinate.fromLngLat);this.tileID=function(l){for(var d=1/0,x=1/0,M=-1/0,D=-1/0,B=0,G=l;B<G.length;B+=1){var W=G[B];d=Math.min(d,W.x),x=Math.min(x,W.y),M=Math.max(M,W.x),D=Math.max(D,W.y)}var Y=Math.max(M-d,D-x),ee=Math.max(0,Math.floor(-Math.log(Y)/Math.LN2)),Q=Math.pow(2,ee);return new L.CanonicalTileID(ee,Math.floor((d+M)/2*Q),Math.floor((x+D)/2*Q))}(j),this.minzoom=this.maxzoom=this.tileID.z;var f=j.map(function(l){return I.tileID.getTilePoint(l)._round()});return this._boundsArray=new L.StructArrayLayout4i8,this._boundsArray.emplaceBack(f[0].x,f[0].y,0,0),this._boundsArray.emplaceBack(f[1].x,f[1].y,L.EXTENT,0),this._boundsArray.emplaceBack(f[3].x,f[3].y,0,L.EXTENT),this._boundsArray.emplaceBack(f[2].x,f[2].y,L.EXTENT,L.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new L.Event("data",{dataType:"source",sourceDataType:"content"})),this},w.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var _=this.map.painter.context,I=_.gl;for(var j in this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,vr.members)),this.boundsSegments||(this.boundsSegments=L.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new L.Texture(_,this.image,I.RGBA),this.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE)),this.tiles){var f=this.tiles[j];"loaded"!==f.state&&(f.state="loaded",f.texture=this.texture)}}},w.prototype.loadTile=function(_,I){this.tileID&&this.tileID.equals(_.tileID.canonical)?(this.tiles[String(_.tileID.wrap)]=_,_.buckets={},I(null)):(_.state="errored",I(null))},w.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},w.prototype.hasTransition=function(){return!1},w}(L.Evented),Ui=function(v){function w(_,I,j,f){v.call(this,_,I,j,f),this.roundZoom=!0,this.type="video",this.options=I}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.load=function(){var _=this;this._loaded=!1;var I=this.options;this.urls=[];for(var j=0,f=I.urls;j<f.length;j+=1)this.urls.push(this.map._requestManager.transformRequest(f[j],L.ResourceType.Source).url);L.getVideo(this.urls,function(l,d){_._loaded=!0,l?_.fire(new L.ErrorEvent(l)):d&&(_.video=d,_.video.loop=!0,_.video.addEventListener("playing",function(){_.map.triggerRepaint()}),_.map&&_.video.play(),_._finishLoading())})},w.prototype.pause=function(){this.video&&this.video.pause()},w.prototype.play=function(){this.video&&this.video.play()},w.prototype.seek=function(_){if(this.video){var I=this.video.seekable;_<I.start(0)||_>I.end(0)?this.fire(new L.ErrorEvent(new L.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+I.start(0)+" and "+I.end(0)+"-second mark."))):this.video.currentTime=_}},w.prototype.getVideo=function(){return this.video},w.prototype.onAdd=function(_){this.map||(this.map=_,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},w.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var _=this.map.painter.context,I=_.gl;for(var j in this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,vr.members)),this.boundsSegments||(this.boundsSegments=L.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE),I.texSubImage2D(I.TEXTURE_2D,0,0,0,I.RGBA,I.UNSIGNED_BYTE,this.video)):(this.texture=new L.Texture(_,this.video,I.RGBA),this.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE)),this.tiles){var f=this.tiles[j];"loaded"!==f.state&&(f.state="loaded",f.texture=this.texture)}}},w.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},w.prototype.hasTransition=function(){return this.video&&!this.video.paused},w}(Er),Wo=function(v){function w(_,I,j,f){v.call(this,_,I,j,f),I.coordinates?Array.isArray(I.coordinates)&&4===I.coordinates.length&&!I.coordinates.some(function(l){return!Array.isArray(l)||2!==l.length||l.some(function(d){return"number"!=typeof d})})||this.fire(new L.ErrorEvent(new L.ValidationError("sources."+_,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new L.ErrorEvent(new L.ValidationError("sources."+_,null,'missing required property "coordinates"'))),I.animate&&"boolean"!=typeof I.animate&&this.fire(new L.ErrorEvent(new L.ValidationError("sources."+_,null,'optional "animate" property must be a boolean value'))),I.canvas?"string"==typeof I.canvas||I.canvas instanceof L.window.HTMLCanvasElement||this.fire(new L.ErrorEvent(new L.ValidationError("sources."+_,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new L.ErrorEvent(new L.ValidationError("sources."+_,null,'missing required property "canvas"'))),this.options=I,this.animate=void 0===I.animate||I.animate}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof L.window.HTMLCanvasElement?this.options.canvas:L.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new L.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},w.prototype.getCanvas=function(){return this.canvas},w.prototype.onAdd=function(_){this.map=_,this.load(),this.canvas&&this.animate&&this.play()},w.prototype.onRemove=function(){this.pause()},w.prototype.prepare=function(){var _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var I=this.map.painter.context,j=I.gl;for(var f in this.boundsBuffer||(this.boundsBuffer=I.createVertexBuffer(this._boundsArray,vr.members)),this.boundsSegments||(this.boundsSegments=L.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(_||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new L.Texture(I,this.canvas,j.RGBA,{premultiply:!0}),this.tiles){var l=this.tiles[f];"loaded"!==l.state&&(l.state="loaded",l.texture=this.texture)}}},w.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},w.prototype.hasTransition=function(){return this._playing},w.prototype._hasInvalidDimensions=function(){for(var _=0,I=[this.canvas.width,this.canvas.height];_<I.length;_+=1){var j=I[_];if(isNaN(j)||j<=0)return!0}return!1},w}(Er),Xi={vector:ct,raster:Vt,"raster-dem":Pr,geojson:fr,video:Ui,image:Er,canvas:Wo};function Vi(v,w){var _=L.identity([]);return L.translate(_,_,[1,1,0]),L.scale(_,_,[.5*v.width,.5*v.height,1]),L.multiply(_,_,v.calculatePosMatrix(w.toUnwrapped()))}function Zr(v,w,_,I,j,f){var l=function(ee,Q,le){if(ee)for(var de=0,ge=ee;de<ge.length;de+=1){var xe=Q[ge[de]];if(xe&&xe.source===le&&"fill-extrusion"===xe.type)return!0}else for(var Te in Q){var Ee=Q[Te];if(Ee.source===le&&"fill-extrusion"===Ee.type)return!0}return!1}(j&&j.layers,w,v.id),d=f.maxPitchScaleFactor(),x=v.tilesIn(I,d,l);x.sort(gl);for(var M=[],D=0,B=x;D<B.length;D+=1){var G=B[D];M.push({wrappedTileID:G.tileID.wrapped().key,queryResults:G.tile.queryRenderedFeatures(w,_,v._state,G.queryGeometry,G.cameraQueryGeometry,G.scale,j,f,d,Vi(v.transform,G.tileID))})}var W=function(ee){for(var Q={},le={},de=0,ge=ee;de<ge.length;de+=1){var xe=ge[de],Te=xe.queryResults,Ee=xe.wrappedTileID,Pe=le[Ee]=le[Ee]||{};for(var Le in Te)for(var Me=Te[Le],Ue=Pe[Le]=Pe[Le]||{},Ye=Q[Le]=Q[Le]||[],yt=0,gt=Me;yt<gt.length;yt+=1){var Ot=gt[yt];Ue[Ot.featureIndex]||(Ue[Ot.featureIndex]=!0,Ye.push(Ot))}}return Q}(M);for(var Y in W)W[Y].forEach(function(ee){var Q=ee.feature,le=v.getFeatureState(Q.layer["source-layer"],Q.id);Q.source=Q.layer.source,Q.layer["source-layer"]&&(Q.sourceLayer=Q.layer["source-layer"]),Q.state=le});return W}function gl(v,w){var _=v.tileID,I=w.tileID;return _.overscaledZ-I.overscaledZ||_.canonical.y-I.canonical.y||_.wrap-I.wrap||_.canonical.x-I.canonical.x}var Ir=function(v,w){this.max=v,this.onRemove=w,this.reset()};Ir.prototype.reset=function(){for(var v in this.data)for(var w=0,_=this.data[v];w<_.length;w+=1){var I=_[w];I.timeout&&clearTimeout(I.timeout),this.onRemove(I.value)}return this.data={},this.order=[],this},Ir.prototype.add=function(v,w,_){var I=this,j=v.wrapped().key;void 0===this.data[j]&&(this.data[j]=[]);var f={value:w,timeout:void 0};if(void 0!==_&&(f.timeout=setTimeout(function(){I.remove(v,f)},_)),this.data[j].push(f),this.order.push(j),this.order.length>this.max){var l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this},Ir.prototype.has=function(v){return v.wrapped().key in this.data},Ir.prototype.getAndRemove=function(v){return this.has(v)?this._getAndRemoveByKey(v.wrapped().key):null},Ir.prototype._getAndRemoveByKey=function(v){var w=this.data[v].shift();return w.timeout&&clearTimeout(w.timeout),0===this.data[v].length&&delete this.data[v],this.order.splice(this.order.indexOf(v),1),w.value},Ir.prototype.getByKey=function(v){var w=this.data[v];return w?w[0].value:null},Ir.prototype.get=function(v){return this.has(v)?this.data[v.wrapped().key][0].value:null},Ir.prototype.remove=function(v,w){if(!this.has(v))return this;var _=v.wrapped().key,I=void 0===w?0:this.data[_].indexOf(w),j=this.data[_][I];return this.data[_].splice(I,1),j.timeout&&clearTimeout(j.timeout),0===this.data[_].length&&delete this.data[_],this.onRemove(j.value),this.order.splice(this.order.indexOf(_),1),this},Ir.prototype.setMaxSize=function(v){for(this.max=v;this.order.length>this.max;){var w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this},Ir.prototype.filter=function(v){var w=[];for(var _ in this.data)for(var I=0,j=this.data[_];I<j.length;I+=1){var f=j[I];v(f.value)||w.push(f)}for(var l=0,d=w;l<d.length;l+=1){var x=d[l];this.remove(x.value.tileID,x)}};var yl=function(v,w,_){this.context=v;var I=v.gl;this.buffer=I.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),v.bindElementBuffer.set(this.buffer),I.bufferData(I.ELEMENT_ARRAY_BUFFER,w.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||delete w.arrayBuffer};yl.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},yl.prototype.updateData=function(v){var w=this.context.gl;this.context.unbindVAO(),this.bind(),w.bufferSubData(w.ELEMENT_ARRAY_BUFFER,0,v.arrayBuffer)},yl.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Sc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Yl=function(v,w,_,I){this.length=w.length,this.attributes=_,this.itemSize=w.bytesPerElement,this.dynamicDraw=I,this.context=v;var j=v.gl;this.buffer=j.createBuffer(),v.bindVertexBuffer.set(this.buffer),j.bufferData(j.ARRAY_BUFFER,w.arrayBuffer,this.dynamicDraw?j.DYNAMIC_DRAW:j.STATIC_DRAW),this.dynamicDraw||delete w.arrayBuffer};Yl.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Yl.prototype.updateData=function(v){var w=this.context.gl;this.bind(),w.bufferSubData(w.ARRAY_BUFFER,0,v.arrayBuffer)},Yl.prototype.enableAttributes=function(v,w){for(var _=0;_<this.attributes.length;_++){var I=w.attributes[this.attributes[_].name];void 0!==I&&v.enableVertexAttribArray(I)}},Yl.prototype.setVertexAttribPointers=function(v,w,_){for(var I=0;I<this.attributes.length;I++){var j=this.attributes[I],f=w.attributes[j.name];void 0!==f&&v.vertexAttribPointer(f,j.components,v[Sc[j.type]],!1,this.itemSize,j.offset+this.itemSize*(_||0))}},Yl.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var di=function(v){this.gl=v.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};di.prototype.get=function(){return this.current},di.prototype.set=function(v){},di.prototype.getDefault=function(){return this.default},di.prototype.setDefault=function(){this.set(this.default)};var zs=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return L.Color.transparent},w.prototype.set=function(_){var I=this.current;(_.r!==I.r||_.g!==I.g||_.b!==I.b||_.a!==I.a||this.dirty)&&(this.gl.clearColor(_.r,_.g,_.b,_.a),this.current=_,this.dirty=!1)},w}(di),ss=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return 1},w.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.clearDepth(_),this.current=_,this.dirty=!1)},w}(di),Ar=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return 0},w.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.clearStencil(_),this.current=_,this.dirty=!1)},w}(di),Tc=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return[!0,!0,!0,!0]},w.prototype.set=function(_){var I=this.current;(_[0]!==I[0]||_[1]!==I[1]||_[2]!==I[2]||_[3]!==I[3]||this.dirty)&&(this.gl.colorMask(_[0],_[1],_[2],_[3]),this.current=_,this.dirty=!1)},w}(di),ol=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return!0},w.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.depthMask(_),this.current=_,this.dirty=!1)},w}(di),vl=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return 255},w.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.stencilMask(_),this.current=_,this.dirty=!1)},w}(di),Rl=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},w.prototype.set=function(_){var I=this.current;(_.func!==I.func||_.ref!==I.ref||_.mask!==I.mask||this.dirty)&&(this.gl.stencilFunc(_.func,_.ref,_.mask),this.current=_,this.dirty=!1)},w}(di),Ol=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){var _=this.gl;return[_.KEEP,_.KEEP,_.KEEP]},w.prototype.set=function(_){var I=this.current;(_[0]!==I[0]||_[1]!==I[1]||_[2]!==I[2]||this.dirty)&&(this.gl.stencilOp(_[0],_[1],_[2]),this.current=_,this.dirty=!1)},w}(di),gu=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return!1},w.prototype.set=function(_){if(_!==this.current||this.dirty){var I=this.gl;_?I.enable(I.STENCIL_TEST):I.disable(I.STENCIL_TEST),this.current=_,this.dirty=!1}},w}(di),_l=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return[0,1]},w.prototype.set=function(_){var I=this.current;(_[0]!==I[0]||_[1]!==I[1]||this.dirty)&&(this.gl.depthRange(_[0],_[1]),this.current=_,this.dirty=!1)},w}(di),Na=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return!1},w.prototype.set=function(_){if(_!==this.current||this.dirty){var I=this.gl;_?I.enable(I.DEPTH_TEST):I.disable(I.DEPTH_TEST),this.current=_,this.dirty=!1}},w}(di),la=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return this.gl.LESS},w.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.depthFunc(_),this.current=_,this.dirty=!1)},w}(di),al=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return!1},w.prototype.set=function(_){if(_!==this.current||this.dirty){var I=this.gl;_?I.enable(I.BLEND):I.disable(I.BLEND),this.current=_,this.dirty=!1}},w}(di),Uh=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){var _=this.gl;return[_.ONE,_.ZERO]},w.prototype.set=function(_){var I=this.current;(_[0]!==I[0]||_[1]!==I[1]||this.dirty)&&(this.gl.blendFunc(_[0],_[1]),this.current=_,this.dirty=!1)},w}(di),Ys=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return L.Color.transparent},w.prototype.set=function(_){var I=this.current;(_.r!==I.r||_.g!==I.g||_.b!==I.b||_.a!==I.a||this.dirty)&&(this.gl.blendColor(_.r,_.g,_.b,_.a),this.current=_,this.dirty=!1)},w}(di),Ns=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return this.gl.FUNC_ADD},w.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.blendEquation(_),this.current=_,this.dirty=!1)},w}(di),Kc=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return!1},w.prototype.set=function(_){if(_!==this.current||this.dirty){var I=this.gl;_?I.enable(I.CULL_FACE):I.disable(I.CULL_FACE),this.current=_,this.dirty=!1}},w}(di),Ic=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return this.gl.BACK},w.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.cullFace(_),this.current=_,this.dirty=!1)},w}(di),Vh=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return this.gl.CCW},w.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.frontFace(_),this.current=_,this.dirty=!1)},w}(di),Jc=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return null},w.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.useProgram(_),this.current=_,this.dirty=!1)},w}(di),Qu=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return this.gl.TEXTURE0},w.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.activeTexture(_),this.current=_,this.dirty=!1)},w}(di),Mc=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){var _=this.gl;return[0,0,_.drawingBufferWidth,_.drawingBufferHeight]},w.prototype.set=function(_){var I=this.current;(_[0]!==I[0]||_[1]!==I[1]||_[2]!==I[2]||_[3]!==I[3]||this.dirty)&&(this.gl.viewport(_[0],_[1],_[2],_[3]),this.current=_,this.dirty=!1)},w}(di),Ss=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return null},w.prototype.set=function(_){if(_!==this.current||this.dirty){var I=this.gl;I.bindFramebuffer(I.FRAMEBUFFER,_),this.current=_,this.dirty=!1}},w}(di),Qc=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return null},w.prototype.set=function(_){if(_!==this.current||this.dirty){var I=this.gl;I.bindRenderbuffer(I.RENDERBUFFER,_),this.current=_,this.dirty=!1}},w}(di),Nu=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return null},w.prototype.set=function(_){if(_!==this.current||this.dirty){var I=this.gl;I.bindTexture(I.TEXTURE_2D,_),this.current=_,this.dirty=!1}},w}(di),_h=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return null},w.prototype.set=function(_){if(_!==this.current||this.dirty){var I=this.gl;I.bindBuffer(I.ARRAY_BUFFER,_),this.current=_,this.dirty=!1}},w}(di),Bs=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return null},w.prototype.set=function(_){var I=this.gl;I.bindBuffer(I.ELEMENT_ARRAY_BUFFER,_),this.current=_,this.dirty=!1},w}(di),Kl=function(v){function w(_){v.call(this,_),this.vao=_.extVertexArrayObject}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return null},w.prototype.set=function(_){this.vao&&(_!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(_),this.current=_,this.dirty=!1)},w}(di),Jl=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return 4},w.prototype.set=function(_){if(_!==this.current||this.dirty){var I=this.gl;I.pixelStorei(I.UNPACK_ALIGNMENT,_),this.current=_,this.dirty=!1}},w}(di),Ll=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return!1},w.prototype.set=function(_){if(_!==this.current||this.dirty){var I=this.gl;I.pixelStorei(I.UNPACK_PREMULTIPLY_ALPHA_WEBGL,_),this.current=_,this.dirty=!1}},w}(di),Da=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return!1},w.prototype.set=function(_){if(_!==this.current||this.dirty){var I=this.gl;I.pixelStorei(I.UNPACK_FLIP_Y_WEBGL,_),this.current=_,this.dirty=!1}},w}(di),Bo=function(v){function w(_,I){v.call(this,_),this.context=_,this.parent=I}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getDefault=function(){return null},w}(di),be=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.setDirty=function(){this.dirty=!0},w.prototype.set=function(_){if(_!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var I=this.gl;I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_2D,_,0),this.current=_,this.dirty=!1}},w}(Bo),De=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.set=function(_){if(_!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var I=this.gl;I.framebufferRenderbuffer(I.FRAMEBUFFER,I.DEPTH_ATTACHMENT,I.RENDERBUFFER,_),this.current=_,this.dirty=!1}},w}(Bo),Oe=function(v,w,_,I){this.context=v,this.width=w,this.height=_;var j=this.framebuffer=v.gl.createFramebuffer();this.colorAttachment=new be(v,j),I&&(this.depthAttachment=new De(v,j))};Oe.prototype.destroy=function(){var v=this.context.gl,w=this.colorAttachment.get();if(w&&v.deleteTexture(w),this.depthAttachment){var _=this.depthAttachment.get();_&&v.deleteRenderbuffer(_)}v.deleteFramebuffer(this.framebuffer)};var se=function(v,w,_){this.func=v,this.mask=w,this.range=_};se.ReadOnly=!1,se.ReadWrite=!0,se.disabled=new se(519,se.ReadOnly,[0,1]);var te=function(v,w,_,I,j,f){this.test=v,this.ref=w,this.mask=_,this.fail=I,this.depthFail=j,this.pass=f};te.disabled=new te({func:519,mask:0},0,0,7680,7680,7680);var oe=function(v,w,_){this.blendFunction=v,this.blendColor=w,this.mask=_};oe.disabled=new oe(oe.Replace=[1,0],L.Color.transparent,[!1,!1,!1,!1]),oe.unblended=new oe(oe.Replace,L.Color.transparent,[!0,!0,!0,!0]),oe.alphaBlended=new oe([1,771],L.Color.transparent,[!0,!0,!0,!0]);var me=function(v,w,_){this.enable=v,this.mode=w,this.frontFace=_};me.disabled=new me(!1,1029,2305),me.backCCW=new me(!0,1029,2305);var ve=function(v){this.gl=v,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new zs(this),this.clearDepth=new ss(this),this.clearStencil=new Ar(this),this.colorMask=new Tc(this),this.depthMask=new ol(this),this.stencilMask=new vl(this),this.stencilFunc=new Rl(this),this.stencilOp=new Ol(this),this.stencilTest=new gu(this),this.depthRange=new _l(this),this.depthTest=new Na(this),this.depthFunc=new la(this),this.blend=new al(this),this.blendFunc=new Uh(this),this.blendColor=new Ys(this),this.blendEquation=new Ns(this),this.cullFace=new Kc(this),this.cullFaceSide=new Ic(this),this.frontFace=new Vh(this),this.program=new Jc(this),this.activeTexture=new Qu(this),this.viewport=new Mc(this),this.bindFramebuffer=new Ss(this),this.bindRenderbuffer=new Qc(this),this.bindTexture=new Nu(this),this.bindVertexBuffer=new _h(this),this.bindElementBuffer=new Bs(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Kl(this),this.pixelStoreUnpack=new Jl(this),this.pixelStoreUnpackPremultiplyAlpha=new Ll(this),this.pixelStoreUnpackFlipY=new Da(this),this.extTextureFilterAnisotropic=v.getExtension("EXT_texture_filter_anisotropic")||v.getExtension("MOZ_EXT_texture_filter_anisotropic")||v.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=v.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=v.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(v.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=v.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=v.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=v.getParameter(v.MAX_TEXTURE_SIZE)};ve.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ve.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ve.prototype.createIndexBuffer=function(v,w){return new yl(this,v,w)},ve.prototype.createVertexBuffer=function(v,w,_){return new Yl(this,v,w,_)},ve.prototype.createRenderbuffer=function(v,w,_){var I=this.gl,j=I.createRenderbuffer();return this.bindRenderbuffer.set(j),I.renderbufferStorage(I.RENDERBUFFER,v,w,_),this.bindRenderbuffer.set(null),j},ve.prototype.createFramebuffer=function(v,w,_){return new Oe(this,v,w,_)},ve.prototype.clear=function(v){var w=v.color,_=v.depth,I=this.gl,j=0;w&&(j|=I.COLOR_BUFFER_BIT,this.clearColor.set(w),this.colorMask.set([!0,!0,!0,!0])),void 0!==_&&(j|=I.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(_),this.depthMask.set(!0)),I.clear(j)},ve.prototype.setCullFace=function(v){!1===v.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(v.mode),this.frontFace.set(v.frontFace))},ve.prototype.setDepthMode=function(v){v.func!==this.gl.ALWAYS||v.mask?(this.depthTest.set(!0),this.depthFunc.set(v.func),this.depthMask.set(v.mask),this.depthRange.set(v.range)):this.depthTest.set(!1)},ve.prototype.setStencilMode=function(v){v.test.func!==this.gl.ALWAYS||v.mask?(this.stencilTest.set(!0),this.stencilMask.set(v.mask),this.stencilOp.set([v.fail,v.depthFail,v.pass]),this.stencilFunc.set({func:v.test.func,ref:v.ref,mask:v.test.mask})):this.stencilTest.set(!1)},ve.prototype.setColorMode=function(v){L.deepEqual(v.blendFunction,oe.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(v.blendFunction),this.blendColor.set(v.blendColor)),this.colorMask.set(v.mask)},ve.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var pe=function(v){function w(_,I,j){var f=this;v.call(this),this.id=_,this.dispatcher=j,this.on("data",function(l){"source"===l.dataType&&"metadata"===l.sourceDataType&&(f._sourceLoaded=!0),f._sourceLoaded&&!f._paused&&"source"===l.dataType&&"content"===l.sourceDataType&&(f.reload(),f.transform&&f.update(f.transform))}),this.on("error",function(){f._sourceErrored=!0}),this._source=function(l,d,x,M){var D=new Xi[d.type](l,d,x,M);if(D.id!==l)throw new Error("Expected Source id to be "+l+" instead of "+D.id);return L.bindAll(["load","abort","unload","serialize","prepare"],D),D}(_,I,j,this),this._tiles={},this._cache=new Ir(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new L.SourceFeatureState}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.onAdd=function(_){this.map=_,this._maxTileCacheSize=_?_._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(_)},w.prototype.onRemove=function(_){this._source&&this._source.onRemove&&this._source.onRemove(_)},w.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var _ in this._tiles){var I=this._tiles[_];if("loaded"!==I.state&&"errored"!==I.state)return!1}return!0},w.prototype.getSource=function(){return this._source},w.prototype.pause=function(){this._paused=!0},w.prototype.resume=function(){if(this._paused){var _=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,_&&this.reload(),this.transform&&this.update(this.transform)}},w.prototype._loadTile=function(_,I){return this._source.loadTile(_,I)},w.prototype._unloadTile=function(_){if(this._source.unloadTile)return this._source.unloadTile(_,function(){})},w.prototype._abortTile=function(_){if(this._source.abortTile)return this._source.abortTile(_,function(){})},w.prototype.serialize=function(){return this._source.serialize()},w.prototype.prepare=function(_){for(var I in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var j=this._tiles[I];j.upload(_),j.prepare(this.map.style.imageManager)}},w.prototype.getIds=function(){return L.values(this._tiles).map(function(_){return _.tileID}).sort(Se).map(function(_){return _.key})},w.prototype.getRenderableIds=function(_){var I=this,j=[];for(var f in this._tiles)this._isIdRenderable(f,_)&&j.push(this._tiles[f]);return _?j.sort(function(l,d){var x=l.tileID,M=d.tileID,D=new L.Point(x.canonical.x,x.canonical.y)._rotate(I.transform.angle),B=new L.Point(M.canonical.x,M.canonical.y)._rotate(I.transform.angle);return x.overscaledZ-M.overscaledZ||B.y-D.y||B.x-D.x}).map(function(l){return l.tileID.key}):j.map(function(l){return l.tileID}).sort(Se).map(function(l){return l.key})},w.prototype.hasRenderableParent=function(_){var I=this.findLoadedParent(_,0);return!!I&&this._isIdRenderable(I.tileID.key)},w.prototype._isIdRenderable=function(_,I){return this._tiles[_]&&this._tiles[_].hasData()&&!this._coveredTiles[_]&&(I||!this._tiles[_].holdingForFade())},w.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var _ in this._cache.reset(),this._tiles)"errored"!==this._tiles[_].state&&this._reloadTile(_,"reloading")},w.prototype._reloadTile=function(_,I){var j=this._tiles[_];j&&("loading"!==j.state&&(j.state=I),this._loadTile(j,this._tileLoaded.bind(this,j,_,I)))},w.prototype._tileLoaded=function(_,I,j,f){if(f)return _.state="errored",void(404!==f.status?this._source.fire(new L.ErrorEvent(f,{tile:_})):this.update(this.transform));_.timeAdded=L.browser.now(),"expired"===j&&(_.refreshedUponExpiration=!0),this._setTileReloadTimer(I,_),"raster-dem"===this.getSource().type&&_.dem&&this._backfillDEM(_),this._state.initializeTileState(_,this.map?this.map.painter:null),this._source.fire(new L.Event("data",{dataType:"source",tile:_,coord:_.tileID}))},w.prototype._backfillDEM=function(_){for(var I=this.getRenderableIds(),j=0;j<I.length;j++){var f=I[j];if(_.neighboringTiles&&_.neighboringTiles[f]){var l=this.getTileByID(f);d(_,l),d(l,_)}}function d(x,M){x.needsHillshadePrepare=!0;var D=M.tileID.canonical.x-x.tileID.canonical.x,B=M.tileID.canonical.y-x.tileID.canonical.y,G=Math.pow(2,x.tileID.canonical.z),W=M.tileID.key;0===D&&0===B||Math.abs(B)>1||(Math.abs(D)>1&&(1===Math.abs(D+G)?D+=G:1===Math.abs(D-G)&&(D-=G)),M.dem&&x.dem&&(x.dem.backfillBorder(M.dem,D,B),x.neighboringTiles&&x.neighboringTiles[W]&&(x.neighboringTiles[W].backfilled=!0)))}},w.prototype.getTile=function(_){return this.getTileByID(_.key)},w.prototype.getTileByID=function(_){return this._tiles[_]},w.prototype._retainLoadedChildren=function(_,I,j,f){for(var l in this._tiles){var d=this._tiles[l];if(!(f[l]||!d.hasData()||d.tileID.overscaledZ<=I||d.tileID.overscaledZ>j)){for(var x=d.tileID;d&&d.tileID.overscaledZ>I+1;){var M=d.tileID.scaledTo(d.tileID.overscaledZ-1);(d=this._tiles[M.key])&&d.hasData()&&(x=M)}for(var D=x;D.overscaledZ>I;)if(_[(D=D.scaledTo(D.overscaledZ-1)).key]){f[x.key]=x;break}}}},w.prototype.findLoadedParent=function(_,I){if(_.key in this._loadedParentTiles){var j=this._loadedParentTiles[_.key];return j&&j.tileID.overscaledZ>=I?j:null}for(var f=_.overscaledZ-1;f>=I;f--){var l=_.scaledTo(f),d=this._getLoadedTile(l);if(d)return d}},w.prototype._getLoadedTile=function(_){var I=this._tiles[_.key];return I&&I.hasData()?I:this._cache.getByKey(_.wrapped().key)},w.prototype.updateCacheSize=function(_){var I=Math.ceil(_.width/this._source.tileSize)+1,j=Math.ceil(_.height/this._source.tileSize)+1,f=Math.floor(I*j*5),l="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(l)},w.prototype.handleWrapJump=function(_){var I=Math.round((_-(void 0===this._prevLng?_:this._prevLng))/360);if(this._prevLng=_,I){var j={};for(var f in this._tiles){var l=this._tiles[f];l.tileID=l.tileID.unwrapTo(l.tileID.wrap+I),j[l.tileID.key]=l}for(var d in this._tiles=j,this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(var x in this._tiles)this._setTileReloadTimer(x,this._tiles[x])}},w.prototype.update=function(_){var I=this;if(this.transform=_,this._sourceLoaded&&!this._paused){var j;this.updateCacheSize(_),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?j=_.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Pe){return new L.OverscaledTileID(Pe.canonical.z,Pe.wrap,Pe.canonical.z,Pe.canonical.x,Pe.canonical.y)}):(j=_.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(j=j.filter(function(Pe){return I._source.hasTile(Pe)}))):j=[];var f=_.coveringZoomLevel(this._source),l=Math.max(f-w.maxOverzooming,this._source.minzoom),d=Math.max(f+w.maxUnderzooming,this._source.minzoom),x=this._updateRetainedTiles(j,f);if(He(this._source.type)){for(var M={},D={},B=0,G=Object.keys(x);B<G.length;B+=1){var W=G[B],Y=x[W],ee=this._tiles[W];if(ee&&!(ee.fadeEndTime&&ee.fadeEndTime<=L.browser.now())){var Q=this.findLoadedParent(Y,l);Q&&(this._addTile(Q.tileID),M[Q.tileID.key]=Q.tileID),D[W]=Y}}for(var le in this._retainLoadedChildren(D,f,d,x),M)x[le]||(this._coveredTiles[le]=!0,x[le]=M[le])}for(var de in x)this._tiles[de].clearFadeHold();for(var ge=0,xe=L.keysDifference(this._tiles,x);ge<xe.length;ge+=1){var Te=xe[ge],Ee=this._tiles[Te];Ee.hasSymbolBuckets&&!Ee.holdingForFade()?Ee.setHoldDuration(this.map._fadeDuration):Ee.hasSymbolBuckets&&!Ee.symbolFadeFinished()||this._removeTile(Te)}this._updateLoadedParentTileCache()}},w.prototype.releaseSymbolFadeTiles=function(){for(var _ in this._tiles)this._tiles[_].holdingForFade()&&this._removeTile(_)},w.prototype._updateRetainedTiles=function(_,I){for(var j={},f={},l=Math.max(I-w.maxOverzooming,this._source.minzoom),d=Math.max(I+w.maxUnderzooming,this._source.minzoom),x={},M=0,D=_;M<D.length;M+=1){var B=D[M],G=this._addTile(B);j[B.key]=B,G.hasData()||I<this._source.maxzoom&&(x[B.key]=B)}this._retainLoadedChildren(x,I,d,j);for(var W=0,Y=_;W<Y.length;W+=1){var ee=Y[W],Q=this._tiles[ee.key];if(!Q.hasData()){if(I+1>this._source.maxzoom){var le=ee.children(this._source.maxzoom)[0],de=this.getTile(le);if(de&&de.hasData()){j[le.key]=le;continue}}else{var ge=ee.children(this._source.maxzoom);if(j[ge[0].key]&&j[ge[1].key]&&j[ge[2].key]&&j[ge[3].key])continue}for(var xe=Q.wasRequested(),Te=ee.overscaledZ-1;Te>=l;--Te){var Ee=ee.scaledTo(Te);if(f[Ee.key]||(f[Ee.key]=!0,!(Q=this.getTile(Ee))&&xe&&(Q=this._addTile(Ee)),Q&&(j[Ee.key]=Ee,xe=Q.wasRequested(),Q.hasData())))break}}}return j},w.prototype._updateLoadedParentTileCache=function(){for(var _ in this._loadedParentTiles={},this._tiles){for(var I=[],j=void 0,f=this._tiles[_].tileID;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){j=this._loadedParentTiles[f.key];break}I.push(f.key);var l=f.scaledTo(f.overscaledZ-1);if(j=this._getLoadedTile(l))break;f=l}for(var d=0,x=I;d<x.length;d+=1)this._loadedParentTiles[x[d]]=j}},w.prototype._addTile=function(_){var I=this._tiles[_.key];if(I)return I;(I=this._cache.getAndRemove(_))&&(this._setTileReloadTimer(_.key,I),I.tileID=_,this._state.initializeTileState(I,this.map?this.map.painter:null),this._cacheTimers[_.key]&&(clearTimeout(this._cacheTimers[_.key]),delete this._cacheTimers[_.key],this._setTileReloadTimer(_.key,I)));var j=Boolean(I);return j||(I=new L.Tile(_,this._source.tileSize*_.overscaleFactor()),this._loadTile(I,this._tileLoaded.bind(this,I,_.key,I.state))),I?(I.uses++,this._tiles[_.key]=I,j||this._source.fire(new L.Event("dataloading",{tile:I,coord:I.tileID,dataType:"source"})),I):null},w.prototype._setTileReloadTimer=function(_,I){var j=this;_ in this._timers&&(clearTimeout(this._timers[_]),delete this._timers[_]);var f=I.getExpiryTimeout();f&&(this._timers[_]=setTimeout(function(){j._reloadTile(_,"expired"),delete j._timers[_]},f))},w.prototype._removeTile=function(_){var I=this._tiles[_];I&&(I.uses--,delete this._tiles[_],this._timers[_]&&(clearTimeout(this._timers[_]),delete this._timers[_]),I.uses>0||(I.hasData()&&"reloading"!==I.state?this._cache.add(I.tileID,I,I.getExpiryTimeout()):(I.aborted=!0,this._abortTile(I),this._unloadTile(I))))},w.prototype.clearTiles=function(){for(var _ in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(_);this._cache.reset()},w.prototype.tilesIn=function(_,I,j){var f=this,l=[],d=this.transform;if(!d)return l;for(var x=j?d.getCameraQueryGeometry(_):_,M=_.map(function(Te){return d.pointCoordinate(Te)}),D=x.map(function(Te){return d.pointCoordinate(Te)}),B=this.getIds(),G=1/0,W=1/0,Y=-1/0,ee=-1/0,Q=0,le=D;Q<le.length;Q+=1){var de=le[Q];G=Math.min(G,de.x),W=Math.min(W,de.y),Y=Math.max(Y,de.x),ee=Math.max(ee,de.y)}for(var ge=function(Te){var Ee=f._tiles[B[Te]];if(!Ee.holdingForFade()){var Pe=Ee.tileID,Le=Math.pow(2,d.zoom-Ee.tileID.overscaledZ),Me=I*Ee.queryPadding*L.EXTENT/Ee.tileSize/Le,Ue=[Pe.getTilePoint(new L.MercatorCoordinate(G,W)),Pe.getTilePoint(new L.MercatorCoordinate(Y,ee))];if(Ue[0].x-Me<L.EXTENT&&Ue[0].y-Me<L.EXTENT&&Ue[1].x+Me>=0&&Ue[1].y+Me>=0){var Ye=M.map(function(gt){return Pe.getTilePoint(gt)}),yt=D.map(function(gt){return Pe.getTilePoint(gt)});l.push({tile:Ee,tileID:Pe,queryGeometry:Ye,cameraQueryGeometry:yt,scale:Le})}}},xe=0;xe<B.length;xe++)ge(xe);return l},w.prototype.getVisibleCoordinates=function(_){for(var I=this,j=this.getRenderableIds(_).map(function(x){return I._tiles[x].tileID}),f=0,l=j;f<l.length;f+=1){var d=l[f];d.posMatrix=this.transform.calculatePosMatrix(d.toUnwrapped())}return j},w.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(He(this._source.type))for(var _ in this._tiles){var I=this._tiles[_];if(void 0!==I.fadeEndTime&&I.fadeEndTime>=L.browser.now())return!0}return!1},w.prototype.setFeatureState=function(_,I,j){this._state.updateState(_=_||"_geojsonTileLayer",I,j)},w.prototype.removeFeatureState=function(_,I,j){this._state.removeFeatureState(_=_||"_geojsonTileLayer",I,j)},w.prototype.getFeatureState=function(_,I){return this._state.getState(_=_||"_geojsonTileLayer",I)},w.prototype.setDependencies=function(_,I,j){var f=this._tiles[_];f&&f.setDependencies(I,j)},w.prototype.reloadTilesForDependencies=function(_,I){for(var j in this._tiles)this._tiles[j].hasDependency(_,I)&&this._reloadTile(j,"reloading");this._cache.filter(function(f){return!f.hasDependency(_,I)})},w}(L.Evented);function Se(v,w){var _=Math.abs(2*v.wrap)-+(v.wrap<0),I=Math.abs(2*w.wrap)-+(w.wrap<0);return v.overscaledZ-w.overscaledZ||I-_||w.canonical.y-v.canonical.y||w.canonical.x-v.canonical.x}function He(v){return"raster"===v||"image"===v||"video"===v}function Ze(){return new L.window.Worker(Kh.workerUrl)}pe.maxOverzooming=10,pe.maxUnderzooming=3;var Be="mapboxgl_preloaded_worker_pool",lt=function(){this.active={}};lt.prototype.acquire=function(v){if(!this.workers)for(this.workers=[];this.workers.length<lt.workerCount;)this.workers.push(new Ze);return this.active[v]=!0,this.workers.slice()},lt.prototype.release=function(v){delete this.active[v],0===this.numActive()&&(this.workers.forEach(function(w){w.terminate()}),this.workers=null)},lt.prototype.isPreloaded=function(){return!!this.active[Be]},lt.prototype.numActive=function(){return Object.keys(this.active).length};var Rt,xt=Math.floor(L.browser.hardwareConcurrency/2);function Xt(){return Rt||(Rt=new lt),Rt}function mt(v,w){var _={};for(var I in v)"ref"!==I&&(_[I]=v[I]);return L.refProperties.forEach(function(j){j in w&&(_[j]=w[j])}),_}function Je(v){v=v.slice();for(var w=Object.create(null),_=0;_<v.length;_++)w[v[_].id]=v[_];for(var I=0;I<v.length;I++)"ref"in v[I]&&(v[I]=mt(v[I],w[v[I].ref]));return v}lt.workerCount=Math.max(Math.min(xt,6),1);var ot={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function On(v,w,_){_.push({command:ot.addSource,args:[v,w[v]]})}function Bn(v,w,_){w.push({command:ot.removeSource,args:[v]}),_[v]=!0}function sn(v,w,_,I){Bn(v,_,I),On(v,w,_)}function br(v,w,_){var I;for(I in v[_])if(v[_].hasOwnProperty(I)&&"data"!==I&&!L.deepEqual(v[_][I],w[_][I]))return!1;for(I in w[_])if(w[_].hasOwnProperty(I)&&"data"!==I&&!L.deepEqual(v[_][I],w[_][I]))return!1;return!0}function Ft(v,w,_,I,j,f){var l;for(l in w=w||{},v=v||{})v.hasOwnProperty(l)&&(L.deepEqual(v[l],w[l])||_.push({command:f,args:[I,l,w[l],j]}));for(l in w)w.hasOwnProperty(l)&&!v.hasOwnProperty(l)&&(L.deepEqual(v[l],w[l])||_.push({command:f,args:[I,l,w[l],j]}))}function mr(v){return v.id}function or(v,w){return v[w.id]=w,v}var qt=function(v,w){this.reset(v,w)};qt.prototype.reset=function(v,w){this.points=v||[],this._distances=[0];for(var _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(w||0,.5*this.length),this.paddedLength=this.length-2*this.padding},qt.prototype.lerp=function(v){if(1===this.points.length)return this.points[0];v=L.clamp(v,0,1);for(var w=1,_=this._distances[w],I=v*this.paddedLength+this.padding;_<I&&w<this._distances.length;)_=this._distances[++w];var j=w-1,f=this._distances[j],l=_-f,d=l>0?(I-f)/l:0;return this.points[j].mult(1-d).add(this.points[w].mult(d))};var ur=function(v,w,_){var I=this.boxCells=[],j=this.circleCells=[];this.xCellCount=Math.ceil(v/_),this.yCellCount=Math.ceil(w/_);for(var f=0;f<this.xCellCount*this.yCellCount;f++)I.push([]),j.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=v,this.height=w,this.xScale=this.xCellCount/v,this.yScale=this.yCellCount/w,this.boxUid=0,this.circleUid=0};function wn(v,w,_,I,j){var f=L.create();return w?(L.scale(f,f,[1/j,1/j,1]),_||L.rotateZ(f,f,I.angle)):L.multiply(f,I.labelPlaneMatrix,v),f}function ri(v,w,_,I,j){if(w){var f=L.clone(v);return L.scale(f,f,[j,j,1]),_||L.rotateZ(f,f,-I.angle),f}return I.glCoordMatrix}function Yr(v,w){var _=[v.x,v.y,0,1];xl(_,_,w);var I=_[3];return{point:new L.Point(_[0]/I,_[1]/I),signedDistanceFromCamera:I}}function lr(v,w){return.5+v/w*.5}function ni(v,w){var _=v[0]/v[3],I=v[1]/v[3];return _>=-w[0]&&_<=w[0]&&I>=-w[1]&&I<=w[1]}function Kr(v,w,_,I,j,f,l,d){var x=I?v.textSizeData:v.iconSizeData,M=L.evaluateSizeForZoom(x,_.transform.zoom),D=[256/_.width*2+1,256/_.height*2+1],B=I?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;B.clear();for(var G=v.lineVertexArray,W=I?v.text.placedSymbolArray:v.icon.placedSymbolArray,Y=_.transform.width/_.transform.height,ee=!1,Q=0;Q<W.length;Q++){var le=W.get(Q);if(le.hidden||le.writingMode===L.WritingMode.vertical&&!ee)Fr(le.numGlyphs,B);else{ee=!1;var de=[le.anchorX,le.anchorY,0,1];if(L.transformMat4(de,de,w),ni(de,D)){var ge=lr(_.transform.cameraToCenterDistance,de[3]),xe=L.evaluateSizeForFeature(x,M,le),Te=l?xe/ge:xe*ge,Ee=new L.Point(le.anchorX,le.anchorY),Pe=Yr(Ee,j).point,Le={},Me=gi(le,Te,!1,d,w,j,f,v.glyphOffsetArray,G,B,Pe,Ee,Le,Y);ee=Me.useVertical,(Me.notEnoughRoom||ee||Me.needsFlipping&&gi(le,Te,!0,d,w,j,f,v.glyphOffsetArray,G,B,Pe,Ee,Le,Y).notEnoughRoom)&&Fr(le.numGlyphs,B)}else Fr(le.numGlyphs,B)}}I?v.text.dynamicLayoutVertexBuffer.updateData(B):v.icon.dynamicLayoutVertexBuffer.updateData(B)}function yo(v,w,_,I,j,f,l,d,x,M,D){var B=d.glyphStartIndex+d.numGlyphs,G=d.lineStartIndex,W=d.lineStartIndex+d.lineLength,Y=w.getoffsetX(d.glyphStartIndex),ee=w.getoffsetX(B-1),Q=js(v*Y,_,I,j,f,l,d.segment,G,W,x,M,D);if(!Q)return null;var le=js(v*ee,_,I,j,f,l,d.segment,G,W,x,M,D);return le?{first:Q,last:le}:null}function Ro(v,w,_,I){return v===L.WritingMode.horizontal&&Math.abs(_.y-w.y)>Math.abs(_.x-w.x)*I?{useVertical:!0}:(v===L.WritingMode.vertical?w.y<_.y:w.x>_.x)?{needsFlipping:!0}:null}function gi(v,w,_,I,j,f,l,d,x,M,D,B,G,W){var Y,ee=w/24,Q=v.lineOffsetX*ee,le=v.lineOffsetY*ee;if(v.numGlyphs>1){var de=v.glyphStartIndex+v.numGlyphs,ge=v.lineStartIndex,xe=v.lineStartIndex+v.lineLength,Te=yo(ee,d,Q,le,_,D,B,v,x,f,G);if(!Te)return{notEnoughRoom:!0};var Ee=Yr(Te.first.point,l).point,Pe=Yr(Te.last.point,l).point;if(I&&!_){var Le=Ro(v.writingMode,Ee,Pe,W);if(Le)return Le}Y=[Te.first];for(var Me=v.glyphStartIndex+1;Me<de-1;Me++)Y.push(js(ee*d.getoffsetX(Me),Q,le,_,D,B,v.segment,ge,xe,x,f,G));Y.push(Te.last)}else{if(I&&!_){var Ue=Yr(B,j).point,Ye=v.lineStartIndex+v.segment+1,yt=new L.Point(x.getx(Ye),x.gety(Ye)),gt=Yr(yt,j),Ot=gt.signedDistanceFromCamera>0?gt.point:fi(B,yt,Ue,1,j),dt=Ro(v.writingMode,Ue,Ot,W);if(dt)return dt}var Nt=js(ee*d.getoffsetX(v.glyphStartIndex),Q,le,_,D,B,v.segment,v.lineStartIndex,v.lineStartIndex+v.lineLength,x,f,G);if(!Nt)return{notEnoughRoom:!0};Y=[Nt]}for(var wt=0,Zt=Y;wt<Zt.length;wt+=1){var ft=Zt[wt];L.addDynamicAttributes(M,ft.point,ft.angle)}return{}}function fi(v,w,_,I,j){var f=Yr(v.add(v.sub(w)._unit()),j).point,l=_.sub(f);return _.add(l._mult(I/l.mag()))}function js(v,w,_,I,j,f,l,d,x,M,D,B){var G=I?v-w:v+w,W=G>0?1:-1,Y=0;I&&(W*=-1,Y=Math.PI),W<0&&(Y+=Math.PI);for(var ee=W>0?d+l:d+l+1,Q=j,le=j,de=0,ge=0,xe=Math.abs(G),Te=[];de+ge<=xe;){if((ee+=W)<d||ee>=x)return null;if(le=Q,Te.push(Q),void 0===(Q=B[ee])){var Ee=new L.Point(M.getx(ee),M.gety(ee)),Pe=Yr(Ee,D);if(Pe.signedDistanceFromCamera>0)Q=B[ee]=Pe.point;else{var Le=ee-W;Q=fi(0===de?f:new L.Point(M.getx(Le),M.gety(Le)),Ee,le,xe-de+1,D)}}de+=ge,ge=le.dist(Q)}var Me=(xe-de)/ge,Ue=Q.sub(le),Ye=Ue.mult(Me)._add(le);Ye._add(Ue._unit()._perp()._mult(_*W));var yt=Y+Math.atan2(Q.y-le.y,Q.x-le.x);return Te.push(Ye),{point:Ye,angle:yt,path:Te}}ur.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},ur.prototype.insert=function(v,w,_,I,j){this._forEachCell(w,_,I,j,this._insertBoxCell,this.boxUid++),this.boxKeys.push(v),this.bboxes.push(w),this.bboxes.push(_),this.bboxes.push(I),this.bboxes.push(j)},ur.prototype.insertCircle=function(v,w,_,I){this._forEachCell(w-I,_-I,w+I,_+I,this._insertCircleCell,this.circleUid++),this.circleKeys.push(v),this.circles.push(w),this.circles.push(_),this.circles.push(I)},ur.prototype._insertBoxCell=function(v,w,_,I,j,f){this.boxCells[j].push(f)},ur.prototype._insertCircleCell=function(v,w,_,I,j,f){this.circleCells[j].push(f)},ur.prototype._query=function(v,w,_,I,j,f){if(_<0||v>this.width||I<0||w>this.height)return!j&&[];var l=[];if(v<=0&&w<=0&&this.width<=_&&this.height<=I){if(j)return!0;for(var d=0;d<this.boxKeys.length;d++)l.push({key:this.boxKeys[d],x1:this.bboxes[4*d],y1:this.bboxes[4*d+1],x2:this.bboxes[4*d+2],y2:this.bboxes[4*d+3]});for(var x=0;x<this.circleKeys.length;x++){var M=this.circles[3*x],D=this.circles[3*x+1],B=this.circles[3*x+2];l.push({key:this.circleKeys[x],x1:M-B,y1:D-B,x2:M+B,y2:D+B})}return f?l.filter(f):l}return this._forEachCell(v,w,_,I,this._queryCell,l,{hitTest:j,seenUids:{box:{},circle:{}}},f),j?l.length>0:l},ur.prototype._queryCircle=function(v,w,_,I,j){var f=v-_,l=v+_,d=w-_,x=w+_;if(l<0||f>this.width||x<0||d>this.height)return!I&&[];var M=[];return this._forEachCell(f,d,l,x,this._queryCellCircle,M,{hitTest:I,circle:{x:v,y:w,radius:_},seenUids:{box:{},circle:{}}},j),I?M.length>0:M},ur.prototype.query=function(v,w,_,I,j){return this._query(v,w,_,I,!1,j)},ur.prototype.hitTest=function(v,w,_,I,j){return this._query(v,w,_,I,!0,j)},ur.prototype.hitTestCircle=function(v,w,_,I){return this._queryCircle(v,w,_,!0,I)},ur.prototype._queryCell=function(v,w,_,I,j,f,l,d){var x=l.seenUids,M=this.boxCells[j];if(null!==M)for(var D=this.bboxes,B=0,G=M;B<G.length;B+=1){var W=G[B];if(!x.box[W]){x.box[W]=!0;var Y=4*W;if(v<=D[Y+2]&&w<=D[Y+3]&&_>=D[Y+0]&&I>=D[Y+1]&&(!d||d(this.boxKeys[W]))){if(l.hitTest)return f.push(!0),!0;f.push({key:this.boxKeys[W],x1:D[Y],y1:D[Y+1],x2:D[Y+2],y2:D[Y+3]})}}}var ee=this.circleCells[j];if(null!==ee)for(var Q=this.circles,le=0,de=ee;le<de.length;le+=1){var ge=de[le];if(!x.circle[ge]){x.circle[ge]=!0;var xe=3*ge;if(this._circleAndRectCollide(Q[xe],Q[xe+1],Q[xe+2],v,w,_,I)&&(!d||d(this.circleKeys[ge]))){if(l.hitTest)return f.push(!0),!0;var Te=Q[xe],Ee=Q[xe+1],Pe=Q[xe+2];f.push({key:this.circleKeys[ge],x1:Te-Pe,y1:Ee-Pe,x2:Te+Pe,y2:Ee+Pe})}}}},ur.prototype._queryCellCircle=function(v,w,_,I,j,f,l,d){var x=l.circle,M=l.seenUids,D=this.boxCells[j];if(null!==D)for(var B=this.bboxes,G=0,W=D;G<W.length;G+=1){var Y=W[G];if(!M.box[Y]){M.box[Y]=!0;var ee=4*Y;if(this._circleAndRectCollide(x.x,x.y,x.radius,B[ee+0],B[ee+1],B[ee+2],B[ee+3])&&(!d||d(this.boxKeys[Y])))return f.push(!0),!0}}var Q=this.circleCells[j];if(null!==Q)for(var le=this.circles,de=0,ge=Q;de<ge.length;de+=1){var xe=ge[de];if(!M.circle[xe]){M.circle[xe]=!0;var Te=3*xe;if(this._circlesCollide(le[Te],le[Te+1],le[Te+2],x.x,x.y,x.radius)&&(!d||d(this.circleKeys[xe])))return f.push(!0),!0}}},ur.prototype._forEachCell=function(v,w,_,I,j,f,l,d){for(var x=this._convertToXCellCoord(v),M=this._convertToYCellCoord(w),D=this._convertToXCellCoord(_),B=this._convertToYCellCoord(I),G=x;G<=D;G++)for(var W=M;W<=B;W++)if(j.call(this,v,w,_,I,this.xCellCount*W+G,f,l,d))return},ur.prototype._convertToXCellCoord=function(v){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(v*this.xScale)))},ur.prototype._convertToYCellCoord=function(v){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(v*this.yScale)))},ur.prototype._circlesCollide=function(v,w,_,I,j,f){var l=I-v,d=j-w,x=_+f;return x*x>l*l+d*d},ur.prototype._circleAndRectCollide=function(v,w,_,I,j,f,l){var d=(f-I)/2,x=Math.abs(v-(I+d));if(x>d+_)return!1;var M=(l-j)/2,D=Math.abs(w-(j+M));if(D>M+_)return!1;if(x<=d||D<=M)return!0;var B=x-d,G=D-M;return B*B+G*G<=_*_};var Ya=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Fr(v,w){for(var _=0;_<v;_++){var I=w.length;w.resize(I+4),w.float32.set(Ya,3*I)}}function xl(v,w,_){var I=w[0],j=w[1];return v[0]=_[0]*I+_[4]*j+_[12],v[1]=_[1]*I+_[5]*j+_[13],v[3]=_[3]*I+_[7]*j+_[15],v}var Oi=function(v,w,_){void 0===w&&(w=new ur(v.width+200,v.height+200,25)),void 0===_&&(_=new ur(v.width+200,v.height+200,25)),this.transform=v,this.grid=w,this.ignoredGrid=_,this.pitchfactor=Math.cos(v._pitch)*v.cameraToCenterDistance,this.screenRightBoundary=v.width+100,this.screenBottomBoundary=v.height+100,this.gridRightBoundary=v.width+200,this.gridBottomBoundary=v.height+200};function Mn(v,w,_){return w*(L.EXTENT/(v.tileSize*Math.pow(2,_-v.tileID.overscaledZ)))}Oi.prototype.placeCollisionBox=function(v,w,_,I,j){var f=this.projectAndGetPerspectiveRatio(I,v.anchorPointX,v.anchorPointY),l=_*f.perspectiveRatio,d=v.x1*l+f.point.x,x=v.y1*l+f.point.y,M=v.x2*l+f.point.x,D=v.y2*l+f.point.y;return!this.isInsideGrid(d,x,M,D)||!w&&this.grid.hitTest(d,x,M,D,j)?{box:[],offscreen:!1}:{box:[d,x,M,D],offscreen:this.isOffscreen(d,x,M,D)}},Oi.prototype.placeCollisionCircles=function(v,w,_,I,j,f,l,d,x,M,D,B,G){var W=[],Y=new L.Point(w.anchorX,w.anchorY),ee=Yr(Y,f),Q=lr(this.transform.cameraToCenterDistance,ee.signedDistanceFromCamera),le=(M?j/Q:j*Q)/L.ONE_EM,de=Yr(Y,l).point,ge=yo(le,I,w.lineOffsetX*le,w.lineOffsetY*le,!1,de,Y,w,_,l,{}),xe=!1,Te=!1,Ee=!0;if(ge){for(var Pe=.5*B*Q+G,Le=new L.Point(-100,-100),Me=new L.Point(this.screenRightBoundary,this.screenBottomBoundary),Ue=new qt,Ye=ge.first,yt=ge.last,gt=[],Ot=Ye.path.length-1;Ot>=1;Ot--)gt.push(Ye.path[Ot]);for(var dt=1;dt<yt.path.length;dt++)gt.push(yt.path[dt]);var Nt=2.5*Pe;if(d){var wt=gt.map(function(va){return Yr(va,d)});gt=wt.some(function(va){return va.signedDistanceFromCamera<=0})?[]:wt.map(function(va){return va.point})}var Zt=[];if(gt.length>0){for(var ft=gt[0].clone(),Gt=gt[0].clone(),Qt=1;Qt<gt.length;Qt++)ft.x=Math.min(ft.x,gt[Qt].x),ft.y=Math.min(ft.y,gt[Qt].y),Gt.x=Math.max(Gt.x,gt[Qt].x),Gt.y=Math.max(Gt.y,gt[Qt].y);Zt=ft.x>=Le.x&&Gt.x<=Me.x&&ft.y>=Le.y&&Gt.y<=Me.y?[gt]:Gt.x<Le.x||ft.x>Me.x||Gt.y<Le.y||ft.y>Me.y?[]:L.clipLine([gt],Le.x,Le.y,Me.x,Me.y)}for(var mn=0,Hn=Zt;mn<Hn.length;mn+=1){var gr;Ue.reset(Hn[mn],.25*Pe),gr=Ue.length<=.5*Pe?1:Math.ceil(Ue.paddedLength/Nt)+1;for(var wr=0;wr<gr;wr++){var tr=wr/Math.max(gr-1,1),Cr=Ue.lerp(tr),Wr=Cr.x+100,Zi=Cr.y+100;W.push(Wr,Zi,Pe,0);var ha=Wr-Pe,Do=Zi-Pe,xo=Wr+Pe,Ko=Zi+Pe;if(Ee=Ee&&this.isOffscreen(ha,Do,xo,Ko),Te=Te||this.isInsideGrid(ha,Do,xo,Ko),!v&&this.grid.hitTestCircle(Wr,Zi,Pe,D)&&(xe=!0,!x))return{circles:[],offscreen:!1,collisionDetected:xe}}}}return{circles:!x&&xe||!Te?[]:W,offscreen:Ee,collisionDetected:xe}},Oi.prototype.queryRenderedSymbols=function(v){if(0===v.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var w=[],_=1/0,I=1/0,j=-1/0,f=-1/0,l=0,d=v;l<d.length;l+=1){var x=d[l],M=new L.Point(x.x+100,x.y+100);_=Math.min(_,M.x),I=Math.min(I,M.y),j=Math.max(j,M.x),f=Math.max(f,M.y),w.push(M)}for(var D={},B={},G=0,W=this.grid.query(_,I,j,f).concat(this.ignoredGrid.query(_,I,j,f));G<W.length;G+=1){var Y=W[G],ee=Y.key;if(void 0===D[ee.bucketInstanceId]&&(D[ee.bucketInstanceId]={}),!D[ee.bucketInstanceId][ee.featureIndex]){var Q=[new L.Point(Y.x1,Y.y1),new L.Point(Y.x2,Y.y1),new L.Point(Y.x2,Y.y2),new L.Point(Y.x1,Y.y2)];L.polygonIntersectsPolygon(w,Q)&&(D[ee.bucketInstanceId][ee.featureIndex]=!0,void 0===B[ee.bucketInstanceId]&&(B[ee.bucketInstanceId]=[]),B[ee.bucketInstanceId].push(ee.featureIndex))}}return B},Oi.prototype.insertCollisionBox=function(v,w,_,I,j){(w?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:I,collisionGroupID:j},v[0],v[1],v[2],v[3])},Oi.prototype.insertCollisionCircles=function(v,w,_,I,j){for(var f=w?this.ignoredGrid:this.grid,l={bucketInstanceId:_,featureIndex:I,collisionGroupID:j},d=0;d<v.length;d+=4)f.insertCircle(l,v[d],v[d+1],v[d+2])},Oi.prototype.projectAndGetPerspectiveRatio=function(v,w,_){var I=[w,_,0,1];return xl(I,I,v),{point:new L.Point((I[0]/I[3]+1)/2*this.transform.width+100,(-I[1]/I[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/I[3]*.5}},Oi.prototype.isOffscreen=function(v,w,_,I){return _<100||v>=this.screenRightBoundary||I<100||w>this.screenBottomBoundary},Oi.prototype.isInsideGrid=function(v,w,_,I){return _>=0&&v<this.gridRightBoundary&&I>=0&&w<this.gridBottomBoundary},Oi.prototype.getViewportMatrix=function(){var v=L.identity([]);return L.translate(v,v,[-100,-100,0]),v};var Ai=function(v,w,_,I){this.opacity=v?Math.max(0,Math.min(1,v.opacity+(v.placed?w:-w))):I&&_?1:0,this.placed=_};Ai.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var ls=function(v,w,_,I,j){this.text=new Ai(v?v.text:null,w,_,j),this.icon=new Ai(v?v.icon:null,w,I,j)};ls.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var ga=function(v,w,_){this.text=v,this.icon=w,this.skipFade=_},$o=function(){this.invProjMatrix=L.create(),this.viewportMatrix=L.create(),this.circles=[]},Ts=function(v,w,_,I,j){this.bucketInstanceId=v,this.featureIndex=w,this.sourceLayerIndex=_,this.bucketIndex=I,this.tileID=j},Ka=function(v){this.crossSourceCollisions=v,this.maxGroupID=0,this.collisionGroups={}};function xi(v,w,_,I,j){var f=L.getAnchorAlignment(v),l=-(f.horizontalAlign-.5)*w,d=-(f.verticalAlign-.5)*_,x=L.evaluateVariableOffset(v,I);return new L.Point(l+x[0]*j,d+x[1]*j)}function ua(v,w,_,I,j,f){var l=v.x1,d=v.x2,x=v.y1,M=v.y2,D=v.anchorPointX,B=v.anchorPointY,G=new L.Point(w,_);return I&&G._rotate(j?f:-f),{x1:l+G.x,y1:x+G.y,x2:d+G.x,y2:M+G.y,anchorPointX:D,anchorPointY:B}}Ka.prototype.get=function(v){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[v]){var w=++this.maxGroupID;this.collisionGroups[v]={ID:w,predicate:function(_){return _.collisionGroupID===w}}}return this.collisionGroups[v]};var no=function(v,w,_,I){this.transform=v.clone(),this.collisionIndex=new Oi(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=w,this.retainedQueryData={},this.collisionGroups=new Ka(_),this.collisionCircleArrays={},this.prevPlacement=I,I&&(I.prevPlacement=void 0),this.placedOrientations={}};function ro(v,w,_,I,j){v.emplaceBack(w?1:0,_?1:0,I||0,j||0),v.emplaceBack(w?1:0,_?1:0,I||0,j||0),v.emplaceBack(w?1:0,_?1:0,I||0,j||0),v.emplaceBack(w?1:0,_?1:0,I||0,j||0)}no.prototype.getBucketParts=function(v,w,_,I){var j=_.getBucket(w),f=_.latestFeatureIndex;if(j&&f&&w.id===j.layerIds[0]){var l=_.collisionBoxArray,d=j.layers[0].layout,x=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),M=_.tileSize/L.EXTENT,D=this.transform.calculatePosMatrix(_.tileID.toUnwrapped()),B="map"===d.get("text-pitch-alignment"),G="map"===d.get("text-rotation-alignment"),W=Mn(_,1,this.transform.zoom),Y=wn(D,B,G,this.transform,W),ee=null;if(B){var Q=ri(D,B,G,this.transform,W);ee=L.multiply([],this.transform.labelPlaneMatrix,Q)}this.retainedQueryData[j.bucketInstanceId]=new Ts(j.bucketInstanceId,f,j.sourceLayerIndex,j.index,_.tileID);var le={bucket:j,layout:d,posMatrix:D,textLabelPlaneMatrix:Y,labelToScreenMatrix:ee,scale:x,textPixelRatio:M,holdingForFade:_.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:L.evaluateSizeForZoom(j.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(j.sourceID)};if(I)for(var de=0,ge=j.sortKeyRanges;de<ge.length;de+=1){var xe=ge[de];v.push({sortKey:xe.sortKey,symbolInstanceStart:xe.symbolInstanceStart,symbolInstanceEnd:xe.symbolInstanceEnd,parameters:le})}else v.push({symbolInstanceStart:0,symbolInstanceEnd:j.symbolInstances.length,parameters:le})}},no.prototype.attemptAnchorPlacement=function(v,w,_,I,j,f,l,d,x,M,D,B,G,W,Y){var ee,Q=[B.textOffset0,B.textOffset1],le=xi(v,_,I,Q,j),de=this.collisionIndex.placeCollisionBox(ua(w,le.x,le.y,f,l,this.transform.angle),D,d,x,M.predicate);if(!Y||0!==this.collisionIndex.placeCollisionBox(ua(Y,le.x,le.y,f,l,this.transform.angle),D,d,x,M.predicate).box.length)return de.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID].text&&(ee=this.prevPlacement.variableOffsets[B.crossTileID].anchor),this.variableOffsets[B.crossTileID]={textOffset:Q,width:_,height:I,anchor:v,textBoxScale:j,prevAnchor:ee},this.markUsedJustification(G,v,B,W),G.allowVerticalPlacement&&(this.markUsedOrientation(G,W,B),this.placedOrientations[B.crossTileID]=W),{shift:le,placedGlyphBoxes:de}):void 0},no.prototype.placeLayerBucketPart=function(v,w,_){var I=this,j=v.parameters,f=j.bucket,l=j.layout,d=j.posMatrix,x=j.textLabelPlaneMatrix,M=j.labelToScreenMatrix,D=j.textPixelRatio,B=j.holdingForFade,G=j.collisionBoxArray,W=j.partiallyEvaluatedTextSize,Y=j.collisionGroup,ee=l.get("text-optional"),Q=l.get("icon-optional"),le=l.get("text-allow-overlap"),de=l.get("icon-allow-overlap"),ge="map"===l.get("text-rotation-alignment"),xe="map"===l.get("text-pitch-alignment"),Te="none"!==l.get("icon-text-fit"),Ee="viewport-y"===l.get("symbol-z-order"),Pe=le&&(de||!f.hasIconData()||Q),Le=de&&(le||!f.hasTextData()||ee);!f.collisionArrays&&G&&f.deserializeCollisionBoxes(G);var Me=function(dt,Nt){if(!w[dt.crossTileID])if(B)I.placements[dt.crossTileID]=new ga(!1,!1,!1);else{var wt,Zt=!1,ft=!1,Gt=!0,Qt=null,mn={box:null,offscreen:null},Hn={box:null,offscreen:null},gr=null,wr=null,tr=0,Cr=0,Wr=0;Nt.textFeatureIndex?tr=Nt.textFeatureIndex:dt.useRuntimeCollisionCircles&&(tr=dt.featureIndex),Nt.verticalTextFeatureIndex&&(Cr=Nt.verticalTextFeatureIndex);var Zi=Nt.textBox;if(Zi){var ha=function(Pt){var cn=L.WritingMode.horizontal;if(f.allowVerticalPlacement&&!Pt&&I.prevPlacement){var Sn=I.prevPlacement.placedOrientations[dt.crossTileID];Sn&&(I.placedOrientations[dt.crossTileID]=Sn,I.markUsedOrientation(f,cn=Sn,dt))}return cn},Do=function(Pt,cn){if(f.allowVerticalPlacement&&dt.numVerticalGlyphVertices>0&&Nt.verticalTextBox)for(var Sn=0,ar=f.writingModes;Sn<ar.length&&(ar[Sn]===L.WritingMode.vertical?(mn=cn(),Hn=mn):mn=Pt(),!(mn&&mn.box&&mn.box.length));Sn+=1);else mn=Pt()};if(l.get("text-variable-anchor")){var xo=l.get("text-variable-anchor");if(I.prevPlacement&&I.prevPlacement.variableOffsets[dt.crossTileID]){var Ko=I.prevPlacement.variableOffsets[dt.crossTileID];xo.indexOf(Ko.anchor)>0&&(xo=xo.filter(function(Pt){return Pt!==Ko.anchor})).unshift(Ko.anchor)}var va=function(Pt,cn,Sn){for(var ar=Pt.x2-Pt.x1,xn=Pt.y2-Pt.y1,Xr=dt.textBoxScale,Sr=Te&&!de?cn:null,en={box:[],offscreen:!1},Vn=le?2*xo.length:xo.length,yr=0;yr<Vn;++yr){var Br=I.attemptAnchorPlacement(xo[yr%xo.length],Pt,ar,xn,Xr,ge,xe,D,d,Y,yr>=xo.length,dt,f,Sn,Sr);if(Br&&(en=Br.placedGlyphBoxes)&&en.box&&en.box.length){Zt=!0,Qt=Br.shift;break}}return en};Do(function(){return va(Zi,Nt.iconBox,L.WritingMode.horizontal)},function(){var Pt=Nt.verticalTextBox;return f.allowVerticalPlacement&&!(mn&&mn.box&&mn.box.length)&&dt.numVerticalGlyphVertices>0&&Pt?va(Pt,Nt.verticalIconBox,L.WritingMode.vertical):{box:null,offscreen:null}}),mn&&(Zt=mn.box,Gt=mn.offscreen);var Tu=ha(mn&&mn.box);if(!Zt&&I.prevPlacement){var O=I.prevPlacement.variableOffsets[dt.crossTileID];O&&(I.variableOffsets[dt.crossTileID]=O,I.markUsedJustification(f,O.anchor,dt,Tu))}}else{var P=function(Pt,cn){var Sn=I.collisionIndex.placeCollisionBox(Pt,le,D,d,Y.predicate);return Sn&&Sn.box&&Sn.box.length&&(I.markUsedOrientation(f,cn,dt),I.placedOrientations[dt.crossTileID]=cn),Sn};Do(function(){return P(Zi,L.WritingMode.horizontal)},function(){var Pt=Nt.verticalTextBox;return f.allowVerticalPlacement&&dt.numVerticalGlyphVertices>0&&Pt?P(Pt,L.WritingMode.vertical):{box:null,offscreen:null}}),ha(mn&&mn.box&&mn.box.length)}}if(Zt=(wt=mn)&&wt.box&&wt.box.length>0,Gt=wt&&wt.offscreen,dt.useRuntimeCollisionCircles){var z=f.text.placedSymbolArray.get(dt.centerJustifiedTextSymbolIndex),K=L.evaluateSizeForFeature(f.textSizeData,W,z),he=l.get("text-padding");gr=I.collisionIndex.placeCollisionCircles(le,z,f.lineVertexArray,f.glyphOffsetArray,K,d,x,M,_,xe,Y.predicate,dt.collisionCircleDiameter,he),Zt=le||gr.circles.length>0&&!gr.collisionDetected,Gt=Gt&&gr.offscreen}if(Nt.iconFeatureIndex&&(Wr=Nt.iconFeatureIndex),Nt.iconBox){var fe=function(Pt){var cn=Te&&Qt?ua(Pt,Qt.x,Qt.y,ge,xe,I.transform.angle):Pt;return I.collisionIndex.placeCollisionBox(cn,de,D,d,Y.predicate)};ft=Hn&&Hn.box&&Hn.box.length&&Nt.verticalIconBox?(wr=fe(Nt.verticalIconBox)).box.length>0:(wr=fe(Nt.iconBox)).box.length>0,Gt=Gt&&wr.offscreen}var Ie=ee||0===dt.numHorizontalGlyphVertices&&0===dt.numVerticalGlyphVertices,Fe=Q||0===dt.numIconVertices;if(Ie||Fe?Fe?Ie||(ft=ft&&Zt):Zt=ft&&Zt:ft=Zt=ft&&Zt,Zt&&wt&&wt.box&&I.collisionIndex.insertCollisionBox(wt.box,l.get("text-ignore-placement"),f.bucketInstanceId,Hn&&Hn.box&&Cr?Cr:tr,Y.ID),ft&&wr&&I.collisionIndex.insertCollisionBox(wr.box,l.get("icon-ignore-placement"),f.bucketInstanceId,Wr,Y.ID),gr&&(Zt&&I.collisionIndex.insertCollisionCircles(gr.circles,l.get("text-ignore-placement"),f.bucketInstanceId,tr,Y.ID),_)){var at=f.bucketInstanceId,nt=I.collisionCircleArrays[at];void 0===nt&&(nt=I.collisionCircleArrays[at]=new $o);for(var jt=0;jt<gr.circles.length;jt+=4)nt.circles.push(gr.circles[jt+0]),nt.circles.push(gr.circles[jt+1]),nt.circles.push(gr.circles[jt+2]),nt.circles.push(gr.collisionDetected?1:0)}I.placements[dt.crossTileID]=new ga(Zt||Pe,ft||Le,Gt||f.justReloaded),w[dt.crossTileID]=!0}};if(Ee)for(var Ue=f.getSortedSymbolIndexes(this.transform.angle),Ye=Ue.length-1;Ye>=0;--Ye){var yt=Ue[Ye];Me(f.symbolInstances.get(yt),f.collisionArrays[yt])}else for(var gt=v.symbolInstanceStart;gt<v.symbolInstanceEnd;gt++)Me(f.symbolInstances.get(gt),f.collisionArrays[gt]);if(_&&f.bucketInstanceId in this.collisionCircleArrays){var Ot=this.collisionCircleArrays[f.bucketInstanceId];L.invert(Ot.invProjMatrix,d),Ot.viewportMatrix=this.collisionIndex.getViewportMatrix()}f.justReloaded=!1},no.prototype.markUsedJustification=function(v,w,_,I){var j;j=I===L.WritingMode.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[L.getAnchorJustification(w)];for(var f=0,l=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];f<l.length;f+=1){var d=l[f];d>=0&&(v.text.placedSymbolArray.get(d).crossTileID=j>=0&&d!==j?0:_.crossTileID)}},no.prototype.markUsedOrientation=function(v,w,_){for(var I=w===L.WritingMode.horizontal||w===L.WritingMode.horizontalOnly?w:0,j=w===L.WritingMode.vertical?w:0,f=0,l=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];f<l.length;f+=1)v.text.placedSymbolArray.get(l[f]).placedOrientation=I;_.verticalPlacedTextSymbolIndex&&(v.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=j)},no.prototype.commit=function(v){this.commitTime=v,this.zoomAtLastRecencyCheck=this.transform.zoom;var w=this.prevPlacement,_=!1;this.prevZoomAdjustment=w?w.zoomAdjustment(this.transform.zoom):0;var I=w?w.symbolFadeChange(v):1,j=w?w.opacities:{},f=w?w.variableOffsets:{},l=w?w.placedOrientations:{};for(var d in this.placements){var x=this.placements[d],M=j[d];M?(this.opacities[d]=new ls(M,I,x.text,x.icon),_=_||x.text!==M.text.placed||x.icon!==M.icon.placed):(this.opacities[d]=new ls(null,I,x.text,x.icon,x.skipFade),_=_||x.text||x.icon)}for(var D in j){var B=j[D];if(!this.opacities[D]){var G=new ls(B,I,!1,!1);G.isHidden()||(this.opacities[D]=G,_=_||B.text.placed||B.icon.placed)}}for(var W in f)this.variableOffsets[W]||!this.opacities[W]||this.opacities[W].isHidden()||(this.variableOffsets[W]=f[W]);for(var Y in l)this.placedOrientations[Y]||!this.opacities[Y]||this.opacities[Y].isHidden()||(this.placedOrientations[Y]=l[Y]);_?this.lastPlacementChangeTime=v:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=w?w.lastPlacementChangeTime:v)},no.prototype.updateLayerOpacities=function(v,w){for(var _={},I=0,j=w;I<j.length;I+=1){var f=j[I],l=f.getBucket(v);l&&f.latestFeatureIndex&&v.id===l.layerIds[0]&&this.updateBucketOpacities(l,_,f.collisionBoxArray)}},no.prototype.updateBucketOpacities=function(v,w,_){var I=this;v.hasTextData()&&v.text.opacityVertexArray.clear(),v.hasIconData()&&v.icon.opacityVertexArray.clear(),v.hasIconCollisionBoxData()&&v.iconCollisionBox.collisionVertexArray.clear(),v.hasTextCollisionBoxData()&&v.textCollisionBox.collisionVertexArray.clear();var j=v.layers[0].layout,f=new ls(null,0,!1,!1,!0),l=j.get("text-allow-overlap"),d=j.get("icon-allow-overlap"),x=j.get("text-variable-anchor"),M="map"===j.get("text-rotation-alignment"),D="map"===j.get("text-pitch-alignment"),B="none"!==j.get("icon-text-fit"),G=new ls(null,0,l&&(d||!v.hasIconData()||j.get("icon-optional")),d&&(l||!v.hasTextData()||j.get("text-optional")),!0);!v.collisionArrays&&_&&(v.hasIconCollisionBoxData()||v.hasTextCollisionBoxData())&&v.deserializeCollisionBoxes(_);for(var W=function(le,de,ge){for(var xe=0;xe<de/4;xe++)le.opacityVertexArray.emplaceBack(ge)},Y=function(le){var de=v.symbolInstances.get(le),ge=de.numHorizontalGlyphVertices,xe=de.numVerticalGlyphVertices,Te=de.crossTileID,Ee=I.opacities[Te];w[Te]?Ee=f:Ee||(I.opacities[Te]=Ee=G),w[Te]=!0;var Pe=de.numIconVertices>0,Le=I.placedOrientations[de.crossTileID],Me=Le===L.WritingMode.vertical,Ue=Le===L.WritingMode.horizontal||Le===L.WritingMode.horizontalOnly;if(ge>0||xe>0){var Ye=Gh(Ee.text);W(v.text,ge,Me?Yi:Ye),W(v.text,xe,Ue?Yi:Ye);var yt=Ee.text.isHidden();[de.rightJustifiedTextSymbolIndex,de.centerJustifiedTextSymbolIndex,de.leftJustifiedTextSymbolIndex].forEach(function(mn){mn>=0&&(v.text.placedSymbolArray.get(mn).hidden=yt||Me?1:0)}),de.verticalPlacedTextSymbolIndex>=0&&(v.text.placedSymbolArray.get(de.verticalPlacedTextSymbolIndex).hidden=yt||Ue?1:0);var gt=I.variableOffsets[de.crossTileID];gt&&I.markUsedJustification(v,gt.anchor,de,Le);var Ot=I.placedOrientations[de.crossTileID];Ot&&(I.markUsedJustification(v,"left",de,Ot),I.markUsedOrientation(v,Ot,de))}if(Pe){var dt=Gh(Ee.icon),Nt=!(B&&de.verticalPlacedIconSymbolIndex&&Me);de.placedIconSymbolIndex>=0&&(W(v.icon,de.numIconVertices,Nt?dt:Yi),v.icon.placedSymbolArray.get(de.placedIconSymbolIndex).hidden=Ee.icon.isHidden()),de.verticalPlacedIconSymbolIndex>=0&&(W(v.icon,de.numVerticalIconVertices,Nt?Yi:dt),v.icon.placedSymbolArray.get(de.verticalPlacedIconSymbolIndex).hidden=Ee.icon.isHidden())}if(v.hasIconCollisionBoxData()||v.hasTextCollisionBoxData()){var wt=v.collisionArrays[le];if(wt){var Zt=new L.Point(0,0);if(wt.textBox||wt.verticalTextBox){var ft=!0;if(x){var Gt=I.variableOffsets[Te];Gt?(Zt=xi(Gt.anchor,Gt.width,Gt.height,Gt.textOffset,Gt.textBoxScale),M&&Zt._rotate(D?I.transform.angle:-I.transform.angle)):ft=!1}wt.textBox&&ro(v.textCollisionBox.collisionVertexArray,Ee.text.placed,!ft||Me,Zt.x,Zt.y),wt.verticalTextBox&&ro(v.textCollisionBox.collisionVertexArray,Ee.text.placed,!ft||Ue,Zt.x,Zt.y)}var Qt=Boolean(!Ue&&wt.verticalIconBox);wt.iconBox&&ro(v.iconCollisionBox.collisionVertexArray,Ee.icon.placed,Qt,B?Zt.x:0,B?Zt.y:0),wt.verticalIconBox&&ro(v.iconCollisionBox.collisionVertexArray,Ee.icon.placed,!Qt,B?Zt.x:0,B?Zt.y:0)}}},ee=0;ee<v.symbolInstances.length;ee++)Y(ee);if(v.sortFeatures(this.transform.angle),this.retainedQueryData[v.bucketInstanceId]&&(this.retainedQueryData[v.bucketInstanceId].featureSortOrder=v.featureSortOrder),v.hasTextData()&&v.text.opacityVertexBuffer&&v.text.opacityVertexBuffer.updateData(v.text.opacityVertexArray),v.hasIconData()&&v.icon.opacityVertexBuffer&&v.icon.opacityVertexBuffer.updateData(v.icon.opacityVertexArray),v.hasIconCollisionBoxData()&&v.iconCollisionBox.collisionVertexBuffer&&v.iconCollisionBox.collisionVertexBuffer.updateData(v.iconCollisionBox.collisionVertexArray),v.hasTextCollisionBoxData()&&v.textCollisionBox.collisionVertexBuffer&&v.textCollisionBox.collisionVertexBuffer.updateData(v.textCollisionBox.collisionVertexArray),v.bucketInstanceId in this.collisionCircleArrays){var Q=this.collisionCircleArrays[v.bucketInstanceId];v.placementInvProjMatrix=Q.invProjMatrix,v.placementViewportMatrix=Q.viewportMatrix,v.collisionCircleArray=Q.circles,delete this.collisionCircleArrays[v.bucketInstanceId]}},no.prototype.symbolFadeChange=function(v){return 0===this.fadeDuration?1:(v-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},no.prototype.zoomAdjustment=function(v){return Math.max(0,(this.transform.zoom-v)/1.5)},no.prototype.hasTransitions=function(v){return this.stale||v-this.lastPlacementChangeTime<this.fadeDuration},no.prototype.stillRecent=function(v,w){var _=this.zoomAtLastRecencyCheck===w?1-this.zoomAdjustment(w):1;return this.zoomAtLastRecencyCheck=w,this.commitTime+this.fadeDuration*_>v},no.prototype.setStale=function(){this.stale=!0};var xh=Math.pow(2,25),Ac=Math.pow(2,24),ec=Math.pow(2,17),kp=Math.pow(2,16),sf=Math.pow(2,9),Us=Math.pow(2,8),Uf=Math.pow(2,1);function Gh(v){if(0===v.opacity&&!v.placed)return 0;if(1===v.opacity&&v.placed)return 4294967295;var w=v.placed?1:0,_=Math.floor(127*v.opacity);return _*xh+w*Ac+_*ec+w*kp+_*sf+w*Us+_*Uf+w}var Yi=0,Eo=function(v){this._sortAcrossTiles="viewport-y"!==v.layout.get("symbol-z-order")&&!v.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Eo.prototype.continuePlacement=function(v,w,_,I,j){for(var f=this._bucketParts;this._currentTileIndex<v.length;)if(w.getBucketParts(f,I,v[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,j())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,f.sort(function(l,d){return l.sortKey-d.sortKey}));this._currentPartIndex<f.length;)if(w.placeLayerBucketPart(f[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,j())return!0;return!1};var tc=function(v,w,_,I,j,f,l){this.placement=new no(v,j,f,l),this._currentPlacementIndex=w.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=I,this._done=!1};tc.prototype.isDone=function(){return this._done},tc.prototype.continuePlacement=function(v,w,_){for(var I=this,j=L.browser.now(),f=function(){var x=L.browser.now()-j;return!I._forceFullPlacement&&x>2};this._currentPlacementIndex>=0;){var l=w[v[this._currentPlacementIndex]],d=this.placement.collisionIndex.transform.zoom;if("symbol"===l.type&&(!l.minzoom||l.minzoom<=d)&&(!l.maxzoom||l.maxzoom>d)){if(this._inProgressLayer||(this._inProgressLayer=new Eo(l)),this._inProgressLayer.continuePlacement(_[l.source],this.placement,this._showCollisionBoxes,l,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},tc.prototype.commit=function(v){return this.placement.commit(v),this.placement};var Sd=512/L.EXTENT/2,eh=function(v,w,_){this.tileID=v,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(var I=0;I<w.length;I++){var j=w.get(I),f=j.key;this.indexedSymbolInstances[f]||(this.indexedSymbolInstances[f]=[]),this.indexedSymbolInstances[f].push({crossTileID:j.crossTileID,coord:this.getScaledCoordinates(j,v)})}};eh.prototype.getScaledCoordinates=function(v,w){var _=Sd/Math.pow(2,w.canonical.z-this.tileID.canonical.z);return{x:Math.floor((w.canonical.x*L.EXTENT+v.anchorX)*_),y:Math.floor((w.canonical.y*L.EXTENT+v.anchorY)*_)}},eh.prototype.findMatches=function(v,w,_){for(var I=this.tileID.canonical.z<w.canonical.z?1:Math.pow(2,this.tileID.canonical.z-w.canonical.z),j=0;j<v.length;j++){var f=v.get(j);if(!f.crossTileID){var l=this.indexedSymbolInstances[f.key];if(l)for(var d=this.getScaledCoordinates(f,w),x=0,M=l;x<M.length;x+=1){var D=M[x];if(Math.abs(D.coord.x-d.x)<=I&&Math.abs(D.coord.y-d.y)<=I&&!_[D.crossTileID]){_[D.crossTileID]=!0,f.crossTileID=D.crossTileID;break}}}}};var Hr=function(){this.maxCrossTileID=0};Hr.prototype.generate=function(){return++this.maxCrossTileID};var Ql=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Ql.prototype.handleWrapJump=function(v){var w=Math.round((v-this.lng)/360);if(0!==w)for(var _ in this.indexes){var I=this.indexes[_],j={};for(var f in I){var l=I[f];l.tileID=l.tileID.unwrapTo(l.tileID.wrap+w),j[l.tileID.key]=l}this.indexes[_]=j}this.lng=v},Ql.prototype.addBucket=function(v,w,_){if(this.indexes[v.overscaledZ]&&this.indexes[v.overscaledZ][v.key]){if(this.indexes[v.overscaledZ][v.key].bucketInstanceId===w.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(v.overscaledZ,this.indexes[v.overscaledZ][v.key])}for(var I=0;I<w.symbolInstances.length;I++)w.symbolInstances.get(I).crossTileID=0;this.usedCrossTileIDs[v.overscaledZ]||(this.usedCrossTileIDs[v.overscaledZ]={});var j=this.usedCrossTileIDs[v.overscaledZ];for(var f in this.indexes){var l=this.indexes[f];if(Number(f)>v.overscaledZ)for(var d in l){var x=l[d];x.tileID.isChildOf(v)&&x.findMatches(w.symbolInstances,v,j)}else{var M=l[v.scaledTo(Number(f)).key];M&&M.findMatches(w.symbolInstances,v,j)}}for(var D=0;D<w.symbolInstances.length;D++){var B=w.symbolInstances.get(D);B.crossTileID||(B.crossTileID=_.generate(),j[B.crossTileID]=!0)}return void 0===this.indexes[v.overscaledZ]&&(this.indexes[v.overscaledZ]={}),this.indexes[v.overscaledZ][v.key]=new eh(v,w.symbolInstances,w.bucketInstanceId),!0},Ql.prototype.removeBucketCrossTileIDs=function(v,w){for(var _ in w.indexedSymbolInstances)for(var I=0,j=w.indexedSymbolInstances[_];I<j.length;I+=1)delete this.usedCrossTileIDs[v][j[I].crossTileID]},Ql.prototype.removeStaleBuckets=function(v){var w=!1;for(var _ in this.indexes){var I=this.indexes[_];for(var j in I)v[I[j].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,I[j]),delete I[j],w=!0)}return w};var io=function(){this.layerIndexes={},this.crossTileIDs=new Hr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};io.prototype.addLayer=function(v,w,_){var I=this.layerIndexes[v.id];void 0===I&&(I=this.layerIndexes[v.id]=new Ql);var j=!1,f={};I.handleWrapJump(_);for(var l=0,d=w;l<d.length;l+=1){var x=d[l],M=x.getBucket(v);M&&v.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),I.addBucket(x.tileID,M,this.crossTileIDs)&&(j=!0),f[M.bucketInstanceId]=!0)}return I.removeStaleBuckets(f)&&(j=!0),j},io.prototype.pruneUnusedLayers=function(v){var w={};for(var _ in v.forEach(function(I){w[I]=!0}),this.layerIndexes)w[_]||delete this.layerIndexes[_]};var Fl=function(v,w){return L.emitValidationErrors(v,w&&w.filter(function(_){return"source.canvas"!==_.identifier}))},up=L.pick(ot,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),bh=L.pick(ot,["setCenter","setZoom","setBearing","setPitch"]),Dc=function(){var v={},w=L.styleSpec.$version;for(var _ in L.styleSpec.$root){var I,j=L.styleSpec.$root[_];j.required&&null!=(I="version"===_?w:"array"===j.type?[]:{})&&(v[_]=I)}return v}(),kc=function(v){function w(_,I){var j=this;void 0===I&&(I={}),v.call(this),this.map=_,this.dispatcher=new qr(Xt(),this),this.imageManager=new et,this.imageManager.setEventedParent(this),this.glyphManager=new nr(_._requestManager,I.localIdeographFontFamily),this.lineAtlas=new sr(256,512),this.crossTileSymbolIndex=new io,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new L.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",L.getReferrer());var f=this;this._rtlTextPluginCallback=w.registerForPluginStateChange(function(l){f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:l.pluginStatus,pluginURL:l.pluginURL},function(d,x){if(L.triggerPluginCompletionEvent(d),x&&x.every(function(D){return D}))for(var M in f.sourceCaches)f.sourceCaches[M].reload()})}),this.on("data",function(l){if("source"===l.dataType&&"metadata"===l.sourceDataType){var d=j.sourceCaches[l.sourceId];if(d){var x=d.getSource();if(x&&x.vectorLayerIds)for(var M in j._layers){var D=j._layers[M];D.source===x.id&&j._validateLayer(D)}}}})}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.loadURL=function(_,I){var j=this;void 0===I&&(I={}),this.fire(new L.Event("dataloading",{dataType:"style"}));var f="boolean"==typeof I.validate?I.validate:!L.isMapboxURL(_);_=this.map._requestManager.normalizeStyleURL(_,I.accessToken);var l=this.map._requestManager.transformRequest(_,L.ResourceType.Style);this._request=L.getJSON(l,function(d,x){j._request=null,d?j.fire(new L.ErrorEvent(d)):x&&j._load(x,f)})},w.prototype.loadJSON=function(_,I){var j=this;void 0===I&&(I={}),this.fire(new L.Event("dataloading",{dataType:"style"})),this._request=L.browser.frame(function(){j._request=null,j._load(_,!1!==I.validate)})},w.prototype.loadEmpty=function(){this.fire(new L.Event("dataloading",{dataType:"style"})),this._load(Dc,!1)},w.prototype._load=function(_,I){if(!I||!Fl(this,L.validateStyle(_))){for(var j in this._loaded=!0,this.stylesheet=_,_.sources)this.addSource(j,_.sources[j],{validate:!1});_.sprite?this._loadSprite(_.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(_.glyphs);var f=Je(this.stylesheet.layers);this._order=f.map(function(M){return M.id}),this._layers={},this._serializedLayers={};for(var l=0,d=f;l<d.length;l+=1){var x=d[l];(x=L.createStyleLayer(x)).setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new pn(this.stylesheet.light),this.fire(new L.Event("data",{dataType:"style"})),this.fire(new L.Event("style.load"))}},w.prototype._loadSprite=function(_){var I=this;this._spriteRequest=function(j,f,l){var d,x,M,D=L.browser.devicePixelRatio>1?"@2x":"",B=L.getJSON(f.transformRequest(f.normalizeSpriteURL(j,D,".json"),L.ResourceType.SpriteJSON),function(Y,ee){B=null,M||(M=Y,d=ee,W())}),G=L.getImage(f.transformRequest(f.normalizeSpriteURL(j,D,".png"),L.ResourceType.SpriteImage),function(Y,ee){G=null,M||(M=Y,x=ee,W())});function W(){if(M)l(M);else if(d&&x){var Y=L.browser.getImageData(x),ee={};for(var Q in d){var le=d[Q],de=le.width,ge=le.height,xe=le.x,Te=le.y,Ee=le.sdf,Pe=le.pixelRatio,Le=le.stretchX,Me=le.stretchY,Ue=le.content,Ye=new L.RGBAImage({width:de,height:ge});L.RGBAImage.copy(Y,Ye,{x:xe,y:Te},{x:0,y:0},{width:de,height:ge}),ee[Q]={data:Ye,pixelRatio:Pe,sdf:Ee,stretchX:Le,stretchY:Me,content:Ue}}l(null,ee)}}return{cancel:function(){B&&(B.cancel(),B=null),G&&(G.cancel(),G=null)}}}(_,this.map._requestManager,function(j,f){if(I._spriteRequest=null,j)I.fire(new L.ErrorEvent(j));else if(f)for(var l in f)I.imageManager.addImage(l,f[l]);I.imageManager.setLoaded(!0),I._availableImages=I.imageManager.listImages(),I.dispatcher.broadcast("setImages",I._availableImages),I.fire(new L.Event("data",{dataType:"style"}))})},w.prototype._validateLayer=function(_){var I=this.sourceCaches[_.source];if(I){var j=_.sourceLayer;if(j){var f=I.getSource();("geojson"===f.type||f.vectorLayerIds&&-1===f.vectorLayerIds.indexOf(j))&&this.fire(new L.ErrorEvent(new Error('Source layer "'+j+'" does not exist on source "'+f.id+'" as specified by style layer "'+_.id+'"')))}}},w.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var _ in this.sourceCaches)if(!this.sourceCaches[_].loaded())return!1;return!!this.imageManager.isLoaded()},w.prototype._serializeLayers=function(_){for(var I=[],j=0,f=_;j<f.length;j+=1){var l=this._layers[f[j]];"custom"!==l.type&&I.push(l.serialize())}return I},w.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var _ in this.sourceCaches)if(this.sourceCaches[_].hasTransition())return!0;for(var I in this._layers)if(this._layers[I].hasTransition())return!0;return!1},w.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},w.prototype.update=function(_){if(this._loaded){var I=this._changed;if(this._changed){var j=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);for(var l in(j.length||f.length)&&this._updateWorkerLayers(j,f),this._updatedSources){var d=this._updatedSources[l];"reload"===d?this._reloadSource(l):"clear"===d&&this._clearSource(l)}for(var x in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[x].updateTransitions(_);this.light.updateTransitions(_),this._resetUpdates()}var M={};for(var D in this.sourceCaches){var B=this.sourceCaches[D];M[D]=B.used,B.used=!1}for(var G=0,W=this._order;G<W.length;G+=1){var Y=this._layers[W[G]];Y.recalculate(_,this._availableImages),!Y.isHidden(_.zoom)&&Y.source&&(this.sourceCaches[Y.source].used=!0)}for(var ee in M){var Q=this.sourceCaches[ee];M[ee]!==Q.used&&Q.fire(new L.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ee}))}this.light.recalculate(_),this.z=_.zoom,I&&this.fire(new L.Event("data",{dataType:"style"}))}},w.prototype._updateTilesForChangedImages=function(){var _=Object.keys(this._changedImages);if(_.length){for(var I in this.sourceCaches)this.sourceCaches[I].reloadTilesForDependencies(["icons","patterns"],_);this._changedImages={}}},w.prototype._updateWorkerLayers=function(_,I){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(_),removedIds:I})},w.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},w.prototype.setState=function(_){var I=this;if(this._checkLoaded(),Fl(this,L.validateStyle(_)))return!1;(_=L.clone$1(_)).layers=Je(_.layers);var j=function(l,d){if(!l)return[{command:ot.setStyle,args:[d]}];var x=[];try{if(!L.deepEqual(l.version,d.version))return[{command:ot.setStyle,args:[d]}];L.deepEqual(l.center,d.center)||x.push({command:ot.setCenter,args:[d.center]}),L.deepEqual(l.zoom,d.zoom)||x.push({command:ot.setZoom,args:[d.zoom]}),L.deepEqual(l.bearing,d.bearing)||x.push({command:ot.setBearing,args:[d.bearing]}),L.deepEqual(l.pitch,d.pitch)||x.push({command:ot.setPitch,args:[d.pitch]}),L.deepEqual(l.sprite,d.sprite)||x.push({command:ot.setSprite,args:[d.sprite]}),L.deepEqual(l.glyphs,d.glyphs)||x.push({command:ot.setGlyphs,args:[d.glyphs]}),L.deepEqual(l.transition,d.transition)||x.push({command:ot.setTransition,args:[d.transition]}),L.deepEqual(l.light,d.light)||x.push({command:ot.setLight,args:[d.light]});var M={},D=[];!function(G,W,Y,ee){var Q;for(Q in W=W||{},G=G||{})G.hasOwnProperty(Q)&&(W.hasOwnProperty(Q)||Bn(Q,Y,ee));for(Q in W)W.hasOwnProperty(Q)&&(G.hasOwnProperty(Q)?L.deepEqual(G[Q],W[Q])||("geojson"===G[Q].type&&"geojson"===W[Q].type&&br(G,W,Q)?Y.push({command:ot.setGeoJSONSourceData,args:[Q,W[Q].data]}):sn(Q,W,Y,ee)):On(Q,W,Y))}(l.sources,d.sources,D,M);var B=[];l.layers&&l.layers.forEach(function(G){M[G.source]?x.push({command:ot.removeLayer,args:[G.id]}):B.push(G)}),x=x.concat(D),function(G,W,Y){W=W||[];var ee,Q,le,de,ge,xe,Te,Ee=(G=G||[]).map(mr),Pe=W.map(mr),Le=G.reduce(or,{}),Me=W.reduce(or,{}),Ue=Ee.slice(),Ye=Object.create(null);for(ee=0,Q=0;ee<Ee.length;ee++)Me.hasOwnProperty(le=Ee[ee])?Q++:(Y.push({command:ot.removeLayer,args:[le]}),Ue.splice(Ue.indexOf(le,Q),1));for(ee=0,Q=0;ee<Pe.length;ee++)Ue[Ue.length-1-ee]!==(le=Pe[Pe.length-1-ee])&&(Le.hasOwnProperty(le)?(Y.push({command:ot.removeLayer,args:[le]}),Ue.splice(Ue.lastIndexOf(le,Ue.length-Q),1)):Q++,Y.push({command:ot.addLayer,args:[Me[le],xe=Ue[Ue.length-ee]]}),Ue.splice(Ue.length-ee,0,le),Ye[le]=!0);for(ee=0;ee<Pe.length;ee++)if(de=Le[le=Pe[ee]],ge=Me[le],!Ye[le]&&!L.deepEqual(de,ge))if(L.deepEqual(de.source,ge.source)&&L.deepEqual(de["source-layer"],ge["source-layer"])&&L.deepEqual(de.type,ge.type)){for(Te in Ft(de.layout,ge.layout,Y,le,null,ot.setLayoutProperty),Ft(de.paint,ge.paint,Y,le,null,ot.setPaintProperty),L.deepEqual(de.filter,ge.filter)||Y.push({command:ot.setFilter,args:[le,ge.filter]}),L.deepEqual(de.minzoom,ge.minzoom)&&L.deepEqual(de.maxzoom,ge.maxzoom)||Y.push({command:ot.setLayerZoomRange,args:[le,ge.minzoom,ge.maxzoom]}),de)de.hasOwnProperty(Te)&&"layout"!==Te&&"paint"!==Te&&"filter"!==Te&&"metadata"!==Te&&"minzoom"!==Te&&"maxzoom"!==Te&&(0===Te.indexOf("paint.")?Ft(de[Te],ge[Te],Y,le,Te.slice(6),ot.setPaintProperty):L.deepEqual(de[Te],ge[Te])||Y.push({command:ot.setLayerProperty,args:[le,Te,ge[Te]]}));for(Te in ge)ge.hasOwnProperty(Te)&&!de.hasOwnProperty(Te)&&"layout"!==Te&&"paint"!==Te&&"filter"!==Te&&"metadata"!==Te&&"minzoom"!==Te&&"maxzoom"!==Te&&(0===Te.indexOf("paint.")?Ft(de[Te],ge[Te],Y,le,Te.slice(6),ot.setPaintProperty):L.deepEqual(de[Te],ge[Te])||Y.push({command:ot.setLayerProperty,args:[le,Te,ge[Te]]}))}else Y.push({command:ot.removeLayer,args:[le]}),xe=Ue[Ue.lastIndexOf(le)+1],Y.push({command:ot.addLayer,args:[ge,xe]})}(B,d.layers,x)}catch(G){console.warn("Unable to compute style diff:",G),x=[{command:ot.setStyle,args:[d]}]}return x}(this.serialize(),_).filter(function(l){return!(l.command in bh)});if(0===j.length)return!1;var f=j.filter(function(l){return!(l.command in up)});if(f.length>0)throw new Error("Unimplemented: "+f.map(function(l){return l.command}).join(", ")+".");return j.forEach(function(l){"setTransition"!==l.command&&I[l.command].apply(I,l.args)}),this.stylesheet=_,!0},w.prototype.addImage=function(_,I){if(this.getImage(_))return this.fire(new L.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(_,I),this._afterImageUpdated(_)},w.prototype.updateImage=function(_,I){this.imageManager.updateImage(_,I)},w.prototype.getImage=function(_){return this.imageManager.getImage(_)},w.prototype.removeImage=function(_){if(!this.getImage(_))return this.fire(new L.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(_),this._afterImageUpdated(_)},w.prototype._afterImageUpdated=function(_){this._availableImages=this.imageManager.listImages(),this._changedImages[_]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new L.Event("data",{dataType:"style"}))},w.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},w.prototype.addSource=function(_,I,j){var f=this;if(void 0===j&&(j={}),this._checkLoaded(),void 0!==this.sourceCaches[_])throw new Error("There is already a source with this ID");if(!I.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(I).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(I.type)>=0&&this._validate(L.validateStyle.source,"sources."+_,I,null,j))){this.map&&this.map._collectResourceTiming&&(I.collectResourceTiming=!0);var l=this.sourceCaches[_]=new pe(_,I,this.dispatcher);l.style=this,l.setEventedParent(this,function(){return{isSourceLoaded:f.loaded(),source:l.serialize(),sourceId:_}}),l.onAdd(this.map),this._changed=!0}},w.prototype.removeSource=function(_){if(this._checkLoaded(),void 0===this.sourceCaches[_])throw new Error("There is no source with this ID");for(var I in this._layers)if(this._layers[I].source===_)return this.fire(new L.ErrorEvent(new Error('Source "'+_+'" cannot be removed while layer "'+I+'" is using it.')));var j=this.sourceCaches[_];delete this.sourceCaches[_],delete this._updatedSources[_],j.fire(new L.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_})),j.setEventedParent(null),j.clearTiles(),j.onRemove&&j.onRemove(this.map),this._changed=!0},w.prototype.setGeoJSONSourceData=function(_,I){this._checkLoaded(),this.sourceCaches[_].getSource().setData(I),this._changed=!0},w.prototype.getSource=function(_){return this.sourceCaches[_]&&this.sourceCaches[_].getSource()},w.prototype.addLayer=function(_,I,j){void 0===j&&(j={}),this._checkLoaded();var f=_.id;if(this.getLayer(f))this.fire(new L.ErrorEvent(new Error('Layer with id "'+f+'" already exists on this map')));else{var l;if("custom"===_.type){if(Fl(this,L.validateCustomStyleLayer(_)))return;l=L.createStyleLayer(_)}else{if("object"==typeof _.source&&(this.addSource(f,_.source),_=L.clone$1(_),_=L.extend(_,{source:f})),this._validate(L.validateStyle.layer,"layers."+f,_,{arrayIndex:-1},j))return;l=L.createStyleLayer(_),this._validateLayer(l),l.setEventedParent(this,{layer:{id:f}}),this._serializedLayers[l.id]=l.serialize()}var d=I?this._order.indexOf(I):this._order.length;if(I&&-1===d)this.fire(new L.ErrorEvent(new Error('Layer with id "'+I+'" does not exist on this map.')));else{if(this._order.splice(d,0,f),this._layerOrderChanged=!0,this._layers[f]=l,this._removedLayers[f]&&l.source&&"custom"!==l.type){var x=this._removedLayers[f];delete this._removedLayers[f],x.type!==l.type?this._updatedSources[l.source]="clear":(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause())}this._updateLayer(l),l.onAdd&&l.onAdd(this.map)}}},w.prototype.moveLayer=function(_,I){if(this._checkLoaded(),this._changed=!0,this._layers[_]){if(_!==I){var j=this._order.indexOf(_);this._order.splice(j,1);var f=I?this._order.indexOf(I):this._order.length;I&&-1===f?this.fire(new L.ErrorEvent(new Error('Layer with id "'+I+'" does not exist on this map.'))):(this._order.splice(f,0,_),this._layerOrderChanged=!0)}}else this.fire(new L.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style and cannot be moved.")))},w.prototype.removeLayer=function(_){this._checkLoaded();var I=this._layers[_];if(I){I.setEventedParent(null);var j=this._order.indexOf(_);this._order.splice(j,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[_]=I,delete this._layers[_],delete this._serializedLayers[_],delete this._updatedLayers[_],delete this._updatedPaintProps[_],I.onRemove&&I.onRemove(this.map)}else this.fire(new L.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style and cannot be removed.")))},w.prototype.getLayer=function(_){return this._layers[_]},w.prototype.hasLayer=function(_){return _ in this._layers},w.prototype.setLayerZoomRange=function(_,I,j){this._checkLoaded();var f=this.getLayer(_);f?f.minzoom===I&&f.maxzoom===j||(null!=I&&(f.minzoom=I),null!=j&&(f.maxzoom=j),this._updateLayer(f)):this.fire(new L.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style and cannot have zoom extent.")))},w.prototype.setFilter=function(_,I,j){void 0===j&&(j={}),this._checkLoaded();var f=this.getLayer(_);if(f){if(!L.deepEqual(f.filter,I))return null==I?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(L.validateStyle.filter,"layers."+f.id+".filter",I,null,j)||(f.filter=L.clone$1(I),this._updateLayer(f)))}else this.fire(new L.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style and cannot be filtered.")))},w.prototype.getFilter=function(_){return L.clone$1(this.getLayer(_).filter)},w.prototype.setLayoutProperty=function(_,I,j,f){void 0===f&&(f={}),this._checkLoaded();var l=this.getLayer(_);l?L.deepEqual(l.getLayoutProperty(I),j)||(l.setLayoutProperty(I,j,f),this._updateLayer(l)):this.fire(new L.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style and cannot be styled.")))},w.prototype.getLayoutProperty=function(_,I){var j=this.getLayer(_);if(j)return j.getLayoutProperty(I);this.fire(new L.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style.")))},w.prototype.setPaintProperty=function(_,I,j,f){void 0===f&&(f={}),this._checkLoaded();var l=this.getLayer(_);l?L.deepEqual(l.getPaintProperty(I),j)||(l.setPaintProperty(I,j,f)&&this._updateLayer(l),this._changed=!0,this._updatedPaintProps[_]=!0):this.fire(new L.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style and cannot be styled.")))},w.prototype.getPaintProperty=function(_,I){return this.getLayer(_).getPaintProperty(I)},w.prototype.setFeatureState=function(_,I){this._checkLoaded();var j=_.source,f=_.sourceLayer,l=this.sourceCaches[j];if(void 0!==l){var d=l.getSource().type;"geojson"===d&&f?this.fire(new L.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==d||f?(void 0===_.id&&this.fire(new L.ErrorEvent(new Error("The feature id parameter must be provided."))),l.setFeatureState(f,_.id,I)):this.fire(new L.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new L.ErrorEvent(new Error("The source '"+j+"' does not exist in the map's style.")))},w.prototype.removeFeatureState=function(_,I){this._checkLoaded();var j=_.source,f=this.sourceCaches[j];if(void 0!==f){var l=f.getSource().type,d="vector"===l?_.sourceLayer:void 0;"vector"!==l||d?I&&"string"!=typeof _.id&&"number"!=typeof _.id?this.fire(new L.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(d,_.id,I):this.fire(new L.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new L.ErrorEvent(new Error("The source '"+j+"' does not exist in the map's style.")))},w.prototype.getFeatureState=function(_){this._checkLoaded();var I=_.source,j=_.sourceLayer,f=this.sourceCaches[I];if(void 0!==f){if("vector"!==f.getSource().type||j)return void 0===_.id&&this.fire(new L.ErrorEvent(new Error("The feature id parameter must be provided."))),f.getFeatureState(j,_.id);this.fire(new L.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new L.ErrorEvent(new Error("The source '"+I+"' does not exist in the map's style.")))},w.prototype.getTransition=function(){return L.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},w.prototype.serialize=function(){return L.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:L.mapObject(this.sourceCaches,function(_){return _.serialize()}),layers:this._serializeLayers(this._order)},function(_){return void 0!==_})},w.prototype._updateLayer=function(_){this._updatedLayers[_.id]=!0,_.source&&!this._updatedSources[_.source]&&"raster"!==this.sourceCaches[_.source].getSource().type&&(this._updatedSources[_.source]="reload",this.sourceCaches[_.source].pause()),this._changed=!0},w.prototype._flattenAndSortRenderedFeatures=function(_){for(var I=this,j=function(Le){return"fill-extrusion"===I._layers[Le].type},f={},l=[],d=this._order.length-1;d>=0;d--){var x=this._order[d];if(j(x)){f[x]=d;for(var M=0,D=_;M<D.length;M+=1){var B=D[M][x];if(B)for(var G=0,W=B;G<W.length;G+=1)l.push(W[G])}}}l.sort(function(Le,Me){return Me.intersectionZ-Le.intersectionZ});for(var Y=[],ee=this._order.length-1;ee>=0;ee--){var Q=this._order[ee];if(j(Q))for(var le=l.length-1;le>=0;le--){var de=l[le].feature;if(f[de.layer.id]<ee)break;Y.push(de),l.pop()}else for(var ge=0,xe=_;ge<xe.length;ge+=1){var Te=xe[ge][Q];if(Te)for(var Ee=0,Pe=Te;Ee<Pe.length;Ee+=1)Y.push(Pe[Ee].feature)}}return Y},w.prototype.queryRenderedFeatures=function(_,I,j){I&&I.filter&&this._validate(L.validateStyle.filter,"queryRenderedFeatures.filter",I.filter,null,I);var f={};if(I&&I.layers){if(!Array.isArray(I.layers))return this.fire(new L.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var l=0,d=I.layers;l<d.length;l+=1){var x=d[l],M=this._layers[x];if(!M)return this.fire(new L.ErrorEvent(new Error("The layer '"+x+"' does not exist in the map's style and cannot be queried for features."))),[];f[M.source]=!0}}var D=[];for(var B in I.availableImages=this._availableImages,this.sourceCaches)I.layers&&!f[B]||D.push(Zr(this.sourceCaches[B],this._layers,this._serializedLayers,_,I,j));return this.placement&&D.push(function(G,W,Y,ee,Q,le,de){for(var ge={},xe=le.queryRenderedSymbols(ee),Te=[],Ee=0,Pe=Object.keys(xe).map(Number);Ee<Pe.length;Ee+=1)Te.push(de[Pe[Ee]]);Te.sort(gl);for(var Le=function(){var gt=Ue[Me],Ot=gt.featureIndex.lookupSymbolFeatures(xe[gt.bucketInstanceId],W,gt.bucketIndex,gt.sourceLayerIndex,Q.filter,Q.layers,Q.availableImages,G);for(var dt in Ot){var Nt=ge[dt]=ge[dt]||[],wt=Ot[dt];wt.sort(function(Gt,Qt){var mn=gt.featureSortOrder;if(mn){var Hn=mn.indexOf(Gt.featureIndex);return mn.indexOf(Qt.featureIndex)-Hn}return Qt.featureIndex-Gt.featureIndex});for(var Zt=0,ft=wt;Zt<ft.length;Zt+=1)Nt.push(ft[Zt])}},Me=0,Ue=Te;Me<Ue.length;Me+=1)Le();var Ye=function(gt){ge[gt].forEach(function(Ot){var dt=Ot.feature,Nt=Y[G[gt].source].getFeatureState(dt.layer["source-layer"],dt.id);dt.source=dt.layer.source,dt.layer["source-layer"]&&(dt.sourceLayer=dt.layer["source-layer"]),dt.state=Nt})};for(var yt in ge)Ye(yt);return ge}(this._layers,this._serializedLayers,this.sourceCaches,_,I,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(D)},w.prototype.querySourceFeatures=function(_,I){I&&I.filter&&this._validate(L.validateStyle.filter,"querySourceFeatures.filter",I.filter,null,I);var j=this.sourceCaches[_];return j?function(f,l){for(var d=f.getRenderableIds().map(function(W){return f.getTileByID(W)}),x=[],M={},D=0;D<d.length;D++){var B=d[D],G=B.tileID.canonical.key;M[G]||(M[G]=!0,B.querySourceFeatures(x,l))}return x}(j,I):[]},w.prototype.addSourceType=function(_,I,j){return w.getSourceType(_)?j(new Error('A source type called "'+_+'" already exists.')):(w.setSourceType(_,I),I.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:_,url:I.workerSourceURL},j):j(null,null))},w.prototype.getLight=function(){return this.light.getLight()},w.prototype.setLight=function(_,I){void 0===I&&(I={}),this._checkLoaded();var j=this.light.getLight(),f=!1;for(var l in _)if(!L.deepEqual(_[l],j[l])){f=!0;break}if(f){var d={now:L.browser.now(),transition:L.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(_,I),this.light.updateTransitions(d)}},w.prototype._validate=function(_,I,j,f,l){return void 0===l&&(l={}),(!l||!1!==l.validate)&&Fl(this,_.call(L.validateStyle,L.extend({key:I,style:this.serialize(),value:j,styleSpec:L.styleSpec},f)))},w.prototype._remove=function(){for(var _ in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),L.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[_].setEventedParent(null);for(var I in this.sourceCaches)this.sourceCaches[I].clearTiles(),this.sourceCaches[I].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},w.prototype._clearSource=function(_){this.sourceCaches[_].clearTiles()},w.prototype._reloadSource=function(_){this.sourceCaches[_].resume(),this.sourceCaches[_].reload()},w.prototype._updateSources=function(_){for(var I in this.sourceCaches)this.sourceCaches[I].update(_)},w.prototype._generateCollisionBoxes=function(){for(var _ in this.sourceCaches)this._reloadSource(_)},w.prototype._updatePlacement=function(_,I,j,f,l){void 0===l&&(l=!1);for(var d=!1,x=!1,M={},D=0,B=this._order;D<B.length;D+=1){var G=this._layers[B[D]];if("symbol"===G.type){if(!M[G.source]){var W=this.sourceCaches[G.source];M[G.source]=W.getRenderableIds(!0).map(function(de){return W.getTileByID(de)}).sort(function(de,ge){return ge.tileID.overscaledZ-de.tileID.overscaledZ||(de.tileID.isLessThan(ge.tileID)?-1:1)})}var Y=this.crossTileSymbolIndex.addLayer(G,M[G.source],_.center.lng);d=d||Y}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((l=l||this._layerOrderChanged||0===j)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(L.browser.now(),_.zoom))&&(this.pauseablePlacement=new tc(_,this._order,l,I,j,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(L.browser.now()),x=!0),d&&this.pauseablePlacement.placement.setStale()),x||d)for(var ee=0,Q=this._order;ee<Q.length;ee+=1){var le=this._layers[Q[ee]];"symbol"===le.type&&this.placement.updateLayerOpacities(le,M[le.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(L.browser.now())},w.prototype._releaseSymbolFadeTiles=function(){for(var _ in this.sourceCaches)this.sourceCaches[_].releaseSymbolFadeTiles()},w.prototype.getImages=function(_,I,j){this.imageManager.getImages(I.icons,j),this._updateTilesForChangedImages();var f=this.sourceCaches[I.source];f&&f.setDependencies(I.tileID.key,I.type,I.icons)},w.prototype.getGlyphs=function(_,I,j){this.glyphManager.getGlyphs(I.stacks,j)},w.prototype.getResource=function(_,I,j){return L.makeRequest(I,j)},w}(L.Evented);kc.getSourceType=function(v){return Xi[v]},kc.setSourceType=function(v,w){Xi[v]=w},kc.registerForPluginStateChange=L.registerForPluginStateChange;var wa=L.createLayout([{name:"a_pos",type:"Int16",components:2}]),ca=Oo("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),qh=Oo("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),wh=Oo("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),oi=Oo("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),nc=Oo("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ch=Oo("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),eu=Oo("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Li=Oo("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Pp=Oo("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Bu=Oo("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),Is=Oo("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),Eh=Oo("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),rc=Oo("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),ii=Oo("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),th=Oo("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),ka=Oo("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),Zh=Oo("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),ic=Oo("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Di=Oo("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),Sh=Oo("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),oc=Oo("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),ya=Oo("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),uo=Oo("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),yu=Oo("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),tu=Oo("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),Th=Oo("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}");function Oo(v,w){var _=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,I=w.match(/attribute ([\w]+) ([\w]+)/g),j=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),l=f?f.concat(j):j,d={};return{fragmentSource:v=v.replace(_,function(x,M,D,B,G){return d[G]=!0,"define"===M?"\n#ifndef HAS_UNIFORM_u_"+G+"\nvarying "+D+" "+B+" "+G+";\n#else\nuniform "+D+" "+B+" u_"+G+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+G+"\n    "+D+" "+B+" "+G+" = u_"+G+";\n#endif\n"}),vertexSource:w=w.replace(_,function(x,M,D,B,G){var W="float"===B?"vec2":"vec4",Y=G.match(/color/)?"color":W;return d[G]?"define"===M?"\n#ifndef HAS_UNIFORM_u_"+G+"\nuniform lowp float u_"+G+"_t;\nattribute "+D+" "+W+" a_"+G+";\nvarying "+D+" "+B+" "+G+";\n#else\nuniform "+D+" "+B+" u_"+G+";\n#endif\n":"vec4"===Y?"\n#ifndef HAS_UNIFORM_u_"+G+"\n    "+G+" = a_"+G+";\n#else\n    "+D+" "+B+" "+G+" = u_"+G+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+G+"\n    "+G+" = unpack_mix_"+Y+"(a_"+G+", u_"+G+"_t);\n#else\n    "+D+" "+B+" "+G+" = u_"+G+";\n#endif\n":"define"===M?"\n#ifndef HAS_UNIFORM_u_"+G+"\nuniform lowp float u_"+G+"_t;\nattribute "+D+" "+W+" a_"+G+";\n#else\nuniform "+D+" "+B+" u_"+G+";\n#endif\n":"vec4"===Y?"\n#ifndef HAS_UNIFORM_u_"+G+"\n    "+D+" "+B+" "+G+" = a_"+G+";\n#else\n    "+D+" "+B+" "+G+" = u_"+G+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+G+"\n    "+D+" "+B+" "+G+" = unpack_mix_"+Y+"(a_"+G+", u_"+G+"_t);\n#else\n    "+D+" "+B+" "+G+" = u_"+G+";\n#endif\n"}),staticAttributes:I,staticUniforms:l}}var bl=Object.freeze({__proto__:null,prelude:ca,background:qh,backgroundPattern:wh,circle:oi,clippingMask:nc,heatmap:Ch,heatmapTexture:eu,collisionBox:Li,collisionCircle:Pp,debug:Bu,fill:Is,fillOutline:Eh,fillOutlinePattern:rc,fillPattern:ii,fillExtrusion:th,fillExtrusionPattern:ka,hillshadePrepare:Zh,hillshade:ic,line:Di,lineGradient:Sh,linePattern:oc,lineSDF:ya,raster:uo,symbolIcon:yu,symbolSDF:tu,symbolTextAndIcon:Th}),Pc=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function ju(v){for(var w=[],_=0;_<v.length;_++)if(null!==v[_]){var I=v[_].split(" ");w.push(I.pop())}return w}Pc.prototype.bind=function(v,w,_,I,j,f,l,d){this.context=v;for(var x=this.boundPaintVertexBuffers.length!==I.length,M=0;!x&&M<I.length;M++)this.boundPaintVertexBuffers[M]!==I[M]&&(x=!0);v.extVertexArrayObject&&this.vao&&this.boundProgram===w&&this.boundLayoutVertexBuffer===_&&!x&&this.boundIndexBuffer===j&&this.boundVertexOffset===f&&this.boundDynamicVertexBuffer===l&&this.boundDynamicVertexBuffer2===d?(v.bindVertexArrayOES.set(this.vao),l&&l.bind(),j&&j.dynamicDraw&&j.bind(),d&&d.bind()):this.freshBind(w,_,I,j,f,l,d)},Pc.prototype.freshBind=function(v,w,_,I,j,f,l){var d,x=v.numAttributes,M=this.context,D=M.gl;if(M.extVertexArrayObject)this.vao&&this.destroy(),this.vao=M.extVertexArrayObject.createVertexArrayOES(),M.bindVertexArrayOES.set(this.vao),d=0,this.boundProgram=v,this.boundLayoutVertexBuffer=w,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=I,this.boundVertexOffset=j,this.boundDynamicVertexBuffer=f,this.boundDynamicVertexBuffer2=l;else{d=M.currentNumAttributes||0;for(var B=x;B<d;B++)D.disableVertexAttribArray(B)}w.enableAttributes(D,v);for(var G=0,W=_;G<W.length;G+=1)W[G].enableAttributes(D,v);f&&f.enableAttributes(D,v),l&&l.enableAttributes(D,v),w.bind(),w.setVertexAttribPointers(D,v,j);for(var Y=0,ee=_;Y<ee.length;Y+=1){var Q=ee[Y];Q.bind(),Q.setVertexAttribPointers(D,v,j)}f&&(f.bind(),f.setVertexAttribPointers(D,v,j)),I&&I.bind(),l&&(l.bind(),l.setVertexAttribPointers(D,v,j)),M.currentNumAttributes=x},Pc.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var eo=function(v,w,_,I,j,f){var l=v.gl;this.program=l.createProgram();for(var d=ju(_.staticAttributes),x=I?I.getBinderAttributes():[],M=d.concat(x),D=_.staticUniforms?ju(_.staticUniforms):[],B=I?I.getBinderUniforms():[],G=[],W=0,Y=D.concat(B);W<Y.length;W+=1){var ee=Y[W];G.indexOf(ee)<0&&G.push(ee)}var Q=I?I.defines():[];f&&Q.push("#define OVERDRAW_INSPECTOR;");var le=Q.concat(ca.fragmentSource,_.fragmentSource).join("\n"),de=Q.concat(ca.vertexSource,_.vertexSource).join("\n"),ge=l.createShader(l.FRAGMENT_SHADER);if(l.isContextLost())this.failedToCreate=!0;else{l.shaderSource(ge,le),l.compileShader(ge),l.attachShader(this.program,ge);var xe=l.createShader(l.VERTEX_SHADER);if(l.isContextLost())this.failedToCreate=!0;else{l.shaderSource(xe,de),l.compileShader(xe),l.attachShader(this.program,xe),this.attributes={};var Te={};this.numAttributes=M.length;for(var Ee=0;Ee<this.numAttributes;Ee++)M[Ee]&&(l.bindAttribLocation(this.program,Ee,M[Ee]),this.attributes[M[Ee]]=Ee);l.linkProgram(this.program),l.deleteShader(xe),l.deleteShader(ge);for(var Pe=0;Pe<G.length;Pe++){var Le=G[Pe];if(Le&&!Te[Le]){var Me=l.getUniformLocation(this.program,Le);Me&&(Te[Le]=Me)}}this.fixedUniforms=j(v,Te),this.binderUniforms=I?I.getUniforms(v,Te):[]}}};function Td(v,w,_){var I=1/Mn(_,1,w.transform.tileZoom),j=Math.pow(2,_.tileID.overscaledZ),f=_.tileSize*Math.pow(2,w.transform.tileZoom)/j,l=f*(_.tileID.canonical.x+_.tileID.wrap*j),d=f*_.tileID.canonical.y;return{u_image:0,u_texsize:_.imageAtlasTexture.size,u_scale:[I,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[l>>16,d>>16],u_pixel_coord_lower:[65535&l,65535&d]}}eo.prototype.draw=function(v,w,_,I,j,f,l,d,x,M,D,B,G,W,Y,ee){var Q,le=v.gl;if(!this.failedToCreate){for(var de in v.program.set(this.program),v.setDepthMode(_),v.setStencilMode(I),v.setColorMode(j),v.setCullFace(f),this.fixedUniforms)this.fixedUniforms[de].set(l[de]);W&&W.setUniforms(v,this.binderUniforms,B,{zoom:G});for(var ge=(Q={},Q[le.LINES]=2,Q[le.TRIANGLES]=3,Q[le.LINE_STRIP]=1,Q)[w],xe=0,Te=D.get();xe<Te.length;xe+=1){var Ee=Te[xe],Pe=Ee.vaos||(Ee.vaos={});(Pe[d]||(Pe[d]=new Pc)).bind(v,this,x,W?W.getPaintVertexBuffers():[],M,Ee.vertexOffset,Y,ee),le.drawElements(w,Ee.primitiveLength*ge,le.UNSIGNED_SHORT,Ee.primitiveOffset*ge*2)}}};var zl=function(v,w,_,I){var j=w.style.light,f=j.properties.get("position"),l=[f.x,f.y,f.z],d=L.create$1();"viewport"===j.properties.get("anchor")&&L.fromRotation(d,-w.transform.angle),L.transformMat3(l,l,d);var x=j.properties.get("color");return{u_matrix:v,u_lightpos:l,u_lightintensity:j.properties.get("intensity"),u_lightcolor:[x.r,x.g,x.b],u_vertical_gradient:+_,u_opacity:I}},nd=function(v,w,_,I,j,f,l){return L.extend(zl(v,w,_,I),Td(f,w,l),{u_height_factor:-Math.pow(2,j.overscaledZ)/l.tileSize/8})},nu=function(v){return{u_matrix:v}},Gi=function(v,w,_,I){return L.extend(nu(v),Td(_,w,I))},Rc=function(v,w){return{u_matrix:v,u_world:w}},Hh=function(v,w,_,I,j){return L.extend(Gi(v,w,_,I),{u_world:j})},Pa=function(v,w,_,I){var j,f,l=v.transform;if("map"===I.paint.get("circle-pitch-alignment")){var d=Mn(_,1,l.zoom);j=!0,f=[d,d]}else j=!1,f=l.pixelsToGLUnits;return{u_camera_to_center_distance:l.cameraToCenterDistance,u_scale_with_map:+("map"===I.paint.get("circle-pitch-scale")),u_matrix:v.translatePosMatrix(w.posMatrix,_,I.paint.get("circle-translate"),I.paint.get("circle-translate-anchor")),u_pitch_with_map:+j,u_device_pixel_ratio:L.browser.devicePixelRatio,u_extrude_scale:f}},Ms=function(v,w,_){var I=Mn(_,1,w.zoom),j=Math.pow(2,w.zoom-_.tileID.overscaledZ),f=_.tileID.overscaleFactor();return{u_matrix:v,u_camera_to_center_distance:w.cameraToCenterDistance,u_pixels_to_tile_units:I,u_extrude_scale:[w.pixelsToGLUnits[0]/(I*j),w.pixelsToGLUnits[1]/(I*j)],u_overscale_factor:f}},Ca=function(v,w,_){return{u_matrix:v,u_inv_matrix:w,u_camera_to_center_distance:_.cameraToCenterDistance,u_viewport_size:[_.width,_.height]}},vu=function(v,w,_){return void 0===_&&(_=1),{u_matrix:v,u_color:w,u_overlay:0,u_overlay_scale:_}},Nl=function(v){return{u_matrix:v}},Ks=function(v,w,_,I){return{u_matrix:v,u_extrude_scale:Mn(w,1,_),u_intensity:I}},Uu=function(v,w,_){var I=v.transform;return{u_matrix:Ba(v,w,_),u_ratio:1/Mn(w,1,I.zoom),u_device_pixel_ratio:L.browser.devicePixelRatio,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]]}},Oc=function(v,w,_,I){return L.extend(Uu(v,w,_),{u_image:0,u_image_height:I})},Ki=function(v,w,_,I){var j=v.transform,f=Vs(w,j);return{u_matrix:Ba(v,w,_),u_texsize:w.imageAtlasTexture.size,u_ratio:1/Mn(w,1,j.zoom),u_device_pixel_ratio:L.browser.devicePixelRatio,u_image:0,u_scale:[f,I.fromScale,I.toScale],u_fade:I.t,u_units_to_pixels:[1/j.pixelsToGLUnits[0],1/j.pixelsToGLUnits[1]]}},Ih=function(v,w,_,I,j){var f=v.lineAtlas,l=Vs(w,v.transform),d="round"===_.layout.get("line-cap"),x=f.getDash(I.from,d),M=f.getDash(I.to,d),D=x.width*j.fromScale,B=M.width*j.toScale;return L.extend(Uu(v,w,_),{u_patternscale_a:[l/D,-x.height/2],u_patternscale_b:[l/B,-M.height/2],u_sdfgamma:f.width/(256*Math.min(D,B)*L.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:x.y,u_tex_y_b:M.y,u_mix:j.t})};function Vs(v,w){return 1/Mn(v,1,w.tileZoom)}function Ba(v,w,_){return v.translatePosMatrix(w.tileID.posMatrix,w,_.paint.get("line-translate"),_.paint.get("line-translate-anchor"))}var Rp=function(v,w,_,I,j){return{u_matrix:v,u_tl_parent:w,u_scale_parent:_,u_buffer_scale:1,u_fade_t:I.mix,u_opacity:I.opacity*j.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:j.paint.get("raster-brightness-min"),u_brightness_high:j.paint.get("raster-brightness-max"),u_saturation_factor:(l=j.paint.get("raster-saturation"),l>0?1-1/(1.001-l):-l),u_contrast_factor:(f=j.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:As(j.paint.get("raster-hue-rotate"))};var f,l};function As(v){v*=Math.PI/180;var w=Math.sin(v),_=Math.cos(v);return[(2*_+1)/3,(-Math.sqrt(3)*w-_+1)/3,(Math.sqrt(3)*w-_+1)/3]}var Qn,ui=function(v,w,_,I,j,f,l,d,x,M){var D=j.transform;return{u_is_size_zoom_constant:+("constant"===v||"source"===v),u_is_size_feature_constant:+("constant"===v||"camera"===v),u_size_t:w?w.uSizeT:0,u_size:w?w.uSize:0,u_camera_to_center_distance:D.cameraToCenterDistance,u_pitch:D.pitch/360*2*Math.PI,u_rotate_symbol:+_,u_aspect_ratio:D.width/D.height,u_fade_change:j.options.fadeDuration?j.symbolFadeChange:1,u_matrix:f,u_label_plane_matrix:l,u_coord_matrix:d,u_is_text:+x,u_pitch_with_map:+I,u_texsize:M,u_texture:0}},So=function(v,w,_,I,j,f,l,d,x,M,D){var B=j.transform;return L.extend(ui(v,w,_,I,j,f,l,d,x,M),{u_gamma_scale:I?Math.cos(B._pitch)*B.cameraToCenterDistance:1,u_device_pixel_ratio:L.browser.devicePixelRatio,u_is_halo:+D})},Gs=function(v,w,_,I,j,f,l,d,x,M){return L.extend(So(v,w,_,I,j,f,l,d,!0,x,!0),{u_texsize_icon:M,u_texture_icon:1})},ru=function(v,w,_){return{u_matrix:v,u_opacity:w,u_color:_}},Ao=function(v,w,_,I,j,f){return L.extend((d=f,M=j,D=(x=_).imageManager.getPattern((l=I).from.toString()),B=x.imageManager.getPattern(l.to.toString()),W=(G=x.imageManager.getPixelSize()).width,Y=G.height,ee=Math.pow(2,M.tileID.overscaledZ),le=(Q=M.tileSize*Math.pow(2,x.transform.tileZoom)/ee)*(M.tileID.canonical.x+M.tileID.wrap*ee),de=Q*M.tileID.canonical.y,{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[W,Y],u_mix:d.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:d.fromScale,u_scale_b:d.toScale,u_tile_units_to_pixels:1/Mn(M,1,x.transform.tileZoom),u_pixel_coord_upper:[le>>16,de>>16],u_pixel_coord_lower:[65535&le,65535&de]}),{u_matrix:v,u_opacity:w});var l,d,x,M,D,B,G,W,Y,ee,Q,le,de},Bl={fillExtrusion:function(v,w){return{u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_lightpos:new L.Uniform3f(v,w.u_lightpos),u_lightintensity:new L.Uniform1f(v,w.u_lightintensity),u_lightcolor:new L.Uniform3f(v,w.u_lightcolor),u_vertical_gradient:new L.Uniform1f(v,w.u_vertical_gradient),u_opacity:new L.Uniform1f(v,w.u_opacity)}},fillExtrusionPattern:function(v,w){return{u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_lightpos:new L.Uniform3f(v,w.u_lightpos),u_lightintensity:new L.Uniform1f(v,w.u_lightintensity),u_lightcolor:new L.Uniform3f(v,w.u_lightcolor),u_vertical_gradient:new L.Uniform1f(v,w.u_vertical_gradient),u_height_factor:new L.Uniform1f(v,w.u_height_factor),u_image:new L.Uniform1i(v,w.u_image),u_texsize:new L.Uniform2f(v,w.u_texsize),u_pixel_coord_upper:new L.Uniform2f(v,w.u_pixel_coord_upper),u_pixel_coord_lower:new L.Uniform2f(v,w.u_pixel_coord_lower),u_scale:new L.Uniform3f(v,w.u_scale),u_fade:new L.Uniform1f(v,w.u_fade),u_opacity:new L.Uniform1f(v,w.u_opacity)}},fill:function(v,w){return{u_matrix:new L.UniformMatrix4f(v,w.u_matrix)}},fillPattern:function(v,w){return{u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_image:new L.Uniform1i(v,w.u_image),u_texsize:new L.Uniform2f(v,w.u_texsize),u_pixel_coord_upper:new L.Uniform2f(v,w.u_pixel_coord_upper),u_pixel_coord_lower:new L.Uniform2f(v,w.u_pixel_coord_lower),u_scale:new L.Uniform3f(v,w.u_scale),u_fade:new L.Uniform1f(v,w.u_fade)}},fillOutline:function(v,w){return{u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_world:new L.Uniform2f(v,w.u_world)}},fillOutlinePattern:function(v,w){return{u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_world:new L.Uniform2f(v,w.u_world),u_image:new L.Uniform1i(v,w.u_image),u_texsize:new L.Uniform2f(v,w.u_texsize),u_pixel_coord_upper:new L.Uniform2f(v,w.u_pixel_coord_upper),u_pixel_coord_lower:new L.Uniform2f(v,w.u_pixel_coord_lower),u_scale:new L.Uniform3f(v,w.u_scale),u_fade:new L.Uniform1f(v,w.u_fade)}},circle:function(v,w){return{u_camera_to_center_distance:new L.Uniform1f(v,w.u_camera_to_center_distance),u_scale_with_map:new L.Uniform1i(v,w.u_scale_with_map),u_pitch_with_map:new L.Uniform1i(v,w.u_pitch_with_map),u_extrude_scale:new L.Uniform2f(v,w.u_extrude_scale),u_device_pixel_ratio:new L.Uniform1f(v,w.u_device_pixel_ratio),u_matrix:new L.UniformMatrix4f(v,w.u_matrix)}},collisionBox:function(v,w){return{u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_camera_to_center_distance:new L.Uniform1f(v,w.u_camera_to_center_distance),u_pixels_to_tile_units:new L.Uniform1f(v,w.u_pixels_to_tile_units),u_extrude_scale:new L.Uniform2f(v,w.u_extrude_scale),u_overscale_factor:new L.Uniform1f(v,w.u_overscale_factor)}},collisionCircle:function(v,w){return{u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_inv_matrix:new L.UniformMatrix4f(v,w.u_inv_matrix),u_camera_to_center_distance:new L.Uniform1f(v,w.u_camera_to_center_distance),u_viewport_size:new L.Uniform2f(v,w.u_viewport_size)}},debug:function(v,w){return{u_color:new L.UniformColor(v,w.u_color),u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_overlay:new L.Uniform1i(v,w.u_overlay),u_overlay_scale:new L.Uniform1f(v,w.u_overlay_scale)}},clippingMask:function(v,w){return{u_matrix:new L.UniformMatrix4f(v,w.u_matrix)}},heatmap:function(v,w){return{u_extrude_scale:new L.Uniform1f(v,w.u_extrude_scale),u_intensity:new L.Uniform1f(v,w.u_intensity),u_matrix:new L.UniformMatrix4f(v,w.u_matrix)}},heatmapTexture:function(v,w){return{u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_world:new L.Uniform2f(v,w.u_world),u_image:new L.Uniform1i(v,w.u_image),u_color_ramp:new L.Uniform1i(v,w.u_color_ramp),u_opacity:new L.Uniform1f(v,w.u_opacity)}},hillshade:function(v,w){return{u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_image:new L.Uniform1i(v,w.u_image),u_latrange:new L.Uniform2f(v,w.u_latrange),u_light:new L.Uniform2f(v,w.u_light),u_shadow:new L.UniformColor(v,w.u_shadow),u_highlight:new L.UniformColor(v,w.u_highlight),u_accent:new L.UniformColor(v,w.u_accent)}},hillshadePrepare:function(v,w){return{u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_image:new L.Uniform1i(v,w.u_image),u_dimension:new L.Uniform2f(v,w.u_dimension),u_zoom:new L.Uniform1f(v,w.u_zoom),u_unpack:new L.Uniform4f(v,w.u_unpack)}},line:function(v,w){return{u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_ratio:new L.Uniform1f(v,w.u_ratio),u_device_pixel_ratio:new L.Uniform1f(v,w.u_device_pixel_ratio),u_units_to_pixels:new L.Uniform2f(v,w.u_units_to_pixels)}},lineGradient:function(v,w){return{u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_ratio:new L.Uniform1f(v,w.u_ratio),u_device_pixel_ratio:new L.Uniform1f(v,w.u_device_pixel_ratio),u_units_to_pixels:new L.Uniform2f(v,w.u_units_to_pixels),u_image:new L.Uniform1i(v,w.u_image),u_image_height:new L.Uniform1f(v,w.u_image_height)}},linePattern:function(v,w){return{u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_texsize:new L.Uniform2f(v,w.u_texsize),u_ratio:new L.Uniform1f(v,w.u_ratio),u_device_pixel_ratio:new L.Uniform1f(v,w.u_device_pixel_ratio),u_image:new L.Uniform1i(v,w.u_image),u_units_to_pixels:new L.Uniform2f(v,w.u_units_to_pixels),u_scale:new L.Uniform3f(v,w.u_scale),u_fade:new L.Uniform1f(v,w.u_fade)}},lineSDF:function(v,w){return{u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_ratio:new L.Uniform1f(v,w.u_ratio),u_device_pixel_ratio:new L.Uniform1f(v,w.u_device_pixel_ratio),u_units_to_pixels:new L.Uniform2f(v,w.u_units_to_pixels),u_patternscale_a:new L.Uniform2f(v,w.u_patternscale_a),u_patternscale_b:new L.Uniform2f(v,w.u_patternscale_b),u_sdfgamma:new L.Uniform1f(v,w.u_sdfgamma),u_image:new L.Uniform1i(v,w.u_image),u_tex_y_a:new L.Uniform1f(v,w.u_tex_y_a),u_tex_y_b:new L.Uniform1f(v,w.u_tex_y_b),u_mix:new L.Uniform1f(v,w.u_mix)}},raster:function(v,w){return{u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_tl_parent:new L.Uniform2f(v,w.u_tl_parent),u_scale_parent:new L.Uniform1f(v,w.u_scale_parent),u_buffer_scale:new L.Uniform1f(v,w.u_buffer_scale),u_fade_t:new L.Uniform1f(v,w.u_fade_t),u_opacity:new L.Uniform1f(v,w.u_opacity),u_image0:new L.Uniform1i(v,w.u_image0),u_image1:new L.Uniform1i(v,w.u_image1),u_brightness_low:new L.Uniform1f(v,w.u_brightness_low),u_brightness_high:new L.Uniform1f(v,w.u_brightness_high),u_saturation_factor:new L.Uniform1f(v,w.u_saturation_factor),u_contrast_factor:new L.Uniform1f(v,w.u_contrast_factor),u_spin_weights:new L.Uniform3f(v,w.u_spin_weights)}},symbolIcon:function(v,w){return{u_is_size_zoom_constant:new L.Uniform1i(v,w.u_is_size_zoom_constant),u_is_size_feature_constant:new L.Uniform1i(v,w.u_is_size_feature_constant),u_size_t:new L.Uniform1f(v,w.u_size_t),u_size:new L.Uniform1f(v,w.u_size),u_camera_to_center_distance:new L.Uniform1f(v,w.u_camera_to_center_distance),u_pitch:new L.Uniform1f(v,w.u_pitch),u_rotate_symbol:new L.Uniform1i(v,w.u_rotate_symbol),u_aspect_ratio:new L.Uniform1f(v,w.u_aspect_ratio),u_fade_change:new L.Uniform1f(v,w.u_fade_change),u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_label_plane_matrix:new L.UniformMatrix4f(v,w.u_label_plane_matrix),u_coord_matrix:new L.UniformMatrix4f(v,w.u_coord_matrix),u_is_text:new L.Uniform1i(v,w.u_is_text),u_pitch_with_map:new L.Uniform1i(v,w.u_pitch_with_map),u_texsize:new L.Uniform2f(v,w.u_texsize),u_texture:new L.Uniform1i(v,w.u_texture)}},symbolSDF:function(v,w){return{u_is_size_zoom_constant:new L.Uniform1i(v,w.u_is_size_zoom_constant),u_is_size_feature_constant:new L.Uniform1i(v,w.u_is_size_feature_constant),u_size_t:new L.Uniform1f(v,w.u_size_t),u_size:new L.Uniform1f(v,w.u_size),u_camera_to_center_distance:new L.Uniform1f(v,w.u_camera_to_center_distance),u_pitch:new L.Uniform1f(v,w.u_pitch),u_rotate_symbol:new L.Uniform1i(v,w.u_rotate_symbol),u_aspect_ratio:new L.Uniform1f(v,w.u_aspect_ratio),u_fade_change:new L.Uniform1f(v,w.u_fade_change),u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_label_plane_matrix:new L.UniformMatrix4f(v,w.u_label_plane_matrix),u_coord_matrix:new L.UniformMatrix4f(v,w.u_coord_matrix),u_is_text:new L.Uniform1i(v,w.u_is_text),u_pitch_with_map:new L.Uniform1i(v,w.u_pitch_with_map),u_texsize:new L.Uniform2f(v,w.u_texsize),u_texture:new L.Uniform1i(v,w.u_texture),u_gamma_scale:new L.Uniform1f(v,w.u_gamma_scale),u_device_pixel_ratio:new L.Uniform1f(v,w.u_device_pixel_ratio),u_is_halo:new L.Uniform1i(v,w.u_is_halo)}},symbolTextAndIcon:function(v,w){return{u_is_size_zoom_constant:new L.Uniform1i(v,w.u_is_size_zoom_constant),u_is_size_feature_constant:new L.Uniform1i(v,w.u_is_size_feature_constant),u_size_t:new L.Uniform1f(v,w.u_size_t),u_size:new L.Uniform1f(v,w.u_size),u_camera_to_center_distance:new L.Uniform1f(v,w.u_camera_to_center_distance),u_pitch:new L.Uniform1f(v,w.u_pitch),u_rotate_symbol:new L.Uniform1i(v,w.u_rotate_symbol),u_aspect_ratio:new L.Uniform1f(v,w.u_aspect_ratio),u_fade_change:new L.Uniform1f(v,w.u_fade_change),u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_label_plane_matrix:new L.UniformMatrix4f(v,w.u_label_plane_matrix),u_coord_matrix:new L.UniformMatrix4f(v,w.u_coord_matrix),u_is_text:new L.Uniform1i(v,w.u_is_text),u_pitch_with_map:new L.Uniform1i(v,w.u_pitch_with_map),u_texsize:new L.Uniform2f(v,w.u_texsize),u_texsize_icon:new L.Uniform2f(v,w.u_texsize_icon),u_texture:new L.Uniform1i(v,w.u_texture),u_texture_icon:new L.Uniform1i(v,w.u_texture_icon),u_gamma_scale:new L.Uniform1f(v,w.u_gamma_scale),u_device_pixel_ratio:new L.Uniform1f(v,w.u_device_pixel_ratio),u_is_halo:new L.Uniform1i(v,w.u_is_halo)}},background:function(v,w){return{u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_opacity:new L.Uniform1f(v,w.u_opacity),u_color:new L.UniformColor(v,w.u_color)}},backgroundPattern:function(v,w){return{u_matrix:new L.UniformMatrix4f(v,w.u_matrix),u_opacity:new L.Uniform1f(v,w.u_opacity),u_image:new L.Uniform1i(v,w.u_image),u_pattern_tl_a:new L.Uniform2f(v,w.u_pattern_tl_a),u_pattern_br_a:new L.Uniform2f(v,w.u_pattern_br_a),u_pattern_tl_b:new L.Uniform2f(v,w.u_pattern_tl_b),u_pattern_br_b:new L.Uniform2f(v,w.u_pattern_br_b),u_texsize:new L.Uniform2f(v,w.u_texsize),u_mix:new L.Uniform1f(v,w.u_mix),u_pattern_size_a:new L.Uniform2f(v,w.u_pattern_size_a),u_pattern_size_b:new L.Uniform2f(v,w.u_pattern_size_b),u_scale_a:new L.Uniform1f(v,w.u_scale_a),u_scale_b:new L.Uniform1f(v,w.u_scale_b),u_pixel_coord_upper:new L.Uniform2f(v,w.u_pixel_coord_upper),u_pixel_coord_lower:new L.Uniform2f(v,w.u_pixel_coord_lower),u_tile_units_to_pixels:new L.Uniform1f(v,w.u_tile_units_to_pixels)}}};function Xo(v,w,_,I,j,f,l){for(var d=v.context,x=d.gl,M=v.useProgram("collisionBox"),D=[],B=0,G=0,W=0;W<I.length;W++){var Y=I[W],ee=w.getTile(Y),Q=ee.getBucket(_);if(Q){var le=Y.posMatrix;0===j[0]&&0===j[1]||(le=v.translatePosMatrix(Y.posMatrix,ee,j,f));var de=l?Q.textCollisionBox:Q.iconCollisionBox,ge=Q.collisionCircleArray;if(ge.length>0){var xe=L.create(),Te=le;L.mul(xe,Q.placementInvProjMatrix,v.transform.glCoordMatrix),L.mul(xe,xe,Q.placementViewportMatrix),D.push({circleArray:ge,circleOffset:G,transform:Te,invTransform:xe}),G=B+=ge.length/4}de&&M.draw(d,x.LINES,se.disabled,te.disabled,v.colorModeForRenderPass(),me.disabled,Ms(le,v.transform,ee),_.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,null,v.transform.zoom,null,null,de.collisionVertexBuffer)}}if(l&&D.length){var Ee=v.useProgram("collisionCircle"),Pe=new L.StructArrayLayout2f1f2i16;Pe.resize(4*B),Pe._trim();for(var Le=0,Me=0,Ue=D;Me<Ue.length;Me+=1)for(var Ye=Ue[Me],yt=0;yt<Ye.circleArray.length/4;yt++){var gt=4*yt,Ot=Ye.circleArray[gt+0],dt=Ye.circleArray[gt+1],Nt=Ye.circleArray[gt+2],wt=Ye.circleArray[gt+3];Pe.emplace(Le++,Ot,dt,Nt,wt,0),Pe.emplace(Le++,Ot,dt,Nt,wt,1),Pe.emplace(Le++,Ot,dt,Nt,wt,2),Pe.emplace(Le++,Ot,dt,Nt,wt,3)}(!Qn||Qn.length<2*B)&&(Qn=function(gr){var wr=2*gr,tr=new L.StructArrayLayout3ui6;tr.resize(wr),tr._trim();for(var Cr=0;Cr<wr;Cr++){var Wr=6*Cr;tr.uint16[Wr+0]=4*Cr+0,tr.uint16[Wr+1]=4*Cr+1,tr.uint16[Wr+2]=4*Cr+2,tr.uint16[Wr+3]=4*Cr+2,tr.uint16[Wr+4]=4*Cr+3,tr.uint16[Wr+5]=4*Cr+0}return tr}(B));for(var Zt=d.createIndexBuffer(Qn,!0),ft=d.createVertexBuffer(Pe,L.collisionCircleLayout.members,!0),Gt=0,Qt=D;Gt<Qt.length;Gt+=1){var mn=Qt[Gt],Hn=Ca(mn.transform,mn.invTransform,v.transform);Ee.draw(d,x.TRIANGLES,se.disabled,te.disabled,v.colorModeForRenderPass(),me.disabled,Hn,_.id,ft,Zt,L.SegmentVector.simpleSegment(0,2*mn.circleOffset,mn.circleArray.length,mn.circleArray.length/2),null,v.transform.zoom,null,null,null)}ft.destroy(),Zt.destroy()}}var wl=L.identity(new Float32Array(16));function sl(v,w,_,I,j,f){var l=L.getAnchorAlignment(v),d=-(l.horizontalAlign-.5)*w,x=-(l.verticalAlign-.5)*_,M=L.evaluateVariableOffset(v,I);return new L.Point((d/j+M[0])*f,(x/j+M[1])*f)}function bi(v,w,_,I,j,f,l,d,x,M,D){var B=v.text.placedSymbolArray,G=v.text.dynamicLayoutVertexArray,W=v.icon.dynamicLayoutVertexArray,Y={};G.clear();for(var ee=0;ee<B.length;ee++){var Q=B.get(ee),le=Q.hidden||!Q.crossTileID||v.allowVerticalPlacement&&!Q.placedOrientation?null:I[Q.crossTileID];if(le){var de=new L.Point(Q.anchorX,Q.anchorY),ge=Yr(de,_?d:l),xe=lr(f.cameraToCenterDistance,ge.signedDistanceFromCamera),Te=j.evaluateSizeForFeature(v.textSizeData,M,Q)*xe/L.ONE_EM;_&&(Te*=v.tilePixelRatio/x);for(var Ee=sl(le.anchor,le.width,le.height,le.textOffset,le.textBoxScale,Te),Pe=_?Yr(de.add(Ee),l).point:ge.point.add(w?Ee.rotate(-f.angle):Ee),Le=v.allowVerticalPlacement&&Q.placedOrientation===L.WritingMode.vertical?Math.PI/2:0,Me=0;Me<Q.numGlyphs;Me++)L.addDynamicAttributes(G,Pe,Le);D&&Q.associatedIconIndex>=0&&(Y[Q.associatedIconIndex]={shiftedAnchor:Pe,angle:Le})}else Fr(Q.numGlyphs,G)}if(D){W.clear();for(var Ue=v.icon.placedSymbolArray,Ye=0;Ye<Ue.length;Ye++){var yt=Ue.get(Ye);if(yt.hidden)Fr(yt.numGlyphs,W);else{var gt=Y[Ye];if(gt)for(var Ot=0;Ot<yt.numGlyphs;Ot++)L.addDynamicAttributes(W,gt.shiftedAnchor,gt.angle);else Fr(yt.numGlyphs,W)}}v.icon.dynamicLayoutVertexBuffer.updateData(W)}v.text.dynamicLayoutVertexBuffer.updateData(G)}function Ji(v,w,_){return _.iconsInText&&w?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function ac(v,w,_,I,j,f,l,d,x,M,D,B){for(var G=v.context,W=G.gl,Y=v.transform,ee="map"===d,Q="map"===x,le=ee&&"point"!==_.layout.get("symbol-placement"),de=ee&&!Q&&!le,ge=!_.layout.get("symbol-sort-key").isConstant(),xe=!1,Te=v.depthModeForSublayer(0,se.ReadOnly),Ee=_.layout.get("text-variable-anchor"),Pe=[],Le=0,Me=I;Le<Me.length;Le+=1){var Ue=Me[Le],Ye=w.getTile(Ue),yt=Ye.getBucket(_);if(yt){var gt=j?yt.text:yt.icon;if(gt&&gt.segments.get().length){var Ot=gt.programConfigurations.get(_.id),dt=j||yt.sdfIcons,Nt=j?yt.textSizeData:yt.iconSizeData,wt=Q||0!==Y.pitch,Zt=v.useProgram(Ji(dt,j,yt),Ot),ft=L.evaluateSizeForZoom(Nt,Y.zoom),Gt=void 0,Qt=[0,0],mn=void 0,Hn=void 0,gr=null,wr=void 0;if(j)mn=Ye.glyphAtlasTexture,Hn=W.LINEAR,Gt=Ye.glyphAtlasTexture.size,yt.iconsInText&&(Qt=Ye.imageAtlasTexture.size,gr=Ye.imageAtlasTexture,wr=wt||v.options.rotating||v.options.zooming||"composite"===Nt.kind||"camera"===Nt.kind?W.LINEAR:W.NEAREST);else{var tr=1!==_.layout.get("icon-size").constantOr(0)||yt.iconsNeedLinear;mn=Ye.imageAtlasTexture,Hn=dt||v.options.rotating||v.options.zooming||tr||wt?W.LINEAR:W.NEAREST,Gt=Ye.imageAtlasTexture.size}var Cr=Mn(Ye,1,v.transform.zoom),Wr=wn(Ue.posMatrix,Q,ee,v.transform,Cr),Zi=ri(Ue.posMatrix,Q,ee,v.transform,Cr),ha=Ee&&yt.hasTextData(),Do="none"!==_.layout.get("icon-text-fit")&&ha&&yt.hasIconData();le&&Kr(yt,Ue.posMatrix,v,j,Wr,Zi,Q,M);var xo=v.translatePosMatrix(Ue.posMatrix,Ye,f,l),Ko=le||j&&Ee||Do?wl:Wr,va=v.translatePosMatrix(Zi,Ye,f,l,!0),Tu=dt&&0!==_.paint.get(j?"text-halo-width":"icon-halo-width").constantOr(1),O={program:Zt,buffers:gt,uniformValues:dt?yt.iconsInText?Gs(Nt.kind,ft,de,Q,v,xo,Ko,va,Gt,Qt):So(Nt.kind,ft,de,Q,v,xo,Ko,va,j,Gt,!0):ui(Nt.kind,ft,de,Q,v,xo,Ko,va,j,Gt),atlasTexture:mn,atlasTextureIcon:gr,atlasInterpolation:Hn,atlasInterpolationIcon:wr,isSDF:dt,hasHalo:Tu};if(ge&&yt.canOverlap){xe=!0;for(var P=0,z=gt.segments.get();P<z.length;P+=1){var K=z[P];Pe.push({segments:new L.SegmentVector([K]),sortKey:K.sortKey,state:O})}}else Pe.push({segments:gt.segments,sortKey:0,state:O})}}}xe&&Pe.sort(function(nt,jt){return nt.sortKey-jt.sortKey});for(var he=0,fe=Pe;he<fe.length;he+=1){var Ie=fe[he],Fe=Ie.state;if(G.activeTexture.set(W.TEXTURE0),Fe.atlasTexture.bind(Fe.atlasInterpolation,W.CLAMP_TO_EDGE),Fe.atlasTextureIcon&&(G.activeTexture.set(W.TEXTURE1),Fe.atlasTextureIcon&&Fe.atlasTextureIcon.bind(Fe.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),Fe.isSDF){var at=Fe.uniformValues;Fe.hasHalo&&(at.u_is_halo=1,Lc(Fe.buffers,Ie.segments,_,v,Fe.program,Te,D,B,at)),at.u_is_halo=0}Lc(Fe.buffers,Ie.segments,_,v,Fe.program,Te,D,B,Fe.uniformValues)}}function Lc(v,w,_,I,j,f,l,d,x){var M=I.context;j.draw(M,M.gl.TRIANGLES,f,l,d,me.disabled,x,_.id,v.layoutVertexBuffer,v.indexBuffer,w,_.paint,I.transform.zoom,v.programConfigurations.get(_.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function sc(v,w,_,I,j,f,l){var d,x,M,D,B,G=v.context.gl,W=_.paint.get("fill-pattern"),Y=W&&W.constantOr(1),ee=_.getCrossfadeParameters();l?(x=Y&&!_.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",d=G.LINES):(x=Y?"fillPattern":"fill",d=G.TRIANGLES);for(var Q=0,le=I;Q<le.length;Q+=1){var de=le[Q],ge=w.getTile(de);if(!Y||ge.patternsLoaded()){var xe=ge.getBucket(_);if(xe){var Te=xe.programConfigurations.get(_.id),Ee=v.useProgram(x,Te);Y&&(v.context.activeTexture.set(G.TEXTURE0),ge.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Te.updatePaintBuffers(ee));var Pe=W.constantOr(null);if(Pe&&ge.imageAtlas){var Le=ge.imageAtlas,Me=Le.patternPositions[Pe.to.toString()],Ue=Le.patternPositions[Pe.from.toString()];Me&&Ue&&Te.setConstantPatternPositions(Me,Ue)}var Ye=v.translatePosMatrix(de.posMatrix,ge,_.paint.get("fill-translate"),_.paint.get("fill-translate-anchor"));if(l){D=xe.indexBuffer2,B=xe.segments2;var yt=[G.drawingBufferWidth,G.drawingBufferHeight];M="fillOutlinePattern"===x&&Y?Hh(Ye,v,ee,ge,yt):Rc(Ye,yt)}else D=xe.indexBuffer,B=xe.segments,M=Y?Gi(Ye,v,ee,ge):nu(Ye);Ee.draw(v.context,d,j,v.stencilModeForClipping(de),f,me.disabled,M,_.id,xe.layoutVertexBuffer,D,B,_.paint,v.transform.zoom,Te)}}}}function ja(v,w,_,I,j,f,l){for(var d=v.context,x=d.gl,M=_.paint.get("fill-extrusion-pattern"),D=M.constantOr(1),B=_.getCrossfadeParameters(),G=_.paint.get("fill-extrusion-opacity"),W=0,Y=I;W<Y.length;W+=1){var ee=Y[W],Q=w.getTile(ee),le=Q.getBucket(_);if(le){var de=le.programConfigurations.get(_.id),ge=v.useProgram(D?"fillExtrusionPattern":"fillExtrusion",de);D&&(v.context.activeTexture.set(x.TEXTURE0),Q.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),de.updatePaintBuffers(B));var xe=M.constantOr(null);if(xe&&Q.imageAtlas){var Te=Q.imageAtlas,Ee=Te.patternPositions[xe.to.toString()],Pe=Te.patternPositions[xe.from.toString()];Ee&&Pe&&de.setConstantPatternPositions(Ee,Pe)}var Le=v.translatePosMatrix(ee.posMatrix,Q,_.paint.get("fill-extrusion-translate"),_.paint.get("fill-extrusion-translate-anchor")),Me=_.paint.get("fill-extrusion-vertical-gradient"),Ue=D?nd(Le,v,Me,G,ee,B,Q):zl(Le,v,Me,G);ge.draw(d,d.gl.TRIANGLES,j,f,l,me.backCCW,Ue,_.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,_.paint,v.transform.zoom,de)}}}function cp(v,w,_,I,j,f){var l=v.context,d=l.gl,x=w.fbo;if(x){var M=v.useProgram("hillshade");l.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,x.colorAttachment.get());var D=function(B,G,W){var Y=W.paint.get("hillshade-shadow-color"),ee=W.paint.get("hillshade-highlight-color"),Q=W.paint.get("hillshade-accent-color"),le=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===W.paint.get("hillshade-illumination-anchor")&&(le-=B.transform.angle);var de,ge,xe,Te=!B.options.moving;return{u_matrix:B.transform.calculatePosMatrix(G.tileID.toUnwrapped(),Te),u_image:0,u_latrange:(de=G.tileID,ge=Math.pow(2,de.canonical.z),xe=de.canonical.y,[new L.MercatorCoordinate(0,xe/ge).toLngLat().lat,new L.MercatorCoordinate(0,(xe+1)/ge).toLngLat().lat]),u_light:[W.paint.get("hillshade-exaggeration"),le],u_shadow:Y,u_highlight:ee,u_accent:Q}}(v,w,_);M.draw(l,d.TRIANGLES,I,j,f,me.disabled,D,_.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}}function Vu(v,w,_,I,j,f){var ee,Q,le,de,l=v.context,d=l.gl,x=w.dem;if(x&&x.data){var M=x.dim,D=x.stride,B=x.getPixels();if(l.activeTexture.set(d.TEXTURE1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),w.demTexture=w.demTexture||v.getTileTexture(D),w.demTexture){var G=w.demTexture;G.update(B,{premultiply:!1}),G.bind(d.NEAREST,d.CLAMP_TO_EDGE)}else w.demTexture=new L.Texture(l,B,d.RGBA,{premultiply:!1}),w.demTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE);l.activeTexture.set(d.TEXTURE0);var W=w.fbo;if(!W){var Y=new L.Texture(l,{width:M,height:M,data:null},d.RGBA);Y.bind(d.LINEAR,d.CLAMP_TO_EDGE),(W=w.fbo=l.createFramebuffer(M,M,!0)).colorAttachment.set(Y.texture)}l.bindFramebuffer.set(W.framebuffer),l.viewport.set([0,0,M,M]),v.useProgram("hillshadePrepare").draw(l,d.TRIANGLES,I,j,f,me.disabled,(ee=w.tileID,le=(Q=x).stride,de=L.create(),L.ortho(de,0,L.EXTENT,-L.EXTENT,0,0,1),L.translate(de,de,[0,-L.EXTENT,0]),{u_matrix:de,u_image:1,u_dimension:[le,le],u_zoom:ee.overscaledZ,u_unpack:Q.getUnpackVector()}),_.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments),w.needsHillshadePrepare=!1}}function Gu(v,w,_,I,j){var f=I.paint.get("raster-fade-duration");if(f>0){var l=L.browser.now(),d=(l-v.timeAdded)/f,x=w?(l-w.timeAdded)/f:-1,M=_.getSource(),D=j.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),B=!w||Math.abs(w.tileID.overscaledZ-D)>Math.abs(v.tileID.overscaledZ-D),G=B&&v.refreshedUponExpiration?1:L.clamp(B?d:1-x,0,1);return v.refreshedUponExpiration&&d>=1&&(v.refreshedUponExpiration=!1),w?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}var vo=new L.Color(1,0,0,1),Op=new L.Color(0,1,0,1),qu=new L.Color(0,0,1,1),Cl=new L.Color(1,0,1,1),us=new L.Color(0,1,1,1);function nh(v,w,_,I){jl(v,0,w+_/2,v.transform.width,_,I)}function Wh(v,w,_,I){jl(v,w-_/2,0,_,v.transform.height,I)}function jl(v,w,_,I,j,f){var l=v.context,d=l.gl;d.enable(d.SCISSOR_TEST),d.scissor(w*L.browser.devicePixelRatio,_*L.browser.devicePixelRatio,I*L.browser.devicePixelRatio,j*L.browser.devicePixelRatio),l.clear({color:f}),d.disable(d.SCISSOR_TEST)}function cs(v,w,_){var I=v.context,j=I.gl,f=_.posMatrix,l=v.useProgram("debug"),d=se.disabled,x=te.disabled,M=v.colorModeForRenderPass();I.activeTexture.set(j.TEXTURE0),v.emptyTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),l.draw(I,j.LINE_STRIP,d,x,M,me.disabled,vu(f,L.Color.red),"$debug",v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments);var D=w.getTileByID(_.key).latestRawTileData,B=Math.floor((D&&D.byteLength||0)/1024),G=w.getTile(_).tileSize,W=512/Math.min(G,512)*(_.overscaledZ/v.transform.zoom)*.5,Y=_.canonical.toString();_.overscaledZ!==_.canonical.z&&(Y+=" => "+_.overscaledZ),function(ee,Q){ee.initDebugOverlayCanvas();var le=ee.debugOverlayCanvas,de=ee.context.gl,ge=ee.debugOverlayCanvas.getContext("2d");ge.clearRect(0,0,le.width,le.height),ge.shadowColor="white",ge.shadowBlur=2,ge.lineWidth=1.5,ge.strokeStyle="white",ge.textBaseline="top",ge.font="bold 36px Open Sans, sans-serif",ge.fillText(Q,5,5),ge.strokeText(Q,5,5),ee.debugOverlayTexture.update(le),ee.debugOverlayTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE)}(v,Y+" "+B+"kb"),l.draw(I,j.TRIANGLES,d,x,oe.alphaBlended,me.disabled,vu(f,L.Color.transparent,W),"$debug",v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments)}var El={symbol:function(v,w,_,I,j){if("translucent"===v.renderPass){var f=te.disabled,l=v.colorModeForRenderPass();_.layout.get("text-variable-anchor")&&function(d,x,M,D,B,G,W){for(var Y=x.transform,ee="map"===B,Q="map"===G,le=0,de=d;le<de.length;le+=1){var ge=de[le],xe=D.getTile(ge),Te=xe.getBucket(M);if(Te&&Te.text&&Te.text.segments.get().length){var Ee=L.evaluateSizeForZoom(Te.textSizeData,Y.zoom),Pe=Mn(xe,1,x.transform.zoom),Le=wn(ge.posMatrix,Q,ee,x.transform,Pe),Me="none"!==M.layout.get("icon-text-fit")&&Te.hasIconData();if(Ee){var Ue=Math.pow(2,Y.zoom-xe.tileID.overscaledZ);bi(Te,ee,Q,W,L.symbolSize,Y,Le,ge.posMatrix,Ue,Ee,Me)}}}}(I,v,_,w,_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),j),0!==_.paint.get("icon-opacity").constantOr(1)&&ac(v,w,_,I,!1,_.paint.get("icon-translate"),_.paint.get("icon-translate-anchor"),_.layout.get("icon-rotation-alignment"),_.layout.get("icon-pitch-alignment"),_.layout.get("icon-keep-upright"),f,l),0!==_.paint.get("text-opacity").constantOr(1)&&ac(v,w,_,I,!0,_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),_.layout.get("text-keep-upright"),f,l),w.map.showCollisionBoxes&&(Xo(v,w,_,I,_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),!0),Xo(v,w,_,I,_.paint.get("icon-translate"),_.paint.get("icon-translate-anchor"),!1))}},circle:function(v,w,_,I){if("translucent"===v.renderPass){var j=_.paint.get("circle-opacity"),f=_.paint.get("circle-stroke-width"),l=_.paint.get("circle-stroke-opacity"),d=!_.layout.get("circle-sort-key").isConstant();if(0!==j.constantOr(1)||0!==f.constantOr(1)&&0!==l.constantOr(1)){for(var x=v.context,M=x.gl,D=v.depthModeForSublayer(0,se.ReadOnly),B=te.disabled,G=v.colorModeForRenderPass(),W=[],Y=0;Y<I.length;Y++){var ee=I[Y],Q=w.getTile(ee),le=Q.getBucket(_);if(le){var de=le.programConfigurations.get(_.id),ge={programConfiguration:de,program:v.useProgram("circle",de),layoutVertexBuffer:le.layoutVertexBuffer,indexBuffer:le.indexBuffer,uniformValues:Pa(v,ee,Q,_)};if(d)for(var xe=0,Te=le.segments.get();xe<Te.length;xe+=1){var Ee=Te[xe];W.push({segments:new L.SegmentVector([Ee]),sortKey:Ee.sortKey,state:ge})}else W.push({segments:le.segments,sortKey:0,state:ge})}}d&&W.sort(function(Ye,yt){return Ye.sortKey-yt.sortKey});for(var Pe=0,Le=W;Pe<Le.length;Pe+=1){var Me=Le[Pe],Ue=Me.state;Ue.program.draw(x,M.TRIANGLES,D,B,G,me.disabled,Ue.uniformValues,_.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Me.segments,_.paint,v.transform.zoom,Ue.programConfiguration)}}}},heatmap:function(v,w,_,I){if(0!==_.paint.get("heatmap-opacity"))if("offscreen"===v.renderPass){var j=v.context,f=j.gl,l=te.disabled,d=new oe([f.ONE,f.ONE],L.Color.transparent,[!0,!0,!0,!0]);(function(W,Y,ee){var Q=W.gl;W.activeTexture.set(Q.TEXTURE1),W.viewport.set([0,0,Y.width/4,Y.height/4]);var ge,xe,Te,Ee,Pe,le=ee.heatmapFbo;if(le)Q.bindTexture(Q.TEXTURE_2D,le.colorAttachment.get()),W.bindFramebuffer.set(le.framebuffer);else{var de=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,de),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),Te=de,Ee=le=ee.heatmapFbo=W.createFramebuffer(Y.width/4,Y.height/4,!1),(Pe=(ge=W).gl).texImage2D(Pe.TEXTURE_2D,0,Pe.RGBA,(xe=Y).width/4,xe.height/4,0,Pe.RGBA,ge.extRenderToTextureHalfFloat?ge.extTextureHalfFloat.HALF_FLOAT_OES:Pe.UNSIGNED_BYTE,null),Ee.colorAttachment.set(Te)}})(j,v,_),j.clear({color:L.Color.transparent});for(var x=0;x<I.length;x++){var M=I[x];if(!w.hasRenderableParent(M)){var D=w.getTile(M),B=D.getBucket(_);if(B){var G=B.programConfigurations.get(_.id);v.useProgram("heatmap",G).draw(j,f.TRIANGLES,se.disabled,l,d,me.disabled,Ks(M.posMatrix,D,v.transform.zoom,_.paint.get("heatmap-intensity")),_.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,_.paint,v.transform.zoom,G)}}}j.viewport.set([0,0,v.width,v.height])}else"translucent"===v.renderPass&&(v.context.setColorMode(v.colorModeForRenderPass()),function(W,Y){var ee=W.context,Q=ee.gl,le=Y.heatmapFbo;if(le){ee.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_2D,le.colorAttachment.get()),ee.activeTexture.set(Q.TEXTURE1);var de=Y.colorRampTexture;de||(de=Y.colorRampTexture=new L.Texture(ee,Y.colorRamp,Q.RGBA)),de.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),W.useProgram("heatmapTexture").draw(ee,Q.TRIANGLES,se.disabled,te.disabled,W.colorModeForRenderPass(),me.disabled,function(ge,xe,Te,Ee){var Pe=L.create();L.ortho(Pe,0,ge.width,ge.height,0,0,1);var Le=ge.context.gl;return{u_matrix:Pe,u_world:[Le.drawingBufferWidth,Le.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:xe.paint.get("heatmap-opacity")}}(W,Y),Y.id,W.viewportBuffer,W.quadTriangleIndexBuffer,W.viewportSegments,Y.paint,W.transform.zoom)}}(v,_))},line:function(v,w,_,I){if("translucent"===v.renderPass){var j=_.paint.get("line-opacity"),f=_.paint.get("line-width");if(0!==j.constantOr(1)&&0!==f.constantOr(1))for(var l=v.depthModeForSublayer(0,se.ReadOnly),d=v.colorModeForRenderPass(),x=_.paint.get("line-dasharray"),M=_.paint.get("line-pattern"),D=M.constantOr(1),B=_.paint.get("line-gradient"),G=_.getCrossfadeParameters(),W=D?"linePattern":x?"lineSDF":B?"lineGradient":"line",Y=v.context,ee=Y.gl,Q=!0,le=0,de=I;le<de.length;le+=1){var ge=de[le],xe=w.getTile(ge);if(!D||xe.patternsLoaded()){var Te=xe.getBucket(_);if(Te){var Ee=Te.programConfigurations.get(_.id),Pe=v.context.program.get(),Le=v.useProgram(W,Ee),Me=Q||Le.program!==Pe,Ue=M.constantOr(null);if(Ue&&xe.imageAtlas){var Ye=xe.imageAtlas,yt=Ye.patternPositions[Ue.to.toString()],gt=Ye.patternPositions[Ue.from.toString()];yt&&gt&&Ee.setConstantPatternPositions(yt,gt)}var Ot=D?Ki(v,xe,_,G):x?Ih(v,xe,_,x,G):B?Oc(v,xe,_,Te.lineClipsArray.length):Uu(v,xe,_);if(D)Y.activeTexture.set(ee.TEXTURE0),xe.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),Ee.updatePaintBuffers(G);else if(x&&(Me||v.lineAtlas.dirty))Y.activeTexture.set(ee.TEXTURE0),v.lineAtlas.bind(Y);else if(B){var dt=Te.gradients[_.id],Nt=dt.texture;if(_.gradientVersion!==dt.version){var wt=256;if(_.stepInterpolant){var Zt=w.getSource().maxzoom,ft=ge.canonical.z===Zt?Math.ceil(1<<v.transform.maxZoom-ge.canonical.z):1;wt=L.clamp(L.nextPowerOfTwo(Te.maxLineLength/L.EXTENT*1024*ft),256,Y.maxTextureSize)}dt.gradient=L.renderColorRamp({expression:_.gradientExpression(),evaluationKey:"lineProgress",resolution:wt,image:dt.gradient||void 0,clips:Te.lineClipsArray}),dt.texture?dt.texture.update(dt.gradient):dt.texture=new L.Texture(Y,dt.gradient,ee.RGBA),dt.version=_.gradientVersion,Nt=dt.texture}Y.activeTexture.set(ee.TEXTURE0),Nt.bind(_.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}Le.draw(Y,ee.TRIANGLES,l,v.stencilModeForClipping(ge),d,me.disabled,Ot,_.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,_.paint,v.transform.zoom,Ee,Te.layoutVertexBuffer2),Q=!1}}}}},fill:function(v,w,_,I){var j=_.paint.get("fill-color"),f=_.paint.get("fill-opacity");if(0!==f.constantOr(1)){var l=v.colorModeForRenderPass(),d=_.paint.get("fill-pattern"),x=v.opaquePassEnabledForLayer()&&!d.constantOr(1)&&1===j.constantOr(L.Color.transparent).a&&1===f.constantOr(0)?"opaque":"translucent";if(v.renderPass===x){var M=v.depthModeForSublayer(1,"opaque"===v.renderPass?se.ReadWrite:se.ReadOnly);sc(v,w,_,I,M,l,!1)}if("translucent"===v.renderPass&&_.paint.get("fill-antialias")){var D=v.depthModeForSublayer(_.getPaintProperty("fill-outline-color")?2:0,se.ReadOnly);sc(v,w,_,I,D,l,!0)}}},"fill-extrusion":function(v,w,_,I){var j=_.paint.get("fill-extrusion-opacity");if(0!==j&&"translucent"===v.renderPass){var f=new se(v.context.gl.LEQUAL,se.ReadWrite,v.depthRangeFor3D);if(1!==j||_.paint.get("fill-extrusion-pattern").constantOr(1))ja(v,w,_,I,f,te.disabled,oe.disabled),ja(v,w,_,I,f,v.stencilModeFor3D(),v.colorModeForRenderPass());else{var l=v.colorModeForRenderPass();ja(v,w,_,I,f,te.disabled,l)}}},hillshade:function(v,w,_,I){if("offscreen"===v.renderPass||"translucent"===v.renderPass){for(var j=v.context,f=v.depthModeForSublayer(0,se.ReadOnly),l=v.colorModeForRenderPass(),d="translucent"===v.renderPass?v.stencilConfigForOverlap(I):[{},I],x=d[0],M=0,D=d[1];M<D.length;M+=1){var B=D[M],G=w.getTile(B);G.needsHillshadePrepare&&"offscreen"===v.renderPass?Vu(v,G,_,f,te.disabled,l):"translucent"===v.renderPass&&cp(v,G,_,f,x[B.overscaledZ],l)}j.viewport.set([0,0,v.width,v.height])}},raster:function(v,w,_,I){if("translucent"===v.renderPass&&0!==_.paint.get("raster-opacity")&&I.length)for(var j=v.context,f=j.gl,l=w.getSource(),d=v.useProgram("raster"),x=v.colorModeForRenderPass(),M=l instanceof Er?[{},I]:v.stencilConfigForOverlap(I),D=M[0],B=M[1],G=B[B.length-1].overscaledZ,W=!v.options.moving,Y=0,ee=B;Y<ee.length;Y+=1){var Q=ee[Y],le=v.depthModeForSublayer(Q.overscaledZ-G,1===_.paint.get("raster-opacity")?se.ReadWrite:se.ReadOnly,f.LESS),de=w.getTile(Q),ge=v.transform.calculatePosMatrix(Q.toUnwrapped(),W);de.registerFadeDuration(_.paint.get("raster-fade-duration"));var xe=w.findLoadedParent(Q,0),Te=Gu(de,xe,w,_,v.transform),Ee=void 0,Pe=void 0,Le="nearest"===_.paint.get("raster-resampling")?f.NEAREST:f.LINEAR;j.activeTexture.set(f.TEXTURE0),de.texture.bind(Le,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST),j.activeTexture.set(f.TEXTURE1),xe?(xe.texture.bind(Le,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST),Ee=Math.pow(2,xe.tileID.overscaledZ-de.tileID.overscaledZ),Pe=[de.tileID.canonical.x*Ee%1,de.tileID.canonical.y*Ee%1]):de.texture.bind(Le,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST);var Me=Rp(ge,Pe||[0,0],Ee||1,Te,_);l instanceof Er?d.draw(j,f.TRIANGLES,le,te.disabled,x,me.disabled,Me,_.id,l.boundsBuffer,v.quadTriangleIndexBuffer,l.boundsSegments):d.draw(j,f.TRIANGLES,le,D[Q.overscaledZ],x,me.disabled,Me,_.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}},background:function(v,w,_){var I=_.paint.get("background-color"),j=_.paint.get("background-opacity");if(0!==j){var f=v.context,l=f.gl,d=v.transform,x=d.tileSize,M=_.paint.get("background-pattern");if(!v.isPatternMissing(M)){var D=!M&&1===I.a&&1===j&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass===D){var B=te.disabled,G=v.depthModeForSublayer(0,"opaque"===D?se.ReadWrite:se.ReadOnly),W=v.colorModeForRenderPass(),Y=v.useProgram(M?"backgroundPattern":"background"),ee=d.coveringTiles({tileSize:x});M&&(f.activeTexture.set(l.TEXTURE0),v.imageManager.bind(v.context));for(var Q=_.getCrossfadeParameters(),le=0,de=ee;le<de.length;le+=1){var ge=de[le],xe=v.transform.calculatePosMatrix(ge.toUnwrapped()),Te=M?Ao(xe,j,v,M,{tileID:ge,tileSize:x},Q):ru(xe,j,I);Y.draw(f,l.TRIANGLES,G,B,W,me.disabled,Te,_.id,v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}}}},debug:function(v,w,_){for(var I=0;I<_.length;I++)cs(v,w,_[I])},custom:function(v,w,_){var I=v.context,j=_.implementation;if("offscreen"===v.renderPass){var f=j.prerender;f&&(v.setCustomLayerDefaults(),I.setColorMode(v.colorModeForRenderPass()),f.call(j,I.gl,v.transform.customLayerMatrix()),I.setDirty(),v.setBaseState())}else if("translucent"===v.renderPass){v.setCustomLayerDefaults(),I.setColorMode(v.colorModeForRenderPass()),I.setStencilMode(te.disabled);var l="3d"===j.renderingMode?new se(v.context.gl.LEQUAL,se.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,se.ReadOnly);I.setDepthMode(l),j.render(I.gl,v.transform.customLayerMatrix()),I.setDirty(),v.setBaseState(),I.bindFramebuffer.set(null)}}},_o=function(v,w){this.context=new ve(v),this.transform=w,this._tileTextures={},this.setup(),this.numSublayers=pe.maxUnderzooming+pe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new io,this.gpuTimers={}};_o.prototype.resize=function(v,w){if(this.width=v*L.browser.devicePixelRatio,this.height=w*L.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var _=0,I=this.style._order;_<I.length;_+=1)this.style._layers[I[_]].resize()},_o.prototype.setup=function(){var v=this.context,w=new L.StructArrayLayout2i4;w.emplaceBack(0,0),w.emplaceBack(L.EXTENT,0),w.emplaceBack(0,L.EXTENT),w.emplaceBack(L.EXTENT,L.EXTENT),this.tileExtentBuffer=v.createVertexBuffer(w,wa.members),this.tileExtentSegments=L.SegmentVector.simpleSegment(0,0,4,2);var _=new L.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(L.EXTENT,0),_.emplaceBack(0,L.EXTENT),_.emplaceBack(L.EXTENT,L.EXTENT),this.debugBuffer=v.createVertexBuffer(_,wa.members),this.debugSegments=L.SegmentVector.simpleSegment(0,0,4,5);var I=new L.StructArrayLayout4i8;I.emplaceBack(0,0,0,0),I.emplaceBack(L.EXTENT,0,L.EXTENT,0),I.emplaceBack(0,L.EXTENT,0,L.EXTENT),I.emplaceBack(L.EXTENT,L.EXTENT,L.EXTENT,L.EXTENT),this.rasterBoundsBuffer=v.createVertexBuffer(I,vr.members),this.rasterBoundsSegments=L.SegmentVector.simpleSegment(0,0,4,2);var j=new L.StructArrayLayout2i4;j.emplaceBack(0,0),j.emplaceBack(1,0),j.emplaceBack(0,1),j.emplaceBack(1,1),this.viewportBuffer=v.createVertexBuffer(j,wa.members),this.viewportSegments=L.SegmentVector.simpleSegment(0,0,4,2);var f=new L.StructArrayLayout1ui2;f.emplaceBack(0),f.emplaceBack(1),f.emplaceBack(3),f.emplaceBack(2),f.emplaceBack(0),this.tileBorderIndexBuffer=v.createIndexBuffer(f);var l=new L.StructArrayLayout3ui6;l.emplaceBack(0,1,2),l.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=v.createIndexBuffer(l),this.emptyTexture=new L.Texture(v,{width:1,height:1,data:new Uint8Array([0,0,0,0])},v.gl.RGBA);var d=this.context.gl;this.stencilClearMode=new te({func:d.ALWAYS,mask:0},0,255,d.ZERO,d.ZERO,d.ZERO)},_o.prototype.clearStencil=function(){var v=this.context,w=v.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var _=L.create();L.ortho(_,0,this.width,this.height,0,0,1),L.scale(_,_,[w.drawingBufferWidth,w.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(v,w.TRIANGLES,se.disabled,this.stencilClearMode,oe.disabled,me.disabled,Nl(_),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},_o.prototype._renderTileClippingMasks=function(v,w){if(this.currentStencilSource!==v.source&&v.isTileClipped()&&w&&w.length){this.currentStencilSource=v.source;var _=this.context,I=_.gl;this.nextStencilID+w.length>256&&this.clearStencil(),_.setColorMode(oe.disabled),_.setDepthMode(se.disabled);var j=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var f=0,l=w;f<l.length;f+=1){var d=l[f],x=this._tileClippingMaskIDs[d.key]=this.nextStencilID++;j.draw(_,I.TRIANGLES,se.disabled,new te({func:I.ALWAYS,mask:0},x,255,I.KEEP,I.KEEP,I.REPLACE),oe.disabled,me.disabled,Nl(d.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},_o.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var v=this.nextStencilID++,w=this.context.gl;return new te({func:w.NOTEQUAL,mask:255},v,255,w.KEEP,w.KEEP,w.REPLACE)},_o.prototype.stencilModeForClipping=function(v){var w=this.context.gl;return new te({func:w.EQUAL,mask:255},this._tileClippingMaskIDs[v.key],0,w.KEEP,w.KEEP,w.REPLACE)},_o.prototype.stencilConfigForOverlap=function(v){var w,_=this.context.gl,I=v.sort(function(x,M){return M.overscaledZ-x.overscaledZ}),j=I[I.length-1].overscaledZ,f=I[0].overscaledZ-j+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();for(var l={},d=0;d<f;d++)l[d+j]=new te({func:_.GEQUAL,mask:255},d+this.nextStencilID,255,_.KEEP,_.KEEP,_.REPLACE);return this.nextStencilID+=f,[l,I]}return[(w={},w[j]=te.disabled,w),I]},_o.prototype.colorModeForRenderPass=function(){var v=this.context.gl;return this._showOverdrawInspector?new oe([v.CONSTANT_COLOR,v.ONE],new L.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?oe.unblended:oe.alphaBlended},_o.prototype.depthModeForSublayer=function(v,w,_){if(!this.opaquePassEnabledForLayer())return se.disabled;var I=1-((1+this.currentLayer)*this.numSublayers+v)*this.depthEpsilon;return new se(_||this.context.gl.LEQUAL,w,[I,I])},_o.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},_o.prototype.render=function(v,w){var _=this;this.style=v,this.options=w,this.lineAtlas=v.lineAtlas,this.imageManager=v.imageManager,this.glyphManager=v.glyphManager,this.symbolFadeChange=v.placement.symbolFadeChange(L.browser.now()),this.imageManager.beginFrame();var I=this.style._order,j=this.style.sourceCaches;for(var f in j){var l=j[f];l.used&&l.prepare(this.context)}var d,x,M={},D={},B={};for(var G in j){var W=j[G];M[G]=W.getVisibleCoordinates(),D[G]=M[G].slice().reverse(),B[G]=W.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Y=0;Y<I.length;Y++)if(this.style._layers[I[Y]].is3D()){this.opaquePassCutoff=Y;break}this.renderPass="offscreen";for(var ee=0,Q=I;ee<Q.length;ee+=1){var le=this.style._layers[Q[ee]];if(le.hasOffscreenPass()&&!le.isHidden(this.transform.zoom)){var de=D[le.source];("custom"===le.type||de.length)&&this.renderLayer(this,j[le.source],le,de)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:w.showOverdrawInspector?L.Color.black:L.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=w.showOverdrawInspector,this.depthRangeFor3D=[0,1-(v._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){var ge=this.style._layers[I[this.currentLayer]],xe=j[ge.source],Te=M[ge.source];this._renderTileClippingMasks(ge,Te),this.renderLayer(this,xe,ge,Te)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){var Ee=this.style._layers[I[this.currentLayer]],Pe=j[Ee.source],Le=("symbol"===Ee.type?B:D)[Ee.source];this._renderTileClippingMasks(Ee,M[Ee.source]),this.renderLayer(this,Pe,Ee,Le)}this.options.showTileBoundaries&&(L.values(this.style._layers).forEach(function(Me){Me.source&&!Me.isHidden(_.transform.zoom)&&(Me.source!==(x&&x.id)&&(x=_.style.sourceCaches[Me.source]),(!d||d.getSource().maxzoom<x.getSource().maxzoom)&&(d=x))}),d&&El.debug(this,d,d.getVisibleCoordinates())),this.options.showPadding&&function(Me){var Ue=Me.transform.padding;nh(Me,Me.transform.height-(Ue.top||0),3,vo),nh(Me,Ue.bottom||0,3,Op),Wh(Me,Ue.left||0,3,qu),Wh(Me,Me.transform.width-(Ue.right||0),3,Cl);var yt,gt,Ot,dt,Ye=Me.transform.centerPoint;jl(yt=Me,(gt=Ye.x)-1,(Ot=Me.transform.height-Ye.y)-10,2,20,dt=us),jl(yt,gt-10,Ot-1,20,2,dt)}(this),this.context.setDefault()},_o.prototype.renderLayer=function(v,w,_,I){_.isHidden(this.transform.zoom)||("background"===_.type||"custom"===_.type||I.length)&&(this.id=_.id,this.gpuTimingStart(_),El[_.type](v,w,_,I,this.style.placement.variableOffsets),this.gpuTimingEnd())},_o.prototype.gpuTimingStart=function(v){if(this.options.gpuTiming){var w=this.context.extTimerQuery,_=this.gpuTimers[v.id];_||(_=this.gpuTimers[v.id]={calls:0,cpuTime:0,query:w.createQueryEXT()}),_.calls++,w.beginQueryEXT(w.TIME_ELAPSED_EXT,_.query)}},_o.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var v=this.context.extTimerQuery;v.endQueryEXT(v.TIME_ELAPSED_EXT)}},_o.prototype.collectGpuTimers=function(){var v=this.gpuTimers;return this.gpuTimers={},v},_o.prototype.queryGpuTimers=function(v){var w={};for(var _ in v){var I=v[_],j=this.context.extTimerQuery,f=j.getQueryObjectEXT(I.query,j.QUERY_RESULT_EXT)/1e6;j.deleteQueryEXT(I.query),w[_]=f}return w},_o.prototype.translatePosMatrix=function(v,w,_,I,j){if(!_[0]&&!_[1])return v;var f=j?"map"===I?this.transform.angle:0:"viewport"===I?-this.transform.angle:0;if(f){var l=Math.sin(f),d=Math.cos(f);_=[_[0]*d-_[1]*l,_[0]*l+_[1]*d]}var x=[j?_[0]:Mn(w,_[0],this.transform.zoom),j?_[1]:Mn(w,_[1],this.transform.zoom),0],M=new Float32Array(16);return L.translate(M,v,x),M},_o.prototype.saveTileTexture=function(v){var w=this._tileTextures[v.size[0]];w?w.push(v):this._tileTextures[v.size[0]]=[v]},_o.prototype.getTileTexture=function(v){var w=this._tileTextures[v];return w&&w.length>0?w.pop():null},_o.prototype.isPatternMissing=function(v){if(!v)return!1;if(!v.from||!v.to)return!0;var w=this.imageManager.getPattern(v.from.toString()),_=this.imageManager.getPattern(v.to.toString());return!w||!_},_o.prototype.useProgram=function(v,w){this.cache=this.cache||{};var _=""+v+(w?w.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[_]||(this.cache[_]=new eo(this.context,v,bl[v],w,Bl[v],this._showOverdrawInspector)),this.cache[_]},_o.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},_o.prototype.setBaseState=function(){var v=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(v.FUNC_ADD)},_o.prototype.initDebugOverlayCanvas=function(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=L.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new L.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},_o.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var $h=function(v,w){this.points=v,this.planes=w};$h.fromInvProjectionMatrix=function(v,w,_){var I=Math.pow(2,_),j=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(l){return L.transformMat4([],l,v)}).map(function(l){return L.scale$1([],l,1/l[3]/w*I)}),f=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(l){var d=L.sub([],j[l[0]],j[l[1]]),x=L.sub([],j[l[2]],j[l[1]]),M=L.normalize([],L.cross([],d,x)),D=-L.dot(M,j[l[1]]);return M.concat(D)});return new $h(j,f)};var Zu=function(v,w){this.min=v,this.max=w,this.center=L.scale$2([],L.add([],this.min,this.max),.5)};Zu.prototype.quadrant=function(v){for(var w=[v%2==0,v<2],_=L.clone$2(this.min),I=L.clone$2(this.max),j=0;j<w.length;j++)_[j]=w[j]?this.min[j]:this.center[j],I[j]=w[j]?this.center[j]:this.max[j];return I[2]=this.max[2],new Zu(_,I)},Zu.prototype.distanceX=function(v){return Math.max(Math.min(this.max[0],v[0]),this.min[0])-v[0]},Zu.prototype.distanceY=function(v){return Math.max(Math.min(this.max[1],v[1]),this.min[1])-v[1]},Zu.prototype.intersects=function(v){for(var w=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],_=!0,I=0;I<v.planes.length;I++){for(var j=v.planes[I],f=0,l=0;l<w.length;l++)f+=L.dot$1(j,w[l])>=0;if(0===f)return 0;f!==w.length&&(_=!1)}if(_)return 2;for(var d=0;d<3;d++){for(var x=Number.MAX_VALUE,M=-Number.MAX_VALUE,D=0;D<v.points.length;D++){var B=v.points[D][d]-this.min[d];x=Math.min(x,B),M=Math.max(M,B)}if(M<0||x>this.max[d]-this.min[d])return 0}return 1};var iu=function(v,w,_,I){if(void 0===v&&(v=0),void 0===w&&(w=0),void 0===_&&(_=0),void 0===I&&(I=0),isNaN(v)||v<0||isNaN(w)||w<0||isNaN(_)||_<0||isNaN(I)||I<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=v,this.bottom=w,this.left=_,this.right=I};iu.prototype.interpolate=function(v,w,_){return null!=w.top&&null!=v.top&&(this.top=L.number(v.top,w.top,_)),null!=w.bottom&&null!=v.bottom&&(this.bottom=L.number(v.bottom,w.bottom,_)),null!=w.left&&null!=v.left&&(this.left=L.number(v.left,w.left,_)),null!=w.right&&null!=v.right&&(this.right=L.number(v.right,w.right,_)),this},iu.prototype.getCenter=function(v,w){var _=L.clamp((this.left+v-this.right)/2,0,v),I=L.clamp((this.top+w-this.bottom)/2,0,w);return new L.Point(_,I)},iu.prototype.equals=function(v){return this.top===v.top&&this.bottom===v.bottom&&this.left===v.left&&this.right===v.right},iu.prototype.clone=function(){return new iu(this.top,this.bottom,this.left,this.right)},iu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var qi=function(v,w,_,I,j){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===j||j,this._minZoom=v||0,this._maxZoom=w||22,this._minPitch=null==_?0:_,this._maxPitch=null==I?60:I,this.setMaxBounds(),this.width=0,this.height=0,this._center=new L.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new iu,this._posMatrixCache={},this._alignedPosMatrixCache={}},yi={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};qi.prototype.clone=function(){var v=new qi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return v.tileSize=this.tileSize,v.latRange=this.latRange,v.width=this.width,v.height=this.height,v._center=this._center,v.zoom=this.zoom,v.angle=this.angle,v._fov=this._fov,v._pitch=this._pitch,v._unmodified=this._unmodified,v._edgeInsets=this._edgeInsets.clone(),v._calcMatrices(),v},yi.minZoom.get=function(){return this._minZoom},yi.minZoom.set=function(v){this._minZoom!==v&&(this._minZoom=v,this.zoom=Math.max(this.zoom,v))},yi.maxZoom.get=function(){return this._maxZoom},yi.maxZoom.set=function(v){this._maxZoom!==v&&(this._maxZoom=v,this.zoom=Math.min(this.zoom,v))},yi.minPitch.get=function(){return this._minPitch},yi.minPitch.set=function(v){this._minPitch!==v&&(this._minPitch=v,this.pitch=Math.max(this.pitch,v))},yi.maxPitch.get=function(){return this._maxPitch},yi.maxPitch.set=function(v){this._maxPitch!==v&&(this._maxPitch=v,this.pitch=Math.min(this.pitch,v))},yi.renderWorldCopies.get=function(){return this._renderWorldCopies},yi.renderWorldCopies.set=function(v){void 0===v?v=!0:null===v&&(v=!1),this._renderWorldCopies=v},yi.worldSize.get=function(){return this.tileSize*this.scale},yi.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},yi.size.get=function(){return new L.Point(this.width,this.height)},yi.bearing.get=function(){return-this.angle/Math.PI*180},yi.bearing.set=function(v){var w=-L.wrap(v,-180,180)*Math.PI/180;this.angle!==w&&(this._unmodified=!1,this.angle=w,this._calcMatrices(),this.rotationMatrix=L.create$2(),L.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},yi.pitch.get=function(){return this._pitch/Math.PI*180},yi.pitch.set=function(v){var w=L.clamp(v,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==w&&(this._unmodified=!1,this._pitch=w,this._calcMatrices())},yi.fov.get=function(){return this._fov/Math.PI*180},yi.fov.set=function(v){v=Math.max(.01,Math.min(60,v)),this._fov!==v&&(this._unmodified=!1,this._fov=v/180*Math.PI,this._calcMatrices())},yi.zoom.get=function(){return this._zoom},yi.zoom.set=function(v){var w=Math.min(Math.max(v,this.minZoom),this.maxZoom);this._zoom!==w&&(this._unmodified=!1,this._zoom=w,this.scale=this.zoomScale(w),this.tileZoom=Math.floor(w),this.zoomFraction=w-this.tileZoom,this._constrain(),this._calcMatrices())},yi.center.get=function(){return this._center},yi.center.set=function(v){v.lat===this._center.lat&&v.lng===this._center.lng||(this._unmodified=!1,this._center=v,this._constrain(),this._calcMatrices())},yi.padding.get=function(){return this._edgeInsets.toJSON()},yi.padding.set=function(v){this._edgeInsets.equals(v)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,v,1),this._calcMatrices())},yi.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},qi.prototype.isPaddingEqual=function(v){return this._edgeInsets.equals(v)},qi.prototype.interpolatePadding=function(v,w,_){this._unmodified=!1,this._edgeInsets.interpolate(v,w,_),this._constrain(),this._calcMatrices()},qi.prototype.coveringZoomLevel=function(v){var w=(v.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/v.tileSize));return Math.max(0,w)},qi.prototype.getVisibleUnwrappedCoordinates=function(v){var w=[new L.UnwrappedTileID(0,v)];if(this._renderWorldCopies)for(var _=this.pointCoordinate(new L.Point(0,0)),I=this.pointCoordinate(new L.Point(this.width,0)),j=this.pointCoordinate(new L.Point(this.width,this.height)),f=this.pointCoordinate(new L.Point(0,this.height)),l=Math.floor(Math.min(_.x,I.x,j.x,f.x)),d=Math.floor(Math.max(_.x,I.x,j.x,f.x)),x=l-1;x<=d+1;x++)0!==x&&w.push(new L.UnwrappedTileID(x,v));return w},qi.prototype.coveringTiles=function(v){var w=this.coveringZoomLevel(v),_=w;if(void 0!==v.minzoom&&w<v.minzoom)return[];void 0!==v.maxzoom&&w>v.maxzoom&&(w=v.maxzoom);var I=L.MercatorCoordinate.fromLngLat(this.center),j=Math.pow(2,w),f=[j*I.x,j*I.y,0],l=$h.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,w),d=v.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(d=w);var x=function(Me){return{aabb:new Zu([Me*j,0,0],[(Me+1)*j,j,0]),zoom:0,x:0,y:0,wrap:Me,fullyVisible:!1}},M=[],D=[],B=w,G=v.reparseOverscaled?_:w;if(this._renderWorldCopies)for(var W=1;W<=3;W++)M.push(x(-W)),M.push(x(W));for(M.push(x(0));M.length>0;){var Y=M.pop(),ee=Y.x,Q=Y.y,le=Y.fullyVisible;if(!le){var de=Y.aabb.intersects(l);if(0===de)continue;le=2===de}var ge=Y.aabb.distanceX(f),xe=Y.aabb.distanceY(f),Te=Math.max(Math.abs(ge),Math.abs(xe));if(Y.zoom===B||Te>3+(1<<B-Y.zoom)-2&&Y.zoom>=d)D.push({tileID:new L.OverscaledTileID(Y.zoom===B?G:Y.zoom,Y.wrap,Y.zoom,ee,Q),distanceSq:L.sqrLen([f[0]-.5-ee,f[1]-.5-Q])});else for(var Ee=0;Ee<4;Ee++){var Pe=(ee<<1)+Ee%2,Le=(Q<<1)+(Ee>>1);M.push({aabb:Y.aabb.quadrant(Ee),zoom:Y.zoom+1,x:Pe,y:Le,wrap:Y.wrap,fullyVisible:le})}}return D.sort(function(Me,Ue){return Me.distanceSq-Ue.distanceSq}).map(function(Me){return Me.tileID})},qi.prototype.resize=function(v,w){this.width=v,this.height=w,this.pixelsToGLUnits=[2/v,-2/w],this._constrain(),this._calcMatrices()},yi.unmodified.get=function(){return this._unmodified},qi.prototype.zoomScale=function(v){return Math.pow(2,v)},qi.prototype.scaleZoom=function(v){return Math.log(v)/Math.LN2},qi.prototype.project=function(v){var w=L.clamp(v.lat,-this.maxValidLatitude,this.maxValidLatitude);return new L.Point(L.mercatorXfromLng(v.lng)*this.worldSize,L.mercatorYfromLat(w)*this.worldSize)},qi.prototype.unproject=function(v){return new L.MercatorCoordinate(v.x/this.worldSize,v.y/this.worldSize).toLngLat()},yi.point.get=function(){return this.project(this.center)},qi.prototype.setLocationAtPoint=function(v,w){var _=this.pointCoordinate(w),I=this.pointCoordinate(this.centerPoint),j=this.locationCoordinate(v),f=new L.MercatorCoordinate(j.x-(_.x-I.x),j.y-(_.y-I.y));this.center=this.coordinateLocation(f),this._renderWorldCopies&&(this.center=this.center.wrap())},qi.prototype.locationPoint=function(v){return this.coordinatePoint(this.locationCoordinate(v))},qi.prototype.pointLocation=function(v){return this.coordinateLocation(this.pointCoordinate(v))},qi.prototype.locationCoordinate=function(v){return L.MercatorCoordinate.fromLngLat(v)},qi.prototype.coordinateLocation=function(v){return v.toLngLat()},qi.prototype.pointCoordinate=function(v){var w=[v.x,v.y,0,1],_=[v.x,v.y,1,1];L.transformMat4(w,w,this.pixelMatrixInverse),L.transformMat4(_,_,this.pixelMatrixInverse);var I=w[3],j=_[3],f=w[1]/I,l=_[1]/j,d=w[2]/I,x=_[2]/j,M=d===x?0:(0-d)/(x-d);return new L.MercatorCoordinate(L.number(w[0]/I,_[0]/j,M)/this.worldSize,L.number(f,l,M)/this.worldSize)},qi.prototype.coordinatePoint=function(v){var w=[v.x*this.worldSize,v.y*this.worldSize,0,1];return L.transformMat4(w,w,this.pixelMatrix),new L.Point(w[0]/w[3],w[1]/w[3])},qi.prototype.getBounds=function(){return(new L.LngLatBounds).extend(this.pointLocation(new L.Point(0,0))).extend(this.pointLocation(new L.Point(this.width,0))).extend(this.pointLocation(new L.Point(this.width,this.height))).extend(this.pointLocation(new L.Point(0,this.height)))},qi.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new L.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},qi.prototype.setMaxBounds=function(v){v?(this.lngRange=[v.getWest(),v.getEast()],this.latRange=[v.getSouth(),v.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},qi.prototype.calculatePosMatrix=function(v,w){void 0===w&&(w=!1);var _=v.key,I=w?this._alignedPosMatrixCache:this._posMatrixCache;if(I[_])return I[_];var j=v.canonical,f=this.worldSize/this.zoomScale(j.z),l=j.x+Math.pow(2,j.z)*v.wrap,d=L.identity(new Float64Array(16));return L.translate(d,d,[l*f,j.y*f,0]),L.scale(d,d,[f/L.EXTENT,f/L.EXTENT,1]),L.multiply(d,w?this.alignedProjMatrix:this.projMatrix,d),I[_]=new Float32Array(d),I[_]},qi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},qi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var v,w,_,I,j=-90,f=90,l=-180,d=180,x=this.size,M=this._unmodified;if(this.latRange){var D=this.latRange;j=L.mercatorYfromLat(D[1])*this.worldSize,v=(f=L.mercatorYfromLat(D[0])*this.worldSize)-j<x.y?x.y/(f-j):0}if(this.lngRange){var B=this.lngRange;l=L.mercatorXfromLng(B[0])*this.worldSize,w=(d=L.mercatorXfromLng(B[1])*this.worldSize)-l<x.x?x.x/(d-l):0}var G=this.point,W=Math.max(w||0,v||0);if(W)return this.center=this.unproject(new L.Point(w?(d+l)/2:G.x,v?(f+j)/2:G.y)),this.zoom+=this.scaleZoom(W),this._unmodified=M,void(this._constraining=!1);if(this.latRange){var Y=G.y,ee=x.y/2;Y-ee<j&&(I=j+ee),Y+ee>f&&(I=f-ee)}if(this.lngRange){var Q=G.x,le=x.x/2;Q-le<l&&(_=l+le),Q+le>d&&(_=d-le)}void 0===_&&void 0===I||(this.center=this.unproject(new L.Point(void 0!==_?_:G.x,void 0!==I?I:G.y))),this._unmodified=M,this._constraining=!1}},qi.prototype._calcMatrices=function(){if(this.height){var v=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var w=Math.PI/2+this._pitch,_=this._fov*(.5+v.y/this.height),I=Math.sin(_)*this.cameraToCenterDistance/Math.sin(L.clamp(Math.PI-w-_,.01,Math.PI-.01)),j=this.point,f=j.x,l=j.y,d=1.01*(Math.cos(Math.PI/2-this._pitch)*I+this.cameraToCenterDistance),x=this.height/50,M=new Float64Array(16);L.perspective(M,this._fov,this.width/this.height,x,d),M[8]=2*-v.x/this.width,M[9]=2*v.y/this.height,L.scale(M,M,[1,-1,1]),L.translate(M,M,[0,0,-this.cameraToCenterDistance]),L.rotateX(M,M,this._pitch),L.rotateZ(M,M,this.angle),L.translate(M,M,[-f,-l,0]),this.mercatorMatrix=L.scale([],M,[this.worldSize,this.worldSize,this.worldSize]),L.scale(M,M,[1,1,L.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=M,this.invProjMatrix=L.invert([],this.projMatrix);var D=this.width%2/2,B=this.height%2/2,G=Math.cos(this.angle),W=Math.sin(this.angle),Y=f-Math.round(f)+G*D+W*B,ee=l-Math.round(l)+G*B+W*D,Q=new Float64Array(M);if(L.translate(Q,Q,[Y>.5?Y-1:Y,ee>.5?ee-1:ee,0]),this.alignedProjMatrix=Q,M=L.create(),L.scale(M,M,[this.width/2,-this.height/2,1]),L.translate(M,M,[1,-1,0]),this.labelPlaneMatrix=M,M=L.create(),L.scale(M,M,[1,-1,1]),L.translate(M,M,[-1,-1,0]),L.scale(M,M,[2/this.width,2/this.height,1]),this.glCoordMatrix=M,this.pixelMatrix=L.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(M=L.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=M,this._posMatrixCache={},this._alignedPosMatrixCache={}}},qi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var v=this.pointCoordinate(new L.Point(0,0)),w=[v.x*this.worldSize,v.y*this.worldSize,0,1];return L.transformMat4(w,w,this.pixelMatrix)[3]/this.cameraToCenterDistance},qi.prototype.getCameraPoint=function(){var v=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new L.Point(0,v))},qi.prototype.getCameraQueryGeometry=function(v){var w=this.getCameraPoint();if(1===v.length)return[v[0],w];for(var _=w.x,I=w.y,j=w.x,f=w.y,l=0,d=v;l<d.length;l+=1){var x=d[l];_=Math.min(_,x.x),I=Math.min(I,x.y),j=Math.max(j,x.x),f=Math.max(f,x.y)}return[new L.Point(_,I),new L.Point(j,I),new L.Point(j,f),new L.Point(_,f),new L.Point(_,I)]},Object.defineProperties(qi.prototype,yi);var ou=function(v){var w,_,I,j;this._hashName=v&&encodeURIComponent(v),L.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(w=this._updateHashUnthrottled.bind(this),_=!1,I=null,j=function(){I=null,_&&(w(),I=setTimeout(j,300),_=!1)},function(){return _=!0,I||j(),I})};ou.prototype.addTo=function(v){return this._map=v,L.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},ou.prototype.remove=function(){return L.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},ou.prototype.getHashString=function(v){var w=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,I=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),j=Math.pow(10,I),f=Math.round(w.lng*j)/j,l=Math.round(w.lat*j)/j,d=this._map.getBearing(),x=this._map.getPitch(),M="";if(M+=v?"/"+f+"/"+l+"/"+_:_+"/"+l+"/"+f,(d||x)&&(M+="/"+Math.round(10*d)/10),x&&(M+="/"+Math.round(x)),this._hashName){var D=this._hashName,B=!1,G=L.window.location.hash.slice(1).split("&").map(function(W){var Y=W.split("=")[0];return Y===D?(B=!0,Y+"="+M):W}).filter(function(W){return W});return B||G.push(D+"="+M),"#"+G.join("&")}return"#"+M},ou.prototype._getCurrentHash=function(){var v,w=this,_=L.window.location.hash.replace("#","");return this._hashName?(_.split("&").map(function(I){return I.split("=")}).forEach(function(I){I[0]===w._hashName&&(v=I)}),(v&&v[1]||"").split("/")):_.split("/")},ou.prototype._onHashChange=function(){var v=this._getCurrentHash();if(v.length>=3&&!v.some(function(_){return isNaN(_)})){var w=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(v[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+v[2],+v[1]],zoom:+v[0],bearing:w,pitch:+(v[4]||0)}),!0}return!1},ou.prototype._updateHashUnthrottled=function(){var v=L.window.location.href.replace(/(#.+)?$/,this.getHashString());try{L.window.history.replaceState(L.window.history.state,null,v)}catch(w){}};var Sl={linearity:.3,easing:L.bezier(0,0,.3,1)},rd=L.extend({deceleration:2500,maxSpeed:1400},Sl),_u=L.extend({deceleration:20,maxSpeed:1400},Sl),vi=L.extend({deceleration:1e3,maxSpeed:360},Sl),Lp=L.extend({deceleration:1e3,maxSpeed:90},Sl),hp=function(v){this._map=v,this.clear()};function Xh(v,w){(!v.duration||v.duration<w.duration)&&(v.duration=w.duration,v.easing=w.easing)}function lc(v,w,_){var I=_.maxSpeed,j=_.linearity,f=_.deceleration,l=L.clamp(v*j/(w/1e3),-I,I),d=Math.abs(l)/(f*j);return{easing:_.easing,duration:1e3*d,amount:l*(d/2)}}hp.prototype.clear=function(){this._inertiaBuffer=[]},hp.prototype.record=function(v){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:L.browser.now(),settings:v})},hp.prototype._drainInertiaBuffer=function(){for(var v=this._inertiaBuffer,w=L.browser.now();v.length>0&&w-v[0].time>160;)v.shift()},hp.prototype._onMoveEnd=function(v){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var w={zoom:0,bearing:0,pitch:0,pan:new L.Point(0,0),pinchAround:void 0,around:void 0},_=0,I=this._inertiaBuffer;_<I.length;_+=1){var j=I[_].settings;w.zoom+=j.zoomDelta||0,w.bearing+=j.bearingDelta||0,w.pitch+=j.pitchDelta||0,j.panDelta&&w.pan._add(j.panDelta),j.around&&(w.around=j.around),j.pinchAround&&(w.pinchAround=j.pinchAround)}var f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,l={};if(w.pan.mag()){var d=lc(w.pan.mag(),f,L.extend({},rd,v||{}));l.offset=w.pan.mult(d.amount/w.pan.mag()),l.center=this._map.transform.center,Xh(l,d)}if(w.zoom){var x=lc(w.zoom,f,_u);l.zoom=this._map.transform.zoom+x.amount,Xh(l,x)}if(w.bearing){var M=lc(w.bearing,f,vi);l.bearing=this._map.transform.bearing+L.clamp(M.amount,-179,179),Xh(l,M)}if(w.pitch){var D=lc(w.pitch,f,Lp);l.pitch=this._map.transform.pitch+D.amount,Xh(l,D)}if(l.zoom||l.bearing){var B=void 0===w.pinchAround?w.around:w.pinchAround;l.around=B?this._map.unproject(B):this._map.getCenter()}return this.clear(),L.extend(l,{noMoveStart:!0})}};var hs=function(v){function w(I,j,f,l){void 0===l&&(l={});var d=ut.mousePos(j.getCanvasContainer(),f),x=j.unproject(d);v.call(this,I,L.extend({point:d,lngLat:x,originalEvent:f},l)),this._defaultPrevented=!1,this.target=j}v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w;var _={defaultPrevented:{configurable:!0}};return w.prototype.preventDefault=function(){this._defaultPrevented=!0},_.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(w.prototype,_),w}(L.Event),xu=function(v){function w(I,j,f){var l="touchend"===I?f.changedTouches:f.touches,d=ut.touchPos(j.getCanvasContainer(),l),x=d.map(function(B){return j.unproject(B)}),M=d.reduce(function(B,G,W,Y){return B.add(G.div(Y.length))},new L.Point(0,0)),D=j.unproject(M);v.call(this,I,{points:d,point:M,lngLats:x,lngLat:D,originalEvent:f}),this._defaultPrevented=!1}v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w;var _={defaultPrevented:{configurable:!0}};return w.prototype.preventDefault=function(){this._defaultPrevented=!0},_.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(w.prototype,_),w}(L.Event),Fp=function(v){function w(I,j,f){v.call(this,I,{originalEvent:f}),this._defaultPrevented=!1}v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w;var _={defaultPrevented:{configurable:!0}};return w.prototype.preventDefault=function(){this._defaultPrevented=!0},_.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(w.prototype,_),w}(L.Event),Ra=function(v,w){this._map=v,this._clickTolerance=w.clickTolerance};Ra.prototype.reset=function(){delete this._mousedownPos},Ra.prototype.wheel=function(v){return this._firePreventable(new Fp(v.type,this._map,v))},Ra.prototype.mousedown=function(v,w){return this._mousedownPos=w,this._firePreventable(new hs(v.type,this._map,v))},Ra.prototype.mouseup=function(v){this._map.fire(new hs(v.type,this._map,v))},Ra.prototype.click=function(v,w){this._mousedownPos&&this._mousedownPos.dist(w)>=this._clickTolerance||this._map.fire(new hs(v.type,this._map,v))},Ra.prototype.dblclick=function(v){return this._firePreventable(new hs(v.type,this._map,v))},Ra.prototype.mouseover=function(v){this._map.fire(new hs(v.type,this._map,v))},Ra.prototype.mouseout=function(v){this._map.fire(new hs(v.type,this._map,v))},Ra.prototype.touchstart=function(v){return this._firePreventable(new xu(v.type,this._map,v))},Ra.prototype.touchmove=function(v){this._map.fire(new xu(v.type,this._map,v))},Ra.prototype.touchend=function(v){this._map.fire(new xu(v.type,this._map,v))},Ra.prototype.touchcancel=function(v){this._map.fire(new xu(v.type,this._map,v))},Ra.prototype._firePreventable=function(v){if(this._map.fire(v),v.defaultPrevented)return{}},Ra.prototype.isEnabled=function(){return!0},Ra.prototype.isActive=function(){return!1},Ra.prototype.enable=function(){},Ra.prototype.disable=function(){};var Ul=function(v){this._map=v};Ul.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Ul.prototype.mousemove=function(v){this._map.fire(new hs(v.type,this._map,v))},Ul.prototype.mousedown=function(){this._delayContextMenu=!0},Ul.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new hs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Ul.prototype.contextmenu=function(v){this._delayContextMenu?this._contextMenuEvent=v:this._map.fire(new hs(v.type,this._map,v)),this._map.listens("contextmenu")&&v.preventDefault()},Ul.prototype.isEnabled=function(){return!0},Ul.prototype.isActive=function(){return!1},Ul.prototype.enable=function(){},Ul.prototype.disable=function(){};var $n=function(v,w){this._map=v,this._el=v.getCanvasContainer(),this._container=v.getContainer(),this._clickTolerance=w.clickTolerance||1};function Hu(v,w){for(var _={},I=0;I<v.length;I++)_[v[I].identifier]=w[I];return _}$n.prototype.isEnabled=function(){return!!this._enabled},$n.prototype.isActive=function(){return!!this._active},$n.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},$n.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},$n.prototype.mousedown=function(v,w){this.isEnabled()&&v.shiftKey&&0===v.button&&(ut.disableDrag(),this._startPos=this._lastPos=w,this._active=!0)},$n.prototype.mousemoveWindow=function(v,w){if(this._active){var _=w;if(!(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)){var I=this._startPos;this._lastPos=_,this._box||(this._box=ut.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",v));var j=Math.min(I.x,_.x),f=Math.max(I.x,_.x),l=Math.min(I.y,_.y),d=Math.max(I.y,_.y);ut.setTransform(this._box,"translate("+j+"px,"+l+"px)"),this._box.style.width=f-j+"px",this._box.style.height=d-l+"px"}}},$n.prototype.mouseupWindow=function(v,w){var _=this;if(this._active&&0===v.button){var I=this._startPos,j=w;if(this.reset(),ut.suppressClick(),I.x!==j.x||I.y!==j.y)return this._map.fire(new L.Event("boxzoomend",{originalEvent:v})),{cameraAnimation:function(f){return f.fitScreenCoordinates(I,j,_._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",v)}},$n.prototype.keydown=function(v){this._active&&27===v.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",v))},$n.prototype.reset=function(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(ut.remove(this._box),this._box=null),ut.enableDrag(),delete this._startPos,delete this._lastPos},$n.prototype._fireEvent=function(v,w){return this._map.fire(new L.Event(v,{originalEvent:w}))};var Ds=function(v){this.reset(),this.numTouches=v.numTouches};Ds.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Ds.prototype.touchstart=function(v,w,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=v.timeStamp),_.length===this.numTouches&&(this.centroid=function(I){for(var j=new L.Point(0,0),f=0,l=I;f<l.length;f+=1)j._add(l[f]);return j.div(I.length)}(w),this.touches=Hu(_,w)))},Ds.prototype.touchmove=function(v,w,_){if(!this.aborted&&this.centroid){var I=Hu(_,w);for(var j in this.touches){var f=I[j];(!f||f.dist(this.touches[j])>30)&&(this.aborted=!0)}}},Ds.prototype.touchend=function(v,w,_){if((!this.centroid||v.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){var I=!this.aborted&&this.centroid;if(this.reset(),I)return I}};var Ua=function(v){this.singleTap=new Ds(v),this.numTaps=v.numTaps,this.reset()};Ua.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Ua.prototype.touchstart=function(v,w,_){this.singleTap.touchstart(v,w,_)},Ua.prototype.touchmove=function(v,w,_){this.singleTap.touchmove(v,w,_)},Ua.prototype.touchend=function(v,w,_){var I=this.singleTap.touchend(v,w,_);if(I){var j=v.timeStamp-this.lastTime<500,f=!this.lastTap||this.lastTap.dist(I)<30;if(j&&f||this.reset(),this.count++,this.lastTime=v.timeStamp,this.lastTap=I,this.count===this.numTaps)return this.reset(),I}};var Lo=function(){this._zoomIn=new Ua({numTouches:1,numTaps:2}),this._zoomOut=new Ua({numTouches:2,numTaps:1}),this.reset()};Lo.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Lo.prototype.touchstart=function(v,w,_){this._zoomIn.touchstart(v,w,_),this._zoomOut.touchstart(v,w,_)},Lo.prototype.touchmove=function(v,w,_){this._zoomIn.touchmove(v,w,_),this._zoomOut.touchmove(v,w,_)},Lo.prototype.touchend=function(v,w,_){var I=this,j=this._zoomIn.touchend(v,w,_),f=this._zoomOut.touchend(v,w,_);return j?(this._active=!0,v.preventDefault(),setTimeout(function(){return I.reset()},0),{cameraAnimation:function(l){return l.easeTo({duration:300,zoom:l.getZoom()+1,around:l.unproject(j)},{originalEvent:v})}}):f?(this._active=!0,v.preventDefault(),setTimeout(function(){return I.reset()},0),{cameraAnimation:function(l){return l.easeTo({duration:300,zoom:l.getZoom()-1,around:l.unproject(f)},{originalEvent:v})}}):void 0},Lo.prototype.touchcancel=function(){this.reset()},Lo.prototype.enable=function(){this._enabled=!0},Lo.prototype.disable=function(){this._enabled=!1,this.reset()},Lo.prototype.isEnabled=function(){return this._enabled},Lo.prototype.isActive=function(){return this._active};var bu={0:1,2:2},qs=function(v){this.reset(),this._clickTolerance=v.clickTolerance||1};qs.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},qs.prototype._correctButton=function(v,w){return!1},qs.prototype._move=function(v,w){return{}},qs.prototype.mousedown=function(v,w){if(!this._lastPoint){var _=ut.mouseButton(v);this._correctButton(v,_)&&(this._lastPoint=w,this._eventButton=_)}},qs.prototype.mousemoveWindow=function(v,w){var I,f,_=this._lastPoint;if(_)if(v.preventDefault(),f=bu[this._eventButton],void 0===(I=v).buttons||(I.buttons&f)!==f)this.reset();else if(this._moved||!(w.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=w,this._move(_,w)},qs.prototype.mouseupWindow=function(v){this._lastPoint&&ut.mouseButton(v)===this._eventButton&&(this._moved&&ut.suppressClick(),this.reset())},qs.prototype.enable=function(){this._enabled=!0},qs.prototype.disable=function(){this._enabled=!1,this.reset()},qs.prototype.isEnabled=function(){return this._enabled},qs.prototype.isActive=function(){return this._active};var er=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.mousedown=function(_,I){v.prototype.mousedown.call(this,_,I),this._lastPoint&&(this._active=!0)},w.prototype._correctButton=function(_,I){return 0===I&&!_.ctrlKey},w.prototype._move=function(_,I){return{around:I,panDelta:I.sub(_)}},w}(qs),rh=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype._correctButton=function(_,I){return 0===I&&_.ctrlKey||2===I},w.prototype._move=function(_,I){var j=.8*(I.x-_.x);if(j)return this._active=!0,{bearingDelta:j}},w.prototype.contextmenu=function(_){_.preventDefault()},w}(qs),Mh=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype._correctButton=function(_,I){return 0===I&&_.ctrlKey||2===I},w.prototype._move=function(_,I){var j=-.5*(I.y-_.y);if(j)return this._active=!0,{pitchDelta:j}},w.prototype.contextmenu=function(_){_.preventDefault()},w}(qs),wu=function(v){this._minTouches=1,this._clickTolerance=v.clickTolerance||1,this.reset()};wu.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new L.Point(0,0)},wu.prototype.touchstart=function(v,w,_){return this._calculateTransform(v,w,_)},wu.prototype.touchmove=function(v,w,_){if(this._active&&!(_.length<this._minTouches))return v.preventDefault(),this._calculateTransform(v,w,_)},wu.prototype.touchend=function(v,w,_){this._calculateTransform(v,w,_),this._active&&_.length<this._minTouches&&this.reset()},wu.prototype.touchcancel=function(){this.reset()},wu.prototype._calculateTransform=function(v,w,_){_.length>0&&(this._active=!0);var I=Hu(_,w),j=new L.Point(0,0),f=new L.Point(0,0),l=0;for(var d in I){var x=I[d],M=this._touches[d];M&&(j._add(x),f._add(x.sub(M)),l++,I[d]=x)}if(this._touches=I,!(l<this._minTouches)&&f.mag()){var D=f.div(l);if(this._sum._add(D),!(this._sum.mag()<this._clickTolerance))return{around:j.div(l),panDelta:D}}},wu.prototype.enable=function(){this._enabled=!0},wu.prototype.disable=function(){this._enabled=!1,this.reset()},wu.prototype.isEnabled=function(){return this._enabled},wu.prototype.isActive=function(){return this._active};var Oa=function(){this.reset()};function ks(v,w,_){for(var I=0;I<v.length;I++)if(v[I].identifier===_)return w[I]}function Cu(v,w){return Math.log(v/w)/Math.LN2}Oa.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Oa.prototype._start=function(v){},Oa.prototype._move=function(v,w,_){return{}},Oa.prototype.touchstart=function(v,w,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([w[0],w[1]]))},Oa.prototype.touchmove=function(v,w,_){if(this._firstTwoTouches){v.preventDefault();var I=this._firstTwoTouches,j=I[1],f=ks(_,w,I[0]),l=ks(_,w,j);if(f&&l){var d=this._aroundCenter?null:f.add(l).div(2);return this._move([f,l],d,v)}}},Oa.prototype.touchend=function(v,w,_){if(this._firstTwoTouches){var I=this._firstTwoTouches,j=I[1],f=ks(_,w,I[0]),l=ks(_,w,j);f&&l||(this._active&&ut.suppressClick(),this.reset())}},Oa.prototype.touchcancel=function(){this.reset()},Oa.prototype.enable=function(v){this._enabled=!0,this._aroundCenter=!!v&&"center"===v.around},Oa.prototype.disable=function(){this._enabled=!1,this.reset()},Oa.prototype.isEnabled=function(){return this._enabled},Oa.prototype.isActive=function(){return this._active};var Tl=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.reset=function(){v.prototype.reset.call(this),delete this._distance,delete this._startDistance},w.prototype._start=function(_){this._startDistance=this._distance=_[0].dist(_[1])},w.prototype._move=function(_,I){var j=this._distance;if(this._distance=_[0].dist(_[1]),this._active||!(Math.abs(Cu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Cu(this._distance,j),pinchAround:I}},w}(Oa);function ll(v,w){return 180*v.angleWith(w)/Math.PI}var Js=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.reset=function(){v.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},w.prototype._start=function(_){this._startVector=this._vector=_[0].sub(_[1]),this._minDiameter=_[0].dist(_[1])},w.prototype._move=function(_,I){var j=this._vector;if(this._vector=_[0].sub(_[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ll(this._vector,j),pinchAround:I}},w.prototype._isBelowThreshold=function(_){this._minDiameter=Math.min(this._minDiameter,_.mag());var I=25/(Math.PI*this._minDiameter)*360,j=ll(_,this._startVector);return Math.abs(j)<I},w}(Oa);function uc(v){return Math.abs(v.y)>Math.abs(v.x)}var Yh=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.reset=function(){v.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},w.prototype._start=function(_){this._lastPoints=_,uc(_[0].sub(_[1]))&&(this._valid=!1)},w.prototype._move=function(_,I,j){var f=_[0].sub(this._lastPoints[0]),l=_[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(f,l,j.timeStamp),this._valid)return this._lastPoints=_,this._active=!0,{pitchDelta:(f.y+l.y)/2*-.5}},w.prototype.gestureBeginsVertically=function(_,I,j){if(void 0!==this._valid)return this._valid;var f=_.mag()>=2,l=I.mag()>=2;if(f||l){if(!f||!l)return void 0===this._firstMove&&(this._firstMove=j),j-this._firstMove<100&&void 0;var d=_.y>0==I.y>0;return uc(_)&&uc(I)&&d}},w}(Oa),id={panStep:100,bearingStep:15,pitchStep:10},to=function(){var v=id;this._panStep=v.panStep,this._bearingStep=v.bearingStep,this._pitchStep=v.pitchStep,this._rotationDisabled=!1};function ih(v){return v*(2-v)}to.prototype.reset=function(){this._active=!1},to.prototype.keydown=function(v){var w=this;if(!(v.altKey||v.ctrlKey||v.metaKey)){var _=0,I=0,j=0,f=0,l=0;switch(v.keyCode){case 61:case 107:case 171:case 187:_=1;break;case 189:case 109:case 173:_=-1;break;case 37:v.shiftKey?I=-1:(v.preventDefault(),f=-1);break;case 39:v.shiftKey?I=1:(v.preventDefault(),f=1);break;case 38:v.shiftKey?j=1:(v.preventDefault(),l=-1);break;case 40:v.shiftKey?j=-1:(v.preventDefault(),l=1);break;default:return}return this._rotationDisabled&&(I=0,j=0),{cameraAnimation:function(d){var x=d.getZoom();d.easeTo({duration:300,easeId:"keyboardHandler",easing:ih,zoom:_?Math.round(x)+_*(v.shiftKey?2:1):x,bearing:d.getBearing()+I*w._bearingStep,pitch:d.getPitch()+j*w._pitchStep,offset:[-f*w._panStep,-l*w._panStep],center:d.getCenter()},{originalEvent:v})}}}},to.prototype.enable=function(){this._enabled=!0},to.prototype.disable=function(){this._enabled=!1,this.reset()},to.prototype.isEnabled=function(){return this._enabled},to.prototype.isActive=function(){return this._active},to.prototype.disableRotation=function(){this._rotationDisabled=!0},to.prototype.enableRotation=function(){this._rotationDisabled=!1};var Yo=function(v,w){this._map=v,this._el=v.getCanvasContainer(),this._handler=w,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,L.bindAll(["_onTimeout"],this)};Yo.prototype.setZoomRate=function(v){this._defaultZoomRate=v},Yo.prototype.setWheelZoomRate=function(v){this._wheelZoomRate=v},Yo.prototype.isEnabled=function(){return!!this._enabled},Yo.prototype.isActive=function(){return!!this._active||void 0!==this._finishTimeout},Yo.prototype.isZooming=function(){return!!this._zooming},Yo.prototype.enable=function(v){this.isEnabled()||(this._enabled=!0,this._aroundCenter=v&&"center"===v.around)},Yo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Yo.prototype.wheel=function(v){if(this.isEnabled()){var w=v.deltaMode===L.window.WheelEvent.DOM_DELTA_LINE?40*v.deltaY:v.deltaY,_=L.browser.now(),I=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==w&&w%4.000244140625==0?this._type="wheel":0!==w&&Math.abs(w)<4?this._type="trackpad":I>400?(this._type=null,this._lastValue=w,this._timeout=setTimeout(this._onTimeout,40,v)):this._type||(this._type=Math.abs(I*w)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,w+=this._lastValue)),v.shiftKey&&w&&(w/=4),this._type&&(this._lastWheelEvent=v,this._delta-=w,this._active||this._start(v)),v.preventDefault()}},Yo.prototype._onTimeout=function(v){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(v)},Yo.prototype._start=function(v){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var w=ut.mousePos(this._el,v);this._around=L.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(w)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Yo.prototype.renderFrame=function(){var v=this;if(this._frameId&&(this._frameId=null,this.isActive())){var w=this._map.transform;if(0!==this._delta){var _="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,I=2/(1+Math.exp(-Math.abs(this._delta*_)));this._delta<0&&0!==I&&(I=1/I);var j="number"==typeof this._targetZoom?w.zoomScale(this._targetZoom):w.scale;this._targetZoom=Math.min(w.maxZoom,Math.max(w.minZoom,w.scaleZoom(j*I))),"wheel"===this._type&&(this._startZoom=w.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var f,l="number"==typeof this._targetZoom?this._targetZoom:w.zoom,d=this._startZoom,x=this._easing,M=!1;if("wheel"===this._type&&d&&x){var D=Math.min((L.browser.now()-this._lastWheelEventTime)/200,1),B=x(D);f=L.number(d,l,B),D<1?this._frameId||(this._frameId=!0):M=!0}else f=l,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(function(){v._zooming=!1,v._handler._triggerRenderFrame(),delete v._targetZoom,delete v._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:f-w.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Yo.prototype._smoothOutEasing=function(v){var w=L.ease;if(this._prevEase){var _=this._prevEase,I=(L.browser.now()-_.start)/_.duration,j=_.easing(I+.01)-_.easing(I),f=.27/Math.sqrt(j*j+1e-4)*.01,l=Math.sqrt(.0729-f*f);w=L.bezier(f,l,.25,1)}return this._prevEase={start:L.browser.now(),duration:v,easing:w},w},Yo.prototype.reset=function(){this._active=!1};var Vr=function(v,w){this._clickZoom=v,this._tapZoom=w};Vr.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Vr.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Vr.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Vr.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var ki=function(){this.reset()};ki.prototype.reset=function(){this._active=!1},ki.prototype.dblclick=function(v,w){return v.preventDefault(),{cameraAnimation:function(_){_.easeTo({duration:300,zoom:_.getZoom()+(v.shiftKey?-1:1),around:_.unproject(w)},{originalEvent:v})}}},ki.prototype.enable=function(){this._enabled=!0},ki.prototype.disable=function(){this._enabled=!1,this.reset()},ki.prototype.isEnabled=function(){return this._enabled},ki.prototype.isActive=function(){return this._active};var La=function(){this._tap=new Ua({numTouches:1,numTaps:1}),this.reset()};La.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},La.prototype.touchstart=function(v,w,_){this._swipePoint||(this._tapTime&&v.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=w[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(v,w,_))},La.prototype.touchmove=function(v,w,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;var I=w[0],j=I.y-this._swipePoint.y;return this._swipePoint=I,v.preventDefault(),this._active=!0,{zoomDelta:j/128}}}else this._tap.touchmove(v,w,_)},La.prototype.touchend=function(v,w,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(v,w,_)&&(this._tapTime=v.timeStamp)},La.prototype.touchcancel=function(){this.reset()},La.prototype.enable=function(){this._enabled=!0},La.prototype.disable=function(){this._enabled=!1,this.reset()},La.prototype.isEnabled=function(){return this._enabled},La.prototype.isActive=function(){return this._active};var ps=function(v,w,_){this._el=v,this._mousePan=w,this._touchPan=_};ps.prototype.enable=function(v){this._inertiaOptions=v||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")},ps.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")},ps.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},ps.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Ja=function(v,w,_){this._pitchWithRotate=v.pitchWithRotate,this._mouseRotate=w,this._mousePitch=_};Ja.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Ja.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Ja.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Ja.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Zn=function(v,w,_,I){this._el=v,this._touchZoom=w,this._touchRotate=_,this._tapDragZoom=I,this._rotationDisabled=!1,this._enabled=!0};Zn.prototype.enable=function(v){this._touchZoom.enable(v),this._rotationDisabled||this._touchRotate.enable(v),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")},Zn.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")},Zn.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Zn.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Zn.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Zn.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Wu=function(v){return v.zoom||v.drag||v.pitch||v.rotate},ds=function(v){function w(){v.apply(this,arguments)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w}(L.Event);function ta(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}var Un=function(v,w){this._map=v,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hp(v),this._bearingSnap=w.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(w),L.bindAll(["handleEvent","handleWindowEvent"],this);var _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[L.window.document,"mousemove",{capture:!0}],[L.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[L.window,"blur",void 0]];for(var I=0,j=this._listeners;I<j.length;I+=1){var f=j[I],l=f[0];ut.addEventListener(l,f[1],l===L.window.document?this.handleWindowEvent:this.handleEvent,f[2])}};Un.prototype.destroy=function(){for(var v=0,w=this._listeners;v<w.length;v+=1){var _=w[v],I=_[0];ut.removeEventListener(I,_[1],I===L.window.document?this.handleWindowEvent:this.handleEvent,_[2])}},Un.prototype._addDefaultHandlers=function(v){var w=this._map,_=w.getCanvasContainer();this._add("mapEvent",new Ra(w,v));var I=w.boxZoom=new $n(w,v);this._add("boxZoom",I);var j=new Lo,f=new ki;w.doubleClickZoom=new Vr(f,j),this._add("tapZoom",j),this._add("clickZoom",f);var l=new La;this._add("tapDragZoom",l);var d=w.touchPitch=new Yh;this._add("touchPitch",d);var x=new rh(v),M=new Mh(v);w.dragRotate=new Ja(v,x,M),this._add("mouseRotate",x,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]);var D=new er(v),B=new wu(v);w.dragPan=new ps(_,D,B),this._add("mousePan",D),this._add("touchPan",B,["touchZoom","touchRotate"]);var G=new Js,W=new Tl;w.touchZoomRotate=new Zn(_,W,G,l),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]);var Y=w.scrollZoom=new Yo(w,this);this._add("scrollZoom",Y,["mousePan"]);var ee=w.keyboard=new to;this._add("keyboard",ee),this._add("blockableMapEvent",new Ul(w));for(var Q=0,le=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Q<le.length;Q+=1){var de=le[Q];v.interactive&&v[de]&&w[de].enable(v[de])}},Un.prototype._add=function(v,w,_){this._handlers.push({handlerName:v,handler:w,allowed:_}),this._handlersById[v]=w},Un.prototype.stop=function(v){if(!this._updatingCamera){for(var w=0,_=this._handlers;w<_.length;w+=1)_[w].handler.reset();this._inertia.clear(),this._fireEvents({},{},v),this._changes=[]}},Un.prototype.isActive=function(){for(var v=0,w=this._handlers;v<w.length;v+=1)if(w[v].handler.isActive())return!0;return!1},Un.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Un.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Un.prototype.isMoving=function(){return Boolean(Wu(this._eventsInProgress))||this.isZooming()},Un.prototype._blockedByActive=function(v,w,_){for(var I in v)if(I!==_&&(!w||w.indexOf(I)<0))return!0;return!1},Un.prototype.handleWindowEvent=function(v){this.handleEvent(v,v.type+"Window")},Un.prototype._getMapTouches=function(v){for(var w=[],_=0,I=v;_<I.length;_+=1){var j=I[_];this._el.contains(j.target)&&w.push(j)}return w},Un.prototype.handleEvent=function(v,w){if("blur"!==v.type){this._updatingCamera=!0;for(var _="renderFrame"===v.type?void 0:v,I={needsRenderFrame:!1},j={},f={},l=v.touches?this._getMapTouches(v.touches):void 0,d=l?ut.touchPos(this._el,l):ut.mousePos(this._el,v),x=0,M=this._handlers;x<M.length;x+=1){var D=M[x],B=D.handlerName,G=D.handler,W=D.allowed;if(G.isEnabled()){var Y=void 0;this._blockedByActive(f,W,B)?G.reset():G[w||v.type]&&(Y=G[w||v.type](v,d,l),this.mergeHandlerResult(I,j,Y,B,_),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||G.isActive())&&(f[B]=G)}}var ee={};for(var Q in this._previousActiveHandlers)f[Q]||(ee[Q]=_);this._previousActiveHandlers=f,(Object.keys(ee).length||ta(I))&&(this._changes.push([I,j,ee]),this._triggerRenderFrame()),(Object.keys(f).length||ta(I))&&this._map._stop(!0),this._updatingCamera=!1;var le=I.cameraAnimation;le&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],le(this._map))}else this.stop(!0)},Un.prototype.mergeHandlerResult=function(v,w,_,I,j){if(_){L.extend(v,_);var f={handlerName:I,originalEvent:_.originalEvent||j};void 0!==_.zoomDelta&&(w.zoom=f),void 0!==_.panDelta&&(w.drag=f),void 0!==_.pitchDelta&&(w.pitch=f),void 0!==_.bearingDelta&&(w.rotate=f)}},Un.prototype._applyChanges=function(){for(var v={},w={},_={},I=0,j=this._changes;I<j.length;I+=1){var f=j[I],l=f[0],d=f[1],x=f[2];l.panDelta&&(v.panDelta=(v.panDelta||new L.Point(0,0))._add(l.panDelta)),l.zoomDelta&&(v.zoomDelta=(v.zoomDelta||0)+l.zoomDelta),l.bearingDelta&&(v.bearingDelta=(v.bearingDelta||0)+l.bearingDelta),l.pitchDelta&&(v.pitchDelta=(v.pitchDelta||0)+l.pitchDelta),void 0!==l.around&&(v.around=l.around),void 0!==l.pinchAround&&(v.pinchAround=l.pinchAround),l.noInertia&&(v.noInertia=l.noInertia),L.extend(w,d),L.extend(_,x)}this._updateMapTransform(v,w,_),this._changes=[]},Un.prototype._updateMapTransform=function(v,w,_){var I=this._map,j=I.transform;if(!ta(v))return this._fireEvents(w,_,!0);var f=v.panDelta,l=v.zoomDelta,d=v.bearingDelta,x=v.pitchDelta,M=v.around,D=v.pinchAround;void 0!==D&&(M=D),I._stop(!0),M=M||I.transform.centerPoint;var B=j.pointLocation(f?M.sub(f):M);d&&(j.bearing+=d),x&&(j.pitch+=x),l&&(j.zoom+=l),j.setLocationAtPoint(B,M),this._map._update(),v.noInertia||this._inertia.record(v),this._fireEvents(w,_,!0)},Un.prototype._fireEvents=function(v,w,_){var I=this,j=Wu(this._eventsInProgress),f=Wu(v),l={};for(var d in v)this._eventsInProgress[d]||(l[d+"start"]=v[d].originalEvent),this._eventsInProgress[d]=v[d];for(var x in!j&&f&&this._fireEvent("movestart",f.originalEvent),l)this._fireEvent(x,l[x]);for(var M in f&&this._fireEvent("move",f.originalEvent),v)this._fireEvent(M,v[M].originalEvent);var D,B={};for(var G in this._eventsInProgress){var W=this._eventsInProgress[G],Y=W.handlerName,ee=W.originalEvent;this._handlersById[Y].isActive()||(delete this._eventsInProgress[G],B[G+"end"]=D=w[Y]||ee)}for(var Q in B)this._fireEvent(Q,B[Q]);var le=Wu(this._eventsInProgress);if(_&&(j||f)&&!le){this._updatingCamera=!0;var de=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ge=function(xe){return 0!==xe&&-I._bearingSnap<xe&&xe<I._bearingSnap};de?(ge(de.bearing||this._map.getBearing())&&(de.bearing=0),this._map.easeTo(de,{originalEvent:D})):(this._map.fire(new L.Event("moveend",{originalEvent:D})),ge(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Un.prototype._fireEvent=function(v,w){this._map.fire(new L.Event(v,w?{originalEvent:w}:{}))},Un.prototype._requestFrame=function(){var v=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(w){delete v._frameId,v.handleEvent(new ds("renderFrame",{timeStamp:w})),v._applyChanges()})},Un.prototype._triggerRenderFrame=function(){void 0===this._frameId&&(this._frameId=this._requestFrame())};var Nr=function(v){function w(_,I){v.call(this),this._moving=!1,this._zooming=!1,this.transform=_,this._bearingSnap=I.bearingSnap,L.bindAll(["_renderFrameCallback"],this)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.getCenter=function(){return new L.LngLat(this.transform.center.lng,this.transform.center.lat)},w.prototype.setCenter=function(_,I){return this.jumpTo({center:_},I)},w.prototype.panBy=function(_,I,j){return _=L.Point.convert(_).mult(-1),this.panTo(this.transform.center,L.extend({offset:_},I),j)},w.prototype.panTo=function(_,I,j){return this.easeTo(L.extend({center:_},I),j)},w.prototype.getZoom=function(){return this.transform.zoom},w.prototype.setZoom=function(_,I){return this.jumpTo({zoom:_},I),this},w.prototype.zoomTo=function(_,I,j){return this.easeTo(L.extend({zoom:_},I),j)},w.prototype.zoomIn=function(_,I){return this.zoomTo(this.getZoom()+1,_,I),this},w.prototype.zoomOut=function(_,I){return this.zoomTo(this.getZoom()-1,_,I),this},w.prototype.getBearing=function(){return this.transform.bearing},w.prototype.setBearing=function(_,I){return this.jumpTo({bearing:_},I),this},w.prototype.getPadding=function(){return this.transform.padding},w.prototype.setPadding=function(_,I){return this.jumpTo({padding:_},I),this},w.prototype.rotateTo=function(_,I,j){return this.easeTo(L.extend({bearing:_},I),j)},w.prototype.resetNorth=function(_,I){return this.rotateTo(0,L.extend({duration:1e3},_),I),this},w.prototype.resetNorthPitch=function(_,I){return this.easeTo(L.extend({bearing:0,pitch:0,duration:1e3},_),I),this},w.prototype.snapToNorth=function(_,I){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(_,I):this},w.prototype.getPitch=function(){return this.transform.pitch},w.prototype.setPitch=function(_,I){return this.jumpTo({pitch:_},I),this},w.prototype.cameraForBounds=function(_,I){_=L.LngLatBounds.convert(_);var j=I&&I.bearing||0;return this._cameraForBoxAndBearing(_.getNorthWest(),_.getSouthEast(),j,I)},w.prototype._cameraForBoxAndBearing=function(_,I,j,f){var l={top:0,bottom:0,right:0,left:0};if("number"==typeof(f=L.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding){var d=f.padding;f.padding={top:d,bottom:d,right:d,left:d}}f.padding=L.extend(l,f.padding);var x=this.transform,M=x.padding,D=x.project(L.LngLat.convert(_)),B=x.project(L.LngLat.convert(I)),G=D.rotate(-j*Math.PI/180),W=B.rotate(-j*Math.PI/180),Y=new L.Point(Math.max(G.x,W.x),Math.max(G.y,W.y)),ee=new L.Point(Math.min(G.x,W.x),Math.min(G.y,W.y)),Q=Y.sub(ee),le=(x.width-(M.left+M.right+f.padding.left+f.padding.right))/Q.x,de=(x.height-(M.top+M.bottom+f.padding.top+f.padding.bottom))/Q.y;if(!(de<0||le<0)){var ge=Math.min(x.scaleZoom(x.scale*Math.min(le,de)),f.maxZoom),xe="number"==typeof f.offset.x?new L.Point(f.offset.x,f.offset.y):L.Point.convert(f.offset),Te=new L.Point((f.padding.left-f.padding.right)/2,(f.padding.top-f.padding.bottom)/2).rotate(j*Math.PI/180),Ee=xe.add(Te).mult(x.scale/x.zoomScale(ge));return{center:x.unproject(D.add(B).div(2).sub(Ee)),zoom:ge,bearing:j}}L.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},w.prototype.fitBounds=function(_,I,j){return this._fitInternal(this.cameraForBounds(_,I),I,j)},w.prototype.fitScreenCoordinates=function(_,I,j,f,l){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(L.Point.convert(_)),this.transform.pointLocation(L.Point.convert(I)),j,f),f,l)},w.prototype._fitInternal=function(_,I,j){return _?(delete(I=L.extend(_,I)).padding,I.linear?this.easeTo(I,j):this.flyTo(I,j)):this},w.prototype.jumpTo=function(_,I){this.stop();var j=this.transform,f=!1,l=!1,d=!1;return"zoom"in _&&j.zoom!==+_.zoom&&(f=!0,j.zoom=+_.zoom),void 0!==_.center&&(j.center=L.LngLat.convert(_.center)),"bearing"in _&&j.bearing!==+_.bearing&&(l=!0,j.bearing=+_.bearing),"pitch"in _&&j.pitch!==+_.pitch&&(d=!0,j.pitch=+_.pitch),null==_.padding||j.isPaddingEqual(_.padding)||(j.padding=_.padding),this.fire(new L.Event("movestart",I)).fire(new L.Event("move",I)),f&&this.fire(new L.Event("zoomstart",I)).fire(new L.Event("zoom",I)).fire(new L.Event("zoomend",I)),l&&this.fire(new L.Event("rotatestart",I)).fire(new L.Event("rotate",I)).fire(new L.Event("rotateend",I)),d&&this.fire(new L.Event("pitchstart",I)).fire(new L.Event("pitch",I)).fire(new L.Event("pitchend",I)),this.fire(new L.Event("moveend",I))},w.prototype.easeTo=function(_,I){var j=this;this._stop(!1,_.easeId),(!1===(_=L.extend({offset:[0,0],duration:500,easing:L.ease},_)).animate||!_.essential&&L.browser.prefersReducedMotion)&&(_.duration=0);var f=this.transform,l=this.getZoom(),d=this.getBearing(),x=this.getPitch(),M=this.getPadding(),D="zoom"in _?+_.zoom:l,B="bearing"in _?this._normalizeBearing(_.bearing,d):d,G="pitch"in _?+_.pitch:x,W="padding"in _?_.padding:f.padding,Y=L.Point.convert(_.offset),ee=f.centerPoint.add(Y),Q=f.pointLocation(ee),le=L.LngLat.convert(_.center||Q);this._normalizeCenter(le);var de,ge,xe=f.project(Q),Te=f.project(le).sub(xe),Ee=f.zoomScale(D-l);_.around&&(de=L.LngLat.convert(_.around),ge=f.locationPoint(de));var Pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||D!==l,this._rotating=this._rotating||d!==B,this._pitching=this._pitching||G!==x,this._padding=!f.isPaddingEqual(W),this._easeId=_.easeId,this._prepareEase(I,_.noMoveStart,Pe),this._ease(function(Le){if(j._zooming&&(f.zoom=L.number(l,D,Le)),j._rotating&&(f.bearing=L.number(d,B,Le)),j._pitching&&(f.pitch=L.number(x,G,Le)),j._padding&&(f.interpolatePadding(M,W,Le),ee=f.centerPoint.add(Y)),de)f.setLocationAtPoint(de,ge);else{var Me=f.zoomScale(f.zoom-l),Ue=D>l?Math.min(2,Ee):Math.max(.5,Ee),Ye=Math.pow(Ue,1-Le),yt=f.unproject(xe.add(Te.mult(Le*Ye)).mult(Me));f.setLocationAtPoint(f.renderWorldCopies?yt.wrap():yt,ee)}j._fireMoveEvents(I)},function(Le){j._afterEase(I,Le)},_),this},w.prototype._prepareEase=function(_,I,j){void 0===j&&(j={}),this._moving=!0,I||j.moving||this.fire(new L.Event("movestart",_)),this._zooming&&!j.zooming&&this.fire(new L.Event("zoomstart",_)),this._rotating&&!j.rotating&&this.fire(new L.Event("rotatestart",_)),this._pitching&&!j.pitching&&this.fire(new L.Event("pitchstart",_))},w.prototype._fireMoveEvents=function(_){this.fire(new L.Event("move",_)),this._zooming&&this.fire(new L.Event("zoom",_)),this._rotating&&this.fire(new L.Event("rotate",_)),this._pitching&&this.fire(new L.Event("pitch",_))},w.prototype._afterEase=function(_,I){if(!this._easeId||!I||this._easeId!==I){delete this._easeId;var j=this._zooming,f=this._rotating,l=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,j&&this.fire(new L.Event("zoomend",_)),f&&this.fire(new L.Event("rotateend",_)),l&&this.fire(new L.Event("pitchend",_)),this.fire(new L.Event("moveend",_))}},w.prototype.flyTo=function(_,I){var j=this;if(!_.essential&&L.browser.prefersReducedMotion){var f=L.pick(_,["center","zoom","bearing","pitch","around"]);return this.jumpTo(f,I)}this.stop(),_=L.extend({offset:[0,0],speed:1.2,curve:1.42,easing:L.ease},_);var l=this.transform,d=this.getZoom(),x=this.getBearing(),M=this.getPitch(),D=this.getPadding(),B="zoom"in _?L.clamp(+_.zoom,l.minZoom,l.maxZoom):d,G="bearing"in _?this._normalizeBearing(_.bearing,x):x,W="pitch"in _?+_.pitch:M,Y="padding"in _?_.padding:l.padding,ee=l.zoomScale(B-d),Q=L.Point.convert(_.offset),le=l.centerPoint.add(Q),de=l.pointLocation(le),ge=L.LngLat.convert(_.center||de);this._normalizeCenter(ge);var xe=l.project(de),Te=l.project(ge).sub(xe),Ee=_.curve,Pe=Math.max(l.width,l.height),Le=Pe/ee,Me=Te.mag();if("minZoom"in _){var Ue=L.clamp(Math.min(_.minZoom,d,B),l.minZoom,l.maxZoom),Ye=Pe/l.zoomScale(Ue-d);Ee=Math.sqrt(Ye/Me*2)}var yt=Ee*Ee;function gt(Qt){var mn=(Le*Le-Pe*Pe+(Qt?-1:1)*yt*yt*Me*Me)/(2*(Qt?Le:Pe)*yt*Me);return Math.log(Math.sqrt(mn*mn+1)-mn)}function Ot(Qt){return(Math.exp(Qt)-Math.exp(-Qt))/2}function dt(Qt){return(Math.exp(Qt)+Math.exp(-Qt))/2}var Nt=gt(0),wt=function(Qt){return dt(Nt)/dt(Nt+Ee*Qt)},Zt=function(Qt){return Pe*((dt(Nt)*(Ot(mn=Nt+Ee*Qt)/dt(mn))-Ot(Nt))/yt)/Me;var mn},ft=(gt(1)-Nt)/Ee;if(Math.abs(Me)<1e-6||!isFinite(ft)){if(Math.abs(Pe-Le)<1e-6)return this.easeTo(_,I);var Gt=Le<Pe?-1:1;ft=Math.abs(Math.log(Le/Pe))/Ee,Zt=function(){return 0},wt=function(Qt){return Math.exp(Gt*Ee*Qt)}}return _.duration="duration"in _?+_.duration:1e3*ft/("screenSpeed"in _?+_.screenSpeed/Ee:+_.speed),_.maxDuration&&_.duration>_.maxDuration&&(_.duration=0),this._zooming=!0,this._rotating=x!==G,this._pitching=W!==M,this._padding=!l.isPaddingEqual(Y),this._prepareEase(I,!1),this._ease(function(Qt){var mn=Qt*ft,Hn=1/wt(mn);l.zoom=1===Qt?B:d+l.scaleZoom(Hn),j._rotating&&(l.bearing=L.number(x,G,Qt)),j._pitching&&(l.pitch=L.number(M,W,Qt)),j._padding&&(l.interpolatePadding(D,Y,Qt),le=l.centerPoint.add(Q));var gr=1===Qt?ge:l.unproject(xe.add(Te.mult(Zt(mn))).mult(Hn));l.setLocationAtPoint(l.renderWorldCopies?gr.wrap():gr,le),j._fireMoveEvents(I)},function(){return j._afterEase(I)},_),this},w.prototype.isEasing=function(){return!!this._easeFrameId},w.prototype.stop=function(){return this._stop()},w.prototype._stop=function(_,I){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var j=this._onEaseEnd;delete this._onEaseEnd,j.call(this,I)}if(!_){var f=this.handlers;f&&f.stop(!1)}return this},w.prototype._ease=function(_,I,j){!1===j.animate||0===j.duration?(_(1),I()):(this._easeStart=L.browser.now(),this._easeOptions=j,this._onEaseFrame=_,this._onEaseEnd=I,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},w.prototype._renderFrameCallback=function(){var _=Math.min((L.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(_)),_<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},w.prototype._normalizeBearing=function(_,I){_=L.wrap(_,-180,180);var j=Math.abs(_-I);return Math.abs(_-360-I)<j&&(_-=360),Math.abs(_+360-I)<j&&(_+=360),_},w.prototype._normalizeCenter=function(_){var I=this.transform;if(I.renderWorldCopies&&!I.lngRange){var j=_.lng-I.center.lng;_.lng+=j>180?-360:j<-180?360:0}},w}(L.Evented),Vl=function(v){void 0===v&&(v={}),this.options=v,L.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Vl.prototype.getDefaultPosition=function(){return"bottom-right"},Vl.prototype.onAdd=function(v){var w=this.options&&this.options.compact;return this._map=v,this._container=ut.create("div","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ut.create("button","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.type="button",this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ut.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),w&&this._container.classList.add("maplibregl-compact","mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===w&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Vl.prototype.onRemove=function(){ut.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Vl.prototype._setElementTitle=function(v,w){var _=this._map._getUIString("AttributionControl."+w);v.title=_,v.setAttribute("aria-label",_)},Vl.prototype._toggleAttribution=function(){this._container.classList.contains("maplibregl-compact-show")||this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Vl.prototype._updateEditLink=function(){var v=this._editLink;v||(v=this._editLink=this._container.querySelector(".mapbox-improve-map"));var w=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||L.config.ACCESS_TOKEN}];if(v){var _=w.reduce(function(I,j,f){return j.value&&(I+=j.key+"="+j.value+(f<w.length-1?"&":"")),I},"?");v.href=L.config.FEEDBACK_URL+"/"+_+(this._map._hash?this._map._hash.getHashString(!0):""),v.rel="noopener nofollow",this._setElementTitle(v,"MapFeedback")}},Vl.prototype._updateData=function(v){!v||"metadata"!==v.sourceDataType&&"visibility"!==v.sourceDataType&&"style"!==v.dataType||(this._updateAttributions(),this._updateEditLink())},Vl.prototype._updateAttributions=function(){if(this._map.style){var v=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?v=v.concat(this.options.customAttribution.map(function(d){return"string"!=typeof d?"":d})):"string"==typeof this.options.customAttribution&&v.push(this.options.customAttribution)),this._map.style.stylesheet){var w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}var _=this._map.style.sourceCaches;for(var I in _){var j=_[I];if(j.used){var f=j.getSource();f.attribution&&v.indexOf(f.attribution)<0&&v.push(f.attribution)}}v.sort(function(d,x){return d.length-x.length});var l=(v=v.filter(function(d,x){for(var M=x+1;M<v.length;M++)if(v[M].indexOf(d)>=0)return!1;return!0})).join(" | ");l!==this._attribHTML&&(this._attribHTML=l,v.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._editLink=null)}},Vl.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("maplibregl-compact","mapboxgl-compact"):this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show")};var Ps=function(){L.bindAll(["_updateLogo"],this),L.bindAll(["_updateCompact"],this)};Ps.prototype.onAdd=function(v){this._map=v,this._container=ut.create("div","maplibregl-ctrl mapboxgl-ctrl");var w=ut.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return w.target="_blank",w.rel="noopener nofollow",w.href="https://maplibre.org/",w.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),w.setAttribute("rel","noopener nofollow"),this._container.appendChild(w),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Ps.prototype.onRemove=function(){ut.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Ps.prototype.getDefaultPosition=function(){return"bottom-left"},Ps.prototype._updateLogo=function(v){v&&"metadata"!==v.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},Ps.prototype._logoRequired=function(){if(this._map.style){var v=this._map.style.sourceCaches;for(var w in v)if(v[w].getSource().mapbox_logo)return!0;return!1}},Ps.prototype._updateCompact=function(){var v=this._container.children;if(v.length){var w=v[0];this._map.getCanvasContainer().offsetWidth<250?w.classList.add("maplibregl-compact","mapboxgl-compact"):w.classList.remove("maplibregl-compact","mapboxgl-compact")}};var $u=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};$u.prototype.add=function(v){var w=++this._id;return this._queue.push({callback:v,id:w,cancelled:!1}),w},$u.prototype.remove=function(v){for(var w=this._currentlyRunning,_=0,I=w?this._queue.concat(w):this._queue;_<I.length;_+=1){var j=I[_];if(j.id===v)return void(j.cancelled=!0)}},$u.prototype.run=function(v){void 0===v&&(v=0);var w=this._currentlyRunning=this._queue;this._queue=[];for(var _=0,I=w;_<I.length;_+=1){var j=I[_];if(!j.cancelled&&(j.callback(v),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},$u.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Rs={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Lr=L.window.HTMLImageElement,Vf=L.window.HTMLElement,Eu=L.window.ImageBitmap,co={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Ea=function(v){function w(I){var j=this;if(null!=(I=L.extend({},co,I)).minZoom&&null!=I.maxZoom&&I.minZoom>I.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=I.minPitch&&null!=I.maxPitch&&I.minPitch>I.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=I.minPitch&&I.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=I.maxPitch&&I.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var f=new qi(I.minZoom,I.maxZoom,I.minPitch,I.maxPitch,I.renderWorldCopies);if(v.call(this,f,I),this._interactive=I.interactive,this._maxTileCacheSize=I.maxTileCacheSize,this._failIfMajorPerformanceCaveat=I.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=I.preserveDrawingBuffer,this._antialias=I.antialias,this._trackResize=I.trackResize,this._bearingSnap=I.bearingSnap,this._refreshExpiredTiles=I.refreshExpiredTiles,this._fadeDuration=I.fadeDuration,this._crossSourceCollisions=I.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=I.collectResourceTiming,this._renderTaskQueue=new $u,this._controls=[],this._mapId=L.uniqueId(),this._locale=L.extend({},Rs,I.locale),this._clickTolerance=I.clickTolerance,this._requestManager=new L.RequestManager(I.transformRequest,I.accessToken),"string"==typeof I.container){if(this._container=L.window.document.getElementById(I.container),!this._container)throw new Error("Container '"+I.container+"' not found.")}else{if(!(I.container instanceof Vf))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=I.container}if(I.maxBounds&&this.setMaxBounds(I.maxBounds),L.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return j._update(!1)}),this.on("moveend",function(){return j._update(!1)}),this.on("zoom",function(){return j._update(!0)}),void 0!==L.window&&(L.window.addEventListener("online",this._onWindowOnline,!1),L.window.addEventListener("resize",this._onWindowResize,!1),L.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Un(this,I),this._hash=I.hash&&new ou("string"==typeof I.hash&&I.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:I.center,zoom:I.zoom,bearing:I.bearing,pitch:I.pitch}),I.bounds&&(this.resize(),this.fitBounds(I.bounds,L.extend({},I.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=I.localIdeographFontFamily,I.style&&this.setStyle(I.style,{localIdeographFontFamily:I.localIdeographFontFamily}),I.attributionControl&&this.addControl(new Vl({customAttribution:I.customAttribution})),this.addControl(new Ps,I.logoPosition),this.on("style.load",function(){j.transform.unmodified&&j.jumpTo(j.style.stylesheet)}),this.on("data",function(l){j._update("style"===l.dataType),j.fire(new L.Event(l.dataType+"data",l))}),this.on("dataloading",function(l){j.fire(new L.Event(l.dataType+"dataloading",l))})}v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w;var _={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return w.prototype._getMapId=function(){return this._mapId},w.prototype.addControl=function(I,j){if(void 0===j&&(j=I.getDefaultPosition?I.getDefaultPosition():"top-right"),!I||!I.onAdd)return this.fire(new L.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var f=I.onAdd(this);this._controls.push(I);var l=this._controlPositions[j];return-1!==j.indexOf("bottom")?l.insertBefore(f,l.firstChild):l.appendChild(f),this},w.prototype.removeControl=function(I){if(!I||!I.onRemove)return this.fire(new L.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var j=this._controls.indexOf(I);return j>-1&&this._controls.splice(j,1),I.onRemove(this),this},w.prototype.hasControl=function(I){return this._controls.indexOf(I)>-1},w.prototype.resize=function(I){var j=this._containerDimensions(),f=j[0],l=j[1];this._resizeCanvas(f,l),this.transform.resize(f,l),this.painter.resize(f,l);var d=!this._moving;return d&&(this.stop(),this.fire(new L.Event("movestart",I)).fire(new L.Event("move",I))),this.fire(new L.Event("resize",I)),d&&this.fire(new L.Event("moveend",I)),this},w.prototype.getBounds=function(){return this.transform.getBounds()},w.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},w.prototype.setMaxBounds=function(I){return this.transform.setMaxBounds(L.LngLatBounds.convert(I)),this._update()},w.prototype.setMinZoom=function(I){if((I=null==I?-2:I)>=-2&&I<=this.transform.maxZoom)return this.transform.minZoom=I,this._update(),this.getZoom()<I&&this.setZoom(I),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},w.prototype.getMinZoom=function(){return this.transform.minZoom},w.prototype.setMaxZoom=function(I){if((I=null==I?22:I)>=this.transform.minZoom)return this.transform.maxZoom=I,this._update(),this.getZoom()>I&&this.setZoom(I),this;throw new Error("maxZoom must be greater than the current minZoom")},w.prototype.getMaxZoom=function(){return this.transform.maxZoom},w.prototype.setMinPitch=function(I){if((I=null==I?0:I)<0)throw new Error("minPitch must be greater than or equal to 0");if(I>=0&&I<=this.transform.maxPitch)return this.transform.minPitch=I,this._update(),this.getPitch()<I&&this.setPitch(I),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},w.prototype.getMinPitch=function(){return this.transform.minPitch},w.prototype.setMaxPitch=function(I){if((I=null==I?60:I)>60)throw new Error("maxPitch must be less than or equal to 60");if(I>=this.transform.minPitch)return this.transform.maxPitch=I,this._update(),this.getPitch()>I&&this.setPitch(I),this;throw new Error("maxPitch must be greater than the current minPitch")},w.prototype.getMaxPitch=function(){return this.transform.maxPitch},w.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},w.prototype.setRenderWorldCopies=function(I){return this.transform.renderWorldCopies=I,this._update()},w.prototype.project=function(I){return this.transform.locationPoint(L.LngLat.convert(I))},w.prototype.unproject=function(I){return this.transform.pointLocation(L.Point.convert(I))},w.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},w.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},w.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},w.prototype._createDelegatedListener=function(I,j,f){var l,d=this;if("mouseenter"===I||"mouseover"===I){var x=!1;return{layer:j,listener:f,delegates:{mousemove:function(D){var B=d.getLayer(j)?d.queryRenderedFeatures(D.point,{layers:[j]}):[];B.length?x||(x=!0,f.call(d,new hs(I,d,D.originalEvent,{features:B}))):x=!1},mouseout:function(){x=!1}}}}if("mouseleave"===I||"mouseout"===I){var M=!1;return{layer:j,listener:f,delegates:{mousemove:function(D){(d.getLayer(j)?d.queryRenderedFeatures(D.point,{layers:[j]}):[]).length?M=!0:M&&(M=!1,f.call(d,new hs(I,d,D.originalEvent)))},mouseout:function(D){M&&(M=!1,f.call(d,new hs(I,d,D.originalEvent)))}}}}return{layer:j,listener:f,delegates:(l={},l[I]=function(D){var B=d.getLayer(j)?d.queryRenderedFeatures(D.point,{layers:[j]}):[];B.length&&(D.features=B,f.call(d,D),delete D.features)},l)}},w.prototype.on=function(I,j,f){if(void 0===f)return v.prototype.on.call(this,I,j);var l=this._createDelegatedListener(I,j,f);for(var d in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[I]=this._delegatedListeners[I]||[],this._delegatedListeners[I].push(l),l.delegates)this.on(d,l.delegates[d]);return this},w.prototype.once=function(I,j,f){if(void 0===f)return v.prototype.once.call(this,I,j);var l=this._createDelegatedListener(I,j,f);for(var d in l.delegates)this.once(d,l.delegates[d]);return this},w.prototype.off=function(I,j,f){var l=this;return void 0===f?v.prototype.off.call(this,I,j):(this._delegatedListeners&&this._delegatedListeners[I]&&function(d){for(var x=d[I],M=0;M<x.length;M++){var D=x[M];if(D.layer===j&&D.listener===f){for(var B in D.delegates)l.off(B,D.delegates[B]);return x.splice(M,1),l}}}(this._delegatedListeners),this)},w.prototype.queryRenderedFeatures=function(I,j){if(!this.style)return[];var f;if(void 0!==j||void 0===I||I instanceof L.Point||Array.isArray(I)||(j=I,I=void 0),j=j||{},(I=I||[[0,0],[this.transform.width,this.transform.height]])instanceof L.Point||"number"==typeof I[0])f=[L.Point.convert(I)];else{var l=L.Point.convert(I[0]),d=L.Point.convert(I[1]);f=[l,new L.Point(d.x,l.y),d,new L.Point(l.x,d.y),l]}return this.style.queryRenderedFeatures(f,j,this.transform)},w.prototype.querySourceFeatures=function(I,j){return this.style.querySourceFeatures(I,j)},w.prototype.setStyle=function(I,j){return!1!==(j=L.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},j)).diff&&j.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&I?(this._diffStyle(I,j),this):(this._localIdeographFontFamily=j.localIdeographFontFamily,this._updateStyle(I,j))},w.prototype.setTransformRequest=function(I){return this._requestManager.setTransformRequest(I),this},w.prototype._getUIString=function(I){var j=this._locale[I];if(null==j)throw new Error("Missing UI string '"+I+"'");return j},w.prototype._updateStyle=function(I,j){return this.style&&(this.style.setEventedParent(null),this.style._remove()),I?(this.style=new kc(this,j||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof I?this.style.loadURL(I):this.style.loadJSON(I),this):(delete this.style,this)},w.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new kc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},w.prototype._diffStyle=function(I,j){var f=this;if("string"==typeof I){var l=this._requestManager.normalizeStyleURL(I),d=this._requestManager.transformRequest(l,L.ResourceType.Style);L.getJSON(d,function(x,M){x?f.fire(new L.ErrorEvent(x)):M&&f._updateDiff(M,j)})}else"object"==typeof I&&this._updateDiff(I,j)},w.prototype._updateDiff=function(I,j){try{this.style.setState(I)&&this._update(!0)}catch(f){L.warnOnce("Unable to perform style diff: "+(f.message||f.error||f)+".  Rebuilding the style from scratch."),this._updateStyle(I,j)}},w.prototype.getStyle=function(){if(this.style)return this.style.serialize()},w.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():L.warnOnce("There is no style added to the map.")},w.prototype.addSource=function(I,j){return this._lazyInitEmptyStyle(),this.style.addSource(I,j),this._update(!0)},w.prototype.isSourceLoaded=function(I){var j=this.style&&this.style.sourceCaches[I];if(void 0!==j)return j.loaded();this.fire(new L.ErrorEvent(new Error("There is no source with ID '"+I+"'")))},w.prototype.areTilesLoaded=function(){var I=this.style&&this.style.sourceCaches;for(var j in I){var f=I[j]._tiles;for(var l in f){var d=f[l];if("loaded"!==d.state&&"errored"!==d.state)return!1}}return!0},w.prototype.addSourceType=function(I,j,f){return this._lazyInitEmptyStyle(),this.style.addSourceType(I,j,f)},w.prototype.removeSource=function(I){return this.style.removeSource(I),this._update(!0)},w.prototype.getSource=function(I){return this.style.getSource(I)},w.prototype.addImage=function(I,j,f){void 0===f&&(f={});var l=f.pixelRatio;void 0===l&&(l=1);var d=f.sdf;void 0===d&&(d=!1);var x=f.stretchX,M=f.stretchY,D=f.content;if(this._lazyInitEmptyStyle(),j instanceof Lr||Eu&&j instanceof Eu){var B=L.browser.getImageData(j);this.style.addImage(I,{data:new L.RGBAImage({width:B.width,height:B.height},B.data),pixelRatio:l,stretchX:x,stretchY:M,content:D,sdf:d,version:0})}else{if(void 0===j.width||void 0===j.height)return this.fire(new L.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var G=j;this.style.addImage(I,{data:new L.RGBAImage({width:j.width,height:j.height},new Uint8Array(j.data)),pixelRatio:l,stretchX:x,stretchY:M,content:D,sdf:d,version:0,userImage:G}),G.onAdd&&G.onAdd(this,I)}},w.prototype.updateImage=function(I,j){var f=this.style.getImage(I);if(!f)return this.fire(new L.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var l=j instanceof Lr||Eu&&j instanceof Eu?L.browser.getImageData(j):j,d=l.width,x=l.height,M=l.data;return void 0===d||void 0===x?this.fire(new L.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):d!==f.data.width||x!==f.data.height?this.fire(new L.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(f.data.replace(M,!(j instanceof Lr||Eu&&j instanceof Eu)),void this.style.updateImage(I,f))},w.prototype.hasImage=function(I){return I?!!this.style.getImage(I):(this.fire(new L.ErrorEvent(new Error("Missing required image id"))),!1)},w.prototype.removeImage=function(I){this.style.removeImage(I)},w.prototype.loadImage=function(I,j){L.getImage(this._requestManager.transformRequest(I,L.ResourceType.Image),j)},w.prototype.listImages=function(){return this.style.listImages()},w.prototype.addLayer=function(I,j){return this._lazyInitEmptyStyle(),this.style.addLayer(I,j),this._update(!0)},w.prototype.moveLayer=function(I,j){return this.style.moveLayer(I,j),this._update(!0)},w.prototype.removeLayer=function(I){return this.style.removeLayer(I),this._update(!0)},w.prototype.getLayer=function(I){return this.style.getLayer(I)},w.prototype.setLayerZoomRange=function(I,j,f){return this.style.setLayerZoomRange(I,j,f),this._update(!0)},w.prototype.setFilter=function(I,j,f){return void 0===f&&(f={}),this.style.setFilter(I,j,f),this._update(!0)},w.prototype.getFilter=function(I){return this.style.getFilter(I)},w.prototype.setPaintProperty=function(I,j,f,l){return void 0===l&&(l={}),this.style.setPaintProperty(I,j,f,l),this._update(!0)},w.prototype.getPaintProperty=function(I,j){return this.style.getPaintProperty(I,j)},w.prototype.setLayoutProperty=function(I,j,f,l){return void 0===l&&(l={}),this.style.setLayoutProperty(I,j,f,l),this._update(!0)},w.prototype.getLayoutProperty=function(I,j){return this.style.getLayoutProperty(I,j)},w.prototype.setLight=function(I,j){return void 0===j&&(j={}),this._lazyInitEmptyStyle(),this.style.setLight(I,j),this._update(!0)},w.prototype.getLight=function(){return this.style.getLight()},w.prototype.setFeatureState=function(I,j){return this.style.setFeatureState(I,j),this._update()},w.prototype.removeFeatureState=function(I,j){return this.style.removeFeatureState(I,j),this._update()},w.prototype.getFeatureState=function(I){return this.style.getFeatureState(I)},w.prototype.getContainer=function(){return this._container},w.prototype.getCanvasContainer=function(){return this._canvasContainer},w.prototype.getCanvas=function(){return this._canvas},w.prototype._containerDimensions=function(){var I=0,j=0;return this._container&&(I=this._container.clientWidth||400,j=this._container.clientHeight||300),[I,j]},w.prototype._setupContainer=function(){var I=this._container;I.classList.add("maplibregl-map","mapboxgl-map");var j=this._canvasContainer=ut.create("div","maplibregl-canvas-container mapboxgl-canvas-container",I);this._interactive&&j.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=ut.create("canvas","maplibregl-canvas mapboxgl-canvas",j),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var f=this._containerDimensions();this._resizeCanvas(f[0],f[1]);var l=this._controlContainer=ut.create("div","maplibregl-control-container mapboxgl-control-container",I),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(x){d[x]=ut.create("div","maplibregl-ctrl-"+x+" mapboxgl-ctrl-"+x,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},w.prototype._resizeCanvas=function(I,j){var f=L.browser.devicePixelRatio||1;this._canvas.width=f*I,this._canvas.height=f*j,this._canvas.style.width=I+"px",this._canvas.style.height=j+"px"},w.prototype._setupPainter=function(){var I=L.extend({},C.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),j=this._canvas.getContext("webgl",I)||this._canvas.getContext("experimental-webgl",I);j?(this.painter=new _o(j,this.transform),L.webpSupported.testSupport(j)):this.fire(new L.ErrorEvent(new Error("Failed to initialize WebGL")))},w.prototype._contextLost=function(I){I.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new L.Event("webglcontextlost",{originalEvent:I}))},w.prototype._contextRestored=function(I){this._setupPainter(),this.resize(),this._update(),this.fire(new L.Event("webglcontextrestored",{originalEvent:I}))},w.prototype._onMapScroll=function(I){if(I.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},w.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},w.prototype._update=function(I){return this.style?(this._styleDirty=this._styleDirty||I,this._sourcesDirty=!0,this.triggerRepaint(),this):this},w.prototype._requestRenderFrame=function(I){return this._update(),this._renderTaskQueue.add(I)},w.prototype._cancelRenderFrame=function(I){this._renderTaskQueue.remove(I)},w.prototype._render=function(I){var j,f=this,l=0,d=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(j=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,j),l=L.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(I),!this._removed){var x=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var M=this.transform.zoom,D=L.browser.now();this.style.zoomHistory.update(M,D);var B=new L.EvaluationParameters(M,{now:D,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),G=B.crossFadingFactor();1===G&&G===this._crossFadingFactor||(x=!0,this._crossFadingFactor=G),this.style.update(B)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new L.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new L.Event("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var W=L.browser.now()-l;d.endQueryEXT(d.TIME_ELAPSED_EXT,j),setTimeout(function(){var Q=d.getQueryObjectEXT(j,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(j),f.fire(new L.Event("gpu-timing-frame",{cpuTime:W,gpuTime:Q}))},50)}if(this.listens("gpu-timing-layer")){var Y=this.painter.collectGpuTimers();setTimeout(function(){var Q=f.painter.queryGpuTimers(Y);f.fire(new L.Event("gpu-timing-layer",{layerTimes:Q}))},50)}var ee=this._sourcesDirty||this._styleDirty||this._placementDirty;return ee||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new L.Event("idle")),!this._loaded||this._fullyLoaded||ee||(this._fullyLoaded=!0),this}},w.prototype.remove=function(){this._hash&&this._hash.remove();for(var I=0,j=this._controls;I<j.length;I+=1)j[I].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==L.window&&(L.window.removeEventListener("resize",this._onWindowResize,!1),L.window.removeEventListener("orientationchange",this._onWindowResize,!1),L.window.removeEventListener("online",this._onWindowOnline,!1));var f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),pp(this._canvasContainer),pp(this._controlContainer),this._container.classList.remove("maplibregl-map","mapboxgl-map"),this._removed=!0,this.fire(new L.Event("remove"))},w.prototype.triggerRepaint=function(){var I=this;this.style&&!this._frame&&(this._frame=L.browser.frame(function(j){I._frame=null,I._render(j)}))},w.prototype._onWindowOnline=function(){this._update()},w.prototype._onWindowResize=function(I){this._trackResize&&this.resize({originalEvent:I})._update()},_.showTileBoundaries.get=function(){return!!this._showTileBoundaries},_.showTileBoundaries.set=function(I){this._showTileBoundaries!==I&&(this._showTileBoundaries=I,this._update())},_.showPadding.get=function(){return!!this._showPadding},_.showPadding.set=function(I){this._showPadding!==I&&(this._showPadding=I,this._update())},_.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},_.showCollisionBoxes.set=function(I){this._showCollisionBoxes!==I&&(this._showCollisionBoxes=I,I?this.style._generateCollisionBoxes():this._update())},_.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},_.showOverdrawInspector.set=function(I){this._showOverdrawInspector!==I&&(this._showOverdrawInspector=I,this._update())},_.repaint.get=function(){return!!this._repaint},_.repaint.set=function(I){this._repaint!==I&&(this._repaint=I,this.triggerRepaint())},_.vertices.get=function(){return!!this._vertices},_.vertices.set=function(I){this._vertices=I,this._update()},w.prototype._setCacheLimits=function(I,j){L.setCacheLimits(I,j)},_.version.get=function(){return L.version},Object.defineProperties(w.prototype,_),w}(Nr);function pp(v){v.parentNode&&v.parentNode.removeChild(v)}var oh={showCompass:!0,showZoom:!0,visualizePitch:!1},cc=function(v){var w=this;this.options=L.extend({},oh,v),this._container=ut.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(_){return _.preventDefault()}),this.options.showZoom&&(L.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",function(_){return w._map.zoomIn({},{originalEvent:_})}),ut.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",function(_){return w._map.zoomOut({},{originalEvent:_})}),ut.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(L.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",function(_){w.options.visualizePitch?w._map.resetNorthPitch({},{originalEvent:_}):w._map.resetNorth({},{originalEvent:_})}),this._compassIcon=ut.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};cc.prototype._updateZoomButtons=function(){var v=this._map.getZoom(),w=v===this._map.getMaxZoom(),_=v===this._map.getMinZoom();this._zoomInButton.disabled=w,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",w.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},cc.prototype._rotateCompassArrow=function(){var v=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=v},cc.prototype.onAdd=function(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new gn(this._map,this._compass,this.options.visualizePitch)),this._container},cc.prototype.onRemove=function(){ut.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},cc.prototype._createButton=function(v,w){var _=ut.create("button",v,this._container);return _.type="button",_.addEventListener("click",w),_},cc.prototype._setButtonTitle=function(v,w){var _=this._map._getUIString("NavigationControl."+w);v.title=_,v.setAttribute("aria-label",_)};var gn=function(v,w,_){void 0===_&&(_=!1),this._clickTolerance=10,this.element=w,this.mouseRotate=new rh({clickTolerance:v.dragRotate._mouseRotate._clickTolerance}),this.map=v,_&&(this.mousePitch=new Mh({clickTolerance:v.dragRotate._mousePitch._clickTolerance})),L.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),ut.addEventListener(w,"mousedown",this.mousedown),ut.addEventListener(w,"touchstart",this.touchstart,{passive:!1}),ut.addEventListener(w,"touchmove",this.touchmove),ut.addEventListener(w,"touchend",this.touchend),ut.addEventListener(w,"touchcancel",this.reset)};function Ni(v,w,_){if(v=new L.LngLat(v.lng,v.lat),w){var I=new L.LngLat(v.lng-360,v.lat),j=new L.LngLat(v.lng+360,v.lat),f=_.locationPoint(v).distSqr(w);_.locationPoint(I).distSqr(w)<f?v=I:_.locationPoint(j).distSqr(w)<f&&(v=j)}for(;Math.abs(v.lng-_.center.lng)>180;){var l=_.locationPoint(v);if(l.x>=0&&l.y>=0&&l.x<=_.width&&l.y<=_.height)break;v.lng>_.center.lng?v.lng-=360:v.lng+=360}return v}gn.prototype.down=function(v,w){this.mouseRotate.mousedown(v,w),this.mousePitch&&this.mousePitch.mousedown(v,w),ut.disableDrag()},gn.prototype.move=function(v,w){var _=this.map,I=this.mouseRotate.mousemoveWindow(v,w);if(I&&I.bearingDelta&&_.setBearing(_.getBearing()+I.bearingDelta),this.mousePitch){var j=this.mousePitch.mousemoveWindow(v,w);j&&j.pitchDelta&&_.setPitch(_.getPitch()+j.pitchDelta)}},gn.prototype.off=function(){var v=this.element;ut.removeEventListener(v,"mousedown",this.mousedown),ut.removeEventListener(v,"touchstart",this.touchstart,{passive:!1}),ut.removeEventListener(v,"touchmove",this.touchmove),ut.removeEventListener(v,"touchend",this.touchend),ut.removeEventListener(v,"touchcancel",this.reset),this.offTemp()},gn.prototype.offTemp=function(){ut.enableDrag(),ut.removeEventListener(L.window,"mousemove",this.mousemove),ut.removeEventListener(L.window,"mouseup",this.mouseup)},gn.prototype.mousedown=function(v){this.down(L.extend({},v,{ctrlKey:!0,preventDefault:function(){return v.preventDefault()}}),ut.mousePos(this.element,v)),ut.addEventListener(L.window,"mousemove",this.mousemove),ut.addEventListener(L.window,"mouseup",this.mouseup)},gn.prototype.mousemove=function(v){this.move(v,ut.mousePos(this.element,v))},gn.prototype.mouseup=function(v){this.mouseRotate.mouseupWindow(v),this.mousePitch&&this.mousePitch.mouseupWindow(v),this.offTemp()},gn.prototype.touchstart=function(v){1!==v.targetTouches.length?this.reset():(this._startPos=this._lastPos=ut.touchPos(this.element,v.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return v.preventDefault()}},this._startPos))},gn.prototype.touchmove=function(v){1!==v.targetTouches.length?this.reset():(this._lastPos=ut.touchPos(this.element,v.targetTouches)[0],this.move({preventDefault:function(){return v.preventDefault()}},this._lastPos))},gn.prototype.touchend=function(v){0===v.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},gn.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Rr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function jo(v,w,_){var I=v.classList;for(var j in Rr)I.remove("maplibregl-"+_+"-anchor-"+j,"mapboxgl-"+_+"-anchor-"+j);I.add("maplibregl-"+_+"-anchor-"+w,"mapboxgl-"+_+"-anchor-"+w)}var Fc,ah=function(v){function w(_,I){if(v.call(this),(_ instanceof L.window.HTMLElement||I)&&(_=L.extend({element:_},I)),L.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=_&&_.anchor||"center",this._color=_&&_.color||"#3FB1CE",this._scale=_&&_.scale||1,this._draggable=_&&_.draggable||!1,this._clickTolerance=_&&_.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=_&&_.rotation||0,this._rotationAlignment=_&&_.rotationAlignment||"auto",this._pitchAlignment=_&&_.pitchAlignment&&"auto"!==_.pitchAlignment?_.pitchAlignment:this._rotationAlignment,_&&_.element)this._element=_.element,this._offset=L.Point.convert(_&&_.offset||[0,0]);else{this._defaultMarker=!0,this._element=ut.create("div"),this._element.setAttribute("aria-label","Map marker");var j=ut.createNS("http://www.w3.org/2000/svg","svg");j.setAttributeNS(null,"display","block"),j.setAttributeNS(null,"height","41px"),j.setAttributeNS(null,"width","27px"),j.setAttributeNS(null,"viewBox","0 0 27 41");var f=ut.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");var l=ut.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"fill-rule","nonzero");var d=ut.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"transform","translate(3.0, 29.0)"),d.setAttributeNS(null,"fill","#000000");for(var x=0,M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];x<M.length;x+=1){var D=M[x],B=ut.createNS("http://www.w3.org/2000/svg","ellipse");B.setAttributeNS(null,"opacity","0.04"),B.setAttributeNS(null,"cx","10.5"),B.setAttributeNS(null,"cy","5.80029008"),B.setAttributeNS(null,"rx",D.rx),B.setAttributeNS(null,"ry",D.ry),d.appendChild(B)}var G=ut.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"fill",this._color);var W=ut.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),G.appendChild(W);var Y=ut.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"opacity","0.25"),Y.setAttributeNS(null,"fill","#000000");var ee=ut.createNS("http://www.w3.org/2000/svg","path");ee.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Y.appendChild(ee);var Q=ut.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Q.setAttributeNS(null,"fill","#FFFFFF");var le=ut.createNS("http://www.w3.org/2000/svg","g");le.setAttributeNS(null,"transform","translate(8.0, 8.0)");var de=ut.createNS("http://www.w3.org/2000/svg","circle");de.setAttributeNS(null,"fill","#000000"),de.setAttributeNS(null,"opacity","0.25"),de.setAttributeNS(null,"cx","5.5"),de.setAttributeNS(null,"cy","5.5"),de.setAttributeNS(null,"r","5.4999962");var ge=ut.createNS("http://www.w3.org/2000/svg","circle");ge.setAttributeNS(null,"fill","#FFFFFF"),ge.setAttributeNS(null,"cx","5.5"),ge.setAttributeNS(null,"cy","5.5"),ge.setAttributeNS(null,"r","5.4999962"),le.appendChild(de),le.appendChild(ge),l.appendChild(d),l.appendChild(G),l.appendChild(Y),l.appendChild(Q),l.appendChild(le),j.appendChild(l),j.setAttributeNS(null,"height",41*this._scale+"px"),j.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(j),this._offset=L.Point.convert(_&&_.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",function(xe){xe.preventDefault()}),this._element.addEventListener("mousedown",function(xe){xe.preventDefault()}),jo(this._element,this._anchor,"marker"),this._popup=null}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.addTo=function(_){return this.remove(),this._map=_,_.getCanvasContainer().appendChild(this._element),_.on("move",this._update),_.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},w.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ut.remove(this._element),this._popup&&this._popup.remove(),this},w.prototype.getLngLat=function(){return this._lngLat},w.prototype.setLngLat=function(_){return this._lngLat=L.LngLat.convert(_),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},w.prototype.getElement=function(){return this._element},w.prototype.setPopup=function(_){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),_){if(!("offset"in _.options)){var I=Math.sqrt(Math.pow(13.5,2)/2);_.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[I,-1*(24.6+I)],"bottom-right":[-I,-1*(24.6+I)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=_,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},w.prototype._onKeyPress=function(_){var I=_.code,j=_.charCode||_.keyCode;"Space"!==I&&"Enter"!==I&&32!==j&&13!==j||this.togglePopup()},w.prototype._onMapClick=function(_){var I=_.originalEvent.target,j=this._element;this._popup&&(I===j||j.contains(I))&&this.togglePopup()},w.prototype.getPopup=function(){return this._popup},w.prototype.togglePopup=function(){var _=this._popup;return _?(_.isOpen()?_.remove():_.addTo(this._map),this):this},w.prototype._update=function(_){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Ni(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var I="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?I="rotateZ("+this._rotation+"deg)":"map"===this._rotationAlignment&&(I="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var j="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?j="rotateX(0deg)":"map"===this._pitchAlignment&&(j="rotateX("+this._map.getPitch()+"deg)"),_&&"moveend"!==_.type||(this._pos=this._pos.round()),ut.setTransform(this._element,Rr[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+j+" "+I)}},w.prototype.getOffset=function(){return this._offset},w.prototype.setOffset=function(_){return this._offset=L.Point.convert(_),this._update(),this},w.prototype._onMove=function(_){if(!this._isDragging){var I=this._clickTolerance||this._map._clickTolerance;this._isDragging=_.point.dist(this._pointerdownPos)>=I}this._isDragging&&(this._pos=_.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new L.Event("dragstart"))),this.fire(new L.Event("drag")))},w.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new L.Event("dragend")),this._state="inactive"},w.prototype._addDragHandler=function(_){this._element.contains(_.originalEvent.target)&&(_.preventDefault(),this._positionDelta=_.point.sub(this._pos).add(this._offset),this._pointerdownPos=_.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},w.prototype.setDraggable=function(_){return this._draggable=!!_,this._map&&(_?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},w.prototype.isDraggable=function(){return this._draggable},w.prototype.setRotation=function(_){return this._rotation=_||0,this._update(),this},w.prototype.getRotation=function(){return this._rotation},w.prototype.setRotationAlignment=function(_){return this._rotationAlignment=_||"auto",this._update(),this},w.prototype.getRotationAlignment=function(){return this._rotationAlignment},w.prototype.setPitchAlignment=function(_){return this._pitchAlignment=_&&"auto"!==_?_:this._rotationAlignment,this._update(),this},w.prototype.getPitchAlignment=function(){return this._pitchAlignment},w}(L.Evented),Su={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},hc=0,pc=!1,oo=function(v){function w(_){v.call(this),this.options=L.extend({},Su,_),L.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.onAdd=function(_){var I;return this._map=_,this._container=ut.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),I=this._setupUI,void 0!==Fc?I(Fc):void 0!==L.window.navigator.permissions?L.window.navigator.permissions.query({name:"geolocation"}).then(function(j){I(Fc="denied"!==j.state)}):I(Fc=!!L.window.navigator.geolocation),this._container},w.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(L.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ut.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,hc=0,pc=!1},w.prototype._isOutOfMapMaxBounds=function(_){var I=this._map.getMaxBounds(),j=_.coords;return I&&(j.longitude<I.getWest()||j.longitude>I.getEast()||j.latitude<I.getSouth()||j.latitude>I.getNorth())},w.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting")}},w.prototype._onSuccess=function(_){if(this._map){if(this._isOutOfMapMaxBounds(_))return this._setErrorState(),this.fire(new L.Event("outofmaxbounds",_)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=_,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(_),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(_),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new L.Event("geolocate",_)),this._finish()}},w.prototype._updateCamera=function(_){var I=new L.LngLat(_.coords.longitude,_.coords.latitude),j=_.coords.accuracy,f=this._map.getBearing(),l=L.extend({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(I.toBounds(j),l,{geolocateSource:!0})},w.prototype._updateMarker=function(_){if(_){var I=new L.LngLat(_.coords.longitude,_.coords.latitude);this._accuracyCircleMarker.setLngLat(I).addTo(this._map),this._userLocationDotMarker.setLngLat(I).addTo(this._map),this._accuracy=_.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},w.prototype._updateCircleRadius=function(){var _=this._map._container.clientHeight/2,I=this._map.unproject([0,_]),j=this._map.unproject([1,_]),f=I.distanceTo(j),l=Math.ceil(2*this._accuracy/f);this._circleElement.style.width=l+"px",this._circleElement.style.height=l+"px"},w.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},w.prototype._onError=function(_){if(this._map){if(this.options.trackUserLocation)if(1===_.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var I=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=I,this._geolocateButton.setAttribute("aria-label",I),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===_.code&&pc)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new L.Event("error",_)),this._finish()}},w.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},w.prototype._setupUI=function(_){var I=this;if(this._container.addEventListener("contextmenu",function(l){return l.preventDefault()}),this._geolocateButton=ut.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),ut.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===_){L.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var j=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=j,this._geolocateButton.setAttribute("aria-label",j)}else{var f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ut.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new ah(this._dotElement),this._circleElement=ut.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ah({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(l){l.geolocateSource||"ACTIVE_LOCK"!==I._watchState||l.originalEvent&&"resize"===l.originalEvent.type||(I._watchState="BACKGROUND",I._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),I._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),I.fire(new L.Event("trackuserlocationend")))})},w.prototype.trigger=function(){if(!this._setup)return L.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new L.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":hc--,pc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new L.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new L.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){var _;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++hc>1?(_={maximumAge:6e5,timeout:0},pc=!0):(_=this.options.positionOptions,pc=!1),this._geolocationWatchID=L.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else L.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},w.prototype._clearWatch=function(){L.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},w}(L.Evented),ho={maxWidth:100,unit:"metric"},fs=function(v){this.options=L.extend({},ho,v),L.bindAll(["_onMove","setUnit"],this)};function sh(v,w,_){var I=_&&_.maxWidth||100,j=v._container.clientHeight/2,f=v.unproject([0,j]),l=v.unproject([I,j]),d=f.distanceTo(l);if(_&&"imperial"===_.unit){var x=3.2808*d;x>5280?Va(w,I,x/5280,v._getUIString("ScaleControl.Miles")):Va(w,I,x,v._getUIString("ScaleControl.Feet"))}else _&&"nautical"===_.unit?Va(w,I,d/1852,v._getUIString("ScaleControl.NauticalMiles")):d>=1e3?Va(w,I,d/1e3,v._getUIString("ScaleControl.Kilometers")):Va(w,I,d,v._getUIString("ScaleControl.Meters"))}function Va(v,w,_,I){var j,f,l,x,M,d=(j=_,(f=Math.pow(10,(""+Math.floor(j)).length-1))*(l=(l=j/f)>=10?10:l>=5?5:l>=3?3:l>=2?2:l>=1?1:(x=l,M=Math.pow(10,Math.ceil(-Math.log(x)/Math.LN10)),Math.round(x*M)/M)));v.style.width=w*(d/_)+"px",v.innerHTML=d+"&nbsp;"+I}fs.prototype.getDefaultPosition=function(){return"bottom-left"},fs.prototype._onMove=function(){sh(this._map,this._container,this.options)},fs.prototype.onAdd=function(v){return this._map=v,this._container=ut.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},fs.prototype.onRemove=function(){ut.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},fs.prototype.setUnit=function(v){this.options.unit=v,sh(this._map,this._container,this.options)};var Ga=function(v){this._fullscreen=!1,v&&v.container&&(v.container instanceof L.window.HTMLElement?this._container=v.container:L.warnOnce("Full screen control 'container' must be a DOM element.")),L.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in L.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in L.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in L.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in L.window.document&&(this._fullscreenchange="MSFullscreenChange")};Ga.prototype.onAdd=function(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=ut.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",L.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Ga.prototype.onRemove=function(){ut.remove(this._controlContainer),this._map=null,L.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Ga.prototype._checkFullscreenSupport=function(){return!!(L.window.document.fullscreenEnabled||L.window.document.mozFullScreenEnabled||L.window.document.msFullscreenEnabled||L.window.document.webkitFullscreenEnabled)},Ga.prototype._setupUI=function(){var v=this._fullscreenButton=ut.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);ut.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",v).setAttribute("aria-hidden",!0),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),L.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Ga.prototype._updateTitle=function(){var v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v},Ga.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Ga.prototype._isFullscreen=function(){return this._fullscreen},Ga.prototype._changeIcon=function(){(L.window.document.fullscreenElement||L.window.document.mozFullScreenElement||L.window.document.webkitFullscreenElement||L.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Ga.prototype._onClickFullscreen=function(){this._isFullscreen()?L.window.document.exitFullscreen?L.window.document.exitFullscreen():L.window.document.mozCancelFullScreen?L.window.document.mozCancelFullScreen():L.window.document.msExitFullscreen?L.window.document.msExitFullscreen():L.window.document.webkitCancelFullScreen&&L.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var dc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},au=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Qs=function(v){function w(_){v.call(this),this.options=L.extend(Object.create(dc),_),L.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return v&&(w.__proto__=v),(w.prototype=Object.create(v&&v.prototype)).constructor=w,w.prototype.addTo=function(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new L.Event("open")),this},w.prototype.isOpen=function(){return!!this._map},w.prototype.remove=function(){return this._content&&ut.remove(this._content),this._container&&(ut.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new L.Event("close")),this},w.prototype.getLngLat=function(){return this._lngLat},w.prototype.setLngLat=function(_){return this._lngLat=L.LngLat.convert(_),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this},w.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this},w.prototype.getElement=function(){return this._container},w.prototype.setText=function(_){return this.setDOMContent(L.window.document.createTextNode(_))},w.prototype.setHTML=function(_){var I,j=L.window.document.createDocumentFragment(),f=L.window.document.createElement("body");for(f.innerHTML=_;I=f.firstChild;)j.appendChild(I);return this.setDOMContent(j)},w.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},w.prototype.setMaxWidth=function(_){return this.options.maxWidth=_,this._update(),this},w.prototype.setDOMContent=function(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ut.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this},w.prototype.addClassName=function(_){this._container&&this._container.classList.add(_)},w.prototype.removeClassName=function(_){this._container&&this._container.classList.remove(_)},w.prototype.setOffset=function(_){return this.options.offset=_,this._update(),this},w.prototype.toggleClassName=function(_){if(this._container)return this._container.classList.toggle(_)},w.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=ut.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},w.prototype._onMouseUp=function(_){this._update(_.point)},w.prototype._onMouseMove=function(_){this._update(_.point)},w.prototype._onDrag=function(_){this._update(_.point)},w.prototype._update=function(_){var I=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=ut.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=ut.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(B){return I._container.classList.add(B)}),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ni(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||_)){var j=this._pos=this._trackPointer&&_?_:this._map.project(this._lngLat),f=this.options.anchor,l=function B(G){if(G){if("number"==typeof G){var W=Math.round(Math.sqrt(.5*Math.pow(G,2)));return{center:new L.Point(0,0),top:new L.Point(0,G),"top-left":new L.Point(W,W),"top-right":new L.Point(-W,W),bottom:new L.Point(0,-G),"bottom-left":new L.Point(W,-W),"bottom-right":new L.Point(-W,-W),left:new L.Point(G,0),right:new L.Point(-G,0)}}if(G instanceof L.Point||Array.isArray(G)){var Y=L.Point.convert(G);return{center:Y,top:Y,"top-left":Y,"top-right":Y,bottom:Y,"bottom-left":Y,"bottom-right":Y,left:Y,right:Y}}return{center:L.Point.convert(G.center||[0,0]),top:L.Point.convert(G.top||[0,0]),"top-left":L.Point.convert(G["top-left"]||[0,0]),"top-right":L.Point.convert(G["top-right"]||[0,0]),bottom:L.Point.convert(G.bottom||[0,0]),"bottom-left":L.Point.convert(G["bottom-left"]||[0,0]),"bottom-right":L.Point.convert(G["bottom-right"]||[0,0]),left:L.Point.convert(G.left||[0,0]),right:L.Point.convert(G.right||[0,0])}}return B(new L.Point(0,0))}(this.options.offset);if(!f){var d,x=this._container.offsetWidth,M=this._container.offsetHeight;d=j.y+l.bottom.y<M?["top"]:j.y>this._map.transform.height-M?["bottom"]:[],j.x<x/2?d.push("left"):j.x>this._map.transform.width-x/2&&d.push("right"),f=0===d.length?"bottom":d.join("-")}var D=j.add(l[f]).round();ut.setTransform(this._container,Rr[f]+" translate("+D.x+"px,"+D.y+"px)"),jo(this._container,f,"popup")}},w.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var _=this._container.querySelector(au);_&&_.focus()}},w.prototype._onClose=function(){this.remove()},w}(L.Evented),Kh={version:L.version,supported:C,setRTLTextPlugin:L.setRTLTextPlugin,getRTLTextPluginStatus:L.getRTLTextPluginStatus,Map:Ea,NavigationControl:cc,GeolocateControl:oo,AttributionControl:Vl,ScaleControl:fs,FullscreenControl:Ga,Popup:Qs,Marker:ah,Style:kc,LngLat:L.LngLat,LngLatBounds:L.LngLatBounds,Point:L.Point,MercatorCoordinate:L.MercatorCoordinate,Evented:L.Evented,config:L.config,prewarm:function(){Xt().acquire(Be)},clearPrewarmedResources:function(){var v=Rt;v&&(v.isPreloaded()&&1===v.numActive()?(v.release(Be),Rt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return L.config.ACCESS_TOKEN},set accessToken(v){L.config.ACCESS_TOKEN=v},get baseApiUrl(){return L.config.API_URL},set baseApiUrl(v){L.config.API_URL=v},get workerCount(){return lt.workerCount},set workerCount(v){lt.workerCount=v},get maxParallelImageRequests(){return L.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(v){L.config.MAX_PARALLEL_IMAGE_REQUESTS=v},clearStorage:function(v){L.clearTileCache(v)},workerUrl:"",addProtocol:function(v,w){L.config.REGISTERED_PROTOCOLS[v]=w},removeProtocol:function(v){delete L.config.REGISTERED_PROTOCOLS[v]}};return Kh}),Ut}()},697:(xr,Gr,Ht)=>{"use strict";xr.exports=Jt;var Ut=Ht(658);function Jt(je){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(je)?je:new Uint8Array(je||0),this.pos=0,this.type=0,this.length=this.buf.length}Jt.Varint=0,Jt.Fixed64=1,Jt.Bytes=2,Jt.Fixed32=5;var L=4294967296,C=1/L,tn="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function it(je){return je.type===Jt.Bytes?je.readVarint()+je.pos:je.pos+1}function Cn(je,ct,Vt){var Pr=ct<=16383?1:ct<=2097151?2:ct<=268435455?3:Math.floor(Math.log(ct)/(7*Math.LN2));Vt.realloc(Pr);for(var fr=Vt.pos-1;fr>=je;fr--)Vt.buf[fr+Pr]=Vt.buf[fr]}function fn(je,ct){for(var Vt=0;Vt<je.length;Vt++)ct.writeVarint(je[Vt])}function et(je,ct){for(var Vt=0;Vt<je.length;Vt++)ct.writeSVarint(je[Vt])}function _t(je,ct){for(var Vt=0;Vt<je.length;Vt++)ct.writeFloat(je[Vt])}function Dt(je,ct){for(var Vt=0;Vt<je.length;Vt++)ct.writeDouble(je[Vt])}function bn(je,ct){for(var Vt=0;Vt<je.length;Vt++)ct.writeBoolean(je[Vt])}function Pn(je,ct){for(var Vt=0;Vt<je.length;Vt++)ct.writeFixed32(je[Vt])}function an(je,ct){for(var Vt=0;Vt<je.length;Vt++)ct.writeSFixed32(je[Vt])}function Rn(je,ct){for(var Vt=0;Vt<je.length;Vt++)ct.writeFixed64(je[Vt])}function nr(je,ct){for(var Vt=0;Vt<je.length;Vt++)ct.writeSFixed64(je[Vt])}function dr(je,ct){return(je[ct]|je[ct+1]<<8|je[ct+2]<<16)+16777216*je[ct+3]}function jn(je,ct,Vt){je[Vt]=ct,je[Vt+1]=ct>>>8,je[Vt+2]=ct>>>16,je[Vt+3]=ct>>>24}function pn(je,ct){return(je[ct]|je[ct+1]<<8|je[ct+2]<<16)+(je[ct+3]<<24)}Jt.prototype={destroy:function(){this.buf=null},readFields:function(je,ct,Vt){for(Vt=Vt||this.length;this.pos<Vt;){var Pr=this.readVarint(),fr=Pr>>3,vr=this.pos;this.type=7&Pr,je(fr,ct,this),this.pos===vr&&this.skip(Pr)}return ct},readMessage:function(je,ct){return this.readFields(je,ct,this.readVarint()+this.pos)},readFixed32:function(){var je=dr(this.buf,this.pos);return this.pos+=4,je},readSFixed32:function(){var je=pn(this.buf,this.pos);return this.pos+=4,je},readFixed64:function(){var je=dr(this.buf,this.pos)+dr(this.buf,this.pos+4)*L;return this.pos+=8,je},readSFixed64:function(){var je=dr(this.buf,this.pos)+pn(this.buf,this.pos+4)*L;return this.pos+=8,je},readFloat:function(){var je=Ut.read(this.buf,this.pos,!0,23,4);return this.pos+=4,je},readDouble:function(){var je=Ut.read(this.buf,this.pos,!0,52,8);return this.pos+=8,je},readVarint:function(je){var Vt,Pr,ct=this.buf;return Vt=127&(Pr=ct[this.pos++]),Pr<128||(Vt|=(127&(Pr=ct[this.pos++]))<<7,Pr<128)||(Vt|=(127&(Pr=ct[this.pos++]))<<14,Pr<128)||(Vt|=(127&(Pr=ct[this.pos++]))<<21,Pr<128)?Vt:function(je,ct,Vt){var fr,vr,Pr=Vt.buf;if(fr=(112&(vr=Pr[Vt.pos++]))>>4,vr<128||(fr|=(127&(vr=Pr[Vt.pos++]))<<3,vr<128)||(fr|=(127&(vr=Pr[Vt.pos++]))<<10,vr<128)||(fr|=(127&(vr=Pr[Vt.pos++]))<<17,vr<128)||(fr|=(127&(vr=Pr[Vt.pos++]))<<24,vr<128)||(fr|=(1&(vr=Pr[Vt.pos++]))<<31,vr<128))return function(je,ct,Vt){return Vt?4294967296*ct+(je>>>0):4294967296*(ct>>>0)+(je>>>0)}(je,fr,ct);throw new Error("Expected varint not more than 10 bytes")}(Vt|=(15&(Pr=ct[this.pos]))<<28,je,this)},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var je=this.readVarint();return je%2==1?(je+1)/-2:je/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var je=this.readVarint()+this.pos,ct=this.pos;return this.pos=je,je-ct>=12&&tn?function(je,ct,Vt){return tn.decode(je.subarray(ct,Vt))}(this.buf,ct,je):function(je,ct,Vt){for(var Pr="",fr=ct;fr<Vt;){var Wo,Xi,Vi,vr=je[fr],Er=null,Ui=vr>239?4:vr>223?3:vr>191?2:1;if(fr+Ui>Vt)break;1===Ui?vr<128&&(Er=vr):2===Ui?128==(192&(Wo=je[fr+1]))&&(Er=(31&vr)<<6|63&Wo)<=127&&(Er=null):3===Ui?(Xi=je[fr+2],128==(192&(Wo=je[fr+1]))&&128==(192&Xi)&&((Er=(15&vr)<<12|(63&Wo)<<6|63&Xi)<=2047||Er>=55296&&Er<=57343)&&(Er=null)):4===Ui&&(Xi=je[fr+2],Vi=je[fr+3],128==(192&(Wo=je[fr+1]))&&128==(192&Xi)&&128==(192&Vi)&&((Er=(15&vr)<<18|(63&Wo)<<12|(63&Xi)<<6|63&Vi)<=65535||Er>=1114112)&&(Er=null)),null===Er?(Er=65533,Ui=1):Er>65535&&(Er-=65536,Pr+=String.fromCharCode(Er>>>10&1023|55296),Er=56320|1023&Er),Pr+=String.fromCharCode(Er),fr+=Ui}return Pr}(this.buf,ct,je)},readBytes:function(){var je=this.readVarint()+this.pos,ct=this.buf.subarray(this.pos,je);return this.pos=je,ct},readPackedVarint:function(je,ct){if(this.type!==Jt.Bytes)return je.push(this.readVarint(ct));var Vt=it(this);for(je=je||[];this.pos<Vt;)je.push(this.readVarint(ct));return je},readPackedSVarint:function(je){if(this.type!==Jt.Bytes)return je.push(this.readSVarint());var ct=it(this);for(je=je||[];this.pos<ct;)je.push(this.readSVarint());return je},readPackedBoolean:function(je){if(this.type!==Jt.Bytes)return je.push(this.readBoolean());var ct=it(this);for(je=je||[];this.pos<ct;)je.push(this.readBoolean());return je},readPackedFloat:function(je){if(this.type!==Jt.Bytes)return je.push(this.readFloat());var ct=it(this);for(je=je||[];this.pos<ct;)je.push(this.readFloat());return je},readPackedDouble:function(je){if(this.type!==Jt.Bytes)return je.push(this.readDouble());var ct=it(this);for(je=je||[];this.pos<ct;)je.push(this.readDouble());return je},readPackedFixed32:function(je){if(this.type!==Jt.Bytes)return je.push(this.readFixed32());var ct=it(this);for(je=je||[];this.pos<ct;)je.push(this.readFixed32());return je},readPackedSFixed32:function(je){if(this.type!==Jt.Bytes)return je.push(this.readSFixed32());var ct=it(this);for(je=je||[];this.pos<ct;)je.push(this.readSFixed32());return je},readPackedFixed64:function(je){if(this.type!==Jt.Bytes)return je.push(this.readFixed64());var ct=it(this);for(je=je||[];this.pos<ct;)je.push(this.readFixed64());return je},readPackedSFixed64:function(je){if(this.type!==Jt.Bytes)return je.push(this.readSFixed64());var ct=it(this);for(je=je||[];this.pos<ct;)je.push(this.readSFixed64());return je},skip:function(je){var ct=7&je;if(ct===Jt.Varint)for(;this.buf[this.pos++]>127;);else if(ct===Jt.Bytes)this.pos=this.readVarint()+this.pos;else if(ct===Jt.Fixed32)this.pos+=4;else{if(ct!==Jt.Fixed64)throw new Error("Unimplemented type: "+ct);this.pos+=8}},writeTag:function(je,ct){this.writeVarint(je<<3|ct)},realloc:function(je){for(var ct=this.length||16;ct<this.pos+je;)ct*=2;if(ct!==this.length){var Vt=new Uint8Array(ct);Vt.set(this.buf),this.buf=Vt,this.length=ct}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(je){this.realloc(4),jn(this.buf,je,this.pos),this.pos+=4},writeSFixed32:function(je){this.realloc(4),jn(this.buf,je,this.pos),this.pos+=4},writeFixed64:function(je){this.realloc(8),jn(this.buf,-1&je,this.pos),jn(this.buf,Math.floor(je*C),this.pos+4),this.pos+=8},writeSFixed64:function(je){this.realloc(8),jn(this.buf,-1&je,this.pos),jn(this.buf,Math.floor(je*C),this.pos+4),this.pos+=8},writeVarint:function(je){(je=+je||0)>268435455||je<0?function(je,ct){var Vt,Pr;if(je>=0?(Vt=je%4294967296|0,Pr=je/4294967296|0):(Pr=~(-je/4294967296),4294967295^(Vt=~(-je%4294967296))?Vt=Vt+1|0:(Vt=0,Pr=Pr+1|0)),je>=0x10000000000000000||je<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");ct.realloc(10),function(je,ct,Vt){Vt.buf[Vt.pos++]=127&je|128,je>>>=7,Vt.buf[Vt.pos++]=127&je|128,je>>>=7,Vt.buf[Vt.pos++]=127&je|128,je>>>=7,Vt.buf[Vt.pos++]=127&je|128,Vt.buf[Vt.pos]=127&(je>>>=7)}(Vt,0,ct),function(je,ct){var Vt=(7&je)<<4;ct.buf[ct.pos++]|=Vt|((je>>>=3)?128:0),je&&(ct.buf[ct.pos++]=127&je|((je>>>=7)?128:0),je&&(ct.buf[ct.pos++]=127&je|((je>>>=7)?128:0),je&&(ct.buf[ct.pos++]=127&je|((je>>>=7)?128:0),je&&(ct.buf[ct.pos++]=127&je|((je>>>=7)?128:0),je&&(ct.buf[ct.pos++]=127&je)))))}(Pr,ct)}(je,this):(this.realloc(4),this.buf[this.pos++]=127&je|(je>127?128:0),!(je<=127)&&(this.buf[this.pos++]=127&(je>>>=7)|(je>127?128:0),!(je<=127)&&(this.buf[this.pos++]=127&(je>>>=7)|(je>127?128:0),!(je<=127)&&(this.buf[this.pos++]=je>>>7&127))))},writeSVarint:function(je){this.writeVarint(je<0?2*-je-1:2*je)},writeBoolean:function(je){this.writeVarint(Boolean(je))},writeString:function(je){je=String(je),this.realloc(4*je.length),this.pos++;var ct=this.pos;this.pos=function(je,ct,Vt){for(var fr,vr,Pr=0;Pr<ct.length;Pr++){if((fr=ct.charCodeAt(Pr))>55295&&fr<57344){if(!vr){fr>56319||Pr+1===ct.length?(je[Vt++]=239,je[Vt++]=191,je[Vt++]=189):vr=fr;continue}if(fr<56320){je[Vt++]=239,je[Vt++]=191,je[Vt++]=189,vr=fr;continue}fr=vr-55296<<10|fr-56320|65536,vr=null}else vr&&(je[Vt++]=239,je[Vt++]=191,je[Vt++]=189,vr=null);fr<128?je[Vt++]=fr:(fr<2048?je[Vt++]=fr>>6|192:(fr<65536?je[Vt++]=fr>>12|224:(je[Vt++]=fr>>18|240,je[Vt++]=fr>>12&63|128),je[Vt++]=fr>>6&63|128),je[Vt++]=63&fr|128)}return Vt}(this.buf,je,this.pos);var Vt=this.pos-ct;Vt>=128&&Cn(ct,Vt,this),this.pos=ct-1,this.writeVarint(Vt),this.pos+=Vt},writeFloat:function(je){this.realloc(4),Ut.write(this.buf,je,this.pos,!0,23,4),this.pos+=4},writeDouble:function(je){this.realloc(8),Ut.write(this.buf,je,this.pos,!0,52,8),this.pos+=8},writeBytes:function(je){var ct=je.length;this.writeVarint(ct),this.realloc(ct);for(var Vt=0;Vt<ct;Vt++)this.buf[this.pos++]=je[Vt]},writeRawMessage:function(je,ct){this.pos++;var Vt=this.pos;je(ct,this);var Pr=this.pos-Vt;Pr>=128&&Cn(Vt,Pr,this),this.pos=Vt-1,this.writeVarint(Pr),this.pos+=Pr},writeMessage:function(je,ct,Vt){this.writeTag(je,Jt.Bytes),this.writeRawMessage(ct,Vt)},writePackedVarint:function(je,ct){ct.length&&this.writeMessage(je,fn,ct)},writePackedSVarint:function(je,ct){ct.length&&this.writeMessage(je,et,ct)},writePackedBoolean:function(je,ct){ct.length&&this.writeMessage(je,bn,ct)},writePackedFloat:function(je,ct){ct.length&&this.writeMessage(je,_t,ct)},writePackedDouble:function(je,ct){ct.length&&this.writeMessage(je,Dt,ct)},writePackedFixed32:function(je,ct){ct.length&&this.writeMessage(je,Pn,ct)},writePackedSFixed32:function(je,ct){ct.length&&this.writeMessage(je,an,ct)},writePackedFixed64:function(je,ct){ct.length&&this.writeMessage(je,Rn,ct)},writePackedSFixed64:function(je,ct){ct.length&&this.writeMessage(je,nr,ct)},writeBytesField:function(je,ct){this.writeTag(je,Jt.Bytes),this.writeBytes(ct)},writeFixed32Field:function(je,ct){this.writeTag(je,Jt.Fixed32),this.writeFixed32(ct)},writeSFixed32Field:function(je,ct){this.writeTag(je,Jt.Fixed32),this.writeSFixed32(ct)},writeFixed64Field:function(je,ct){this.writeTag(je,Jt.Fixed64),this.writeFixed64(ct)},writeSFixed64Field:function(je,ct){this.writeTag(je,Jt.Fixed64),this.writeSFixed64(ct)},writeVarintField:function(je,ct){this.writeTag(je,Jt.Varint),this.writeVarint(ct)},writeSVarintField:function(je,ct){this.writeTag(je,Jt.Varint),this.writeSVarint(ct)},writeStringField:function(je,ct){this.writeTag(je,Jt.Bytes),this.writeString(ct)},writeFloatField:function(je,ct){this.writeTag(je,Jt.Fixed32),this.writeFloat(ct)},writeDoubleField:function(je,ct){this.writeTag(je,Jt.Fixed64),this.writeDouble(ct)},writeBooleanField:function(je,ct){this.writeVarintField(je,Boolean(ct))}}},36:function(xr){xr.exports=function(){"use strict";function Gr(et,_t,Dt,bn,Pn){!function an(Rn,nr,dr,jn,pn){for(;jn>dr;){if(jn-dr>600){var sr=jn-dr+1,qr=nr-dr+1,Es=Math.log(sr),je=.5*Math.exp(2*Es/3),ct=.5*Math.sqrt(Es*je*(sr-je)/sr)*(qr-sr/2<0?-1:1);an(Rn,nr,Math.max(dr,Math.floor(nr-qr*je/sr+ct)),Math.min(jn,Math.floor(nr+(sr-qr)*je/sr+ct)),pn)}var fr=Rn[nr],vr=dr,Er=jn;for(Ht(Rn,dr,nr),pn(Rn[jn],fr)>0&&Ht(Rn,dr,jn);vr<Er;){for(Ht(Rn,vr,Er),vr++,Er--;pn(Rn[vr],fr)<0;)vr++;for(;pn(Rn[Er],fr)>0;)Er--}0===pn(Rn[dr],fr)?Ht(Rn,dr,Er):Ht(Rn,++Er,jn),Er<=nr&&(dr=Er+1),nr<=Er&&(jn=Er-1)}}(et,_t,Dt||0,bn||et.length-1,Pn||Ut)}function Ht(et,_t,Dt){var bn=et[_t];et[_t]=et[Dt],et[Dt]=bn}function Ut(et,_t){return et<_t?-1:et>_t?1:0}var Jt=function(et){void 0===et&&(et=9),this._maxEntries=Math.max(4,et),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function L(et,_t,Dt){if(!Dt)return _t.indexOf(et);for(var bn=0;bn<_t.length;bn++)if(Dt(et,_t[bn]))return bn;return-1}function C(et,_t){ut(et,0,et.children.length,_t,et)}function ut(et,_t,Dt,bn,Pn){Pn||(Pn=Cn(null)),Pn.minX=1/0,Pn.minY=1/0,Pn.maxX=-1/0,Pn.maxY=-1/0;for(var an=_t;an<Dt;an++){var Rn=et.children[an];tn(Pn,et.leaf?bn(Rn):Rn)}return Pn}function tn(et,_t){return et.minX=Math.min(et.minX,_t.minX),et.minY=Math.min(et.minY,_t.minY),et.maxX=Math.max(et.maxX,_t.maxX),et.maxY=Math.max(et.maxY,_t.maxY),et}function Et(et,_t){return et.minX-_t.minX}function it(et,_t){return et.minY-_t.minY}function Ge(et){return(et.maxX-et.minX)*(et.maxY-et.minY)}function Ke(et){return et.maxX-et.minX+(et.maxY-et.minY)}function Wt(et,_t){return et.minX<=_t.minX&&et.minY<=_t.minY&&_t.maxX<=et.maxX&&_t.maxY<=et.maxY}function on(et,_t){return _t.minX<=et.maxX&&_t.minY<=et.maxY&&_t.maxX>=et.minX&&_t.maxY>=et.minY}function Cn(et){return{children:et,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function fn(et,_t,Dt,bn,Pn){for(var an=[_t,Dt];an.length;)if(!((Dt=an.pop())-(_t=an.pop())<=bn)){var Rn=_t+Math.ceil((Dt-_t)/bn/2)*bn;Gr(et,Rn,_t,Dt,Pn),an.push(_t,Rn,Rn,Dt)}}return Jt.prototype.all=function(){return this._all(this.data,[])},Jt.prototype.search=function(et){var _t=this.data,Dt=[];if(!on(et,_t))return Dt;for(var bn=this.toBBox,Pn=[];_t;){for(var an=0;an<_t.children.length;an++){var Rn=_t.children[an],nr=_t.leaf?bn(Rn):Rn;on(et,nr)&&(_t.leaf?Dt.push(Rn):Wt(et,nr)?this._all(Rn,Dt):Pn.push(Rn))}_t=Pn.pop()}return Dt},Jt.prototype.collides=function(et){var _t=this.data;if(!on(et,_t))return!1;for(var Dt=[];_t;){for(var bn=0;bn<_t.children.length;bn++){var Pn=_t.children[bn],an=_t.leaf?this.toBBox(Pn):Pn;if(on(et,an)){if(_t.leaf||Wt(et,an))return!0;Dt.push(Pn)}}_t=Dt.pop()}return!1},Jt.prototype.load=function(et){if(!et||!et.length)return this;if(et.length<this._minEntries){for(var _t=0;_t<et.length;_t++)this.insert(et[_t]);return this}var Dt=this._build(et.slice(),0,et.length-1,0);if(this.data.children.length)if(this.data.height===Dt.height)this._splitRoot(this.data,Dt);else{if(this.data.height<Dt.height){var bn=this.data;this.data=Dt,Dt=bn}this._insert(Dt,this.data.height-Dt.height-1,!0)}else this.data=Dt;return this},Jt.prototype.insert=function(et){return et&&this._insert(et,this.data.height-1),this},Jt.prototype.clear=function(){return this.data=Cn([]),this},Jt.prototype.remove=function(et,_t){if(!et)return this;for(var Dt,bn,Pn,an=this.data,Rn=this.toBBox(et),nr=[],dr=[];an||nr.length;){if(an||(an=nr.pop(),bn=nr[nr.length-1],Dt=dr.pop(),Pn=!0),an.leaf){var jn=L(et,an.children,_t);if(-1!==jn)return an.children.splice(jn,1),nr.push(an),this._condense(nr),this}Pn||an.leaf||!Wt(an,Rn)?bn?(Dt++,an=bn.children[Dt],Pn=!1):an=null:(nr.push(an),dr.push(Dt),Dt=0,bn=an,an=an.children[0])}return this},Jt.prototype.toBBox=function(et){return et},Jt.prototype.compareMinX=function(et,_t){return et.minX-_t.minX},Jt.prototype.compareMinY=function(et,_t){return et.minY-_t.minY},Jt.prototype.toJSON=function(){return this.data},Jt.prototype.fromJSON=function(et){return this.data=et,this},Jt.prototype._all=function(et,_t){for(var Dt=[];et;)et.leaf?_t.push.apply(_t,et.children):Dt.push.apply(Dt,et.children),et=Dt.pop();return _t},Jt.prototype._build=function(et,_t,Dt,bn){var Pn,an=Dt-_t+1,Rn=this._maxEntries;if(an<=Rn)return C(Pn=Cn(et.slice(_t,Dt+1)),this.toBBox),Pn;bn||(bn=Math.ceil(Math.log(an)/Math.log(Rn)),Rn=Math.ceil(an/Math.pow(Rn,bn-1))),(Pn=Cn([])).leaf=!1,Pn.height=bn;var nr=Math.ceil(an/Rn),dr=nr*Math.ceil(Math.sqrt(Rn));fn(et,_t,Dt,dr,this.compareMinX);for(var jn=_t;jn<=Dt;jn+=dr){var pn=Math.min(jn+dr-1,Dt);fn(et,jn,pn,nr,this.compareMinY);for(var sr=jn;sr<=pn;sr+=nr){var qr=Math.min(sr+nr-1,pn);Pn.children.push(this._build(et,sr,qr,bn-1))}}return C(Pn,this.toBBox),Pn},Jt.prototype._chooseSubtree=function(et,_t,Dt,bn){for(;bn.push(_t),!_t.leaf&&bn.length-1!==Dt;){for(var Pn=1/0,an=1/0,Rn=void 0,nr=0;nr<_t.children.length;nr++){var dr=_t.children[nr],jn=Ge(dr),pn=(sr=et,qr=dr,(Math.max(qr.maxX,sr.maxX)-Math.min(qr.minX,sr.minX))*(Math.max(qr.maxY,sr.maxY)-Math.min(qr.minY,sr.minY))-jn);pn<an?(an=pn,Pn=jn<Pn?jn:Pn,Rn=dr):pn===an&&jn<Pn&&(Pn=jn,Rn=dr)}_t=Rn||_t.children[0]}var sr,qr;return _t},Jt.prototype._insert=function(et,_t,Dt){var bn=Dt?et:this.toBBox(et),Pn=[],an=this._chooseSubtree(bn,this.data,_t,Pn);for(an.children.push(et),tn(an,bn);_t>=0&&Pn[_t].children.length>this._maxEntries;)this._split(Pn,_t),_t--;this._adjustParentBBoxes(bn,Pn,_t)},Jt.prototype._split=function(et,_t){var Dt=et[_t],bn=Dt.children.length,Pn=this._minEntries;this._chooseSplitAxis(Dt,Pn,bn);var an=this._chooseSplitIndex(Dt,Pn,bn),Rn=Cn(Dt.children.splice(an,Dt.children.length-an));Rn.height=Dt.height,Rn.leaf=Dt.leaf,C(Dt,this.toBBox),C(Rn,this.toBBox),_t?et[_t-1].children.push(Rn):this._splitRoot(Dt,Rn)},Jt.prototype._splitRoot=function(et,_t){this.data=Cn([et,_t]),this.data.height=et.height+1,this.data.leaf=!1,C(this.data,this.toBBox)},Jt.prototype._chooseSplitIndex=function(et,_t,Dt){for(var bn,Pn,an,Rn,nr,dr,jn,pn=1/0,sr=1/0,qr=_t;qr<=Dt-_t;qr++){var Es=ut(et,0,qr,this.toBBox),je=ut(et,qr,Dt,this.toBBox),ct=(Pn=Es,an=je,void 0,void 0,void 0,void 0,Rn=Math.max(Pn.minX,an.minX),nr=Math.max(Pn.minY,an.minY),dr=Math.min(Pn.maxX,an.maxX),jn=Math.min(Pn.maxY,an.maxY),Math.max(0,dr-Rn)*Math.max(0,jn-nr)),Vt=Ge(Es)+Ge(je);ct<pn?(pn=ct,bn=qr,sr=Vt<sr?Vt:sr):ct===pn&&Vt<sr&&(sr=Vt,bn=qr)}return bn||Dt-_t},Jt.prototype._chooseSplitAxis=function(et,_t,Dt){var bn=et.leaf?this.compareMinX:Et,Pn=et.leaf?this.compareMinY:it;this._allDistMargin(et,_t,Dt,bn)<this._allDistMargin(et,_t,Dt,Pn)&&et.children.sort(bn)},Jt.prototype._allDistMargin=function(et,_t,Dt,bn){et.children.sort(bn);for(var Pn=this.toBBox,an=ut(et,0,_t,Pn),Rn=ut(et,Dt-_t,Dt,Pn),nr=Ke(an)+Ke(Rn),dr=_t;dr<Dt-_t;dr++){var jn=et.children[dr];tn(an,et.leaf?Pn(jn):jn),nr+=Ke(an)}for(var pn=Dt-_t-1;pn>=_t;pn--){var sr=et.children[pn];tn(Rn,et.leaf?Pn(sr):sr),nr+=Ke(Rn)}return nr},Jt.prototype._adjustParentBBoxes=function(et,_t,Dt){for(var bn=Dt;bn>=0;bn--)tn(_t[bn],et)},Jt.prototype._condense=function(et){for(var _t=et.length-1,Dt=void 0;_t>=0;_t--)0===et[_t].children.length?_t>0?(Dt=et[_t-1].children).splice(Dt.indexOf(et[_t]),1):this.clear():C(et[_t],this.toBBox)},Jt}()},249:function(xr){(function(){var Gr;xr.exports={icon:"icons/google.svg",name:"google",title:"Google Fonts",link:"google.com/fonts",getNames:function(){return Gr},getLink:function(Ht){return"https://fonts.google.com/specimen/"+Ht.replace(/( )/g,"+")},normalizeName:function(Ht){return Ht}},Gr=["ABeeZee","Abel","Abril Fatface","Aclonica","Acme","Actor","Adamina","Advent Pro","Aguafina Script","Akronim","Aladin","Aldrich","Alef","Alegreya","Alegreya SC","Alegreya Sans","Alegreya Sans SC","Alex Brush","Alfa Slab One","Alice","Alike","Alike Angular","Allan","Allerta","Allerta Stencil","Allura","Almendra","Almendra Display","Almendra SC","Amarante","Amaranth","Amatic SC","Amethysta","Amiri","Amita","Anaheim","Andada","Andika","Angkor","Annie Use Your Telescope","Anonymous Pro","Antic","Antic Didone","Antic Slab","Anton","Arapey","Arbutus","Arbutus Slab","Architects Daughter","Archivo Black","Archivo Narrow","Arimo","Arizonia","Armata","Artifika","Arvo","Arya","Asap","Asar","Asset","Astloch","Asul","Atomic Age","Aubrey","Audiowide","Autour One","Average","Average Sans","Averia Gruesa Libre","Averia Libre","Averia Sans Libre","Averia Serif Libre","Bad Script","Balthazar","Bangers","Basic","Battambang","Baumans","Bayon","Belgrano","Belleza","BenchNine","Bentham","Berkshire Swash","Bevan","Bigelow Rules","Bigshot One","Bilbo","Bilbo Swash Caps","Biryani","Bitter","Black Ops One","Bokor","Bonbon","Boogaloo","Bowlby One","Bowlby One SC","Brawler","Bree Serif","Bubblegum Sans","Bubbler One","Buda","Buenard","Butcherman","Butterfly Kids","Cabin","Cabin Condensed","Cabin Sketch","Caesar Dressing","Cagliostro","Calligraffitti","Cambay","Cambo","Candal","Cantarell","Cantata One","Cantora One","Capriola","Cardo","Carme","Carrois Gothic","Carrois Gothic SC","Carter One","Catamaran","Caudex","Caveat","Caveat Brush","Cedarville Cursive","Ceviche One","Changa One","Chango","Chau Philomene One","Chela One","Chelsea Market","Chenla","Cherry Cream Soda","Cherry Swash","Chewy","Chicle","Chivo","Chonburi","Cinzel","Cinzel Decorative","Clicker Script","Coda","Coda Caption","Codystar","Combo","Comfortaa","Coming Soon","Concert One","Condiment","Content","Contrail One","Convergence","Cookie","Copse","Corben","Courgette","Cousine","Coustard","Covered By Your Grace","Crafty Girls","Creepster","Crete Round","Crimson Text","Croissant One","Crushed","Cuprum","Cutive","Cutive Mono","Damion","Dancing Script","Dangrek","Dawning of a New Day","Days One","Dekko","Delius","Delius Swash Caps","Delius Unicase","Della Respira","Denk One","Devonshire","Dhurjati","Didact Gothic","Diplomata","Diplomata SC","Domine","Donegal One","Doppio One","Dorsa","Dosis","Dr Sugiyama","Droid Sans","Droid Sans Mono","Droid Serif","Duru Sans","Dynalight","EB Garamond","Eagle Lake","Eater","Economica","Eczar","Ek Mukta","Electrolize","Elsie","Elsie Swash Caps","Emblema One","Emilys Candy","Engagement","Englebert","Enriqueta","Erica One","Esteban","Euphoria Script","Ewert","Exo","Exo 2","Expletus Sans","Fanwood Text","Fascinate","Fascinate Inline","Faster One","Fasthand","Fauna One","Federant","Federo","Felipa","Fenix","Finger Paint","Fira Mono","Fira Sans","Fjalla One","Fjord One","Flamenco","Flavors","Fondamento","Fontdiner Swanky","Forum","Francois One","Freckle Face","Fredericka the Great","Fredoka One","Freehand","Fresca","Frijole","Fruktur","Fugaz One","GFS Didot","GFS Neohellenic","Gabriela","Gafata","Galdeano","Galindo","Gentium Basic","Gentium Book Basic","Geo","Geostar","Geostar Fill","Germania One","Gidugu","Gilda Display","Give You Glory","Glass Antiqua","Glegoo","Gloria Hallelujah","Goblin One","Gochi Hand","Gorditas","Goudy Bookletter 1911","Graduate","Grand Hotel","Gravitas One","Great Vibes","Griffy","Gruppo","Gudea","Gurajada","Habibi","Halant","Hammersmith One","Hanalei","Hanalei Fill","Handlee","Hanuman","Happy Monkey","Headland One","Henny Penny","Herr Von Muellerhoff","Hind","Hind Siliguri","Hind Vadodara","Holtwood One SC","Homemade Apple","Homenaje","IM Fell DW Pica","IM Fell DW Pica SC","IM Fell Double Pica","IM Fell Double Pica SC","IM Fell English","IM Fell English SC","IM Fell French Canon","IM Fell French Canon SC","IM Fell Great Primer","IM Fell Great Primer SC","Iceberg","Iceland","Imprima","Inconsolata","Inder","Indie Flower","Inika","Inknut Antiqua","Irish Grover","Istok Web","Italiana","Italianno","Itim","Jacques Francois","Jacques Francois Shadow","Jaldi","Jim Nightshade","Jockey One","Jolly Lodger","Josefin Sans","Josefin Slab","Joti One","Judson","Julee","Julius Sans One","Junge","Jura","Just Another Hand","Just Me Again Down Here","Kadwa","Kalam","Kameron","Kantumruy","Karla","Karma","Kaushan Script","Kavoon","Kdam Thmor","Keania One","Kelly Slab","Kenia","Khand","Khmer","Khula","Kite One","Knewave","Kotta One","Koulen","Kranky","Kreon","Kristi","Krona One","Kurale","La Belle Aurore","Laila","Lakki Reddy","Lancelot","Lateef","Lato","League Script","Leckerli One","Ledger","Lekton","Lemon","Libre Baskerville","Life Savers","Lilita One","Lily Script One","Limelight","Linden Hill","Lobster","Lobster Two","Londrina Outline","Londrina Shadow","Londrina Sketch","Londrina Solid","Lora","Love Ya Like A Sister","Loved by the King","Lovers Quarrel","Luckiest Guy","Lusitana","Lustria","Macondo","Macondo Swash Caps","Magra","Maiden Orange","Mako","Mallanna","Mandali","Marcellus","Marcellus SC","Marck Script","Margarine","Marko One","Marmelad","Martel","Martel Sans","Marvel","Mate","Mate SC","Maven Pro","McLaren","Meddon","MedievalSharp","Medula One","Megrim","Meie Script","Merienda","Merienda One","Merriweather","Merriweather Sans","Metal","Metal Mania","Metamorphous","Metrophobic","Michroma","Milonga","Miltonian","Miltonian Tattoo","Miniver","Miss Fajardose","Modak","Modern Antiqua","Molengo","Molle","Monda","Monofett","Monoton","Monsieur La Doulaise","Montaga","Montez","Montserrat","Montserrat Alternates","Montserrat Subrayada","Moul","Moulpali","Mountains of Christmas","Mouse Memoirs","Mr Bedfort","Mr Dafoe","Mr De Haviland","Mrs Saint Delafield","Mrs Sheppards","Muli","Mystery Quest","NTR","Neucha","Neuton","New Rocker","News Cycle","Niconne","Nixie One","Nobile","Nokora","Norican","Nosifer","Nothing You Could Do","Noticia Text","Noto Sans","Noto Serif","Nova Cut","Nova Flat","Nova Mono","Nova Oval","Nova Round","Nova Script","Nova Slim","Nova Square","Numans","Nunito","Odor Mean Chey","Offside","Old Standard TT","Oldenburg","Oleo Script","Oleo Script Swash Caps","Open Sans","Open Sans Condensed","Oranienbaum","Orbitron","Oregano","Orienta","Original Surfer","Oswald","Over the Rainbow","Overlock","Overlock SC","Ovo","Oxygen","Oxygen Mono","PT Mono","PT Sans","PT Sans Caption","PT Sans Narrow","PT Serif","PT Serif Caption","Pacifico","Palanquin","Palanquin Dark","Paprika","Parisienne","Passero One","Passion One","Pathway Gothic One","Patrick Hand","Patrick Hand SC","Patua One","Paytone One","Peddana","Peralta","Permanent Marker","Petit Formal Script","Petrona","Philosopher","Piedra","Pinyon Script","Pirata One","Plaster","Play","Playball","Playfair Display","Playfair Display SC","Podkova","Poiret One","Poller One","Poly","Pompiere","Pontano Sans","Poppins","Port Lligat Sans","Port Lligat Slab","Pragati Narrow","Prata","Preahvihear","Press Start 2P","Princess Sofia","Prociono","Prosto One","Puritan","Purple Purse","Quando","Quantico","Quattrocento","Quattrocento Sans","Questrial","Quicksand","Quintessential","Qwigley","Racing Sans One","Radley","Rajdhani","Raleway","Raleway Dots","Ramabhadra","Ramaraja","Rambla","Rammetto One","Ranchers","Rancho","Ranga","Rationale","Ravi Prakash","Redressed","Reenie Beanie","Revalia","Rhodium Libre","Ribeye","Ribeye Marrow","Righteous","Risque","Roboto","Roboto Condensed","Roboto Mono","Roboto Slab","Rochester","Rock Salt","Rokkitt","Romanesco","Ropa Sans","Rosario","Rosarivo","Rouge Script","Rozha One","Rubik","Rubik Mono One","Rubik One","Ruda","Rufina","Ruge Boogie","Ruluko","Rum Raisin","Ruslan Display","Russo One","Ruthie","Rye","Sacramento","Sahitya","Sail","Salsa","Sanchez","Sancreek","Sansita One","Sarala","Sarina","Sarpanch","Satisfy","Scada","Scheherazade","Schoolbell","Seaweed Script","Sevillana","Seymour One","Shadows Into Light","Shadows Into Light Two","Shanti","Share","Share Tech","Share Tech Mono","Shojumaru","Short Stack","Siemreap","Sigmar One","Signika","Signika Negative","Simonetta","Sintony","Sirin Stencil","Six Caps","Skranji","Slabo 13px","Slabo 27px","Slackey","Smokum","Smythe","Sniglet","Snippet","Snowburst One","Sofadi One","Sofia","Sonsie One","Sorts Mill Goudy","Source Code Pro","Source Sans Pro","Source Serif Pro","Special Elite","Spicy Rice","Spinnaker","Spirax","Squada One","Sree Krushnadevaraya","Stalemate","Stalinist One","Stardos Stencil","Stint Ultra Condensed","Stint Ultra Expanded","Stoke","Strait","Sue Ellen Francisco","Sumana","Sunshiney","Supermercado One","Sura","Suranna","Suravaram","Suwannaphum","Swanky and Moo Moo","Syncopate","Tangerine","Taprom","Tauri","Teko","Telex","Tenali Ramakrishna","Tenor Sans","Text Me One","The Girl Next Door","Tienne","Tillana","Timmana","Tinos","Titan One","Titillium Web","Trade Winds","Trocchi","Trochut","Trykker","Tulpen One","Ubuntu","Ubuntu Condensed","Ubuntu Mono","Ultra","Uncial Antiqua","Underdog","Unica One","UnifrakturCook","UnifrakturMaguntia","Unkempt","Unlock","Unna","VT323","Vampiro One","Varela","Varela Round","Vast Shadow","Vesper Libre","Vibur","Vidaloka","Viga","Voces","Volkhov","Vollkorn","Voltaire","Waiting for the Sunrise","Wallpoet","Walter Turncoat","Warnes","Wellfleet","Wendy One","Wire One","Work Sans","Yanone Kaffeesatz","Yantramanav","Yellowtail","Yeseva One","Yesteryear","Zeyada"]}).call(this)},21:(xr,Gr,Ht)=>{"use strict";function Ut(r){return"function"==typeof r}function Jt(r){const e=r(n=>{Error.call(n),n.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const L=Jt(r=>function(e){r(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((n,i)=>`${i+1}) ${n.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function C(r,t){if(r){const e=r.indexOf(t);0<=e&&r.splice(e,1)}}class ut{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const o of e)o.remove(this);else e.remove(this);const{initialTeardown:n}=this;if(Ut(n))try{n()}catch(o){t=o instanceof L?o.errors:[o]}const{_teardowns:i}=this;if(i){this._teardowns=null;for(const o of i)try{it(o)}catch(u){t=null!=t?t:[],u instanceof L?t=[...t,...u.errors]:t.push(u)}}if(t)throw new L(t)}}add(t){var e;if(t&&t!==this)if(this.closed)it(t);else{if(t instanceof ut){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._teardowns=null!==(e=this._teardowns)&&void 0!==e?e:[]).push(t)}}_hasParent(t){const{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){const{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&C(e,t)}remove(t){const{_teardowns:e}=this;e&&C(e,t),t instanceof ut&&t._removeParent(this)}}ut.EMPTY=(()=>{const r=new ut;return r.closed=!0,r})();const tn=ut.EMPTY;function Et(r){return r instanceof ut||r&&"closed"in r&&Ut(r.remove)&&Ut(r.add)&&Ut(r.unsubscribe)}function it(r){Ut(r)?r():r.unsubscribe()}const Ge={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ke={setTimeout(...r){const{delegate:t}=Ke;return((null==t?void 0:t.setTimeout)||setTimeout)(...r)},clearTimeout(r){const{delegate:t}=Ke;return((null==t?void 0:t.clearTimeout)||clearTimeout)(r)},delegate:void 0};function Wt(r){Ke.setTimeout(()=>{const{onUnhandledError:t}=Ge;if(!t)throw r;t(r)})}function on(){}const Cn=_t("C",void 0,void 0);function _t(r,t,e){return{kind:r,value:t,error:e}}let Dt=null;function bn(r){if(Ge.useDeprecatedSynchronousErrorHandling){const t=!Dt;if(t&&(Dt={errorThrown:!1,error:null}),r(),t){const{errorThrown:e,error:n}=Dt;if(Dt=null,e)throw n}}else r()}class an extends ut{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,Et(t)&&t.add(this)):this.destination=pn}static create(t,e,n){return new Rn(t,e,n)}next(t){this.isStopped?jn(_t("N",t,void 0),this):this._next(t)}error(t){this.isStopped?jn(_t("E",void 0,t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?jn(Cn,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}class Rn extends an{constructor(t,e,n){let i;if(super(),Ut(t))i=t;else if(t){let o;({next:i,error:e,complete:n}=t),this&&Ge.useDeprecatedNextContext?(o=Object.create(t),o.unsubscribe=()=>this.unsubscribe()):o=t,i=null==i?void 0:i.bind(o),e=null==e?void 0:e.bind(o),n=null==n?void 0:n.bind(o)}this.destination={next:i?nr(i):on,error:nr(null!=e?e:dr),complete:n?nr(n):on}}}function nr(r,t){return(...e)=>{try{r(...e)}catch(n){Ge.useDeprecatedSynchronousErrorHandling?function(r){Ge.useDeprecatedSynchronousErrorHandling&&Dt&&(Dt.errorThrown=!0,Dt.error=r)}(n):Wt(n)}}}function dr(r){throw r}function jn(r,t){const{onStoppedNotification:e}=Ge;e&&Ke.setTimeout(()=>e(r,t))}const pn={closed:!0,next:on,error:dr,complete:on},sr="function"==typeof Symbol&&Symbol.observable||"@@observable";function qr(r){return r}let ct=(()=>{class r{constructor(e){e&&(this._subscribe=e)}lift(e){const n=new r;return n.source=this,n.operator=e,n}subscribe(e,n,i){const o=function(r){return r&&r instanceof an||function(r){return r&&Ut(r.next)&&Ut(r.error)&&Ut(r.complete)}(r)&&Et(r)}(e)?e:new Rn(e,n,i);return bn(()=>{const{operator:u,source:m}=this;o.add(u?u.call(o,m):m?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(e){try{return this._subscribe(e)}catch(n){e.error(n)}}forEach(e,n){return new(n=Vt(n))((i,o)=>{let u;u=this.subscribe(m=>{try{e(m)}catch(b){o(b),null==u||u.unsubscribe()}},o,i)})}_subscribe(e){var n;return null===(n=this.source)||void 0===n?void 0:n.subscribe(e)}[sr](){return this}pipe(...e){return function(r){return 0===r.length?qr:1===r.length?r[0]:function(e){return r.reduce((n,i)=>i(n),e)}}(e)(this)}toPromise(e){return new(e=Vt(e))((n,i)=>{let o;this.subscribe(u=>o=u,u=>i(u),()=>n(o))})}}return r.create=t=>new r(t),r})();function Vt(r){var t;return null!==(t=null!=r?r:Ge.Promise)&&void 0!==t?t:Promise}const vr=Jt(r=>function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Er=(()=>{class r extends ct{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const n=new Ui(this,this);return n.operator=e,n}_throwIfClosed(){if(this.closed)throw new vr}next(e){bn(()=>{if(this._throwIfClosed(),!this.isStopped){const n=this.observers.slice();for(const i of n)i.next(e)}})}error(e){bn(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:n}=this;for(;n.length;)n.shift().error(e)}})}complete(){bn(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:n,isStopped:i,observers:o}=this;return n||i?tn:(o.push(e),new ut(()=>C(o,e)))}_checkFinalizedStatuses(e){const{hasError:n,thrownError:i,isStopped:o}=this;n?e.error(i):o&&e.complete()}asObservable(){const e=new ct;return e.source=this,e}}return r.create=(t,e)=>new Ui(t,e),r})();class Ui extends Er{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===n||n.call(e,t)}error(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===n||n.call(e,t)}complete(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)}_subscribe(t){var e,n;return null!==(n=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==n?n:tn}}function Wo(r){return Ut(null==r?void 0:r.lift)}function Xi(r){return t=>{if(Wo(t))return t.lift(function(e){try{return r(e,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}class Vi extends an{constructor(t,e,n,i,o){super(t),this.onFinalize=o,this._next=e?function(u){try{e(u)}catch(m){t.error(m)}}:super._next,this._error=i?function(u){try{i(u)}catch(m){t.error(m)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(u){t.error(u)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;const{closed:e}=this;super.unsubscribe(),!e&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}function Zr(r,t){return Xi((e,n)=>{let i=0;e.subscribe(new Vi(n,o=>{n.next(r.call(t,o,i++))}))})}function Na(r){return this instanceof Na?(this.v=r,this):new Na(r)}function la(r,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,n=e.apply(r,t||[]),o=[];return i={},u("next"),u("throw"),u("return"),i[Symbol.asyncIterator]=function(){return this},i;function u(H){n[H]&&(i[H]=function(J){return new Promise(function(ne,we){o.push([H,J,ne,we])>1||m(H,J)})})}function m(H,J){try{!function(H){H.value instanceof Na?Promise.resolve(H.value.v).then(T,F):V(o[0][2],H)}(n[H](J))}catch(ne){V(o[0][3],ne)}}function T(H){m("next",H)}function F(H){m("throw",H)}function V(H,J){H(J),o.shift(),o.length&&m(o[0][0],o[0][1])}}function Uh(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=r[Symbol.asyncIterator];return t?t.call(r):(r=function(r){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&r[t],n=0;if(e)return e.call(r);if(r&&"number"==typeof r.length)return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(r),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(o){e[o]=r[o]&&function(u){return new Promise(function(m,b){!function(o,u,m,b){Promise.resolve(b).then(function(T){o({value:T,done:m})},u)}(m,b,(u=r[o](u)).done,u.value)})}}}const Qu=r=>r&&"number"==typeof r.length&&"function"!=typeof r;function Mc(r){return Ut(null==r?void 0:r.then)}function Ss(r){return Ut(r[sr])}function Qc(r){return Symbol.asyncIterator&&Ut(null==r?void 0:r[Symbol.asyncIterator])}function Nu(r){return new TypeError(`You provided ${null!==r&&"object"==typeof r?"an invalid object":`'${r}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Bs="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function Kl(r){return Ut(null==r?void 0:r[Bs])}function Jl(r){return la(this,arguments,function*(){const e=r.getReader();try{for(;;){const{value:n,done:i}=yield Na(e.read());if(i)return yield Na(void 0);yield yield Na(n)}}finally{e.releaseLock()}})}function Ll(r){return Ut(null==r?void 0:r.getReader)}function Da(r){if(r instanceof ct)return r;if(null!=r){if(Ss(r))return function(r){return new ct(t=>{const e=r[sr]();if(Ut(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(r);if(Qu(r))return function(r){return new ct(t=>{for(let e=0;e<r.length&&!t.closed;e++)t.next(r[e]);t.complete()})}(r);if(Mc(r))return function(r){return new ct(t=>{r.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,Wt)})}(r);if(Qc(r))return se(r);if(Kl(r))return function(r){return new ct(t=>{for(const e of r)if(t.next(e),t.closed)return;t.complete()})}(r);if(Ll(r))return function(r){return se(Jl(r))}(r)}throw Nu(r)}function se(r){return new ct(t=>{(function(r,t){var e,n,i,o;return function(r,t,e,n){return new(e||(e=Promise))(function(o,u){function m(F){try{T(n.next(F))}catch(V){u(V)}}function b(F){try{T(n.throw(F))}catch(V){u(V)}}function T(F){F.done?o(F.value):function(o){return o instanceof e?o:new e(function(u){u(o)})}(F.value).then(m,b)}T((n=n.apply(r,t||[])).next())})}(this,void 0,void 0,function*(){try{for(e=Uh(r);!(n=yield e.next()).done;)if(t.next(n.value),t.closed)return}catch(u){i={error:u}}finally{try{n&&!n.done&&(o=e.return)&&(yield o.call(e))}finally{if(i)throw i.error}}t.complete()})})(r,t).catch(e=>t.error(e))})}function me(r,t,e,n=0,i=!1){const o=t.schedule(function(){e(),i?r.add(this.schedule(null,n)):this.unsubscribe()},n);if(r.add(o),!i)return o}function pe(r,t,e=1/0){return Ut(t)?pe((n,i)=>Zr((o,u)=>t(n,o,i,u))(Da(r(n,i))),e):("number"==typeof t&&(e=t),Xi((n,i)=>function(r,t,e,n,i,o,u,m){const b=[];let T=0,F=0,V=!1;const H=()=>{V&&!b.length&&!T&&t.complete()},J=we=>T<n?ne(we):b.push(we),ne=we=>{T++;let Re=!1;Da(e(we,F++)).subscribe(new Vi(t,qe=>{t.next(qe)},()=>{Re=!0},void 0,()=>{if(Re)try{for(T--;b.length&&T<n;){const qe=b.shift();ne(qe)}H()}catch(qe){t.error(qe)}}))};return r.subscribe(new Vi(t,J,()=>{V=!0,H()})),()=>{}}(n,i,r,e)))}function Se(r=1/0){return pe(qr,r)}const He=new ct(r=>r.complete());function lt(r){return r&&Ut(r.schedule)}function Rt(r){return r[r.length-1]}function xt(r){return Ut(Rt(r))?r.pop():void 0}function Xt(r){return lt(Rt(r))?r.pop():void 0}function Je(r,t=0){return Xi((e,n)=>{e.subscribe(new Vi(n,i=>me(n,r,()=>n.next(i),t),()=>me(n,r,()=>n.complete(),t),i=>me(n,r,()=>n.error(i),t)))})}function ot(r,t=0){return Xi((e,n)=>{n.add(r.schedule(()=>e.subscribe(n),t))})}function Ft(r,t){if(!r)throw new Error("Iterable cannot be null");return new ct(e=>{me(e,t,()=>{const n=r[Symbol.asyncIterator]();me(e,t,()=>{n.next().then(i=>{i.done?e.complete():e.next(i.value)})},0,!0)})})}function qt(r,t){return t?function(r,t){if(null!=r){if(Ss(r))return function(r,t){return Da(r).pipe(ot(t),Je(t))}(r,t);if(Qu(r))return function(r,t){return new ct(e=>{let n=0;return t.schedule(function(){n===r.length?e.complete():(e.next(r[n++]),e.closed||this.schedule())})})}(r,t);if(Mc(r))return function(r,t){return Da(r).pipe(ot(t),Je(t))}(r,t);if(Qc(r))return Ft(r,t);if(Kl(r))return function(r,t){return new ct(e=>{let n;return me(e,t,()=>{n=r[Bs](),me(e,t,()=>{let i,o;try{({value:i,done:o}=n.next())}catch(u){return void e.error(u)}o?e.complete():e.next(i)},0,!0)}),()=>Ut(null==n?void 0:n.return)&&n.return()})}(r,t);if(Ll(r))return function(r,t){return Ft(Jl(r),t)}(r,t)}throw Nu(r)}(r,t):Da(r)}function wn(r){return r<=0?()=>He:Xi((t,e)=>{let n=0;t.subscribe(new Vi(e,i=>{++n<=r&&(e.next(i),r<=n&&e.complete())}))})}function Yr(r,t,...e){return!0===t?(r(),null):!1===t?null:t(...e).pipe(wn(1)).subscribe(()=>r())}function lr(r){for(let t in r)if(r[t]===lr)return t;throw Error("Could not find renamed property on target object.")}function ni(r,t){for(const e in t)t.hasOwnProperty(e)&&!r.hasOwnProperty(e)&&(r[e]=t[e])}function Kr(r){if("string"==typeof r)return r;if(Array.isArray(r))return"["+r.map(Kr).join(", ")+"]";if(null==r)return""+r;if(r.overriddenName)return`${r.overriddenName}`;if(r.name)return`${r.name}`;const t=r.toString();if(null==t)return""+t;const e=t.indexOf("\n");return-1===e?t:t.substring(0,e)}function yo(r,t){return null==r||""===r?null===t?"":t:null==t||""===t?r:r+" "+t}const Ro=lr({__forward_ref__:lr});function gi(r){return r.__forward_ref__=gi,r.toString=function(){return Kr(this())},r}function fi(r){return function(r){return"function"==typeof r&&r.hasOwnProperty(Ro)&&r.__forward_ref__===gi}(r)?r():r}class Fr extends Error{constructor(t,e){super(function(r,t){return`${r?`NG0${r}: `:""}${t}`}(t,e)),this.code=t}}function Mn(r){return"string"==typeof r?r:null==r?"":String(r)}function Ai(r){return"function"==typeof r?r.name||r.toString():"object"==typeof r&&null!=r&&"function"==typeof r.type?r.type.name||r.type.toString():Mn(r)}function Ts(r,t){const e=t?` in ${t}`:"";throw new Fr("201",`No provider for ${Ai(r)} found${e}`)}function Yi(r,t){null==r&&function(r,t,e,n){throw new Error(`ASSERTION ERROR: ${r}`+(null==n?"":` [Expected=> ${e} ${n} ${t} <=Actual]`))}(t,r,null,"!=")}function Hr(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function io(r){return{providers:r.providers||[],imports:r.imports||[]}}function Fl(r){return up(r,wa)||up(r,qh)}function up(r,t){return r.hasOwnProperty(t)?r[t]:null}function kc(r){return r&&(r.hasOwnProperty(ca)||r.hasOwnProperty(wh))?r[ca]:null}const wa=lr({\u0275prov:lr}),ca=lr({\u0275inj:lr}),qh=lr({ngInjectableDef:lr}),wh=lr({ngInjectorDef:lr});var oi=(()=>((oi=oi||{})[oi.Default=0]="Default",oi[oi.Host=1]="Host",oi[oi.Self=2]="Self",oi[oi.SkipSelf=4]="SkipSelf",oi[oi.Optional=8]="Optional",oi))();let nc;function eu(r){const t=nc;return nc=r,t}function Li(r,t,e){const n=Fl(r);return n&&"root"==n.providedIn?void 0===n.value?n.value=n.factory():n.value:e&oi.Optional?null:void 0!==t?t:void Ts(Kr(r),"Injector")}function Bu(r){return{toString:r}.toString()}var Is=(()=>((Is=Is||{})[Is.OnPush=0]="OnPush",Is[Is.Default=1]="Default",Is))(),ii=(()=>{return(r=ii||(ii={}))[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",ii;var r})();const th="undefined"!=typeof globalThis&&globalThis,ka="undefined"!=typeof window&&window,Zh="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Di=th||"undefined"!=typeof global&&global||ka||Zh,ya={},uo=[],yu=lr({\u0275cmp:lr}),tu=lr({\u0275dir:lr}),Th=lr({\u0275pipe:lr}),Oo=lr({\u0275mod:lr}),bl=lr({\u0275fac:lr}),Pc=lr({__NG_ELEMENT_ID__:lr});let ju=0;function eo(r){return Bu(()=>{const e={},n={type:r.type,providersResolver:null,decls:r.decls,vars:r.vars,factory:null,template:r.template||null,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:e,inputs:null,outputs:null,exportAs:r.exportAs||null,onPush:r.changeDetection===Is.OnPush,directiveDefs:null,pipeDefs:null,selectors:r.selectors||uo,viewQuery:r.viewQuery||null,features:r.features||null,data:r.data||{},encapsulation:r.encapsulation||ii.Emulated,id:"c",styles:r.styles||uo,_:null,setInput:null,schemas:r.schemas||null,tView:null},i=r.directives,o=r.features,u=r.pipes;return n.id+=ju++,n.inputs=Hh(r.inputs,e),n.outputs=Hh(r.outputs),o&&o.forEach(m=>m(n)),n.directiveDefs=i?()=>("function"==typeof i?i():i).map(zl):null,n.pipeDefs=u?()=>("function"==typeof u?u():u).map(nd):null,n})}function zl(r){return Ca(r)||function(r){return r[tu]||null}(r)}function nd(r){return function(r){return r[Th]||null}(r)}const nu={};function Gi(r){return Bu(()=>{const t={type:r.type,bootstrap:r.bootstrap||uo,declarations:r.declarations||uo,imports:r.imports||uo,exports:r.exports||uo,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null};return null!=r.id&&(nu[r.id]=r.type),t})}function Hh(r,t){if(null==r)return ya;const e={};for(const n in r)if(r.hasOwnProperty(n)){let i=r[n],o=i;Array.isArray(i)&&(o=i[1],i=i[0]),e[i]=n,t&&(t[i]=o)}return e}const Pa=eo;function Ms(r){return{type:r.type,name:r.name,factory:null,pure:!1!==r.pure,onDestroy:r.type.prototype.ngOnDestroy||null}}function Ca(r){return r[yu]||null}function Ks(r,t){const e=r[Oo]||null;if(!e&&!0===t)throw new Error(`Type ${Kr(r)} does not have '\u0275mod' property.`);return e}function Cl(r){return Array.isArray(r)&&"object"==typeof r[1]}function us(r){return Array.isArray(r)&&!0===r[1]}function nh(r){return 0!=(8&r.flags)}function Wh(r){return 2==(2&r.flags)}function jl(r){return 1==(1&r.flags)}function cs(r){return null!==r.template}function El(r){return 0!=(512&r[2])}function Ds(r,t){return r.hasOwnProperty(bl)?r[bl]:null}class Ua{constructor(t,e,n){this.previousValue=t,this.currentValue=e,this.firstChange=n}isFirstChange(){return this.firstChange}}function Lo(){return bu}function bu(r){return r.type.prototype.ngOnChanges&&(r.setInput=er),qs}function qs(){const r=Mh(this),t=null==r?void 0:r.current;if(t){const e=r.previous;if(e===ya)r.previous=t;else for(let n in t)e[n]=t[n];r.current=null,this.ngOnChanges(t)}}function er(r,t,e,n){const i=Mh(r)||function(r,t){return r[rh]=t}(r,{previous:ya,current:null}),o=i.current||(i.current={}),u=i.previous,m=this.declaredInputs[e],b=u[m];o[m]=new Ua(b&&b.currentValue,t,u===ya),r[n]=t}Lo.ngInherit=!0;const rh="__ngSimpleChanges__";function Mh(r){return r[rh]||null}const Tl="http://www.w3.org/2000/svg";let Js;function to(r){return!!r.listen}const ih={createRenderer:(r,t)=>void 0!==Js?Js:"undefined"!=typeof document?document:void 0};function Vr(r){for(;Array.isArray(r);)r=r[0];return r}function ps(r,t){return Vr(t[r])}function Ja(r,t){return Vr(t[r.index])}function Wu(r,t){return r.data[t]}function ds(r,t){return r[t]}function ta(r,t){const e=t[r];return Cl(e)?e:e[0]}function Un(r){return 4==(4&r[2])}function Nr(r){return 128==(128&r[2])}function Ps(r,t){return null==t?null:r[t]}function $u(r){r[18]=0}function Rs(r,t){r[5]+=t;let e=r,n=r[3];for(;null!==n&&(1===t&&1===e[5]||-1===t&&0===e[5]);)n[5]+=t,e=n,n=n[3]}const Lr={lFrame:B(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function pp(){return Lr.bindingsEnabled}function gn(){return Lr.lFrame.lView}function Ni(){return Lr.lFrame.tView}function Rr(r){return Lr.lFrame.contextLView=r,r[8]}function jo(){let r=Fc();for(;null!==r&&64===r.type;)r=r.parent;return r}function Fc(){return Lr.lFrame.currentTNode}function Su(r,t){const e=Lr.lFrame;e.currentTNode=r,e.isParent=t}function hc(){return Lr.lFrame.isParent}function pc(){Lr.lFrame.isParent=!1}function fs(){return Lr.isInCheckNoChangesMode}function sh(r){Lr.isInCheckNoChangesMode=r}function au(){return Lr.lFrame.bindingIndex++}function Qs(r){const t=Lr.lFrame,e=t.bindingIndex;return t.bindingIndex=t.bindingIndex+r,e}function w(r,t){const e=Lr.lFrame;e.bindingIndex=e.bindingRootIndex=r,I(t)}function I(r){Lr.lFrame.currentDirectiveIndex=r}function f(){return Lr.lFrame.currentQueryIndex}function l(r){Lr.lFrame.currentQueryIndex=r}function d(r){const t=r[1];return 2===t.type?t.declTNode:1===t.type?r[6]:null}function x(r,t,e){if(e&oi.SkipSelf){let i=t,o=r;for(;!(i=i.parent,null!==i||e&oi.Host||(i=d(o),null===i||(o=o[15],10&i.type))););if(null===i)return!1;t=i,r=o}const n=Lr.lFrame=D();return n.currentTNode=t,n.lView=r,!0}function M(r){const t=D(),e=r[1];Lr.lFrame=t,t.currentTNode=e.firstChild,t.lView=r,t.tView=e,t.contextLView=r,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function D(){const r=Lr.lFrame,t=null===r?null:r.child;return null===t?B(r):t}function B(r){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return null!==r&&(r.child=t),t}function G(){const r=Lr.lFrame;return Lr.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}const W=G;function Y(){const r=G();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function le(){return Lr.lFrame.selectedIndex}function de(r){Lr.lFrame.selectedIndex=r}function ge(){const r=Lr.lFrame;return Wu(r.tView,r.selectedIndex)}function Ue(r,t){for(let e=t.directiveStart,n=t.directiveEnd;e<n;e++){const o=r.data[e].type.prototype,{ngAfterContentInit:u,ngAfterContentChecked:m,ngAfterViewInit:b,ngAfterViewChecked:T,ngOnDestroy:F}=o;u&&(r.contentHooks||(r.contentHooks=[])).push(-e,u),m&&((r.contentHooks||(r.contentHooks=[])).push(e,m),(r.contentCheckHooks||(r.contentCheckHooks=[])).push(e,m)),b&&(r.viewHooks||(r.viewHooks=[])).push(-e,b),T&&((r.viewHooks||(r.viewHooks=[])).push(e,T),(r.viewCheckHooks||(r.viewCheckHooks=[])).push(e,T)),null!=F&&(r.destroyHooks||(r.destroyHooks=[])).push(e,F)}}function Ye(r,t,e){Ot(r,t,3,e)}function yt(r,t,e,n){(3&r[2])===e&&Ot(r,t,e,n)}function gt(r,t){let e=r[2];(3&e)===t&&(e&=2047,e+=1,r[2]=e)}function Ot(r,t,e,n){const o=null!=n?n:-1,u=t.length-1;let m=0;for(let b=void 0!==n?65535&r[18]:0;b<u;b++)if("number"==typeof t[b+1]){if(m=t[b],null!=n&&m>=n)break}else t[b]<0&&(r[18]+=65536),(m<o||-1==o)&&(dt(r,e,t,b),r[18]=(4294901760&r[18])+b+2),b++}function dt(r,t,e,n){const i=e[n]<0,o=e[n+1],m=r[i?-e[n]:e[n]];if(i){if(r[2]>>11<r[18]>>16&&(3&r[2])===t){r[2]+=2048;try{o.call(m)}finally{}}}else try{o.call(m)}finally{}}class wt{constructor(t,e,n){this.factory=t,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=n}}function tr(r,t,e){const n=to(r);let i=0;for(;i<e.length;){const o=e[i];if("number"==typeof o){if(0!==o)break;i++;const u=e[i++],m=e[i++],b=e[i++];n?r.setAttribute(t,m,b,u):t.setAttributeNS(u,m,b)}else{const u=o,m=e[++i];Wr(u)?n&&r.setProperty(t,u,m):n?r.setAttribute(t,u,m):t.setAttribute(u,m),i++}}return i}function Cr(r){return 3===r||4===r||6===r}function Wr(r){return 64===r.charCodeAt(0)}function Zi(r,t){if(null!==t&&0!==t.length)if(null===r||0===r.length)r=t.slice();else{let e=-1;for(let n=0;n<t.length;n++){const i=t[n];"number"==typeof i?e=i:0===e||ha(r,e,i,null,-1===e||2===e?t[++n]:null)}}return r}function ha(r,t,e,n,i){let o=0,u=r.length;if(-1===t)u=-1;else for(;o<r.length;){const m=r[o++];if("number"==typeof m){if(m===t){u=-1;break}if(m>t){u=o-1;break}}}for(;o<r.length;){const m=r[o];if("number"==typeof m)break;if(m===e){if(null===n)return void(null!==i&&(r[o+1]=i));if(n===r[o+1])return void(r[o+2]=i)}o++,null!==n&&o++,null!==i&&o++}-1!==u&&(r.splice(u,0,t),o=u+1),r.splice(o++,0,e),null!==n&&r.splice(o++,0,n),null!==i&&r.splice(o++,0,i)}function Do(r){return-1!==r}function xo(r){return 32767&r}function va(r,t){let e=function(r){return r>>16}(r),n=t;for(;e>0;)n=n[15],e--;return n}let Tu=!0;function O(r){const t=Tu;return Tu=r,t}let he=0;function Ie(r,t){const e=at(r,t);if(-1!==e)return e;const n=t[1];n.firstCreatePass&&(r.injectorIndex=t.length,Fe(n.data,r),Fe(t,null),Fe(n.blueprint,null));const i=nt(r,t),o=r.injectorIndex;if(Do(i)){const u=xo(i),m=va(i,t),b=m[1].data;for(let T=0;T<8;T++)t[o+T]=m[u+T]|b[u+T]}return t[o+8]=i,o}function Fe(r,t){r.push(0,0,0,0,0,0,0,0,t)}function at(r,t){return-1===r.injectorIndex||r.parent&&r.parent.injectorIndex===r.injectorIndex||null===t[r.injectorIndex+8]?-1:r.injectorIndex}function nt(r,t){if(r.parent&&-1!==r.parent.injectorIndex)return r.parent.injectorIndex;let e=0,n=null,i=t;for(;null!==i;){const o=i[1],u=o.type;if(n=2===u?o.declTNode:1===u?i[6]:null,null===n)return-1;if(e++,i=i[15],-1!==n.injectorIndex)return n.injectorIndex|e<<16}return-1}function jt(r,t,e){!function(r,t,e){let n;"string"==typeof e?n=e.charCodeAt(0)||0:e.hasOwnProperty(Pc)&&(n=e[Pc]),null==n&&(n=e[Pc]=he++);const i=255&n;t.data[r+(i>>5)]|=1<<i}(r,t,e)}function cn(r,t,e){if(e&oi.Optional)return r;Ts(t,"NodeInjector")}function Sn(r,t,e,n){if(e&oi.Optional&&void 0===n&&(n=null),0==(e&(oi.Self|oi.Host))){const i=r[9],o=eu(void 0);try{return i?i.get(t,n,e&oi.Optional):Li(t,n,e&oi.Optional)}finally{eu(o)}}return cn(n,t,e)}function ar(r,t,e,n=oi.Default,i){if(null!==r){const o=function(r){if("string"==typeof r)return r.charCodeAt(0)||0;const t=r.hasOwnProperty(Pc)?r[Pc]:void 0;return"number"==typeof t?t>=0?255&t:Xr:t}(e);if("function"==typeof o){if(!x(t,r,n))return n&oi.Host?cn(i,e,n):Sn(t,e,n,i);try{const u=o(n);if(null!=u||n&oi.Optional)return u;Ts(e)}finally{W()}}else if("number"==typeof o){let u=null,m=at(r,t),b=-1,T=n&oi.Host?t[16][6]:null;for((-1===m||n&oi.SkipSelf)&&(b=-1===m?nt(r,t):t[m+8],-1!==b&&ei(n,!1)?(u=t[1],m=xo(b),t=va(b,t)):m=-1);-1!==m;){const F=t[1];if(Br(o,m,F.data)){const V=Sr(m,t,e,u,n,T);if(V!==xn)return V}b=t[m+8],-1!==b&&ei(n,t[1].data[m+8]===T)&&Br(o,m,t)?(u=F,m=xo(b),t=va(b,t)):m=-1}}}return Sn(t,e,n,i)}const xn={};function Xr(){return new ci(jo(),gn())}function Sr(r,t,e,n,i,o){const u=t[1],m=u.data[r+8],F=en(m,u,e,null==n?Wh(m)&&Tu:n!=u&&0!=(3&m.type),i&oi.Host&&o===m);return null!==F?Vn(t,u,F,m):xn}function en(r,t,e,n,i){const o=r.providerIndexes,u=t.data,m=1048575&o,b=r.directiveStart,F=o>>20,H=i?m+F:r.directiveEnd;for(let J=n?m:m+F;J<H;J++){const ne=u[J];if(J<b&&e===ne||J>=b&&ne.type===e)return J}if(i){const J=u[b];if(J&&cs(J)&&J.type===e)return b}return null}function Vn(r,t,e,n){let i=r[e];const o=t.data;if(function(r){return r instanceof wt}(i)){const u=i;u.resolving&&function(r,t){throw new Fr("200",`Circular dependency in DI detected for ${r}`)}(Ai(o[e]));const m=O(u.canSeeViewProviders);u.resolving=!0;const b=u.injectImpl?eu(u.injectImpl):null;x(r,n,oi.Default);try{i=r[e]=u.factory(void 0,o,r,n),t.firstCreatePass&&e>=n.directiveStart&&function(r,t,e){const{ngOnChanges:n,ngOnInit:i,ngDoCheck:o}=t.type.prototype;if(n){const u=bu(t);(e.preOrderHooks||(e.preOrderHooks=[])).push(r,u),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(r,u)}i&&(e.preOrderHooks||(e.preOrderHooks=[])).push(0-r,i),o&&((e.preOrderHooks||(e.preOrderHooks=[])).push(r,o),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(r,o))}(e,o[e],t)}finally{null!==b&&eu(b),O(m),u.resolving=!1,W()}}return i}function Br(r,t,e){return!!(e[t+(r>>5)]&1<<r)}function ei(r,t){return!(r&oi.Self||r&oi.Host&&t)}class ci{constructor(t,e){this._tNode=t,this._lView=e}get(t,e,n){return ar(this._tNode,this._lView,t,n,e)}}const fc="__parameters__";function Gl(r,t,e){return Bu(()=>{const n=function(r){return function(...e){if(r){const n=r(...e);for(const i in n)this[i]=n[i]}}}(t);function i(...o){if(this instanceof i)return n.apply(this,o),this;const u=new i(...o);return m.annotation=u,m;function m(b,T,F){const V=b.hasOwnProperty(fc)?b[fc]:Object.defineProperty(b,fc,{value:[]})[fc];for(;V.length<=F;)V.push(null);return(V[F]=V[F]||[]).push(u),b}}return e&&(i.prototype=Object.create(e.prototype)),i.prototype.ngMetadataName=r,i.annotationCls=i,i})}class ao{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=Hr({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}toString(){return`InjectionToken ${this._desc}`}}const hr=new ao("AnalyzeForEntryComponents");function na(r,t){void 0===t&&(t=r);for(let e=0;e<r.length;e++){let n=r[e];Array.isArray(n)?(t===r&&(t=r.slice(0,e)),na(n,t)):t!==r&&t.push(n)}return t}function Au(r,t){r.forEach(e=>Array.isArray(e)?Au(e,t):t(e))}function Md(r,t,e){t>=r.length?r.push(e):r.splice(t,0,e)}function Zs(r,t){return t>=r.length-1?r.pop():r.splice(t,1)[0]}function Du(r,t,e){let n=Dh(r,t);return n>=0?r[1|n]=e:(n=~n,function(r,t,e,n){let i=r.length;if(i==t)r.push(e,n);else if(1===i)r.push(n,r[0]),r[0]=e;else{for(i--,r.push(r[i-1],r[i]);i>t;)r[i]=r[i-2],i--;r[t]=e,r[t+1]=n}}(r,n,t,e)),n}function wg(r,t){const e=Dh(r,t);if(e>=0)return r[1|e]}function Dh(r,t){return function(r,t,e){let n=0,i=r.length>>e;for(;i!==n;){const o=n+(i-n>>1),u=r[o<<e];if(t===u)return o<<e;u>t?i=o:n=o+1}return~(i<<e)}(r,t,1)}const uf={},Am="__NG_DI_FLAG__",Dm="ngTempTokenPath",B_=/\n/gm,my="__source",bv=lr({provide:String,useValue:lr});let zp;function Jh(r){const t=zp;return zp=r,t}function j_(r,t=oi.Default){if(void 0===zp)throw new Error("inject() must be called from an injection context");return null===zp?Li(r,void 0,t):zp.get(r,t&oi.Optional?null:void 0,t)}function Xn(r,t=oi.Default){return(nc||j_)(fi(r),t)}function kd(r){const t=[];for(let e=0;e<r.length;e++){const n=fi(r[e]);if(Array.isArray(n)){if(0===n.length)throw new Error("Arguments array must have arguments.");let i,o=oi.Default;for(let u=0;u<n.length;u++){const m=n[u],b=U_(m);"number"==typeof b?-1===b?i=m.token:o|=b:i=m}t.push(Xn(i,o))}else t.push(Xn(n))}return t}function cf(r,t){return r[Am]=t,r.prototype[Am]=t,r}function U_(r){return r[Am]}const Pm=cf(Gl("Inject",r=>({token:r})),-1),po=cf(Gl("Optional"),8),Pd=cf(Gl("SkipSelf"),4);class Ph{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function Bp(r){return r instanceof Ph?r.changingThisBreaksApplicationSecurity:r}const X_=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Tg=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var Il=(()=>((Il=Il||{})[Il.NONE=0]="NONE",Il[Il.HTML=1]="HTML",Il[Il.STYLE=2]="STYLE",Il[Il.SCRIPT=3]="SCRIPT",Il[Il.URL=4]="URL",Il[Il.RESOURCE_URL=5]="RESOURCE_URL",Il))();function qm(r){const t=function(){const r=gn();return r&&r[12]}();return t?t.sanitize(Il.URL,r)||"":function(r,t){const e=function(r){return r instanceof Ph&&r.getTypeName()||null}(r);if(null!=e&&e!==t){if("ResourceURL"===e&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${e} (see https://g.co/ng/security#xss)`)}return e===t}(r,"URL")?Bp(r):function(r){return(r=String(r)).match(X_)||r.match(Tg)?r:"unsafe:"+r}(Mn(r))}const Ld="__ngContext__";function Bc(r,t){r[Ld]=t}function Jf(r){const t=function(r){return r[Ld]||null}(r);return t?Array.isArray(t)?t:t.lView:null}function Ta(r){return r.ngOriginalError}function s0(r,...t){r.error(...t)}class em{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t),n=(r=t)&&r.ngErrorLogger||s0;var r;n(this._console,"ERROR",t),e&&n(this._console,"ORIGINAL ERROR",e)}_findOriginalError(t){let e=t&&Ta(t);for(;e&&Ta(e);)e=Ta(e);return e||null}}const Fg=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Di))();function Nd(r){return r.ownerDocument}function fo(r){return r instanceof Function?r():r}var s=(()=>((s=s||{})[s.Important=1]="Important",s[s.DashCase=2]="DashCase",s))();function g(r,t){return undefined(r,t)}function N(r){const t=r[3];return us(t)?t[3]:t}function ie(r){return ye(r[13])}function ce(r){return ye(r[4])}function ye(r){for(;null!==r&&!us(r);)r=r[4];return r}function Ae(r,t,e,n,i){if(null!=n){let o,u=!1;us(n)?o=n:Cl(n)&&(u=!0,n=n[0]);const m=Vr(n);0===r&&null!==e?null==i?Ci(t,e,m):rr(t,e,m,i||null,!0):1===r&&null!==e?rr(t,e,m,i||null,!0):2===r?function(r,t,e){const n=Tr(r,t);n&&function(r,t,e,n){to(r)?r.removeChild(t,e,n):t.removeChild(e)}(r,n,t,e)}(t,m,u):3===r&&t.destroyNode(m),null!=o&&function(r,t,e,n,i){const o=e[7];o!==Vr(e)&&Ae(t,r,n,o,i);for(let m=10;m<e.length;m++){const b=e[m];vs(b[1],b,r,t,n,o)}}(t,r,o,e,i)}}function pt(r,t,e){return to(r)?r.createElement(t,e):null===e?r.createElement(t):r.createElementNS(e,t)}function An(r,t){const e=r[9],n=e.indexOf(t),i=t[3];1024&t[2]&&(t[2]&=-1025,Rs(i,-1)),e.splice(n,1)}function zn(r,t){if(r.length<=10)return;const e=10+t,n=r[e];if(n){const i=n[17];null!==i&&i!==r&&An(i,n),t>0&&(r[e-1][4]=n[4]);const o=Zs(r,10+t);!function(r,t){vs(r,t,t[11],2,null,null),t[0]=null,t[6]=null}(n[1],n);const u=o[19];null!==u&&u.detachView(o[1]),n[3]=null,n[4]=null,n[2]&=-129}return n}function _r(r,t){if(!(256&t[2])){const e=t[11];to(e)&&e.destroyNode&&vs(r,t,e,3,null,null),function(r){let t=r[13];if(!t)return Gn(r[1],r);for(;t;){let e=null;if(Cl(t))e=t[13];else{const n=t[10];n&&(e=n)}if(!e){for(;t&&!t[4]&&t!==r;)Cl(t)&&Gn(t[1],t),t=t[3];null===t&&(t=r),Cl(t)&&Gn(t[1],t),e=t&&t[4]}t=e}}(t)}}function Gn(r,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function(r,t){let e;if(null!=r&&null!=(e=r.destroyHooks))for(let n=0;n<e.length;n+=2){const i=t[e[n]];if(!(i instanceof wt)){const o=e[n+1];if(Array.isArray(o))for(let u=0;u<o.length;u+=2){const m=i[o[u]],b=o[u+1];try{b.call(m)}finally{}}else try{o.call(i)}finally{}}}}(r,t),function(r,t){const e=r.cleanup,n=t[7];let i=-1;if(null!==e)for(let o=0;o<e.length-1;o+=2)if("string"==typeof e[o]){const u=e[o+1],m="function"==typeof u?u(t):Vr(t[u]),b=n[i=e[o+2]],T=e[o+3];"boolean"==typeof T?m.removeEventListener(e[o],b,T):T>=0?n[i=T]():n[i=-T].unsubscribe(),o+=2}else{const u=n[i=e[o+1]];e[o].call(u)}if(null!==n){for(let o=i+1;o<n.length;o++)n[o]();t[7]=null}}(r,t),1===t[1].type&&to(t[11])&&t[11].destroy();const e=t[17];if(null!==e&&us(t[3])){e!==t[3]&&An(e,t);const n=t[19];null!==n&&n.detachView(r)}}}function mi(r,t,e){return function(r,t,e){let n=t;for(;null!==n&&40&n.type;)n=(t=n).parent;if(null===n)return e[0];if(2&n.flags){const i=r.data[n.directiveStart].encapsulation;if(i===ii.None||i===ii.Emulated)return null}return Ja(n,e)}(r,t.parent,e)}function rr(r,t,e,n,i){to(r)?r.insertBefore(t,e,n,i):t.insertBefore(e,n,i)}function Ci(r,t,e){to(r)?r.appendChild(t,e):t.appendChild(e)}function si(r,t,e,n,i){null!==n?rr(r,t,e,n,i):Ci(r,t,e)}function Tr(r,t){return to(r)?r.parentNode(t):t.parentNode}let Ha=function(r,t,e){return 40&r.type?Ja(r,e):null};function Hs(r,t,e,n){const i=mi(r,n,t),o=t[11],m=function(r,t,e){return Ha(r,t,e)}(n.parent||t[6],n,t);if(null!=i)if(Array.isArray(e))for(let b=0;b<e.length;b++)si(o,i,e[b],m,!1);else si(o,i,e,m,!1)}function Os(r,t){if(null!==t){const e=t.type;if(3&e)return Ja(t,r);if(4&e)return ys(-1,r[t.index]);if(8&e){const n=t.child;if(null!==n)return Os(r,n);{const i=r[t.index];return us(i)?ys(-1,i):Vr(i)}}if(32&e)return g(t,r)()||Vr(r[t.index]);{const n=uu(r,t);return null!==n?Array.isArray(n)?n[0]:Os(N(r[16]),n):Os(r,t.next)}}return null}function uu(r,t){return null!==t?r[16][6].projection[t.projection]:null}function ys(r,t){const e=10+r+1;if(e<t.length){const n=t[e],i=n[1].firstChild;if(null!==i)return Os(n,i)}return t[7]}function rs(r,t,e,n,i,o,u){for(;null!=e;){const m=n[e.index],b=e.type;if(u&&0===t&&(m&&Bc(Vr(m),n),e.flags|=4),64!=(64&e.flags))if(8&b)rs(r,t,e.child,n,i,o,!1),Ae(t,r,i,m,o);else if(32&b){const T=g(e,n);let F;for(;F=T();)Ae(t,r,i,F,o);Ae(t,r,i,m,o)}else 16&b?Jo(r,t,n,e,i,o):Ae(t,r,i,m,o);e=u?e.projectionNext:e.next}}function vs(r,t,e,n,i,o){rs(e,n,r.firstChild,t,i,o,!1)}function Jo(r,t,e,n,i,o){const u=e[16],b=u[6].projection[n.projection];if(Array.isArray(b))for(let T=0;T<b.length;T++)Ae(t,r,i,b[T],o);else rs(r,t,b,u[3],i,o,!0)}function Zl(r,t,e){to(r)?r.setAttribute(t,"style",e):t.style.cssText=e}function nl(r,t,e){to(r)?""===e?r.removeAttribute(t,"class"):r.setAttribute(t,"class",e):t.className=e}function Ma(r,t,e){let n=r.length;for(;;){const i=r.indexOf(t,e);if(-1===i)return i;if(0===i||r.charCodeAt(i-1)<=32){const o=t.length;if(i+o===n||r.charCodeAt(i+o)<=32)return i}e=i+1}}const hu="ng-template";function Io(r,t,e){let n=0;for(;n<r.length;){let i=r[n++];if(e&&"class"===i){if(i=r[n],-1!==Ma(i.toLowerCase(),t,0))return!0}else if(1===i){for(;n<r.length&&"string"==typeof(i=r[n++]);)if(i.toLowerCase()===t)return!0;return!1}}return!1}function Vp(r){return 4===r.type&&r.value!==hu}function ku(r,t,e){return t===(4!==r.type||e?r.value:hu)}function fp(r,t,e){let n=4;const i=r.attrs||[],o=function(r){for(let t=0;t<r.length;t++)if(Cr(r[t]))return t;return r.length}(i);let u=!1;for(let m=0;m<t.length;m++){const b=t[m];if("number"!=typeof b){if(!u)if(4&n){if(n=2|1&n,""!==b&&!ku(r,b,e)||""===b&&1===t.length){if(Qo(n))return!1;u=!0}}else{const T=8&n?b:t[++m];if(8&n&&null!==r.attrs){if(!Io(r.attrs,T,e)){if(Qo(n))return!1;u=!0}continue}const V=Gp(8&n?"class":b,i,Vp(r),e);if(-1===V){if(Qo(n))return!1;u=!0;continue}if(""!==T){let H;H=V>o?"":i[V+1].toLowerCase();const J=8&n?H:null;if(J&&-1!==Ma(J,T,0)||2&n&&T!==H){if(Qo(n))return!1;u=!0}}}}else{if(!u&&!Qo(n)&&!Qo(b))return!1;if(u&&Qo(b))continue;u=!1,n=b|1&n}}return Qo(n)||u}function Qo(r){return 0==(1&r)}function Gp(r,t,e,n){if(null===t)return-1;let i=0;if(n||!e){let o=!1;for(;i<t.length;){const u=t[i];if(u===r)return i;if(3===u||6===u)o=!0;else{if(1===u||2===u){let m=t[++i];for(;"string"==typeof m;)m=t[++i];continue}if(4===u)break;if(0===u){i+=4;continue}}i+=o?1:2}return-1}return function(r,t){let e=r.indexOf(4);if(e>-1)for(e++;e<r.length;){const n=r[e];if("number"==typeof n)return-1;if(n===t)return e;e++}return-1}(t,r)}function Qh(r,t,e=!1){for(let n=0;n<t.length;n++)if(fp(r,t[n],e))return!0;return!1}function mf(r,t){return r?":not("+t.trim()+")":t}function nm(r){let t=r[0],e=1,n=2,i="",o=!1;for(;e<r.length;){let u=r[e];if("string"==typeof u)if(2&n){const m=r[++e];i+="["+u+(m.length>0?'="'+m+'"':"")+"]"}else 8&n?i+="."+u:4&n&&(i+=" "+u);else""!==i&&!Qo(u)&&(t+=mf(o,i),i=""),n=u,o=o||!Qo(n);e++}return""!==i&&(t+=mf(o,i)),t}const Fi={};function rn(r){tp(Ni(),gn(),le()+r,fs())}function tp(r,t,e,n){if(!n)if(3==(3&t[2])){const o=r.preOrderCheckHooks;null!==o&&Ye(t,o,e)}else{const o=r.preOrderHooks;null!==o&&yt(t,o,0,e)}de(e)}function jd(r,t){return r<<17|t<<2}function pu(r){return r>>17&32767}function Hm(r){return 2|r}function uh(r){return(131068&r)>>2}function vf(r,t){return-131069&r|t<<2}function rm(r){return 1|r}function bf(r,t){const e=r.contentQueries;if(null!==e)for(let n=0;n<e.length;n+=2){const i=e[n],o=e[n+1];if(-1!==o){const u=r.data[o];l(i),u.contentQueries(2,t[o],o)}}}function ch(r,t,e,n,i,o,u,m,b,T){const F=t.blueprint.slice();return F[0]=i,F[2]=140|n,$u(F),F[3]=F[15]=r,F[8]=e,F[10]=u||r&&r[10],F[11]=m||r&&r[11],F[12]=b||r&&r[12]||null,F[9]=T||r&&r[9]||null,F[6]=o,F[16]=2==t.type?r[16]:F,F}function Wd(r,t,e,n,i){let o=r.data[t];if(null===o)o=function(r,t,e,n,i){const o=Fc(),u=hc(),b=r.data[t]=function(r,t,e,n,i,o){return{type:e,index:n,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:i,attrs:o,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,u?o:o&&o.parent,e,t,n,i);return null===r.firstChild&&(r.firstChild=b),null!==o&&(u?null==o.child&&null!==b.parent&&(o.child=b):null===o.next&&(o.next=b)),b}(r,t,e,n,i),Lr.lFrame.inI18n&&(o.flags|=64);else if(64&o.type){o.type=e,o.value=n,o.attrs=i;const u=function(){const r=Lr.lFrame,t=r.currentTNode;return r.isParent?t:t.parent}();o.injectorIndex=null===u?-1:u.injectorIndex}return Su(o,!0),o}function Uc(r,t,e,n){if(0===e)return-1;const i=t.length;for(let o=0;o<e;o++)t.push(n),r.blueprint.push(n),r.data.push(null);return i}function wf(r,t,e){M(t);try{const n=r.viewQuery;null!==n&&Tn(1,n,e);const i=r.template;null!==i&&Vc(r,t,i,1,e),r.firstCreatePass&&(r.firstCreatePass=!1),r.staticContentQueries&&bf(r,t),r.staticViewQueries&&Tn(2,r.viewQuery,e);const o=r.components;null!==o&&function(r,t){for(let e=0;e<t.length;e++)ht(r,t[e])}(t,o)}catch(n){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),n}finally{t[2]&=-5,Y()}}function dd(r,t,e,n){const i=t[2];if(256==(256&i))return;M(t);const o=fs();try{$u(t),function(r){Lr.lFrame.bindingIndex=r}(r.bindingStartIndex),null!==e&&Vc(r,t,e,2,n);const u=3==(3&i);if(!o)if(u){const T=r.preOrderCheckHooks;null!==T&&Ye(t,T,null)}else{const T=r.preOrderHooks;null!==T&&yt(t,T,0,null),gt(t,0)}if(function(r){for(let t=ie(r);null!==t;t=ce(t)){if(!t[2])continue;const e=t[9];for(let n=0;n<e.length;n++){const i=e[n],o=i[3];0==(1024&i[2])&&Rs(o,1),i[2]|=1024}}}(t),function(r){for(let t=ie(r);null!==t;t=ce(t))for(let e=10;e<t.length;e++){const n=t[e],i=n[1];Nr(n)&&dd(i,n,i.template,n[8])}}(t),null!==r.contentQueries&&bf(r,t),!o)if(u){const T=r.contentCheckHooks;null!==T&&Ye(t,T)}else{const T=r.contentHooks;null!==T&&yt(t,T,1),gt(t,1)}!function(r,t){const e=r.hostBindingOpCodes;if(null!==e)try{for(let n=0;n<e.length;n++){const i=e[n];if(i<0)de(~i);else{const o=i,u=e[++n],m=e[++n];w(u,o),m(2,t[o])}}}finally{de(-1)}}(r,t);const m=r.components;null!==m&&function(r,t){for(let e=0;e<t.length;e++)We(r,t[e])}(t,m);const b=r.viewQuery;if(null!==b&&Tn(2,b,n),!o)if(u){const T=r.viewCheckHooks;null!==T&&Ye(t,T)}else{const T=r.viewHooks;null!==T&&yt(t,T,2),gt(t,2)}!0===r.firstUpdatePass&&(r.firstUpdatePass=!1),o||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,Rs(t[3],-1))}finally{Y()}}function ip(r,t,e,n){const i=t[10],o=!fs(),u=Un(t);try{o&&!u&&i.begin&&i.begin(),u&&wf(r,t,n),dd(r,t,e,n)}finally{o&&!u&&i.end&&i.end()}}function Vc(r,t,e,n,i){const o=le(),u=2&n;try{de(-1),u&&t.length>20&&tp(r,t,20,fs()),e(n,i)}finally{de(o)}}function Fy(r,t,e){if(nh(t)){const i=t.directiveEnd;for(let o=t.directiveStart;o<i;o++){const u=r.data[o];u.contentQueries&&u.contentQueries(1,e[o],o)}}}function Qm(r,t,e){!pp()||(function(r,t,e,n){const i=e.directiveStart,o=e.directiveEnd;r.firstCreatePass||Ie(e,t),Bc(n,t);const u=e.initialInputs;for(let m=i;m<o;m++){const b=r.data[m],T=cs(b);T&&U(t,e,b);const F=Vn(t,r,m,e);Bc(F,t),null!==u&&re(0,m-i,F,b,0,u),T&&(ta(e.index,t)[8]=F)}}(r,t,e,Ja(e,t)),128==(128&e.flags)&&function(r,t,e){const n=e.directiveStart,i=e.directiveEnd,u=e.index,m=Lr.lFrame.currentDirectiveIndex;try{de(u);for(let b=n;b<i;b++){const T=r.data[b],F=t[b];I(b),(null!==T.hostBindings||0!==T.hostVars||null!==T.hostAttrs)&&c(T,F)}}finally{de(-1),I(m)}}(r,t,e))}function Cf(r,t,e=Ja){const n=t.localNames;if(null!==n){let i=t.index+1;for(let o=0;o<n.length;o+=2){const u=n[o+1],m=-1===u?e(t,r):r[u];r[i++]=m}}}function zy(r){const t=r.tView;return null===t||t.incompleteFirstPass?r.tView=am(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts):t}function am(r,t,e,n,i,o,u,m,b,T){const F=20+n,V=F+i,H=function(r,t){const e=[];for(let n=0;n<t;n++)e.push(n<r?null:Fi);return e}(F,V),J="function"==typeof T?T():T;return H[1]={type:r,blueprint:H,template:e,queries:null,viewQuery:m,declTNode:t,data:H.slice().fill(null,F),bindingStartIndex:F,expandoStartIndex:V,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof o?o():o,pipeRegistry:"function"==typeof u?u():u,firstChild:null,schemas:b,consts:J,incompleteFirstPass:!1}}function sm(r,t,e,n){const i=Jn(t);null===e?i.push(n):(i.push(e),r.firstCreatePass&&pr(r).push(n,i.length-1))}function Vg(r,t,e){for(let n in r)if(r.hasOwnProperty(n)){const i=r[n];(e=null===e?{}:e).hasOwnProperty(n)?e[n].push(t,i):e[n]=[t,i]}return e}function vc(r,t,e,n,i,o,u,m){const b=Ja(t,e);let F,T=t.inputs;!m&&null!=T&&(F=T[n])?(hi(r,e,F,n,i),Wh(t)&&function(r,t){const e=ta(t,r);16&e[2]||(e[2]|=64)}(e,t.index)):3&t.type&&(n=function(r){return"class"===r?"className":"for"===r?"htmlFor":"formaction"===r?"formAction":"innerHtml"===r?"innerHTML":"readonly"===r?"readOnly":"tabindex"===r?"tabIndex":r}(n),i=null!=u?u(i,t.value||"",n):i,to(o)?o.setProperty(b,n,i):Wr(n)||(b.setProperty?b.setProperty(n,i):b[n]=i))}function yp(r,t,e,n){let i=!1;if(pp()){const o=function(r,t,e){const n=r.directiveRegistry;let i=null;if(n)for(let o=0;o<n.length;o++){const u=n[o];Qh(e,u.selectors,!1)&&(i||(i=[]),jt(Ie(e,t),r,u.type),cs(u)?(p(r,e),i.unshift(u)):i.push(u))}return i}(r,t,e),u=null===n?null:{"":-1};if(null!==o){i=!0,A(e,r.data.length,o.length);for(let F=0;F<o.length;F++){const V=o[F];V.providersResolver&&V.providersResolver(V)}let m=!1,b=!1,T=Uc(r,t,o.length,null);for(let F=0;F<o.length;F++){const V=o[F];e.mergedAttrs=Zi(e.mergedAttrs,V.hostAttrs),R(r,e,t,T,V),E(T,V,u),null!==V.contentQueries&&(e.flags|=8),(null!==V.hostBindings||null!==V.hostAttrs||0!==V.hostVars)&&(e.flags|=128);const H=V.type.prototype;!m&&(H.ngOnChanges||H.ngOnInit||H.ngDoCheck)&&((r.preOrderHooks||(r.preOrderHooks=[])).push(e.index),m=!0),!b&&(H.ngOnChanges||H.ngDoCheck)&&((r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(e.index),b=!0),T++}!function(r,t){const n=t.directiveEnd,i=r.data,o=t.attrs,u=[];let m=null,b=null;for(let T=t.directiveStart;T<n;T++){const F=i[T],V=F.inputs,H=null===o||Vp(t)?null:ae(V,o);u.push(H),m=Vg(V,T,m),b=Vg(F.outputs,T,b)}null!==m&&(m.hasOwnProperty("class")&&(t.flags|=16),m.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=u,t.inputs=m,t.outputs=b}(r,e)}u&&function(r,t,e){if(t){const n=r.localNames=[];for(let i=0;i<t.length;i+=2){const o=e[t[i+1]];if(null==o)throw new Fr("301",`Export of name '${t[i+1]}' not found!`);n.push(t[i],o)}}}(e,n,u)}return e.mergedAttrs=Zi(e.mergedAttrs,e.attrs),i}function tg(r,t,e,n,i,o){const u=o.hostBindings;if(u){let m=r.hostBindingOpCodes;null===m&&(m=r.hostBindingOpCodes=[]);const b=~t.index;(function(r){let t=r.length;for(;t>0;){const e=r[--t];if("number"==typeof e&&e<0)return e}return 0})(m)!=b&&m.push(b),m.push(n,i,u)}}function c(r,t){null!==r.hostBindings&&r.hostBindings(1,t)}function p(r,t){t.flags|=2,(r.components||(r.components=[])).push(t.index)}function E(r,t,e){if(e){if(t.exportAs)for(let n=0;n<t.exportAs.length;n++)e[t.exportAs[n]]=r;cs(t)&&(e[""]=r)}}function A(r,t,e){r.flags|=1,r.directiveStart=t,r.directiveEnd=t+e,r.providerIndexes=t}function R(r,t,e,n,i){r.data[n]=i;const o=i.factory||(i.factory=Ds(i.type)),u=new wt(o,cs(i),null);r.blueprint[n]=u,e[n]=u,tg(r,t,0,n,Uc(r,e,i.hostVars,Fi),i)}function U(r,t,e){const n=Ja(t,r),i=zy(e),o=r[10],u=Tt(r,ch(r,i,null,e.onPush?64:16,n,t,o,o.createRenderer(n,e),null,null));r[t.index]=u}function Z(r,t,e,n,i,o){const u=Ja(r,t);!function(r,t,e,n,i,o,u){if(null==o)to(r)?r.removeAttribute(t,i,e):t.removeAttribute(i);else{const m=null==u?Mn(o):u(o,n||"",i);to(r)?r.setAttribute(t,i,m,e):e?t.setAttributeNS(e,i,m):t.setAttribute(i,m)}}(t[11],u,o,r.value,e,n,i)}function re(r,t,e,n,i,o){const u=o[t];if(null!==u){const m=n.setInput;for(let b=0;b<u.length;){const T=u[b++],F=u[b++],V=u[b++];null!==m?n.setInput(e,V,T,F):e[F]=V}}}function ae(r,t){let e=null,n=0;for(;n<t.length;){const i=t[n];if(0!==i)if(5!==i){if("number"==typeof i)break;r.hasOwnProperty(i)&&(null===e&&(e=[]),e.push(i,r[i],t[n+1])),n+=2}else n+=2;else n+=4}return e}function Ce(r,t,e,n){return new Array(r,!0,!1,t,null,0,n,e,null,null)}function We(r,t){const e=ta(t,r);if(Nr(e)){const n=e[1];80&e[2]?dd(n,e,n.template,e[8]):e[5]>0&&rt(e)}}function rt(r){for(let n=ie(r);null!==n;n=ce(n))for(let i=10;i<n.length;i++){const o=n[i];if(1024&o[2]){const u=o[1];dd(u,o,u.template,o[8])}else o[5]>0&&rt(o)}const e=r[1].components;if(null!==e)for(let n=0;n<e.length;n++){const i=ta(e[n],r);Nr(i)&&i[5]>0&&rt(i)}}function ht(r,t){const e=ta(t,r),n=e[1];(function(r,t){for(let e=t.length;e<r.blueprint.length;e++)t.push(r.blueprint[e])})(n,e),wf(n,e,e[8])}function Tt(r,t){return r[13]?r[14][4]=t:r[13]=t,r[14]=t,t}function Ct(r){for(;r;){r[2]|=64;const t=N(r);if(El(r)&&!t)return r;r=t}return null}function Yt(r,t,e){const n=t[10];n.begin&&n.begin();try{dd(r,t,r.template,e)}catch(i){throw Wa(t,i),i}finally{n.end&&n.end()}}function Kn(r){!function(r){for(let t=0;t<r.components.length;t++){const e=r.components[t],n=Jf(e),i=n[1];ip(i,n,i.template,e)}}(r[8])}function Tn(r,t,e){l(0),t(r,e)}const yn=(()=>Promise.resolve(null))();function Jn(r){return r[7]||(r[7]=[])}function pr(r){return r.cleanup||(r.cleanup=[])}function Wa(r,t){const e=r[9],n=e?e.get(em,null):null;n&&n.handleError(t)}function hi(r,t,e,n,i){for(let o=0;o<e.length;){const u=e[o++],m=e[o++],b=t[u],T=r.data[u];null!==T.setInput?T.setInput(b,i,n,m):b[m]=i}}function mo(r,t,e){const n=ps(t,r);!function(r,t,e){to(r)?r.setValue(t,e):t.textContent=e}(r[11],n,e)}function Wn(r,t,e){let n=e?r.styles:null,i=e?r.classes:null,o=0;if(null!==t)for(let u=0;u<t.length;u++){const m=t[u];"number"==typeof m?o=m:1==o?i=yo(i,m):2==o&&(n=yo(n,m+": "+t[++u]+";"))}e?r.styles=n:r.stylesWithoutHost=n,e?r.classes=i:r.classesWithoutHost=i}const Ml=new ao("INJECTOR",-1);class du{get(t,e=uf){if(e===uf){const n=new Error(`NullInjectorError: No provider for ${Kr(t)}!`);throw n.name="NullInjectorError",n}return e}}const Ru=new ao("Set Injector scope."),ia={},pa={};let xs;function _c(){return void 0===xs&&(xs=new du),xs}function Hl(r,t=null,e=null,n){const i=Ou(r,t,e,n);return i._resolveInjectorDefTypes(),i}function Ou(r,t=null,e=null,n){return new Gc(r,e,t||_c(),n)}class Gc{constructor(t,e,n,i=null){this.parent=n,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const o=[];e&&Au(e,m=>this.processProvider(m,t,e)),Au([t],m=>this.processInjectorType(m,[],o)),this.records.set(Ml,$s(void 0,this));const u=this.records.get(Ru);this.scope=null!=u?u.value:null,this.source=i||("object"==typeof t?null:Kr(t))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(t=>t.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(t,e=uf,n=oi.Default){this.assertNotDestroyed();const i=Jh(this),o=eu(void 0);try{if(!(n&oi.SkipSelf)){let m=this.records.get(t);if(void 0===m){const b=("function"==typeof(r=t)||"object"==typeof r&&r instanceof ao)&&Fl(t);m=b&&this.injectableDefInScope(b)?$s(Ws(t),ia):null,this.records.set(t,m)}if(null!=m)return this.hydrate(t,m)}return(n&oi.Self?_c():this.parent).get(t,e=n&oi.Optional&&e===uf?null:e)}catch(u){if("NullInjectorError"===u.name){if((u[Dm]=u[Dm]||[]).unshift(Kr(t)),i)throw u;return function(r,t,e,n){const i=r[Dm];throw t[my]&&i.unshift(t[my]),r.message=function(r,t,e,n=null){r=r&&"\n"===r.charAt(0)&&"\u0275"==r.charAt(1)?r.substr(2):r;let i=Kr(t);if(Array.isArray(t))i=t.map(Kr).join(" -> ");else if("object"==typeof t){let o=[];for(let u in t)if(t.hasOwnProperty(u)){let m=t[u];o.push(u+":"+("string"==typeof m?JSON.stringify(m):Kr(m)))}i=`{${o.join(", ")}}`}return`${e}${n?"("+n+")":""}[${i}]: ${r.replace(B_,"\n  ")}`}("\n"+r.message,i,e,n),r.ngTokenPath=i,r[Dm]=null,r}(u,t,"R3InjectorError",this.source)}throw u}finally{eu(o),Jh(i)}var r}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(t=>this.get(t))}toString(){const t=[];return this.records.forEach((n,i)=>t.push(Kr(i))),`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(t,e,n){if(!(t=fi(t)))return!1;let i=kc(t);const o=null==i&&t.ngModule||void 0,u=void 0===o?t:o,m=-1!==n.indexOf(u);if(void 0!==o&&(i=kc(o)),null==i)return!1;if(null!=i.imports&&!m){let F;n.push(u);try{Au(i.imports,V=>{this.processInjectorType(V,e,n)&&(void 0===F&&(F=[]),F.push(V))})}finally{}if(void 0!==F)for(let V=0;V<F.length;V++){const{ngModule:H,providers:J}=F[V];Au(J,ne=>this.processProvider(ne,H,J||uo))}}this.injectorDefTypes.add(u);const b=Ds(u)||(()=>new u);this.records.set(u,$s(b,ia));const T=i.providers;if(null!=T&&!m){const F=t;Au(T,V=>this.processProvider(V,F,T))}return void 0!==o&&void 0!==t.providers}processProvider(t,e,n){let i=da(t=fi(t))?t:fi(t&&t.provide);const o=function(r,t,e){return Al(r)?$s(void 0,r.useValue):$s(Wl(r),ia)}(t);if(da(t)||!0!==t.multi)this.records.get(i);else{let u=this.records.get(i);u||(u=$s(void 0,ia,!0),u.factory=()=>kd(u.multi),this.records.set(i,u)),i=t,u.multi.push(t)}this.records.set(i,o)}hydrate(t,e){return e.value===ia&&(e.value=pa,e.value=e.factory()),"object"==typeof e.value&&e.value&&null!==(r=e.value)&&"object"==typeof r&&"function"==typeof r.ngOnDestroy&&this.onDestroy.add(e.value),e.value;var r}injectableDefInScope(t){if(!t.providedIn)return!1;const e=fi(t.providedIn);return"string"==typeof e?"any"===e||e===this.scope:this.injectorDefTypes.has(e)}}function Ws(r){const t=Fl(r),e=null!==t?t.factory:Ds(r);if(null!==e)return e;if(r instanceof ao)throw new Error(`Token ${Kr(r)} is missing a \u0275prov definition.`);if(r instanceof Function)return function(r){const t=r.length;if(t>0){const n=function(r,t){const e=[];for(let n=0;n<r;n++)e.push(t);return e}(t,"?");throw new Error(`Can't resolve all parameters for ${Kr(r)}: (${n.join(", ")}).`)}const e=function(r){const t=r&&(r[wa]||r[qh]);if(t){const e=function(r){if(r.hasOwnProperty("name"))return r.name;const t=(""+r).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(r);return console.warn(`DEPRECATED: DI is instantiating a token "${e}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${e}" class.`),t}return null}(r);return null!==e?()=>e.factory(r):()=>new r}(r);throw new Error("unreachable")}function Wl(r,t,e){let n;if(da(r)){const i=fi(r);return Ds(i)||Ws(i)}if(Al(r))n=()=>fi(r.useValue);else if(function(r){return!(!r||!r.useFactory)}(r))n=()=>r.useFactory(...kd(r.deps||[]));else if(function(r){return!(!r||!r.useExisting)}(r))n=()=>Xn(fi(r.useExisting));else{const i=fi(r&&(r.useClass||r.provide));if(!function(r){return!!r.deps}(r))return Ds(i)||Ws(i);n=()=>new i(...kd(r.deps))}return n}function $s(r,t,e=!1){return{factory:r,value:t,multi:e?[]:void 0}}function Al(r){return null!==r&&"object"==typeof r&&bv in r}function da(r){return"function"==typeof r}let Fo=(()=>{class r{static create(e,n){var i;if(Array.isArray(e))return Hl({name:""},n,e,"");{const o=null!==(i=e.name)&&void 0!==i?i:"";return Hl({name:o},e.parent,e.providers,o)}}}return r.THROW_IF_NOT_FOUND=uf,r.NULL=new du,r.\u0275prov=Hr({token:r,providedIn:"any",factory:()=>Xn(Ml)}),r.__NG_ELEMENT_ID__=-1,r})();function $L(r,t){Ue(Jf(r)[1],jo())}function Xg(r){let t=function(r){return Object.getPrototypeOf(r.prototype).constructor}(r.type),e=!0;const n=[r];for(;t;){let i;if(cs(r))i=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Error("Directives cannot inherit Components");i=t.\u0275dir}if(i){if(e){n.push(i);const u=r;u.inputs=AC(r.inputs),u.declaredInputs=AC(r.declaredInputs),u.outputs=AC(r.outputs);const m=i.hostBindings;m&&JL(r,m);const b=i.viewQuery,T=i.contentQueries;if(b&&YL(r,b),T&&KL(r,T),ni(r.inputs,i.inputs),ni(r.declaredInputs,i.declaredInputs),ni(r.outputs,i.outputs),cs(i)&&i.data.animation){const F=r.data;F.animation=(F.animation||[]).concat(i.data.animation)}}const o=i.features;if(o)for(let u=0;u<o.length;u++){const m=o[u];m&&m.ngInherit&&m(r),m===Xg&&(e=!1)}}t=Object.getPrototypeOf(t)}!function(r){let t=0,e=null;for(let n=r.length-1;n>=0;n--){const i=r[n];i.hostVars=t+=i.hostVars,i.hostAttrs=Zi(i.hostAttrs,e=Zi(e,i.hostAttrs))}}(n)}function AC(r){return r===ya?{}:r===uo?[]:r}function YL(r,t){const e=r.viewQuery;r.viewQuery=e?(n,i)=>{t(n,i),e(n,i)}:t}function KL(r,t){const e=r.contentQueries;r.contentQueries=e?(n,i,o)=>{t(n,i,o),e(n,i,o)}:t}function JL(r,t){const e=r.hostBindings;r.hostBindings=e?(n,i)=>{t(n,i),e(n,i)}:t}let ab=null;function v0(){if(!ab){const r=Di.Symbol;if(r&&r.iterator)ab=r.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const n=t[e];"entries"!==n&&"size"!==n&&Map.prototype[n]===Map.prototype.entries&&(ab=n)}}}return ab}function Rx(r){return!!DC(r)&&(Array.isArray(r)||!(r instanceof Map)&&v0()in r)}function DC(r){return null!==r&&("function"==typeof r||"object"==typeof r)}function xp(r,t,e){return!Object.is(r[t],e)&&(r[t]=e,!0)}function Yg(r,t,e,n){const i=gn();return xp(i,au(),t)&&(Ni(),Z(ge(),i,r,t,e,n)),Yg}function x0(r,t,e,n){return xp(r,au(),e)?t+Mn(e)+n:Fi}function Ii(r,t,e,n,i,o,u,m){const b=gn(),T=Ni(),F=r+20,V=T.firstCreatePass?function(r,t,e,n,i,o,u,m,b){const T=t.consts,F=Wd(t,r,4,u||null,Ps(T,m));yp(t,e,F,Ps(T,b)),Ue(t,F);const V=F.tViews=am(2,F,n,i,o,t.directiveRegistry,t.pipeRegistry,null,t.schemas,T);return null!==t.queries&&(t.queries.template(t,F),V.queries=t.queries.embeddedTView(F)),F}(F,T,b,t,e,n,i,o,u):T.data[F];Su(V,!1);const H=b[11].createComment("");Hs(T,b,H,V),Bc(H,b),Tt(b,b[F]=Ce(H,b,H,V)),jl(V)&&Qm(T,b,V),null!=u&&Cf(b,V,m)}function qn(r,t=oi.Default){const e=gn();return null===e?Xn(r,t):ar(jo(),e,fi(r),t)}function LC(){throw new Error("invalid")}function kn(r,t,e){const n=gn();return xp(n,au(),t)&&vc(Ni(),ge(),n,r,t,n[11],e,!1),kn}function FC(r,t,e,n,i){const u=i?"class":"style";hi(r,e,t.inputs[u],u,n)}function It(r,t,e,n){const i=gn(),o=Ni(),u=20+r,m=i[11],b=i[u]=pt(m,t,Lr.lFrame.currentNamespace),T=o.firstCreatePass?function(r,t,e,n,i,o,u){const m=t.consts,T=Wd(t,r,2,i,Ps(m,o));return yp(t,e,T,Ps(m,u)),null!==T.attrs&&Wn(T,T.attrs,!1),null!==T.mergedAttrs&&Wn(T,T.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,T),T}(u,o,i,0,t,e,n):o.data[u];Su(T,!0);const F=T.mergedAttrs;null!==F&&tr(m,b,F);const V=T.classes;null!==V&&nl(m,b,V);const H=T.styles;null!==H&&Zl(m,b,H),64!=(64&T.flags)&&Hs(o,i,b,T),0===Lr.lFrame.elementDepthCount&&Bc(b,i),Lr.lFrame.elementDepthCount++,jl(T)&&(Qm(o,i,T),Fy(o,T,i)),null!==n&&Cf(i,T)}function Mt(){let r=jo();hc()?pc():(r=r.parent,Su(r,!1));const t=r;Lr.lFrame.elementDepthCount--;const e=Ni();e.firstCreatePass&&(Ue(e,r),nh(r)&&e.queries.elementEnd(r)),null!=t.classesWithoutHost&&function(r){return 0!=(16&r.flags)}(t)&&FC(e,t,gn(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function(r){return 0!=(32&r.flags)}(t)&&FC(e,t,gn(),t.stylesWithoutHost,!1)}function Hi(r,t,e,n){It(r,t,e,n),Mt()}function zC(r,t,e){(function(r,t,e){const n=gn(),i=Ni(),o=r+20,u=i.firstCreatePass?function(r,t,e,n,i){const o=t.consts,u=Ps(o,n),m=Wd(t,r,8,"ng-container",u);return null!==u&&Wn(m,u,!0),yp(t,e,m,Ps(o,i)),null!==t.queries&&t.queries.elementStart(t,m),m}(o,i,n,t,e):i.data[o];Su(u,!0);const m=n[o]=n[11].createComment("");Hs(i,n,m,u),Bc(m,n),jl(u)&&(Qm(i,n,u),Fy(i,u,n)),null!=e&&Cf(n,u)})(r,t,e),function(){let r=jo();const t=Ni();hc()?pc():(r=r.parent,Su(r,!1)),t.firstCreatePass&&(Ue(t,r),nh(r)&&t.queries.elementEnd(r))}()}function $l(){return gn()}function ub(r){return!!r&&"function"==typeof r.then}const oI=function(r){return!!r&&"function"==typeof r.subscribe};function Qr(r,t,e,n){const i=gn(),o=Ni(),u=jo();return function(r,t,e,n,i,o,u,m){const b=jl(n),F=r.firstCreatePass&&pr(r),V=t[8],H=Jn(t);let J=!0;if(3&n.type||m){const Re=Ja(n,t),qe=m?m(Re):Re,Ne=H.length,$e=m?tt=>m(Vr(tt[n.index])):n.index;if(to(e)){let tt=null;if(!m&&b&&(tt=function(r,t,e,n){const i=r.cleanup;if(null!=i)for(let o=0;o<i.length-1;o+=2){const u=i[o];if(u===e&&i[o+1]===n){const m=t[7],b=i[o+2];return m.length>b?m[b]:null}"string"==typeof u&&(o+=2)}return null}(r,t,i,n.index)),null!==tt)(tt.__ngLastListenerFn__||tt).__ngNextListenerFn__=o,tt.__ngLastListenerFn__=o,J=!1;else{o=NC(n,t,V,o,!1);const bt=e.listen(qe,i,o);H.push(o,bt),F&&F.push(i,$e,Ne,Ne+1)}}else o=NC(n,t,V,o,!0),qe.addEventListener(i,o,u),H.push(o),F&&F.push(i,$e,Ne,u)}else o=NC(n,t,V,o,!1);const ne=n.outputs;let we;if(J&&null!==ne&&(we=ne[i])){const Re=we.length;if(Re)for(let qe=0;qe<Re;qe+=2){const dn=t[we[qe]][we[qe+1]].subscribe(o),Kt=H.length;H.push(o,dn),F&&F.push(i,n.index,Kt,-(Kt+1))}}}(o,i,i[11],u,r,t,!!e,n),Qr}function lI(r,t,e,n){try{return!1!==e(n)}catch(i){return Wa(r,i),!1}}function NC(r,t,e,n,i){return function o(u){if(u===Function)return n;const m=2&r.flags?ta(r.index,t):t;0==(32&t[2])&&Ct(m);let b=lI(t,0,n,u),T=o.__ngNextListenerFn__;for(;T;)b=lI(t,0,T,u)&&b,T=T.__ngNextListenerFn__;return i&&!1===b&&(u.preventDefault(),u.returnValue=!1),b}}function ir(r=1){return function(r){return(Lr.lFrame.contextLView=function(r,t){for(;r>0;)t=t[15],r--;return t}(r,Lr.lFrame.contextLView))[8]}(r)}function $v(r,t,e){return BC(r,"",t,"",e),$v}function BC(r,t,e,n,i){const o=gn(),u=x0(o,t,e,n);return u!==Fi&&vc(Ni(),ge(),o,r,u,o[11],i,!1),BC}function yI(r,t,e,n,i){const o=r[e+1],u=null===t;let m=n?pu(o):uh(o),b=!1;for(;0!==m&&(!1===b||u);){const F=r[m+1];PF(r[m],t)&&(b=!0,r[m+1]=n?rm(F):Hm(F)),m=n?pu(F):uh(F)}b&&(r[e+1]=n?Hm(o):rm(o))}function PF(r,t){return null===r||null==t||(Array.isArray(r)?r[1]:r)===t||!(!Array.isArray(r)||"string"!=typeof t)&&Dh(r,t)>=0}const ph={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function vI(r){return r.substring(ph.key,ph.keyEnd)}function RF(r){return r.substring(ph.value,ph.valueEnd)}function _I(r,t){const e=ph.textEnd;return e===t?-1:(t=ph.keyEnd=function(r,t,e){for(;t<e&&r.charCodeAt(t)>32;)t++;return t}(r,ph.key=t,e),A0(r,t,e))}function xI(r,t){const e=ph.textEnd;let n=ph.key=A0(r,t,e);return e===n?-1:(n=ph.keyEnd=function(r,t,e){let n;for(;t<e&&(45===(n=r.charCodeAt(t))||95===n||(-33&n)>=65&&(-33&n)<=90||n>=48&&n<=57);)t++;return t}(r,n,e),n=wI(r,n,e),n=ph.value=A0(r,n,e),n=ph.valueEnd=function(r,t,e){let n=-1,i=-1,o=-1,u=t,m=u;for(;u<e;){const b=r.charCodeAt(u++);if(59===b)return m;34===b||39===b?m=u=CI(r,b,u,e):t===u-4&&85===o&&82===i&&76===n&&40===b?m=u=CI(r,41,u,e):b>32&&(m=u),o=i,i=n,n=-33&b}return m}(r,n,e),wI(r,n,e))}function bI(r){ph.key=0,ph.keyEnd=0,ph.value=0,ph.valueEnd=0,ph.textEnd=r.length}function A0(r,t,e){for(;t<e&&r.charCodeAt(t)<=32;)t++;return t}function wI(r,t,e,n){return(t=A0(r,t,e))<e&&t++,t}function CI(r,t,e,n){let i=-1,o=e;for(;o<n;){const u=r.charCodeAt(o++);if(u==t&&92!==i)return o;i=92==u&&92===i?0:u}throw new Error}function dh(r,t,e){return pm(r,t,e,!1),dh}function pb(r,t){return pm(r,t,null,!0),pb}function BF(r,t){for(let e=function(r){return bI(r),xI(r,A0(r,0,ph.textEnd))}(t);e>=0;e=xI(t,e))TI(r,vI(t),RF(t))}function Xv(r){dm(Du,ig,r,!0)}function ig(r,t){for(let e=function(r){return bI(r),_I(r,A0(r,0,ph.textEnd))}(t);e>=0;e=_I(t,e))Du(r,vI(t),!0)}function pm(r,t,e,n){const i=gn(),o=Ni(),u=Qs(2);o.firstUpdatePass&&SI(o,r,u,n),t!==Fi&&xp(i,u,t)&&II(o,o.data[le()],i,i[11],r,i[u+1]=function(r,t){return null==r||("string"==typeof t?r+=t:"object"==typeof r&&(r=Kr(Bp(r)))),r}(t,e),n,u)}function dm(r,t,e,n){const i=Ni(),o=Qs(2);i.firstUpdatePass&&SI(i,null,o,n);const u=gn();if(e!==Fi&&xp(u,o,e)){const m=i.data[le()];if(AI(m,n)&&!EI(i,o)){let b=n?m.classesWithoutHost:m.stylesWithoutHost;null!==b&&(e=yo(b,e||"")),FC(i,m,u,e,n)}else!function(r,t,e,n,i,o,u,m){i===Fi&&(i=uo);let b=0,T=0,F=0<i.length?i[0]:null,V=0<o.length?o[0]:null;for(;null!==F||null!==V;){const H=b<i.length?i[b+1]:void 0,J=T<o.length?o[T+1]:void 0;let we,ne=null;F===V?(b+=2,T+=2,H!==J&&(ne=V,we=J)):null===V||null!==F&&F<V?(b+=2,ne=F):(T+=2,ne=V,we=J),null!==ne&&II(r,t,e,n,ne,we,u,m),F=b<i.length?i[b]:null,V=T<o.length?o[T]:null}}(i,m,u,u[11],u[o+1],u[o+1]=function(r,t,e){if(null==e||""===e)return uo;const n=[],i=Bp(e);if(Array.isArray(i))for(let o=0;o<i.length;o++)r(n,i[o],!0);else if("object"==typeof i)for(const o in i)i.hasOwnProperty(o)&&r(n,o,i[o]);else"string"==typeof i&&t(n,i);return n}(r,t,e),n,o)}}function EI(r,t){return t>=r.expandoStartIndex}function SI(r,t,e,n){const i=r.data;if(null===i[e+1]){const o=i[le()],u=EI(r,e);AI(o,n)&&null===t&&!u&&(t=!1),t=function(r,t,e,n){const i=function(r){const t=Lr.lFrame.currentDirectiveIndex;return-1===t?null:r[t]}(r);let o=n?t.residualClasses:t.residualStyles;if(null===i)0===(n?t.classBindings:t.styleBindings)&&(e=Lx(e=jC(null,r,t,e,n),t.attrs,n),o=null);else{const u=t.directiveStylingLast;if(-1===u||r[u]!==i)if(e=jC(i,r,t,e,n),null===o){let b=function(r,t,e){const n=e?t.classBindings:t.styleBindings;if(0!==uh(n))return r[pu(n)]}(r,t,n);void 0!==b&&Array.isArray(b)&&(b=jC(null,r,t,b[1],n),b=Lx(b,t.attrs,n),function(r,t,e,n){r[pu(e?t.classBindings:t.styleBindings)]=n}(r,t,n,b))}else o=function(r,t,e){let n;const i=t.directiveEnd;for(let o=1+t.directiveStylingLast;o<i;o++)n=Lx(n,r[o].hostAttrs,e);return Lx(n,t.attrs,e)}(r,t,n)}return void 0!==o&&(n?t.residualClasses=o:t.residualStyles=o),e}(i,o,t,n),function(r,t,e,n,i,o){let u=o?t.classBindings:t.styleBindings,m=pu(u),b=uh(u);r[n]=e;let F,T=!1;if(Array.isArray(e)){const V=e;F=V[1],(null===F||Dh(V,F)>0)&&(T=!0)}else F=e;if(i)if(0!==b){const H=pu(r[m+1]);r[n+1]=jd(H,m),0!==H&&(r[H+1]=vf(r[H+1],n)),r[m+1]=function(r,t){return 131071&r|t<<17}(r[m+1],n)}else r[n+1]=jd(m,0),0!==m&&(r[m+1]=vf(r[m+1],n)),m=n;else r[n+1]=jd(b,0),0===m?m=n:r[b+1]=vf(r[b+1],n),b=n;T&&(r[n+1]=Hm(r[n+1])),yI(r,F,n,!0),yI(r,F,n,!1),function(r,t,e,n,i){const o=i?r.residualClasses:r.residualStyles;null!=o&&"string"==typeof t&&Dh(o,t)>=0&&(e[n+1]=rm(e[n+1]))}(t,F,r,n,o),u=jd(m,b),o?t.classBindings=u:t.styleBindings=u}(i,o,t,e,u,n)}}function jC(r,t,e,n,i){let o=null;const u=e.directiveEnd;let m=e.directiveStylingLast;for(-1===m?m=e.directiveStart:m++;m<u&&(o=t[m],n=Lx(n,o.hostAttrs,i),o!==r);)m++;return null!==r&&(e.directiveStylingLast=m),n}function Lx(r,t,e){const n=e?1:2;let i=-1;if(null!==t)for(let o=0;o<t.length;o++){const u=t[o];"number"==typeof u?i=u:i===n&&(Array.isArray(r)||(r=void 0===r?[]:["",r]),Du(r,u,!!e||t[++o]))}return void 0===r?null:r}function TI(r,t,e){Du(r,t,Bp(e))}function II(r,t,e,n,i,o,u,m){if(!(3&t.type))return;const b=r.data,T=b[m+1];db(function(r){return 1==(1&r)}(T)?MI(b,t,e,i,uh(T),u):void 0)||(db(o)||function(r){return 2==(2&r)}(T)&&(o=MI(b,null,e,i,m,u)),function(r,t,e,n,i){const o=to(r);if(t)i?o?r.addClass(e,n):e.classList.add(n):o?r.removeClass(e,n):e.classList.remove(n);else{let u=-1===n.indexOf("-")?void 0:s.DashCase;if(null==i)o?r.removeStyle(e,n,u):e.style.removeProperty(n);else{const m="string"==typeof i&&i.endsWith("!important");m&&(i=i.slice(0,-10),u|=s.Important),o?r.setStyle(e,n,i,u):e.style.setProperty(n,i,m?"important":"")}}}(n,u,ps(le(),e),i,o))}function MI(r,t,e,n,i,o){const u=null===t;let m;for(;i>0;){const b=r[i],T=Array.isArray(b),F=T?b[1]:b,V=null===F;let H=e[i+1];H===Fi&&(H=V?uo:void 0);let J=V?wg(H,n):F===n?H:void 0;if(T&&!db(J)&&(J=wg(b,n)),db(J)&&(m=J,u))return m;const ne=r[i+1];i=u?pu(ne):uh(ne)}if(null!==t){let b=o?t.residualClasses:t.residualStyles;null!=b&&(m=wg(b,n))}return m}function db(r){return void 0!==r}function AI(r,t){return 0!=(r.flags&(t?16:32))}function jr(r,t=""){const e=gn(),n=Ni(),i=r+20,o=n.firstCreatePass?Wd(n,i,1,t,null):n.data[i],u=e[i]=function(r,t){return to(r)?r.createText(t):r.createTextNode(t)}(e[11],t);Hs(n,e,u,o),Su(o,!1)}function bp(r){return wp("",r,""),bp}function wp(r,t,e){const n=gn(),i=x0(n,r,t,e);return i!==Fi&&mo(n,le(),i),wp}const Yv=void 0;var hz=["en",[["a","p"],["AM","PM"],Yv],[["AM","PM"],Yv,Yv],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Yv,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Yv,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Yv,"{1} 'at' {0}",Yv],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(r){const e=Math.floor(Math.abs(r)),n=r.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===n?1:5}];let D0={};function KI(r){return r in D0||(D0[r]=Di.ng&&Di.ng.common&&Di.ng.common.locales&&Di.ng.common.locales[r]),D0[r]}var zr=(()=>((zr=zr||{})[zr.LocaleId=0]="LocaleId",zr[zr.DayPeriodsFormat=1]="DayPeriodsFormat",zr[zr.DayPeriodsStandalone=2]="DayPeriodsStandalone",zr[zr.DaysFormat=3]="DaysFormat",zr[zr.DaysStandalone=4]="DaysStandalone",zr[zr.MonthsFormat=5]="MonthsFormat",zr[zr.MonthsStandalone=6]="MonthsStandalone",zr[zr.Eras=7]="Eras",zr[zr.FirstDayOfWeek=8]="FirstDayOfWeek",zr[zr.WeekendRange=9]="WeekendRange",zr[zr.DateFormat=10]="DateFormat",zr[zr.TimeFormat=11]="TimeFormat",zr[zr.DateTimeFormat=12]="DateTimeFormat",zr[zr.NumberSymbols=13]="NumberSymbols",zr[zr.NumberFormats=14]="NumberFormats",zr[zr.CurrencyCode=15]="CurrencyCode",zr[zr.CurrencySymbol=16]="CurrencySymbol",zr[zr.CurrencyName=17]="CurrencyName",zr[zr.Currencies=18]="Currencies",zr[zr.Directionality=19]="Directionality",zr[zr.PluralCase=20]="PluralCase",zr[zr.ExtraData=21]="ExtraData",zr))();const fb="en-US";let JI=fb;function GC(r,t,e,n,i){if(r=fi(r),Array.isArray(r))for(let o=0;o<r.length;o++)GC(r[o],t,e,n,i);else{const o=Ni(),u=gn();let m=da(r)?r:fi(r.provide),b=Wl(r);const T=jo(),F=1048575&T.providerIndexes,V=T.directiveStart,H=T.providerIndexes>>20;if(da(r)||!r.multi){const J=new wt(b,i,qn),ne=ZC(m,t,i?F:F+H,V);-1===ne?(jt(Ie(T,u),o,m),qC(o,r,t.length),t.push(m),T.directiveStart++,T.directiveEnd++,i&&(T.providerIndexes+=1048576),e.push(J),u.push(J)):(e[ne]=J,u[ne]=J)}else{const J=ZC(m,t,F+H,V),ne=ZC(m,t,F,F+H),we=J>=0&&e[J],Re=ne>=0&&e[ne];if(i&&!Re||!i&&!we){jt(Ie(T,u),o,m);const qe=function(r,t,e,n,i){const o=new wt(r,e,qn);return o.multi=[],o.index=t,o.componentProviders=0,wM(o,i,n&&!e),o}(i?uN:lN,e.length,i,n,b);!i&&Re&&(e[ne].providerFactory=qe),qC(o,r,t.length,0),t.push(m),T.directiveStart++,T.directiveEnd++,i&&(T.providerIndexes+=1048576),e.push(qe),u.push(qe)}else qC(o,r,J>-1?J:ne,wM(e[i?ne:J],b,!i&&n));!i&&n&&Re&&e[ne].componentProviders++}}}function qC(r,t,e,n){const i=da(t),o=function(r){return!!r.useClass}(t);if(i||o){const b=(o?fi(t.useClass):t).prototype.ngOnDestroy;if(b){const T=r.destroyHooks||(r.destroyHooks=[]);if(!i&&t.multi){const F=T.indexOf(e);-1===F?T.push(e,[n,b]):T[F+1].push(n,b)}else T.push(e,b)}}}function wM(r,t,e){return e&&r.componentProviders++,r.multi.push(t)-1}function ZC(r,t,e,n){for(let i=e;i<n;i++)if(t[i]===r)return i;return-1}function lN(r,t,e,n){return HC(this.multi,[])}function uN(r,t,e,n){const i=this.multi;let o;if(this.providerFactory){const u=this.providerFactory.componentProviders,m=Vn(e,e[1],this.providerFactory.index,n);o=m.slice(0,u),HC(i,o);for(let b=u;b<m.length;b++)o.push(m[b])}else o=[],HC(i,o);return o}function HC(r,t){for(let e=0;e<r.length;e++)t.push((0,r[e])());return t}function WC(r,t=[]){return e=>{e.providersResolver=(n,i)=>function(r,t,e){const n=Ni();if(n.firstCreatePass){const i=cs(r);GC(e,n.data,n.blueprint,i,!0),GC(t,n.data,n.blueprint,i,!1)}}(n,i?i(r):r,t)}}class CM{}class dN{resolveComponentFactory(t){throw function(r){const t=Error(`No component factory found for ${Kr(r)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=r,t}(t)}}let Kv=(()=>{class r{}return r.NULL=new dN,r})();function fN(){return P0(jo(),gn())}function P0(r,t){return new fm(Ja(r,t))}let fm=(()=>{class r{constructor(e){this.nativeElement=e}}return r.__NG_ELEMENT_ID__=fN,r})();function mN(r){return r instanceof fm?r.nativeElement:r}class SM{}let jx=(()=>{class r{}return r.__NG_ELEMENT_ID__=()=>function(){const r=gn(),e=ta(jo().index,r);return function(r){return r[11]}(Cl(e)?e:r)}(),r})(),vN=(()=>{class r{}return r.\u0275prov=Hr({token:r,providedIn:"root",factory:()=>null}),r})();class _b{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const _N=new _b("13.1.0"),$C={};function xb(r,t,e,n,i=!1){for(;null!==e;){const o=t[e.index];if(null!==o&&n.push(Vr(o)),us(o))for(let m=10;m<o.length;m++){const b=o[m],T=b[1].firstChild;null!==T&&xb(b[1],b,T,n)}const u=e.type;if(8&u)xb(r,t,e.child,n);else if(32&u){const m=g(e,t);let b;for(;b=m();)n.push(b)}else if(16&u){const m=uu(t,e);if(Array.isArray(m))n.push(...m);else{const b=N(t[16]);xb(b[1],b,m,n,!0)}}e=i?e.projectionNext:e.next}return n}class Ux{constructor(t,e){this._lView=t,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,e=t[1];return xb(e,t,e.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(us(t)){const e=t[8],n=e?e.indexOf(this):-1;n>-1&&(zn(t,n),Zs(e,n))}this._attachedToViewContainer=!1}_r(this._lView[1],this._lView)}onDestroy(t){sm(this._lView[1],this._lView,null,t)}markForCheck(){Ct(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Yt(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(r,t,e){sh(!0);try{Yt(r,t,e)}finally{sh(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){var t;this._appRef=null,vs(this._lView[1],t=this._lView,t[11],2,null,null)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=t}}class xN extends Ux{constructor(t){super(t),this._view=t}detectChanges(){Kn(this._view)}checkNoChanges(){!function(r){sh(!0);try{Kn(r)}finally{sh(!1)}}(this._view)}get context(){return null}}class TM extends Kv{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const e=Ca(t);return new XC(e,this.ngModule)}}function IM(r){const t=[];for(let e in r)r.hasOwnProperty(e)&&t.push({propName:r[e],templateName:e});return t}const wN=new ao("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>Fg});class XC extends CM{constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=t.selectors.map(nm).join(","),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!e}get inputs(){return IM(this.componentDef.inputs)}get outputs(){return IM(this.componentDef.outputs)}create(t,e,n,i){const o=(i=i||this.ngModule)?function(r,t){return{get:(e,n,i)=>{const o=r.get(e,$C,i);return o!==$C||n===$C?o:t.get(e,n,i)}}}(t,i.injector):t,u=o.get(SM,ih),m=o.get(vN,null),b=u.createRenderer(null,this.componentDef),T=this.componentDef.selectors[0][0]||"div",F=n?function(r,t,e){if(to(r))return r.selectRootElement(t,e===ii.ShadowDom);let n="string"==typeof t?r.querySelector(t):t;return n.textContent="",n}(b,n,this.componentDef.encapsulation):pt(u.createRenderer(null,this.componentDef),T,function(r){const t=r.toLowerCase();return"svg"===t?Tl:"math"===t?"http://www.w3.org/1998/MathML/":null}(T)),V=this.componentDef.onPush?576:528,H=function(r,t){return{components:[],scheduler:r||Fg,clean:yn,playerHandler:t||null,flags:0}}(),J=am(0,null,null,1,0,null,null,null,null,null),ne=ch(null,J,H,V,null,null,u,b,m,o);let we,Re;M(ne);try{const qe=function(r,t,e,n,i,o){const u=e[1];e[20]=r;const b=Wd(u,20,2,"#host",null),T=b.mergedAttrs=t.hostAttrs;null!==T&&(Wn(b,T,!0),null!==r&&(tr(i,r,T),null!==b.classes&&nl(i,r,b.classes),null!==b.styles&&Zl(i,r,b.styles)));const F=n.createRenderer(r,t),V=ch(e,zy(t),null,t.onPush?64:16,e[20],b,n,F,o||null,null);return u.firstCreatePass&&(jt(Ie(b,e),u,t.type),p(u,b),A(b,e.length,1)),Tt(e,V),e[20]=V}(F,this.componentDef,ne,u,b);if(F)if(n)tr(b,F,["ng-version",_N.full]);else{const{attrs:Ne,classes:$e}=function(r){const t=[],e=[];let n=1,i=2;for(;n<r.length;){let o=r[n];if("string"==typeof o)2===i?""!==o&&t.push(o,r[++n]):8===i&&e.push(o);else{if(!Qo(i))break;i=o}n++}return{attrs:t,classes:e}}(this.componentDef.selectors[0]);Ne&&tr(b,F,Ne),$e&&$e.length>0&&nl(b,F,$e.join(" "))}if(Re=Wu(J,20),void 0!==e){const Ne=Re.projection=[];for(let $e=0;$e<this.ngContentSelectors.length;$e++){const tt=e[$e];Ne.push(null!=tt?Array.from(tt):null)}}we=function(r,t,e,n,i){const o=e[1],u=function(r,t,e){const n=jo();r.firstCreatePass&&(e.providersResolver&&e.providersResolver(e),R(r,n,t,Uc(r,t,1,null),e));const i=Vn(t,r,n.directiveStart,n);Bc(i,t);const o=Ja(n,t);return o&&Bc(o,t),i}(o,e,t);if(n.components.push(u),r[8]=u,i&&i.forEach(b=>b(u,t)),t.contentQueries){const b=jo();t.contentQueries(1,u,b.directiveStart)}const m=jo();return!o.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(de(m.index),tg(e[1],m,0,m.directiveStart,m.directiveEnd,t),c(t,u)),u}(qe,this.componentDef,ne,H,[$L]),wf(J,ne,null)}finally{Y()}return new SN(this.componentType,we,P0(Re,ne),ne,Re)}}class SN extends class{}{constructor(t,e,n,i,o){super(),this.location=n,this._rootLView=i,this._tNode=o,this.instance=e,this.hostView=this.changeDetectorRef=new xN(i),this.componentType=t}get injector(){return new ci(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}class Kg{}class MM{}const R0=new Map;class kM extends Kg{constructor(t,e){super(),this._parent=e,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new TM(this);const n=Ks(t);this._bootstrapComponents=fo(n.bootstrap),this._r3Injector=Ou(t,e,[{provide:Kg,useValue:this},{provide:Kv,useValue:this.componentFactoryResolver}],Kr(t)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(t)}get(t,e=Fo.THROW_IF_NOT_FOUND,n=oi.Default){return t===Fo||t===Kg||t===Ml?this:this._r3Injector.get(t,e,n)}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class YC extends MM{constructor(t){super(),this.moduleType=t,null!==Ks(t)&&function(r){const t=new Set;!function e(n){const i=Ks(n,!0),o=i.id;null!==o&&(function(r,t,e){if(t&&t!==e)throw new Error(`Duplicate module registered for ${r} - ${Kr(t)} vs ${Kr(t.name)}`)}(o,R0.get(o),n),R0.set(o,n));const u=fo(i.imports);for(const m of u)t.has(m)||(t.add(m),e(m))}(r)}(t)}create(t){return new kM(this.moduleType,t)}}function PM(r,t,e,n,i,o){const u=t+e;return xp(r,u,i)?function(r,t,e){return r[t]=e}(r,u+1,o?n.call(o,i):n(i)):function(r,t){const e=r[t];return e===Fi?void 0:e}(r,u+1)}function Gx(r,t){const e=Ni();let n;const i=r+20;e.firstCreatePass?(n=function(r,t){if(t)for(let e=t.length-1;e>=0;e--){const n=t[e];if(r===n.name)return n}}(t,e.pipeRegistry),e.data[i]=n,n.onDestroy&&(e.destroyHooks||(e.destroyHooks=[])).push(i,n.onDestroy)):n=e.data[i];const o=n.factory||(n.factory=Ds(n.type)),u=eu(qn);try{const m=O(!1),b=o();return O(m),function(r,t,e,n){e>=r.data.length&&(r.data[e]=null,r.blueprint[e]=null),t[e]=n}(e,gn(),i,b),b}finally{eu(u)}}function qx(r,t,e){const n=r+20,i=gn(),o=ds(i,n);return function(r,t){return r[1].data[t].pure}(i,n)?PM(i,function(){const r=Lr.lFrame;let t=r.bindingRootIndex;return-1===t&&(t=r.bindingRootIndex=r.tView.bindingStartIndex),t}(),t,o.transform,e,o):o.transform(e)}function KC(r){return t=>{setTimeout(r,void 0,t)}}const Nn=class extends Er{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,n){var i,o,u;let m=t,b=e||(()=>null),T=n;if(t&&"object"==typeof t){const V=t;m=null===(i=V.next)||void 0===i?void 0:i.bind(V),b=null===(o=V.error)||void 0===o?void 0:o.bind(V),T=null===(u=V.complete)||void 0===u?void 0:u.bind(V)}this.__isAsync&&(b=KC(b),m&&(m=KC(m)),T&&(T=KC(T)));const F=super.subscribe({next:m,error:b,complete:T});return t instanceof ut&&t.add(F),F}};function GN(){return this._results[v0()]()}class JC{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=v0(),n=JC.prototype;n[e]||(n[e]=GN)}get changes(){return this._changes||(this._changes=new Nn)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){const n=this;n.dirty=!1;const i=na(t);(this._changesDetected=!function(r,t,e){if(r.length!==t.length)return!1;for(let n=0;n<r.length;n++){let i=r[n],o=t[n];if(e&&(i=e(i),o=e(o)),o!==i)return!1}return!0}(n._results,i,e))&&(n._results=i,n.length=i.length,n.last=i[this.length-1],n.first=i[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let Qg=(()=>{class r{}return r.__NG_ELEMENT_ID__=HN,r})();const qN=Qg,ZN=class extends qN{constructor(t,e,n){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=n}createEmbeddedView(t){const e=this._declarationTContainer.tViews,n=ch(this._declarationLView,e,t,16,null,e.declTNode,null,null,null,null);n[17]=this._declarationLView[this._declarationTContainer.index];const o=this._declarationLView[19];return null!==o&&(n[19]=o.createEmbeddedView(e)),wf(e,n,t),new Ux(n)}};function HN(){return bb(jo(),gn())}function bb(r,t){return 4&r.type?new ZN(t,r,P0(r,t)):null}let If=(()=>{class r{}return r.__NG_ELEMENT_ID__=WN,r})();function WN(){return BM(jo(),gn())}const $N=If,zM=class extends $N{constructor(t,e,n){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=n}get element(){return P0(this._hostTNode,this._hostLView)}get injector(){return new ci(this._hostTNode,this._hostLView)}get parentInjector(){const t=nt(this._hostTNode,this._hostLView);if(Do(t)){const e=va(t,this._hostLView),n=xo(t);return new ci(e[1].data[n+8],e)}return new ci(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const e=NM(this._lContainer);return null!==e&&e[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,e,n){const i=t.createEmbeddedView(e||{});return this.insert(i,n),i}createComponent(t,e,n,i,o){const u=t&&!function(r){return"function"==typeof r}(t);let m;if(u)m=e;else{const V=e||{};m=V.index,n=V.injector,i=V.projectableNodes,o=V.ngModuleRef}const b=u?t:new XC(Ca(t)),T=n||this.parentInjector;if(!o&&null==b.ngModule&&T){const V=T.get(Kg,null);V&&(o=V)}const F=b.create(T,i,void 0,o);return this.insert(F.hostView,m),F}insert(t,e){const n=t._lView,i=n[1];if(us(n[3])){const F=this.indexOf(t);if(-1!==F)this.detach(F);else{const V=n[3],H=new zM(V,V[6],V[3]);H.detach(H.indexOf(t))}}const o=this._adjustIndex(e),u=this._lContainer;!function(r,t,e,n){const i=10+n,o=e.length;n>0&&(e[i-1][4]=t),n<o-10?(t[4]=e[i],Md(e,10+n,t)):(e.push(t),t[4]=null),t[3]=e;const u=t[17];null!==u&&e!==u&&function(r,t){const e=r[9];t[16]!==t[3][3][16]&&(r[2]=!0),null===e?r[9]=[t]:e.push(t)}(u,t);const m=t[19];null!==m&&m.insertView(r),t[2]|=128}(i,n,u,o);const m=ys(o,u),b=n[11],T=Tr(b,u[7]);return null!==T&&function(r,t,e,n,i,o){n[0]=i,n[6]=t,vs(r,n,e,1,i,o)}(i,u[6],b,n,T,m),t.attachToViewContainerRef(),Md(QC(u),o,t),t}move(t,e){return this.insert(t,e)}indexOf(t){const e=NM(this._lContainer);return null!==e?e.indexOf(t):-1}remove(t){const e=this._adjustIndex(t,-1),n=zn(this._lContainer,e);n&&(Zs(QC(this._lContainer),e),_r(n[1],n))}detach(t){const e=this._adjustIndex(t,-1),n=zn(this._lContainer,e);return n&&null!=Zs(QC(this._lContainer),e)?new Ux(n):null}_adjustIndex(t,e=0){return null==t?this.length+e:t}};function NM(r){return r[8]}function QC(r){return r[8]||(r[8]=[])}function BM(r,t){let e;const n=t[r.index];if(us(n))e=n;else{let i;if(8&r.type)i=Vr(n);else{const o=t[11];i=o.createComment("");const u=Ja(r,t);rr(o,Tr(o,u),i,function(r,t){return to(r)?r.nextSibling(t):t.nextSibling}(o,u),!1)}t[r.index]=e=Ce(n,t,i,r),Tt(t,e)}return new zM(e,r,t)}class eE{constructor(t){this.queryList=t,this.matches=null}clone(){return new eE(this.queryList)}setDirty(){this.queryList.setDirty()}}class tE{constructor(t=[]){this.queries=t}createEmbeddedView(t){const e=t.queries;if(null!==e){const n=null!==t.contentQueries?t.contentQueries[0]:e.length,i=[];for(let o=0;o<n;o++){const u=e.getByIndex(o);i.push(this.queries[u.indexInDeclarationView].clone())}return new tE(i)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)null!==qM(t,e).matches&&this.queries[e].setDirty()}}class jM{constructor(t,e,n=null){this.predicate=t,this.flags=e,this.read=n}}class nE{constructor(t=[]){this.queries=t}elementStart(t,e){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let n=0;n<this.length;n++){const i=null!==e?e.length:0,o=this.getByIndex(n).embeddedTView(t,i);o&&(o.indexInDeclarationView=n,null!==e?e.push(o):e=[o])}return null!==e?new nE(e):null}template(t,e){for(let n=0;n<this.queries.length;n++)this.queries[n].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class rE{constructor(t,e=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new rE(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let n=t.parent;for(;null!==n&&8&n.type&&n.index!==e;)n=n.parent;return e===(null!==n?n.index:-1)}return this._appliesToNextNode}matchTNode(t,e){const n=this.metadata.predicate;if(Array.isArray(n))for(let i=0;i<n.length;i++){const o=n[i];this.matchTNodeWithReadOption(t,e,KN(e,o)),this.matchTNodeWithReadOption(t,e,en(e,t,o,!1,!1))}else n===Qg?4&e.type&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,en(e,t,n,!1,!1))}matchTNodeWithReadOption(t,e,n){if(null!==n){const i=this.metadata.read;if(null!==i)if(i===fm||i===If||i===Qg&&4&e.type)this.addMatch(e.index,-2);else{const o=en(e,t,i,!1,!1);null!==o&&this.addMatch(e.index,o)}else this.addMatch(e.index,n)}}addMatch(t,e){null===this.matches?this.matches=[t,e]:this.matches.push(t,e)}}function KN(r,t){const e=r.localNames;if(null!==e)for(let n=0;n<e.length;n+=2)if(e[n]===t)return e[n+1];return null}function QN(r,t,e,n){return-1===e?function(r,t){return 11&r.type?P0(r,t):4&r.type?bb(r,t):null}(t,r):-2===e?function(r,t,e){return e===fm?P0(t,r):e===Qg?bb(t,r):e===If?BM(t,r):void 0}(r,t,n):Vn(r,r[1],e,t)}function UM(r,t,e,n){const i=t[19].queries[n];if(null===i.matches){const o=r.data,u=e.matches,m=[];for(let b=0;b<u.length;b+=2){const T=u[b];m.push(T<0?null:QN(t,o[T],u[b+1],e.metadata.read))}i.matches=m}return i.matches}function iE(r,t,e,n){const i=r.queries.getByIndex(e),o=i.matches;if(null!==o){const u=UM(r,t,i,e);for(let m=0;m<o.length;m+=2){const b=o[m];if(b>0)n.push(u[m/2]);else{const T=o[m+1],F=t[-b];for(let V=10;V<F.length;V++){const H=F[V];H[17]===H[3]&&iE(H[1],H,T,n)}if(null!==F[9]){const V=F[9];for(let H=0;H<V.length;H++){const J=V[H];iE(J[1],J,T,n)}}}}}return n}function md(r){const t=gn(),e=Ni(),n=f();l(n+1);const i=qM(e,n);if(r.dirty&&Un(t)===(2==(2&i.metadata.flags))){if(null===i.matches)r.reset([]);else{const o=i.crossesNgTemplate?iE(e,t,n,[]):UM(e,t,i,n);r.reset(o,mN),r.notifyOnChanges()}return!0}return!1}function mm(r,t,e){const n=Ni();n.firstCreatePass&&(function(r,t,e){null===r.queries&&(r.queries=new nE),r.queries.track(new rE(t,e))}(n,new jM(r,t,e),-1),2==(2&t)&&(n.staticViewQueries=!0)),function(r,t,e){const n=new JC(4==(4&e));sm(r,t,n,n.destroy),null===t[19]&&(t[19]=new tE),t[19].queries.push(new eE(n))}(n,gn(),t)}function gd(){return r=gn(),t=f(),r[19].queries[t].queryList;var r,t}function qM(r,t){return r.queries.getByIndex(t)}function Sb(...r){}const Tb=new ao("Application Initializer");let L0=(()=>{class r{constructor(e){this.appInits=e,this.resolve=Sb,this.reject=Sb,this.initialized=!1,this.done=!1,this.donePromise=new Promise((n,i)=>{this.resolve=n,this.reject=i})}runInitializers(){if(this.initialized)return;const e=[],n=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let i=0;i<this.appInits.length;i++){const o=this.appInits[i]();if(ub(o))e.push(o);else if(oI(o)){const u=new Promise((m,b)=>{o.subscribe({complete:m,error:b})});e.push(u)}}Promise.all(e).then(()=>{n()}).catch(i=>{this.reject(i)}),0===e.length&&n(),this.initialized=!0}}return r.\u0275fac=function(e){return new(e||r)(Xn(Tb,8))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();const Wx=new ao("AppId"),x3={provide:Wx,useFactory:function(){return`${cE()}${cE()}${cE()}`},deps:[]};function cE(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const lA=new ao("Platform Initializer"),Ib=new ao("Platform ID"),uA=new ao("appBootstrapListener");let cA=(()=>{class r{log(e){console.log(e)}warn(e){console.warn(e)}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();const jy=new ao("LocaleId"),hA=new ao("DefaultCurrencyCode");class b3{constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}}let Mb=(()=>{class r{compileModuleSync(e){return new YC(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const n=this.compileModuleSync(e),o=fo(Ks(e).declarations).reduce((u,m)=>{const b=Ca(m);return b&&u.push(new XC(b)),u},[]);return new b3(n,o)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();const C3=(()=>Promise.resolve(0))();function hE(r){"undefined"==typeof Zone?C3.then(()=>{r&&r.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",r)}class bc{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:n=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Nn(!1),this.onMicrotaskEmpty=new Nn(!1),this.onStable=new Nn(!1),this.onError=new Nn(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const i=this;i._nesting=0,i._outer=i._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!n&&e,i.shouldCoalesceRunChangeDetection=n,i.lastRequestAnimationFrameId=-1,i.nativeRequestAnimationFrame=function(){let r=Di.requestAnimationFrame,t=Di.cancelAnimationFrame;if("undefined"!=typeof Zone&&r&&t){const e=r[Zone.__symbol__("OriginalDelegate")];e&&(r=e);const n=t[Zone.__symbol__("OriginalDelegate")];n&&(t=n)}return{nativeRequestAnimationFrame:r,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function(r){const t=()=>{!function(r){r.isCheckStableRunning||-1!==r.lastRequestAnimationFrameId||(r.lastRequestAnimationFrameId=r.nativeRequestAnimationFrame.call(Di,()=>{r.fakeTopEventTask||(r.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{r.lastRequestAnimationFrameId=-1,dE(r),r.isCheckStableRunning=!0,pE(r),r.isCheckStableRunning=!1},void 0,()=>{},()=>{})),r.fakeTopEventTask.invoke()}),dE(r))}(r)};r._inner=r._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,n,i,o,u,m)=>{try{return pA(r),e.invokeTask(i,o,u,m)}finally{(r.shouldCoalesceEventChangeDetection&&"eventTask"===o.type||r.shouldCoalesceRunChangeDetection)&&t(),dA(r)}},onInvoke:(e,n,i,o,u,m,b)=>{try{return pA(r),e.invoke(i,o,u,m,b)}finally{r.shouldCoalesceRunChangeDetection&&t(),dA(r)}},onHasTask:(e,n,i,o)=>{e.hasTask(i,o),n===i&&("microTask"==o.change?(r._hasPendingMicrotasks=o.microTask,dE(r),pE(r)):"macroTask"==o.change&&(r.hasPendingMacrotasks=o.macroTask))},onHandleError:(e,n,i,o)=>(e.handleError(i,o),r.runOutsideAngular(()=>r.onError.emit(o)),!1)})}(i)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!bc.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(bc.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,e,n){return this._inner.run(t,e,n)}runTask(t,e,n,i){const o=this._inner,u=o.scheduleEventTask("NgZoneEvent: "+i,t,S3,Sb,Sb);try{return o.runTask(u,e,n)}finally{o.cancelTask(u)}}runGuarded(t,e,n){return this._inner.runGuarded(t,e,n)}runOutsideAngular(t){return this._outer.run(t)}}const S3={};function pE(r){if(0==r._nesting&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function dE(r){r.hasPendingMicrotasks=!!(r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&-1!==r.lastRequestAnimationFrameId)}function pA(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function dA(r){r._nesting--,pE(r)}class M3{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Nn,this.onMicrotaskEmpty=new Nn,this.onStable=new Nn,this.onError=new Nn}run(t,e,n){return t.apply(e,n)}runGuarded(t,e,n){return t.apply(e,n)}runOutsideAngular(t){return t()}runTask(t,e,n,i){return t.apply(e,n)}}let fE=(()=>{class r{constructor(e){this._ngZone=e,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{bc.assertNotInAngularZone(),hE(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())hE(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(n=>!n.updateCb||!n.updateCb(e)||(clearTimeout(n.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,n,i){let o=-1;n&&n>0&&(o=setTimeout(()=>{this._callbacks=this._callbacks.filter(u=>u.timeoutId!==o),e(this._didWork,this.getPendingTasks())},n)),this._callbacks.push({doneCb:e,timeoutId:o,updateCb:i})}whenStable(e,n,i){if(i&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,n,i),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(e,n,i){return[]}}return r.\u0275fac=function(e){return new(e||r)(Xn(bc))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})(),fA=(()=>{class r{constructor(){this._applications=new Map,mE.addToWindow(this)}registerApplication(e,n){this._applications.set(e,n)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,n=!0){return mE.findTestabilityInTree(this,e,n)}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();class A3{addToWindow(t){}findTestabilityInTree(t,e,n){return null}}let gm,mE=new A3;const mA=new ao("AllowMultipleToken");class gA{constructor(t,e){this.name=t,this.token=e}}function yA(r,t,e=[]){const n=`Platform: ${t}`,i=new ao(n);return(o=[])=>{let u=vA();if(!u||u.injector.get(mA,!1))if(r)r(e.concat(o).concat({provide:i,useValue:!0}));else{const m=e.concat(o).concat({provide:i,useValue:!0},{provide:Ru,useValue:"platform"});!function(r){if(gm&&!gm.destroyed&&!gm.injector.get(mA,!1))throw new Fr("400","");gm=r.get(_A);const t=r.get(lA,null);t&&t.forEach(e=>e())}(Fo.create({providers:m,name:n}))}return function(r){const t=vA();if(!t)throw new Fr("401","");return t}()}}function vA(){return gm&&!gm.destroyed?gm:null}let _A=(()=>{class r{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,n){const m=function(r,t){let e;return e="noop"===r?new M3:("zone.js"===r?void 0:r)||new bc({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==t?void 0:t.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==t?void 0:t.ngZoneRunCoalescing)}),e}(n?n.ngZone:void 0,{ngZoneEventCoalescing:n&&n.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:n&&n.ngZoneRunCoalescing||!1}),b=[{provide:bc,useValue:m}];return m.run(()=>{const T=Fo.create({providers:b,parent:this.injector,name:e.moduleType.name}),F=e.create(T),V=F.injector.get(em,null);if(!V)throw new Fr("402","");return m.runOutsideAngular(()=>{const H=m.onError.subscribe({next:J=>{V.handleError(J)}});F.onDestroy(()=>{gE(this._modules,F),H.unsubscribe()})}),function(r,t,e){try{const n=e();return ub(n)?n.catch(i=>{throw t.runOutsideAngular(()=>r.handleError(i)),i}):n}catch(n){throw t.runOutsideAngular(()=>r.handleError(n)),n}}(V,m,()=>{const H=F.injector.get(L0);return H.runInitializers(),H.donePromise.then(()=>(function(r){Yi(r,"Expected localeId to be defined"),"string"==typeof r&&(JI=r.toLowerCase().replace(/_/g,"-"))}(F.injector.get(jy,fb)||fb),this._moduleDoBootstrap(F),F))})})}bootstrapModule(e,n=[]){const i=xA({},n);return function(r,t,e){const n=new YC(e);return Promise.resolve(n)}(0,0,e).then(o=>this.bootstrapModuleFactory(o,i))}_moduleDoBootstrap(e){const n=e.injector.get(F0);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(i=>n.bootstrap(i));else{if(!e.instance.ngDoBootstrap)throw new Fr("403","");e.instance.ngDoBootstrap(n)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Fr("404","");this._modules.slice().forEach(e=>e.destroy()),this._destroyListeners.forEach(e=>e()),this._destroyed=!0}get destroyed(){return this._destroyed}}return r.\u0275fac=function(e){return new(e||r)(Xn(Fo))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();function xA(r,t){return Array.isArray(t)?t.reduce(xA,r):Object.assign(Object.assign({},r),t)}let F0=(()=>{class r{constructor(e,n,i,o,u){this._zone=e,this._injector=n,this._exceptionHandler=i,this._componentFactoryResolver=o,this._initStatus=u,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const m=new ct(T=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{T.next(this._stable),T.complete()})}),b=new ct(T=>{let F;this._zone.runOutsideAngular(()=>{F=this._zone.onStable.subscribe(()=>{bc.assertNotInAngularZone(),hE(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,T.next(!0))})})});const V=this._zone.onUnstable.subscribe(()=>{bc.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{T.next(!1)}))});return()=>{F.unsubscribe(),V.unsubscribe()}});this.isStable=function(...r){const t=Xt(r),e=function(r,t){return"number"==typeof Rt(r)?r.pop():1/0}(r),n=r;return n.length?1===n.length?Da(n[0]):Se(e)(qt(n,t)):He}(m,b.pipe(function(r={}){const{connector:t=(()=>new Er),resetOnError:e=!0,resetOnComplete:n=!0,resetOnRefCountZero:i=!0}=r;return o=>{let u=null,m=null,b=null,T=0,F=!1,V=!1;const H=()=>{null==m||m.unsubscribe(),m=null},J=()=>{H(),u=b=null,F=V=!1},ne=()=>{const we=u;J(),null==we||we.unsubscribe()};return Xi((we,Re)=>{T++,!V&&!F&&H();const qe=b=null!=b?b:t();Re.add(()=>{T--,0===T&&!V&&!F&&(m=Yr(ne,i))}),qe.subscribe(Re),u||(u=new Rn({next:Ne=>qe.next(Ne),error:Ne=>{V=!0,H(),m=Yr(J,e,Ne),qe.error(Ne)},complete:()=>{F=!0,H(),m=Yr(J,n),qe.complete()}}),qt(we).subscribe(u))})(o)}}()))}bootstrap(e,n){if(!this._initStatus.done)throw new Fr("405","");let i;i=e instanceof CM?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(i.componentType);const o=function(r){return r.isBoundToModule}(i)?void 0:this._injector.get(Kg),m=i.create(Fo.NULL,[],n||i.selector,o),b=m.location.nativeElement,T=m.injector.get(fE,null),F=T&&m.injector.get(fA);return T&&F&&F.registerApplication(b,T),m.onDestroy(()=>{this.detachView(m.hostView),gE(this.components,m),F&&F.unregisterApplication(b)}),this._loadComponent(m),m}tick(){if(this._runningTick)throw new Fr("101","");try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const n=e;this._views.push(n),n.attachToAppRef(this)}detachView(e){const n=e;gE(this._views,n),n.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(uA,[]).concat(this._bootstrapListeners).forEach(i=>i(e))}ngOnDestroy(){this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return r.\u0275fac=function(e){return new(e||r)(Xn(bc),Xn(Fo),Xn(em),Xn(Kv),Xn(L0))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();function gE(r,t){const e=r.indexOf(t);e>-1&&r.splice(e,1)}let wA=!0,Ab=(()=>{class r{}return r.__NG_ELEMENT_ID__=j3,r})();function j3(r){return function(r,t,e){if(Wh(r)&&!e){const n=ta(r.index,t);return new Ux(n,n)}return 47&r.type?new Ux(t[16],t):null}(jo(),gn(),16==(16&r))}class AA{constructor(){}supports(t){return Rx(t)}create(t){return new W3(t)}}const H3=(r,t)=>t;class W3{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||H3}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,n=this._removalsHead,i=0,o=null;for(;e||n;){const u=!n||e&&e.currentIndex<kA(n,i,o)?e:n,m=kA(u,i,o),b=u.currentIndex;if(u===n)i--,n=n._nextRemoved;else if(e=e._next,null==u.previousIndex)i++;else{o||(o=[]);const T=m-i,F=b-i;if(T!=F){for(let H=0;H<T;H++){const J=H<o.length?o[H]:o[H]=0,ne=J+H;F<=ne&&ne<T&&(o[H]=J+1)}o[u.previousIndex]=F-T}}m!==b&&t(u,m,b)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!Rx(t))throw new Error(`Error trying to diff '${Kr(t)}'. Only arrays and iterables are allowed`);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let i,o,u,e=this._itHead,n=!1;if(Array.isArray(t)){this.length=t.length;for(let m=0;m<this.length;m++)o=t[m],u=this._trackByFn(m,o),null!==e&&Object.is(e.trackById,u)?(n&&(e=this._verifyReinsertion(e,o,u,m)),Object.is(e.item,o)||this._addIdentityChange(e,o)):(e=this._mismatch(e,o,u,m),n=!0),e=e._next}else i=0,function(r,t){if(Array.isArray(r))for(let e=0;e<r.length;e++)t(r[e]);else{const e=r[v0()]();let n;for(;!(n=e.next()).done;)t(n.value)}}(t,m=>{u=this._trackByFn(i,m),null!==e&&Object.is(e.trackById,u)?(n&&(e=this._verifyReinsertion(e,m,u,i)),Object.is(e.item,m)||this._addIdentityChange(e,m)):(e=this._mismatch(e,m,u,i),n=!0),e=e._next,i++}),this.length=i;return this._truncate(e),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,n,i){let o;return null===t?o=this._itTail:(o=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,o,i)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(n,i))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,o,i)):t=this._addAfter(new $3(e,n),o,i),t}_verifyReinsertion(t,e,n,i){let o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==o?t=this._reinsertAfter(o,t._prev,i):t.currentIndex!=i&&(t.currentIndex=i,this._addToMoves(t,i)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const i=t._prevRemoved,o=t._nextRemoved;return null===i?this._removalsHead=o:i._nextRemoved=o,null===o?this._removalsTail=i:o._prevRemoved=i,this._insertAfter(t,e,n),this._addToMoves(t,n),t}_moveAfter(t,e,n){return this._unlink(t),this._insertAfter(t,e,n),this._addToMoves(t,n),t}_addAfter(t,e,n){return this._insertAfter(t,e,n),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,n){const i=null===e?this._itHead:e._next;return t._next=i,t._prev=e,null===i?this._itTail=t:i._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new DA),this._linkedRecords.put(t),t.currentIndex=n,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,n=t._next;return null===e?this._itHead=n:e._next=n,null===n?this._itTail=e:n._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new DA),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class $3{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class X3{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===e||e<=n.currentIndex)&&Object.is(n.trackById,t))return n;return null}remove(t){const e=t._prevDup,n=t._nextDup;return null===e?this._head=n:e._nextDup=n,null===n?this._tail=e:n._prevDup=e,null===this._head}}class DA{constructor(){this.map=new Map}put(t){const e=t.trackById;let n=this.map.get(e);n||(n=new X3,this.map.set(e,n)),n.add(t)}get(t,e){const i=this.map.get(t);return i?i.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function kA(r,t,e){const n=r.previousIndex;if(null===n)return n;let i=0;return e&&n<e.length&&(i=e[n]),n+t+i}class PA{constructor(){}supports(t){return t instanceof Map||DC(t)}create(){return new Y3}}class Y3{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||DC(t)))throw new Error(`Error trying to diff '${Kr(t)}'. Only maps and objects are allowed`)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(n,i)=>{if(e&&e.key===i)this._maybeAddToChanges(e,n),this._appendAfter=e,e=e._next;else{const o=this._getOrCreateRecordForKey(i,n);e=this._insertBeforeOrAppend(e,o)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let n=e;null!==n;n=n._nextRemoved)n===this._mapHead&&(this._mapHead=null),this._records.delete(n.key),n._nextRemoved=n._next,n.previousValue=n.currentValue,n.currentValue=null,n._prev=null,n._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const n=t._prev;return e._next=t,e._prev=n,t._prev=e,n&&(n._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const i=this._records.get(t);this._maybeAddToChanges(i,e);const o=i._prev,u=i._next;return o&&(o._next=u),u&&(u._prev=o),i._next=null,i._prev=null,i}const n=new K3(t);return this._records.set(t,n),n.currentValue=e,this._addToAdditions(n),n}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){Object.is(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(n=>e(t[n],n))}}class K3{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function RA(){return new $x([new AA])}let $x=(()=>{class r{constructor(e){this.factories=e}static create(e,n){if(null!=n){const i=n.factories.slice();e=e.concat(i)}return new r(e)}static extend(e){return{provide:r,useFactory:n=>r.create(e,n||RA()),deps:[[r,new Pd,new po]]}}find(e){const n=this.factories.find(i=>i.supports(e));if(null!=n)return n;throw new Error(`Cannot find a differ supporting object '${e}' of type '${function(r){return r.name||typeof r}(e)}'`)}}return r.\u0275prov=Hr({token:r,providedIn:"root",factory:RA}),r})();function OA(){return new z0([new PA])}let z0=(()=>{class r{constructor(e){this.factories=e}static create(e,n){if(n){const i=n.factories.slice();e=e.concat(i)}return new r(e)}static extend(e){return{provide:r,useFactory:n=>r.create(e,n||OA()),deps:[[r,new Pd,new po]]}}find(e){const n=this.factories.find(i=>i.supports(e));if(n)return n;throw new Error(`Cannot find a differ supporting object '${e}'`)}}return r.\u0275prov=Hr({token:r,providedIn:"root",factory:OA}),r})();const Q3=[new PA],t5=new $x([new AA]),n5=new z0(Q3),r5=yA(null,"core",[{provide:Ib,useValue:"unknown"},{provide:_A,deps:[Fo]},{provide:fA,deps:[]},{provide:cA,deps:[]}]),l5=[{provide:F0,useClass:F0,deps:[bc,Fo,em,Kv,L0]},{provide:wN,deps:[bc],useFactory:function(r){let t=[];return r.onStable.subscribe(()=>{for(;t.length;)t.pop()()}),function(e){t.push(e)}}},{provide:L0,useClass:L0,deps:[[new po,Tb]]},{provide:Mb,useClass:Mb,deps:[]},x3,{provide:$x,useFactory:function(){return t5},deps:[]},{provide:z0,useFactory:function(){return n5},deps:[]},{provide:jy,useFactory:function(r){return r||"undefined"!=typeof $localize&&$localize.locale||fb},deps:[[new Pm(jy),new po,new Pd]]},{provide:hA,useValue:"USD"}];let c5=(()=>{class r{constructor(e){}}return r.\u0275fac=function(e){return new(e||r)(Xn(F0))},r.\u0275mod=Gi({type:r}),r.\u0275inj=io({providers:l5}),r})(),kb=null;function Uy(){return kb}const Xd=new ao("DocumentToken");let Qv=(()=>{class r{historyGo(e){throw new Error("Not implemented")}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=Hr({token:r,factory:function(){return Xn(LA)},providedIn:"platform"}),r})();const m5=new ao("Location Initialized");let LA=(()=>{class r extends Qv{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Uy().getBaseHref(this._doc)}onPopState(e){const n=Uy().getGlobalEventTarget(this._doc,"window");return n.addEventListener("popstate",e,!1),()=>n.removeEventListener("popstate",e)}onHashChange(e){const n=Uy().getGlobalEventTarget(this._doc,"window");return n.addEventListener("hashchange",e,!1),()=>n.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,n,i){FA()?this._history.pushState(e,n,i):this.location.hash=i}replaceState(e,n,i){FA()?this._history.replaceState(e,n,i):this.location.hash=i}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return r.\u0275fac=function(e){return new(e||r)(Xn(Xd))},r.\u0275prov=Hr({token:r,factory:function(){return new LA(Xn(Xd))},providedIn:"platform"}),r})();function FA(){return!!window.history.pushState}function bE(r,t){if(0==r.length)return t;if(0==t.length)return r;let e=0;return r.endsWith("/")&&e++,t.startsWith("/")&&e++,2==e?r+t.substring(1):1==e?r+t:r+"/"+t}function zA(r){const t=r.match(/#|\?|$/),e=t&&t.index||r.length;return r.slice(0,e-("/"===r[e-1]?1:0))+r.slice(e)}function ey(r){return r&&"?"!==r[0]?"?"+r:r}let N0=(()=>{class r{historyGo(e){throw new Error("Not implemented")}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=Hr({token:r,factory:function(){return function(r){const t=Xn(Xd).location;return new NA(Xn(Qv),t&&t.origin||"")}()},providedIn:"root"}),r})();const wE=new ao("appBaseHref");let NA=(()=>{class r extends N0{constructor(e,n){if(super(),this._platformLocation=e,this._removeListenerFns=[],null==n&&(n=this._platformLocation.getBaseHrefFromDOM()),null==n)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=n}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return bE(this._baseHref,e)}path(e=!1){const n=this._platformLocation.pathname+ey(this._platformLocation.search),i=this._platformLocation.hash;return i&&e?`${n}${i}`:n}pushState(e,n,i,o){const u=this.prepareExternalUrl(i+ey(o));this._platformLocation.pushState(e,n,u)}replaceState(e,n,i,o){const u=this.prepareExternalUrl(i+ey(o));this._platformLocation.replaceState(e,n,u)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var n,i;null===(i=(n=this._platformLocation).historyGo)||void 0===i||i.call(n,e)}}return r.\u0275fac=function(e){return new(e||r)(Xn(Qv),Xn(wE,8))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})(),v5=(()=>{class r extends N0{constructor(e,n){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=n&&(this._baseHref=n)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let n=this._platformLocation.hash;return null==n&&(n="#"),n.length>0?n.substring(1):n}prepareExternalUrl(e){const n=bE(this._baseHref,e);return n.length>0?"#"+n:n}pushState(e,n,i,o){let u=this.prepareExternalUrl(i+ey(o));0==u.length&&(u=this._platformLocation.pathname),this._platformLocation.pushState(e,n,u)}replaceState(e,n,i,o){let u=this.prepareExternalUrl(i+ey(o));0==u.length&&(u=this._platformLocation.pathname),this._platformLocation.replaceState(e,n,u)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var n,i;null===(i=(n=this._platformLocation).historyGo)||void 0===i||i.call(n,e)}}return r.\u0275fac=function(e){return new(e||r)(Xn(Qv),Xn(wE,8))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})(),CE=(()=>{class r{constructor(e,n){this._subject=new Nn,this._urlChangeListeners=[],this._platformStrategy=e;const i=this._platformStrategy.getBaseHref();this._platformLocation=n,this._baseHref=zA(BA(i)),this._platformStrategy.onPopState(o=>{this._subject.emit({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}path(e=!1){return this.normalize(this._platformStrategy.path(e))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(e,n=""){return this.path()==this.normalize(e+ey(n))}normalize(e){return r.stripTrailingSlash(function(r,t){return r&&t.startsWith(r)?t.substring(r.length):t}(this._baseHref,BA(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}go(e,n="",i=null){this._platformStrategy.pushState(i,"",e,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+ey(n)),i)}replaceState(e,n="",i=null){this._platformStrategy.replaceState(i,"",e,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+ey(n)),i)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(e=0){var n,i;null===(i=(n=this._platformStrategy).historyGo)||void 0===i||i.call(n,e)}onUrlChange(e){this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(n=>{this._notifyUrlChangeListeners(n.url,n.state)}))}_notifyUrlChangeListeners(e="",n){this._urlChangeListeners.forEach(i=>i(e,n))}subscribe(e,n,i){return this._subject.subscribe({next:e,error:n,complete:i})}}return r.normalizeQueryParams=ey,r.joinWithSlash=bE,r.stripTrailingSlash=zA,r.\u0275fac=function(e){return new(e||r)(Xn(N0),Xn(Qv))},r.\u0275prov=Hr({token:r,factory:function(){return new CE(Xn(N0),Xn(Qv))},providedIn:"root"}),r})();function BA(r){return r.replace(/\/index.html$/,"")}var qc=(()=>((qc=qc||{})[qc.Zero=0]="Zero",qc[qc.One=1]="One",qc[qc.Two=2]="Two",qc[qc.Few=3]="Few",qc[qc.Many=4]="Many",qc[qc.Other=5]="Other",qc))();const I5=function(r){return function(r){const t=function(r){return r.toLowerCase().replace(/_/g,"-")}(r);let e=KI(t);if(e)return e;const n=t.split("-")[0];if(e=KI(n),e)return e;if("en"===n)return hz;throw new Error(`Missing locale data for the locale "${r}".`)}(r)[zr.PluralCase]};class Ub{}let nB=(()=>{class r extends Ub{constructor(e){super(),this.locale=e}getPluralCategory(e,n){switch(I5(n||this.locale)(e)){case qc.Zero:return"zero";case qc.One:return"one";case qc.Two:return"two";case qc.Few:return"few";case qc.Many:return"many";default:return"other"}}}return r.\u0275fac=function(e){return new(e||r)(Xn(jy))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();function $A(r,t){t=encodeURIComponent(t);for(const e of r.split(";")){const n=e.indexOf("="),[i,o]=-1==n?[e,""]:[e.slice(0,n),e.slice(n+1)];if(i.trim()===t)return decodeURIComponent(o)}return null}let Kx=(()=>{class r{constructor(e,n,i,o){this._iterableDiffers=e,this._keyValueDiffers=n,this._ngEl=i,this._renderer=o,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(Rx(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){const e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}_applyKeyValueChanges(e){e.forEachAddedItem(n=>this._toggleClass(n.key,n.currentValue)),e.forEachChangedItem(n=>this._toggleClass(n.key,n.currentValue)),e.forEachRemovedItem(n=>{n.previousValue&&this._toggleClass(n.key,!1)})}_applyIterableChanges(e){e.forEachAddedItem(n=>{if("string"!=typeof n.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${Kr(n.item)}`);this._toggleClass(n.item,!0)}),e.forEachRemovedItem(n=>this._toggleClass(n.item,!1))}_applyClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(n=>this._toggleClass(n,!0)):Object.keys(e).forEach(n=>this._toggleClass(n,!!e[n])))}_removeClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(n=>this._toggleClass(n,!1)):Object.keys(e).forEach(n=>this._toggleClass(n,!1)))}_toggleClass(e,n){(e=e.trim())&&e.split(/\s+/g).forEach(i=>{n?this._renderer.addClass(this._ngEl.nativeElement,i):this._renderer.removeClass(this._ngEl.nativeElement,i)})}}return r.\u0275fac=function(e){return new(e||r)(qn($x),qn(z0),qn(fm),qn(jx))},r.\u0275dir=Pa({type:r,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),r})();class iB{constructor(t,e,n,i){this.$implicit=t,this.ngForOf=e,this.index=n,this.count=i}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let B0=(()=>{class r{constructor(e,n,i){this._viewContainer=e,this._template=n,this._differs=i,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const n=this._viewContainer;e.forEachOperation((i,o,u)=>{if(null==i.previousIndex)n.createEmbeddedView(this._template,new iB(i.item,this._ngForOf,-1,-1),null===u?void 0:u);else if(null==u)n.remove(null===o?void 0:o);else if(null!==o){const m=n.get(o);n.move(m,u),XA(m,i)}});for(let i=0,o=n.length;i<o;i++){const m=n.get(i).context;m.index=i,m.count=o,m.ngForOf=this._ngForOf}e.forEachIdentityChange(i=>{XA(n.get(i.currentIndex),i)})}static ngTemplateContextGuard(e,n){return!0}}return r.\u0275fac=function(e){return new(e||r)(qn(If),qn(Qg),qn($x))},r.\u0275dir=Pa({type:r,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),r})();function XA(r,t){r.context.$implicit=t.item}let Vy=(()=>{class r{constructor(e,n){this._viewContainer=e,this._context=new oB,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=n}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){YA("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){YA("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,n){return!0}}return r.\u0275fac=function(e){return new(e||r)(qn(If),qn(Qg))},r.\u0275dir=Pa({type:r,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),r})();class oB{constructor(){this.$implicit=null,this.ngIf=null}}function YA(r,t){if(t&&!t.createEmbeddedView)throw new Error(`${r} must be a TemplateRef, but received '${Kr(t)}'.`)}class PE{constructor(t,e){this._viewContainerRef=t,this._templateRef=e,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(t){t&&!this._created?this.create():!t&&this._created&&this.destroy()}}let Vb=(()=>{class r{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(e){this._ngSwitch=e,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(e){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(e)}_matchCase(e){const n=e==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||n,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),n}_updateDefaultCases(e){if(this._defaultViews&&e!==this._defaultUsed){this._defaultUsed=e;for(let n=0;n<this._defaultViews.length;n++)this._defaultViews[n].enforceState(e)}}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275dir=Pa({type:r,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"}}),r})(),KA=(()=>{class r{constructor(e,n,i){this.ngSwitch=i,i._addCase(),this._view=new PE(e,n)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return r.\u0275fac=function(e){return new(e||r)(qn(If),qn(Qg),qn(Vb,9))},r.\u0275dir=Pa({type:r,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"}}),r})(),JA=(()=>{class r{constructor(e,n,i){i._addDefault(new PE(e,n))}}return r.\u0275fac=function(e){return new(e||r)(qn(If),qn(Qg),qn(Vb,9))},r.\u0275dir=Pa({type:r,selectors:[["","ngSwitchDefault",""]]}),r})(),eD=(()=>{class r{constructor(e,n,i){this._ngEl=e,this._differs=n,this._renderer=i,this._ngStyle=null,this._differ=null}set ngStyle(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}ngDoCheck(){if(this._differ){const e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}_setStyle(e,n){const[i,o]=e.split(".");null!=(n=null!=n&&o?`${n}${o}`:n)?this._renderer.setStyle(this._ngEl.nativeElement,i,n):this._renderer.removeStyle(this._ngEl.nativeElement,i)}_applyChanges(e){e.forEachRemovedItem(n=>this._setStyle(n.key,null)),e.forEachAddedItem(n=>this._setStyle(n.key,n.currentValue)),e.forEachChangedItem(n=>this._setStyle(n.key,n.currentValue))}}return r.\u0275fac=function(e){return new(e||r)(qn(fm),qn(z0),qn(jx))},r.\u0275dir=Pa({type:r,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}}),r})(),RE=(()=>{class r{constructor(e){this._viewContainerRef=e,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null}ngOnChanges(e){if(e.ngTemplateOutlet){const n=this._viewContainerRef;this._viewRef&&n.remove(n.indexOf(this._viewRef)),this._viewRef=this.ngTemplateOutlet?n.createEmbeddedView(this.ngTemplateOutlet,this.ngTemplateOutletContext):null}else this._viewRef&&e.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return r.\u0275fac=function(e){return new(e||r)(qn(If))},r.\u0275dir=Pa({type:r,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet"},features:[Lo]}),r})(),tD=(()=>{class r{transform(e){return JSON.stringify(e,null,2)}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275pipe=Ms({name:"json",type:r,pure:!1}),r})(),OE=(()=>{class r{constructor(e){this.differs=e,this.keyValues=[],this.compareFn=nD}transform(e,n=nD){if(!e||!(e instanceof Map)&&"object"!=typeof e)return null;this.differ||(this.differ=this.differs.find(e).create());const i=this.differ.diff(e),o=n!==this.compareFn;return i&&(this.keyValues=[],i.forEachItem(u=>{this.keyValues.push(function(r,t){return{key:r,value:t}}(u.key,u.currentValue))})),(i||o)&&(this.keyValues.sort(n),this.compareFn=n),this.keyValues}}return r.\u0275fac=function(e){return new(e||r)(qn(z0,16))},r.\u0275pipe=Ms({name:"keyvalue",type:r,pure:!1}),r})();function nD(r,t){const e=r.key,n=t.key;if(e===n)return 0;if(void 0===e)return 1;if(void 0===n)return-1;if(null===e)return 1;if(null===n)return-1;if("string"==typeof e&&"string"==typeof n)return e<n?-1:1;if("number"==typeof e&&"number"==typeof n)return e-n;if("boolean"==typeof e&&"boolean"==typeof n)return e<n?-1:1;const i=String(e),o=String(n);return i==o?0:i<o?-1:1}let Df=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=Gi({type:r}),r.\u0275inj=io({providers:[{provide:Ub,useClass:nB}]}),r})();let AB=(()=>{class r{}return r.\u0275prov=Hr({token:r,providedIn:"root",factory:()=>new DB(Xn(Xd),window)}),r})();class DB{constructor(t,e){this.document=t,this.window=e,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const e=function(r,t){const e=r.getElementById(t)||r.getElementsByName(t)[0];if(e)return e;if("function"==typeof r.createTreeWalker&&r.body&&(r.body.createShadowRoot||r.body.attachShadow)){const n=r.createTreeWalker(r.body,NodeFilter.SHOW_ELEMENT);let i=n.currentNode;for(;i;){const o=i.shadowRoot;if(o){const u=o.getElementById(t)||o.querySelector(`[name="${t}"]`);if(u)return u}i=n.nextNode()}}return null}(this.document,t);e&&(this.scrollToElement(e),this.attemptFocus(e))}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}}scrollToElement(t){const e=t.getBoundingClientRect(),n=e.left+this.window.pageXOffset,i=e.top+this.window.pageYOffset,o=this.offset();this.window.scrollTo(n-o[0],i-o[1])}attemptFocus(t){return t.focus(),this.document.activeElement===t}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=iD(this.window.history)||iD(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch(t){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(t){return!1}}}function iD(r){return Object.getOwnPropertyDescriptor(r,"scrollRestoration")}class oD{}class zE extends class extends class{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){var r;r=new zE,kb||(kb=r)}onAndCancel(t,e,n){return t.addEventListener(e,n,!1),()=>{t.removeEventListener(e,n,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getBaseHref(t){const e=(Jx=Jx||document.querySelector("base"),Jx?Jx.getAttribute("href"):null);return null==e?null:function(r){Gb=Gb||document.createElement("a"),Gb.setAttribute("href",r);const t=Gb.pathname;return"/"===t.charAt(0)?t:`/${t}`}(e)}resetBaseElement(){Jx=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return $A(document.cookie,t)}}let Gb,Jx=null;const aD=new ao("TRANSITION_ID"),FB=[{provide:Tb,useFactory:function(r,t,e){return()=>{e.get(L0).donePromise.then(()=>{const n=Uy(),i=t.querySelectorAll(`style[ng-transition="${r}"]`);for(let o=0;o<i.length;o++)n.remove(i[o])})}},deps:[aD,Xd,Fo],multi:!0}];class NE{static init(){var r;r=new NE,mE=r}addToWindow(t){Di.getAngularTestability=(n,i=!0)=>{const o=t.findTestabilityInTree(n,i);if(null==o)throw new Error("Could not find testability for element.");return o},Di.getAllAngularTestabilities=()=>t.getAllTestabilities(),Di.getAllAngularRootElements=()=>t.getAllRootElements(),Di.frameworkStabilizers||(Di.frameworkStabilizers=[]),Di.frameworkStabilizers.push(n=>{const i=Di.getAllAngularTestabilities();let o=i.length,u=!1;const m=function(b){u=u||b,o--,0==o&&n(u)};i.forEach(function(b){b.whenStable(m)})})}findTestabilityInTree(t,e,n){if(null==e)return null;const i=t.getTestability(e);return null!=i?i:n?Uy().isShadowRoot(e)?this.findTestabilityInTree(t,e.host,!0):this.findTestabilityInTree(t,e.parentElement,!0):null}}let zB=(()=>{class r{build(){return new XMLHttpRequest}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();const qb=new ao("EventManagerPlugins");let Zb=(()=>{class r{constructor(e,n){this._zone=n,this._eventNameToPlugin=new Map,e.forEach(i=>i.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,n,i){return this._findPluginFor(n).addEventListener(e,n,i)}addGlobalEventListener(e,n,i){return this._findPluginFor(n).addGlobalEventListener(e,n,i)}getZone(){return this._zone}_findPluginFor(e){const n=this._eventNameToPlugin.get(e);if(n)return n;const i=this._plugins;for(let o=0;o<i.length;o++){const u=i[o];if(u.supports(e))return this._eventNameToPlugin.set(e,u),u}throw new Error(`No event manager plugin found for event ${e}`)}}return r.\u0275fac=function(e){return new(e||r)(Xn(qb),Xn(bc))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();class sD{constructor(t){this._doc=t}addGlobalEventListener(t,e,n){const i=Uy().getGlobalEventTarget(this._doc,t);if(!i)throw new Error(`Unsupported event target ${i} for event ${e}`);return this.addEventListener(i,e,n)}}let lD=(()=>{class r{constructor(){this._stylesSet=new Set}addStyles(e){const n=new Set;e.forEach(i=>{this._stylesSet.has(i)||(this._stylesSet.add(i),n.add(i))}),this.onStylesAdded(n)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})(),Qx=(()=>{class r extends lD{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,n,i){e.forEach(o=>{const u=this._doc.createElement("style");u.textContent=o,i.push(n.appendChild(u))})}addHost(e){const n=[];this._addStylesToHost(this._stylesSet,e,n),this._hostNodes.set(e,n)}removeHost(e){const n=this._hostNodes.get(e);n&&n.forEach(uD),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((n,i)=>{this._addStylesToHost(e,i,n)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(uD))}}return r.\u0275fac=function(e){return new(e||r)(Xn(Xd))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();function uD(r){Uy().remove(r)}const BE={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},jE=/%COMP%/g;function Hb(r,t,e){for(let n=0;n<t.length;n++){let i=t[n];Array.isArray(i)?Hb(r,i,e):(i=i.replace(jE,r),e.push(i))}return e}function pD(r){return t=>{if("__ngUnwrap__"===t)return r;!1===r(t)&&(t.preventDefault(),t.returnValue=!1)}}let UE=(()=>{class r{constructor(e,n,i){this.eventManager=e,this.sharedStylesHost=n,this.appId=i,this.rendererByCompId=new Map,this.defaultRenderer=new VE(e)}createRenderer(e,n){if(!e||!n)return this.defaultRenderer;switch(n.encapsulation){case ii.Emulated:{let i=this.rendererByCompId.get(n.id);return i||(i=new GB(this.eventManager,this.sharedStylesHost,n,this.appId),this.rendererByCompId.set(n.id,i)),i.applyToHost(e),i}case 1:case ii.ShadowDom:return new qB(this.eventManager,this.sharedStylesHost,e,n);default:if(!this.rendererByCompId.has(n.id)){const i=Hb(n.id,n.styles,[]);this.sharedStylesHost.addStyles(i),this.rendererByCompId.set(n.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return r.\u0275fac=function(e){return new(e||r)(Xn(Zb),Xn(Qx),Xn(Wx))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();class VE{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,e){return e?document.createElementNS(BE[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){t.appendChild(e)}insertBefore(t,e,n){t&&t.insertBefore(e,n)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let n="string"==typeof t?document.querySelector(t):t;if(!n)throw new Error(`The selector "${t}" did not match any elements`);return e||(n.textContent=""),n}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,n,i){if(i){e=i+":"+e;const o=BE[i];o?t.setAttributeNS(o,e,n):t.setAttribute(e,n)}else t.setAttribute(e,n)}removeAttribute(t,e,n){if(n){const i=BE[n];i?t.removeAttributeNS(i,e):t.removeAttribute(`${n}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,n,i){i&(s.DashCase|s.Important)?t.style.setProperty(e,n,i&s.Important?"important":""):t.style[e]=n}removeStyle(t,e,n){n&s.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,n){t[e]=n}setValue(t,e){t.nodeValue=e}listen(t,e,n){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,pD(n)):this.eventManager.addEventListener(t,e,pD(n))}}class GB extends VE{constructor(t,e,n,i){super(t),this.component=n;const o=Hb(i+"-"+n.id,n.styles,[]);e.addStyles(o),this.contentAttr="_ngcontent-%COMP%".replace(jE,i+"-"+n.id),this.hostAttr=function(r){return"_nghost-%COMP%".replace(jE,r)}(i+"-"+n.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const n=super.createElement(t,e);return super.setAttribute(n,this.contentAttr,""),n}}class qB extends VE{constructor(t,e,n,i){super(t),this.sharedStylesHost=e,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const o=Hb(i.id,i.styles,[]);for(let u=0;u<o.length;u++){const m=document.createElement("style");m.textContent=o[u],this.shadowRoot.appendChild(m)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,n){return super.insertBefore(this.nodeOrShadowRoot(t),e,n)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let ZB=(()=>{class r extends sD{constructor(e){super(e)}supports(e){return!0}addEventListener(e,n,i){return e.addEventListener(n,i,!1),()=>this.removeEventListener(e,n,i)}removeEventListener(e,n,i){return e.removeEventListener(n,i)}}return r.\u0275fac=function(e){return new(e||r)(Xn(Xd))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();const fD=["alt","control","meta","shift"],WB={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},mD={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},$B={alt:r=>r.altKey,control:r=>r.ctrlKey,meta:r=>r.metaKey,shift:r=>r.shiftKey};let XB=(()=>{class r extends sD{constructor(e){super(e)}supports(e){return null!=r.parseEventName(e)}addEventListener(e,n,i){const o=r.parseEventName(n),u=r.eventCallback(o.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Uy().onAndCancel(e,o.domEventName,u))}static parseEventName(e){const n=e.toLowerCase().split("."),i=n.shift();if(0===n.length||"keydown"!==i&&"keyup"!==i)return null;const o=r._normalizeKey(n.pop());let u="";if(fD.forEach(b=>{const T=n.indexOf(b);T>-1&&(n.splice(T,1),u+=b+".")}),u+=o,0!=n.length||0===o.length)return null;const m={};return m.domEventName=i,m.fullKey=u,m}static getEventFullKey(e){let n="",i=function(r){let t=r.key;if(null==t){if(t=r.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===r.location&&mD.hasOwnProperty(t)&&(t=mD[t]))}return WB[t]||t}(e);return i=i.toLowerCase()," "===i?i="space":"."===i&&(i="dot"),fD.forEach(o=>{o!=i&&$B[o](e)&&(n+=o+".")}),n+=i,n}static eventCallback(e,n,i){return o=>{r.getEventFullKey(o)===e&&i.runGuarded(()=>n(o))}}static _normalizeKey(e){return"esc"===e?"escape":e}}return r.\u0275fac=function(e){return new(e||r)(Xn(Xd))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();const e4=yA(r5,"browser",[{provide:Ib,useValue:"browser"},{provide:lA,useValue:function(){zE.makeCurrent(),NE.init()},multi:!0},{provide:Xd,useFactory:function(){return r=document,Js=r,document;var r},deps:[]}]),t4=[{provide:Ru,useValue:"root"},{provide:em,useFactory:function(){return new em},deps:[]},{provide:qb,useClass:ZB,multi:!0,deps:[Xd,bc,Ib]},{provide:qb,useClass:XB,multi:!0,deps:[Xd]},{provide:UE,useClass:UE,deps:[Zb,Qx,Wx]},{provide:SM,useExisting:UE},{provide:lD,useExisting:Qx},{provide:Qx,useClass:Qx,deps:[Xd]},{provide:fE,useClass:fE,deps:[bc]},{provide:Zb,useClass:Zb,deps:[qb,bc]},{provide:oD,useClass:zB,deps:[]}];let n4=(()=>{class r{constructor(e){if(e)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(e){return{ngModule:r,providers:[{provide:Wx,useValue:e.appId},{provide:aD,useExisting:Wx},FB]}}}return r.\u0275fac=function(e){return new(e||r)(Xn(r,12))},r.\u0275mod=Gi({type:r}),r.\u0275inj=io({providers:t4,imports:[Df,c5]}),r})();"undefined"!=typeof window&&window;var Wb=Ht(347);function _D(r,t,e,n){return new(e||(e=Promise))(function(o,u){function m(F){try{T(n.next(F))}catch(V){u(V)}}function b(F){try{T(n.throw(F))}catch(V){u(V)}}function T(F){F.done?o(F.value):function(o){return o instanceof e?o:new e(function(u){u(o)})}(F.value).then(m,b)}T((n=n.apply(r,t||[])).next())})}class wD extends Er{constructor(){super(...arguments),this._value=null,this._hasValue=!1,this._isComplete=!1}_checkFinalizedStatuses(t){const{hasError:e,_hasValue:n,_value:i,thrownError:o,isStopped:u,_isComplete:m}=this;e?t.error(o):(u||m)&&(n&&t.next(i),t.complete())}next(t){this.isStopped||(this._value=t,this._hasValue=!0)}complete(){const{_hasValue:t,_value:e,_isComplete:n}=this;n||(this._isComplete=!0,t&&super.next(e),super.complete())}}const Xb=Jt(r=>function(){r(this),this.name="EmptyError",this.message="no elements in sequence"});function e_(r,t){return Xi((e,n)=>{let i=0;e.subscribe(new Vi(n,o=>r.call(t,o,i++)&&n.next(o)))})}function CD(r){return Xi((t,e)=>{let n=!1;t.subscribe(new Vi(e,i=>{n=!0,e.next(i)},()=>{n||e.next(r),e.complete()}))})}function ED(r=g4){return Xi((t,e)=>{let n=!1;t.subscribe(new Vi(e,i=>{n=!0,e.next(i)},()=>n?e.complete():e.error(r())))})}function g4(){return new Xb}function t_(r,t){const e=arguments.length>=2;return n=>n.pipe(r?e_((i,o)=>r(i,o,n)):qr,wn(1),e?CD(t):ED(()=>new Xb))}const y4=["container"];let ZE=(()=>{class r{constructor(e){this.zone=e,this.mapCreated=new wD,this.mapLoaded=new wD,this.markersToRemove=[],this.popupsToRemove=[],this.imageIdsToRemove=[],this.subscription=new ut,this.mapCreated$=this.mapCreated.asObservable(),this.mapLoaded$=this.mapLoaded.asObservable()}setup(e){this.zone.onStable.pipe(t_()).subscribe(()=>{e.customMapboxApiUrl&&this.assign(Wb,"config.API_URL",e.customMapboxApiUrl),this.createMap(e.mapOptions),this.hookEvents(e.mapEvents),this.mapEvents=e.mapEvents,this.mapCreated.next(void 0),this.mapCreated.complete()})}destroyMap(){this.mapInstance&&(this.subscription.unsubscribe(),this.mapInstance.remove())}updateMinZoom(e){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMinZoom(e)})}updateMaxZoom(e){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxZoom(e)})}updateMinPitch(e){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMinPitch(e)})}updateMaxPitch(e){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxPitch(e)})}updateRenderWorldCopies(e){return this.zone.runOutsideAngular(()=>{this.mapInstance.setRenderWorldCopies(e)})}updateScrollZoom(e){return this.zone.runOutsideAngular(()=>{e?this.mapInstance.scrollZoom.enable():this.mapInstance.scrollZoom.disable()})}updateDragRotate(e){return this.zone.runOutsideAngular(()=>{e?this.mapInstance.dragRotate.enable():this.mapInstance.dragRotate.disable()})}updateTouchPitch(e){return this.zone.runOutsideAngular(()=>{e?this.mapInstance.touchPitch.enable():this.mapInstance.touchPitch.disable()})}updateTouchZoomRotate(e){return this.zone.runOutsideAngular(()=>{e?this.mapInstance.touchZoomRotate.enable():this.mapInstance.touchZoomRotate.disable()})}updateDoubleClickZoom(e){return this.zone.runOutsideAngular(()=>{e?this.mapInstance.doubleClickZoom.enable():this.mapInstance.doubleClickZoom.disable()})}updateKeyboard(e){return this.zone.runOutsideAngular(()=>{e?this.mapInstance.keyboard.enable():this.mapInstance.keyboard.disable()})}updateDragPan(e){return this.zone.runOutsideAngular(()=>{e?this.mapInstance.dragPan.enable():this.mapInstance.dragPan.disable()})}updateBoxZoom(e){return this.zone.runOutsideAngular(()=>{e?this.mapInstance.boxZoom.enable():this.mapInstance.boxZoom.disable()})}updateStyle(e){return this.zone.runOutsideAngular(()=>{this.mapInstance.setStyle(e)})}updateMaxBounds(e){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxBounds(e)})}changeCanvasCursor(e){this.mapInstance.getCanvasContainer().style.cursor=e}queryRenderedFeatures(e,n){return this.mapInstance.queryRenderedFeatures(e,n)}panTo(e,n){return this.zone.runOutsideAngular(()=>{this.mapInstance.panTo(e,n)})}move(e,n,i,o,u,m){return this.zone.runOutsideAngular(()=>{this.mapInstance[e](Object.assign(Object.assign({},n),{zoom:i||this.mapInstance.getZoom(),center:o||this.mapInstance.getCenter(),bearing:u||this.mapInstance.getBearing(),pitch:m||this.mapInstance.getPitch()}))})}addLayer(e,n,i){this.zone.runOutsideAngular(()=>{Object.keys(e.layerOptions).forEach(o=>{void 0===e.layerOptions[o]&&delete e.layerOptions[o]}),this.mapInstance.addLayer(e.layerOptions,i),n&&((e.layerEvents.layerClick.observers.length||e.layerEvents.click.observers.length)&&this.mapInstance.on("click",e.layerOptions.id,o=>{this.zone.run(()=>{e.layerEvents.layerClick.emit(o),e.layerEvents.click.emit(o)})}),(e.layerEvents.layerDblClick.observers.length||e.layerEvents.dblClick.observers.length)&&this.mapInstance.on("dblclick",e.layerOptions.id,o=>{this.zone.run(()=>{e.layerEvents.layerDblClick.emit(o),e.layerEvents.dblClick.emit(o)})}),(e.layerEvents.layerMouseDown.observers.length||e.layerEvents.mouseDown.observers.length)&&this.mapInstance.on("mousedown",e.layerOptions.id,o=>{this.zone.run(()=>{e.layerEvents.layerMouseDown.emit(o),e.layerEvents.mouseDown.emit(o)})}),(e.layerEvents.layerMouseUp.observers.length||e.layerEvents.mouseUp.observers.length)&&this.mapInstance.on("mouseup",e.layerOptions.id,o=>{this.zone.run(()=>{e.layerEvents.layerMouseUp.emit(o),e.layerEvents.mouseUp.emit(o)})}),(e.layerEvents.layerMouseEnter.observers.length||e.layerEvents.mouseEnter.observers.length)&&this.mapInstance.on("mouseenter",e.layerOptions.id,o=>{this.zone.run(()=>{e.layerEvents.layerMouseEnter.emit(o),e.layerEvents.mouseEnter.emit(o)})}),(e.layerEvents.layerMouseLeave.observers.length||e.layerEvents.mouseLeave.observers.length)&&this.mapInstance.on("mouseleave",e.layerOptions.id,o=>{this.zone.run(()=>{e.layerEvents.layerMouseLeave.emit(o),e.layerEvents.mouseLeave.emit(o)})}),(e.layerEvents.layerMouseMove.observers.length||e.layerEvents.mouseMove.observers.length)&&this.mapInstance.on("mousemove",e.layerOptions.id,o=>{this.zone.run(()=>{e.layerEvents.layerMouseMove.emit(o),e.layerEvents.mouseMove.emit(o)})}),(e.layerEvents.layerMouseOver.observers.length||e.layerEvents.mouseOver.observers.length)&&this.mapInstance.on("mouseover",e.layerOptions.id,o=>{this.zone.run(()=>{e.layerEvents.layerMouseOver.emit(o),e.layerEvents.mouseOver.emit(o)})}),(e.layerEvents.layerMouseOut.observers.length||e.layerEvents.mouseOut.observers.length)&&this.mapInstance.on("mouseout",e.layerOptions.id,o=>{this.zone.run(()=>{e.layerEvents.layerMouseOut.emit(o),e.layerEvents.mouseOut.emit(o)})}),(e.layerEvents.layerContextMenu.observers.length||e.layerEvents.contextMenu.observers.length)&&this.mapInstance.on("contextmenu",e.layerOptions.id,o=>{this.zone.run(()=>{e.layerEvents.layerContextMenu.emit(o),e.layerEvents.contextMenu.emit(o)})}),(e.layerEvents.layerTouchStart.observers.length||e.layerEvents.touchStart.observers.length)&&this.mapInstance.on("touchstart",e.layerOptions.id,o=>{this.zone.run(()=>{e.layerEvents.layerTouchStart.emit(o),e.layerEvents.touchStart.emit(o)})}),(e.layerEvents.layerTouchEnd.observers.length||e.layerEvents.touchEnd.observers.length)&&this.mapInstance.on("touchend",e.layerOptions.id,o=>{this.zone.run(()=>{e.layerEvents.layerTouchEnd.emit(o),e.layerEvents.touchEnd.emit(o)})}),(e.layerEvents.layerTouchCancel.observers.length||e.layerEvents.touchCancel.observers.length)&&this.mapInstance.on("touchcancel",e.layerOptions.id,o=>{this.zone.run(()=>{e.layerEvents.layerTouchCancel.emit(o),e.layerEvents.touchCancel.emit(o)})}))})}removeLayer(e){this.zone.runOutsideAngular(()=>{null!=this.mapInstance.getLayer(e)&&this.mapInstance.removeLayer(e)})}addMarker(e){const n={offset:e.markersOptions.offset,anchor:e.markersOptions.anchor,draggable:!!e.markersOptions.draggable,rotationAlignment:e.markersOptions.rotationAlignment,pitchAlignment:e.markersOptions.pitchAlignment,clickTolerance:e.markersOptions.clickTolerance};e.markersOptions.element.childNodes.length>0&&(n.element=e.markersOptions.element);const i=new Wb.Marker(n);return(e.markersEvents.markerDragStart.observers.length||e.markersEvents.dragStart.observers.length)&&i.on("dragstart",u=>{if(u){const{target:m}=u;this.zone.run(()=>{e.markersEvents.markerDragStart.emit(m),e.markersEvents.dragStart.emit(m)})}}),(e.markersEvents.markerDrag.observers.length||e.markersEvents.drag.observers.length)&&i.on("drag",u=>{if(u){const{target:m}=u;this.zone.run(()=>{e.markersEvents.markerDrag.emit(m),e.markersEvents.drag.emit(m)})}}),(e.markersEvents.markerDragEnd.observers.length||e.markersEvents.dragEnd.observers.length)&&i.on("dragend",u=>{if(u){const{target:m}=u;this.zone.run(()=>{e.markersEvents.markerDragEnd.emit(m),e.markersEvents.dragEnd.emit(m)})}}),i.setLngLat(e.markersOptions.feature?e.markersOptions.feature.geometry.coordinates:e.markersOptions.lngLat),this.zone.runOutsideAngular(()=>(i.addTo(this.mapInstance),i))}removeMarker(e){this.markersToRemove.push(e)}createPopup(e,n){return this.zone.runOutsideAngular(()=>{Object.keys(e.popupOptions).forEach(o=>void 0===e.popupOptions[o]&&delete e.popupOptions[o]);const i=new Wb.Popup(e.popupOptions);return i.setDOMContent(n),(e.popupEvents.popupClose.observers.length||e.popupEvents.close.observers.length)&&i.on("close",()=>{this.zone.run(()=>{e.popupEvents.popupClose.emit(),e.popupEvents.close.emit()})}),(e.popupEvents.popupOpen.observers.length||e.popupEvents.open.observers.length)&&i.on("open",()=>{this.zone.run(()=>{e.popupEvents.popupOpen.emit(),e.popupEvents.open.emit()})}),i})}addPopupToMap(e,n,i=!1){return this.zone.runOutsideAngular(()=>{i&&e._listeners&&delete e._listeners.open,e.setLngLat(n),e.addTo(this.mapInstance)})}addPopupToMarker(e,n){return this.zone.runOutsideAngular(()=>{e.setPopup(n)})}removePopupFromMap(e,n=!1){n&&e._listeners&&delete e._listeners.close,this.popupsToRemove.push(e)}removePopupFromMarker(e){return this.zone.runOutsideAngular(()=>{e.setPopup(void 0)})}addControl(e,n){return this.zone.runOutsideAngular(()=>{this.mapInstance.addControl(e,n)})}removeControl(e){return this.zone.runOutsideAngular(()=>{this.mapInstance.removeControl(e)})}loadAndAddImage(e,n,i){return _D(this,void 0,void 0,function*(){return this.zone.runOutsideAngular(()=>new Promise((o,u)=>{this.mapInstance.loadImage(n,(m,b)=>{m?u(m):(this.addImage(e,b,i),o())})}))})}addImage(e,n,i){return this.zone.runOutsideAngular(()=>{this.mapInstance.addImage(e,n,i)})}removeImage(e){this.imageIdsToRemove.push(e)}addSource(e,n){return this.zone.runOutsideAngular(()=>{Object.keys(n).forEach(i=>void 0===n[i]&&delete n[i]),this.mapInstance.addSource(e,n)})}getSource(e){return this.mapInstance.getSource(e)}removeSource(e){this.zone.runOutsideAngular(()=>{this.findLayersBySourceId(e).forEach(n=>this.mapInstance.removeLayer(n.id)),this.mapInstance.removeSource(e)})}setAllLayerPaintProperty(e,n){return this.zone.runOutsideAngular(()=>{Object.keys(n).forEach(i=>{this.mapInstance.setPaintProperty(e,i,n[i])})})}setAllLayerLayoutProperty(e,n){return this.zone.runOutsideAngular(()=>{Object.keys(n).forEach(i=>{this.mapInstance.setLayoutProperty(e,i,n[i])})})}setLayerFilter(e,n){return this.zone.runOutsideAngular(()=>{this.mapInstance.setFilter(e,n)})}setLayerBefore(e,n){return this.zone.runOutsideAngular(()=>{this.mapInstance.moveLayer(e,n)})}setLayerZoomRange(e,n,i){return this.zone.runOutsideAngular(()=>{this.mapInstance.setLayerZoomRange(e,n||0,i||20)})}fitBounds(e,n){return this.zone.runOutsideAngular(()=>{this.mapInstance.fitBounds(e,n)})}fitScreenCoordinates(e,n,i){return this.zone.runOutsideAngular(()=>{this.mapInstance.fitScreenCoordinates(e[0],e[1],n,i)})}applyChanges(){this.zone.runOutsideAngular(()=>{this.removeMarkers(),this.removePopups(),this.removeImages()})}createMap(e){bc.assertNotInAngularZone(),Object.keys(e).forEach(i=>{void 0===e[i]&&delete e[i]}),this.mapInstance=new Wb.Map(e),window&&/msie\s|trident\/|edge\//i.test(window.navigator.userAgent)&&this.mapInstance.setStyle(e.style),this.subscription.add(this.zone.onMicrotaskEmpty.subscribe(()=>this.applyChanges()))}removeMarkers(){for(const e of this.markersToRemove)e.remove();this.markersToRemove=[]}removePopups(){for(const e of this.popupsToRemove)e.remove();this.popupsToRemove=[]}removeImages(){for(const e of this.imageIdsToRemove)this.mapInstance.removeImage(e);this.imageIdsToRemove=[]}findLayersBySourceId(e){const n=this.mapInstance.getStyle().layers;return null==n?[]:n.filter(i=>"source"in i&&i.source===e)}hookEvents(e){this.mapInstance.on("load",n=>{this.mapLoaded.next(void 0),this.mapLoaded.complete(),this.zone.run(()=>{e.mapLoad.emit(n.target),e.load.emit(n.target)})}),(e.mapResize.observers.length||e.resize.observers.length)&&this.mapInstance.on("resize",n=>this.zone.run(()=>{e.mapResize.emit(n),e.resize.emit(n)})),(e.mapRemove.observers.length||e.remove.observers.length)&&this.mapInstance.on("remove",n=>this.zone.run(()=>{e.mapRemove.emit(n),e.remove.emit(n)})),(e.mapMouseDown.observers.length||e.mouseDown.observers.length)&&this.mapInstance.on("mousedown",n=>this.zone.run(()=>{e.mapMouseDown.emit(n),e.mouseDown.emit(n)})),(e.mapMouseUp.observers.length||e.mouseUp.observers.length)&&this.mapInstance.on("mouseup",n=>this.zone.run(()=>{e.mapMouseUp.emit(n),e.mouseUp.emit(n)})),(e.mapMouseMove.observers.length||e.mouseMove.observers.length)&&this.mapInstance.on("mousemove",n=>this.zone.run(()=>{e.mapMouseMove.emit(n),e.mouseMove.emit(n)})),(e.mapClick.observers.length||e.click.observers.length)&&this.mapInstance.on("click",n=>this.zone.run(()=>{e.mapClick.emit(n),e.click.emit(n)})),(e.mapDblClick.observers.length||e.dblClick.observers.length)&&this.mapInstance.on("dblclick",n=>this.zone.run(()=>{e.mapDblClick.emit(n),e.dblClick.emit(n)})),(e.mapMouseOver.observers.length||e.mouseOver.observers.length)&&this.mapInstance.on("mouseover",n=>this.zone.run(()=>{e.mapMouseOver.emit(n),e.mouseOver.emit(n)})),(e.mapMouseOut.observers.length||e.mouseOut.observers.length)&&this.mapInstance.on("mouseout",n=>this.zone.run(()=>{e.mapMouseOut.emit(n),e.mouseOut.emit(n)})),(e.mapContextMenu.observers.length||e.contextMenu.observers.length)&&this.mapInstance.on("contextmenu",n=>this.zone.run(()=>{e.mapContextMenu.emit(n),e.contextMenu.emit(n)})),(e.mapTouchStart.observers.length||e.touchStart.observers.length)&&this.mapInstance.on("touchstart",n=>this.zone.run(()=>{e.mapTouchStart.emit(n),e.touchStart.emit(n)})),(e.mapTouchEnd.observers.length||e.touchEnd.observers.length)&&this.mapInstance.on("touchend",n=>this.zone.run(()=>{e.mapTouchEnd.emit(n),e.touchEnd.emit(n)})),(e.mapTouchMove.observers.length||e.touchMove.observers.length)&&this.mapInstance.on("touchmove",n=>this.zone.run(()=>{e.mapTouchMove.emit(n),e.touchMove.emit(n)})),(e.mapTouchCancel.observers.length||e.touchCancel.observers.length)&&this.mapInstance.on("touchcancel",n=>this.zone.run(()=>{e.mapTouchCancel.emit(n),e.touchCancel.emit(n)})),(e.mapWheel.observers.length||e.wheel.observers.length)&&this.mapInstance.on("wheel",n=>this.zone.run(()=>{e.mapWheel.emit(n),e.wheel.emit(n)})),e.moveStart.observers.length&&this.mapInstance.on("movestart",n=>this.zone.run(()=>e.moveStart.emit(n))),e.move.observers.length&&this.mapInstance.on("move",n=>this.zone.run(()=>e.move.emit(n))),e.moveEnd.observers.length&&this.mapInstance.on("moveend",n=>this.zone.run(()=>e.moveEnd.emit(n))),(e.mapDragStart.observers.length||e.dragStart.observers.length)&&this.mapInstance.on("dragstart",n=>this.zone.run(()=>{e.mapDragStart.emit(n),e.dragStart.emit(n)})),(e.mapDrag.observers.length||e.drag.observers.length)&&this.mapInstance.on("drag",n=>this.zone.run(()=>{e.mapDrag.emit(n),e.drag.emit(n)})),(e.mapDragEnd.observers.length||e.dragEnd.observers.length)&&this.mapInstance.on("dragend",n=>this.zone.run(()=>{e.mapDragEnd.emit(n),e.dragEnd.emit(n)})),e.zoomStart.observers.length&&this.mapInstance.on("zoomstart",n=>this.zone.run(()=>e.zoomStart.emit(n))),e.zoomEvt.observers.length&&this.mapInstance.on("zoom",n=>this.zone.run(()=>e.zoomEvt.emit(n))),e.zoomEnd.observers.length&&this.mapInstance.on("zoomend",n=>this.zone.run(()=>e.zoomEnd.emit(n))),e.rotateStart.observers.length&&this.mapInstance.on("rotatestart",n=>this.zone.run(()=>e.rotateStart.emit(n))),e.rotate.observers.length&&this.mapInstance.on("rotate",n=>this.zone.run(()=>e.rotate.emit(n))),e.rotateEnd.observers.length&&this.mapInstance.on("rotateend",n=>this.zone.run(()=>e.rotateEnd.emit(n))),e.pitchStart.observers.length&&this.mapInstance.on("pitchstart",n=>this.zone.run(()=>e.pitchStart.emit(n))),e.pitchEvt.observers.length&&this.mapInstance.on("pitch",n=>this.zone.run(()=>e.pitchEvt.emit(n))),e.pitchEnd.observers.length&&this.mapInstance.on("pitchend",n=>this.zone.run(()=>e.pitchEnd.emit(n))),e.boxZoomStart.observers.length&&this.mapInstance.on("boxzoomstart",n=>this.zone.run(()=>e.boxZoomStart.emit(n))),e.boxZoomEnd.observers.length&&this.mapInstance.on("boxzoomend",n=>this.zone.run(()=>e.boxZoomEnd.emit(n))),e.boxZoomCancel.observers.length&&this.mapInstance.on("boxzoomcancel",n=>this.zone.run(()=>e.boxZoomCancel.emit(n))),e.webGlContextLost.observers.length&&this.mapInstance.on("webglcontextlost",n=>this.zone.run(()=>e.webGlContextLost.emit(n))),e.webGlContextRestored.observers.length&&this.mapInstance.on("webglcontextrestored",n=>this.zone.run(()=>e.webGlContextRestored.emit(n))),e.render.observers.length&&this.mapInstance.on("render",n=>this.zone.run(()=>e.render.emit(n))),(e.mapError.observers.length||e.error.observers.length)&&this.mapInstance.on("error",n=>this.zone.run(()=>{e.mapError.emit(n),e.error.emit(n)})),e.data.observers.length&&this.mapInstance.on("data",n=>this.zone.run(()=>e.data.emit(n))),e.styleData.observers.length&&this.mapInstance.on("styledata",n=>this.zone.run(()=>e.styleData.emit(n))),e.sourceData.observers.length&&this.mapInstance.on("sourcedata",n=>this.zone.run(()=>e.sourceData.emit(n))),e.dataLoading.observers.length&&this.mapInstance.on("dataloading",n=>this.zone.run(()=>e.dataLoading.emit(n))),e.styleDataLoading.observers.length&&this.mapInstance.on("styledataloading",n=>this.zone.run(()=>e.styleDataLoading.emit(n))),e.sourceDataLoading.observers.length&&this.mapInstance.on("sourcedataloading",n=>this.zone.run(()=>e.sourceDataLoading.emit(n))),e.styleImageMissing.observers.length&&this.mapInstance.on("styleimagemissing",n=>this.zone.run(()=>e.styleImageMissing.emit(n))),e.idle.observers.length&&this.mapInstance.on("idle",n=>this.zone.run(()=>e.idle.emit(n)))}assign(e,n,i){if("string"==typeof n&&(n=n.split(".")),n.length>1){const o=n.shift();this.assign(e[o]="[object Object]"===Object.prototype.toString.call(e[o])?e[o]:{},n,i)}else e[n[0]]=i}}return r.\u0275fac=function(e){return new(e||r)(Xn(bc))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();function w4(r,t,e){console.warn(`[ngx-maplibre-gl]: ${r}: ${t} is deprecated, please use ${e} instead.`)}let C4=(()=>{class r{constructor(e){this.MapService=e,this.movingMethod="flyTo",this.mapResize=new Nn,this.mapRemove=new Nn,this.mapMouseDown=new Nn,this.mapMouseUp=new Nn,this.mapMouseMove=new Nn,this.mapClick=new Nn,this.mapDblClick=new Nn,this.mapMouseOver=new Nn,this.mapMouseOut=new Nn,this.mapContextMenu=new Nn,this.mapTouchStart=new Nn,this.mapTouchEnd=new Nn,this.mapTouchMove=new Nn,this.mapTouchCancel=new Nn,this.mapWheel=new Nn,this.moveStart=new Nn,this.move=new Nn,this.moveEnd=new Nn,this.mapDragStart=new Nn,this.mapDrag=new Nn,this.mapDragEnd=new Nn,this.zoomStart=new Nn,this.zoomEvt=new Nn,this.zoomEnd=new Nn,this.rotateStart=new Nn,this.rotate=new Nn,this.rotateEnd=new Nn,this.pitchStart=new Nn,this.pitchEvt=new Nn,this.pitchEnd=new Nn,this.boxZoomStart=new Nn,this.boxZoomEnd=new Nn,this.boxZoomCancel=new Nn,this.webGlContextLost=new Nn,this.webGlContextRestored=new Nn,this.mapLoad=new Nn,this.idle=new Nn,this.render=new Nn,this.mapError=new Nn,this.data=new Nn,this.styleData=new Nn,this.sourceData=new Nn,this.dataLoading=new Nn,this.styleDataLoading=new Nn,this.sourceDataLoading=new Nn,this.styleImageMissing=new Nn,this.resize=new Nn,this.remove=new Nn,this.mouseDown=new Nn,this.mouseUp=new Nn,this.mouseMove=new Nn,this.click=new Nn,this.dblClick=new Nn,this.mouseOver=new Nn,this.mouseOut=new Nn,this.contextMenu=new Nn,this.touchStart=new Nn,this.touchEnd=new Nn,this.touchMove=new Nn,this.touchCancel=new Nn,this.wheel=new Nn,this.dragStart=new Nn,this.drag=new Nn,this.dragEnd=new Nn,this.load=new Nn,this.error=new Nn}get mapInstance(){return this.MapService.mapInstance}ngAfterViewInit(){this.warnDeprecatedOutputs(),this.MapService.setup({customMapboxApiUrl:this.customMapboxApiUrl,mapOptions:{collectResourceTiming:this.collectResourceTiming,container:this.mapContainer.nativeElement,crossSourceCollisions:this.crossSourceCollisions,fadeDuration:this.fadeDuration,minZoom:this.minZoom,maxZoom:this.maxZoom,minPitch:this.minPitch,maxPitch:this.maxPitch,style:this.style,hash:this.hash,interactive:this.interactive,bearingSnap:this.bearingSnap,pitchWithRotate:this.pitchWithRotate,clickTolerance:this.clickTolerance,attributionControl:this.attributionControl,logoPosition:this.logoPosition,failIfMajorPerformanceCaveat:this.failIfMajorPerformanceCaveat,preserveDrawingBuffer:this.preserveDrawingBuffer,refreshExpiredTiles:this.refreshExpiredTiles,maxBounds:this.maxBounds,scrollZoom:this.scrollZoom,boxZoom:this.boxZoom,dragRotate:this.dragRotate,dragPan:this.dragPan,keyboard:this.keyboard,doubleClickZoom:this.doubleClickZoom,touchPitch:this.touchPitch,touchZoomRotate:this.touchZoomRotate,trackResize:this.trackResize,center:this.center,zoom:this.zoom,bearing:this.bearing,pitch:this.pitch,renderWorldCopies:this.renderWorldCopies,maxTileCacheSize:this.maxTileCacheSize,localIdeographFontFamily:this.localIdeographFontFamily,transformRequest:this.transformRequest,bounds:this.bounds?this.bounds:this.fitBounds,fitBoundsOptions:this.fitBoundsOptions,antialias:this.antialias,locale:this.locale},mapEvents:this}),this.cursorStyle&&this.MapService.changeCanvasCursor(this.cursorStyle)}ngOnDestroy(){this.MapService.destroyMap()}ngOnChanges(e){return _D(this,void 0,void 0,function*(){yield this.MapService.mapCreated$.toPromise(),e.cursorStyle&&!e.cursorStyle.isFirstChange()&&this.MapService.changeCanvasCursor(e.cursorStyle.currentValue),e.minZoom&&!e.minZoom.isFirstChange()&&this.MapService.updateMinZoom(e.minZoom.currentValue),e.maxZoom&&!e.maxZoom.isFirstChange()&&this.MapService.updateMaxZoom(e.maxZoom.currentValue),e.minPitch&&!e.minPitch.isFirstChange()&&this.MapService.updateMinPitch(e.minPitch.currentValue),e.maxPitch&&!e.maxPitch.isFirstChange()&&this.MapService.updateMaxPitch(e.maxPitch.currentValue),e.renderWorldCopies&&!e.renderWorldCopies.isFirstChange()&&this.MapService.updateRenderWorldCopies(e.renderWorldCopies.currentValue),e.scrollZoom&&!e.scrollZoom.isFirstChange()&&this.MapService.updateScrollZoom(e.scrollZoom.currentValue),e.dragRotate&&!e.dragRotate.isFirstChange()&&this.MapService.updateDragRotate(e.dragRotate.currentValue),e.touchPitch&&!e.touchPitch.isFirstChange()&&this.MapService.updateTouchPitch(e.touchPitch.currentValue),e.touchZoomRotate&&!e.touchZoomRotate.isFirstChange()&&this.MapService.updateTouchZoomRotate(e.touchZoomRotate.currentValue),e.doubleClickZoom&&!e.doubleClickZoom.isFirstChange()&&this.MapService.updateDoubleClickZoom(e.doubleClickZoom.currentValue),e.keyboard&&!e.keyboard.isFirstChange()&&this.MapService.updateKeyboard(e.keyboard.currentValue),e.dragPan&&!e.dragPan.isFirstChange()&&this.MapService.updateDragPan(e.dragPan.currentValue),e.boxZoom&&!e.boxZoom.isFirstChange()&&this.MapService.updateBoxZoom(e.boxZoom.currentValue),e.style&&!e.style.isFirstChange()&&this.MapService.updateStyle(e.style.currentValue),e.maxBounds&&!e.maxBounds.isFirstChange()&&this.MapService.updateMaxBounds(e.maxBounds.currentValue),e.fitBounds&&e.fitBounds.currentValue&&!e.fitBounds.isFirstChange()&&this.MapService.fitBounds(e.fitBounds.currentValue,this.fitBoundsOptions),e.fitScreenCoordinates&&e.fitScreenCoordinates.currentValue&&((this.center||this.zoom||this.pitch||this.fitBounds)&&e.fitScreenCoordinates.isFirstChange()&&console.warn("[ngx-mapbox-gl] center / zoom / pitch / fitBounds inputs are being overridden by fitScreenCoordinates input"),this.MapService.fitScreenCoordinates(e.fitScreenCoordinates.currentValue,this.bearing?this.bearing[0]:0,this.movingOptions)),!this.centerWithPanTo||!e.center||e.center.isFirstChange()||e.zoom||e.bearing||e.pitch?(e.center&&!e.center.isFirstChange()||e.zoom&&!e.zoom.isFirstChange()||e.bearing&&!e.bearing.isFirstChange()&&!e.fitScreenCoordinates||e.pitch&&!e.pitch.isFirstChange())&&this.MapService.move(this.movingMethod,this.movingOptions,e.zoom&&this.zoom?this.zoom[0]:void 0,e.center?this.center:void 0,e.bearing&&this.bearing?this.bearing[0]:void 0,e.pitch&&this.pitch?this.pitch[0]:void 0):this.MapService.panTo(this.center,this.panToOptions)})}warnDeprecatedOutputs(){const e=w4.bind(void 0,r.name);this.resize.observers.length&&e("resize","mapResize"),this.remove.observers.length&&e("remove","mapRemove"),this.mouseDown.observers.length&&e("mouseDown","mapMouseDown"),this.mouseUp.observers.length&&e("mouseUp","mapMouseUp"),this.mouseMove.observers.length&&e("mouseMove","mapMouseMove"),this.click.observers.length&&e("click","mapClick"),this.dblClick.observers.length&&e("dblClick","mapDblClick"),this.mouseOver.observers.length&&e("mouseOver","mapMouseOver"),this.mouseOut.observers.length&&e("mouseOut","mapMouseOut"),this.contextMenu.observers.length&&e("contextMenu","mapContextMenu"),this.touchStart.observers.length&&e("touchStart","mapTouchStart"),this.touchEnd.observers.length&&e("touchEnd","mapTouchEnd"),this.touchMove.observers.length&&e("touchMove","mapTouchMove"),this.touchCancel.observers.length&&e("touchCancel","mapTouchCancel"),this.wheel.observers.length&&e("wheel","mapWheel"),this.dragStart.observers.length&&e("dragStart","mapDragStart"),this.drag.observers.length&&e("drag","mapDrag"),this.dragEnd.observers.length&&e("dragEnd","mapDragEnd"),this.load.observers.length&&e("load","mapLoad"),this.error.observers.length&&e("error","mapError")}}return r.\u0275fac=function(e){return new(e||r)(qn(ZE))},r.\u0275cmp=eo({type:r,selectors:[["mgl-map"]],viewQuery:function(e,n){if(1&e&&mm(y4,7),2&e){let i;md(i=gd())&&(n.mapContainer=i.first)}},inputs:{collectResourceTiming:"collectResourceTiming",crossSourceCollisions:"crossSourceCollisions",customMapboxApiUrl:"customMapboxApiUrl",fadeDuration:"fadeDuration",hash:"hash",refreshExpiredTiles:"refreshExpiredTiles",failIfMajorPerformanceCaveat:"failIfMajorPerformanceCaveat",bearingSnap:"bearingSnap",interactive:"interactive",pitchWithRotate:"pitchWithRotate",clickTolerance:"clickTolerance",attributionControl:"attributionControl",logoPosition:"logoPosition",maxTileCacheSize:"maxTileCacheSize",localIdeographFontFamily:"localIdeographFontFamily",preserveDrawingBuffer:"preserveDrawingBuffer",trackResize:"trackResize",transformRequest:"transformRequest",bounds:"bounds",antialias:"antialias",locale:"locale",minZoom:"minZoom",maxZoom:"maxZoom",minPitch:"minPitch",maxPitch:"maxPitch",scrollZoom:"scrollZoom",dragRotate:"dragRotate",touchPitch:"touchPitch",touchZoomRotate:"touchZoomRotate",doubleClickZoom:"doubleClickZoom",keyboard:"keyboard",dragPan:"dragPan",boxZoom:"boxZoom",style:"style",center:"center",maxBounds:"maxBounds",zoom:"zoom",bearing:"bearing",pitch:"pitch",fitBoundsOptions:"fitBoundsOptions",renderWorldCopies:"renderWorldCopies",movingMethod:"movingMethod",movingOptions:"movingOptions",fitBounds:"fitBounds",fitScreenCoordinates:"fitScreenCoordinates",centerWithPanTo:"centerWithPanTo",panToOptions:"panToOptions",cursorStyle:"cursorStyle"},outputs:{mapResize:"mapResize",mapRemove:"mapRemove",mapMouseDown:"mapMouseDown",mapMouseUp:"mapMouseUp",mapMouseMove:"mapMouseMove",mapClick:"mapClick",mapDblClick:"mapDblClick",mapMouseOver:"mapMouseOver",mapMouseOut:"mapMouseOut",mapContextMenu:"mapContextMenu",mapTouchStart:"mapTouchStart",mapTouchEnd:"mapTouchEnd",mapTouchMove:"mapTouchMove",mapTouchCancel:"mapTouchCancel",mapWheel:"mapWheel",moveStart:"moveStart",move:"move",moveEnd:"moveEnd",mapDragStart:"mapDragStart",mapDrag:"mapDrag",mapDragEnd:"mapDragEnd",zoomStart:"zoomStart",zoomEvt:"zoomEvt",zoomEnd:"zoomEnd",rotateStart:"rotateStart",rotate:"rotate",rotateEnd:"rotateEnd",pitchStart:"pitchStart",pitchEvt:"pitchEvt",pitchEnd:"pitchEnd",boxZoomStart:"boxZoomStart",boxZoomEnd:"boxZoomEnd",boxZoomCancel:"boxZoomCancel",webGlContextLost:"webGlContextLost",webGlContextRestored:"webGlContextRestored",mapLoad:"mapLoad",idle:"idle",render:"render",mapError:"mapError",data:"data",styleData:"styleData",sourceData:"sourceData",dataLoading:"dataLoading",styleDataLoading:"styleDataLoading",sourceDataLoading:"sourceDataLoading",styleImageMissing:"styleImageMissing",resize:"resize",remove:"remove",mouseDown:"mouseDown",mouseUp:"mouseUp",mouseMove:"mouseMove",click:"click",dblClick:"dblClick",mouseOver:"mouseOver",mouseOut:"mouseOut",contextMenu:"contextMenu",touchStart:"touchStart",touchEnd:"touchEnd",touchMove:"touchMove",touchCancel:"touchCancel",wheel:"wheel",dragStart:"dragStart",drag:"drag",dragEnd:"dragEnd",load:"load",error:"error"},features:[WC([ZE]),Lo],decls:2,vars:0,consts:[["container",""]],template:function(e,n){1&e&&Hi(0,"div",null,0)},styles:["[_nghost-%COMP%] {\n        display: block;\n      }\n      div[_ngcontent-%COMP%] {\n        height: 100%;\n        width: 100%;\n      }"],changeDetection:0}),r})(),E4=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=Gi({type:r}),r.\u0275inj=io({imports:[[Df]]}),r})();const S4=["dialogPopup"],T4=["hueSlider"],I4=["alphaSlider"];function M4(r,t){if(1&r&&Hi(0,"div"),2&r){const e=ir();(function(r,t,e){dm(Du,ig,x0(gn(),r,t,e),!0)})("arrow arrow-",e.cpUsePosition,""),dh("top",e.arrowTop,"px")}}function A4(r,t){if(1&r){const e=$l();It(0,"div",28),Qr("newValue",function(i){return Rr(e),ir().onColorChange(i)})("dragStart",function(){return Rr(e),ir().onDragStart("saturation-lightness")})("dragEnd",function(){return Rr(e),ir().onDragEnd("saturation-lightness")}),Hi(1,"div",14),Mt()}if(2&r){const e=ir();dh("background-color",e.hueSliderColor),kn("rgX",1)("rgY",1),rn(1),dh("top",null==e.slider?null:e.slider.v,"px")("left",null==e.slider?null:e.slider.s,"px")}}function D4(r,t){1&r&&(Lr.lFrame.currentNamespace=Tl,It(0,"svg",29),Hi(1,"path",30),Hi(2,"path",31),Mt())}function k4(r,t){if(1&r){const e=$l();It(0,"button",32),Qr("click",function(i){Rr(e);const o=ir();return o.onAddPresetColor(i,o.selectedColor)}),jr(1),Mt()}if(2&r){const e=ir();Xv(e.cpAddColorButtonClass),kn("disabled",e.cpPresetColors&&e.cpPresetColors.length>=e.cpMaxPresetColorsLength),rn(1),wp(" ",e.cpAddColorButtonText," ")}}function P4(r,t){1&r&&Hi(0,"div",33)}function R4(r,t){if(1&r){const e=$l();It(0,"input",39),Qr("keyup.enter",function(i){return Rr(e),ir(2).onAcceptColor(i)})("newValue",function(i){return Rr(e),ir(2).onAlphaInput(i)}),Mt()}if(2&r){const e=ir(2);kn("rg",1)("value",null==e.cmykText?null:e.cmykText.a)}}function O4(r,t){1&r&&(It(0,"div"),jr(1,"A"),Mt())}function L4(r,t){if(1&r){const e=$l();It(0,"div",34),It(1,"div",35),It(2,"input",36),Qr("keyup.enter",function(i){return Rr(e),ir().onAcceptColor(i)})("newValue",function(i){return Rr(e),ir().onCyanInput(i)}),Mt(),It(3,"input",36),Qr("keyup.enter",function(i){return Rr(e),ir().onAcceptColor(i)})("newValue",function(i){return Rr(e),ir().onMagentaInput(i)}),Mt(),It(4,"input",36),Qr("keyup.enter",function(i){return Rr(e),ir().onAcceptColor(i)})("newValue",function(i){return Rr(e),ir().onYellowInput(i)}),Mt(),It(5,"input",36),Qr("keyup.enter",function(i){return Rr(e),ir().onAcceptColor(i)})("newValue",function(i){return Rr(e),ir().onBlackInput(i)}),Mt(),Ii(6,R4,1,2,"input",37),Mt(),It(7,"div",35),It(8,"div"),jr(9,"C"),Mt(),It(10,"div"),jr(11,"M"),Mt(),It(12,"div"),jr(13,"Y"),Mt(),It(14,"div"),jr(15,"K"),Mt(),Ii(16,O4,2,0,"div",38),Mt(),Mt()}if(2&r){const e=ir();dh("display",3!==e.format?"none":"block"),rn(2),kn("rg",100)("value",null==e.cmykText?null:e.cmykText.c),rn(1),kn("rg",100)("value",null==e.cmykText?null:e.cmykText.m),rn(1),kn("rg",100)("value",null==e.cmykText?null:e.cmykText.y),rn(1),kn("rg",100)("value",null==e.cmykText?null:e.cmykText.k),rn(1),kn("ngIf","disabled"!==e.cpAlphaChannel),rn(10),kn("ngIf","disabled"!==e.cpAlphaChannel)}}function F4(r,t){if(1&r){const e=$l();It(0,"input",39),Qr("keyup.enter",function(i){return Rr(e),ir(2).onAcceptColor(i)})("newValue",function(i){return Rr(e),ir(2).onAlphaInput(i)}),Mt()}if(2&r){const e=ir(2);kn("rg",1)("value",null==e.hslaText?null:e.hslaText.a)}}function z4(r,t){1&r&&(It(0,"div"),jr(1,"A"),Mt())}function N4(r,t){if(1&r){const e=$l();It(0,"div",40),It(1,"div",35),It(2,"input",41),Qr("keyup.enter",function(i){return Rr(e),ir().onAcceptColor(i)})("newValue",function(i){return Rr(e),ir().onHueInput(i)}),Mt(),It(3,"input",36),Qr("keyup.enter",function(i){return Rr(e),ir().onAcceptColor(i)})("newValue",function(i){return Rr(e),ir().onSaturationInput(i)}),Mt(),It(4,"input",36),Qr("keyup.enter",function(i){return Rr(e),ir().onAcceptColor(i)})("newValue",function(i){return Rr(e),ir().onLightnessInput(i)}),Mt(),Ii(5,F4,1,2,"input",37),Mt(),It(6,"div",35),It(7,"div"),jr(8,"H"),Mt(),It(9,"div"),jr(10,"S"),Mt(),It(11,"div"),jr(12,"L"),Mt(),Ii(13,z4,2,0,"div",38),Mt(),Mt()}if(2&r){const e=ir();dh("display",2!==e.format?"none":"block"),rn(2),kn("rg",360)("value",null==e.hslaText?null:e.hslaText.h),rn(1),kn("rg",100)("value",null==e.hslaText?null:e.hslaText.s),rn(1),kn("rg",100)("value",null==e.hslaText?null:e.hslaText.l),rn(1),kn("ngIf","disabled"!==e.cpAlphaChannel),rn(8),kn("ngIf","disabled"!==e.cpAlphaChannel)}}function B4(r,t){if(1&r){const e=$l();It(0,"input",39),Qr("keyup.enter",function(i){return Rr(e),ir(2).onAcceptColor(i)})("newValue",function(i){return Rr(e),ir(2).onAlphaInput(i)}),Mt()}if(2&r){const e=ir(2);kn("rg",1)("value",null==e.rgbaText?null:e.rgbaText.a)}}function j4(r,t){1&r&&(It(0,"div"),jr(1,"A"),Mt())}function U4(r,t){if(1&r){const e=$l();It(0,"div",42),It(1,"div",35),It(2,"input",43),Qr("keyup.enter",function(i){return Rr(e),ir().onAcceptColor(i)})("newValue",function(i){return Rr(e),ir().onRedInput(i)}),Mt(),It(3,"input",43),Qr("keyup.enter",function(i){return Rr(e),ir().onAcceptColor(i)})("newValue",function(i){return Rr(e),ir().onGreenInput(i)}),Mt(),It(4,"input",43),Qr("keyup.enter",function(i){return Rr(e),ir().onAcceptColor(i)})("newValue",function(i){return Rr(e),ir().onBlueInput(i)}),Mt(),Ii(5,B4,1,2,"input",37),Mt(),It(6,"div",35),It(7,"div"),jr(8,"R"),Mt(),It(9,"div"),jr(10,"G"),Mt(),It(11,"div"),jr(12,"B"),Mt(),Ii(13,j4,2,0,"div",38),Mt(),Mt()}if(2&r){const e=ir();dh("display",1!==e.format?"none":"block"),rn(2),kn("rg",255)("value",null==e.rgbaText?null:e.rgbaText.r),rn(1),kn("rg",255)("value",null==e.rgbaText?null:e.rgbaText.g),rn(1),kn("rg",255)("value",null==e.rgbaText?null:e.rgbaText.b),rn(1),kn("ngIf","disabled"!==e.cpAlphaChannel),rn(8),kn("ngIf","disabled"!==e.cpAlphaChannel)}}function V4(r,t){if(1&r){const e=$l();It(0,"input",39),Qr("keyup.enter",function(i){return Rr(e),ir(2).onAcceptColor(i)})("newValue",function(i){return Rr(e),ir(2).onAlphaInput(i)}),Mt()}if(2&r){const e=ir(2);kn("rg",1)("value",e.hexAlpha)}}function G4(r,t){1&r&&(It(0,"div"),jr(1,"A"),Mt())}function q4(r,t){if(1&r){const e=$l();It(0,"div",44),It(1,"div",35),It(2,"input",45),Qr("blur",function(){return Rr(e),ir().onHexInput(null)})("keyup.enter",function(i){return Rr(e),ir().onAcceptColor(i)})("newValue",function(i){return Rr(e),ir().onHexInput(i)}),Mt(),Ii(3,V4,1,2,"input",37),Mt(),It(4,"div",35),It(5,"div"),jr(6,"Hex"),Mt(),Ii(7,G4,2,0,"div",38),Mt(),Mt()}if(2&r){const e=ir();dh("display",0!==e.format?"none":"block"),pb("hex-alpha","forced"===e.cpAlphaChannel),rn(2),kn("value",e.hexText),rn(1),kn("ngIf","forced"===e.cpAlphaChannel),rn(4),kn("ngIf","forced"===e.cpAlphaChannel)}}function Z4(r,t){if(1&r){const e=$l();It(0,"input",39),Qr("keyup.enter",function(i){return Rr(e),ir(2).onAcceptColor(i)})("newValue",function(i){return Rr(e),ir(2).onAlphaInput(i)}),Mt()}if(2&r){const e=ir(2);kn("rg",1)("value",null==e.hslaText?null:e.hslaText.a)}}function H4(r,t){if(1&r){const e=$l();It(0,"div",46),It(1,"div",35),It(2,"input",36),Qr("keyup.enter",function(i){return Rr(e),ir().onAcceptColor(i)})("newValue",function(i){return Rr(e),ir().onValueInput(i)}),Mt(),Ii(3,Z4,1,2,"input",37),Mt(),It(4,"div",35),It(5,"div"),jr(6,"V"),Mt(),It(7,"div"),jr(8,"A"),Mt(),Mt(),Mt()}if(2&r){const e=ir();rn(2),kn("rg",100)("value",null==e.hslaText?null:e.hslaText.l),rn(1),kn("ngIf","disabled"!==e.cpAlphaChannel)}}function W4(r,t){if(1&r){const e=$l();It(0,"div",47),It(1,"span",48),Qr("click",function(){return Rr(e),ir().onFormatToggle(-1)}),Mt(),It(2,"span",48),Qr("click",function(){return Rr(e),ir().onFormatToggle(1)}),Mt(),Mt()}}function $4(r,t){if(1&r){const e=$l();It(0,"span",55),Qr("click",function(i){Rr(e);const o=ir().$implicit;return ir(3).onRemovePresetColor(i,o)}),Mt()}2&r&&Xv(ir(4).cpRemoveColorButtonClass)}function X4(r,t){if(1&r){const e=$l();It(0,"div",53),Qr("click",function(){const o=Rr(e).$implicit;return ir(3).setColorFromString(o)}),Ii(1,$4,1,3,"span",54),Mt()}if(2&r){const e=t.$implicit,n=ir(3);dh("background-color",e),rn(1),kn("ngIf",n.cpAddColorButton)}}function Y4(r,t){if(1&r&&(It(0,"div"),Ii(1,X4,2,3,"div",52),Mt()),2&r){const e=ir(2);Xv(e.cpPresetColorsClass),rn(1),kn("ngForOf",e.cpPresetColors)}}function K4(r,t){if(1&r&&(It(0,"div"),jr(1),Mt()),2&r){const e=ir(2);Xv(e.cpPresetEmptyMessageClass),rn(1),bp(e.cpPresetEmptyMessage)}}function J4(r,t){if(1&r&&(It(0,"div",49),Hi(1,"hr"),It(2,"div",50),jr(3),Mt(),Ii(4,Y4,2,4,"div",51),Ii(5,K4,2,4,"div",51),Mt()),2&r){const e=ir();rn(3),bp(e.cpPresetLabel),rn(1),kn("ngIf",null==e.cpPresetColors?null:e.cpPresetColors.length),rn(1),kn("ngIf",!(null!=e.cpPresetColors&&e.cpPresetColors.length)&&e.cpAddColorButton)}}function Q4(r,t){if(1&r){const e=$l();It(0,"button",58),Qr("click",function(i){return Rr(e),ir(2).onCancelColor(i)}),jr(1),Mt()}if(2&r){const e=ir(2);Xv(e.cpCancelButtonClass),rn(1),bp(e.cpCancelButtonText)}}function ej(r,t){if(1&r){const e=$l();It(0,"button",58),Qr("click",function(i){return Rr(e),ir(2).onAcceptColor(i)}),jr(1),Mt()}if(2&r){const e=ir(2);Xv(e.cpOKButtonClass),rn(1),bp(e.cpOKButtonText)}}function tj(r,t){if(1&r&&(It(0,"div",56),Ii(1,Q4,2,4,"button",57),Ii(2,ej,2,4,"button",57),Mt()),2&r){const e=ir();rn(1),kn("ngIf",e.cpCancelButton),rn(1),kn("ngIf",e.cpOKButton)}}function nj(r,t){1&r&&zC(0)}function rj(r,t){if(1&r&&(It(0,"div",59),Ii(1,nj,1,0,"ng-container",60),Mt()),2&r){const e=ir();rn(1),kn("ngTemplateOutlet",e.cpExtraTemplate)}}var ap=(()=>{return(r=ap||(ap={}))[r.HEX=0]="HEX",r[r.RGBA=1]="RGBA",r[r.HSLA=2]="HSLA",r[r.CMYK=3]="CMYK",ap;var r})();class ny{constructor(t,e,n,i){this.r=t,this.g=e,this.b=n,this.a=i}}class Yb{constructor(t,e,n,i){this.h=t,this.s=e,this.v=n,this.a=i}}class n_{constructor(t,e,n,i){this.h=t,this.s=e,this.l=n,this.a=i}}class e1{constructor(t,e,n,i,o=1){this.c=t,this.m=e,this.y=n,this.k=i,this.a=o}}let aj=(()=>{class r{constructor(){this.newValue=new Nn}inputChange(e){const n=e.target.value;if(void 0===this.rg)this.newValue.emit(n);else{const i=parseFloat(n);this.newValue.emit({v:i,rg:this.rg})}}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275dir=Pa({type:r,selectors:[["","text",""]],hostBindings:function(e,n){1&e&&Qr("input",function(o){return n.inputChange(o)})},inputs:{rg:"rg",text:"text"},outputs:{newValue:"newValue"}}),r})(),sj=(()=>{class r{constructor(e){this.elRef=e,this.dragEnd=new Nn,this.dragStart=new Nn,this.newValue=new Nn,this.listenerMove=n=>this.move(n),this.listenerStop=()=>this.stop()}mouseDown(e){this.start(e)}touchStart(e){this.start(e)}move(e){e.preventDefault(),this.setCursor(e)}start(e){this.setCursor(e),e.stopPropagation(),document.addEventListener("mouseup",this.listenerStop),document.addEventListener("touchend",this.listenerStop),document.addEventListener("mousemove",this.listenerMove),document.addEventListener("touchmove",this.listenerMove),this.dragStart.emit()}stop(){document.removeEventListener("mouseup",this.listenerStop),document.removeEventListener("touchend",this.listenerStop),document.removeEventListener("mousemove",this.listenerMove),document.removeEventListener("touchmove",this.listenerMove),this.dragEnd.emit()}getX(e){const n=this.elRef.nativeElement.getBoundingClientRect();return(void 0!==e.pageX?e.pageX:e.touches[0].pageX)-n.left-window.pageXOffset}getY(e){const n=this.elRef.nativeElement.getBoundingClientRect();return(void 0!==e.pageY?e.pageY:e.touches[0].pageY)-n.top-window.pageYOffset}setCursor(e){const n=this.elRef.nativeElement.offsetWidth,i=this.elRef.nativeElement.offsetHeight,o=Math.max(0,Math.min(this.getX(e),n)),u=Math.max(0,Math.min(this.getY(e),i));void 0!==this.rgX&&void 0!==this.rgY?this.newValue.emit({s:o/n,v:1-u/i,rgX:this.rgX,rgY:this.rgY}):void 0===this.rgX&&void 0!==this.rgY?this.newValue.emit({v:u/i,rgY:this.rgY}):void 0!==this.rgX&&void 0===this.rgY&&this.newValue.emit({v:o/n,rgX:this.rgX})}}return r.\u0275fac=function(e){return new(e||r)(qn(fm))},r.\u0275dir=Pa({type:r,selectors:[["","slider",""]],hostBindings:function(e,n){1&e&&Qr("mousedown",function(o){return n.mouseDown(o)})("touchstart",function(o){return n.touchStart(o)})},inputs:{rgX:"rgX",rgY:"rgY",slider:"slider"},outputs:{dragEnd:"dragEnd",dragStart:"dragStart",newValue:"newValue"}}),r})();class TD{constructor(t,e,n,i){this.h=t,this.s=e,this.v=n,this.a=i}}class ID{constructor(t,e,n,i){this.h=t,this.s=e,this.v=n,this.a=i}}let HE=(()=>{class r{constructor(){this.active=null}setActive(e){this.active&&this.active!==e&&"inline"!==this.active.cpDialogDisplay&&this.active.closeDialog(),this.active=e}hsva2hsla(e){const n=e.h,i=e.s,o=e.v,u=e.a;if(0===o)return new n_(n,0,0,u);if(0===i&&1===o)return new n_(n,1,1,u);{const m=o*(2-i)/2;return new n_(n,o*i/(1-Math.abs(2*m-1)),m,u)}}hsla2hsva(e){const n=Math.min(e.h,1),i=Math.min(e.s,1),o=Math.min(e.l,1),u=Math.min(e.a,1);if(0===o)return new Yb(n,0,0,u);{const m=o+i*(1-Math.abs(2*o-1))/2;return new Yb(n,2*(m-o)/m,m,u)}}hsvaToRgba(e){let n,i,o;const u=e.h,m=e.s,b=e.v,T=e.a,F=Math.floor(6*u),V=6*u-F,H=b*(1-m),J=b*(1-V*m),ne=b*(1-(1-V)*m);switch(F%6){case 0:n=b,i=ne,o=H;break;case 1:n=J,i=b,o=H;break;case 2:n=H,i=b,o=ne;break;case 3:n=H,i=J,o=b;break;case 4:n=ne,i=H,o=b;break;case 5:n=b,i=H,o=J;break;default:n=0,i=0,o=0}return new ny(n,i,o,T)}cmykToRgb(e){return new ny((1-e.c)*(1-e.k),(1-e.m)*(1-e.k),(1-e.y)*(1-e.k),e.a)}rgbaToCmyk(e){const n=1-Math.max(e.r,e.g,e.b);return 1===n?new e1(0,0,0,1,e.a):new e1((1-e.r-n)/(1-n),(1-e.g-n)/(1-n),(1-e.b-n)/(1-n),n,e.a)}rgbaToHsva(e){let n,i;const o=Math.min(e.r,1),u=Math.min(e.g,1),m=Math.min(e.b,1),b=Math.min(e.a,1),T=Math.max(o,u,m),F=Math.min(o,u,m),V=T,H=T-F;if(i=0===T?0:H/T,T===F)n=0;else{switch(T){case o:n=(u-m)/H+(u<m?6:0);break;case u:n=(m-o)/H+2;break;case m:n=(o-u)/H+4;break;default:n=0}n/=6}return new Yb(n,i,V,b)}rgbaToHex(e,n){let i="#"+(1<<24|e.r<<16|e.g<<8|e.b).toString(16).substr(1);return n&&(i+=(256|Math.round(255*e.a)).toString(16).substr(1)),i}normalizeCMYK(e){return new e1(e.c/100,e.m/100,e.y/100,e.k/100,e.a)}denormalizeCMYK(e){return new e1(Math.floor(100*e.c),Math.floor(100*e.m),Math.floor(100*e.y),Math.floor(100*e.k),e.a)}denormalizeRGBA(e){return new ny(Math.round(255*e.r),Math.round(255*e.g),Math.round(255*e.b),e.a)}stringToHsva(e="",n=!1){let i=null;e=(e||"").toLowerCase();const o=[{re:/(rgb)a?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*%?,\s*(\d{1,3})\s*%?(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(u){return new ny(parseInt(u[2],10)/255,parseInt(u[3],10)/255,parseInt(u[4],10)/255,isNaN(parseFloat(u[5]))?1:parseFloat(u[5]))}},{re:/(hsl)a?\(\s*(\d{1,3})\s*,\s*(\d{1,3})%\s*,\s*(\d{1,3})%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(u){return new n_(parseInt(u[2],10)/360,parseInt(u[3],10)/100,parseInt(u[4],10)/100,isNaN(parseFloat(u[5]))?1:parseFloat(u[5]))}}];o.push(n?{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})?$/,parse:function(u){return new ny(parseInt(u[1],16)/255,parseInt(u[2],16)/255,parseInt(u[3],16)/255,parseInt(u[4]||"FF",16)/255)}}:{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/,parse:function(u){return new ny(parseInt(u[1],16)/255,parseInt(u[2],16)/255,parseInt(u[3],16)/255,1)}}),o.push({re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])$/,parse:function(u){return new ny(parseInt(u[1]+u[1],16)/255,parseInt(u[2]+u[2],16)/255,parseInt(u[3]+u[3],16)/255,1)}});for(const u in o)if(o.hasOwnProperty(u)){const m=o[u],b=m.re.exec(e),T=b&&m.parse(b);if(T)return T instanceof ny?i=this.rgbaToHsva(T):T instanceof n_&&(i=this.hsla2hsva(T)),i}return i}outputFormat(e,n,i){switch("auto"===n&&(n=e.a<1?"rgba":"hex"),n){case"hsla":const o=this.hsva2hsla(e),u=new n_(Math.round(360*o.h),Math.round(100*o.s),Math.round(100*o.l),Math.round(100*o.a)/100);return e.a<1||"always"===i?"hsla("+u.h+","+u.s+"%,"+u.l+"%,"+u.a+")":"hsl("+u.h+","+u.s+"%,"+u.l+"%)";case"rgba":const m=this.denormalizeRGBA(this.hsvaToRgba(e));return e.a<1||"always"===i?"rgba("+m.r+","+m.g+","+m.b+","+Math.round(100*m.a)/100+")":"rgb("+m.r+","+m.g+","+m.b+")";default:const b="always"===i||"forced"===i;return this.rgbaToHex(this.denormalizeRGBA(this.hsvaToRgba(e)),b)}}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})(),lj=(()=>{class r{constructor(e,n,i){this.elRef=e,this.cdRef=n,this.service=i,this.isIE10=!1,this.dialogArrowSize=10,this.dialogArrowOffset=15,this.dialogInputFields=[ap.HEX,ap.RGBA,ap.HSLA,ap.CMYK],this.useRootViewContainer=!1}handleEsc(e){this.show&&"popup"===this.cpDialogDisplay&&this.onCancelColor(e)}handleEnter(e){this.show&&"popup"===this.cpDialogDisplay&&this.onAcceptColor(e)}ngOnInit(){this.slider=new TD(0,0,0,0),this.sliderDimMax=new ID(this.hueSlider.nativeElement.offsetWidth||140,this.cpWidth,130,this.alphaSlider.nativeElement.offsetWidth||140),this.format=this.cpCmykEnabled?ap.CMYK:"rgba"===this.cpOutputFormat?ap.RGBA:"hsla"===this.cpOutputFormat?ap.HSLA:ap.HEX,this.listenerMouseDown=i=>{this.onMouseDown(i)},this.listenerResize=()=>{this.onResize()},this.eyeDropperSupported="EyeDropper"in window,this.openDialog(this.initialColor,!1)}ngOnDestroy(){this.closeDialog()}ngAfterViewInit(){230===this.cpWidth&&"inline"!==this.cpDialogDisplay||(this.sliderDimMax=new ID(this.hueSlider.nativeElement.offsetWidth||140,this.cpWidth,130,this.alphaSlider.nativeElement.offsetWidth||140),this.updateColorPicker(!1),this.cdRef.detectChanges())}openDialog(e,n=!0){this.service.setActive(this),this.width||(this.cpWidth=this.directiveElementRef.nativeElement.offsetWidth),this.height||(this.height=320),this.setInitialColor(e),this.setColorFromString(e,n),this.openColorPicker()}closeDialog(){this.closeColorPicker()}setupDialog(e,n,i,o,u,m,b,T,F,V,H,J,ne,we,Re,qe,Ne,$e,tt,bt,dn,Kt,vn,Bt,Dn,un,Fn,kr,Jr,Ur,Mr,_n,Qi,go,Co,as,En,ma){this.setInitialColor(i),this.setColorMode(T),this.isIE10=10===function(){let r="";"undefined"!=typeof navigator&&(r=navigator.userAgent.toLowerCase());const t=r.indexOf("msie ");return t>0&&parseInt(r.substring(t+5,r.indexOf(".",t)),10)}(),this.directiveInstance=e,this.directiveElementRef=n,this.cpDisableInput=J,this.cpCmykEnabled=F,this.cpAlphaChannel=V,this.cpOutputFormat=H,this.cpDialogDisplay=m,this.cpIgnoredElements=ne,this.cpSaveClickOutside=we,this.cpCloseClickOutside=Re,this.useRootViewContainer=qe,this.width=this.cpWidth=parseInt(o,10),this.height=this.cpHeight=parseInt(u,10),this.cpPosition=Ne,this.cpPositionOffset=parseInt($e,10),this.cpOKButton=un,this.cpOKButtonText=kr,this.cpOKButtonClass=Fn,this.cpCancelButton=Jr,this.cpCancelButtonText=Mr,this.cpCancelButtonClass=Ur,this.cpEyeDropper=as,this.fallbackColor=b||"#fff",this.setPresetConfig(bt,dn),this.cpPresetColorsClass=Kt,this.cpMaxPresetColorsLength=vn,this.cpPresetEmptyMessage=Bt,this.cpPresetEmptyMessageClass=Dn,this.cpAddColorButton=_n,this.cpAddColorButtonText=go,this.cpAddColorButtonClass=Qi,this.cpRemoveColorButtonClass=Co,this.cpTriggerElement=En,this.cpExtraTemplate=ma,tt||(this.dialogArrowOffset=0),"inline"===m&&(this.dialogArrowSize=0,this.dialogArrowOffset=0),"hex"===H&&"always"!==V&&"forced"!==V&&(this.cpAlphaChannel="disabled")}setColorMode(e){switch(e.toString().toUpperCase()){case"1":case"C":case"COLOR":default:this.cpColorMode=1;break;case"2":case"G":case"GRAYSCALE":this.cpColorMode=2;break;case"3":case"P":case"PRESETS":this.cpColorMode=3}}setInitialColor(e){this.initialColor=e}setPresetConfig(e,n){this.cpPresetLabel=e,this.cpPresetColors=n}setColorFromString(e,n=!0,i=!0){let o;"always"===this.cpAlphaChannel||"forced"===this.cpAlphaChannel?(o=this.service.stringToHsva(e,!0),!o&&!this.hsva&&(o=this.service.stringToHsva(e,!1))):o=this.service.stringToHsva(e,!1),!o&&!this.hsva&&(o=this.service.stringToHsva(this.fallbackColor,!1)),o&&(this.hsva=o,this.sliderH=this.hsva.h,"hex"===this.cpOutputFormat&&"disabled"===this.cpAlphaChannel&&(this.hsva.a=1),this.updateColorPicker(n,i))}onResize(){"fixed"===this.position?this.setDialogPosition():"inline"!==this.cpDialogDisplay&&this.closeColorPicker()}onDragEnd(e){this.directiveInstance.sliderDragEnd({slider:e,color:this.outputColor})}onDragStart(e){this.directiveInstance.sliderDragStart({slider:e,color:this.outputColor})}onMouseDown(e){this.show&&!this.isIE10&&"popup"===this.cpDialogDisplay&&e.target!==this.directiveElementRef.nativeElement&&!this.isDescendant(this.elRef.nativeElement,e.target)&&!this.isDescendant(this.directiveElementRef.nativeElement,e.target)&&0===this.cpIgnoredElements.filter(n=>n===e.target).length&&(this.cpSaveClickOutside?this.directiveInstance.colorSelected(this.outputColor):(this.hsva=null,this.setColorFromString(this.initialColor,!1),this.cpCmykEnabled&&this.directiveInstance.cmykChanged(this.cmykColor),this.directiveInstance.colorChanged(this.initialColor),this.directiveInstance.colorCanceled()),this.cpCloseClickOutside&&this.closeColorPicker())}onAcceptColor(e){e.stopPropagation(),this.outputColor&&this.directiveInstance.colorSelected(this.outputColor),"popup"===this.cpDialogDisplay&&this.closeColorPicker()}onCancelColor(e){this.hsva=null,e.stopPropagation(),this.directiveInstance.colorCanceled(),this.setColorFromString(this.initialColor,!0),"popup"===this.cpDialogDisplay&&(this.cpCmykEnabled&&this.directiveInstance.cmykChanged(this.cmykColor),this.directiveInstance.colorChanged(this.initialColor,!0),this.closeColorPicker())}onEyeDropper(e){this.eyeDropperSupported&&(new window.EyeDropper).open().then(i=>{this.setColorFromString(i.sRGBHex,!0)})}onFormatToggle(e){const n=this.dialogInputFields.length-(this.cpCmykEnabled?0:1),i=((this.dialogInputFields.indexOf(this.format)+e)%n+n)%n;this.format=this.dialogInputFields[i]}onColorChange(e){this.hsva.s=e.s/e.rgX,this.hsva.v=e.v/e.rgY,this.updateColorPicker(),this.directiveInstance.sliderChanged({slider:"lightness",value:this.hsva.v,color:this.outputColor}),this.directiveInstance.sliderChanged({slider:"saturation",value:this.hsva.s,color:this.outputColor})}onHueChange(e){this.hsva.h=e.v/e.rgX,this.sliderH=this.hsva.h,this.updateColorPicker(),this.directiveInstance.sliderChanged({slider:"hue",value:this.hsva.h,color:this.outputColor})}onValueChange(e){this.hsva.v=e.v/e.rgX,this.updateColorPicker(),this.directiveInstance.sliderChanged({slider:"value",value:this.hsva.v,color:this.outputColor})}onAlphaChange(e){this.hsva.a=e.v/e.rgX,this.updateColorPicker(),this.directiveInstance.sliderChanged({slider:"alpha",value:this.hsva.a,color:this.outputColor})}onHexInput(e){if(null===e)this.updateColorPicker();else{e&&"#"!==e[0]&&(e="#"+e);let n=/^#([a-f0-9]{3}|[a-f0-9]{6})$/gi;"always"===this.cpAlphaChannel&&(n=/^#([a-f0-9]{3}|[a-f0-9]{6}|[a-f0-9]{8})$/gi);const i=n.test(e);i&&(e.length<5&&(e="#"+e.substring(1).split("").map(o=>o+o).join("")),"forced"===this.cpAlphaChannel&&(e+=Math.round(255*this.hsva.a).toString(16)),this.setColorFromString(e,!0,!1)),this.directiveInstance.inputChanged({input:"hex",valid:i,value:e,color:this.outputColor})}}onRedInput(e){const n=this.service.hsvaToRgba(this.hsva),i=!isNaN(e.v)&&e.v>=0&&e.v<=e.rg;i&&(n.r=e.v/e.rg,this.hsva=this.service.rgbaToHsva(n),this.sliderH=this.hsva.h,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"red",valid:i,value:n.r,color:this.outputColor})}onBlueInput(e){const n=this.service.hsvaToRgba(this.hsva),i=!isNaN(e.v)&&e.v>=0&&e.v<=e.rg;i&&(n.b=e.v/e.rg,this.hsva=this.service.rgbaToHsva(n),this.sliderH=this.hsva.h,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"blue",valid:i,value:n.b,color:this.outputColor})}onGreenInput(e){const n=this.service.hsvaToRgba(this.hsva),i=!isNaN(e.v)&&e.v>=0&&e.v<=e.rg;i&&(n.g=e.v/e.rg,this.hsva=this.service.rgbaToHsva(n),this.sliderH=this.hsva.h,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"green",valid:i,value:n.g,color:this.outputColor})}onHueInput(e){const n=!isNaN(e.v)&&e.v>=0&&e.v<=e.rg;n&&(this.hsva.h=e.v/e.rg,this.sliderH=this.hsva.h,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"hue",valid:n,value:this.hsva.h,color:this.outputColor})}onValueInput(e){const n=!isNaN(e.v)&&e.v>=0&&e.v<=e.rg;n&&(this.hsva.v=e.v/e.rg,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"value",valid:n,value:this.hsva.v,color:this.outputColor})}onAlphaInput(e){const n=!isNaN(e.v)&&e.v>=0&&e.v<=e.rg;n&&(this.hsva.a=e.v/e.rg,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"alpha",valid:n,value:this.hsva.a,color:this.outputColor})}onLightnessInput(e){const n=this.service.hsva2hsla(this.hsva),i=!isNaN(e.v)&&e.v>=0&&e.v<=e.rg;i&&(n.l=e.v/e.rg,this.hsva=this.service.hsla2hsva(n),this.sliderH=this.hsva.h,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"lightness",valid:i,value:n.l,color:this.outputColor})}onSaturationInput(e){const n=this.service.hsva2hsla(this.hsva),i=!isNaN(e.v)&&e.v>=0&&e.v<=e.rg;i&&(n.s=e.v/e.rg,this.hsva=this.service.hsla2hsva(n),this.sliderH=this.hsva.h,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"saturation",valid:i,value:n.s,color:this.outputColor})}onCyanInput(e){!isNaN(e.v)&&e.v>=0&&e.v<=e.rg&&(this.cmyk.c=e.v,this.updateColorPicker(!1,!0,!0)),this.directiveInstance.inputChanged({input:"cyan",valid:!0,value:this.cmyk.c,color:this.outputColor})}onMagentaInput(e){!isNaN(e.v)&&e.v>=0&&e.v<=e.rg&&(this.cmyk.m=e.v,this.updateColorPicker(!1,!0,!0)),this.directiveInstance.inputChanged({input:"magenta",valid:!0,value:this.cmyk.m,color:this.outputColor})}onYellowInput(e){!isNaN(e.v)&&e.v>=0&&e.v<=e.rg&&(this.cmyk.y=e.v,this.updateColorPicker(!1,!0,!0)),this.directiveInstance.inputChanged({input:"yellow",valid:!0,value:this.cmyk.y,color:this.outputColor})}onBlackInput(e){!isNaN(e.v)&&e.v>=0&&e.v<=e.rg&&(this.cmyk.k=e.v,this.updateColorPicker(!1,!0,!0)),this.directiveInstance.inputChanged({input:"black",valid:!0,value:this.cmyk.k,color:this.outputColor})}onAddPresetColor(e,n){e.stopPropagation(),this.cpPresetColors.filter(i=>i===n).length||(this.cpPresetColors=this.cpPresetColors.concat(n),this.directiveInstance.presetColorsChanged(this.cpPresetColors))}onRemovePresetColor(e,n){e.stopPropagation(),this.cpPresetColors=this.cpPresetColors.filter(i=>i!==n),this.directiveInstance.presetColorsChanged(this.cpPresetColors)}openColorPicker(){this.show||(this.show=!0,this.hidden=!0,setTimeout(()=>{this.hidden=!1,this.setDialogPosition(),this.cdRef.detectChanges()},0),this.directiveInstance.stateChanged(!0),this.isIE10||(document.addEventListener("mousedown",this.listenerMouseDown),document.addEventListener("touchstart",this.listenerMouseDown)),window.addEventListener("resize",this.listenerResize))}closeColorPicker(){this.show&&(this.show=!1,this.directiveInstance.stateChanged(!1),this.isIE10||(document.removeEventListener("mousedown",this.listenerMouseDown),document.removeEventListener("touchstart",this.listenerMouseDown)),window.removeEventListener("resize",this.listenerResize),this.cdRef.destroyed||this.cdRef.detectChanges())}updateColorPicker(e=!0,n=!0,i=!1){if(this.sliderDimMax){let o,u,m;2===this.cpColorMode&&(this.hsva.s=0);const b=this.outputColor;if(u=this.service.hsva2hsla(this.hsva),this.cpCmykEnabled?(i?(m=this.service.cmykToRgb(this.service.normalizeCMYK(this.cmyk)),this.hsva=this.service.rgbaToHsva(m)):(m=this.service.hsvaToRgba(this.hsva),this.cmyk=this.service.denormalizeCMYK(this.service.rgbaToCmyk(m))),m=this.service.denormalizeRGBA(m),this.sliderH=this.hsva.h):m=this.service.denormalizeRGBA(this.service.hsvaToRgba(this.hsva)),o=this.service.denormalizeRGBA(this.service.hsvaToRgba(new Yb(this.sliderH||this.hsva.h,1,1,1))),n&&(this.hslaText=new n_(Math.round(360*u.h),Math.round(100*u.s),Math.round(100*u.l),Math.round(100*u.a)/100),this.rgbaText=new ny(m.r,m.g,m.b,Math.round(100*m.a)/100),this.cpCmykEnabled&&(this.cmykText=new e1(this.cmyk.c,this.cmyk.m,this.cmyk.y,this.cmyk.k,Math.round(100*this.cmyk.a)/100)),this.hexText=this.service.rgbaToHex(m,"always"===this.cpAlphaChannel),this.hexAlpha=this.rgbaText.a),"auto"===this.cpOutputFormat&&this.format!==ap.RGBA&&this.format!==ap.CMYK&&this.format!==ap.HSLA&&this.hsva.a<1&&(this.format=this.hsva.a<1?ap.RGBA:ap.HEX),this.hueSliderColor="rgb("+o.r+","+o.g+","+o.b+")",this.alphaSliderColor="rgb("+m.r+","+m.g+","+m.b+")",this.outputColor=this.service.outputFormat(this.hsva,this.cpOutputFormat,this.cpAlphaChannel),this.selectedColor=this.service.outputFormat(this.hsva,"rgba",null),this.format!==ap.CMYK)this.cmykColor="";else if("always"===this.cpAlphaChannel||"enabled"===this.cpAlphaChannel||"forced"===this.cpAlphaChannel){const T=Math.round(100*this.cmyk.a)/100;this.cmykColor=`cmyka(${this.cmyk.c},${this.cmyk.m},${this.cmyk.y},${this.cmyk.k},${T})`}else this.cmykColor=`cmyk(${this.cmyk.c},${this.cmyk.m},${this.cmyk.y},${this.cmyk.k})`;this.slider=new TD((this.sliderH||this.hsva.h)*this.sliderDimMax.h-8,this.hsva.s*this.sliderDimMax.s-8,(1-this.hsva.v)*this.sliderDimMax.v-8,this.hsva.a*this.sliderDimMax.a-8),e&&b!==this.outputColor&&(this.cpCmykEnabled&&this.directiveInstance.cmykChanged(this.cmykColor),this.directiveInstance.colorChanged(this.outputColor))}}setDialogPosition(){if("inline"===this.cpDialogDisplay)this.position="relative";else{let i,e="static",n="",o=null,u=null,m=this.directiveElementRef.nativeElement.parentNode;const b=this.dialogElement.nativeElement.offsetHeight;for(;null!==m&&"HTML"!==m.tagName;){if(i=window.getComputedStyle(m),e=i.getPropertyValue("position"),n=i.getPropertyValue("transform"),"static"!==e&&null===o&&(o=m),n&&"none"!==n&&null===u&&(u=m),"fixed"===e){o=u;break}m=m.parentNode}const T=this.createDialogBox(this.directiveElementRef.nativeElement,"fixed"!==e);if(this.useRootViewContainer||"fixed"===e&&(!o||o instanceof HTMLUnknownElement))this.top=T.top,this.left=T.left;else{null===o&&(o=m);const V=this.createDialogBox(o,"fixed"!==e);this.top=T.top-V.top,this.left=T.left-V.left}"fixed"===e&&(this.position="fixed");let F=this.cpPosition;"auto"===this.cpPosition&&(F=function(r,t){let e="right",n="bottom";const{height:i,width:o}=r,{top:u,left:m}=t,b=u+t.height,T=m+t.width,F=u-i<0,V=b+i>(window.innerHeight||document.documentElement.clientHeight),H=m-o<0,J=T+o>(window.innerWidth||document.documentElement.clientWidth);return V&&(n="top"),F&&(n="bottom"),H&&(e="right"),J&&(e="left"),F&&V&&H&&J?["left","right","top","bottom"].reduce((Re,qe)=>r[Re]>r[qe]?Re:qe):H&&J?F?"bottom":V||u>b?"top":"bottom":F&&V?H?"right":J||m>T?"left":"right":`${n}-${e}`}(this.dialogElement.nativeElement.getBoundingClientRect(),this.cpTriggerElement.nativeElement.getBoundingClientRect())),"top"===F?(this.arrowTop=b-1,this.top-=b+this.dialogArrowSize,this.left+=this.cpPositionOffset/100*T.width-this.dialogArrowOffset):"bottom"===F?(this.top+=T.height+this.dialogArrowSize,this.left+=this.cpPositionOffset/100*T.width-this.dialogArrowOffset):"top-left"===F||"left-top"===F?(this.top-=b-T.height+T.height*this.cpPositionOffset/100,this.left-=this.cpWidth+this.dialogArrowSize-2-this.dialogArrowOffset):"top-right"===F||"right-top"===F?(this.top-=b-T.height+T.height*this.cpPositionOffset/100,this.left+=T.width+this.dialogArrowSize-2-this.dialogArrowOffset):"left"===F||"bottom-left"===F||"left-bottom"===F?(this.top+=T.height*this.cpPositionOffset/100-this.dialogArrowOffset,this.left-=this.cpWidth+this.dialogArrowSize-2):(this.top+=T.height*this.cpPositionOffset/100-this.dialogArrowOffset,this.left+=T.width+this.dialogArrowSize-2),this.cpUsePosition=F}}isDescendant(e,n){let i=n.parentNode;for(;null!==i;){if(i===e)return!0;i=i.parentNode}return!1}createDialogBox(e,n){return{top:e.getBoundingClientRect().top+(n?window.pageYOffset:0),left:e.getBoundingClientRect().left+(n?window.pageXOffset:0),width:e.offsetWidth,height:e.offsetHeight}}}return r.\u0275fac=function(e){return new(e||r)(qn(fm),qn(Ab),qn(HE))},r.\u0275cmp=eo({type:r,selectors:[["color-picker"]],viewQuery:function(e,n){if(1&e&&(mm(S4,7),mm(T4,7),mm(I4,7)),2&e){let i;md(i=gd())&&(n.dialogElement=i.first),md(i=gd())&&(n.hueSlider=i.first),md(i=gd())&&(n.alphaSlider=i.first)}},hostBindings:function(e,n){1&e&&Qr("keyup.esc",function(o){return n.handleEsc(o)},!1,Nd)("keyup.enter",function(o){return n.handleEnter(o)},!1,Nd)},decls:30,vars:51,consts:[[1,"color-picker",3,"click"],["dialogPopup",""],[3,"class","top",4,"ngIf"],["class","saturation-lightness",3,"slider","rgX","rgY","background-color","newValue","dragStart","dragEnd",4,"ngIf"],[1,"hue-alpha","box"],[1,"left"],[1,"selected-color-background"],[1,"selected-color",3,"click"],["class","eyedropper-icon","xmlns","http://www.w3.org/2000/svg","height","24px","viewBox","0 0 24 24","width","24px","fill","#000000",4,"ngIf"],["type","button",3,"class","disabled","click",4,"ngIf"],[1,"right"],["style","height: 16px;",4,"ngIf"],[1,"hue",3,"slider","rgX","newValue","dragStart","dragEnd"],["hueSlider",""],[1,"cursor"],[1,"value",3,"slider","rgX","newValue","dragStart","dragEnd"],["valueSlider",""],[1,"alpha",3,"slider","rgX","newValue","dragStart","dragEnd"],["alphaSlider",""],["class","cmyk-text",3,"display",4,"ngIf"],["class","hsla-text",3,"display",4,"ngIf"],["class","rgba-text",3,"display",4,"ngIf"],["class","hex-text",3,"hex-alpha","display",4,"ngIf"],["class","value-text",4,"ngIf"],["class","type-policy",4,"ngIf"],["class","preset-area",4,"ngIf"],["class","button-area",4,"ngIf"],["class","extra-template",4,"ngIf"],[1,"saturation-lightness",3,"slider","rgX","rgY","newValue","dragStart","dragEnd"],["xmlns","http://www.w3.org/2000/svg","height","24px","viewBox","0 0 24 24","width","24px","fill","#000000",1,"eyedropper-icon"],["d","M0 0h24v24H0V0z","fill","none"],["d","M17.66 5.41l.92.92-2.69 2.69-.92-.92 2.69-2.69M17.67 3c-.26 0-.51.1-.71.29l-3.12 3.12-1.93-1.91-1.41 1.41 1.42 1.42L3 16.25V21h4.75l8.92-8.92 1.42 1.42 1.41-1.41-1.92-1.92 3.12-3.12c.4-.4.4-1.03.01-1.42l-2.34-2.34c-.2-.19-.45-.29-.7-.29zM6.92 19L5 17.08l8.06-8.06 1.92 1.92L6.92 19z"],["type","button",3,"disabled","click"],[2,"height","16px"],[1,"cmyk-text"],[1,"box"],["type","number","pattern","[0-9]*","min","0","max","100",3,"text","rg","value","keyup.enter","newValue"],["type","number","pattern","[0-9]+([\\.,][0-9]{1,2})?","min","0","max","1","step","0.1",3,"text","rg","value","keyup.enter","newValue",4,"ngIf"],[4,"ngIf"],["type","number","pattern","[0-9]+([\\.,][0-9]{1,2})?","min","0","max","1","step","0.1",3,"text","rg","value","keyup.enter","newValue"],[1,"hsla-text"],["type","number","pattern","[0-9]*","min","0","max","360",3,"text","rg","value","keyup.enter","newValue"],[1,"rgba-text"],["type","number","pattern","[0-9]*","min","0","max","255",3,"text","rg","value","keyup.enter","newValue"],[1,"hex-text"],[3,"text","value","blur","keyup.enter","newValue"],[1,"value-text"],[1,"type-policy"],[1,"type-policy-arrow",3,"click"],[1,"preset-area"],[1,"preset-label"],[3,"class",4,"ngIf"],["class","preset-color",3,"backgroundColor","click",4,"ngFor","ngForOf"],[1,"preset-color",3,"click"],[3,"class","click",4,"ngIf"],[3,"click"],[1,"button-area"],["type","button",3,"class","click",4,"ngIf"],["type","button",3,"click"],[1,"extra-template"],[4,"ngTemplateOutlet"]],template:function(e,n){1&e&&(It(0,"div",0,1),Qr("click",function(o){return o.stopPropagation()}),Ii(2,M4,1,5,"div",2),Ii(3,A4,2,8,"div",3),It(4,"div",4),It(5,"div",5),Hi(6,"div",6),It(7,"div",7),Qr("click",function(o){return n.eyeDropperSupported&&n.cpEyeDropper&&n.onEyeDropper(o)}),Ii(8,D4,3,0,"svg",8),Mt(),Ii(9,k4,2,5,"button",9),Mt(),It(10,"div",10),Ii(11,P4,1,0,"div",11),It(12,"div",12,13),Qr("newValue",function(o){return n.onHueChange(o)})("dragStart",function(){return n.onDragStart("hue")})("dragEnd",function(){return n.onDragEnd("hue")}),Hi(14,"div",14),Mt(),It(15,"div",15,16),Qr("newValue",function(o){return n.onValueChange(o)})("dragStart",function(){return n.onDragStart("value")})("dragEnd",function(){return n.onDragEnd("value")}),Hi(17,"div",14),Mt(),It(18,"div",17,18),Qr("newValue",function(o){return n.onAlphaChange(o)})("dragStart",function(){return n.onDragStart("alpha")})("dragEnd",function(){return n.onDragEnd("alpha")}),Hi(20,"div",14),Mt(),Mt(),Mt(),Ii(21,L4,17,12,"div",19),Ii(22,N4,14,10,"div",20),Ii(23,U4,14,10,"div",21),Ii(24,q4,8,7,"div",22),Ii(25,H4,9,3,"div",23),Ii(26,W4,3,0,"div",24),Ii(27,J4,6,3,"div",25),Ii(28,tj,3,2,"div",26),Ii(29,rj,2,1,"div",27),Mt()),2&e&&(dh("display",n.show?"block":"none")("visibility",n.hidden?"hidden":"visible")("top",n.top,"px")("left",n.left,"px")("position",n.position)("height",n.cpHeight,"px")("width",n.cpWidth,"px"),pb("open",n.show),rn(2),kn("ngIf","popup"==n.cpDialogDisplay),rn(1),kn("ngIf",1===(n.cpColorMode||1)),rn(4),dh("background-color",n.selectedColor)("cursor",n.eyeDropperSupported&&n.cpEyeDropper?"pointer":null),rn(1),kn("ngIf",n.eyeDropperSupported&&n.cpEyeDropper),rn(1),kn("ngIf",n.cpAddColorButton),rn(2),kn("ngIf","disabled"===n.cpAlphaChannel),rn(1),dh("display",1===(n.cpColorMode||1)?"block":"none"),kn("rgX",1),rn(2),dh("left",null==n.slider?null:n.slider.h,"px"),rn(1),dh("display",2===(n.cpColorMode||1)?"block":"none"),kn("rgX",1),rn(2),dh("right",null==n.slider?null:n.slider.v,"px"),rn(1),dh("display","disabled"===n.cpAlphaChannel?"none":"block")("background-color",n.alphaSliderColor),kn("rgX",1),rn(2),dh("left",null==n.slider?null:n.slider.a,"px"),rn(1),kn("ngIf",!n.cpDisableInput&&1===(n.cpColorMode||1)),rn(1),kn("ngIf",!n.cpDisableInput&&1===(n.cpColorMode||1)),rn(1),kn("ngIf",!n.cpDisableInput&&1===(n.cpColorMode||1)),rn(1),kn("ngIf",!n.cpDisableInput&&1===(n.cpColorMode||1)),rn(1),kn("ngIf",!n.cpDisableInput&&2===(n.cpColorMode||1)),rn(1),kn("ngIf",!n.cpDisableInput&&1===(n.cpColorMode||1)),rn(1),kn("ngIf",(null==n.cpPresetColors?null:n.cpPresetColors.length)||n.cpAddColorButton),rn(1),kn("ngIf",n.cpOKButton||n.cpCancelButton),rn(1),kn("ngIf",n.cpExtraTemplate))},directives:[Vy,sj,aj,B0,RE],styles:['.color-picker{position:absolute;z-index:1000;width:230px;height:auto;border:#777 solid 1px;cursor:default;-webkit-user-select:none;user-select:none;background-color:#fff}.color-picker *{box-sizing:border-box;margin:0;font-size:11px}.color-picker input{width:0;height:26px;min-width:0;font-size:13px;text-align:center;color:#000}.color-picker input:invalid,.color-picker input:-moz-ui-invalid,.color-picker input:-moz-submit-invalid{box-shadow:none}.color-picker input::-webkit-inner-spin-button,.color-picker input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none}.color-picker .arrow{position:absolute;z-index:999999;width:0;height:0;border-style:solid}.color-picker .arrow.arrow-top{left:8px;border-width:10px 5px;border-color:#777 rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0)}.color-picker .arrow.arrow-bottom{top:-20px;left:8px;border-width:10px 5px;border-color:rgba(0,0,0,0) rgba(0,0,0,0) #777 rgba(0,0,0,0)}.color-picker .arrow.arrow-top-left,.color-picker .arrow.arrow-left-top{right:-21px;bottom:8px;border-width:5px 10px;border-color:rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0) #777}.color-picker .arrow.arrow-top-right,.color-picker .arrow.arrow-right-top{bottom:8px;left:-20px;border-width:5px 10px;border-color:rgba(0,0,0,0) #777 rgba(0,0,0,0) rgba(0,0,0,0)}.color-picker .arrow.arrow-left,.color-picker .arrow.arrow-left-bottom,.color-picker .arrow.arrow-bottom-left{top:8px;right:-21px;border-width:5px 10px;border-color:rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0) #777}.color-picker .arrow.arrow-right,.color-picker .arrow.arrow-right-bottom,.color-picker .arrow.arrow-bottom-right{top:8px;left:-20px;border-width:5px 10px;border-color:rgba(0,0,0,0) #777 rgba(0,0,0,0) rgba(0,0,0,0)}.color-picker .cursor{position:relative;width:16px;height:16px;border:#222 solid 2px;border-radius:50%;cursor:default}.color-picker .box{display:flex;padding:4px 8px}.color-picker .left{position:relative;padding:16px 8px}.color-picker .right{flex:1 1 auto;padding:12px 8px}.color-picker .button-area{padding:0 16px 16px;text-align:right}.color-picker .button-area button{margin-left:8px}.color-picker .preset-area{padding:4px 15px}.color-picker .preset-area .preset-label{overflow:hidden;width:100%;padding:4px;font-size:11px;white-space:nowrap;text-align:left;text-overflow:ellipsis;color:#555}.color-picker .preset-area .preset-color{position:relative;display:inline-block;width:18px;height:18px;margin:4px 6px 8px;border:#a9a9a9 solid 1px;border-radius:25%;cursor:pointer}.color-picker .preset-area .preset-empty-message{min-height:18px;margin-top:4px;margin-bottom:8px;font-style:italic;text-align:center}.color-picker .hex-text{width:100%;padding:4px 8px;font-size:11px}.color-picker .hex-text .box{padding:0 24px 8px 8px}.color-picker .hex-text .box div{float:left;flex:1 1 auto;text-align:center;color:#555;clear:left}.color-picker .hex-text .box input{flex:1 1 auto;padding:1px;border:#a9a9a9 solid 1px}.color-picker .hex-alpha .box div:first-child,.color-picker .hex-alpha .box input:first-child{flex-grow:3;margin-right:8px}.color-picker .cmyk-text,.color-picker .hsla-text,.color-picker .rgba-text,.color-picker .value-text{width:100%;padding:4px 8px;font-size:11px}.color-picker .cmyk-text .box,.color-picker .hsla-text .box,.color-picker .rgba-text .box{padding:0 24px 8px 8px}.color-picker .value-text .box{padding:0 8px 8px}.color-picker .cmyk-text .box div,.color-picker .hsla-text .box div,.color-picker .rgba-text .box div,.color-picker .value-text .box div{flex:1 1 auto;margin-right:8px;text-align:center;color:#555}.color-picker .cmyk-text .box div:last-child,.color-picker .hsla-text .box div:last-child,.color-picker .rgba-text .box div:last-child,.color-picker .value-text .box div:last-child{margin-right:0}.color-picker .cmyk-text .box input,.color-picker .hsla-text .box input,.color-picker .rgba-text .box input,.color-picker .value-text .box input{float:left;flex:1;padding:1px;margin:0 8px 0 0;border:#a9a9a9 solid 1px}.color-picker .cmyk-text .box input:last-child,.color-picker .hsla-text .box input:last-child,.color-picker .rgba-text .box input:last-child,.color-picker .value-text .box input:last-child{margin-right:0}.color-picker .hue-alpha{align-items:center;margin-bottom:3px}.color-picker .hue{direction:ltr;width:100%;height:16px;margin-bottom:16px;border:none;cursor:pointer;background-size:100% 100%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAAAQCAYAAAD06IYnAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AIWDwkUFWbCCAAAAFxJREFUaN7t0kEKg0AQAME2x83/n2qu5qCgD1iDhCoYdpnbQC9bbY1qVO/jvc6k3ad91s7/7F1/csgPrujuQ17BDYSFsBAWwgJhISyEBcJCWAgLhIWwEBYIi2f7Ar/1TCgFH2X9AAAAAElFTkSuQmCC)}.color-picker .value{direction:rtl;width:100%;height:16px;margin-bottom:16px;border:none;cursor:pointer;background-size:100% 100%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAAAQCAYAAAD06IYnAAACTklEQVR42u3SYUcrABhA4U2SkmRJMmWSJklKJiWZZpKUJJskKUmaTFImKZOUzMySpGRmliRNJilJSpKSJEtmSpIpmWmSdO736/6D+x7OP3gUCoWCv1cqlSQlJZGcnExKSgqpqamkpaWRnp5ORkYGmZmZqFQqsrKyyM7OJicnh9zcXNRqNXl5eeTn56PRaCgoKKCwsJCioiK0Wi3FxcWUlJRQWlpKWVkZ5eXlVFRUUFlZiU6no6qqiurqampqaqitraWurg69Xk99fT0GgwGj0UhDQwONjY00NTXR3NxMS0sLra2ttLW10d7ejslkwmw209HRQWdnJ11dXXR3d9PT00Nvby99fX309/czMDDA4OAgFouFoaEhrFYrw8PDjIyMMDo6ytjYGDabjfHxcSYmJpicnGRqagq73c709DQzMzPMzs4yNzfH/Pw8DocDp9OJy+XC7XazsLDA4uIiS0tLLC8vs7KywurqKmtra3g8HrxeLz6fD7/fz/r6OhsbG2xubrK1tcX29jaBQICdnR2CwSC7u7vs7e2xv7/PwcEBh4eHHB0dcXx8zMnJCaenp5ydnXF+fs7FxQWXl5dcXV1xfX3Nzc0Nt7e33N3dEQqFuL+/5+HhgXA4TCQS4fHxkaenJ56fn3l5eeH19ZVoNMrb2xvv7+98fHwQi8WIx+N8fn6SSCT4+vri+/ubn58ffn9/+VcKgSWwBJbAElgCS2AJLIElsASWwBJYAktgCSyBJbAElsASWAJLYAksgSWwBJbAElgCS2AJLIElsP4/WH8AmJ5Z6jHS4h8AAAAASUVORK5CYII=)}.color-picker .alpha{direction:ltr;width:100%;height:16px;border:none;cursor:pointer;background-size:100% 100%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAAAQCAYAAAD06IYnAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AIWDwYQlZMa3gAAAWVJREFUaN7tmEGO6jAQRCsOArHgBpyAJYGjcGocxAm4A2IHpmoWE0eBH+ezmFlNvU06shJ3W6VEelWMUQAIIF9f6qZpimsA1LYtS2uF51/u27YVAFZVRUkEoGHdPV/sIcbIEIIkUdI/9Xa7neyv61+SWFUVAVCSct00TWn2fv6u3+Ecfd3tXzy/0+nEUu+SPjo/kqzrmiQpScN6v98XewfA8/lMkiLJ2WxGSUopcT6fM6U0NX9/frfbjev1WtfrlZfLhYfDQQHG/AIOlnGwjINlHCxjHCzjYJm/TJWdCwquJXseFFzGwDNNeiKMOJTO8xQdDQaeB29+K9efeLaBo9J7vdvtJj1RjFFjfiv7qv95tjx/7leSQgh93e1ffMeIp6O+YQjho/N791t1XVOSSI7N//K+4/GoxWLBx+PB5/Op5XLJ+/3OlJJWqxU3m83ovv5iGf8KjYNlHCxjHCzjYBkHy5gf5gusvQU7U37jTAAAAABJRU5ErkJggg==)}.color-picker .type-policy{position:absolute;top:218px;right:12px;width:16px;height:24px;background-size:8px 16px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAgCAYAAAAffCjxAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACewAAAnsB01CO3AAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAIASURBVEiJ7ZY9axRRFIafsxMStrLQJpAgpBFhi+C9w1YSo00I6RZ/g9vZpBf/QOr4GyRgkSKNSrAadsZqQGwCkuAWyRZJsySwvhZ7N/vhzrgbLH3Ld8597jlzz50zJokyxXH8DqDVar0qi6v8BbItqSGpEcfxdlmsFWXkvX8AfAVWg3UKPEnT9GKujMzsAFgZsVaCN1VTQd77XUnrgE1kv+6935268WRpzrnHZvYRWC7YvC3pRZZl3wozqtVqiyH9IgjAspkd1Gq1xUJQtVrdB9ZKIAOthdg/Qc65LUk7wNIMoCVJO865rYFhkqjX6/d7vV4GPJwBMqofURS5JEk6FYBer/eeYb/Mo9WwFnPOvQbeAvfuAAK4BN4sAJtAG/gJIElmNuiJyba3EGNmZiPeZuEVmVell/Y/6N+CzDn3AXhEOOo7Hv/3BeAz8IzQkMPnJbuPx1wC+yYJ7/0nYIP5S/0FHKdp+rwCEEXRS/rf5Hl1Gtb2M0iSpCOpCZzPATmX1EySpHMLAsiy7MjMDoHrGSDXZnaYZdnRwBh7J91utwmczAA6CbG3GgPleX4jqUH/a1CktqRGnuc3hSCAMB32gKspkCtgb3KCQMmkjeP4WNJThrNNZval1WptTIsv7JtQ4tmIdRa8qSoEpWl6YWZNoAN0zKxZNPehpLSBZv2t+Q0CJ9lLnARQLAAAAABJRU5ErkJggg==);background-repeat:no-repeat;background-position:center}.color-picker .type-policy .type-policy-arrow{display:block;width:100%;height:50%}.color-picker .selected-color{position:absolute;top:16px;left:8px;width:40px;height:40px;border:1px solid #a9a9a9;border-radius:50%}.color-picker .selected-color-background{width:40px;height:40px;border-radius:50%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAh0lEQVRYR+2W0QlAMQgD60zdfwOdqa8TmI/wQMr5K0I5bZLIzLOa2nt37VVVbd+dDx5obgCC3KBLwJ2ff4PnVidkf+ucIhw80HQaCLo3DMH3CRK3iFsmAWVl6hPNDwt8EvNE5q+YuEXcMgkonVM6SdyCoEvAnZ8v1Hjx817MilmxSUB5rdLJDycZgUAZUch/AAAAAElFTkSuQmCC)}.color-picker .saturation-lightness{direction:ltr;width:100%;height:130px;border:none;cursor:pointer;touch-action:manipulation;background-size:100% 100%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOYAAACCCAYAAABSD7T3AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AIWDwksPWR6lgAAIABJREFUeNrtnVuT47gRrAHN+P//Or/61Y5wONZ7mZ1u3XAeLMjJZGZVgdKsfc5xR3S0RIIUW+CHzCpc2McYo7XGv3ex7UiZd57rjyzzv+v+33X/R/+3r/f7vR386Y+TvKNcf/wdhTLPcv9qU2wZd74uth0t1821jkIZLPcsI/6nWa4XvutquU0Z85mnx80S/ZzgpnLnOtHNt7/ofx1TKXcSNzN/7qbMQ3ju7rNQmMYYd/4s2j9aa+P+gGaMcZrb1M/tdrvf7/d2v99P9/t93O/3cbvdxu12G9frdVwul3E+n8c///nP+2+//Xb66aefxl//+tfx5z//2YK5Al2rgvf4UsbpdGrB52bAvArXpuzjmiqAVSGz5eDmGYXzhbAZmCrnmzddpUU+8Y1dAOYeXCtDUwVwV7YCGH6uAmyMcZ9l5vkUaBPGMUZ7/J5w/792/fvv9Xq93263dr/fTxPECeME8nK5jM/Pz/HTTz/dv337dvrll1/GP/7xj/G3v/1t/OUvfwkVswongjdOp9PzH3U3D3zmWGnZVXn4jCqs7wC2BKP4/8tAzkZsoWx6XrqeHZymvp4ABCBJhTQwKfDT8gzrZCIqi5AhiACjBfEB2rP8/X63MM7f6/V6v9/v7Xa7bYC83W7jcrlsVHIq5ffv30+//fbb+OWXX8ZPP/00/v73v4+ff/75JSvbeu+bL2WMMaFbAlpBNM85QX+ct6qoSqkPAwuQlBVKqGNFSUOAA3Bmu7gC5hNOd15nSwvAOUW7C4giUCV8Sgn5L9hNFIqTsp0GxI0ysioyjAjkY/tGJVEpz+fz+OWXX+7fv38//f777+Pbt2/j119/HT///PP49ddfx8fHRwrmTjV779EXu2px2xhjwtdJZQcAWQIPLPISsMJaSwiD8gzIKrwSyATE5j5nAbR5c1dBUwBlsEWW0h6LqiYsqFPAQxCyRZ3wOSARxmlXMX5k64pQfvv27f75+dk+Pj5OHx8f4/v37+Pbt2/jt99+G9++fRsfHx/jcrmUFLO31gYDWblxRIs/TqfT7ousxJsAxXA2Gc7TA9XdgfdoHbFsj76X2+1WArgI1ageGwA3qupqoHsmcbI6Fu93quggFa9d7LeDtgKfAFHBJ+NEByIkcJ5KervdTmhhGcgJJSZ5vn//fj+fz+18Pp8+Pz/H5+fnmGD+/vvv4/v37+Pj42N8fn6O2+1Ws7JjjP6wraMI5E4RZ8x2vV5TSwkquotV7/d7Tz6HFWsD/qNcdw0CQ3q/321c686TwDVIdbuy73zNldhSHb8I2klZznm+InBS4U6n0302aBFsLhHDAKJVJVglfI9jhvu53W53sLANYNxAiDA6MCeUHx8f9+v12i6XS7tcLqcZW57P5yeY8/fz83Ocz+fnsSmYUyknWEG85WBst9stzSLyMdfr9Qi08iY15UZ0LlDGLhR3o5zK2j7OPUTD0E+nU3tk7Xb/16NFbhloAMuY1zjLUOO3BKeIDe+Z8s3/J4gFo4TM5jPmuRg28foUKKVSwo16TgA5npywcWLHgYl/Pz8/73/605/ab7/91m63W7tcLie0sZj4mao5gTyfz88E0f1+j8EcYzwTPEG2cqjyfHNF0M8fuqEiaOVnRzZZQNh5fwQyHg/HDGfJo89Q1zb/quu5XC6773I2XKfTqd/v9+d3wuqWva/YTdUdEV3fhIv/Viyps6YE3x3r43K5bJQS66zaxVGFsvd+//j4aF+/fm3fv39vt9utff36tf3+++/tdrudvn37ZuNLBaaCMgUzC+rZRiFowxUuJI8YMqcCp9Opq5vagaYU6lGJA1XQqejchw6Cj0Gw5nYBrGw01A2O206n04BGouNNyTfp/FwElhUey6nXrIKw7QQWddxuN2ldL5fL839gSPF8ahu/JvBO48CPSuqMf8Vp9/P53L58+dLu93s7n8/tfr8/39/v9/b5+TkhPJ3P56mQ436/j+/fv+/iSgbzer0+AZx/5+88bv6OMda6S5z6kd21fYC9dxv7cIJJ2d9AOS30fPMzyHiTM8B4DF6XUlYHp4KQW3W+1t77MNB1vGHxWq7Xa7vf78+y5/N5A+H1et29xuP5dbYtyaRu4AksbPq6936fjRzXRxBbPr/b+b18+fKljTHaBBBfn8/n0/1+H1++fBnn8zm0sB8fH5u4cr5GuBhMVk0EEn9RsctgVhM+ixlJtMA23R8B6yysAstBOgFXIKKCMIgToMqNEu2fYMH7ztc732dQKkCj1ytAZtY0Kx8pIr8GGJ+AT3V+2Hirhl++fBmXy2Wz73w+b17P8p+fn8/tUwGVleVkTyUb68DkfayWY4zxNRihU4EpLJPZVrK+u7J4/mgfKqeLW9X2REWlItL1diynbDDb3+jXgYjQqn0rrxWc+NkILP7F7xIbMvx7vV53x40xnlbWJF12ZSag/N0pW6t+ZzmOMzHjajKwDfond78zYTdfq18up97zr2q8v3IioBprRtBl0EZ9og5WBRGOdOHjIjXF7UotFbgOWnXzIJyzYvjG5IYgsmMOxHkz8OsMSrVNWeq5T8DaOcbEv1Od5rbs9aO7YvMet63EkF++fMExq+MRl4/L5bLZN/+ez+fnZ6KazuMqXSQVO5spJXflHAIzes/xJseckRJiDMog9d6VfRrqXMr6KpVV27jRwJacGovOAM1zMdQMnwK1AubK63kdCChvI1C7g0z9nf/D+Xze2Vj8H7Gx4P9duQlsYCrqyN8XqG3Hm/10Oj3jw/n+crlstuM+jPmmxT2dTuPz83Pzt2pn1XsEHX/bnPaVqVmh0xwOt0o6XLLAHePUU203wHfcrspCwmV3TryB5s0Mseeg97x/BwzCjBlbB+pRAPla0BVQuT6V6QHdBlj3d0KG147b+DqxQeUymDO43W4dQar+TIjwmAd0z8/h65vf0/yLv3Pb5XLpru/ydDo9s7ET0I+Pj6dKK9VUEIeKWQWPAOrJ8LKd4vE+t91Y3e7UFlWatg2VwJnb+HPmtvm/sfK59/OaWF3x/eP1UPHvA5DDYDpYXfb0drv1V2DkBkxtw/tEWVVlXWdC9pFYs5/jfh9dS/16vW7s6lTG+TfqsxSJHxkXXq/Xdr1eu4LsfD6P3vsT3N77DkL+zPm5jSdKL4zR3AxQd6rHkLkYlSowsrq7znzu6wSwdsMJOXmA5fBcjxtgMGBYHlr5zokhtsMCTgXLQOW4XC6dEyEMprL8mAQzXRgduix2yZzorxkYsDn3hB1VeMLGsXsVtgl2pW8S3svk0vw7R4hNaHvv4cACl5HFzwIH0Kc6zu4XjDPR/jpAVxWzO1Xk2DDb3vTcxeGU1iWZHkmIDWziWKvirCJ4Dravs6IJ/GG6cTqWdXDy+fArQDVVkLqkVjAoZIITdmmIqXwqa95N3+MGYoZQdRVNO53Y1xRkhO16vY7eu507Ca9lJnbGpxOemQhSw/AQsmmp5zU9BiU8G6wvX76M6/U6Pj4+do0Bz4CpgiknTUeDqwlKBmg3u4OVjrZ1A+rAcgaejWq6eJCvCYFDONSwOgHX4EQRw8lxbzDOdEK6gZ3Hk1b+8g2o1JFtKXyv/fEdTXuWjWXdAZiBp6ADeDrCFiim7B6ZFneeI7Gvm/PMkUDX67W7xI8b0D7/v8dA9qfN5oaCf74WZjH0mf1cmfY1Y0JUFmVrTWu8uzkNcLtEj7u5FXBTkfC6GOA5q8YMxO8KVvF6sAVGdcrUbsKODcQKkLMOMdmlxum642YrPm26AlhZW1YB1R+rrGswE8TaYAWeUMxdf+WjwSvZ2Ef3ytOyfn5+PpVPAaqOn43MtNBqvmjjxbjM4lZjZY4gqNMI5ktaW/sYKNwS+9lFQzGihmMCKPa7+Z0V6Eb0GRmobtpX8JljWu5FMLN5ja6hG9kwQgZqf5+1NH5UxzkFReCdWhJ8XdlGUkxO7HRlYRm4mVO43W7ter12TPJEw/rmEN3L5SKHIWZg9mz+pUoKOYq5bJTJdX2gme1UcxMZQFaEQIlHct32M+Y1BzGkGuzfiyAN9z+ugplZ1symCrDCYYkGxDTpI9RzBy0rHyeDUC1nWaeUaD9n4xkNyYMBDZtzZ3B++fJlY21XFDOcARJlabOyiS3uCpLI9jrZjCDkaVvcCCjwognKShWdzXZWlZMvVTgD8LpqlCLrqgbcB+qYwrgKYpT0ccCqbKyCValkEabn/FynogCrPKfqf51xJ7sGB2ZXcZmxoSOztjx300DZi7a0/2AIR0UlBag9SuDw6KcAzlaB7vHZvWpjK90dyrq6bKyDUZQbR0B05biLQkHIcSUmgIK+SwuqgHCnoio2RQU1yj+BnBy9pphVKLGyC7ZzFK1pxWK+E8IhVCWLN/uLtnUU4ayoYLoaANz8FdtaSvY4pV0BEW2ls61czqllBKpTyKgMAhrZ1cdc1RROtPmvWNkdcKZ7ZKxaWjiPLJMpp7OZKxA+rqG/oJLjxf0pnJlqLoDZo3gyU0mKGys2taKecj/d1C+rJSplBqlTyAqgR+D8KjKlmRL2gtUcAdCtsL+ijCNT1oqqqkH2OHEbG5sDFnUg5Aa+yLou2VU1ptj1S2ZQqv1ORZN9IWzRfgaRBxKoBE8UWyqlJFtrIc0AxNjSjed99CTY/XDfSzCz5M0IZoVEsWnPFNTsl8ooVC1TzbGgqFZNDSgVwKK+1sGDMKqxZCWGVMDysiEr1jVSQJUYwj5iHOlThdHt44SQg9CN+nl8D90NMIgAdgr46JqRiR9I8vRdFvbr17m/yxUMKjNLMiVUADwu2CWGhhi+F55TWM9M9cogzms1dnM4uOF/LAEYWdcqnM7yFmyq3IfwmOROd7Y1iFWtOjoY8To41mTV5IysgFFuRzsbWFGbNIIJCDv1dOo4lZG7jWBwRFtVTKuWyeCByJKOan8oZ3ep9XddNl0tDuaywLz9cXPYeDAA0SpkBO9sbVcTOVWldPv4uyzEkzxHtjvonHoSkFEWNoo1d8DhcQputd2ppNon4BzoAiJ1hBFQg0dVtdbGHHDQWushmNEQukLM2QO1G2Y8bgTXqFhcBJj7EjPgcPts8US8qPpPB/dXznOh5Z438tzH5ec6QgrOKrRRfKmysBmUDB+PhYabMlVPER+GCSITTzr7am2tArH3bgcEzPJm+cr5jJ4NnHNFDVrFXcI5Le9k5Jnw+bedbV+FfRzZIHaOOaOsLY0/7UGs58DjrGwKMIMFIGzOEW1/jGsdAtCN6hEAI4hBe9YXeRROBSVPAVPAqvIM5bx5hVKWAMP6zBRy3iescridVdFBinBxXDnG2GRY2XbCvp1lhvGtO9Bxu5h908XQu42lnSArMFdizMim8uwRCxPGnnOS8lwpnbOiDqTAjsrRN/PcoAScCbaACqVM40ylnjjTBs+bwWlAG23/UKbdkiwKWIQPGzWaczpoSlxPEj822cNWkpS7FyzsDrqpfgpG3jahw2vgbaSQAxuLWZYt7JzyNe8JoZpNAcvDFOdw0wqYT9AK1rZz/DdbSlLPp0ryIxgQJlK9AZlEq7IOXpohg9PIhrCng88JsOxiV4ZWAYfg4sikx/8ky2Z9l862uqwrfscIH8+ugTmVGyiddeVYUgEMn4GZzg14EwIsh9sx2cKKiWXReuOE5gzGOQgdlRKVVdlevqb279Xq0Qnsts2VDaBO0coezsruWtHApu6sKG4IBhN0aGU2kLrMKGRTN3HmbCDwKV14zvkMEDG4QfZVspVlaNU2mhc5TEZ3N1h/zqTheuLpW05ZWTGVjb3dbnNmxKZBnN8JqidaVLKAOyARNLS+MB54Z2+VaqoMLKroVBlngefnTPAcoHNWCSvlfA8CI0HEmBNBnBlXyMrzU7A7WVm94PPqQ2gmqKx+WDGsnvilmcSOBJqOK1nYyAIzuAyesq3UdSK3KfWcYKD95HmfYOU3qser2CtYEUA+FpfqdNvgPBZUBhDrGONRVlQsh8rLcaUCykHG0OOUwTlLBrsh5soEMGezi1E4HRVt1icp5wZEFXdibCkG8Y8vX75sbO4E0iom9z+hjSiOfy3DhpXItpVhE+UGQdvoWjtChmrGHf4YAzKgBNnGtuJxFCeGdhUAfQLLK8kBYAP6gvFJZajMG3Xkycy8KuC0q4Eyymwtwdxdv2M0mIBtK0LKnf640j00Auq4gUkdWGlhs22qJc6dZCsL19oxnlTJG4SYVRIGpD8TPFBuM6OElbS1pldid4mGAyN6ZIupbC5bXJN9fdpbThSxLUaI8IG1XIYBxW3Tjs6KQosKcxfxcQmdnwRGM10GnFcCy2XYunLMyAkdgk4mePiczsLygthcBut6goOqS7YVFXADLjaosB6s6ofcZWAZSIRYqSUkizYwttYab3vUOQ9w2HRxIIg8WwRVeE68xi4UtL3zRphxplzwuZrcqYCq1I3jPI5dnJIygEohMbPqVJSzrwzxBJTs5zN+ReUSgxikPQVF3JVBeNQxbHENrEMNvEdFZVV9lH9+ORGEsNZQpyTNc4C3AG7XF4ngzq+DrO2zbuaaOXgdaFcdkEotoSFBVX2qJ0C8OWZeG4KGlpghA0XfTOPCqV2qqwQ26QWfF2PMLhI2w1lVAa2aPsYd0za25MQRwgcZN6uQDCi+ZxiD4XEM2kZxOT41FnZnaRlcpZouzlRqqdbQVWopQoSB58RV50lBNrHi/AwXS5LrwDVlpY3Fc3ByiYGc52Trist6kOXdwInAQtJpp5QchyaquYOV7Su+fxVMaV3dc0RE2S6mUY0gLt2pMcYqrKIQ9w2l1gpQUMtQYcmmbt5DTNxdhnUCjQqtbK9SUSzvrC0mmhhE1e2FS2+oxypy/ZASutkmtjx3vcBC24PX65nbqkBCRhfjS9kIYPnee8cMagVOhI/3T1fAmdtAWZsCswTJCkQVNa0qWKSKPOpHAUhD9DrbVcyoYkwqhvh17vYAayXLQyKGYdxlUDFp494rBXRjYgO17DDYetNIUj/ezp6S0lnlpEwsWmJMkOwsKXeZKEAjIHn0EQJISaRBcO6UMINz7p/bEjjnw4ft+xmDvksxX4G2rIris7qaeKwAFMP2Oi7n4criuZwtpSUwpfLxSnORSrIqusc5ZFaXysqRWjiZ2DyAWEIL35tVSoQElFACjOeGGSE7AHEQgdo/LSvCOgGBvkxsmDbvlS3Fp5vhaB2TAGqRKrKKMrhLVpaGzEVjZ0OQxDhaCTA+QyRR1d15aQzrJntL3RibsipjG6jlgL4yqbS0sNYg1e84vhbBVrElK64CUcWYXDfKxhpIuxiVJZUxsbMy/uRBKTNRQ4kQ3LdRYLS0rJjRPlTPqY6gdJsEDc+aQXAn+HgsNUCbRuF0Oj0zwnA7bWDkbhO5Ens00qeQhS1laBMl5M/cAaxsLF8rKyql+Tf7ELLEGu/ixiimdCvo0TjfpjKwaggen4eh5v7LokLKbLuyvHhcZG8dhGrEDx7Hg93ZppJF7qBqO3iVveXEDQNInzeoe8Yq6ePaZBZ2JviM3W2UAGotekRCAGq4EkF1X3DOnR11yRsBL1tRa0PVcZiNFXZ2c34FskvomInQQ6lzpJoZbJxk43NwKJFBquJSsrByHydxKOnTxQASBmS3j+JMnsHSla3Ec6K9VWoJVn9zfjwOM7hqYAAqJQwE2a3nA48J2QGegRkpZNivSY+ys3EkKd4oJIwsvIHl3cWgLt5k4NH6OmtLWdpurOkwEMupYc7eMtDRhOcI2ui5JhVIzXzLyto/GAPuZoyo8wkoduVgJglCt7OhGbgID4Mq4si+63zUS1FuFFXFlqyaj2emHlLMcBqYu0FMuR28BbB7lOxRMSiCQXFhCKuwkhZ+pYDiGSgbsKKV8MiSRsuHSIWM9rklRiIlZZuqXjsQK8ooYJMgq3JKWVkhHbhsVxFUzthOWPkYijcbx54IKsSdT+uLr3crGKyoYgFiGR9iBk4kfloUX+JIlQRQqabmpgnhqtpQpb6RVQ1WH5DnrS4hEoGZqaerQ2dhFbz8XePxShmDbo70eISjoorO2vK8SJXI4SUmEU4zWKDzUDtWTYw7xXlbSTEj4FRg7zKnKoGRALv0Gs9Tgc1BpCywGZRQAtqVz2xrBcAMzEpfZwFSa2G5W0QBFjSMapWAEFa3HcGN7CxDzECyIkJ97qwrqWNTWVo876PPsjPkj2wvgroM5lLZKMETKVql/CvnWVFiFa/SzJUQwkoZsr67Y6vlSRV3/2tmNTOY3vnaxYwMuoPKqdzR1w7IqHymlPxaAThfU7Ko2ZXYj4AYJHL+kNdKwRQYESTRa5fsUZ/rVC1TMTyWVyYoqNtuzaHsMyv2tvoarxdfqwYgU1axFo/cnql1FGsqK+uAROV8BX4GU8WcZTATi2q7Qcyi0O0V+GhWBMNRUkn8H1SsWVE5By3Gi0ECqUeJoBfAtDa4amkdXG37AGP5Ggeb84p7UazpoKRzdFzeQ8HkoHGxprKy/Hpm5t12p47J6xTYDEz7uINEXSuxYXvFskYAc+ySxH9sf5ftKzU6IbwVBcUGg5e5FMCEXSErZR0wGayV19woM9guPjTqJdVTqR4uE4nJnLldWVkECCZLd2VLF+xtamex7IpiriSDUpvrpn9lrwGMCHyppMH+ps6LILsuFGUj1XEOXiqbqSHPUKnClpWV68kqtURVNDY4TNaocykoYeTU5ngGEQa/S1DnnE4AeXMcKjHPAmFVjCBENaeyLVNHfr3px8xUstJ94hIpfH4HKE/eDaArK6lSyVVFbdt1gxTIVk3pppVlFXi4pEhVBTObquohU85MLXn1iahvUkHJjSCMc01tLFveVVBx0DodM6jftCu7DOtIzYxrc0qp1JGP2ayYFz2Gb6HvMrO8cnGtV6Gjm3uImSfD2GpWK6uowbZGMxFKQCo1pOMtcMXFpRst+hXGoAomF3sSTBGgTglbBKWwsQ3tZqaYSp0Z1CimRDWFcCJUPYJ00BI5FkKYNoifuQxmN88SWVXWLMaUqqqgC0BmQJR6sk3u9NCf6jYLXxAfqsYEgVLAhRY2AtgtflZNFmFyhxdrLkAdWlk4D88M2ixHyepIdhMHrG/iR1ZGtq0MGpbDbRPYOXeSY1M6Ny4ZstvGSktK+XbFPATj2D371saPEsAMXhXrsZ0km/XStkhhMyBfsa6uXFZe2VCe+YMr1+GKgwrQyNYq1VRrB+EizAow6NsdNKcyVEkYeM73ys6q4kAHp6BiFklTkIrVC5oYV7uzwOGCz4UJ0Stq2lWMJy4wtb+RetL6tZFicnJmBw5UjCvXXMZVJX2MQkbf+XN5EWd78Vz8/JEsMZTBiKNzsm1inLRUQ74H4NidaqI68j5sAFgxcRveC7ieLJXfQYxjZZ2CsiWFewZXJmBIlZ1tdtrX4hSuateKso/RZOtOKW2nmq1oTzeK6dRWAWu2NRVb4hq0SXm1GvtugHrbr5IXqmSktg5CuDE2MSlPwsY5kNE2Wp3AqiZbWVLAxiBF+2iBZbuNj6MB6rsMLC7FyasaYDyo7KkoPyEtw3pEMXfPvxAJi2jAQQgjrz0rLIZSWZlIoNhwd5xK4AR9mYNjWAaLrnuImJeBVN9zBORObVvbr+mTTfFSEJLSRnHo7hEJoIi8MFqjxmvgmF5URZz4zLFgZZ8Ctu2X7ggVccKm9gVxIsOHqxXgNMKnFWZYnf1dBnOhayXq17QwFlWW09eNKyVJFmXqaONGA5aCegMbJ3UUkGY1ic3nKWgjq8qfVYGQG1gRt6rs62a6HiqqUOqdesK5NmX4nGofJoiE1d0dF9lVVkvT1/kEEaaCoYOwFpcVcoLM+7669PxC9rWqktH0sWUYld0VCpuBZ/stVRcGgy9WX2+U1Qthi9SzAqSxzZsy+OiFzBYnySGV6Gku44rD8BCOZBV3BvD5+AKRHNwMEsB6EzHnJpkTAeiUlEGkcECeB6GDZTp5YEJTlvdrknxYjTllMkfNtXwDjM7uVjK5JXUUn43rrqpK2jytaxHW0M5G8DC8rtHMYs7KSgduVQMGTYFqFvVS6rkD3sDJ46afdYFwoq11AOKCBLhvwoUgc8IGANycR6knZrdJPdsuxnyjfd3FovTlRMdEdtOl5CMV5EHsXQBis7TOwvIDZaGj2Vnpbh7cpK63VwYEMLwqbjzyl699sawFFkF1yqjUU31HfC6sW1ZFVFuXVXVgz9keEaw0ys1lWfm+azQAQSWA+hKYVfsZjPncAcUB9oIayy/UZXRNckDGji77GsWbvBo6tPrWPqOyVkBUq+INeqpzNdYs/u0ifh5qmpqIW+33JVSUcwY70KL4U9lYdU6ljtSls7lmfi9g3YzeQfVkaGFaV3ODCnaD2N8wsEDFklE3RzM3ZghdYkWHsszq70FIecnKkVkt8ezMzRq9bkGuKojRLBVSod3Y1yPqKgYW7JRQTPVyy5xIYLjOgxgT52RKJUY1dOrIiRd4futQx/A5AcSmEjz0vFWrkLzvbWAu9HOWbGgxFk1VNTpnBKk6TgwisI/HcxYXP1uAWO72ULFlBTq+aSu2VTUs6hrxM2CF+hEor1VIA9ZmFUaab1lSSgZsVs4sxzHlVLoJHr9H4DhONTkI1XC0/wiY2NoWAG5RlnHFnq6oLccpQddMuJ/O17JVA5OHLi0BqCztq7Y1++ucCd98qLI8MIHBV/cKjxQTme3hFBS3MyCqnDsuym2o80HjvFFTtrURmNaGJsmVahImjTsUXKtQZTAVs7Mvv8/+fzUrZAXcLJ6M4koe6XP0b6SmWWNDzyUpQ8bl+LtWx4tuqZ36cRYV3yuVxPNwvIiqiQCSmu7srgTzR6nkyhpCarXwFy1vGd5iP2cY06lFr5Njhhg1Y6+NB28ftbK83s8rf7kLJbKwDFPbLg25a0AdZJEiqr5phixKMDlRUtcssq1hriLqGoH+zeNgVm9OemjsETV8JdF0NHnkIFxWY1OB4Yrp7rtWJ7NgAAAPXklEQVQ3oNs5nplyVf8u2FoLu1JrHveaZWQjqAkshtFa2gzsSG3Zpkbvg3HafF9slPPlldjFlK80Gysm8Mr4MPhneNWENPGjAIpmilTPATdTRTXlCBYHYAQuPwA36xIpWtGN4q3Y2MhiGsUpuSSnlEJRD8PorC7CFYVw+F51qThgabxsTxWzCGY0ZSsb3lfqAy0OPNjNy8xiQQKsHYFQ2HBZVvVbBuq3m1oWKajqaonsM6uZUr6CjXWNZ0l5E3h3jURma6kP3MJIiy1Lm+kahQq41N2iZja5sjtlLYNZHZrH6qUGm4vMbDp6Rw2CFmvuyFkrBcCyMtFqBaECmsHoK9BZ2LA/lJcRqSaDqnaWbrZdGaz3DLgIvBln4woGztbyJGqslwxkhhHrTjTYFXCtOoKS8uLdofVdAbOylGU6nlYpXWZts4nXBq6WxJitMNokHUJnbnJplQm+aGpY2a5GMV2QD1hRubBPFKdumf5OHkLHz0F9luE5kjBjRa0nFE5CUGqHw32MmjZ6xkgINVnSnZ1VZStK2qKlRaLlQgK7uTq7JFXJwM+3SOEKyhZNI+tJ0I5qMYy9k2qJD7dVWdqKXa0CKNR0Ccjg+B2IYu2fcBZJZkMFgM11r0X92wilghFGgzVnexlqB7xL9mS29SiYUVY2nXOZjNBRsyDsQPRWW5hrZ4XcdC4HVWRbjgJr4sFofK5SzjQ7rhI1UebdPdEbj6sqIvTZQZ5va08rABsAW0UxeWytAk7A2KJ9ZpxzCioB24XFtYAeXYxr6anSqhLgppEqWbGwLunTgrV+IjWlL29ljaAl4EQMGsErp4apeZiquwRXLXAqOCeru32mmydc6oWTSWpFAGdzeTB8RTHVMEtlM90CbbQCYhPjq3egYr1FGdYIQjiuDGZ5zZ/AzobKGOyLxti6c4Rwtv2anyWlLICnlLhxJRXt6A5ebDBWFNONbxWZ2d02mnu4S9YECpeppV1zSWRBWxHYzVIv1CXSouwqqX3jBBBDZdYQbpTQW4ZQlS8r5kH4suSRmg2++3JN10x1PaAmEkmtYlEdeGpJEM6kOuCqCR22oSujj5IV2HdT0zj5prLKTjXFAPjdQlyq7xIBxAQP5yMczG4VxAKw0n6ilZ2QBce2pLulkuxxqnoIzFfgqyqjil9S1VNwBrFmeyeops8yOjZUybZdfS8CuaTIJumzs5tODaNtLpFDQ/PcJGweLhmeL1nB0KqiUDScsiUVD89Di3HtrKtSULw3RLiygZD+7sF8JTObgYsrGvDNUFRGl1iy0Ll1YkUc2aJYMog920I8qW6YDCg1Mqk0JHJFKXkbgbRreI+qpYNOZHrVcDUba7pjsphSJNtK6upgRNAVoOS0mugBeN4bIZgHhuPZ/s1ENaX6KsVr+YNrh1Nb7ipR0PE5zbNRegCbrHRUw6Yf07dLBJl1f8KB9as2V1nNqAsl62LBBhehwalerkHmB1JFIEZKSEusdl5JQj1nJlHXSCF342gJ9CYGrXelknJIXqVP8sD+qtplCR3XH2qfKq0ygMp+KnVkKxNlZ8m2YkIlVMiCnXUwl7qznBKSvQz3m3Pt6oQbXO5b5FixCh/fHxUQW/AEcK6zCNqKQnL9sywqmKuwvqSYzT/aPVNNpVyhvRW21aqciCsjdWvBwILUvh5VyCzbWoC1pJjJ680CWsl+udKB6T5RwG1mlohnlpbg47iz5U9ha0FGtmRLFYBtO99y97Ap0z+ZDTAog6kSLZsMHg/IFkkgp6CpvU2U0cYVSdnmkjwBdOmXbxTWNWzuIbipMioVxEckZEoahSOiy2M3K0jcC1LhVDwaqG0ZvkcWqCnrG4GIxykrqlbWdw6LQyBaZR8HmLRIhQWsHswD42ZXVLNkf9l+FlW0HVQ2lwFsC/Z1FdzlQR0KaPfo+Fdfu+/dwVRICu1CGR7AEIiAhc+AZUF0kOBaPxmUqg4i64vQnU4nFDYJ9Nz+1fVXveH9qmr+kPILx8oKcRV/BFbxbE0JMT0kSD4w6L/lNY8ocsqagVdU3A3MjxhxcGuqzsPH4irpaow1q6OyrVjvp9Npc59E91LldboYVzJWdimWfAW2SNEKcDaX2FmBLLA/uKxlmhh613Is1URQApbKfttwxL02q6Onx5pQxSbPojAg+v5hAnN6LHVRDXIsvKtRjiS0qJUyZTAXVbAK82ElFJWaQdVoqUC1Unt7BVaTQudM6SuqexjQJN4+0icaxv/utbKv83ETbT8H8gjcOKxOJmbUa6OOVXht3dFY6rHv9XoNzFLceEA1o8+pKm0LAHPHZ2rYKjFq0hfZFixsqHJgD3eD5n+U0kb1mFjXkn2lvMSSOsNE/CdIAKF0Sytq6urOHUN5gwg4GZosgbmggM5ucra2qrS2Ig1cbiBBcxYzgzUDNLCvL8GbZXNp6ORy3LmS+Kk83zRIAK6A1ioKa2I9NapIuiUFdfC9766PFZUtqUr6KbWk+zZU1a/ZrIXEztrjTOfz7hwKziCeXIaraHtbZIMz+2pGgazCmw4qWAFvEdhodYp0Xq0pV7G1YWYWbO4qhGq42+Z8BYtrLWvluNPpZAeaFFS1vubPgbgxsqcpnAaszBovKaFoDQ8BGtjfUOl4NAG2nmQV04feJgumvX2fsrQEWZghL0JnVdYkn3DOZIeRN86RqPWCmsvGVqEMRnwxQAxwS8EMYo3IzmY2+BCcLp4MKiuyuhImamlbZFcNoNl7tp+RHd18ZjQIRKyXdFRhN98/hyKqwXWNo7O1wiaXoHN108REZZWEq6grnIfjzeg8jdRf1XEL4kkXa5bBjKxoKaljBjeHlVxQ4GaycpW4lDOAKtnTxHAtOfzOtZwHAM7sqVXkV6yu6kap1nHkXKqWF/4XHqjenNKqBjpR3l1ch3Ejg1+EsgdQhsdG0B4FM9sWAVWpuAyiwTPleZxt9VyZVS2qXfReWqTAilpr9ApoWTjxymit7NwV4JTriZyOA9B0k7HFfULourmKYHVnRQvqGL5HMHdqFcR2qWpmcK6eTwx2dipWrviDilr+fKWq3OWRWdHKwA4eu8wjchbeRzFilqjjZN3ufCpfkJ0/scVpnYk6L0PI77lxdWCZ87WiWm7B/AGquQSnujGKsB8CJmiJq8q1pKIVWyqOiTK66r18BN8r74/AE71fdC3yPS2MxdOpnE1tlVxD9JmVOoggN+r4PjAXVFPa3Eg5jVJGFVUGNolH20GVrUB7BOySWq6WqYQdWR92pcFMYMwckbSgCKCqD67DiiWu1g8MQC9ByfcFqW1L+jL714qNCuznoSxt0da2gtWN1G8F0BK0NN0nuimelUF9dIdAfjO44UT3CjQLoUeLHJFTO3gmpRuIIOvwBQCbqNeo3qtZ9iF6xVK13GRlo4zqimq+CGdTiR1uRY8oqgE02hZBa79kZXPMquxRHKla2saZWN4mRqZUj0vLCKhkjKnqOQHNuSZVJoKvAqS1wpEquvWDC1B2ypwrCPsRMEPVTODMLJMDv6qeKXwi2JYV5Sq4qKyvgGsHCLiuj2jR59V8gMqSJ2FJZRXEHVRHj3sFPrct6OpqlW1GpatQdt0GvwfM6n63InsGVFhJGaBqgqqIV6IsXllZgySPq4R3bnt3wi5cv+cN2yqQLW1T95KYVsWWtKk4cB9W53WQQflQYR6Wl4HaJZjvVE0D5yvq+RKgZCs5qdBEP5sD94cAvQLlSgNaSMAtHx88BuNQ41zdFsX30zKbcs0MLD/ihkpQzl0wiTqKLTfbKmCmyYICnK0IbaieC4CG9iSyLQ7cIMGQwau6TKoq60Apl3WN40LZpca1CKKK9VQyyIEn8w0F8F6CL2h8o3ixGwC7s7EWzCOqmcApYxYD4jsAzVS0sl2t98pA7vrKophCVSonbYpgH6mvSn24pTBV4sdtV3BtMq5k82y+IADvUJ0uAlkCVTxIaPm+UNu/qkV4F1TzHXCGrXIAqItBKypqK99VtAOVs64O4ObX7pHLVCpYHcRmwvLR7TvYAKBBN58LGVzDuFz+hQbWgncQyCZAk+VbsPSouf93261iZgmfCpwRbAvqmSqriU2PwhjaoOyYqtIegVXViTsmyta6bGySpY3gyRrpIyAeaWDDxtpsXwKyalMDKNP7YBXMqEskUsi2uC8FNAPxAKTVfT1o6VzM0E0jF+1rWcUuHvdyg7vgoFplX8HpvHpMCOMRUPHzZkInsqlFKNX/EIO52E0SxSzOwob2VmRLW5D1XIU0rbgM1AzWgyC7fe8G7xUAK/taEBat7luqtyP7EmsaJQOj5F+mrnZfCuYCfBUAWwShyd6pMY/vAHG1UqOYpbI/gy5T0CMKm+UO3gFuC85dgfDVeguPDfITrIBLsLrcgdh3CFgFZjaKJ4Iv3F8ANEqvuxR1tVKOgLoCa1jxboBAkj6v7j/icFbA7f4rfRnQDLRViG13i0vqBQrYVqBbADZT0ZpiHoSzvQpopKIFS3sE1HfBWlHXd0H7LnArqvougMtljHBgZnh3Eoz/BKjLML4Z2Aq0+hEJr9jaVUBbvNzCIUiroC7AWmmFw4o5AK3MtB5VypZMSFgs05JyGVwlwBqsEGAAa2ZU1CjUexXGsE4rKriilBvFzOKKo3AuAroE6QFQU3u8YpNXwS5k+1TZt5UrwouN4KiUEw+k3ZWDp1RXHNRqXb21Ts39945yZSg3VnZFNQ9CF3XeZyr5DgBXKiwCMa2MxeTDYXgP1Fsf9QNKZc0k81RJk3r6EQ3rCmBVyLL75EjZ1pIVDHoFtiOAHoB0BdTVylqBsKKKS+AeBXJVLY+CXASuGvO/Auq7GuEjDfGKg1oKa1z/dmmi9I9SUGNhl0AtfulHAawoYrnSkmNXAVuGEhrEVXvUF+A5Ct2PqNOjDetyna4CmeUolmeXLN4Aq7C5Sj10Q7yjgl+t6CNxSRHmI5X+CpwreYB3Qfdqna4q21KdBuc4GoZsn49ZOOiVinwHqK9WzjvgeweEh2AU5+vtxZ9Cd9Wqkh49V18E5oj6vVyn0RStAyGIO5edXRKd5B0VGVXq2yr3xYp+5Ut+C4QJ4P1N339pQMjRejj4vb/Dcr6rQc3O/0rjmtZpeYCBiCHfCemRbNhbK/pNUPc3wfKy5f2D7OlL3/uPhve/oU4T0F8f+VNM2vyoiv0jK+KHQfdHq+0bncz4oz73/+Y6LbKw1o/5B7eOf1Rl/0du9B9tn/9bvrf/j+v0h6ttn2tp/r/4819y4/zv5391uvzzfwDifz6phT1MPgAAAABJRU5ErkJggg==)}.color-picker .cp-add-color-button-class{position:absolute;display:inline;padding:0;margin:3px -3px;border:0;cursor:pointer;background:transparent}.color-picker .cp-add-color-button-class:hover{text-decoration:underline}.color-picker .cp-add-color-button-class:disabled{cursor:not-allowed;color:#999}.color-picker .cp-add-color-button-class:disabled:hover{text-decoration:none}.color-picker .cp-remove-color-button-class{position:absolute;top:-5px;right:-5px;display:block;width:10px;height:10px;border-radius:50%;cursor:pointer;text-align:center;background:#fff;box-shadow:1px 1px 5px #333}.color-picker .cp-remove-color-button-class:before{content:"x";position:relative;bottom:3.5px;display:inline-block;font-size:10px}.color-picker .eyedropper-icon{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);fill:#fff;mix-blend-mode:exclusion}\n'],encapsulation:2}),r})(),cj=(()=>{class r{constructor(e,n,i,o,u,m){this.injector=e,this.cfr=n,this.appRef=i,this.vcRef=o,this.elRef=u,this._service=m,this.dialogCreated=!1,this.ignoreChanges=!1,this.viewAttachedToAppRef=!1,this.cpWidth="230px",this.cpHeight="auto",this.cpToggle=!1,this.cpDisabled=!1,this.cpIgnoredElements=[],this.cpFallbackColor="",this.cpColorMode="color",this.cpCmykEnabled=!1,this.cpOutputFormat="auto",this.cpAlphaChannel="enabled",this.cpDisableInput=!1,this.cpDialogDisplay="popup",this.cpSaveClickOutside=!0,this.cpCloseClickOutside=!0,this.cpUseRootViewContainer=!1,this.cpPosition="auto",this.cpPositionOffset="0%",this.cpPositionRelativeToArrow=!1,this.cpOKButton=!1,this.cpOKButtonText="OK",this.cpOKButtonClass="cp-ok-button-class",this.cpCancelButton=!1,this.cpCancelButtonText="Cancel",this.cpCancelButtonClass="cp-cancel-button-class",this.cpEyeDropper=!1,this.cpPresetLabel="Preset colors",this.cpPresetColorsClass="cp-preset-colors-class",this.cpMaxPresetColorsLength=6,this.cpPresetEmptyMessage="No colors added",this.cpPresetEmptyMessageClass="preset-empty-message",this.cpAddColorButton=!1,this.cpAddColorButtonText="Add color",this.cpAddColorButtonClass="cp-add-color-button-class",this.cpRemoveColorButtonClass="cp-remove-color-button-class",this.cpInputChange=new Nn(!0),this.cpToggleChange=new Nn(!0),this.cpSliderChange=new Nn(!0),this.cpSliderDragEnd=new Nn(!0),this.cpSliderDragStart=new Nn(!0),this.colorPickerOpen=new Nn(!0),this.colorPickerClose=new Nn(!0),this.colorPickerCancel=new Nn(!0),this.colorPickerSelect=new Nn(!0),this.colorPickerChange=new Nn(!1),this.cpCmykColorChange=new Nn(!0),this.cpPresetColorsChange=new Nn(!0)}handleClick(){this.inputFocus()}handleFocus(){this.inputFocus()}handleInput(e){this.inputChange(e)}ngOnDestroy(){null!=this.cmpRef&&(this.viewAttachedToAppRef&&this.appRef.detachView(this.cmpRef.hostView),this.cmpRef.destroy(),this.cmpRef=null,this.dialog=null)}ngOnChanges(e){e.cpToggle&&!this.cpDisabled&&(e.cpToggle.currentValue?this.openDialog():e.cpToggle.currentValue||this.closeDialog()),e.colorPicker&&(this.dialog&&!this.ignoreChanges&&("inline"===this.cpDialogDisplay&&this.dialog.setInitialColor(e.colorPicker.currentValue),this.dialog.setColorFromString(e.colorPicker.currentValue,!1),this.cpUseRootViewContainer&&"inline"!==this.cpDialogDisplay&&this.cmpRef.changeDetectorRef.detectChanges()),this.ignoreChanges=!1),(e.cpPresetLabel||e.cpPresetColors)&&this.dialog&&this.dialog.setPresetConfig(this.cpPresetLabel,this.cpPresetColors)}openDialog(){if(this.dialogCreated)this.dialog&&this.dialog.openDialog(this.colorPicker);else{let e=this.vcRef;if(this.dialogCreated=!0,this.viewAttachedToAppRef=!1,this.cpUseRootViewContainer&&"inline"!==this.cpDialogDisplay){const o=this.injector.get(this.appRef.componentTypes[0],Fo.NULL);o!==Fo.NULL?e=o.vcRef||o.viewContainerRef||this.vcRef:this.viewAttachedToAppRef=!0}const n=this.cfr.resolveComponentFactory(lj);if(this.viewAttachedToAppRef)this.cmpRef=n.create(this.injector),this.appRef.attachView(this.cmpRef.hostView),document.body.appendChild(this.cmpRef.hostView.rootNodes[0]);else{const i=Fo.create({providers:[],parent:e.injector});this.cmpRef=e.createComponent(n,0,i,[])}this.cmpRef.instance.setupDialog(this,this.elRef,this.colorPicker,this.cpWidth,this.cpHeight,this.cpDialogDisplay,this.cpFallbackColor,this.cpColorMode,this.cpCmykEnabled,this.cpAlphaChannel,this.cpOutputFormat,this.cpDisableInput,this.cpIgnoredElements,this.cpSaveClickOutside,this.cpCloseClickOutside,this.cpUseRootViewContainer,this.cpPosition,this.cpPositionOffset,this.cpPositionRelativeToArrow,this.cpPresetLabel,this.cpPresetColors,this.cpPresetColorsClass,this.cpMaxPresetColorsLength,this.cpPresetEmptyMessage,this.cpPresetEmptyMessageClass,this.cpOKButton,this.cpOKButtonClass,this.cpOKButtonText,this.cpCancelButton,this.cpCancelButtonClass,this.cpCancelButtonText,this.cpAddColorButton,this.cpAddColorButtonClass,this.cpAddColorButtonText,this.cpRemoveColorButtonClass,this.cpEyeDropper,this.elRef,this.cpExtraTemplate),this.dialog=this.cmpRef.instance,this.vcRef!==e&&this.cmpRef.changeDetectorRef.detectChanges()}}closeDialog(){this.dialog&&"popup"===this.cpDialogDisplay&&this.dialog.closeDialog()}cmykChanged(e){this.cpCmykColorChange.emit(e)}stateChanged(e){this.cpToggleChange.emit(e),e?this.colorPickerOpen.emit(this.colorPicker):this.colorPickerClose.emit(this.colorPicker)}colorChanged(e,n=!0){this.ignoreChanges=n,this.colorPickerChange.emit(e)}colorSelected(e){this.colorPickerSelect.emit(e)}colorCanceled(){this.colorPickerCancel.emit()}inputFocus(){const e=this.elRef.nativeElement,n=this.cpIgnoredElements.filter(i=>i===e);!this.cpDisabled&&!n.length&&("undefined"!=typeof document&&e===document.activeElement?this.openDialog():this.dialog&&this.dialog.show?this.closeDialog():this.openDialog())}inputChange(e){this.dialog?this.dialog.setColorFromString(e.target.value,!0):(this.colorPicker=e.target.value,this.colorPickerChange.emit(this.colorPicker))}inputChanged(e){this.cpInputChange.emit(e)}sliderChanged(e){this.cpSliderChange.emit(e)}sliderDragEnd(e){this.cpSliderDragEnd.emit(e)}sliderDragStart(e){this.cpSliderDragStart.emit(e)}presetColorsChanged(e){this.cpPresetColorsChange.emit(e)}}return r.\u0275fac=function(e){return new(e||r)(qn(Fo),qn(Kv),qn(F0),qn(If),qn(fm),qn(HE))},r.\u0275dir=Pa({type:r,selectors:[["","colorPicker",""]],hostBindings:function(e,n){1&e&&Qr("click",function(){return n.handleClick()})("focus",function(){return n.handleFocus()})("input",function(o){return n.handleInput(o)})},inputs:{colorPicker:"colorPicker",cpWidth:"cpWidth",cpHeight:"cpHeight",cpToggle:"cpToggle",cpDisabled:"cpDisabled",cpIgnoredElements:"cpIgnoredElements",cpFallbackColor:"cpFallbackColor",cpColorMode:"cpColorMode",cpCmykEnabled:"cpCmykEnabled",cpOutputFormat:"cpOutputFormat",cpAlphaChannel:"cpAlphaChannel",cpDisableInput:"cpDisableInput",cpDialogDisplay:"cpDialogDisplay",cpSaveClickOutside:"cpSaveClickOutside",cpCloseClickOutside:"cpCloseClickOutside",cpUseRootViewContainer:"cpUseRootViewContainer",cpPosition:"cpPosition",cpPositionOffset:"cpPositionOffset",cpPositionRelativeToArrow:"cpPositionRelativeToArrow",cpOKButton:"cpOKButton",cpOKButtonText:"cpOKButtonText",cpOKButtonClass:"cpOKButtonClass",cpCancelButton:"cpCancelButton",cpCancelButtonText:"cpCancelButtonText",cpCancelButtonClass:"cpCancelButtonClass",cpEyeDropper:"cpEyeDropper",cpPresetLabel:"cpPresetLabel",cpPresetColors:"cpPresetColors",cpPresetColorsClass:"cpPresetColorsClass",cpMaxPresetColorsLength:"cpMaxPresetColorsLength",cpPresetEmptyMessage:"cpPresetEmptyMessage",cpPresetEmptyMessageClass:"cpPresetEmptyMessageClass",cpAddColorButton:"cpAddColorButton",cpAddColorButtonText:"cpAddColorButtonText",cpAddColorButtonClass:"cpAddColorButtonClass",cpRemoveColorButtonClass:"cpRemoveColorButtonClass",cpExtraTemplate:"cpExtraTemplate"},outputs:{cpInputChange:"cpInputChange",cpToggleChange:"cpToggleChange",cpSliderChange:"cpSliderChange",cpSliderDragEnd:"cpSliderDragEnd",cpSliderDragStart:"cpSliderDragStart",colorPickerOpen:"colorPickerOpen",colorPickerClose:"colorPickerClose",colorPickerCancel:"colorPickerCancel",colorPickerSelect:"colorPickerSelect",colorPickerChange:"colorPickerChange",cpCmykColorChange:"cpCmykColorChange",cpPresetColorsChange:"cpPresetColorsChange"},exportAs:["ngxColorPicker"],features:[Lo]}),r})(),hj=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=Gi({type:r}),r.\u0275inj=io({providers:[HE],imports:[[Df]]}),r})();var pj=function(){function r(){this.disposed=!1}return r.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposeInternal())},r.prototype.disposeInternal=function(){},r}();const WE=pj;var dj=function(){function r(t){this.type=t,this.target=null}return r.prototype.preventDefault=function(){this.defaultPrevented=!0},r.prototype.stopPropagation=function(){this.propagationStopped=!0},r}();const _m=dj;function r_(r,t){return r>t?1:r<t?-1:0}function MD(r,t){return r.indexOf(t)>=0}function Kb(r,t,e){var n=r.length;if(r[0]<=t)return 0;if(t<=r[n-1])return n-1;var i=void 0;if(e>0){for(i=1;i<n;++i)if(r[i]<t)return i-1}else if(e<0){for(i=1;i<n;++i)if(r[i]<=t)return i}else for(i=1;i<n;++i){if(r[i]==t)return i;if(r[i]<t)return"function"==typeof e?e(t,r[i-1],r[i])>0?i-1:i:r[i-1]-t<t-r[i]?i-1:i}return n-1}function mj(r,t,e){for(;t<e;){var n=r[t];r[t]=r[e],r[e]=n,++t,--e}}function og(r,t){for(var e=Array.isArray(t)?t:[t],n=e.length,i=0;i<n;i++)r[r.length]=e[i]}function j0(r,t){for(var n,e=r.length>>>0,i=0;i<e;i++)if(t(n=r[i],i,r))return n;return null}function i_(r,t){var e=r.length;if(e!==t.length)return!1;for(var n=0;n<e;n++)if(r[n]!==t[n])return!1;return!0}function $E(r,t){var e;return r.every(function(i,o){return e=o,!t(i,o,r)})?-1:e}function qy(){return!0}function o_(){return!1}function a_(){}var $a="function"==typeof Object.assign?Object.assign:function(r,t){if(null==r)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(r),n=1,i=arguments.length;n<i;++n){var o=arguments[n];if(null!=o)for(var u in o)o.hasOwnProperty(u)&&(e[u]=o[u])}return e};function t1(r){for(var t in r)delete r[t]}var XE="function"==typeof Object.values?Object.values:function(r){var t=[];for(var e in r)t.push(r[e]);return t};function s_(r){var t;for(t in r)return!1;return!t}var r,vj=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),_j=function(r){function t(e){var n=r.call(this)||this;return n.eventTarget_=e,n.pendingRemovals_=null,n.dispatching_=null,n.listeners_=null,n}return vj(t,r),t.prototype.addEventListener=function(e,n){if(e&&n){var i=this.listeners_||(this.listeners_={}),o=i[e]||(i[e]=[]);-1===o.indexOf(n)&&o.push(n)}},t.prototype.dispatchEvent=function(e){var n="string"==typeof e?new _m(e):e,i=n.type;n.target||(n.target=this.eventTarget_||this);var u,o=this.listeners_&&this.listeners_[i];if(o){var m=this.dispatching_||(this.dispatching_={}),b=this.pendingRemovals_||(this.pendingRemovals_={});i in m||(m[i]=0,b[i]=0),++m[i];for(var T=0,F=o.length;T<F;++T)if(!1===(u="handleEvent"in o[T]?o[T].handleEvent(n):o[T].call(this,n))||n.propagationStopped){u=!1;break}if(--m[i],0===m[i]){var V=b[i];for(delete b[i];V--;)this.removeEventListener(i,a_);delete m[i]}return u}},t.prototype.disposeInternal=function(){this.listeners_&&t1(this.listeners_)},t.prototype.getListeners=function(e){return this.listeners_&&this.listeners_[e]||void 0},t.prototype.hasListener=function(e){return!!this.listeners_&&(e?e in this.listeners_:Object.keys(this.listeners_).length>0)},t.prototype.removeEventListener=function(e,n){var i=this.listeners_&&this.listeners_[e];if(i){var o=i.indexOf(n);-1!==o&&(this.pendingRemovals_&&e in this.pendingRemovals_?(i[o]=a_,++this.pendingRemovals_[e]):(i.splice(o,1),0===i.length&&delete this.listeners_[e]))}},t}(WE);const U0=_j;function Zo(r,t,e,n,i){if(n&&n!==r&&(e=e.bind(n)),i){var o=e;e=function(){r.removeEventListener(t,e),o.apply(this,arguments)}}var u={target:r,type:t,listener:e};return r.addEventListener(t,e),u}function Jb(r,t,e,n){return Zo(r,t,e,n,!0)}function il(r){r&&r.target&&(r.target.removeEventListener(r.type,r.listener),t1(r))}var xj=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Qb=function(r){function t(){var e=r.call(this)||this;return e.on=e.onInternal,e.once=e.onceInternal,e.un=e.unInternal,e.revision_=0,e}return xj(t,r),t.prototype.changed=function(){++this.revision_,this.dispatchEvent("change")},t.prototype.getRevision=function(){return this.revision_},t.prototype.onInternal=function(e,n){if(Array.isArray(e)){for(var i=e.length,o=new Array(i),u=0;u<i;++u)o[u]=Zo(this,e[u],n);return o}return Zo(this,e,n)},t.prototype.onceInternal=function(e,n){var i;if(Array.isArray(e)){var o=e.length;i=new Array(o);for(var u=0;u<o;++u)i[u]=Jb(this,e[u],n)}else i=Jb(this,e,n);return n.ol_key=i,i},t.prototype.unInternal=function(e,n){var i=n.ol_key;if(i)n1(i);else if(Array.isArray(e))for(var o=0,u=e.length;o<u;++o)this.removeEventListener(e[o],n);else this.removeEventListener(e,n)},t}(U0);function n1(r){if(Array.isArray(r))for(var t=0,e=r.length;t<e;++t)il(r[t]);else il(r)}const AD=Qb;function li(){return function(){throw new Error("Unimplemented abstract method.")}()}var bj=0;function Si(r){return r.ol_uid||(r.ol_uid=String(++bj))}var wj=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Cj=function(r){function t(e,n,i,o){var u=r.call(this)||this;return u.extent=e,u.pixelRatio_=i,u.resolution=n,u.state=o,u}return wj(t,r),t.prototype.changed=function(){this.dispatchEvent("change")},t.prototype.getExtent=function(){return this.extent},t.prototype.getImage=function(){return li()},t.prototype.getPixelRatio=function(){return this.pixelRatio_},t.prototype.getResolution=function(){return this.resolution},t.prototype.getState=function(){return this.state},t.prototype.load=function(){li()},t}(U0);const kD=Cj;var Ej=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Sj=function(r){function t(e){var n=this,o="Assertion failed. See https://openlayers.org/en/v"+"6.9.0".split("-")[0]+"/doc/errors/#"+e+" for details.";return(n=r.call(this,o)||this).code=e,n.name="AssertionError",n.message=o,n}return Ej(t,r),t}(Error);const PD=Sj;function bo(r,t){if(!r)throw new PD(t)}function Hc(r){for(var t=[1/0,1/0,-1/0,-1/0],e=0,n=r.length;e<n;++e)G0(t,r[e]);return t}function kf(r,t,e){return e?(e[0]=r[0]-t,e[1]=r[1]-t,e[2]=r[2]+t,e[3]=r[3]+t,e):[r[0]-t,r[1]-t,r[2]+t,r[3]+t]}function RD(r,t){return t?(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t):r.slice()}function l_(r,t,e){var n,i;return(n=t<r[0]?r[0]-t:r[2]<t?t-r[2]:0)*n+(i=e<r[1]?r[1]-e:r[3]<e?e-r[3]:0)*i}function ew(r,t){return KE(r,t[0],t[1])}function ag(r,t){return r[0]<=t[0]&&t[2]<=r[2]&&r[1]<=t[1]&&t[3]<=r[3]}function KE(r,t,e){return r[0]<=t&&t<=r[2]&&r[1]<=e&&e<=r[3]}function JE(r,t){var u=t[0],m=t[1],b=0;return u<r[0]?b|=16:u>r[2]&&(b|=4),m<r[1]?b|=8:m>r[3]&&(b|=2),0===b&&(b=1),b}function bm(r,t,e,n,i){return i?(i[0]=r,i[1]=t,i[2]=e,i[3]=n,i):[r,t,e,n]}function u_(r){return bm(1/0,1/0,-1/0,-1/0,r)}function V0(r,t){var e=r[0],n=r[1];return bm(e,n,e,n,t)}function QE(r,t,e,n,i){return FD(u_(i),r,t,e,n)}function c_(r,t){return r[0]==t[0]&&r[2]==t[2]&&r[1]==t[1]&&r[3]==t[3]}function OD(r,t){return t[0]<r[0]&&(r[0]=t[0]),t[2]>r[2]&&(r[2]=t[2]),t[1]<r[1]&&(r[1]=t[1]),t[3]>r[3]&&(r[3]=t[3]),r}function G0(r,t){t[0]<r[0]&&(r[0]=t[0]),t[0]>r[2]&&(r[2]=t[0]),t[1]<r[1]&&(r[1]=t[1]),t[1]>r[3]&&(r[3]=t[1])}function FD(r,t,e,n,i){for(;e<n;e+=i)Mj(r,t[e],t[e+1]);return r}function Mj(r,t,e){r[0]=Math.min(r[0],t),r[1]=Math.min(r[1],e),r[2]=Math.max(r[2],t),r[3]=Math.max(r[3],e)}function eS(r,t){var e;return!!((e=t(q0(r)))||(e=t(i1(r)),e)||(e=t(o1(r)),e)||(e=t(lg(r)),e))&&e}function tw(r){var t=0;return nw(r)||(t=Xs(r)*mh(r)),t}function q0(r){return[r[0],r[1]]}function i1(r){return[r[2],r[1]]}function wm(r){return[(r[0]+r[2])/2,(r[1]+r[3])/2]}function Aj(r,t){var e;return"bottom-left"===t?e=q0(r):"bottom-right"===t?e=i1(r):"top-left"===t?e=lg(r):"top-right"===t?e=o1(r):bo(!1,13),e}function Z0(r,t,e,n,i){var o=t*n[0]/2,u=t*n[1]/2,m=Math.cos(e),b=Math.sin(e),T=o*m,F=o*b,V=u*m,H=u*b,J=r[0],ne=r[1],we=J-T+H,Re=J-T-H,qe=J+T-H,Ne=J+T+H,$e=ne-F-V,tt=ne-F+V,bt=ne+F+V,dn=ne+F-V;return bm(Math.min(we,Re,qe,Ne),Math.min($e,tt,bt,dn),Math.max(we,Re,qe,Ne),Math.max($e,tt,bt,dn),i)}function mh(r){return r[3]-r[1]}function sg(r,t,e){var n=e||[1/0,1/0,-1/0,-1/0];return Cc(r,t)?(n[0]=r[0]>t[0]?r[0]:t[0],n[1]=r[1]>t[1]?r[1]:t[1],n[2]=r[2]<t[2]?r[2]:t[2],n[3]=r[3]<t[3]?r[3]:t[3]):u_(n),n}function lg(r){return[r[0],r[3]]}function o1(r){return[r[2],r[3]]}function Xs(r){return r[2]-r[0]}function Cc(r,t){return r[0]<=t[2]&&r[2]>=t[0]&&r[1]<=t[3]&&r[3]>=t[1]}function nw(r){return r[2]<r[0]||r[3]<r[1]}var Cm={RADIANS:"radians",DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},Yd={};Yd[Cm.RADIANS]=6370997/(2*Math.PI),Yd[Cm.DEGREES]=2*Math.PI*6370997/360,Yd[Cm.FEET]=.3048,Yd[Cm.METERS]=1,Yd[Cm.USFEET]=1200/3937;const Kd=Cm;var Lj=function(){function r(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}return r.prototype.canWrapX=function(){return this.canWrapX_},r.prototype.getCode=function(){return this.code_},r.prototype.getExtent=function(){return this.extent_},r.prototype.getUnits=function(){return this.units_},r.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||Yd[this.units_]},r.prototype.getWorldExtent=function(){return this.worldExtent_},r.prototype.getAxisOrientation=function(){return this.axisOrientation_},r.prototype.isGlobal=function(){return this.global_},r.prototype.setGlobal=function(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)},r.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},r.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t},r.prototype.setExtent=function(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)},r.prototype.setWorldExtent=function(t){this.worldExtent_=t},r.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t},r.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},r}();const h_=Lj;function Wc(r,t,e){return Math.min(Math.max(r,t),e)}var Fj="cosh"in Math?Math.cosh:function(t){var e=Math.exp(t);return(e+1/e)/2},zj="log2"in Math?Math.log2:function(t){return Math.log(t)*Math.LOG2E};function Nj(r,t,e,n,i,o){var u=i-e,m=o-n;if(0!==u||0!==m){var b=((r-e)*u+(t-n)*m)/(u*u+m*m);b>1?(e=i,n=o):b>0&&(e+=u*b,n+=m*b)}return p_(r,t,e,n)}function p_(r,t,e,n){var i=e-r,o=n-t;return i*i+o*o}function rw(r){return r*Math.PI/180}function Zy(r,t){var e=r%t;return e*t<0?e+t:e}function ry(r,t,e){return r+e*(t-r)}var jj=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),a1=6378137,H0=Math.PI*a1,Uj=[-H0,-H0,H0,H0],Vj=[-180,-85,180,85],iw=a1*Math.log(Math.tan(Math.PI/2)),W0=function(r){function t(e){return r.call(this,{code:e,units:Kd.METERS,extent:Uj,global:!0,worldExtent:Vj,getPointResolution:function(n,i){return n/Fj(i[1]/a1)}})||this}return jj(t,r),t}(h_),zD=[new W0("EPSG:3857"),new W0("EPSG:102100"),new W0("EPSG:102113"),new W0("EPSG:900913"),new W0("http://www.opengis.net/def/crs/EPSG/0/3857"),new W0("http://www.opengis.net/gml/srs/epsg.xml#3857")];var Zj=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),ND=[-180,-90,180,90],Wj=6378137*Math.PI/180,d_=function(r){function t(e,n){return r.call(this,{code:e,units:Kd.DEGREES,extent:ND,axisOrientation:n,global:!0,metersPerUnit:Wj,worldExtent:ND})||this}return Zj(t,r),t}(h_),BD=[new d_("CRS:84"),new d_("EPSG:4326","neu"),new d_("urn:ogc:def:crs:OGC:1.3:CRS84"),new d_("urn:ogc:def:crs:OGC:2:84"),new d_("http://www.opengis.net/def/crs/OGC/1.3/CRS84","neu"),new d_("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new d_("http://www.opengis.net/def/crs/EPSG/0/4326","neu")],ow={},Em={};function aw(r,t,e){var n=r.getCode(),i=t.getCode();n in Em||(Em[n]={}),Em[n][i]=e}function tS(r,t,e){var n=e||6371008.8,i=rw(r[1]),o=rw(t[1]),u=(o-i)/2,m=rw(t[0]-r[0])/2,b=Math.sin(u)*Math.sin(u)+Math.sin(m)*Math.sin(m)*Math.cos(i)*Math.cos(o);return 2*n*Math.atan2(Math.sqrt(b),Math.sqrt(1-b))}function rS(r,t,e){var n;if(void 0!==t){for(var i=0,o=r.length;i<o;++i)t[i]=r[i];n=t}else n=r.slice();return n}function iS(r,t,e){if(void 0!==t&&r!==t){for(var n=0,i=r.length;n<i;++n)t[n]=r[n];r=t}return r}function jD(r){(function(r,t){ow[r]=t})(r.getCode(),r),aw(r,r,rS)}function xa(r){return"string"==typeof r?function(r){return ow[r]||ow[r.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}(r):r||null}function uw(r,t,e,n){var i,o=(r=xa(r)).getPointResolutionFunc();if(o)i=o(t,e),n&&n!==r.getUnits()&&(u=r.getMetersPerUnit())&&(i=i*u/Yd[n]);else{var m=r.getUnits();if(m==Kd.DEGREES&&!n||n==Kd.DEGREES)i=t;else{var u,b=f_(r,xa("EPSG:4326"));if(b===iS&&m!==Kd.DEGREES)i=t*r.getMetersPerUnit();else{var T=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];i=(tS((T=b(T,T,2)).slice(0,2),T.slice(2,4))+tS(T.slice(4,6),T.slice(6,8)))/2}void 0!==(u=n?Yd[n]:r.getMetersPerUnit())&&(i/=u)}}return i}function UD(r){(function(r){r.forEach(jD)})(r),r.forEach(function(t){r.forEach(function(e){t!==e&&aw(t,e,rS)})})}function oS(r,t){return r?"string"==typeof r?xa(r):r:xa(t)}function Sm(r,t){if(r===t)return!0;var e=r.getUnits()===t.getUnits();return(r.getCode()===t.getCode()||f_(r,t)===rS)&&e}function f_(r,t){var i=function(r,t){var e;return r in Em&&t in Em[r]&&(e=Em[r][t]),e}(r.getCode(),t.getCode());return i||(i=iS),i}function s1(r,t){return f_(xa(r),xa(t))}function m_(r,t,e){return s1(t,e)(r,void 0,r.length)}function cw(r,t,e,n){return function(r,t,e,n){var i=[];if(n>1)for(var o=r[2]-r[0],u=r[3]-r[1],m=0;m<n;++m)i.push(r[0]+o*m/n,r[1],r[2],r[1]+u*m/n,r[2]-o*m/n,r[3],r[0],r[3]-u*m/n);else i=[r[0],r[1],r[2],r[1],r[2],r[3],r[0],r[3]];t(i,i,2);for(var b=[],T=[],F=(m=0,i.length);m<F;m+=2)b.push(i[m]),T.push(i[m+1]);return function(r,t,e){return bm(Math.min.apply(null,r),Math.min.apply(null,t),Math.max.apply(null,r),Math.max.apply(null,t),e)}(b,T,e)}(r,s1(t,e),void 0,n)}var Yp=null;function Pf(){return Yp}function g_(r,t){return r}function hl(r,t){return r}function hw(r,t){return r}function ug(r,t){return r}function nU(r,t){return r}UD(zD),UD(BD),function(r,t,e,n){r.forEach(function(i){t.forEach(function(o){aw(i,o,e),aw(o,i,n)})})}(BD,zD,function(r,t,e){var n=r.length,i=e>1?e:2,o=t;void 0===o&&(o=i>2?r.slice():new Array(n));for(var u=0;u<n;u+=i){o[u]=H0*r[u]/180;var m=a1*Math.log(Math.tan(Math.PI*(+r[u+1]+90)/360));m>iw?m=iw:m<-iw&&(m=-iw),o[u+1]=m}return o},function(r,t,e){var n=r.length,i=e>1?e:2,o=t;void 0===o&&(o=i>2?r.slice():new Array(n));for(var u=0;u<n;u+=i)o[u]=180*r[u]/H0,o[u+1]=360*Math.atan(Math.exp(r[u+1]/a1))/Math.PI-90;return o});var oU=function(){function r(t,e,n,i,o,u){this.sourceProj_=t,this.targetProj_=e;var m={},b=s1(this.targetProj_,this.sourceProj_);this.transformInv_=function($e){var tt=$e[0]+"/"+$e[1];return m[tt]||(m[tt]=b($e)),m[tt]},this.maxSourceExtent_=i,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!i&&!!this.sourceProj_.getExtent()&&Xs(i)==Xs(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Xs(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Xs(this.targetProj_.getExtent()):null;var T=lg(n),F=o1(n),V=i1(n),H=q0(n),J=this.transformInv_(T),ne=this.transformInv_(F),we=this.transformInv_(V),Re=this.transformInv_(H),qe=10+(u?Math.max(0,Math.ceil(zj(tw(n)/(u*u*256*256)))):0);if(this.addQuad_(T,F,V,H,J,ne,we,Re,qe),this.wrapsXInSource_){var Ne=1/0;this.triangles_.forEach(function($e,tt,bt){Ne=Math.min(Ne,$e.source[0][0],$e.source[1][0],$e.source[2][0])}),this.triangles_.forEach(function($e){if(Math.max($e.source[0][0],$e.source[1][0],$e.source[2][0])-Ne>this.sourceWorldWidth_/2){var tt=[[$e.source[0][0],$e.source[0][1]],[$e.source[1][0],$e.source[1][1]],[$e.source[2][0],$e.source[2][1]]];tt[0][0]-Ne>this.sourceWorldWidth_/2&&(tt[0][0]-=this.sourceWorldWidth_),tt[1][0]-Ne>this.sourceWorldWidth_/2&&(tt[1][0]-=this.sourceWorldWidth_),tt[2][0]-Ne>this.sourceWorldWidth_/2&&(tt[2][0]-=this.sourceWorldWidth_);var bt=Math.min(tt[0][0],tt[1][0],tt[2][0]);Math.max(tt[0][0],tt[1][0],tt[2][0])-bt<this.sourceWorldWidth_/2&&($e.source=tt)}}.bind(this))}m={}}return r.prototype.addTriangle_=function(t,e,n,i,o,u){this.triangles_.push({source:[i,o,u],target:[t,e,n]})},r.prototype.addQuad_=function(t,e,n,i,o,u,m,b,T){var F=Hc([o,u,m,b]),V=this.sourceWorldWidth_?Xs(F)/this.sourceWorldWidth_:null,H=this.sourceWorldWidth_,J=this.sourceProj_.canWrapX()&&V>.5&&V<1,ne=!1;if(T>0&&(this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(ne=Xs(Hc([t,e,n,i]))/this.targetWorldWidth_>.25||ne),!J&&this.sourceProj_.isGlobal()&&V&&(ne=V>.25||ne)),!(!ne&&this.maxSourceExtent_&&isFinite(F[0])&&isFinite(F[1])&&isFinite(F[2])&&isFinite(F[3]))||Cc(F,this.maxSourceExtent_)){var qe=0;if(!(ne||isFinite(o[0])&&isFinite(o[1])&&isFinite(u[0])&&isFinite(u[1])&&isFinite(m[0])&&isFinite(m[1])&&isFinite(b[0])&&isFinite(b[1])))if(T>0)ne=!0;else if(1!=(qe=(isFinite(o[0])&&isFinite(o[1])?0:8)+(isFinite(u[0])&&isFinite(u[1])?0:4)+(isFinite(m[0])&&isFinite(m[1])?0:2)+(isFinite(b[0])&&isFinite(b[1])?0:1))&&2!=qe&&4!=qe&&8!=qe)return;if(T>0){if(!ne){var $e=this.transformInv_([(t[0]+n[0])/2,(t[1]+n[1])/2]),tt=void 0;tt=J?(Zy(o[0],H)+Zy(m[0],H))/2-Zy($e[0],H):(o[0]+m[0])/2-$e[0];var dn=(o[1]+m[1])/2-$e[1];ne=tt*tt+dn*dn>this.errorThresholdSquared_}if(ne){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){var vn=[(e[0]+n[0])/2,(e[1]+n[1])/2],Bt=this.transformInv_(vn),Dn=[(i[0]+t[0])/2,(i[1]+t[1])/2],un=this.transformInv_(Dn);this.addQuad_(t,e,vn,Dn,o,u,Bt,un,T-1),this.addQuad_(Dn,vn,n,i,un,Bt,m,b,T-1)}else{var Fn=[(t[0]+e[0])/2,(t[1]+e[1])/2],kr=this.transformInv_(Fn),Jr=[(n[0]+i[0])/2,(n[1]+i[1])/2],Ur=this.transformInv_(Jr);this.addQuad_(t,Fn,Jr,i,o,kr,Ur,b,T-1),this.addQuad_(Fn,e,n,Jr,kr,u,m,Ur,T-1)}return}}if(J){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&qe)&&this.addTriangle_(t,n,i,o,m,b),0==(14&qe)&&this.addTriangle_(t,n,e,o,m,u),qe&&(0==(13&qe)&&this.addTriangle_(e,i,t,u,b,o),0==(7&qe)&&this.addTriangle_(e,i,n,u,b,m))}},r.prototype.calculateSourceExtent=function(){var t=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach(function(e,n,i){var o=e.source;G0(t,o[0]),G0(t,o[1]),G0(t,o[2])}),t},r.prototype.getTriangles=function(){return this.triangles_},r}();const qD=oU;var lS,Hy="1.3.0",aS={imageSmoothingEnabled:!1,msImageSmoothingEnabled:!1},$0="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"",aU=-1!==$0.indexOf("firefox"),sU=(-1!==$0.indexOf("safari")&&$0.indexOf("chrom"),-1!==$0.indexOf("webkit")&&-1==$0.indexOf("edge")),lU=-1!==$0.indexOf("macintosh"),ZD="undefined"!=typeof devicePixelRatio?devicePixelRatio:1,pw="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope,uU="undefined"!=typeof Image&&Image.prototype.decode,HD=function(){var r=!1;try{var t=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch(e){}return r}();function vd(r,t,e,n){var i;return e&&e.length?i=e.shift():pw?i=new OffscreenCanvas(r||300,t||300):(i=document.createElement("canvas")).style.all="unset",r&&(i.width=r),t&&(i.height=t),i.getContext("2d",n)}function WD(r,t){var e=t.parentNode;e&&e.replaceChild(r,t)}function sS(r){return r&&r.parentNode?r.parentNode.removeChild(r):null}function $D(r,t,e,n,i){r.beginPath(),r.moveTo(0,0),r.lineTo(t,e),r.lineTo(n,i),r.closePath(),r.save(),r.clip(),r.fillRect(0,0,Math.max(t,n)+1,Math.max(e,i)),r.restore()}function uS(r,t){return Math.abs(r[4*t]-210)>2||Math.abs(r[4*t+3]-191.25)>2}function l1(r,t,e,n){var i=m_(e,t,r),o=uw(t,n,e),u=t.getMetersPerUnit();void 0!==u&&(o*=u);var m=r.getMetersPerUnit();void 0!==m&&(o/=m);var b=r.getExtent();if(!b||ew(b,i)){var T=uw(r,o,i)/o;isFinite(T)&&T>0&&(o/=T)}return o}function XD(r,t,e,n,i,o,u,m,b,T,F,V){var H=vd(Math.round(e*r),Math.round(e*t));if($a(H,V),0===b.length)return H.canvas;function J(tt){return Math.round(tt*e)/e}H.scale(e,e),H.globalCompositeOperation="lighter";var ne=[1/0,1/0,-1/0,-1/0];b.forEach(function(tt,bt,dn){OD(ne,tt.extent)});var we=Xs(ne),Re=mh(ne),qe=vd(Math.round(e*we/n),Math.round(e*Re/n));$a(qe,V);var Ne=e/n;b.forEach(function(tt,bt,dn){var Kt=tt.extent[0]-ne[0],vn=-(tt.extent[3]-ne[3]),Bt=Xs(tt.extent),Dn=mh(tt.extent);tt.image.width>0&&tt.image.height>0&&qe.drawImage(tt.image,T,T,tt.image.width-2*T,tt.image.height-2*T,Kt*Ne,vn*Ne,Bt*Ne,Dn*Ne)});var $e=lg(u);return m.getTriangles().forEach(function(tt,bt,dn){var Kt=tt.source,vn=tt.target,Bt=Kt[0][0],Dn=Kt[0][1],un=Kt[1][0],Fn=Kt[1][1],kr=Kt[2][0],Jr=Kt[2][1],Ur=J((vn[0][0]-$e[0])/o),Mr=J(-(vn[0][1]-$e[1])/o),_n=J((vn[1][0]-$e[0])/o),Qi=J(-(vn[1][1]-$e[1])/o),go=J((vn[2][0]-$e[0])/o),Co=J(-(vn[2][1]-$e[1])/o),as=Bt,En=Dn;Bt=0,Dn=0;var Mi=function(r){for(var t=r.length,e=0;e<t;e++){for(var n=e,i=Math.abs(r[e][e]),o=e+1;o<t;o++){var u=Math.abs(r[o][e]);u>i&&(i=u,n=o)}if(0===i)return null;var m=r[n];r[n]=r[e],r[e]=m;for(var b=e+1;b<t;b++)for(var T=-r[b][e]/r[e][e],F=e;F<t+1;F++)e==F?r[b][F]=0:r[b][F]+=T*r[e][F]}for(var V=new Array(t),H=t-1;H>=0;H--){V[H]=r[H][t]/r[H][H];for(var J=H-1;J>=0;J--)r[J][t]-=r[J][H]*V[H]}return V}([[un-=as,Fn-=En,0,0,_n-Ur],[kr-=as,Jr-=En,0,0,go-Ur],[0,0,un,Fn,Qi-Mr],[0,0,kr,Jr,Co-Mr]]);if(Mi){if(H.save(),H.beginPath(),function(){if(void 0===lS){var r=document.createElement("canvas").getContext("2d");r.globalCompositeOperation="lighter",r.fillStyle="rgba(210, 0, 0, 0.75)",$D(r,4,5,4,0),$D(r,4,5,0,5);var t=r.getImageData(0,0,3,3).data;lS=uS(t,0)||uS(t,4)||uS(t,8)}return lS}()||V===aS){H.moveTo(_n,Qi);for(var ws=Ur-_n,cr=Mr-Qi,fl=0;fl<4;fl++)H.lineTo(_n+J((fl+1)*ws/4),Qi+J(fl*cr/3)),3!=fl&&H.lineTo(_n+J((fl+1)*ws/4),Qi+J((fl+1)*cr/3));H.lineTo(go,Co)}else H.moveTo(_n,Qi),H.lineTo(Ur,Mr),H.lineTo(go,Co);H.clip(),H.transform(Mi[0],Mi[2],Mi[1],Mi[3],Ur,Mr),H.translate(ne[0]-as,ne[3]-En),H.scale(n/e,-n/e),H.drawImage(qe.canvas,0,0),H.restore()}}),F&&(H.save(),H.globalCompositeOperation="source-over",H.strokeStyle="black",H.lineWidth=1,m.getTriangles().forEach(function(tt,bt,dn){var Kt=tt.target,vn=(Kt[0][0]-$e[0])/o,Bt=-(Kt[0][1]-$e[1])/o,Dn=(Kt[1][0]-$e[0])/o,un=-(Kt[1][1]-$e[1])/o,Fn=(Kt[2][0]-$e[0])/o,kr=-(Kt[2][1]-$e[1])/o;H.beginPath(),H.moveTo(Dn,un),H.lineTo(vn,Bt),H.lineTo(Fn,kr),H.closePath(),H.stroke()}),H.restore()),H.canvas}var fU=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),mU=function(r){function t(e,n,i,o,u,m,b){var T=this,F=e.getExtent(),V=n.getExtent(),H=V?sg(i,V):i,ne=l1(e,n,wm(H),o),Re=new qD(e,n,H,F,.5*ne,o),Ne=m(Re.calculateSourceExtent(),ne,u),$e=Ne?0:4,tt=Ne?Ne.getPixelRatio():1;return(T=r.call(this,i,o,tt,$e)||this).targetProj_=n,T.maxSourceExtent_=F,T.triangulation_=Re,T.targetResolution_=o,T.targetExtent_=i,T.sourceImage_=Ne,T.sourcePixelRatio_=tt,T.contextOptions_=b,T.canvas_=null,T.sourceListenerKey_=null,T}return fU(t,r),t.prototype.disposeInternal=function(){1==this.state&&this.unlistenSource_(),r.prototype.disposeInternal.call(this)},t.prototype.getImage=function(){return this.canvas_},t.prototype.getProjection=function(){return this.targetProj_},t.prototype.reproject_=function(){var e=this.sourceImage_.getState();if(2==e){var n=Xs(this.targetExtent_)/this.targetResolution_,i=mh(this.targetExtent_)/this.targetResolution_;this.canvas_=XD(n,i,this.sourcePixelRatio_,this.sourceImage_.getResolution(),0,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.contextOptions_)}this.state=e,this.changed()},t.prototype.load=function(){if(0==this.state){this.state=1,this.changed();var e=this.sourceImage_.getState();2==e||3==e?this.reproject_():(this.sourceListenerKey_=Zo(this.sourceImage_,"change",function(n){var i=this.sourceImage_.getState();(2==i||3==i)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}},t.prototype.unlistenSource_=function(){il(this.sourceListenerKey_),this.sourceListenerKey_=null},t}(kD);const gU=mU;var YD=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),KD=function(r){function t(e,n,i){var o=r.call(this,e)||this;return o.key=n,o.oldValue=i,o}return YD(t,r),t}(_m),yU=function(r){function t(e){var n=r.call(this)||this;return Si(n),n.values_=null,void 0!==e&&n.setProperties(e),n}return YD(t,r),t.prototype.get=function(e){var n;return this.values_&&this.values_.hasOwnProperty(e)&&(n=this.values_[e]),n},t.prototype.getKeys=function(){return this.values_&&Object.keys(this.values_)||[]},t.prototype.getProperties=function(){return this.values_&&$a({},this.values_)||{}},t.prototype.hasProperties=function(){return!!this.values_},t.prototype.notify=function(e,n){this.dispatchEvent(new KD("change:"+e,e,n)),this.dispatchEvent(new KD("propertychange",e,n))},t.prototype.addChangeListener=function(e,n){this.addEventListener("change:"+e,n)},t.prototype.removeChangeListener=function(e,n){this.removeEventListener("change:"+e,n)},t.prototype.set=function(e,n,i){var o=this.values_||(this.values_={});if(i)o[e]=n;else{var u=o[e];o[e]=n,u!==n&&this.notify(e,u)}},t.prototype.setProperties=function(e,n){for(var i in e)this.set(i,e[i],n)},t.prototype.applyProperties=function(e){!e.values_||$a(this.values_||(this.values_={}),e.values_)},t.prototype.unset=function(e,n){if(this.values_&&e in this.values_){var i=this.values_[e];delete this.values_[e],s_(this.values_)&&(this.values_=null),n||this.notify(e,i)}},t}(AD);const cg=yU;var vU=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),_U=function(r){function t(e){var n=r.call(this)||this;n.projection=xa(e.projection),n.attributions_=JD(e.attributions),n.attributionsCollapsible_=void 0===e.attributionsCollapsible||e.attributionsCollapsible,n.loading=!1,n.state_=void 0!==e.state?e.state:"ready",n.wrapX_=void 0!==e.wrapX&&e.wrapX,n.viewResolver=null,n.viewRejector=null;var i=n;return n.viewPromise_=new Promise(function(o,u){i.viewResolver=o,i.viewRejector=u}),n}return vU(t,r),t.prototype.getAttributions=function(){return this.attributions_},t.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},t.prototype.getProjection=function(){return this.projection},t.prototype.getResolutions=function(){return li()},t.prototype.getView=function(){return this.viewPromise_},t.prototype.getState=function(){return this.state_},t.prototype.getWrapX=function(){return this.wrapX_},t.prototype.getContextOptions=function(){},t.prototype.refresh=function(){this.changed()},t.prototype.setAttributions=function(e){this.attributions_=JD(e),this.changed()},t.prototype.setState=function(e){this.state_=e,this.changed()},t}(cg);function JD(r){return r?Array.isArray(r)?function(t){return r}:"function"==typeof r?r:function(t){return[r]}:null}const cS=_U;var QD=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),pS=function(r){function t(e,n){var i=r.call(this,e)||this;return i.image=n,i}return QD(t,r),t}(_m),xU=function(r){function t(e){var n=r.call(this,{attributions:e.attributions,projection:e.projection,state:e.state})||this;return n.resolutions_=void 0!==e.resolutions?e.resolutions:null,n.reprojectedImage_=null,n.reprojectedRevision_=0,n.contextOptions_=!1===e.imageSmoothing?aS:void 0,n}return QD(t,r),t.prototype.getResolutions=function(){return this.resolutions_},t.prototype.getContextOptions=function(){return this.contextOptions_},t.prototype.findNearestResolution=function(e){if(this.resolutions_){var n=Kb(this.resolutions_,e,0);e=this.resolutions_[n]}return e},t.prototype.getImage=function(e,n,i,o){var u=this.getProjection();if(!u||!o||Sm(u,o))return u&&(o=u),this.getImageInternal(e,n,i,o);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Sm(this.reprojectedImage_.getProjection(),o)&&this.reprojectedImage_.getResolution()==n&&c_(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new gU(u,o,e,n,i,function(m,b,T){return this.getImageInternal(m,b,T,u)}.bind(this),this.contextOptions_),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_},t.prototype.getImageInternal=function(e,n,i,o){return li()},t.prototype.handleImageChange=function(e){var n=e.target;switch(n.getState()){case 1:this.loading=!0,this.dispatchEvent(new pS("imageloadstart",n));break;case 2:this.loading=!1,this.dispatchEvent(new pS("imageloadend",n));break;case 3:this.loading=!1,this.dispatchEvent(new pS("imageloaderror",n))}},t}(cS);function ek(r,t){r.getImage().src=t}const dS=xU;var bU=function(){function r(t){this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return r.prototype.canExpireCache=function(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark},r.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null},r.prototype.containsKey=function(t){return this.entries_.hasOwnProperty(t)},r.prototype.forEach=function(t){for(var e=this.oldest_;e;)t(e.value_,e.key_,this),e=e.newer},r.prototype.get=function(t,e){var n=this.entries_[t];return bo(void 0!==n,15),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_},r.prototype.remove=function(t){var e=this.entries_[t];return bo(void 0!==e,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_},r.prototype.getCount=function(){return this.count_},r.prototype.getKeys=function(){var n,t=new Array(this.count_),e=0;for(n=this.newest_;n;n=n.older)t[e++]=n.key_;return t},r.prototype.getValues=function(){var n,t=new Array(this.count_),e=0;for(n=this.newest_;n;n=n.older)t[e++]=n.value_;return t},r.prototype.peekLast=function(){return this.oldest_.value_},r.prototype.peekLastKey=function(){return this.oldest_.key_},r.prototype.peekFirstKey=function(){return this.newest_.key_},r.prototype.pop=function(){var t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_},r.prototype.replace=function(t,e){this.get(t),this.entries_[t].value_=e},r.prototype.set=function(t,e){bo(!(t in this.entries_),16);var n={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_},r.prototype.setSize=function(t){this.highWaterMark=t},r}();const wU=bU;function tk(r,t,e,n){return void 0!==n?(n[0]=r,n[1]=t,n[2]=e,n):[r,t,e]}function X0(r,t,e){return r+"/"+t+"/"+e}function nk(r){return X0(r[0],r[1],r[2])}function rk(r){return r.split("/").map(Number)}function ik(r){return(r[1]<<r[0])+r[2]}var SU=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),TU=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return SU(t,r),t.prototype.expireCache=function(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()},t.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var i=rk(this.peekFirstKey())[0];this.forEach(function(o){o.tileCoord[0]!==i&&(this.remove(nk(o.tileCoord)),o.release())}.bind(this))}},t}(wU);const fS=TU;var ok=function(){function r(t,e,n,i){this.minX=t,this.maxX=e,this.minY=n,this.maxY=i}return r.prototype.contains=function(t){return this.containsXY(t[1],t[2])},r.prototype.containsTileRange=function(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY},r.prototype.containsXY=function(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY},r.prototype.equals=function(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY},r.prototype.extend=function(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)},r.prototype.getHeight=function(){return this.maxY-this.minY+1},r.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},r.prototype.getWidth=function(){return this.maxX-this.minX+1},r.prototype.intersects=function(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY},r}();function Y0(r,t,e,n,i){return void 0!==i?(i.minX=r,i.maxX=t,i.minY=e,i.maxY=n,i):new ok(r,t,e,n)}const ak=ok;function sk(r,t,e){return void 0===e&&(e=[0,0]),e[0]=r[0]+2*t,e[1]=r[1]+2*t,e}function lk(r){return r[0]>0&&r[1]>0}function uk(r,t,e){return void 0===e&&(e=[0,0]),e[0]=r[0]*t+.5|0,e[1]=r[1]*t+.5|0,e}function Cp(r,t){return Array.isArray(r)?r:(void 0===t?t=[r,r]:(t[0]=r,t[1]=r),t)}var MU=[0,0,0],AU=function(){function r(t){var e;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,bo(function(r,t,e){var n=function(u,m){return m-u}||r_;return r.every(function(i,o){if(0===o)return!0;var u=n(r[o-1],i);return!(u>0||0===u)})}(this.resolutions_),17),!t.origins)for(var n=0,i=this.resolutions_.length-1;n<i;++n)if(e){if(this.resolutions_[n]/this.resolutions_[n+1]!==e){e=void 0;break}}else e=this.resolutions_[n]/this.resolutions_[n+1];this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,bo(this.origins_.length==this.resolutions_.length,20));var o=t.extent;void 0!==o&&!this.origin_&&!this.origins_&&(this.origin_=lg(o)),bo(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,bo(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:256,bo(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==o?o:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map(function(u,m){var b=new ak(Math.min(0,u[0]),Math.max(u[0]-1,-1),Math.min(0,u[1]),Math.max(u[1]-1,-1));if(o){var T=this.getTileRangeForExtentAndZ(o,m);b.minX=Math.max(T.minX,b.minX),b.maxX=Math.min(T.maxX,b.maxX),b.minY=Math.max(T.minY,b.minY),b.maxY=Math.min(T.maxY,b.maxY)}return b},this):o&&this.calculateTileRanges_(o)}return r.prototype.forEachTileCoord=function(t,e,n){for(var i=this.getTileRangeForExtentAndZ(t,e),o=i.minX,u=i.maxX;o<=u;++o)for(var m=i.minY,b=i.maxY;m<=b;++m)n([e,o,m])},r.prototype.forEachTileCoordParentTileRange=function(t,e,n,i){var u,m,b=null,T=t[0]-1;for(2===this.zoomFactor_?(u=t[1],m=t[2]):b=this.getTileCoordExtent(t,i);T>=this.minZoom;){if(e(T,2===this.zoomFactor_?Y0(u=Math.floor(u/2),u,m=Math.floor(m/2),m,n):this.getTileRangeForExtentAndZ(b,T,n)))return!0;--T}return!1},r.prototype.getExtent=function(){return this.extent_},r.prototype.getMaxZoom=function(){return this.maxZoom},r.prototype.getMinZoom=function(){return this.minZoom},r.prototype.getOrigin=function(t){return this.origin_?this.origin_:this.origins_[t]},r.prototype.getResolution=function(t){return this.resolutions_[t]},r.prototype.getResolutions=function(){return this.resolutions_},r.prototype.getTileCoordChildTileRange=function(t,e,n){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){var i=2*t[1],o=2*t[2];return Y0(i,i+1,o,o+1,e)}var u=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(u,t[0]+1,e)}return null},r.prototype.getTileRangeForTileCoordAndZ=function(t,e,n){if(e>this.maxZoom||e<this.minZoom)return null;var i=t[0],o=t[1],u=t[2];if(e===i)return Y0(o,u,o,u,n);if(this.zoomFactor_){var m=Math.pow(this.zoomFactor_,e-i),b=Math.floor(o*m),T=Math.floor(u*m);return e<i?Y0(b,b,T,T,n):Y0(b,Math.floor(m*(o+1))-1,T,Math.floor(m*(u+1))-1,n)}var H=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(H,e,n)},r.prototype.getTileRangeExtent=function(t,e,n){var i=this.getOrigin(t),o=this.getResolution(t),u=Cp(this.getTileSize(t),this.tmpSize_);return bm(i[0]+e.minX*u[0]*o,i[1]+e.minY*u[1]*o,i[0]+(e.maxX+1)*u[0]*o,i[1]+(e.maxY+1)*u[1]*o,n)},r.prototype.getTileRangeForExtentAndZ=function(t,e,n){var i=MU;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,i);var o=i[1],u=i[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,i),Y0(o,i[1],u,i[2],n)},r.prototype.getTileCoordCenter=function(t){var e=this.getOrigin(t[0]),n=this.getResolution(t[0]),i=Cp(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*i[0]*n,e[1]-(t[2]+.5)*i[1]*n]},r.prototype.getTileCoordExtent=function(t,e){var n=this.getOrigin(t[0]),i=this.getResolution(t[0]),o=Cp(this.getTileSize(t[0]),this.tmpSize_),u=n[0]+t[1]*o[0]*i,m=n[1]-(t[2]+1)*o[1]*i;return bm(u,m,u+o[0]*i,m+o[1]*i,e)},r.prototype.getTileCoordForCoordAndResolution=function(t,e,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,n)},r.prototype.getTileCoordForXYAndResolution_=function(t,e,n,i,o){var u=this.getZForResolution(n),m=n/this.getResolution(u),b=this.getOrigin(u),T=Cp(this.getTileSize(u),this.tmpSize_),V=i?.5:0,H=Math.floor((t-b[0])/n+(i?.5:0)),J=Math.floor((b[1]-e)/n+V),ne=m*H/T[0],we=m*J/T[1];return i?(ne=Math.ceil(ne)-1,we=Math.ceil(we)-1):(ne=Math.floor(ne),we=Math.floor(we)),tk(u,ne,we,o)},r.prototype.getTileCoordForXYAndZ_=function(t,e,n,i,o){var u=this.getOrigin(n),m=this.getResolution(n),b=Cp(this.getTileSize(n),this.tmpSize_),F=i?.5:0,V=Math.floor((t-u[0])/m+(i?.5:0)),H=Math.floor((u[1]-e)/m+F),J=V/b[0],ne=H/b[1];return i?(J=Math.ceil(J)-1,ne=Math.ceil(ne)-1):(J=Math.floor(J),ne=Math.floor(ne)),tk(n,J,ne,o)},r.prototype.getTileCoordForCoordAndZ=function(t,e,n){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,n)},r.prototype.getTileCoordResolution=function(t){return this.resolutions_[t[0]]},r.prototype.getTileSize=function(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]},r.prototype.getFullTileRange=function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null},r.prototype.getZForResolution=function(t,e){return Wc(Kb(this.resolutions_,t,e||0),this.minZoom,this.maxZoom)},r.prototype.calculateTileRanges_=function(t){for(var e=this.resolutions_.length,n=new Array(e),i=this.minZoom;i<e;++i)n[i]=this.getTileRangeForExtentAndZ(t,i);this.fullTileRanges_=n},r}();const dw=AU;function ck(r){var t=r.getDefaultTileGrid();return t||(t=pk(r),r.setDefaultTileGrid(t)),t}function hk(r,t,e,n){for(var i=void 0!==t?t:42,o=mh(r),u=Xs(r),m=Cp(void 0!==e?e:256),b=n>0?n:Math.max(u/m[0],o/m[1]),T=i+1,F=new Array(T),V=0;V<T;++V)F[V]=b/Math.pow(2,V);return F}function pk(r,t,e,n){return function(r,t,e,n){var i=void 0!==n?n:"top-left",o=hk(r,t,e);return new dw({extent:r,origin:Aj(r,i),resolutions:o,tileSize:e})}(gS(r),t,e,n)}function gS(r){var t=(r=xa(r)).getExtent();if(!t){var e=180*Yd[Kd.DEGREES]/r.getMetersPerUnit();t=bm(-e,-e,e,e)}return t}var dk=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),RU=function(r){function t(e){var n=r.call(this,{attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX})||this;n.opaque_=void 0!==e.opaque&&e.opaque,n.tilePixelRatio_=void 0!==e.tilePixelRatio?e.tilePixelRatio:1,n.tileGrid=void 0!==e.tileGrid?e.tileGrid:null;var o=e.tileGrid;return o&&Cp(o.getTileSize(o.getMinZoom()),[256,256]),n.tileCache=new fS(e.cacheSize||0),n.tmpSize=[0,0],n.key_=e.key||"",n.tileOptions={transition:e.transition},n.zDirection=e.zDirection?e.zDirection:0,n}return dk(t,r),t.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},t.prototype.expireCache=function(e,n){var i=this.getTileCacheForProjection(e);i&&i.expireCache(n)},t.prototype.forEachLoadedTile=function(e,n,i,o){var u=this.getTileCacheForProjection(e);if(!u)return!1;for(var b,T,F,m=!0,V=i.minX;V<=i.maxX;++V)for(var H=i.minY;H<=i.maxY;++H)T=X0(n,V,H),F=!1,u.containsKey(T)&&(F=2===(b=u.get(T)).getState())&&(F=!1!==o(b)),F||(m=!1);return m},t.prototype.getGutterForProjection=function(e){return 0},t.prototype.getKey=function(){return this.key_},t.prototype.setKey=function(e){this.key_!==e&&(this.key_=e,this.changed())},t.prototype.getOpaque=function(e){return this.opaque_},t.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},t.prototype.getTile=function(e,n,i,o,u){return li()},t.prototype.getTileGrid=function(){return this.tileGrid},t.prototype.getTileGridForProjection=function(e){return this.tileGrid?this.tileGrid:ck(e)},t.prototype.getTileCacheForProjection=function(e){return bo(Sm(this.getProjection(),e),68),this.tileCache},t.prototype.getTilePixelRatio=function(e){return this.tilePixelRatio_},t.prototype.getTilePixelSize=function(e,n,i){var o=this.getTileGridForProjection(i),u=this.getTilePixelRatio(n),m=Cp(o.getTileSize(e),this.tmpSize);return 1==u?m:uk(m,u,this.tmpSize)},t.prototype.getTileCoordForTileUrlFunction=function(e,n){var i=void 0!==n?n:this.getProjection(),o=this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(e=function(r,t,e){var n=t[0],i=r.getTileCoordCenter(t),o=gS(e);if(ew(o,i))return t;var u=Xs(o),m=Math.ceil((o[0]-i[0])/u);return i[0]+=u*m,r.getTileCoordForCoordAndZ(i,n)}(o,e,i)),function(r,t){var e=r[0],n=r[1],i=r[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;var o=t.getFullTileRange(e);return!o||o.containsXY(n,i)}(e,o)?e:null},t.prototype.clear=function(){this.tileCache.clear()},t.prototype.refresh=function(){this.clear(),r.prototype.refresh.call(this)},t.prototype.updateCacheSize=function(e,n){var i=this.getTileCacheForProjection(n);e>i.highWaterMark&&(i.highWaterMark=e)},t.prototype.useTile=function(e,n,i,o){},t}(cS),OU=function(r){function t(e,n){var i=r.call(this,e)||this;return i.tile=n,i}return dk(t,r),t}(_m);const fk=RU;var mk=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),fw=function(r){function t(e,n,i){var o=r.call(this,e)||this;return o.element=n,o.index=i,o}return mk(t,r),t}(_m),LU=function(r){function t(e,n){var i=r.call(this)||this;if(i.unique_=!!(n||{}).unique,i.array_=e||[],i.unique_)for(var u=0,m=i.array_.length;u<m;++u)i.assertUnique_(i.array_[u],u);return i.updateLength_(),i}return mk(t,r),t.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},t.prototype.extend=function(e){for(var n=0,i=e.length;n<i;++n)this.push(e[n]);return this},t.prototype.forEach=function(e){for(var n=this.array_,i=0,o=n.length;i<o;++i)e(n[i],i,n)},t.prototype.getArray=function(){return this.array_},t.prototype.item=function(e){return this.array_[e]},t.prototype.getLength=function(){return this.get("length")},t.prototype.insertAt=function(e,n){this.unique_&&this.assertUnique_(n),this.array_.splice(e,0,n),this.updateLength_(),this.dispatchEvent(new fw("add",n,e))},t.prototype.pop=function(){return this.removeAt(this.getLength()-1)},t.prototype.push=function(e){this.unique_&&this.assertUnique_(e);var n=this.getLength();return this.insertAt(n,e),this.getLength()},t.prototype.remove=function(e){for(var n=this.array_,i=0,o=n.length;i<o;++i)if(n[i]===e)return this.removeAt(i)},t.prototype.removeAt=function(e){var n=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new fw("remove",n,e)),n},t.prototype.setAt=function(e,n){var i=this.getLength();if(e<i){this.unique_&&this.assertUnique_(n,e);var o=this.array_[e];this.array_[e]=n,this.dispatchEvent(new fw("remove",o,e)),this.dispatchEvent(new fw("add",n,e))}else{for(var u=i;u<e;++u)this.insertAt(u,void 0);this.insertAt(e,n)}},t.prototype.updateLength_=function(){this.set("length",this.array_.length)},t.prototype.assertUnique_=function(e,n){for(var i=0,o=this.array_.length;i<o;++i)if(this.array_[i]===e&&i!==n)throw new PD(58)},t}(cg);const _d=LU;var yk=Ht(36),FU=function(){function r(t){this.rbush_=new yk(t),this.items_={}}return r.prototype.insert=function(t,e){var n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(n),this.items_[Si(e)]=n},r.prototype.load=function(t,e){for(var n=new Array(e.length),i=0,o=e.length;i<o;i++){var u=t[i],m=e[i],b={minX:u[0],minY:u[1],maxX:u[2],maxY:u[3],value:m};n[i]=b,this.items_[Si(m)]=b}this.rbush_.load(n)},r.prototype.remove=function(t){var e=Si(t),n=this.items_[e];return delete this.items_[e],null!==this.rbush_.remove(n)},r.prototype.update=function(t,e){var n=this.items_[Si(e)];c_([n.minX,n.minY,n.maxX,n.maxY],t)||(this.remove(e),this.insert(t,e))},r.prototype.getAll=function(){return this.rbush_.all().map(function(e){return e.value})},r.prototype.getInExtent=function(t){return this.rbush_.search({minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}).map(function(i){return i.value})},r.prototype.forEach=function(t){return this.forEach_(this.getAll(),t)},r.prototype.forEachInExtent=function(t,e){return this.forEach_(this.getInExtent(t),e)},r.prototype.forEach_=function(t,e){for(var n,i=0,o=t.length;i<o;i++)if(n=e(t[i]))return n;return n},r.prototype.isEmpty=function(){return s_(this.items_)},r.prototype.clear=function(){this.rbush_.clear(),this.items_={}},r.prototype.getExtent=function(t){var e=this.rbush_.toJSON();return bm(e.minX,e.minY,e.maxX,e.maxY,t)},r.prototype.concat=function(t){for(var e in this.rbush_.load(t.rbush_.all()),t.items_)this.items_[e]=t.items_[e]},r}();const mw=FU;function zU(r,t){return[[-1/0,-1/0,1/0,1/0]]}function _k(r,t,e,n,i,o,u){var m=new XMLHttpRequest;m.open("GET","function"==typeof r?r(e,n,i):r,!0),"arraybuffer"==t.getType()&&(m.responseType="arraybuffer"),m.withCredentials=false,m.onload=function(b){if(!m.status||m.status>=200&&m.status<300){var T=t.getType(),F=void 0;"json"==T||"text"==T?F=m.responseText:"xml"==T?(F=m.responseXML)||(F=(new DOMParser).parseFromString(m.responseText,"application/xml")):"arraybuffer"==T&&(F=m.response),F?o(t.readFeatures(F,{extent:e,featureProjection:i}),t.readProjection(F)):u()}else u()},m.onerror=u,m.send()}function xk(r,t){return function(e,n,i,o,u){var m=this;_k(r,t,e,n,i,function(b,T){m.addFeatures(b),void 0!==o&&o(b)},u||a_)}}var bk=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),$y=function(r){function t(e,n,i){var o=r.call(this,e)||this;return o.feature=n,o.features=i,o}return bk(t,r),t}(_m),NU=function(r){function t(e){var n=this,i=e||{};(n=r.call(this,{attributions:i.attributions,projection:void 0,state:"ready",wrapX:void 0===i.wrapX||i.wrapX})||this).loader_=a_,n.format_=i.format,n.overlaps_=void 0===i.overlaps||i.overlaps,n.url_=i.url,void 0!==i.loader?n.loader_=i.loader:void 0!==n.url_&&(bo(n.format_,7),n.loader_=xk(n.url_,n.format_)),n.strategy_=void 0!==i.strategy?i.strategy:zU;var u,m,o=void 0===i.useSpatialIndex||i.useSpatialIndex;return n.featuresRtree_=o?new mw:null,n.loadedExtentsRtree_=new mw,n.loadingExtentsCount_=0,n.nullGeometryFeatures_={},n.idIndex_={},n.uidIndex_={},n.featureChangeKeys_={},n.featuresCollection_=null,Array.isArray(i.features)?m=i.features:i.features&&(m=(u=i.features).getArray()),!o&&void 0===u&&(u=new _d(m)),void 0!==m&&n.addFeaturesInternal(m),void 0!==u&&n.bindFeaturesCollection_(u),n}return bk(t,r),t.prototype.addFeature=function(e){this.addFeatureInternal(e),this.changed()},t.prototype.addFeatureInternal=function(e){var n=Si(e);if(this.addToIndex_(n,e)){this.setupChangeEvents_(n,e);var i=e.getGeometry();if(i){var o=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(o,e)}else this.nullGeometryFeatures_[n]=e;this.dispatchEvent(new $y("addfeature",e))}else this.featuresCollection_&&this.featuresCollection_.remove(e)},t.prototype.setupChangeEvents_=function(e,n){this.featureChangeKeys_[e]=[Zo(n,"change",this.handleFeatureChange_,this),Zo(n,"propertychange",this.handleFeatureChange_,this)]},t.prototype.addToIndex_=function(e,n){var i=!0,o=n.getId();return void 0!==o&&(o.toString()in this.idIndex_?i=!1:this.idIndex_[o.toString()]=n),i&&(bo(!(e in this.uidIndex_),30),this.uidIndex_[e]=n),i},t.prototype.addFeatures=function(e){this.addFeaturesInternal(e),this.changed()},t.prototype.addFeaturesInternal=function(e){for(var n=[],i=[],o=[],u=0,m=e.length;u<m;u++){var T=Si(b=e[u]);this.addToIndex_(T,b)&&i.push(b)}u=0;for(var F=i.length;u<F;u++){var b;T=Si(b=i[u]),this.setupChangeEvents_(T,b);var V=b.getGeometry();if(V){var H=V.getExtent();n.push(H),o.push(b)}else this.nullGeometryFeatures_[T]=b}this.featuresRtree_&&this.featuresRtree_.load(n,o),u=0;for(var J=i.length;u<J;u++)this.dispatchEvent(new $y("addfeature",i[u]))},t.prototype.bindFeaturesCollection_=function(e){var n=!1;this.addEventListener("addfeature",function(i){n||(n=!0,e.push(i.feature),n=!1)}),this.addEventListener("removefeature",function(i){n||(n=!0,e.remove(i.feature),n=!1)}),e.addEventListener("add",function(i){n||(n=!0,this.addFeature(i.element),n=!1)}.bind(this)),e.addEventListener("remove",function(i){n||(n=!0,this.removeFeature(i.element),n=!1)}.bind(this)),this.featuresCollection_=e},t.prototype.clear=function(e){if(e){for(var n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(il);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_)for(var o in this.featuresRtree_.forEach(this.removeFeatureInternal.bind(this)),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[o]);this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var u=new $y("clear");this.dispatchEvent(u),this.changed()},t.prototype.forEachFeature=function(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)},t.prototype.forEachFeatureAtCoordinateDirect=function(e,n){return this.forEachFeatureInExtent([e[0],e[1],e[0],e[1]],function(o){if(o.getGeometry().intersectsCoordinate(e))return n(o)})},t.prototype.forEachFeatureInExtent=function(e,n){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,n);this.featuresCollection_&&this.featuresCollection_.forEach(n)},t.prototype.forEachFeatureIntersectingExtent=function(e,n){return this.forEachFeatureInExtent(e,function(i){if(i.getGeometry().intersectsExtent(e)){var u=n(i);if(u)return u}})},t.prototype.getFeaturesCollection=function(){return this.featuresCollection_},t.prototype.getFeatures=function(){var e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),s_(this.nullGeometryFeatures_)||og(e,XE(this.nullGeometryFeatures_))),e},t.prototype.getFeaturesAtCoordinate=function(e){var n=[];return this.forEachFeatureAtCoordinateDirect(e,function(i){n.push(i)}),n},t.prototype.getFeaturesInExtent=function(e){return this.featuresRtree_?this.featuresRtree_.getInExtent(e):this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]},t.prototype.getClosestFeatureToCoordinate=function(e,n){var i=e[0],o=e[1],u=null,m=[NaN,NaN],b=1/0,T=[-1/0,-1/0,1/0,1/0],F=n||qy;return this.featuresRtree_.forEachInExtent(T,function(V){if(F(V)){var H=V.getGeometry(),J=b;if((b=H.closestPointXY(i,o,m,b))<J){u=V;var ne=Math.sqrt(b);T[0]=i-ne,T[1]=o-ne,T[2]=i+ne,T[3]=o+ne}}}),u},t.prototype.getExtent=function(e){return this.featuresRtree_.getExtent(e)},t.prototype.getFeatureById=function(e){var n=this.idIndex_[e.toString()];return void 0!==n?n:null},t.prototype.getFeatureByUid=function(e){var n=this.uidIndex_[e];return void 0!==n?n:null},t.prototype.getFormat=function(){return this.format_},t.prototype.getOverlaps=function(){return this.overlaps_},t.prototype.getUrl=function(){return this.url_},t.prototype.handleFeatureChange_=function(e){var n=e.target,i=Si(n),o=n.getGeometry();if(o){var u=o.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(u,n)):this.featuresRtree_&&this.featuresRtree_.update(u,n)}else i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(n),this.nullGeometryFeatures_[i]=n);var m=n.getId();if(void 0!==m){var b=m.toString();this.idIndex_[b]!==n&&(this.removeFromIdIndex_(n),this.idIndex_[b]=n)}else this.removeFromIdIndex_(n),this.uidIndex_[i]=n;this.changed(),this.dispatchEvent(new $y("changefeature",n))},t.prototype.hasFeature=function(e){var n=e.getId();return void 0!==n?n in this.idIndex_:Si(e)in this.uidIndex_},t.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&s_(this.nullGeometryFeatures_)},t.prototype.loadFeatures=function(e,n,i){for(var o=this.loadedExtentsRtree_,u=this.strategy_(e,n,i),m=function(V,H){var J=u[V];o.forEachInExtent(J,function(we){return ag(we.extent,J)})||(++b.loadingExtentsCount_,b.dispatchEvent(new $y("featuresloadstart")),b.loader_.call(b,J,n,i,function(we){--this.loadingExtentsCount_,this.dispatchEvent(new $y("featuresloadend",void 0,we))}.bind(b),function(){--this.loadingExtentsCount_,this.dispatchEvent(new $y("featuresloaderror"))}.bind(b)),o.insert(J,{extent:J.slice()}))},b=this,T=0,F=u.length;T<F;++T)m(T);this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0},t.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),r.prototype.refresh.call(this)},t.prototype.removeLoadedExtent=function(e){var i,n=this.loadedExtentsRtree_;n.forEachInExtent(e,function(o){if(c_(o.extent,e))return i=o,!0}),i&&n.remove(i)},t.prototype.removeFeature=function(e){var n=Si(e);n in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[n]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e),this.changed()},t.prototype.removeFeatureInternal=function(e){var n=Si(e);this.featureChangeKeys_[n].forEach(il),delete this.featureChangeKeys_[n];var i=e.getId();void 0!==i&&delete this.idIndex_[i.toString()],delete this.uidIndex_[n],this.dispatchEvent(new $y("removefeature",e))},t.prototype.removeFromIdIndex_=function(e){var n=!1;for(var i in this.idIndex_)if(this.idIndex_[i]===e){delete this.idIndex_[i],n=!0;break}return n},t.prototype.setLoader=function(e){this.loader_=e},t.prototype.setUrl=function(e){bo(this.format_,7),this.url_=e,this.setLoader(xk(e,this.format_))},t}(cS);const __=NU;class Jd extends Er{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return!e.closed&&t.next(this._value),e}getValue(){const{hasError:t,thrownError:e,_value:n}=this;if(t)throw e;return this._throwIfClosed(),n}next(t){super.next(this._value=t)}}const yS={now:()=>(yS.delegate||Date).now(),delegate:void 0};class BU extends Er{constructor(t=1/0,e=1/0,n=yS){super(),this._bufferSize=t,this._windowTime=e,this._timestampProvider=n,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=e===1/0,this._bufferSize=Math.max(1,t),this._windowTime=Math.max(1,e)}next(t){const{isStopped:e,_buffer:n,_infiniteTimeWindow:i,_timestampProvider:o,_windowTime:u}=this;e||(n.push(t),!i&&n.push(o.now()+u)),this._trimBuffer(),super.next(t)}_subscribe(t){this._throwIfClosed(),this._trimBuffer();const e=this._innerSubscribe(t),{_infiniteTimeWindow:n,_buffer:i}=this,o=i.slice();for(let u=0;u<o.length&&!t.closed;u+=n?1:2)t.next(o[u]);return this._checkFinalizedStatuses(t),e}_trimBuffer(){const{_bufferSize:t,_timestampProvider:e,_buffer:n,_infiniteTimeWindow:i}=this,o=(i?1:2)*t;if(t<1/0&&o<n.length&&n.splice(0,n.length-o),!i){const u=e.now();let m=0;for(let b=1;b<n.length&&n[b]<=u;b+=2)m=b;m&&n.splice(0,m+1)}}}function wk(r,t=qr){return r=null!=r?r:jU,Xi((e,n)=>{let i,o=!0;e.subscribe(new Vi(n,u=>{const m=t(u);(o||!r(i,m))&&(o=!1,i=m,n.next(u))}))})}function jU(r,t){return r===t}function Ck(r){return Math.pow(r,3)}function K0(r){return 1-Ck(1-r)}function _S(r){return 3*r*r-2*r*r*r}function UU(r){return r}var VU=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),GU=function(r){function t(e){var n=r.call(this)||this;return e&&e.handleEvent&&(n.handleEvent=e.handleEvent),n.map_=null,n.setActive(!0),n}return VU(t,r),t.prototype.getActive=function(){return this.get("active")},t.prototype.getMap=function(){return this.map_},t.prototype.handleEvent=function(e){return!0},t.prototype.setActive=function(e){this.set("active",e)},t.prototype.setMap=function(e){this.map_=e},t}(cg);function xS(r,t,e,n){var i=r.getZoom();if(void 0!==i){var o=r.getConstrainedZoom(i+t),u=r.getResolutionForZoom(o);r.getAnimating()&&r.cancelAnimations(),r.animate({resolution:u,anchor:e,duration:void 0!==n?n:250,easing:K0})}}const u1=GU,oa={SINGLECLICK:"singleclick",CLICK:"click",DBLCLICK:"dblclick",POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var ZU=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),HU=function(r){function t(e){var n=r.call(this)||this,i=e||{};return n.delta_=i.delta?i.delta:1,n.duration_=void 0!==i.duration?i.duration:250,n}return ZU(t,r),t.prototype.handleEvent=function(e){var n=!1;if(e.type==oa.DBLCLICK){var i=e.originalEvent,u=e.coordinate,m=i.shiftKey?-this.delta_:this.delta_;xS(e.map.getView(),m,u,this.duration_),i.preventDefault(),n=!0}return!n},t}(u1);const WU=HU;var $U=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),XU=function(r){function t(e){var n=this,i=e||{};return n=r.call(this,i)||this,i.handleDownEvent&&(n.handleDownEvent=i.handleDownEvent),i.handleDragEvent&&(n.handleDragEvent=i.handleDragEvent),i.handleMoveEvent&&(n.handleMoveEvent=i.handleMoveEvent),i.handleUpEvent&&(n.handleUpEvent=i.handleUpEvent),i.stopDown&&(n.stopDown=i.stopDown),n.handlingDownUpSequence=!1,n.trackedPointers_={},n.targetPointers=[],n}return $U(t,r),t.prototype.getPointerCount=function(){return this.targetPointers.length},t.prototype.handleDownEvent=function(e){return!1},t.prototype.handleDragEvent=function(e){},t.prototype.handleEvent=function(e){if(!e.originalEvent)return!0;var n=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==oa.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==oa.POINTERUP){var i=this.handleUpEvent(e);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(e.type==oa.POINTERDOWN){var o=this.handleDownEvent(e);this.handlingDownUpSequence=o,n=this.stopDown(o)}else e.type==oa.POINTERMOVE&&this.handleMoveEvent(e);return!n},t.prototype.handleMoveEvent=function(e){},t.prototype.handleUpEvent=function(e){return!1},t.prototype.stopDown=function(e){return e},t.prototype.updateTrackedPointers_=function(e){if(function(r){var t=r.type;return t===oa.POINTERDOWN||t===oa.POINTERDRAG||t===oa.POINTERUP}(e)){var n=e.originalEvent,i=n.pointerId.toString();e.type==oa.POINTERUP?delete this.trackedPointers_[i]:(e.type==oa.POINTERDOWN||i in this.trackedPointers_)&&(this.trackedPointers_[i]=n),this.targetPointers=XE(this.trackedPointers_)}},t}(u1);function bS(r){for(var t=r.length,e=0,n=0,i=0;i<t;i++)e+=r[i].clientX,n+=r[i].clientY;return[e/t,n/t]}const Xy=XU;function wS(r){var t=arguments;return function(e){for(var n=!0,i=0,o=t.length;i<o&&(n=n&&t[i](e));++i);return n}}var JU=function(r){var t=r.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Ek=function(r){return!r.map.getTargetElement().hasAttribute("tabindex")||function(r){return r.target.getTargetElement().contains(document.activeElement)}(r)},CS=qy,Sk=function(r){var t=r.originalEvent;return 0==t.button&&!(sU&&lU&&t.ctrlKey)},Tk=o_,ES=function(r){var t=r.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},Ik=function(r){var t=r.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Mk=function(r){var e=r.originalEvent.target.tagName;return"INPUT"!==e&&"SELECT"!==e&&"TEXTAREA"!==e},SS=function(r){var t=r.originalEvent;return bo(void 0!==t,56),"mouse"==t.pointerType},Ak=function(r){var t=r.originalEvent;return bo(void 0!==t,56),t.isPrimary&&0===t.button};function Dk(r,t){return r[0]+=+t[0],r[1]+=+t[1],r}function TS(r,t){var J,ne,i=t[0],o=t[1],u=i[0],m=i[1],b=o[0],T=o[1],F=b-u,V=T-m,H=0===F&&0===V?0:(F*(r[0]-u)+V*(r[1]-m))/(F*F+V*V||0);return H<=0?(J=u,ne=m):H>=1?(J=b,ne=T):(J=u+H*F,ne=m+H*V),[J,ne]}function hg(r,t){for(var e=!0,n=r.length-1;n>=0;--n)if(r[n]!=t[n]){e=!1;break}return e}function IS(r,t){var e=Math.cos(t),n=Math.sin(t),o=r[1]*e+r[0]*n;return r[0]=r[0]*e-r[1]*n,r[1]=o,r}function Pk(r,t){return r[0]*=t,r[1]*=t,r}function pg(r,t){var e=r[0]-t[0],n=r[1]-t[1];return e*e+n*n}function MS(r,t){return Math.sqrt(pg(r,t))}function Rk(r,t){return pg(r,TS(r,t))}function AS(r,t){if(t.canWrapX()){var e=Xs(t.getExtent()),n=function(r,t,e){var n=t.getExtent(),i=0;if(t.canWrapX()&&(r[0]<n[0]||r[0]>n[2])){var o=e||Xs(n);i=Math.floor((r[0]-n[0])/o)}return i}(r,t,e);n&&(r[0]-=n*e)}return r}var oV=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),aV=function(r){function t(e){var n=r.call(this,{stopDown:o_})||this,i=e||{};n.kinetic_=i.kinetic,n.lastCentroid=null,n.panning_=!1;var o=i.condition?i.condition:wS(ES,Ak);return n.condition_=i.onFocusOnly?wS(Ek,o):o,n.noKinetic_=!1,n}return oV(t,r),t.prototype.handleDragEvent=function(e){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());var n=this.targetPointers,i=bS(n);if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){var o=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],m=e.map.getView();Pk(o,m.getResolution()),IS(o,m.getRotation()),m.adjustCenterInternal(o)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=i,this.lastPointersCount_=n.length,e.originalEvent.preventDefault()},t.prototype.handleUpEvent=function(e){var n=e.map,i=n.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var o=this.kinetic_.getDistance(),u=this.kinetic_.getAngle(),m=i.getCenterInternal(),b=n.getPixelFromCoordinateInternal(m),T=n.getCoordinateFromPixelInternal([b[0]-o*Math.cos(u),b[1]-o*Math.sin(u)]);i.animateInternal({center:i.getConstrainedCenter(T),duration:500,easing:K0})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0},t.prototype.handleDownEvent=function(e){if(this.targetPointers.length>0&&this.condition_(e)){var i=e.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1},t}(Xy);const sV=aV;function DS(r){if(void 0!==r)return 0}function Ok(r){if(void 0!==r)return r}var cV=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),hV=function(r){function t(e){var n=this,i=e||{};return(n=r.call(this,{stopDown:o_})||this).condition_=i.condition?i.condition:JU,n.lastAngle_=void 0,n.duration_=void 0!==i.duration?i.duration:250,n}return cV(t,r),t.prototype.handleDragEvent=function(e){if(SS(e)){var n=e.map,i=n.getView();if(i.getConstraints().rotation!==DS){var o=n.getSize(),u=e.pixel,m=Math.atan2(o[1]/2-u[1],u[0]-o[0]/2);void 0!==this.lastAngle_&&i.adjustRotationInternal(-(m-this.lastAngle_)),this.lastAngle_=m}}},t.prototype.handleUpEvent=function(e){return!SS(e)||(e.map.getView().endInteraction(this.duration_),!1)},t.prototype.handleDownEvent=function(e){return!(!SS(e)||!Sk(e)||!this.condition_(e)||(e.map.getView().beginInteraction(),this.lastAngle_=void 0,0))},t}(Xy);const pV=hV,$t={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"};var Fk,kS=new Array(6);function Lk(r){return c1(r,1,0,0,1,0,0)}function gw(r,t){var e=r[0],n=r[1],i=r[2],o=r[3],u=r[4],m=r[5],b=t[0],T=t[1],F=t[2],V=t[3],H=t[4],J=t[5];return r[0]=e*b+i*T,r[1]=n*b+o*T,r[2]=e*F+i*V,r[3]=n*F+o*V,r[4]=e*H+i*J+u,r[5]=n*H+o*J+m,r}function c1(r,t,e,n,i,o,u){return r[0]=t,r[1]=e,r[2]=n,r[3]=i,r[4]=o,r[5]=u,r}function $c(r,t){var e=t[0],n=t[1];return t[0]=r[0]*e+r[2]*n+r[4],t[1]=r[1]*e+r[3]*n+r[5],t}function PS(r,t,e){return gw(r,c1(kS,t,0,0,e,0,0))}function ef(r,t,e,n,i,o,u,m){var b=Math.sin(o),T=Math.cos(o);return r[0]=n*T,r[1]=i*b,r[2]=-n*b,r[3]=i*T,r[4]=u*n*T-m*n*b+t,r[5]=u*i*b+m*i*T+e,r}function h1(r,t){var e=function(r){return r[0]*r[3]-r[1]*r[2]}(t);bo(0!==e,32);var n=t[0],i=t[1],o=t[2],u=t[3],m=t[4],b=t[5];return r[0]=u/e,r[1]=-i/e,r[2]=-o/e,r[3]=n/e,r[4]=(o*b-u*m)/e,r[5]=-(n*b-i*m)/e,r}function yw(r){var t="matrix("+r.join(", ")+")";if(pw)return t;var e=Fk||(Fk=document.createElement("div"));return e.style.transform=t,e.style.transform}function Yy(r,t,e,n,i,o){for(var u=o||[],m=0,b=t;b<e;b+=n){var T=r[b],F=r[b+1];u[m++]=i[0]*T+i[2]*F+i[4],u[m++]=i[1]*T+i[3]*F+i[5]}return o&&u.length!=m&&(u.length=m),u}function RS(r,t,e,n,i,o,u){for(var m=u||[],b=Math.cos(i),T=Math.sin(i),F=o[0],V=o[1],H=0,J=t;J<e;J+=n){var ne=r[J]-F,we=r[J+1]-V;m[H++]=F+ne*b-we*T,m[H++]=V+ne*T+we*b;for(var Re=J+2;Re<J+n;++Re)m[H++]=r[Re]}return u&&m.length!=H&&(m.length=H),m}function zk(r,t,e,n,i,o,u){for(var m=u||[],b=0,T=t;T<e;T+=n){m[b++]=r[T]+i,m[b++]=r[T+1]+o;for(var F=T+2;F<T+n;++F)m[b++]=r[F]}return u&&m.length!=b&&(m.length=b),m}var vV=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Nk=[1,0,0,1,0,0],_V=function(r){function t(){var e=r.call(this)||this;return e.extent_=[1/0,1/0,-1/0,-1/0],e.extentRevision_=-1,e.simplifiedGeometryMaxMinSquaredTolerance=0,e.simplifiedGeometryRevision=0,e.simplifyTransformedInternal=function(r){var e,n,i,t=!1;return function(){var o=Array.prototype.slice.call(arguments);return(!t||this!==i||!i_(o,n))&&(t=!0,i=this,n=o,e=r.apply(this,arguments)),e}}(function(n,i,o){if(!o)return this.getSimplifiedGeometry(i);var u=this.clone();return u.applyTransform(o),u.getSimplifiedGeometry(i)}),e}return vV(t,r),t.prototype.simplifyTransformed=function(e,n){return this.simplifyTransformedInternal(this.getRevision(),e,n)},t.prototype.clone=function(){return li()},t.prototype.closestPointXY=function(e,n,i,o){return li()},t.prototype.containsXY=function(e,n){var i=this.getClosestPoint([e,n]);return i[0]===e&&i[1]===n},t.prototype.getClosestPoint=function(e,n){var i=n||[NaN,NaN];return this.closestPointXY(e[0],e[1],i,1/0),i},t.prototype.intersectsCoordinate=function(e){return this.containsXY(e[0],e[1])},t.prototype.computeExtent=function(e){return li()},t.prototype.getExtent=function(e){if(this.extentRevision_!=this.getRevision()){var n=this.computeExtent(this.extent_);(isNaN(n[0])||isNaN(n[1]))&&u_(n),this.extentRevision_=this.getRevision()}return function(r,t){return t?(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t):r}(this.extent_,e)},t.prototype.rotate=function(e,n){li()},t.prototype.scale=function(e,n,i){li()},t.prototype.simplify=function(e){return this.getSimplifiedGeometry(e*e)},t.prototype.getSimplifiedGeometry=function(e){return li()},t.prototype.getType=function(){return li()},t.prototype.applyTransform=function(e){li()},t.prototype.intersectsExtent=function(e){return li()},t.prototype.translate=function(e,n){li()},t.prototype.transform=function(e,n){var i=xa(e),o=i.getUnits()==Kd.TILE_PIXELS?function(u,m,b){var T=i.getExtent(),F=i.getWorldExtent(),V=mh(F)/mh(T);return ef(Nk,F[0],F[3],V,-V,0,0,0),Yy(u,0,u.length,b,Nk,m),s1(i,n)(u,m,b)}:s1(i,n);return this.applyTransform(o),this},t}(cg);const Bk=_V;var xV=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),bV=function(r){function t(){var e=r.call(this)||this;return e.layout="XY",e.stride=2,e.flatCoordinates=null,e}return xV(t,r),t.prototype.computeExtent=function(e){return QE(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)},t.prototype.getCoordinates=function(){return li()},t.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},t.prototype.getFlatCoordinates=function(){return this.flatCoordinates},t.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},t.prototype.getLayout=function(){return this.layout},t.prototype.getSimplifiedGeometry=function(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var n=this.getSimplifiedGeometryInternal(e);return n.getFlatCoordinates().length<this.flatCoordinates.length?n:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)},t.prototype.getSimplifiedGeometryInternal=function(e){return this},t.prototype.getStride=function(){return this.stride},t.prototype.setFlatCoordinates=function(e,n){this.stride=jk(e),this.layout=e,this.flatCoordinates=n},t.prototype.setCoordinates=function(e,n){li()},t.prototype.setLayout=function(e,n,i){var o;if(e)o=jk(e);else{for(var u=0;u<i;++u){if(0===n.length)return this.layout="XY",void(this.stride=2);n=n[0]}e=function(r){var t;return 2==r?t="XY":3==r?t="XYZ":4==r&&(t="XYZM"),t}(o=n.length)}this.layout=e,this.stride=o},t.prototype.applyTransform=function(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},t.prototype.rotate=function(e,n){var i=this.getFlatCoordinates();if(i){var o=this.getStride();RS(i,0,i.length,o,e,n,i),this.changed()}},t.prototype.scale=function(e,n,i){var o=n;void 0===o&&(o=e);var u=i;u||(u=wm(this.getExtent()));var m=this.getFlatCoordinates();if(m){var b=this.getStride();(function(r,t,e,n,i,o,u,m){for(var b=m||[],T=u[0],F=u[1],V=0,H=0;H<e;H+=n){var ne=r[H+1]-F;b[V++]=T+i*(r[H]-T),b[V++]=F+o*ne;for(var we=H+2;we<H+n;++we)b[V++]=r[we]}m&&b.length!=V&&(b.length=V)})(m,0,m.length,b,e,o,u,m),this.changed()}},t.prototype.translate=function(e,n){var i=this.getFlatCoordinates();if(i){var o=this.getStride();zk(i,0,i.length,o,e,n,i),this.changed()}},t}(Bk);function jk(r){var t;return"XY"==r?t=2:"XYZ"==r||"XYM"==r?t=3:"XYZM"==r&&(t=4),t}const Ky=bV;function Uk(r,t,e,n,i,o,u){var V,m=r[t],b=r[t+1],T=r[e]-m,F=r[e+1]-b;if(0===T&&0===F)V=t;else{var H=((i-m)*T+(o-b)*F)/(T*T+F*F);if(H>1)V=e;else{if(H>0){for(var J=0;J<n;++J)u[J]=ry(r[t+J],r[e+J],H);return void(u.length=n)}V=t}}for(J=0;J<n;++J)u[J]=r[V+J];u.length=n}function OS(r,t,e,n,i){var o=r[t],u=r[t+1];for(t+=n;t<e;t+=n){var m=r[t],b=r[t+1],T=p_(o,u,m,b);T>i&&(i=T),o=m,u=b}return i}function LS(r,t,e,n,i){for(var o=0,u=e.length;o<u;++o){var m=e[o];i=OS(r,t,m,n,i),t=m}return i}function FS(r,t,e,n,i,o,u,m,b,T,F){if(t==e)return T;var V,H;if(0===i){if((H=p_(u,m,r[t],r[t+1]))<T){for(V=0;V<n;++V)b[V]=r[t+V];return b.length=n,H}return T}for(var J=F||[NaN,NaN],ne=t+n;ne<e;)if(Uk(r,ne-n,ne,n,u,m,J),(H=p_(u,m,J[0],J[1]))<T){for(T=H,V=0;V<n;++V)b[V]=J[V];b.length=n,ne+=n}else ne+=n*Math.max((Math.sqrt(H)-Math.sqrt(T))/i|0,1);if(o&&(Uk(r,e-n,t,n,u,m,J),(H=p_(u,m,J[0],J[1]))<T)){for(T=H,V=0;V<n;++V)b[V]=J[V];b.length=n}return T}function zS(r,t,e,n,i,o,u,m,b,T,F){for(var V=F||[NaN,NaN],H=0,J=e.length;H<J;++H){var ne=e[H];T=FS(r,t,ne,n,i,o,u,m,b,T,V),t=ne}return T}function Vk(r,t,e,n){for(var i=0,o=e.length;i<o;++i)r[t++]=e[i];return t}function vw(r,t,e,n){for(var i=0,o=e.length;i<o;++i)for(var u=e[i],m=0;m<n;++m)r[t++]=u[m];return t}function NS(r,t,e,n,i){for(var o=i||[],u=0,m=0,b=e.length;m<b;++m){var T=vw(r,t,e[m],n);o[u++]=T,t=T}return o.length=u,o}function _w(r,t,e,n,i,o,u){var m=(e-t)/n;if(m<3){for(;t<e;t+=n)o[u++]=r[t],o[u++]=r[t+1];return u}var b=new Array(m);b[0]=1,b[m-1]=1;for(var T=[t,e-n],F=0;T.length>0;){for(var V=T.pop(),H=T.pop(),J=0,ne=r[H],we=r[H+1],Re=r[V],qe=r[V+1],Ne=H+n;Ne<V;Ne+=n){var bt=Nj(r[Ne],r[Ne+1],ne,we,Re,qe);bt>J&&(F=Ne,J=bt)}J>i&&(b[(F-t)/n]=1,H+n<F&&T.push(H,F),F+n<V&&T.push(F,V))}for(Ne=0;Ne<m;++Ne)b[Ne]&&(o[u++]=r[t+Ne*n],o[u++]=r[t+Ne*n+1]);return u}function x_(r,t){return t*Math.round(r/t)}function MV(r,t,e,n,i,o,u){if(t==e)return u;var T,F,m=x_(r[t],i),b=x_(r[t+1],i);t+=n,o[u++]=m,o[u++]=b;do{if(T=x_(r[t],i),F=x_(r[t+1],i),(t+=n)==e)return o[u++]=T,o[u++]=F,u}while(T==m&&F==b);for(;t<e;){var V=x_(r[t],i),H=x_(r[t+1],i);if(t+=n,V!=T||H!=F){var J=T-m,ne=F-b,we=V-m,Re=H-b;if(J*Re==ne*we&&(J<0&&we<J||J==we||J>0&&we>J)&&(ne<0&&Re<ne||ne==Re||ne>0&&Re>ne)){T=V,F=H;continue}o[u++]=T,o[u++]=F,m=T,b=F,T=V,F=H}}return o[u++]=T,o[u++]=F,u}function qk(r,t,e,n,i,o,u,m){for(var b=0,T=e.length;b<T;++b){var F=e[b];u=MV(r,t,F,n,i,o,u),m.push(u),t=F}return u}function Jy(r,t,e,n,i){for(var o=void 0!==i?i:[],u=0,m=t;m<e;m+=n)o[u++]=r.slice(m,m+n);return o.length=u,o}function p1(r,t,e,n,i){for(var o=void 0!==i?i:[],u=0,m=0,b=e.length;m<b;++m){var T=e[m];o[u++]=Jy(r,t,T,n,o[u]),t=T}return o.length=u,o}function BS(r,t,e,n,i){for(var o=void 0!==i?i:[],u=0,m=0,b=e.length;m<b;++m){var T=e[m];o[u++]=p1(r,t,T,n,o[u]),t=T[T.length-1]}return o.length=u,o}function Zk(r,t,e,n){for(var i=0,o=r[e-n],u=r[e-n+1];t<e;t+=n){var m=r[t],b=r[t+1];i+=u*m-o*b,o=m,u=b}return i/2}function Hk(r,t,e,n){for(var i=0,o=0,u=e.length;o<u;++o){var m=e[o];i+=Zk(r,t,m,n),t=m}return i}var kV=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),PV=function(r){function t(e,n){var i=r.call(this)||this;return i.maxDelta_=-1,i.maxDeltaRevision_=-1,void 0===n||Array.isArray(e[0])?i.setCoordinates(e,n):i.setFlatCoordinates(n,e),i}return kV(t,r),t.prototype.clone=function(){return new t(this.flatCoordinates.slice(),this.layout)},t.prototype.closestPointXY=function(e,n,i,o){return o<l_(this.getExtent(),e,n)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(OS(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),FS(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,n,i,o))},t.prototype.getArea=function(){return Zk(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},t.prototype.getCoordinates=function(){return Jy(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},t.prototype.getSimplifiedGeometryInternal=function(e){var n=[];return n.length=_w(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,n,0),new t(n,"XY")},t.prototype.getType=function(){return $t.LINEAR_RING},t.prototype.intersectsExtent=function(e){return!1},t.prototype.setCoordinates=function(e,n){this.setLayout(n,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=vw(this.flatCoordinates,0,e,this.stride),this.changed()},t}(Ky);const Wk=PV;var RV=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),OV=function(r){function t(e,n){var i=r.call(this)||this;return i.setCoordinates(e,n),i}return RV(t,r),t.prototype.clone=function(){var e=new t(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e},t.prototype.closestPointXY=function(e,n,i,o){var u=this.flatCoordinates,m=p_(e,n,u[0],u[1]);if(m<o){for(var b=this.stride,T=0;T<b;++T)i[T]=u[T];return i.length=b,m}return o},t.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},t.prototype.computeExtent=function(e){return V0(this.flatCoordinates,e)},t.prototype.getType=function(){return $t.POINT},t.prototype.intersectsExtent=function(e){return KE(e,this.flatCoordinates[0],this.flatCoordinates[1])},t.prototype.setCoordinates=function(e,n){this.setLayout(n,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Vk(this.flatCoordinates,0,e),this.changed()},t}(Ky);const Kp=OV;function LV(r,t,e,n,i){return!eS(i,function(u){return!b_(r,t,e,n,u[0],u[1])})}function b_(r,t,e,n,i,o){for(var u=0,m=r[e-n],b=r[e-n+1];t<e;t+=n){var T=r[t],F=r[t+1];b<=o?F>o&&(T-m)*(o-b)-(i-m)*(F-b)>0&&u++:F<=o&&(T-m)*(o-b)-(i-m)*(F-b)<0&&u--,m=T,b=F}return 0!==u}function jS(r,t,e,n,i,o){if(0===e.length||!b_(r,t,e[0],n,i,o))return!1;for(var u=1,m=e.length;u<m;++u)if(b_(r,e[u-1],e[u],n,i,o))return!1;return!0}function US(r,t,e,n,i,o,u){for(var m,b,T,F,V,H,J,ne=i[o+1],we=[],Re=0,qe=e.length;Re<qe;++Re){var Ne=e[Re];for(F=r[Ne-n],H=r[Ne-n+1],m=t;m<Ne;m+=n)V=r[m],J=r[m+1],(ne<=H&&J<=ne||H<=ne&&ne<=J)&&we.push(T=(ne-H)/(J-H)*(V-F)+F),F=V,H=J}var $e=NaN,tt=-1/0;for(we.sort(r_),F=we[0],m=1,b=we.length;m<b;++m){V=we[m];var bt=Math.abs(V-F);bt>tt&&jS(r,t,e,n,T=(F+V)/2,ne)&&($e=T,tt=bt),F=V}return isNaN($e)&&($e=i[o]),u?(u.push($e,ne,tt),u):[$e,ne,tt]}function $k(r,t,e,n,i){for(var o=[],u=0,m=e.length;u<m;++u){var b=e[u];o=US(r,t,b,n,i,2*u,o),t=b[b.length-1]}return o}function Xk(r,t,e,n,i){var o;for(t+=n;t<e;t+=n)if(o=i(r.slice(t-n,t),r.slice(t,t+n)))return o;return!1}function xw(r,t,e,n,i){var o=FD([1/0,1/0,-1/0,-1/0],r,t,e,n);return!!Cc(i,o)&&(!!(ag(i,o)||o[0]>=i[0]&&o[2]<=i[2]||o[1]>=i[1]&&o[3]<=i[3])||Xk(r,t,e,n,function(u,m){return function(r,t,e){var n=!1,i=JE(r,t),o=JE(r,e);if(1===i||1===o)n=!0;else{var u=r[0],m=r[1],b=r[2],T=r[3],H=e[0],J=e[1],ne=(J-t[1])/(H-t[0]),we=void 0,Re=void 0;!!(2&o)&&!(2&i)&&(n=(we=H-(J-T)/ne)>=u&&we<=b),n||!(4&o)||4&i||(n=(Re=J-(H-b)*ne)>=m&&Re<=T),n||!(8&o)||8&i||(n=(we=H-(J-m)/ne)>=u&&we<=b),!n&&16&o&&!(16&i)&&(n=(Re=J-(H-u)*ne)>=m&&Re<=T)}return n}(i,u,m)}))}function Yk(r,t,e,n,i){if(!function(r,t,e,n,i){return!!(xw(r,t,e,n,i)||b_(r,t,e,n,i[0],i[1])||b_(r,t,e,n,i[0],i[3])||b_(r,t,e,n,i[2],i[1])||b_(r,t,e,n,i[2],i[3]))}(r,t,e[0],n,i))return!1;if(1===e.length)return!0;for(var o=1,u=e.length;o<u;++o)if(LV(r,e[o-1],e[o],n,i)&&!xw(r,e[o-1],e[o],n,i))return!1;return!0}function jV(r,t,e,n){for(;t<e-n;){for(var i=0;i<n;++i){var o=r[t+i];r[t+i]=r[e-n+i],r[e-n+i]=o}t+=n,e-=n}}function VS(r,t,e,n){for(var i=0,o=r[e-n],u=r[e-n+1];t<e;t+=n){var m=r[t],b=r[t+1];i+=(m-o)*(b+u),o=m,u=b}return 0===i?void 0:i>0}function Kk(r,t,e,n,i){for(var o=void 0!==i&&i,u=0,m=e.length;u<m;++u){var b=e[u],T=VS(r,t,b,n);if(0===u){if(o&&T||!o&&!T)return!1}else if(o&&!T||!o&&T)return!1;t=b}return!0}function GS(r,t,e,n,i){for(var o=void 0!==i&&i,u=0,m=e.length;u<m;++u){var b=e[u],T=VS(r,t,b,n);(0===u?o&&T||!o&&!T:o&&!T||!o&&T)&&jV(r,t,b,n),t=b}return t}function Jk(r,t,e,n,i){for(var o=0,u=e.length;o<u;++o)t=GS(r,t,e[o],n,i);return t}var VV=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),bw=function(r){function t(e,n,i){var o=r.call(this)||this;return o.ends_=[],o.flatInteriorPointRevision_=-1,o.flatInteriorPoint_=null,o.maxDelta_=-1,o.maxDeltaRevision_=-1,o.orientedRevision_=-1,o.orientedFlatCoordinates_=null,void 0!==n&&i?(o.setFlatCoordinates(n,e),o.ends_=i):o.setCoordinates(e,n),o}return VV(t,r),t.prototype.appendLinearRing=function(e){this.flatCoordinates?og(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},t.prototype.clone=function(){var e=new t(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e},t.prototype.closestPointXY=function(e,n,i,o){return o<l_(this.getExtent(),e,n)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(LS(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),zS(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,n,i,o))},t.prototype.containsXY=function(e,n){return jS(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,n)},t.prototype.getArea=function(){return Hk(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},t.prototype.getCoordinates=function(e){var n;return void 0!==e?GS(n=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,e):n=this.flatCoordinates,p1(n,0,this.ends_,this.stride)},t.prototype.getEnds=function(){return this.ends_},t.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var e=wm(this.getExtent());this.flatInteriorPoint_=US(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},t.prototype.getInteriorPoint=function(){return new Kp(this.getFlatInteriorPoint(),"XYM")},t.prototype.getLinearRingCount=function(){return this.ends_.length},t.prototype.getLinearRing=function(e){return e<0||this.ends_.length<=e?null:new Wk(this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e]),this.layout)},t.prototype.getLinearRings=function(){for(var e=this.layout,n=this.flatCoordinates,i=this.ends_,o=[],u=0,m=0,b=i.length;m<b;++m){var T=i[m],F=new Wk(n.slice(u,T),e);o.push(F),u=T}return o},t.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var e=this.flatCoordinates;Kk(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=GS(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},t.prototype.getSimplifiedGeometryInternal=function(e){var n=[],i=[];return n.length=qk(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),n,0,i),new t(n,"XY",i)},t.prototype.getType=function(){return $t.POLYGON},t.prototype.intersectsExtent=function(e){return Yk(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)},t.prototype.setCoordinates=function(e,n){this.setLayout(n,e,2),this.flatCoordinates||(this.flatCoordinates=[]);var i=NS(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()},t}(Ky);const Tm=bw;function Qk(r){var t=r[0],e=r[1],n=r[2],i=r[3],o=[t,e,t,i,n,i,n,e,t,e];return new bw(o,"XY",[o.length])}function qS(r,t,e){for(var n=t||32,i=r.getStride(),o=r.getLayout(),u=r.getCenter(),m=i*(n+1),b=new Array(m),T=0;T<m;T+=i){b[T]=0,b[T+1]=0;for(var F=2;F<i;F++)b[T+F]=u[F]}var H=new bw(b,o,[b.length]);return function(r,t,e,n){for(var i=r.getFlatCoordinates(),o=r.getStride(),u=i.length/o-1,m=n||0,b=0;b<=u;++b){var T=b*o,F=m+2*Zy(b,u)*Math.PI/u;i[T]=t[0]+e*Math.cos(F),i[T+1]=t[1]+e*Math.sin(F)}r.changed()}(H,u,r.getRadius(),e),H}var qV=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),ZV=function(r){function t(e){var n=r.call(this)||this;return n.geometry_=null,n.element_=document.createElement("div"),n.element_.style.position="absolute",n.element_.style.pointerEvents="auto",n.element_.className="ol-box "+e,n.map_=null,n.startPixel_=null,n.endPixel_=null,n}return qV(t,r),t.prototype.disposeInternal=function(){this.setMap(null)},t.prototype.render_=function(){var e=this.startPixel_,n=this.endPixel_,i="px",o=this.element_.style;o.left=Math.min(e[0],n[0])+i,o.top=Math.min(e[1],n[1])+i,o.width=Math.abs(n[0]-e[0])+i,o.height=Math.abs(n[1]-e[1])+i},t.prototype.setMap=function(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var n=this.element_.style;n.left="inherit",n.top="inherit",n.width="inherit",n.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},t.prototype.setPixels=function(e,n){this.startPixel_=e,this.endPixel_=n,this.createOrUpdateGeometry(),this.render_()},t.prototype.createOrUpdateGeometry=function(){var e=this.startPixel_,n=this.endPixel_,o=[e,[e[0],n[1]],n,[n[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);o[4]=o[0].slice(),this.geometry_?this.geometry_.setCoordinates([o]):this.geometry_=new Tm([o])},t.prototype.getGeometry=function(){return this.geometry_},t}(WE);const HV=ZV;var eP=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),ZS=function(r){function t(e,n,i){var o=r.call(this,e)||this;return o.coordinate=n,o.mapBrowserEvent=i,o}return eP(t,r),t}(_m),WV=function(r){function t(e){var n=r.call(this)||this,i=e||{};return n.box_=new HV(i.className||"ol-dragbox"),n.minArea_=void 0!==i.minArea?i.minArea:64,i.onBoxEnd&&(n.onBoxEnd=i.onBoxEnd),n.startPixel_=null,n.condition_=i.condition?i.condition:Sk,n.boxEndCondition_=i.boxEndCondition?i.boxEndCondition:n.defaultBoxEndCondition,n}return eP(t,r),t.prototype.defaultBoxEndCondition=function(e,n,i){var o=i[0]-n[0],u=i[1]-n[1];return o*o+u*u>=this.minArea_},t.prototype.getGeometry=function(){return this.box_.getGeometry()},t.prototype.handleDragEvent=function(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new ZS("boxdrag",e.coordinate,e))},t.prototype.handleUpEvent=function(e){this.box_.setMap(null);var n=this.boxEndCondition_(e,this.startPixel_,e.pixel);return n&&this.onBoxEnd(e),this.dispatchEvent(new ZS(n?"boxend":"boxcancel",e.coordinate,e)),!1},t.prototype.handleDownEvent=function(e){return!!this.condition_(e)&&(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new ZS("boxstart",e.coordinate,e)),!0)},t.prototype.onBoxEnd=function(e){},t}(Xy);const $V=WV;var XV=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),YV=function(r){function t(e){var n=this,i=e||{};return(n=r.call(this,{condition:i.condition?i.condition:Ik,className:i.className||"ol-dragzoom",minArea:i.minArea})||this).duration_=void 0!==i.duration?i.duration:200,n.out_=void 0!==i.out&&i.out,n}return XV(t,r),t.prototype.onBoxEnd=function(e){var i=this.getMap().getView(),o=this.getGeometry();if(this.out_){var u=i.rotatedExtentForGeometry(o),m=i.getResolutionForExtentInternal(u),b=i.getResolution()/m;(o=o.clone()).scale(b*b)}i.fitInternal(o,{duration:this.duration_,easing:K0})},t}($V);const KV=YV;var JV=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),QV=function(r){function t(e){var n=r.call(this)||this,i=e||{};return n.defaultCondition_=function(o){return ES(o)&&Mk(o)},n.condition_=void 0!==i.condition?i.condition:n.defaultCondition_,n.duration_=void 0!==i.duration?i.duration:100,n.pixelDelta_=void 0!==i.pixelDelta?i.pixelDelta:128,n}return JV(t,r),t.prototype.handleEvent=function(e){var n=!1;if("keydown"==e.type){var i=e.originalEvent,o=i.keyCode;if(this.condition_(e)&&(40==o||37==o||39==o||38==o)){var m=e.map.getView(),b=m.getResolution()*this.pixelDelta_,T=0,F=0;40==o?F=-b:37==o?T=-b:39==o?T=b:F=b;var V=[T,F];IS(V,m.getRotation()),function(r,t,e){var n=r.getCenterInternal();n&&r.animateInternal({duration:void 0!==e?e:250,easing:UU,center:r.getConstrainedCenter([n[0]+t[0],n[1]+t[1]])})}(m,V,this.duration_),i.preventDefault(),n=!0}}return!n},t}(u1);const e6=QV;var t6=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),n6=function(r){function t(e){var n=r.call(this)||this,i=e||{};return n.condition_=i.condition?i.condition:Mk,n.delta_=i.delta?i.delta:1,n.duration_=void 0!==i.duration?i.duration:100,n}return t6(t,r),t.prototype.handleEvent=function(e){var n=!1;if("keydown"==e.type||"keypress"==e.type){var i=e.originalEvent,o=i.charCode;if(this.condition_(e)&&(o=="+".charCodeAt(0)||o=="-".charCodeAt(0))){var u=e.map,m=o=="+".charCodeAt(0)?this.delta_:-this.delta_;xS(u.getView(),m,void 0,this.duration_),i.preventDefault(),n=!0}}return!n},t}(u1);const r6=n6;var i6=function(){function r(t,e,n){this.decay_=t,this.minVelocity_=e,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}return r.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},r.prototype.update=function(t,e){this.points_.push(t,e,Date.now())},r.prototype.end=function(){if(this.points_.length<6)return!1;var t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;for(var n=e-3;n>0&&this.points_[n+2]>t;)n-=3;var i=this.points_[e+2]-this.points_[n+2];if(i<1e3/60)return!1;var o=this.points_[e]-this.points_[n],u=this.points_[e+1]-this.points_[n+1];return this.angle_=Math.atan2(u,o),this.initialVelocity_=Math.sqrt(o*o+u*u)/i,this.initialVelocity_>this.minVelocity_},r.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},r.prototype.getAngle=function(){return this.angle_},r}();const o6=i6;var a6=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),s6=function(r){function t(e){var n=this,i=e||{};(n=r.call(this,i)||this).totalDelta_=0,n.lastDelta_=0,n.maxDelta_=void 0!==i.maxDelta?i.maxDelta:1,n.duration_=void 0!==i.duration?i.duration:250,n.timeout_=void 0!==i.timeout?i.timeout:80,n.useAnchor_=void 0===i.useAnchor||i.useAnchor,n.constrainResolution_=void 0!==i.constrainResolution&&i.constrainResolution;var o=i.condition?i.condition:CS;return n.condition_=i.onFocusOnly?wS(Ek,o):o,n.lastAnchor_=null,n.startTime_=void 0,n.mode_=void 0,n.trackpadEventGap_=400,n.deltaPerZoom_=300,n}return a6(t,r),t.prototype.endInteraction_=function(){this.trackpadTimeoutId_=void 0,this.getMap().getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)},t.prototype.handleEvent=function(e){if(!this.condition_(e))return!0;if("wheel"!==e.type)return!0;var u,i=e.map,o=e.originalEvent;if(o.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate),"wheel"==e.type&&(u=o.deltaY,aU&&o.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(u/=ZD),o.deltaMode===WheelEvent.DOM_DELTA_LINE&&(u*=40)),0===u)return!1;this.lastDelta_=u;var m=Date.now();void 0===this.startTime_&&(this.startTime_=m),(!this.mode_||m-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(u)<4?"trackpad":"wheel");var b=i.getView();if("trackpad"===this.mode_&&!b.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(b.getAnimating()&&b.cancelAnimations(),b.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),b.adjustZoom(-u/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=m,!1;this.totalDelta_+=u;var T=Math.max(this.timeout_-(m-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),T),!1},t.prototype.handleWheelZoom_=function(e){var n=e.getView();n.getAnimating()&&n.cancelAnimations();var i=-Wc(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(n.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),xS(n,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},t.prototype.setMouseAnchor=function(e){this.useAnchor_=e,e||(this.lastAnchor_=null)},t}(u1);const l6=s6;var u6=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),c6=function(r){function t(e){var n=this,i=e||{},o=i;return o.stopDown||(o.stopDown=o_),(n=r.call(this,o)||this).anchor_=null,n.lastAngle_=void 0,n.rotating_=!1,n.rotationDelta_=0,n.threshold_=void 0!==i.threshold?i.threshold:.3,n.duration_=void 0!==i.duration?i.duration:250,n}return u6(t,r),t.prototype.handleDragEvent=function(e){var n=0,i=this.targetPointers[0],o=this.targetPointers[1],u=Math.atan2(o.clientY-i.clientY,o.clientX-i.clientX);if(void 0!==this.lastAngle_){var m=u-this.lastAngle_;this.rotationDelta_+=m,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),n=m}this.lastAngle_=u;var b=e.map,T=b.getView();if(T.getConstraints().rotation!==DS){var F=b.getViewport().getBoundingClientRect(),V=bS(this.targetPointers);V[0]-=F.left,V[1]-=F.top,this.anchor_=b.getCoordinateFromPixelInternal(V),this.rotating_&&(b.render(),T.adjustRotationInternal(n,this.anchor_))}},t.prototype.handleUpEvent=function(e){return!(this.targetPointers.length<2&&(e.map.getView().endInteraction(this.duration_),1))},t.prototype.handleDownEvent=function(e){if(this.targetPointers.length>=2){var n=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||n.getView().beginInteraction(),!0}return!1},t}(Xy);const h6=c6;var p6=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),d6=function(r){function t(e){var n=this,i=e||{},o=i;return o.stopDown||(o.stopDown=o_),(n=r.call(this,o)||this).anchor_=null,n.duration_=void 0!==i.duration?i.duration:400,n.lastDistance_=void 0,n.lastScaleDelta_=1,n}return p6(t,r),t.prototype.handleDragEvent=function(e){var n=1,i=this.targetPointers[0],o=this.targetPointers[1],u=i.clientX-o.clientX,m=i.clientY-o.clientY,b=Math.sqrt(u*u+m*m);void 0!==this.lastDistance_&&(n=this.lastDistance_/b),this.lastDistance_=b;var T=e.map,F=T.getView();1!=n&&(this.lastScaleDelta_=n);var V=T.getViewport().getBoundingClientRect(),H=bS(this.targetPointers);H[0]-=V.left,H[1]-=V.top,this.anchor_=T.getCoordinateFromPixelInternal(H),T.render(),F.adjustResolutionInternal(n,this.anchor_)},t.prototype.handleUpEvent=function(e){return!(this.targetPointers.length<2&&(e.map.getView().endInteraction(this.duration_,this.lastScaleDelta_>1?1:-1),1))},t.prototype.handleDownEvent=function(e){if(this.targetPointers.length>=2){var n=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||n.getView().beginInteraction(),!0}return!1},t}(Xy);const f6=d6;function tP(r){var t=r||{},e=new _d,n=new o6(-.005,.05,100);return(void 0===t.altShiftDragRotate||t.altShiftDragRotate)&&e.push(new pV),(void 0===t.doubleClickZoom||t.doubleClickZoom)&&e.push(new WU({delta:t.zoomDelta,duration:t.zoomDuration})),(void 0===t.dragPan||t.dragPan)&&e.push(new sV({onFocusOnly:t.onFocusOnly,kinetic:n})),(void 0===t.pinchRotate||t.pinchRotate)&&e.push(new h6),(void 0===t.pinchZoom||t.pinchZoom)&&e.push(new f6({duration:t.zoomDuration})),(void 0===t.keyboard||t.keyboard)&&(e.push(new e6),e.push(new r6({delta:t.zoomDelta,duration:t.zoomDuration}))),(void 0===t.mouseWheelZoom||t.mouseWheelZoom)&&e.push(new l6({onFocusOnly:t.onFocusOnly,duration:t.zoomDuration})),(void 0===t.shiftDragZoom||t.shiftDragZoom)&&e.push(new KV({duration:t.zoomDuration})),e}var m6=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),g6=function(r){function t(e){var n=r.call(this)||this;return n.id_=void 0,n.geometryName_="geometry",n.style_=null,n.styleFunction_=void 0,n.geometryChangeKey_=null,n.addChangeListener(n.geometryName_,n.handleGeometryChanged_),e&&("function"==typeof e.getSimplifiedGeometry?n.setGeometry(e):n.setProperties(e)),n}return m6(t,r),t.prototype.clone=function(){var e=new t(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());var n=this.getGeometry();n&&e.setGeometry(n.clone());var i=this.getStyle();return i&&e.setStyle(i),e},t.prototype.getGeometry=function(){return this.get(this.geometryName_)},t.prototype.getId=function(){return this.id_},t.prototype.getGeometryName=function(){return this.geometryName_},t.prototype.getStyle=function(){return this.style_},t.prototype.getStyleFunction=function(){return this.styleFunction_},t.prototype.handleGeometryChange_=function(){this.changed()},t.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(il(this.geometryChangeKey_),this.geometryChangeKey_=null);var e=this.getGeometry();e&&(this.geometryChangeKey_=Zo(e,"change",this.handleGeometryChange_,this)),this.changed()},t.prototype.setGeometry=function(e){this.set(this.geometryName_,e)},t.prototype.setStyle=function(e){this.style_=e,this.styleFunction_=e?function(r){return"function"==typeof r?r:(Array.isArray(r)?t=r:(bo("function"==typeof r.getZIndex,41),t=[r]),function(){return t});var t}(e):void 0,this.changed()},t.prototype.setId=function(e){this.id_=e,this.changed()},t.prototype.setGeometryName=function(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()},t}(cg);const dg=g6;var v6=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),_6=function(r){function t(e){var n=r.call(this)||this,i=$a({},e);return"object"==typeof e.properties&&(delete i.properties,$a(i,e.properties)),i.opacity=void 0!==e.opacity?e.opacity:1,bo("number"==typeof i.opacity,64),i.visible=void 0===e.visible||e.visible,i.zIndex=e.zIndex,i.maxResolution=void 0!==e.maxResolution?e.maxResolution:1/0,i.minResolution=void 0!==e.minResolution?e.minResolution:0,i.minZoom=void 0!==e.minZoom?e.minZoom:-1/0,i.maxZoom=void 0!==e.maxZoom?e.maxZoom:1/0,n.className_=void 0!==i.className?e.className:"ol-layer",delete i.className,n.setProperties(i),n.state_=null,n}return v6(t,r),t.prototype.getClassName=function(){return this.className_},t.prototype.getLayerState=function(e){var n=this.state_||{layer:this,managed:void 0===e||e},i=this.getZIndex();return n.opacity=Wc(Math.round(100*this.getOpacity())/100,0,1),n.sourceState=this.getSourceState(),n.visible=this.getVisible(),n.extent=this.getExtent(),n.zIndex=void 0!==i||n.managed?i:1/0,n.maxResolution=this.getMaxResolution(),n.minResolution=Math.max(this.getMinResolution(),0),n.minZoom=this.getMinZoom(),n.maxZoom=this.getMaxZoom(),this.state_=n,n},t.prototype.getLayersArray=function(e){return li()},t.prototype.getLayerStatesArray=function(e){return li()},t.prototype.getExtent=function(){return this.get("extent")},t.prototype.getMaxResolution=function(){return this.get("maxResolution")},t.prototype.getMinResolution=function(){return this.get("minResolution")},t.prototype.getMinZoom=function(){return this.get("minZoom")},t.prototype.getMaxZoom=function(){return this.get("maxZoom")},t.prototype.getOpacity=function(){return this.get("opacity")},t.prototype.getSourceState=function(){return li()},t.prototype.getVisible=function(){return this.get("visible")},t.prototype.getZIndex=function(){return this.get("zIndex")},t.prototype.setExtent=function(e){this.set("extent",e)},t.prototype.setMaxResolution=function(e){this.set("maxResolution",e)},t.prototype.setMinResolution=function(e){this.set("minResolution",e)},t.prototype.setMaxZoom=function(e){this.set("maxZoom",e)},t.prototype.setMinZoom=function(e){this.set("minZoom",e)},t.prototype.setOpacity=function(e){bo("number"==typeof e,64),this.set("opacity",e)},t.prototype.setVisible=function(e){this.set("visible",e)},t.prototype.setZIndex=function(e){this.set("zIndex",e)},t.prototype.disposeInternal=function(){this.state_&&(this.state_.layer=null,this.state_=null),r.prototype.disposeInternal.call(this)},t}(cg);const nP=_6;var x6=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),b6=function(r){function t(e){var n=this,i=$a({},e);return delete i.source,(n=r.call(this,i)||this).mapPrecomposeKey_=null,n.mapRenderKey_=null,n.sourceChangeKey_=null,n.renderer_=null,e.render&&(n.render=e.render),e.map&&n.setMap(e.map),n.addChangeListener("source",n.handleSourcePropertyChange_),n.setSource(e.source?e.source:null),n}return x6(t,r),t.prototype.getLayersArray=function(e){var n=e||[];return n.push(this),n},t.prototype.getLayerStatesArray=function(e){var n=e||[];return n.push(this.getLayerState()),n},t.prototype.getSource=function(){return this.get("source")||null},t.prototype.getSourceState=function(){var e=this.getSource();return e?e.getState():"undefined"},t.prototype.handleSourceChange_=function(){this.changed()},t.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(il(this.sourceChangeKey_),this.sourceChangeKey_=null);var e=this.getSource();e&&(this.sourceChangeKey_=Zo(e,"change",this.handleSourceChange_,this)),this.changed()},t.prototype.getFeatures=function(e){return this.renderer_?this.renderer_.getFeatures(e):new Promise(function(n){return n([])})},t.prototype.render=function(e,n){var i=this.getRenderer();if(i.prepareFrame(e))return i.renderFrame(e,n)},t.prototype.setMap=function(e){this.mapPrecomposeKey_&&(il(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(il(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=Zo(e,"precompose",function(n){var o=n.frameState.layerStatesArray,u=this.getLayerState(!1);bo(!o.some(function(m){return m.layer===u.layer}),67),o.push(u)},this),this.mapRenderKey_=Zo(this,"change",e.render,e),this.changed())},t.prototype.setSource=function(e){this.set("source",e)},t.prototype.getRenderer=function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_},t.prototype.hasRenderer=function(){return!!this.renderer_},t.prototype.createRenderer=function(){return null},t.prototype.disposeInternal=function(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),r.prototype.disposeInternal.call(this)},t}(nP);function Cw(r,t){if(!r.visible)return!1;var e=t.resolution;if(e<r.minResolution||e>=r.maxResolution)return!1;var n=t.zoom;return n>r.minZoom&&n<=r.maxZoom}const WS=b6;var w6=function(){function r(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=Cp(t.scale),this.displacement_=t.displacement}return r.prototype.clone=function(){var t=this.getScale();return new r({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()})},r.prototype.getOpacity=function(){return this.opacity_},r.prototype.getRotateWithView=function(){return this.rotateWithView_},r.prototype.getRotation=function(){return this.rotation_},r.prototype.getScale=function(){return this.scale_},r.prototype.getScaleArray=function(){return this.scaleArray_},r.prototype.getDisplacement=function(){return this.displacement_},r.prototype.getAnchor=function(){return li()},r.prototype.getImage=function(t){return li()},r.prototype.getHitDetectionImage=function(){return li()},r.prototype.getPixelRatio=function(t){return 1},r.prototype.getImageState=function(){return li()},r.prototype.getImageSize=function(){return li()},r.prototype.getOrigin=function(){return li()},r.prototype.getSize=function(){return li()},r.prototype.setOpacity=function(t){this.opacity_=t},r.prototype.setRotateWithView=function(t){this.rotateWithView_=t},r.prototype.setRotation=function(t){this.rotation_=t},r.prototype.setScale=function(t){this.scale_=t,this.scaleArray_=Cp(t)},r.prototype.listenImageChange=function(t){li()},r.prototype.load=function(){li()},r.prototype.unlistenImageChange=function(t){li()},r}();const rP=w6;var iP=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,oP=/^([a-z]*)$|^hsla?\(.*\)$/i;function aP(r){return"string"==typeof r?r:cP(r)}var t,e,C6=(t={},e=0,function(n){var i;if(t.hasOwnProperty(n))i=t[n];else{if(e>=1024){var o=0;for(var u in t)0==(3&o++)&&(delete t[u],--e)}i=function(r){var t,e,n,i,o;if(oP.exec(r)&&(r=function(r){var t=document.createElement("div");if(t.style.color=r,""!==t.style.color){document.body.appendChild(t);var e=getComputedStyle(t).color;return document.body.removeChild(t),e}return""}(r)),iP.exec(r)){var m,u=r.length-1;m=u<=4?1:2;var b=4===u||8===u;t=parseInt(r.substr(1+0*m,m),16),e=parseInt(r.substr(1+1*m,m),16),n=parseInt(r.substr(1+2*m,m),16),i=b?parseInt(r.substr(1+3*m,m),16):255,1==m&&(t=(t<<4)+t,e=(e<<4)+e,n=(n<<4)+n,b&&(i=(i<<4)+i)),o=[t,e,n,i/255]}else 0==r.indexOf("rgba(")?uP(o=r.slice(5,-1).split(",").map(Number)):0==r.indexOf("rgb(")?((o=r.slice(4,-1).split(",").map(Number)).push(1),uP(o)):bo(!1,14);return o}(n),t[n]=i,++e}return i});function lP(r){return Array.isArray(r)?r:C6(r)}function uP(r){return r[0]=Wc(r[0]+.5|0,0,255),r[1]=Wc(r[1]+.5|0,0,255),r[2]=Wc(r[2]+.5|0,0,255),r[3]=Wc(r[3],0,1),r}function cP(r){var t=r[0];t!=(0|t)&&(t=t+.5|0);var e=r[1];e!=(0|e)&&(e=e+.5|0);var n=r[2];return n!=(0|n)&&(n=n+.5|0),"rgba("+t+","+e+","+n+","+(void 0===r[3]?1:r[3])+")"}function fg(r){return Array.isArray(r)?cP(r):r}var Ew="ol-hidden",d1="ol-unselectable",$S="ol-control",hP="ol-collapsed",S6=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),pP=["style","variant","weight","size","lineHeight","family"],dP=function(r){var t=r.match(S6);if(!t)return null;for(var e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"},n=0,i=pP.length;n<i;++n){var o=t[n+1];void 0!==o&&(e[pP[n]]=o)}return e.families=e.family.split(/,\s?/),e};function XS(r){return 1===r?"":String(Math.round(100*r)/100)}var fP="10px sans-serif",iy="#000",Sw="round",f1=[],J0="round",y1="#000",v1="center",Tw="middle",E_=[0,0,0,0],oy=new cg,YS=new U0;YS.setSize=function(){console.warn("labelCache is deprecated.")};var KS,Q0=null,JS={},T6=function(){var o,u,t="32px ",e=["monospace","serif"],n=e.length,i="wmytzilWMYTZIL@#/&?$%10\uf013";function m(T,F,V){for(var H=!0,J=0;J<n;++J){var ne=e[J];if(u=Iw(T+" "+F+" "+t+ne,i),V!=ne){var we=Iw(T+" "+F+" "+t+V+","+ne,i);H=H&&we!=u}}return!!H}function b(){for(var T=!0,F=oy.getKeys(),V=0,H=F.length;V<H;++V){var J=F[V];oy.get(J)<100&&(m.apply(this,J.split("\n"))?(t1(JS),Q0=null,KS=void 0,oy.set(J,100)):(oy.set(J,oy.get(J)+1,!0),T=!1))}T&&(clearInterval(o),o=void 0)}return function(T){var F=dP(T);if(F)for(var V=F.families,H=0,J=V.length;H<J;++H){var ne=V[H],we=F.style+"\n"+F.weight+"\n"+ne;void 0===oy.get(we)&&(oy.set(we,100,!0),m(F.style,F.weight,ne)||(oy.set(we,0,!0),void 0===o&&(o=setInterval(b,32))))}}}(),I6=function(){var r;return function(t){var e=JS[t];if(null==e){if(pw){var n=dP(t),i=mP(t,"\u017dg");e=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(i.actualBoundingBoxAscent+i.actualBoundingBoxDescent)}else r||((r=document.createElement("div")).innerHTML="M",r.style.minHeight="0",r.style.maxHeight="none",r.style.height="auto",r.style.padding="0",r.style.border="none",r.style.position="absolute",r.style.display="block",r.style.left="-99999px"),r.style.font=t,document.body.appendChild(r),e=r.offsetHeight,document.body.removeChild(r);JS[t]=e}return e}}();function mP(r,t){return Q0||(Q0=vd(1,1)),r!=KS&&(Q0.font=r,KS=Q0.font),Q0.measureText(t)}function Iw(r,t){return mP(r,t).width}function gP(r,t,e){if(t in e)return e[t];var n=Iw(r,t);return e[t]=n,n}var k6=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),P6=function(r){function t(e){var n=this;return(n=r.call(this,{opacity:1,rotateWithView:void 0!==e.rotateWithView&&e.rotateWithView,rotation:void 0!==e.rotation?e.rotation:0,scale:void 0!==e.scale?e.scale:1,displacement:void 0!==e.displacement?e.displacement:[0,0]})||this).canvas_=void 0,n.hitDetectionCanvas_=null,n.fill_=void 0!==e.fill?e.fill:null,n.origin_=[0,0],n.points_=e.points,n.radius_=void 0!==e.radius?e.radius:e.radius1,n.radius2_=e.radius2,n.angle_=void 0!==e.angle?e.angle:0,n.stroke_=void 0!==e.stroke?e.stroke:null,n.anchor_=null,n.size_=null,n.renderOptions_=null,n.render(),n}return k6(t,r),t.prototype.clone=function(){var e=this.getScale(),n=new t({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice()});return n.setOpacity(this.getOpacity()),n},t.prototype.getAnchor=function(){return this.anchor_},t.prototype.getAngle=function(){return this.angle_},t.prototype.getFill=function(){return this.fill_},t.prototype.getHitDetectionImage=function(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_},t.prototype.getImage=function(e){var n=this.canvas_[e];if(!n){var i=this.renderOptions_,o=vd(i.size*e,i.size*e);this.draw_(i,o,e),this.canvas_[e]=n=o.canvas}return n},t.prototype.getPixelRatio=function(e){return e},t.prototype.getImageSize=function(){return this.size_},t.prototype.getImageState=function(){return 2},t.prototype.getOrigin=function(){return this.origin_},t.prototype.getPoints=function(){return this.points_},t.prototype.getRadius=function(){return this.radius_},t.prototype.getRadius2=function(){return this.radius2_},t.prototype.getSize=function(){return this.size_},t.prototype.getStroke=function(){return this.stroke_},t.prototype.listenImageChange=function(e){},t.prototype.load=function(){},t.prototype.unlistenImageChange=function(e){},t.prototype.calculateLineJoinSize_=function(e,n,i){if(0===n||this.points_===1/0||"bevel"!==e&&"miter"!==e)return n;var o=this.radius_,u=void 0===this.radius2_?o:this.radius2_;if(o<u){var m=o;o=u,u=m}var T=2*Math.PI/(void 0===this.radius2_?this.points_:2*this.points_),F=u*Math.sin(T),H=o-Math.sqrt(u*u-F*F),J=Math.sqrt(F*F+H*H),ne=J/F;if("miter"===e&&ne<=i)return ne*n;var we=n/2/ne,Re=n/2*(H/J),Ne=Math.sqrt((o+we)*(o+we)+Re*Re)-o;if(void 0===this.radius2_||"bevel"===e)return 2*Ne;var $e=o*Math.sin(T),bt=u-Math.sqrt(o*o-$e*$e),Kt=Math.sqrt($e*$e+bt*bt)/$e;return Kt<=i?2*Math.max(Ne,Kt*n/2-u-o):2*Ne},t.prototype.createRenderOptions=function(){var u,e=J0,n=0,i=null,o=0,m=0;this.stroke_&&(null===(u=this.stroke_.getColor())&&(u=y1),u=fg(u),void 0===(m=this.stroke_.getWidth())&&(m=1),i=this.stroke_.getLineDash(),o=this.stroke_.getLineDashOffset(),void 0===(e=this.stroke_.getLineJoin())&&(e=J0),void 0===(n=this.stroke_.getMiterLimit())&&(n=10));var b=this.calculateLineJoinSize_(e,m,n),T=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:u,strokeWidth:m,size:Math.ceil(2*T+b),lineDash:i,lineDashOffset:o,lineJoin:e,miterLimit:n}},t.prototype.render=function(){this.renderOptions_=this.createRenderOptions();var e=this.renderOptions_.size,n=this.getDisplacement();this.canvas_={},this.anchor_=[e/2-n[0],e/2+n[1]],this.size_=[e,e]},t.prototype.draw_=function(e,n,i){if(n.scale(i,i),n.translate(e.size/2,e.size/2),this.createPath_(n),this.fill_){var o=this.fill_.getColor();null===o&&(o=iy),n.fillStyle=fg(o),n.fill()}this.stroke_&&(n.strokeStyle=e.strokeStyle,n.lineWidth=e.strokeWidth,n.setLineDash&&e.lineDash&&(n.setLineDash(e.lineDash),n.lineDashOffset=e.lineDashOffset),n.lineJoin=e.lineJoin,n.miterLimit=e.miterLimit,n.stroke())},t.prototype.createHitDetectionCanvas_=function(e){if(this.fill_){var n=this.fill_.getColor(),i=0;if("string"==typeof n&&(n=lP(n)),null===n?i=1:Array.isArray(n)&&(i=4===n.length?n[3]:1),0===i){var o=vd(e.size,e.size);this.hitDetectionCanvas_=o.canvas,this.drawHitDetectionCanvas_(e,o)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))},t.prototype.createPath_=function(e){var n=this.points_,i=this.radius_;if(n===1/0)e.arc(0,0,i,0,2*Math.PI);else{var o=void 0===this.radius2_?i:this.radius2_;void 0!==this.radius2_&&(n*=2);for(var u=this.angle_-Math.PI/2,m=2*Math.PI/n,b=0;b<n;b++){var T=u+b*m,F=b%2==0?i:o;e.lineTo(F*Math.cos(T),F*Math.sin(T))}e.closePath()}},t.prototype.drawHitDetectionCanvas_=function(e,n){n.translate(e.size/2,e.size/2),this.createPath_(n),n.fillStyle=iy,n.fill(),this.stroke_&&(n.strokeStyle=e.strokeStyle,n.lineWidth=e.strokeWidth,e.lineDash&&(n.setLineDash(e.lineDash),n.lineDashOffset=e.lineDashOffset),n.lineJoin=e.lineJoin,n.miterLimit=e.miterLimit,n.stroke())},t}(rP);const R6=P6;var O6=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),L6=function(r){function t(e){var i=e||{};return r.call(this,{points:1/0,fill:i.fill,radius:i.radius,stroke:i.stroke,scale:void 0!==i.scale?i.scale:1,rotation:void 0!==i.rotation?i.rotation:0,rotateWithView:void 0!==i.rotateWithView&&i.rotateWithView,displacement:void 0!==i.displacement?i.displacement:[0,0]})||this}return O6(t,r),t.prototype.clone=function(){var e=this.getScale(),n=new t({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()});return n.setOpacity(this.getOpacity()),n},t.prototype.setRadius=function(e){this.radius_=e,this.render()},t}(R6);const S_=L6;var F6=function(){function r(t){var e=t||{};this.color_=void 0!==e.color?e.color:null}return r.prototype.clone=function(){var t=this.getColor();return new r({color:Array.isArray(t)?t.slice():t||void 0})},r.prototype.getColor=function(){return this.color_},r.prototype.setColor=function(t){this.color_=t},r}();const Bh=F6;var z6=function(){function r(t){var e=t||{};this.color_=void 0!==e.color?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=void 0!==e.lineDash?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}return r.prototype.clone=function(){var t=this.getColor();return new r({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},r.prototype.getColor=function(){return this.color_},r.prototype.getLineCap=function(){return this.lineCap_},r.prototype.getLineDash=function(){return this.lineDash_},r.prototype.getLineDashOffset=function(){return this.lineDashOffset_},r.prototype.getLineJoin=function(){return this.lineJoin_},r.prototype.getMiterLimit=function(){return this.miterLimit_},r.prototype.getWidth=function(){return this.width_},r.prototype.setColor=function(t){this.color_=t},r.prototype.setLineCap=function(t){this.lineCap_=t},r.prototype.setLineDash=function(t){this.lineDash_=t},r.prototype.setLineDashOffset=function(t){this.lineDashOffset_=t},r.prototype.setLineJoin=function(t){this.lineJoin_=t},r.prototype.setMiterLimit=function(t){this.miterLimit_=t},r.prototype.setWidth=function(t){this.width_=t},r}();const Ku=z6;var ex=function(){function r(t){var e=t||{};this.geometry_=null,this.geometryFunction_=vP,void 0!==e.geometry&&this.setGeometry(e.geometry),this.fill_=void 0!==e.fill?e.fill:null,this.image_=void 0!==e.image?e.image:null,this.renderer_=void 0!==e.renderer?e.renderer:null,this.hitDetectionRenderer_=void 0!==e.hitDetectionRenderer?e.hitDetectionRenderer:null,this.stroke_=void 0!==e.stroke?e.stroke:null,this.text_=void 0!==e.text?e.text:null,this.zIndex_=e.zIndex}return r.prototype.clone=function(){var t=this.getGeometry();return t&&"object"==typeof t&&(t=t.clone()),new r({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},r.prototype.getRenderer=function(){return this.renderer_},r.prototype.setRenderer=function(t){this.renderer_=t},r.prototype.setHitDetectionRenderer=function(t){this.hitDetectionRenderer_=t},r.prototype.getHitDetectionRenderer=function(){return this.hitDetectionRenderer_},r.prototype.getGeometry=function(){return this.geometry_},r.prototype.getGeometryFunction=function(){return this.geometryFunction_},r.prototype.getFill=function(){return this.fill_},r.prototype.setFill=function(t){this.fill_=t},r.prototype.getImage=function(){return this.image_},r.prototype.setImage=function(t){this.image_=t},r.prototype.getStroke=function(){return this.stroke_},r.prototype.setStroke=function(t){this.stroke_=t},r.prototype.getText=function(){return this.text_},r.prototype.setText=function(t){this.text_=t},r.prototype.getZIndex=function(){return this.zIndex_},r.prototype.setGeometry=function(t){"function"==typeof t?this.geometryFunction_=t:"string"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=vP,this.geometry_=t},r.prototype.setZIndex=function(t){this.zIndex_=t},r}(),QS=null;function B6(r,t){if(!QS){var e=new Bh({color:"rgba(255,255,255,0.4)"}),n=new Ku({color:"#3399CC",width:1.25});QS=[new ex({image:new S_({fill:e,stroke:n,radius:5}),fill:e,stroke:n})]}return QS}function yP(){var r={},t=[255,255,255,1],e=[0,153,255,1];return r[$t.POLYGON]=[new ex({fill:new Bh({color:[255,255,255,.5]})})],r[$t.MULTI_POLYGON]=r[$t.POLYGON],r[$t.LINE_STRING]=[new ex({stroke:new Ku({color:t,width:5})}),new ex({stroke:new Ku({color:e,width:3})})],r[$t.MULTI_LINE_STRING]=r[$t.LINE_STRING],r[$t.CIRCLE]=r[$t.POLYGON].concat(r[$t.LINE_STRING]),r[$t.POINT]=[new ex({image:new S_({radius:6,fill:new Bh({color:e}),stroke:new Ku({color:t,width:1.5})}),zIndex:1/0})],r[$t.MULTI_POINT]=r[$t.POINT],r[$t.GEOMETRY_COLLECTION]=r[$t.POLYGON].concat(r[$t.LINE_STRING],r[$t.POINT]),r}function vP(r){return r.getGeometry()}const dl=ex;var j6=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),U6=function(r){function t(e){var n=this,i=e||{},o=$a({},i);return delete o.style,delete o.renderBuffer,delete o.updateWhileAnimating,delete o.updateWhileInteracting,(n=r.call(this,o)||this).declutter_=void 0!==i.declutter&&i.declutter,n.renderBuffer_=void 0!==i.renderBuffer?i.renderBuffer:100,n.style_=null,n.styleFunction_=void 0,n.setStyle(i.style),n.updateWhileAnimating_=void 0!==i.updateWhileAnimating&&i.updateWhileAnimating,n.updateWhileInteracting_=void 0!==i.updateWhileInteracting&&i.updateWhileInteracting,n}return j6(t,r),t.prototype.getDeclutter=function(){return this.declutter_},t.prototype.getFeatures=function(e){return r.prototype.getFeatures.call(this,e)},t.prototype.getRenderBuffer=function(){return this.renderBuffer_},t.prototype.getRenderOrder=function(){return this.get("renderOrder")},t.prototype.getStyle=function(){return this.style_},t.prototype.getStyleFunction=function(){return this.styleFunction_},t.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},t.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},t.prototype.renderDeclutter=function(e){e.declutterTree||(e.declutterTree=new yk(9)),this.getRenderer().renderDeclutter(e)},t.prototype.setRenderOrder=function(e){this.set("renderOrder",e)},t.prototype.setStyle=function(e){this.style_=void 0!==e?e:B6,this.styleFunction_=null===e?void 0:function(r){var t,e;"function"==typeof r?t=r:(Array.isArray(r)?e=r:(bo("function"==typeof r.getZIndex,41),e=[r]),t=function(){return e});return t}(this.style_),this.changed()},t}(WS);const xP=U6;var x1={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Mw=[x1.FILL],Qy=[x1.STROKE],T_=[x1.BEGIN_PATH],bP=[x1.CLOSE_PATH];const $i=x1;var V6=function(){function r(){}return r.prototype.drawCustom=function(t,e,n,i){},r.prototype.drawGeometry=function(t){},r.prototype.setStyle=function(t){},r.prototype.drawCircle=function(t,e){},r.prototype.drawFeature=function(t,e){},r.prototype.drawGeometryCollection=function(t,e){},r.prototype.drawLineString=function(t,e){},r.prototype.drawMultiLineString=function(t,e){},r.prototype.drawMultiPoint=function(t,e){},r.prototype.drawMultiPolygon=function(t,e){},r.prototype.drawPoint=function(t,e){},r.prototype.drawPolygon=function(t,e){},r.prototype.drawText=function(t,e){},r.prototype.setFillStrokeStyle=function(t,e){},r.prototype.setImageStyle=function(t,e){},r.prototype.setTextStyle=function(t,e){},r}();const wP=V6;var G6=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),q6=function(r){function t(e,n,i,o){var u=r.call(this)||this;return u.tolerance=e,u.maxExtent=n,u.pixelRatio=o,u.maxLineWidth=0,u.resolution=i,u.beginGeometryInstruction1_=null,u.beginGeometryInstruction2_=null,u.bufferedMaxExtent_=null,u.instructions=[],u.coordinates=[],u.tmpCoordinate_=[],u.hitDetectionInstructions=[],u.state={},u}return G6(t,r),t.prototype.applyPixelRatio=function(e){var n=this.pixelRatio;return 1==n?e:e.map(function(i){return i*n})},t.prototype.appendFlatPointCoordinates=function(e,n){for(var i=this.getBufferedMaxExtent(),o=this.tmpCoordinate_,u=this.coordinates,m=u.length,b=0,T=e.length;b<T;b+=n)o[0]=e[b],o[1]=e[b+1],ew(i,o)&&(u[m++]=o[0],u[m++]=o[1]);return m},t.prototype.appendFlatLineCoordinates=function(e,n,i,o,u,m){var b=this.coordinates,T=b.length,F=this.getBufferedMaxExtent();m&&(n+=o);var we,Re,qe,V=e[n],H=e[n+1],J=this.tmpCoordinate_,ne=!0;for(we=n+o;we<i;we+=o)J[0]=e[we],J[1]=e[we+1],(qe=JE(F,J))!==Re?(ne&&(b[T++]=V,b[T++]=H,ne=!1),b[T++]=J[0],b[T++]=J[1]):1===qe?(b[T++]=J[0],b[T++]=J[1],ne=!1):ne=!0,V=J[0],H=J[1],Re=qe;return(u&&ne||we===n+o)&&(b[T++]=V,b[T++]=H),T},t.prototype.drawCustomCoordinates_=function(e,n,i,o,u){for(var m=0,b=i.length;m<b;++m){var T=i[m],F=this.appendFlatLineCoordinates(e,n,T,o,!1,!1);u.push(F),n=T}return n},t.prototype.drawCustom=function(e,n,i,o){this.beginGeometry(e,n);var T,F,V,H,J,u=e.getType(),m=e.getStride(),b=this.coordinates.length;switch(u){case $t.MULTI_POLYGON:T=e.getOrientedFlatCoordinates(),H=[];var ne=e.getEndss();J=0;for(var we=0,Re=ne.length;we<Re;++we){var qe=[];J=this.drawCustomCoordinates_(T,J,ne[we],m,qe),H.push(qe)}this.instructions.push([$i.CUSTOM,b,H,e,i,BS]),this.hitDetectionInstructions.push([$i.CUSTOM,b,H,e,o||i,BS]);break;case $t.POLYGON:case $t.MULTI_LINE_STRING:V=[],T=u==$t.POLYGON?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),J=this.drawCustomCoordinates_(T,0,e.getEnds(),m,V),this.instructions.push([$i.CUSTOM,b,V,e,i,p1]),this.hitDetectionInstructions.push([$i.CUSTOM,b,V,e,o||i,p1]);break;case $t.LINE_STRING:case $t.CIRCLE:T=e.getFlatCoordinates(),F=this.appendFlatLineCoordinates(T,0,T.length,m,!1,!1),this.instructions.push([$i.CUSTOM,b,F,e,i,Jy]),this.hitDetectionInstructions.push([$i.CUSTOM,b,F,e,o||i,Jy]);break;case $t.MULTI_POINT:T=e.getFlatCoordinates(),(F=this.appendFlatPointCoordinates(T,m))>b&&(this.instructions.push([$i.CUSTOM,b,F,e,i,Jy]),this.hitDetectionInstructions.push([$i.CUSTOM,b,F,e,o||i,Jy]));break;case $t.POINT:T=e.getFlatCoordinates(),this.coordinates.push(T[0],T[1]),this.instructions.push([$i.CUSTOM,b,F=this.coordinates.length,e,i]),this.hitDetectionInstructions.push([$i.CUSTOM,b,F,e,o||i])}this.endGeometry(n)},t.prototype.beginGeometry=function(e,n){this.beginGeometryInstruction1_=[$i.BEGIN_GEOMETRY,n,0,e],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[$i.BEGIN_GEOMETRY,n,0,e],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},t.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},t.prototype.reverseHitDetectionInstructions=function(){var e=this.hitDetectionInstructions;e.reverse();var n,o,u,i=e.length,m=-1;for(n=0;n<i;++n)(u=(o=e[n])[0])==$i.END_GEOMETRY?m=n:u==$i.BEGIN_GEOMETRY&&(o[2]=n,mj(this.hitDetectionInstructions,m,n),m=-1)},t.prototype.setFillStrokeStyle=function(e,n){var i=this.state;if(e){var o=e.getColor();i.fillStyle=fg(o||iy)}else i.fillStyle=void 0;if(n){var u=n.getColor();i.strokeStyle=fg(u||y1);var m=n.getLineCap();i.lineCap=void 0!==m?m:Sw;var b=n.getLineDash();i.lineDash=b?b.slice():f1;var T=n.getLineDashOffset();i.lineDashOffset=T||0;var F=n.getLineJoin();i.lineJoin=void 0!==F?F:J0;var V=n.getWidth();i.lineWidth=void 0!==V?V:1;var H=n.getMiterLimit();i.miterLimit=void 0!==H?H:10,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0},t.prototype.createFill=function(e){var n=e.fillStyle,i=[$i.SET_FILL_STYLE,n];return"string"!=typeof n&&i.push(!0),i},t.prototype.applyStroke=function(e){this.instructions.push(this.createStroke(e))},t.prototype.createStroke=function(e){return[$i.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio]},t.prototype.updateFillStyle=function(e,n){var i=e.fillStyle;("string"!=typeof i||e.currentFillStyle!=i)&&(void 0!==i&&this.instructions.push(n.call(this,e)),e.currentFillStyle=i)},t.prototype.updateStrokeStyle=function(e,n){var i=e.strokeStyle,o=e.lineCap,u=e.lineDash,m=e.lineDashOffset,b=e.lineJoin,T=e.lineWidth,F=e.miterLimit;(e.currentStrokeStyle!=i||e.currentLineCap!=o||u!=e.currentLineDash&&!i_(e.currentLineDash,u)||e.currentLineDashOffset!=m||e.currentLineJoin!=b||e.currentLineWidth!=T||e.currentMiterLimit!=F)&&(void 0!==i&&n.call(this,e),e.currentStrokeStyle=i,e.currentLineCap=o,e.currentLineDash=u,e.currentLineDashOffset=m,e.currentLineJoin=b,e.currentLineWidth=T,e.currentMiterLimit=F)},t.prototype.endGeometry=function(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var n=[$i.END_GEOMETRY,e];this.instructions.push(n),this.hitDetectionInstructions.push(n)},t.prototype.getBufferedMaxExtent=function(){return!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=RD(this.maxExtent),this.maxLineWidth>0)&&kf(this.bufferedMaxExtent_,this.resolution*(this.maxLineWidth+1)/2,this.bufferedMaxExtent_),this.bufferedMaxExtent_},t}(wP);const b1=q6;var Z6=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),H6=function(r){function t(e,n,i,o){var u=r.call(this,e,n,i,o)||this;return u.hitDetectionImage_=null,u.image_=null,u.imagePixelRatio_=void 0,u.anchorX_=void 0,u.anchorY_=void 0,u.height_=void 0,u.opacity_=void 0,u.originX_=void 0,u.originY_=void 0,u.rotateWithView_=void 0,u.rotation_=void 0,u.scale_=void 0,u.width_=void 0,u.declutterImageWithText_=void 0,u}return Z6(t,r),t.prototype.drawPoint=function(e,n){if(this.image_){this.beginGeometry(e,n);var i=e.getFlatCoordinates(),o=e.getStride(),u=this.coordinates.length,m=this.appendFlatPointCoordinates(i,o);this.instructions.push([$i.DRAW_IMAGE,u,m,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([$i.DRAW_IMAGE,u,m,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(n)}},t.prototype.drawMultiPoint=function(e,n){if(this.image_){this.beginGeometry(e,n);var i=e.getFlatCoordinates(),o=e.getStride(),u=this.coordinates.length,m=this.appendFlatPointCoordinates(i,o);this.instructions.push([$i.DRAW_IMAGE,u,m,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([$i.DRAW_IMAGE,u,m,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(n)}},t.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,r.prototype.finish.call(this)},t.prototype.setImageStyle=function(e,n){var i=e.getAnchor(),o=e.getSize(),u=e.getHitDetectionImage(),m=e.getImage(this.pixelRatio),b=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=u,this.image_=m,this.height_=o[1],this.opacity_=e.getOpacity(),this.originX_=b[0]*this.imagePixelRatio_,this.originY_=b[1]*this.imagePixelRatio_,this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=o[0],this.declutterImageWithText_=n},t}(b1);const W6=H6;var $6=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),X6=function(r){function t(e,n,i,o){return r.call(this,e,n,i,o)||this}return $6(t,r),t.prototype.drawFlatCoordinates_=function(e,n,i,o){var u=this.coordinates.length,m=this.appendFlatLineCoordinates(e,n,i,o,!1,!1),b=[$i.MOVE_TO_LINE_TO,u,m];return this.instructions.push(b),this.hitDetectionInstructions.push(b),i},t.prototype.drawLineString=function(e,n){var i=this.state;if(void 0!==i.strokeStyle&&void 0!==i.lineWidth){this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(e,n),this.hitDetectionInstructions.push([$i.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,f1,0],T_);var m=e.getFlatCoordinates(),b=e.getStride();this.drawFlatCoordinates_(m,0,m.length,b),this.hitDetectionInstructions.push(Qy),this.endGeometry(n)}},t.prototype.drawMultiLineString=function(e,n){var i=this.state;if(void 0!==i.strokeStyle&&void 0!==i.lineWidth){this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(e,n),this.hitDetectionInstructions.push([$i.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],T_);for(var m=e.getEnds(),b=e.getFlatCoordinates(),T=e.getStride(),F=0,V=0,H=m.length;V<H;++V)F=this.drawFlatCoordinates_(b,F,m[V],T);this.hitDetectionInstructions.push(Qy),this.endGeometry(n)}},t.prototype.finish=function(){var e=this.state;return null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&this.instructions.push(Qy),this.reverseHitDetectionInstructions(),this.state=null,r.prototype.finish.call(this)},t.prototype.applyStroke=function(e){null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(Qy),e.lastStroke=this.coordinates.length),e.lastStroke=0,r.prototype.applyStroke.call(this,e),this.instructions.push(T_)},t}(b1);const Y6=X6;var K6=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),J6=function(r){function t(e,n,i,o){return r.call(this,e,n,i,o)||this}return K6(t,r),t.prototype.drawFlatCoordinatess_=function(e,n,i,o){var u=this.state,m=void 0!==u.fillStyle,b=void 0!==u.strokeStyle,T=i.length;this.instructions.push(T_),this.hitDetectionInstructions.push(T_);for(var F=0;F<T;++F){var V=i[F],H=this.coordinates.length,J=this.appendFlatLineCoordinates(e,n,V,o,!0,!b),ne=[$i.MOVE_TO_LINE_TO,H,J];this.instructions.push(ne),this.hitDetectionInstructions.push(ne),b&&(this.instructions.push(bP),this.hitDetectionInstructions.push(bP)),n=V}return m&&(this.instructions.push(Mw),this.hitDetectionInstructions.push(Mw)),b&&(this.instructions.push(Qy),this.hitDetectionInstructions.push(Qy)),n},t.prototype.drawCircle=function(e,n){var i=this.state;if(void 0!==i.fillStyle||void 0!==i.strokeStyle){this.setFillStrokeStyles_(),this.beginGeometry(e,n),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([$i.SET_FILL_STYLE,iy]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([$i.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);var m=e.getFlatCoordinates(),b=e.getStride(),T=this.coordinates.length;this.appendFlatLineCoordinates(m,0,m.length,b,!1,!1);var F=[$i.CIRCLE,T];this.instructions.push(T_,F),this.hitDetectionInstructions.push(T_,F),void 0!==i.fillStyle&&(this.instructions.push(Mw),this.hitDetectionInstructions.push(Mw)),void 0!==i.strokeStyle&&(this.instructions.push(Qy),this.hitDetectionInstructions.push(Qy)),this.endGeometry(n)}},t.prototype.drawPolygon=function(e,n){var i=this.state;if(void 0!==i.fillStyle||void 0!==i.strokeStyle){this.setFillStrokeStyles_(),this.beginGeometry(e,n),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([$i.SET_FILL_STYLE,iy]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([$i.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);var m=e.getEnds(),b=e.getOrientedFlatCoordinates(),T=e.getStride();this.drawFlatCoordinatess_(b,0,m,T),this.endGeometry(n)}},t.prototype.drawMultiPolygon=function(e,n){var i=this.state;if(void 0!==i.fillStyle||void 0!==i.strokeStyle){this.setFillStrokeStyles_(),this.beginGeometry(e,n),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([$i.SET_FILL_STYLE,iy]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([$i.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);for(var m=e.getEndss(),b=e.getOrientedFlatCoordinates(),T=e.getStride(),F=0,V=0,H=m.length;V<H;++V)F=this.drawFlatCoordinatess_(b,F,m[V],T);this.endGeometry(n)}},t.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var e=this.tolerance;if(0!==e)for(var n=this.coordinates,i=0,o=n.length;i<o;++i)n[i]=x_(n[i],e);return r.prototype.finish.call(this)},t.prototype.setFillStrokeStyles_=function(){var e=this.state;void 0!==e.fillStyle&&this.updateFillStyle(e,this.createFill),void 0!==e.strokeStyle&&this.updateStrokeStyle(e,this.applyStroke)},t}(b1);const CP=J6;function Q6(r,t,e,n,i){var V,H,J,ne,we,Re,qe,Ne,$e,o=e,u=e,m=0,b=0,T=e;for(V=e;V<n;V+=i){var tt=t[V],bt=t[V+1];void 0!==ne&&(Ne=tt-ne,$e=bt-we,J=Math.sqrt(Ne*Ne+$e*$e),void 0!==Re&&(b+=H,Math.acos((Re*Ne+qe*$e)/(H*J))>r&&(b>m&&(m=b,o=T,u=V),b=0,T=V-i)),H=J,Re=Ne,qe=$e),ne=tt,we=bt}return(b+=J)>m?[T,V]:[o,u]}var eG=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Aw={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},tG=function(r){function t(e,n,i,o){var u=r.call(this,e,n,i,o)||this;return u.labels_=null,u.text_="",u.textOffsetX_=0,u.textOffsetY_=0,u.textRotateWithView_=void 0,u.textRotation_=0,u.textFillState_=null,u.fillStates={},u.textStrokeState_=null,u.strokeStates={},u.textState_={},u.textStates={},u.textKey_="",u.fillKey_="",u.strokeKey_="",u.declutterImageWithText_=void 0,u}return eG(t,r),t.prototype.finish=function(){var e=r.prototype.finish.call(this);return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e},t.prototype.drawText=function(e,n){var u=this.textState_;if(""!==this.text_&&u&&(this.textFillState_||this.textStrokeState_)){var m=this.coordinates,b=m.length,T=e.getType(),F=null,V=e.getStride();if("line"!==u.placement||T!=$t.LINE_STRING&&T!=$t.MULTI_LINE_STRING&&T!=$t.POLYGON&&T!=$t.MULTI_POLYGON){var Kt=u.overflow?null:[];switch(T){case $t.POINT:case $t.MULTI_POINT:F=e.getFlatCoordinates();break;case $t.LINE_STRING:F=e.getFlatMidpoint();break;case $t.CIRCLE:F=e.getCenter();break;case $t.MULTI_LINE_STRING:F=e.getFlatMidpoints(),V=2;break;case $t.POLYGON:F=e.getFlatInteriorPoint(),u.overflow||Kt.push(F[2]/this.resolution),V=3;break;case $t.MULTI_POLYGON:var vn=e.getFlatInteriorPoints();for(F=[],ne=0,we=vn.length;ne<we;ne+=3)u.overflow||Kt.push(vn[ne+2]/this.resolution),F.push(vn[ne],vn[ne+1]);if(0===F.length)return;V=2}if((dn=this.appendFlatPointCoordinates(F,V))===b)return;if(Kt&&(dn-b)/2!=F.length/V){var Bt=b/2;Kt=Kt.filter(function(Qi,go){var Co=m[2*(Bt+go)]===F[go*V]&&m[2*(Bt+go)+1]===F[go*V+1];return Co||--Bt,Co})}this.saveTextStates_(),(u.backgroundFill||u.backgroundStroke)&&(this.setFillStrokeStyle(u.backgroundFill,u.backgroundStroke),u.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),u.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(e,n);var Dn=u.padding;if(Dn!=E_&&(u.scale[0]<0||u.scale[1]<0)){var un=u.padding[0],Fn=u.padding[1],kr=u.padding[2],Jr=u.padding[3];u.scale[0]<0&&(Fn=-Fn,Jr=-Jr),u.scale[1]<0&&(un=-un,kr=-kr),Dn=[un,Fn,kr,Jr]}var Ur=this.pixelRatio;this.instructions.push([$i.DRAW_IMAGE,b,dn,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterImageWithText_,Dn==E_?E_:Dn.map(function(Qi){return Qi*Ur}),!!u.backgroundFill,!!u.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,Kt]);var Mr=1/Ur;this.hitDetectionInstructions.push([$i.DRAW_IMAGE,b,dn,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[Mr,Mr],NaN,this.declutterImageWithText_,Dn,!!u.backgroundFill,!!u.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,Kt]),this.endGeometry(n)}else{if(!Cc(this.getBufferedMaxExtent(),e.getExtent()))return;var H=void 0;if(F=e.getFlatCoordinates(),T==$t.LINE_STRING)H=[F.length];else if(T==$t.MULTI_LINE_STRING)H=e.getEnds();else if(T==$t.POLYGON)H=e.getEnds().slice(0,1);else if(T==$t.MULTI_POLYGON){var J=e.getEndss();H=[];for(var ne=0,we=J.length;ne<we;++ne)H.push(J[ne][0])}this.beginGeometry(e,n);for(var Re=u.textAlign,qe=0,Ne=void 0,$e=0,tt=H.length;$e<tt;++$e){if(null==Re){var bt=Q6(u.maxAngle,F,qe,H[$e],V);qe=bt[0],Ne=bt[1]}else Ne=H[$e];for(ne=qe;ne<Ne;ne+=V)m.push(F[ne],F[ne+1]);var dn;qe=H[$e],this.drawChars_(b,dn=m.length),b=dn}this.endGeometry(n)}}},t.prototype.saveTextStates_=function(){var e=this.textStrokeState_,n=this.textState_,i=this.textFillState_,o=this.strokeKey_;e&&(o in this.strokeStates||(this.strokeStates[o]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));var u=this.textKey_;u in this.textStates||(this.textStates[u]={font:n.font,textAlign:n.textAlign||v1,textBaseline:n.textBaseline||Tw,scale:n.scale});var m=this.fillKey_;i&&(m in this.fillStates||(this.fillStates[m]={fillStyle:i.fillStyle}))},t.prototype.drawChars_=function(e,n){var i=this.textStrokeState_,o=this.textState_,u=this.strokeKey_,m=this.textKey_,b=this.fillKey_;this.saveTextStates_();var T=this.pixelRatio,F=Aw[o.textBaseline],V=this.textOffsetY_*T,H=this.text_,J=i?i.lineWidth*Math.abs(o.scale[0])/2:0;this.instructions.push([$i.DRAW_CHARS,e,n,F,o.overflow,b,o.maxAngle,T,V,u,J*T,H,m,1]),this.hitDetectionInstructions.push([$i.DRAW_CHARS,e,n,F,o.overflow,b,o.maxAngle,1,V,u,J,H,m,1/T])},t.prototype.setTextStyle=function(e,n){var i,o,u;if(e){var m=e.getFill();m?((o=this.textFillState_)||(this.textFillState_=o={}),o.fillStyle=fg(m.getColor()||iy)):this.textFillState_=o=null;var b=e.getStroke();if(b){(u=this.textStrokeState_)||(this.textStrokeState_=u={});var T=b.getLineDash(),F=b.getLineDashOffset(),V=b.getWidth(),H=b.getMiterLimit();u.lineCap=b.getLineCap()||Sw,u.lineDash=T?T.slice():f1,u.lineDashOffset=void 0===F?0:F,u.lineJoin=b.getLineJoin()||J0,u.lineWidth=void 0===V?1:V,u.miterLimit=void 0===H?10:H,u.strokeStyle=fg(b.getColor()||y1)}else this.textStrokeState_=u=null;i=this.textState_;var J=e.getFont()||fP;T6(J);var ne=e.getScaleArray();i.overflow=e.getOverflow(),i.font=J,i.maxAngle=e.getMaxAngle(),i.placement=e.getPlacement(),i.textAlign=e.getTextAlign(),i.textBaseline=e.getTextBaseline()||Tw,i.backgroundFill=e.getBackgroundFill(),i.backgroundStroke=e.getBackgroundStroke(),i.padding=e.getPadding()||E_,i.scale=void 0===ne?[1,1]:ne;var we=e.getOffsetX(),Re=e.getOffsetY(),qe=e.getRotateWithView(),Ne=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=void 0===we?0:we,this.textOffsetY_=void 0===Re?0:Re,this.textRotateWithView_=void 0!==qe&&qe,this.textRotation_=void 0===Ne?0:Ne,this.strokeKey_=u?("string"==typeof u.strokeStyle?u.strokeStyle:Si(u.strokeStyle))+u.lineCap+u.lineDashOffset+"|"+u.lineWidth+u.lineJoin+u.miterLimit+"["+u.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.textBaseline||"?"),this.fillKey_=o?"string"==typeof o.fillStyle?o.fillStyle:"|"+Si(o.fillStyle):""}else this.text_="";this.declutterImageWithText_=n},t}(b1),nG={Circle:CP,Default:b1,Image:W6,LineString:Y6,Polygon:CP,Text:tG},rG=function(){function r(t,e,n,i){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=i,this.resolution_=n,this.buildersByZIndex_={}}return r.prototype.finish=function(){var t={};for(var e in this.buildersByZIndex_){t[e]=t[e]||{};var n=this.buildersByZIndex_[e];for(var i in n){var o=n[i].finish();t[e][i]=o}}return t},r.prototype.getBuilder=function(t,e){var n=void 0!==t?t.toString():"0",i=this.buildersByZIndex_[n];void 0===i&&(this.buildersByZIndex_[n]=i={});var o=i[e];return void 0===o&&(o=new(0,nG[e])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),i[e]=o),o},r}();const Dw=rG;var iG=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),oG=function(r){function t(e){var n=r.call(this)||this;return n.boundHandleImageChange_=n.handleImageChange_.bind(n),n.layer_=e,n.declutterExecutorGroup=null,n}return iG(t,r),t.prototype.getFeatures=function(e){return li()},t.prototype.prepareFrame=function(e){return li()},t.prototype.renderFrame=function(e,n){return li()},t.prototype.loadedTileCallback=function(e,n,i){e[n]||(e[n]={}),e[n][i.tileCoord.toString()]=i},t.prototype.createLoadedTileFinder=function(e,n,i){return function(o,u){var m=this.loadedTileCallback.bind(this,i,o);return e.forEachLoadedTile(n,o,u,m)}.bind(this)},t.prototype.forEachFeatureAtCoordinate=function(e,n,i,o,u){},t.prototype.getDataAtPixel=function(e,n,i){return null},t.prototype.getLayer=function(){return this.layer_},t.prototype.handleFontsChanged=function(){},t.prototype.handleImageChange_=function(e){2===e.target.getState()&&this.renderIfReadyAndVisible()},t.prototype.loadImage=function(e){var n=e.getState();return 2!=n&&3!=n&&e.addEventListener("change",this.boundHandleImageChange_),0==n&&(e.load(),n=e.getState()),2==n},t.prototype.renderIfReadyAndVisible=function(){var e=this.getLayer();e.getVisible()&&"ready"==e.getSourceState()&&e.changed()},t}(AD);const aG=oG;var sG=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),lG=function(r){function t(e,n,i,o){var u=r.call(this,e)||this;return u.inversePixelTransform=n,u.frameState=i,u.context=o,u}return sG(t,r),t}(_m);const SP=lG;var uG=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),cG=function(r){function t(e){var n=r.call(this,e)||this;return n.container=null,n.tempTransform=[1,0,0,1,0,0],n.pixelTransform=[1,0,0,1,0,0],n.inversePixelTransform=[1,0,0,1,0,0],n.context=null,n.containerReused=!1,n}return uG(t,r),t.prototype.useContainer=function(e,n,i){var u,m,o=this.getLayer().getClassName();if(e&&e.style.opacity===XS(i)&&e.className===o&&(b=e.firstElementChild)instanceof HTMLCanvasElement&&(m=b.getContext("2d")),m&&m.canvas.style.transform===n?(this.container=e,this.context=m,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){(u=document.createElement("div")).className=o;var b,T=u.style;T.position="absolute",T.width="100%",T.height="100%",m=vd(),u.appendChild(b=m.canvas),(T=b.style).position="absolute",T.left="0",T.transformOrigin="top left",this.container=u,this.context=m}},t.prototype.clipUnrotated=function(e,n,i){var o=lg(i),u=o1(i),m=i1(i),b=q0(i);$c(n.coordinateToPixelTransform,o),$c(n.coordinateToPixelTransform,u),$c(n.coordinateToPixelTransform,m),$c(n.coordinateToPixelTransform,b);var T=this.inversePixelTransform;$c(T,o),$c(T,u),$c(T,m),$c(T,b),e.save(),e.beginPath(),e.moveTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(u[0]),Math.round(u[1])),e.lineTo(Math.round(m[0]),Math.round(m[1])),e.lineTo(Math.round(b[0]),Math.round(b[1])),e.clip()},t.prototype.dispatchRenderEvent_=function(e,n,i){var o=this.getLayer();if(o.hasListener(e)){var u=new SP(e,this.inversePixelTransform,i,n);o.dispatchEvent(u)}},t.prototype.preRender=function(e,n){this.dispatchRenderEvent_("prerender",e,n)},t.prototype.postRender=function(e,n){this.dispatchRenderEvent_("postrender",e,n)},t.prototype.getRenderTransform=function(e,n,i,o,u,m,b){var V=o/n;return ef(this.tempTransform,u/2,m/2,V,-V,-i,-e[0]+b,-e[1])},t.prototype.getDataAtPixel=function(e,n,i){var F,o=$c(this.inversePixelTransform,e.slice()),u=this.context,b=this.getLayer().getExtent();if(b&&!ew(b,$c(n.pixelToCoordinateTransform,e.slice())))return null;try{var V=Math.round(o[0]),H=Math.round(o[1]),J=document.createElement("canvas"),ne=J.getContext("2d");J.width=1,J.height=1,ne.clearRect(0,0,1,1),ne.drawImage(u.canvas,V,H,1,1,0,0,1,1),F=ne.getImageData(0,0,1,1).data}catch(we){return"SecurityError"===we.name?new Uint8Array:F}return 0===F[3]?null:F},t}(aG);const eT=cG;function hG(r,t,e,n,i,o,u,m,b,T,F,V){var H=r[t],J=r[t+1],ne=0,we=0,Re=0,qe=0;function Ne(){ne=H,we=J,H=r[t+=n],J=r[t+1],qe+=Re,Re=Math.sqrt((H-ne)*(H-ne)+(J-we)*(J-we))}do{Ne()}while(t<e-n&&qe+Re<o);for(var $e=0===Re?0:(o-qe)/Re,tt=ry(ne,H,$e),bt=ry(we,J,$e),dn=t-n,Kt=qe,vn=o+m*b(T,i,F);t<e-n&&qe+Re<vn;)Ne();var un,Bt=ry(ne,H,$e=0===Re?0:(vn-qe)/Re),Dn=ry(we,J,$e);if(V){var Fn=[tt,bt,Bt,Dn];RS(Fn,0,4,2,V,Fn,Fn),un=Fn[0]>Fn[2]}else un=tt>Bt;var Mr,kr=Math.PI,Jr=[],Ur=dn+n===t;if(Re=0,qe=Kt,H=r[t=dn],J=r[t+1],Ur)return Ne(),Mr=Math.atan2(J-we,H-ne),un&&(Mr+=Mr>0?-kr:kr),Jr[0]=[_n=(Bt+tt)/2,Qi=(Dn+bt)/2,(vn-o)/2,Mr,i],Jr;for(var go=0,Co=i.length;go<Co;){Ne();var as=Math.atan2(J-we,H-ne);if(un&&(as+=as>0?-kr:kr),void 0!==Mr){var En=as-Mr;if(En+=En>kr?-2*kr:En<-kr?2*kr:0,Math.abs(En)>u)return null}Mr=as;for(var ma=go,Mi=0;go<Co;++go){var ws=m*b(T,i[un?Co-go-1:go],F);if(t+n<e&&qe+Re<o+Mi+ws/2)break;Mi+=ws}if(go!==ma){var cr=un?i.substring(Co-ma,Co-go):i.substring(ma,go),_n=ry(ne,H,$e=0===Re?0:(o+Mi/2-qe)/Re),Qi=ry(we,J,$e);Jr.push([_n,Qi,Mi/2,as,cr]),o+=Mi}}return Jr}function tT(r,t,e,n){for(var i=r[t],o=r[t+1],u=0,m=t+n;m<e;m+=n){var b=r[m],T=r[m+1];u+=Math.sqrt((b-i)*(b-i)+(T-o)*(T-o)),i=b,o=T}return u}var tx=[1/0,1/0,-1/0,-1/0],ev=[],ay=[],sy=[],tv=[];function TP(r){return r[3].declutterBox}var pG=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function IP(r,t){return("start"===t||"end"===t)&&!pG.test(r)&&(t="start"===t?"left":"right"),Aw[t]}var dG=function(){function r(t,e,n,i){this.overlaps=n,this.pixelRatio=e,this.resolution=t,this.instructions=i.instructions,this.coordinates=i.coordinates,this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=i.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=i.fillStates||{},this.strokeStates=i.strokeStates||{},this.textStates=i.textStates||{},this.widths_={},this.labels_={}}return r.prototype.createLabel=function(t,e,n,i){var o=t+e+n+i;if(this.labels_[o])return this.labels_[o];var u=i?this.strokeStates[i]:null,m=n?this.fillStates[n]:null,b=this.textStates[e],T=this.pixelRatio,F=[b.scale[0]*T,b.scale[1]*T],V=IP(t,b.textAlign||v1),H=i&&u.lineWidth?u.lineWidth:0,J=t.split("\n"),ne=J.length,we=[],Re=function(r,t,e){for(var n=t.length,i=0,o=0;o<n;++o){var u=Iw(r,t[o]);i=Math.max(i,u),e.push(u)}return i}(b.font,J,we),qe=I6(b.font),$e=Re+H,tt=[],bt=($e+2)*F[0],dn=(qe*ne+H)*F[1],Kt={width:bt<0?Math.floor(bt):Math.ceil(bt),height:dn<0?Math.floor(dn):Math.ceil(dn),contextInstructions:tt};(1!=F[0]||1!=F[1])&&tt.push("scale",F),tt.push("font",b.font),i&&(tt.push("strokeStyle",u.strokeStyle),tt.push("lineWidth",H),tt.push("lineCap",u.lineCap),tt.push("lineJoin",u.lineJoin),tt.push("miterLimit",u.miterLimit),(pw?OffscreenCanvasRenderingContext2D:CanvasRenderingContext2D).prototype.setLineDash&&(tt.push("setLineDash",[u.lineDash]),tt.push("lineDashOffset",u.lineDashOffset))),n&&tt.push("fillStyle",m.fillStyle),tt.push("textBaseline","middle"),tt.push("textAlign","center");var un,Bt=.5-V,Dn=V*$e+Bt*H;if(i)for(un=0;un<ne;++un)tt.push("strokeText",[J[un],Dn+Bt*we[un],.5*(H+qe)+un*qe]);if(n)for(un=0;un<ne;++un)tt.push("fillText",[J[un],Dn+Bt*we[un],.5*(H+qe)+un*qe]);return this.labels_[o]=Kt,Kt},r.prototype.replayTextBackground_=function(t,e,n,i,o,u,m){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,n),t.lineTo.apply(t,i),t.lineTo.apply(t,o),t.lineTo.apply(t,e),u&&(this.alignFill_=u[2],this.fill_(t)),m&&(this.setStrokeStyle_(t,m),t.stroke())},r.prototype.calculateImageOrLabelDimensions_=function(t,e,n,i,o,u,m,b,T,F,V,H,J,ne,we,Re){var Bt,qe=n-(m*=H[0]),Ne=i-(b*=H[1]),$e=o+T>t?t-T:o,tt=u+F>e?e-F:u,bt=ne[3]+$e*H[0]+ne[1],dn=ne[0]+tt*H[1]+ne[2],Kt=qe-ne[3],vn=Ne-ne[0];return(we||0!==V)&&(ev[0]=Kt,tv[0]=Kt,ev[1]=vn,ay[1]=vn,ay[0]=Kt+bt,sy[0]=ay[0],sy[1]=vn+dn,tv[1]=sy[1]),0!==V?($c(Bt=ef([1,0,0,1,0,0],n,i,1,1,V,-n,-i),ev),$c(Bt,ay),$c(Bt,sy),$c(Bt,tv),bm(Math.min(ev[0],ay[0],sy[0],tv[0]),Math.min(ev[1],ay[1],sy[1],tv[1]),Math.max(ev[0],ay[0],sy[0],tv[0]),Math.max(ev[1],ay[1],sy[1],tv[1]),tx)):bm(Math.min(Kt,Kt+bt),Math.min(vn,vn+dn),Math.max(Kt,Kt+bt),Math.max(vn,vn+dn),tx),J&&(qe=Math.round(qe),Ne=Math.round(Ne)),{drawImageX:qe,drawImageY:Ne,drawImageW:$e,drawImageH:tt,originX:T,originY:F,declutterBox:{minX:tx[0],minY:tx[1],maxX:tx[2],maxY:tx[3],value:Re},canvasTransform:Bt,scale:H}},r.prototype.replayImageOrLabel_=function(t,e,n,i,o,u,m){var T=i.declutterBox,F=t.canvas,V=m?m[2]*i.scale[0]/2:0;return T.minX-V<=F.width/e&&T.maxX+V>=0&&T.minY-V<=F.height/e&&T.maxY+V>=0&&(!(!u&&!m)&&this.replayTextBackground_(t,ev,ay,sy,tv,u,m),function(r,t,e,n,i,o,u,m,b,T,F){r.save(),1!==e&&(r.globalAlpha*=e),t&&r.setTransform.apply(r,t),n.contextInstructions?(r.translate(b,T),r.scale(F[0],F[1]),function(r,t){for(var e=r.contextInstructions,n=0,i=e.length;n<i;n+=2)Array.isArray(e[n+1])?t[e[n]].apply(t,e[n+1]):t[e[n]]=e[n+1]}(n,r)):F[0]<0||F[1]<0?(r.translate(b,T),r.scale(F[0],F[1]),r.drawImage(n,i,o,u,m,0,0,u,m)):r.drawImage(n,i,o,u,m,b,T,u*F[0],m*F[1]),r.restore()}(t,i.canvasTransform,o,n,i.originX,i.originY,i.drawImageW,i.drawImageH,i.drawImageX,i.drawImageY,i.scale)),!0},r.prototype.fill_=function(t){if(this.alignFill_){var e=$c(this.renderedTransform_,[0,0]),n=512*this.pixelRatio;t.save(),t.translate(e[0]%n,e[1]%n),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()},r.prototype.setStrokeStyle_=function(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.setLineDash&&(t.lineDashOffset=e[7],t.setLineDash(e[6]))},r.prototype.drawLabelWithPointPlacement_=function(t,e,n,i){var o=this.textStates[e],u=this.createLabel(t,e,i,n),m=this.strokeStates[n],b=this.pixelRatio,T=IP(t,o.textAlign||v1),F=Aw[o.textBaseline||Tw],V=m&&m.lineWidth?m.lineWidth:0;return{label:u,anchorX:T*(u.width/b-2*o.scale[0])+2*(.5-T)*V,anchorY:F*u.height/b+2*(.5-F)*V}},r.prototype.execute_=function(t,e,n,i,o,u,m,b){var T;this.pixelCoordinates_&&i_(n,this.renderedTransform_)?T=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),T=Yy(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),function(r,t){r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5]}(this.renderedTransform_,n));for(var J,ne,we,Re,qe,Ne,$e,tt,bt,dn,Kt,vn,Qi,go,Co,as,F=0,V=i.length,H=0,Bt=0,Dn=0,un=null,Fn=null,kr=this.coordinateCache_,Jr=this.viewRotation_,Ur=Math.round(1e12*Math.atan2(-n[1],n[0]))/1e12,Mr={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:Jr},_n=this.instructions!=i||this.overlaps?0:200;F<V;){var En=i[F];switch(En[0]){case $i.BEGIN_GEOMETRY:as=En[3],(Qi=En[1]).getGeometry()?void 0===m||Cc(m,as.getExtent())?++F:F=En[2]+1:F=En[2];break;case $i.BEGIN_PATH:Bt>_n&&(this.fill_(t),Bt=0),Dn>_n&&(t.stroke(),Dn=0),!Bt&&!Dn&&(t.beginPath(),Re=NaN,qe=NaN),++F;break;case $i.CIRCLE:var Mi=T[H=En[1]],No=T[H+1],fl=T[H+2]-Mi,Yc=T[H+3]-No,ml=Math.sqrt(fl*fl+Yc*Yc);t.moveTo(Mi+ml,No),t.arc(Mi,No,ml,0,2*Math.PI,!0),++F;break;case $i.CLOSE_PATH:t.closePath(),++F;break;case $i.CUSTOM:H=En[1],J=En[2];var py=En[4],gh=6==En.length?En[5]:void 0;Mr.geometry=En[3],Mr.feature=Qi,F in kr||(kr[F]=[]);var zf=kr[F];gh?gh(T,H,J,2,zf):(zf[0]=T[H],zf[1]=T[H+1],zf.length=2),py(zf,Mr),++F;break;case $i.DRAW_IMAGE:H=En[1],J=En[2],ne=En[4],we=En[5];var Mp=En[6],Fs=En[7],Ju=En[8],jh=En[9],Cs=En[10],Aa=En[11],wd=En[12],Pl=En[13],Nf=En[14];if(!(tt=En[3])&&En.length>=19){var Ap=this.drawLabelWithPointPlacement_(bt=En[18],dn=En[19],Kt=En[20],vn=En[21]);En[3]=tt=Ap.label,En[4]=ne=(Ap.anchorX-En[22])*this.pixelRatio,En[5]=we=(Ap.anchorY-En[23])*this.pixelRatio,En[6]=Mp=tt.height,En[13]=Pl=tt.width}var bg=void 0;En.length>24&&(bg=En[24]);var Jp=void 0,lp=void 0,Qp=void 0;En.length>16?(Jp=En[15],lp=En[16],Qp=En[17]):(Jp=E_,lp=!1,Qp=!1),Cs&&Ur?Aa+=Jr:!Cs&&!Ur&&(Aa-=Jr);for(var Cd=0;H<J;H+=2)if(!(bg&&bg[Cd++]<Pl/this.pixelRatio)){var vh=[t,e,tt,Dp=this.calculateImageOrLabelDimensions_(tt.width,tt.height,T[H],T[H+1],Pl,Mp,ne,we,Ju,jh,Aa,wd,o,Jp,lp||Qp,Qi),Fs,lp?un:null,Qp?Fn:null],ed=void 0,td=void 0;if(b&&Nf){var yx=J-H;if(!Nf[yx]){Nf[yx]=vh;continue}if(ed=Nf[yx],delete Nf[yx],td=TP(ed),b.collides(td))continue}b&&b.collides(Dp.declutterBox)||(ed&&(b&&b.insert(td),this.replayImageOrLabel_.apply(this,ed)),b&&b.insert(Dp.declutterBox),this.replayImageOrLabel_.apply(this,vh))}++F;break;case $i.DRAW_CHARS:var NL=En[1],BL=En[2],T2=En[3],sY=En[4];vn=En[5];var lY=En[6],jL=En[7],UL=En[8];Kt=En[9];var I2=En[10];bt=En[11];var VL=[En[13],En[13]],M2=this.textStates[dn=En[12]],W1=M2.font,$1=[M2.scale[0]*jL,M2.scale[1]*jL],X1=void 0;W1 in this.widths_?X1=this.widths_[W1]:this.widths_[W1]=X1={};var GL=tT(T,NL,BL,2),qL=Math.abs($1[0])*gP(W1,bt,X1);if(sY||qL<=GL){var Y1=hG(T,NL,BL,2,bt,(GL-qL)*Aw[this.textStates[dn].textAlign],lY,Math.abs($1[0]),gP,W1,X1,Ur?0:this.viewRotation_);e:if(Y1){var K1=[],fv=void 0,IC=void 0,Ed=void 0,jf=void 0;if(Kt)for(fv=0,IC=Y1.length;fv<IC;++fv){Ed=this.createLabel((jf=Y1[fv])[4],dn,"",Kt);var Dp=this.calculateImageOrLabelDimensions_(Ed.width,Ed.height,jf[0],jf[1],Ed.width,Ed.height,ne=jf[2]+($1[0]<0?-I2:I2),we=T2*Ed.height+2*(.5-T2)*I2*$1[1]/$1[0]-UL,0,0,jf[3],VL,!1,E_,!1,Qi);if(b&&b.collides(Dp.declutterBox))break e;K1.push([t,e,Ed,Dp,1,null,null])}if(vn)for(fv=0,IC=Y1.length;fv<IC;++fv){if(Ed=this.createLabel((jf=Y1[fv])[4],dn,vn,""),Dp=this.calculateImageOrLabelDimensions_(Ed.width,Ed.height,jf[0],jf[1],Ed.width,Ed.height,ne=jf[2],we=T2*Ed.height-UL,0,0,jf[3],VL,!1,E_,!1,Qi),b&&b.collides(Dp.declutterBox))break e;K1.push([t,e,Ed,Dp,1,null,null])}b&&b.load(K1.map(TP));for(var A2=0,hY=K1.length;A2<hY;++A2)this.replayImageOrLabel_.apply(this,K1[A2])}}++F;break;case $i.END_GEOMETRY:if(void 0!==u){var ZL=u(Qi=En[1],as);if(ZL)return ZL}++F;break;case $i.FILL:_n?Bt++:this.fill_(t),++F;break;case $i.MOVE_TO_LINE_TO:for(J=En[2],$e=(Co=T[(H=En[1])+1])+.5|0,((Ne=(go=T[H])+.5|0)!==Re||$e!==qe)&&(t.moveTo(go,Co),Re=Ne,qe=$e),H+=2;H<J;H+=2)Ne=(go=T[H])+.5|0,$e=(Co=T[H+1])+.5|0,(H==J-2||Ne!==Re||$e!==qe)&&(t.lineTo(go,Co),Re=Ne,qe=$e);++F;break;case $i.SET_FILL_STYLE:un=En,this.alignFill_=En[2],Bt&&(this.fill_(t),Bt=0,Dn&&(t.stroke(),Dn=0)),t.fillStyle=En[1],++F;break;case $i.SET_STROKE_STYLE:Fn=En,Dn&&(t.stroke(),Dn=0),this.setStrokeStyle_(t,En),++F;break;case $i.STROKE:_n?Dn++:t.stroke(),++F;break;default:++F}}Bt&&this.fill_(t),Dn&&t.stroke()},r.prototype.execute=function(t,e,n,i,o,u){this.viewRotation_=i,this.execute_(t,e,n,this.instructions,o,void 0,void 0,u)},r.prototype.executeHitDetection=function(t,e,n,i,o){return this.viewRotation_=n,this.execute_(t,1,e,this.hitDetectionInstructions,!0,i,o)},r}();const fG=dG;var nT=["Polygon","Circle","LineString","Image","Text","Default"],mG=function(){function r(t,e,n,i,o,u){this.maxExtent_=t,this.overlaps_=i,this.pixelRatio_=n,this.resolution_=e,this.renderBuffer_=u,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=[1,0,0,1,0,0],this.createExecutors_(o)}return r.prototype.clip=function(t,e){var n=this.getClipCoords(e);t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(n[2],n[3]),t.lineTo(n[4],n[5]),t.lineTo(n[6],n[7]),t.clip()},r.prototype.createExecutors_=function(t){for(var e in t){var n=this.executorsByZIndex_[e];void 0===n&&(this.executorsByZIndex_[e]=n={});var i=t[e];for(var o in i)n[o]=new fG(this.resolution_,this.pixelRatio_,this.overlaps_,i[o])}},r.prototype.hasExecutors=function(t){for(var e in this.executorsByZIndex_)for(var n=this.executorsByZIndex_[e],i=0,o=t.length;i<o;++i)if(t[i]in n)return!0;return!1},r.prototype.forEachFeatureAtCoordinate=function(t,e,n,i,o,u){var m=2*(i=Math.round(i))+1,b=ef(this.hitDetectionTransform_,i+.5,i+.5,1/e,-1/e,-n,-t[0],-t[1]),T=!this.hitDetectionContext_;T&&(this.hitDetectionContext_=vd(m,m));var V,F=this.hitDetectionContext_;F.canvas.width!==m||F.canvas.height!==m?(F.canvas.width=m,F.canvas.height=m):T||F.clearRect(0,0,m,m),void 0!==this.renderBuffer_&&(G0(V=[1/0,1/0,-1/0,-1/0],t),kf(V,e*(this.renderBuffer_+i),V));var J,H=function(r){if(void 0!==rT[r])return rT[r];for(var t=2*r+1,e=r*r,n=new Array(e+1),i=0;i<=r;++i)for(var o=0;o<=r;++o){var u=i*i+o*o;if(u>e)break;var m=n[u];m||(n[u]=m=[]),m.push(4*((r+i)*t+(r+o))+3),i>0&&m.push(4*((r-i)*t+(r+o))+3),o>0&&(m.push(4*((r+i)*t+(r-o))+3),i>0&&m.push(4*((r-i)*t+(r-o))+3))}for(var b=[],T=(i=0,n.length);i<T;++i)n[i]&&b.push.apply(b,n[i]);return rT[r]=b,b}(i);function ne(dn,Kt){for(var vn=F.getImageData(0,0,m,m).data,Bt=0,Dn=H.length;Bt<Dn;Bt++)if(vn[H[Bt]]>0){if(!u||"Image"!==J&&"Text"!==J||-1!==u.indexOf(dn)){var un=(H[Bt]-3)/4,Fn=i-un%m,kr=i-(un/m|0),Jr=o(dn,Kt,Fn*Fn+kr*kr);if(Jr)return Jr}F.clearRect(0,0,m,m);break}}var Re,qe,Ne,$e,tt,we=Object.keys(this.executorsByZIndex_).map(Number);for(we.sort(r_),Re=we.length-1;Re>=0;--Re){var bt=we[Re].toString();for(Ne=this.executorsByZIndex_[bt],qe=nT.length-1;qe>=0;--qe)if(void 0!==($e=Ne[J=nT[qe]])&&(tt=$e.executeHitDetection(F,b,n,ne,V)))return tt}},r.prototype.getClipCoords=function(t){var e=this.maxExtent_;if(!e)return null;var n=e[0],i=e[1],o=e[2],u=e[3],m=[n,i,n,u,o,u,o,i];return Yy(m,0,8,2,t,m),m},r.prototype.isEmpty=function(){return s_(this.executorsByZIndex_)},r.prototype.execute=function(t,e,n,i,o,u,m){var b=Object.keys(this.executorsByZIndex_).map(Number);b.sort(r_),this.maxExtent_&&(t.save(),this.clip(t,n));var F,V,H,J,ne,we,T=u||nT;for(m&&b.reverse(),F=0,V=b.length;F<V;++F){var Re=b[F].toString();for(ne=this.executorsByZIndex_[Re],H=0,J=T.length;H<J;++H)void 0!==(we=ne[T[H]])&&we.execute(t,e,n,i,o,m)}this.maxExtent_&&t.restore()},r}(),rT={};const kw=mG;var yG=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),vG=function(r){function t(e,n,i,o,u,m,b){var T=r.call(this)||this;return T.context_=e,T.pixelRatio_=n,T.extent_=i,T.transform_=o,T.viewRotation_=u,T.squaredTolerance_=m,T.userTransform_=b,T.contextFillState_=null,T.contextStrokeState_=null,T.contextTextState_=null,T.fillState_=null,T.strokeState_=null,T.image_=null,T.imageAnchorX_=0,T.imageAnchorY_=0,T.imageHeight_=0,T.imageOpacity_=0,T.imageOriginX_=0,T.imageOriginY_=0,T.imageRotateWithView_=!1,T.imageRotation_=0,T.imageScale_=[0,0],T.imageWidth_=0,T.text_="",T.textOffsetX_=0,T.textOffsetY_=0,T.textRotateWithView_=!1,T.textRotation_=0,T.textScale_=[0,0],T.textFillState_=null,T.textStrokeState_=null,T.textState_=null,T.pixelCoordinates_=[],T.tmpLocalTransform_=[1,0,0,1,0,0],T}return yG(t,r),t.prototype.drawImages_=function(e,n,i,o){if(this.image_){var u=Yy(e,n,i,o,this.transform_,this.pixelCoordinates_),m=this.context_,b=this.tmpLocalTransform_,T=m.globalAlpha;1!=this.imageOpacity_&&(m.globalAlpha=T*this.imageOpacity_);var F=this.imageRotation_;this.imageRotateWithView_&&(F+=this.viewRotation_);for(var V=0,H=u.length;V<H;V+=2){var J=u[V]-this.imageAnchorX_,ne=u[V+1]-this.imageAnchorY_;if(0!==F||1!=this.imageScale_[0]||1!=this.imageScale_[1]){var we=J+this.imageAnchorX_,Re=ne+this.imageAnchorY_;ef(b,we,Re,1,1,F,-we,-Re),m.setTransform.apply(m,b),m.translate(we,Re),m.scale(this.imageScale_[0],this.imageScale_[1]),m.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),m.setTransform(1,0,0,1,0,0)}else m.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,J,ne,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(m.globalAlpha=T)}},t.prototype.drawText_=function(e,n,i,o){if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var u=Yy(e,n,i,o,this.transform_,this.pixelCoordinates_),m=this.context_,b=this.textRotation_;for(this.textRotateWithView_&&(b+=this.viewRotation_);n<i;n+=o){var T=u[n]+this.textOffsetX_,F=u[n+1]+this.textOffsetY_;if(0!==b||1!=this.textScale_[0]||1!=this.textScale_[1]){var V=ef(this.tmpLocalTransform_,T,F,1,1,b,-T,-F);m.setTransform.apply(m,V),m.translate(T,F),m.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&m.strokeText(this.text_,0,0),this.textFillState_&&m.fillText(this.text_,0,0),m.setTransform(1,0,0,1,0,0)}else this.textStrokeState_&&m.strokeText(this.text_,T,F),this.textFillState_&&m.fillText(this.text_,T,F)}}},t.prototype.moveToLineTo_=function(e,n,i,o,u){var m=this.context_,b=Yy(e,n,i,o,this.transform_,this.pixelCoordinates_);m.moveTo(b[0],b[1]);var T=b.length;u&&(T-=2);for(var F=2;F<T;F+=2)m.lineTo(b[F],b[F+1]);return u&&m.closePath(),i},t.prototype.drawRings_=function(e,n,i,o){for(var u=0,m=i.length;u<m;++u)n=this.moveToLineTo_(e,n,i[u],o,!0);return n},t.prototype.drawCircle=function(e){if(Cc(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var n=function(r,t,e){var n=r.getFlatCoordinates();if(n){var i=r.getStride();return Yy(n,0,n.length,i,t,e)}return null}(e,this.transform_,this.pixelCoordinates_),i=n[2]-n[0],o=n[3]-n[1],u=Math.sqrt(i*i+o*o),m=this.context_;m.beginPath(),m.arc(n[0],n[1],u,0,2*Math.PI),this.fillState_&&m.fill(),this.strokeState_&&m.stroke()}""!==this.text_&&this.drawText_(e.getCenter(),0,2,2)}},t.prototype.setStyle=function(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())},t.prototype.setTransform=function(e){this.transform_=e},t.prototype.drawGeometry=function(e){switch(e.getType()){case $t.POINT:this.drawPoint(e);break;case $t.LINE_STRING:this.drawLineString(e);break;case $t.POLYGON:this.drawPolygon(e);break;case $t.MULTI_POINT:this.drawMultiPoint(e);break;case $t.MULTI_LINE_STRING:this.drawMultiLineString(e);break;case $t.MULTI_POLYGON:this.drawMultiPolygon(e);break;case $t.GEOMETRY_COLLECTION:this.drawGeometryCollection(e);break;case $t.CIRCLE:this.drawCircle(e)}},t.prototype.drawFeature=function(e,n){var i=n.getGeometryFunction()(e);!i||!Cc(this.extent_,i.getExtent())||(this.setStyle(n),this.drawGeometry(i))},t.prototype.drawGeometryCollection=function(e){for(var n=e.getGeometriesArray(),i=0,o=n.length;i<o;++i)this.drawGeometry(n[i])},t.prototype.drawPoint=function(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var n=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(n,0,n.length,i),""!==this.text_&&this.drawText_(n,0,n.length,i)},t.prototype.drawMultiPoint=function(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var n=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(n,0,n.length,i),""!==this.text_&&this.drawText_(n,0,n.length,i)},t.prototype.drawLineString=function(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Cc(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var n=this.context_,i=e.getFlatCoordinates();n.beginPath(),this.moveToLineTo_(i,0,i.length,e.getStride(),!1),n.stroke()}if(""!==this.text_){var o=e.getFlatMidpoint();this.drawText_(o,0,2,2)}}},t.prototype.drawMultiLineString=function(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var n=e.getExtent();if(Cc(this.extent_,n)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var i=this.context_,o=e.getFlatCoordinates(),u=0,m=e.getEnds(),b=e.getStride();i.beginPath();for(var T=0,F=m.length;T<F;++T)u=this.moveToLineTo_(o,u,m[T],b,!1);i.stroke()}if(""!==this.text_){var V=e.getFlatMidpoints();this.drawText_(V,0,V.length,2)}}},t.prototype.drawPolygon=function(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Cc(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var n=this.context_;n.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&n.fill(),this.strokeState_&&n.stroke()}if(""!==this.text_){var i=e.getFlatInteriorPoint();this.drawText_(i,0,2,2)}}},t.prototype.drawMultiPolygon=function(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Cc(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var n=this.context_,i=e.getOrientedFlatCoordinates(),o=0,u=e.getEndss(),m=e.getStride();n.beginPath();for(var b=0,T=u.length;b<T;++b)o=this.drawRings_(i,o,u[b],m);this.fillState_&&n.fill(),this.strokeState_&&n.stroke()}if(""!==this.text_){var V=e.getFlatInteriorPoints();this.drawText_(V,0,V.length,2)}}},t.prototype.setContextFillState_=function(e){var n=this.context_,i=this.contextFillState_;i?i.fillStyle!=e.fillStyle&&(i.fillStyle=e.fillStyle,n.fillStyle=e.fillStyle):(n.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})},t.prototype.setContextStrokeState_=function(e){var n=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=e.lineCap&&(i.lineCap=e.lineCap,n.lineCap=e.lineCap),n.setLineDash&&(i_(i.lineDash,e.lineDash)||n.setLineDash(i.lineDash=e.lineDash),i.lineDashOffset!=e.lineDashOffset&&(i.lineDashOffset=e.lineDashOffset,n.lineDashOffset=e.lineDashOffset)),i.lineJoin!=e.lineJoin&&(i.lineJoin=e.lineJoin,n.lineJoin=e.lineJoin),i.lineWidth!=e.lineWidth&&(i.lineWidth=e.lineWidth,n.lineWidth=e.lineWidth),i.miterLimit!=e.miterLimit&&(i.miterLimit=e.miterLimit,n.miterLimit=e.miterLimit),i.strokeStyle!=e.strokeStyle&&(i.strokeStyle=e.strokeStyle,n.strokeStyle=e.strokeStyle)):(n.lineCap=e.lineCap,n.setLineDash&&(n.setLineDash(e.lineDash),n.lineDashOffset=e.lineDashOffset),n.lineJoin=e.lineJoin,n.lineWidth=e.lineWidth,n.miterLimit=e.miterLimit,n.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})},t.prototype.setContextTextState_=function(e){var n=this.context_,i=this.contextTextState_,o=e.textAlign?e.textAlign:v1;i?(i.font!=e.font&&(i.font=e.font,n.font=e.font),i.textAlign!=o&&(i.textAlign=o,n.textAlign=o),i.textBaseline!=e.textBaseline&&(i.textBaseline=e.textBaseline,n.textBaseline=e.textBaseline)):(n.font=e.font,n.textAlign=o,n.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:o,textBaseline:e.textBaseline})},t.prototype.setFillStrokeStyle=function(e,n){var i=this;if(e){var o=e.getColor();this.fillState_={fillStyle:fg(o||iy)}}else this.fillState_=null;if(n){var u=n.getColor(),m=n.getLineCap(),b=n.getLineDash(),T=n.getLineDashOffset(),F=n.getLineJoin(),V=n.getWidth(),H=n.getMiterLimit(),J=b||f1;this.strokeState_={lineCap:void 0!==m?m:Sw,lineDash:1===this.pixelRatio_?J:J.map(function(ne){return ne*i.pixelRatio_}),lineDashOffset:(T||0)*this.pixelRatio_,lineJoin:void 0!==F?F:J0,lineWidth:(void 0!==V?V:1)*this.pixelRatio_,miterLimit:void 0!==H?H:10,strokeStyle:fg(u||y1)}}else this.strokeState_=null},t.prototype.setImageStyle=function(e){var n;if(e&&(n=e.getSize())){var i=e.getAnchor(),o=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=i[0]*this.pixelRatio_,this.imageAnchorY_=i[1]*this.pixelRatio_,this.imageHeight_=n[1]*this.pixelRatio_,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=o[0],this.imageOriginY_=o[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation(),this.imageScale_=e.getScaleArray(),this.imageWidth_=n[0]*this.pixelRatio_}else this.image_=null},t.prototype.setTextStyle=function(e){if(e){var n=e.getFill();if(n){var i=n.getColor();this.textFillState_={fillStyle:fg(i||iy)}}else this.textFillState_=null;var o=e.getStroke();if(o){var u=o.getColor(),m=o.getLineCap(),b=o.getLineDash(),T=o.getLineDashOffset(),F=o.getLineJoin(),V=o.getWidth(),H=o.getMiterLimit();this.textStrokeState_={lineCap:void 0!==m?m:Sw,lineDash:b||f1,lineDashOffset:T||0,lineJoin:void 0!==F?F:J0,lineWidth:void 0!==V?V:1,miterLimit:void 0!==H?H:10,strokeStyle:fg(u||y1)}}else this.textStrokeState_=null;var J=e.getFont(),ne=e.getOffsetX(),we=e.getOffsetY(),Re=e.getRotateWithView(),qe=e.getRotation(),Ne=e.getScaleArray(),$e=e.getText(),tt=e.getTextAlign(),bt=e.getTextBaseline();this.textState_={font:void 0!==J?J:fP,textAlign:void 0!==tt?tt:v1,textBaseline:void 0!==bt?bt:Tw},this.text_=void 0!==$e?$e:"",this.textOffsetX_=void 0!==ne?this.pixelRatio_*ne:0,this.textOffsetY_=void 0!==we?this.pixelRatio_*we:0,this.textRotateWithView_=void 0!==Re&&Re,this.textRotation_=void 0!==qe?qe:0,this.textScale_=[this.pixelRatio_*Ne[0],this.pixelRatio_*Ne[1]]}else this.text_=""},t}(wP);const _G=vG;var xG=function(){function r(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}return r.prototype.clear=function(){this.cache_={},this.cacheSize_=0},r.prototype.canExpireCache=function(){return this.cacheSize_>this.maxCacheSize_},r.prototype.expire=function(){if(this.canExpireCache()){var t=0;for(var e in this.cache_)0==(3&t++)&&!this.cache_[e].hasListener()&&(delete this.cache_[e],--this.cacheSize_)}},r.prototype.get=function(t,e,n){var i=MP(t,e,n);return i in this.cache_?this.cache_[i]:null},r.prototype.set=function(t,e,n,i){var o=MP(t,e,n);this.cache_[o]=i,++this.cacheSize_},r.prototype.setSize=function(t){this.maxCacheSize_=t,this.expire()},r}();function MP(r,t,e){return t+":"+r+":"+(e?aP(e):"null")}var Pw=new xG,bG=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),wG=function(r){function t(e,n,i,o,u,m){var b=r.call(this,e,n,i,0)||this;return b.src_=o,b.image_=new Image,null!==u&&(b.image_.crossOrigin=u),b.unlisten_=null,b.state=0,b.imageLoadFunction_=m,b}return bG(t,r),t.prototype.getImage=function(){return this.image_},t.prototype.handleImageError_=function(){this.state=3,this.unlistenImage_(),this.changed()},t.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=mh(this.extent)/this.image_.height),this.state=2,this.unlistenImage_(),this.changed()},t.prototype.load=function(){(0==this.state||3==this.state)&&(this.state=1,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=iT(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},t.prototype.setImage=function(e){this.image_=e,this.resolution=mh(this.extent)/this.image_.height},t.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},t}(kD);function iT(r,t,e){var n=r;if(n.src&&uU){var i=n.decode(),o=!0;return i.then(function(){o&&t()}).catch(function(b){o&&("EncodingError"===b.name&&"Invalid image type."===b.message?t():e())}),function(){o=!1}}var m=[Jb(n,"load",t),Jb(n,"error",e)];return function(){m.forEach(il)}}const AP=wG;var CG=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),w1=null,EG=function(r){function t(e,n,i,o,u,m){var b=r.call(this)||this;return b.hitDetectionImage_=null,b.image_=e||new Image,null!==o&&(b.image_.crossOrigin=o),b.canvas_={},b.color_=m,b.unlisten_=null,b.imageState_=u,b.size_=i,b.src_=n,b}return CG(t,r),t.prototype.isTainted_=function(){if(void 0===this.tainted_&&2===this.imageState_){w1||(w1=vd(1,1)),w1.drawImage(this.image_,0,0);try{w1.getImageData(0,0,1,1),this.tainted_=!1}catch(e){w1=null,this.tainted_=!0}}return!0===this.tainted_},t.prototype.dispatchChangeEvent_=function(){this.dispatchEvent("change")},t.prototype.handleImageError_=function(){this.imageState_=3,this.unlistenImage_(),this.dispatchChangeEvent_()},t.prototype.handleImageLoad_=function(){this.imageState_=2,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()},t.prototype.getImage=function(e){return this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_},t.prototype.getPixelRatio=function(e){return this.replaceColor_(e),this.canvas_[e]?e:1},t.prototype.getImageState=function(){return this.imageState_},t.prototype.getHitDetectionImage=function(){if(!this.hitDetectionImage_)if(this.isTainted_()){var e=this.size_[0],n=this.size_[1],i=vd(e,n);i.fillRect(0,0,e,n),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},t.prototype.getSize=function(){return this.size_},t.prototype.getSrc=function(){return this.src_},t.prototype.load=function(){if(0==this.imageState_){this.imageState_=1;try{this.image_.src=this.src_}catch(e){this.handleImageError_()}this.unlisten_=iT(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},t.prototype.replaceColor_=function(e){if(this.color_&&!this.canvas_[e]&&2===this.imageState_){var n=document.createElement("canvas");this.canvas_[e]=n,n.width=Math.ceil(this.image_.width*e),n.height=Math.ceil(this.image_.height*e);var i=n.getContext("2d");if(i.scale(e,e),i.drawImage(this.image_,0,0),i.globalCompositeOperation="multiply","multiply"===i.globalCompositeOperation||this.isTainted_())i.fillStyle=aP(this.color_),i.fillRect(0,0,n.width/e,n.height/e),i.globalCompositeOperation="destination-in",i.drawImage(this.image_,0,0);else{for(var o=i.getImageData(0,0,n.width,n.height),u=o.data,m=this.color_[0]/255,b=this.color_[1]/255,T=this.color_[2]/255,F=this.color_[3],V=0,H=u.length;V<H;V+=4)u[V]*=m,u[V+1]*=b,u[V+2]*=T,u[V+3]*=F;i.putImageData(o,0,0)}}},t.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},t}(U0),TG=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),IG=function(r){function t(e){var n=this,i=e||{};(n=r.call(this,{opacity:void 0!==i.opacity?i.opacity:1,rotation:void 0!==i.rotation?i.rotation:0,scale:void 0!==i.scale?i.scale:1,displacement:void 0!==i.displacement?i.displacement:[0,0],rotateWithView:void 0!==i.rotateWithView&&i.rotateWithView})||this).anchor_=void 0!==i.anchor?i.anchor:[.5,.5],n.normalizedAnchor_=null,n.anchorOrigin_=void 0!==i.anchorOrigin?i.anchorOrigin:"top-left",n.anchorXUnits_=void 0!==i.anchorXUnits?i.anchorXUnits:"fraction",n.anchorYUnits_=void 0!==i.anchorYUnits?i.anchorYUnits:"fraction",n.crossOrigin_=void 0!==i.crossOrigin?i.crossOrigin:null;var T=void 0!==i.img?i.img:null,F=void 0!==i.imgSize?i.imgSize:null,V=i.src;bo(!(void 0!==V&&T),4),bo(!T||T&&F,5),(void 0===V||0===V.length)&&T&&(V=T.src||Si(T)),bo(void 0!==V&&V.length>0,6);var H=void 0!==i.src?0:2;return n.color_=void 0!==i.color?lP(i.color):null,n.iconImage_=function(r,t,e,n,i,o){var u=Pw.get(t,n,o);return u||(u=new EG(r,t,e,n,i,o),Pw.set(t,n,o,u)),u}(T,V,F,n.crossOrigin_,H,n.color_),n.offset_=void 0!==i.offset?i.offset:[0,0],n.offsetOrigin_=void 0!==i.offsetOrigin?i.offsetOrigin:"top-left",n.origin_=null,n.size_=void 0!==i.size?i.size:null,n}return TG(t,r),t.prototype.clone=function(){var e=this.getScale();return new t({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:null!==this.size_?this.size_.slice():void 0,opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},t.prototype.getAnchor=function(){if(this.normalizedAnchor_)return this.normalizedAnchor_;var e=this.anchor_,n=this.getSize();if("fraction"==this.anchorXUnits_||"fraction"==this.anchorYUnits_){if(!n)return null;e=this.anchor_.slice(),"fraction"==this.anchorXUnits_&&(e[0]*=n[0]),"fraction"==this.anchorYUnits_&&(e[1]*=n[1])}if("top-left"!=this.anchorOrigin_){if(!n)return null;e===this.anchor_&&(e=this.anchor_.slice()),("top-right"==this.anchorOrigin_||"bottom-right"==this.anchorOrigin_)&&(e[0]=-e[0]+n[0]),("bottom-left"==this.anchorOrigin_||"bottom-right"==this.anchorOrigin_)&&(e[1]=-e[1]+n[1])}var i=this.getDisplacement();return e[0]-=i[0],e[1]+=i[1],this.normalizedAnchor_=e,this.normalizedAnchor_},t.prototype.setAnchor=function(e){this.anchor_=e,this.normalizedAnchor_=null},t.prototype.getColor=function(){return this.color_},t.prototype.getImage=function(e){return this.iconImage_.getImage(e)},t.prototype.getPixelRatio=function(e){return this.iconImage_.getPixelRatio(e)},t.prototype.getImageSize=function(){return this.iconImage_.getSize()},t.prototype.getImageState=function(){return this.iconImage_.getImageState()},t.prototype.getHitDetectionImage=function(){return this.iconImage_.getHitDetectionImage()},t.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var e=this.offset_;if("top-left"!=this.offsetOrigin_){var n=this.getSize(),i=this.iconImage_.getSize();if(!n||!i)return null;e=e.slice(),("top-right"==this.offsetOrigin_||"bottom-right"==this.offsetOrigin_)&&(e[0]=i[0]-n[0]-e[0]),("bottom-left"==this.offsetOrigin_||"bottom-right"==this.offsetOrigin_)&&(e[1]=i[1]-n[1]-e[1])}return this.origin_=e,this.origin_},t.prototype.getSrc=function(){return this.iconImage_.getSrc()},t.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},t.prototype.listenImageChange=function(e){this.iconImage_.addEventListener("change",e)},t.prototype.load=function(){this.iconImage_.load()},t.prototype.unlistenImageChange=function(e){this.iconImage_.removeEventListener("change",e)},t}(rP);const C1=IG;var tf=.5;function DP(r,t,e,n,i,o,u){var T=vd(r[0]*tf,r[1]*tf);T.imageSmoothingEnabled=!1;for(var F=T.canvas,V=new _G(T,tf,i,null,u),H=e.length,J=Math.floor(16777215/H),ne={},we=1;we<=H;++we){var Re=e[we-1],qe=Re.getStyleFunction()||n;if(n){var Ne=qe(Re,o);if(Ne){Array.isArray(Ne)||(Ne=[Ne]);for(var tt="#"+("000000"+(we*J).toString(16)).slice(-6),bt=0,dn=Ne.length;bt<dn;++bt){var Kt=Ne[bt],vn=Kt.getGeometryFunction()(Re);if(vn&&Cc(i,vn.getExtent())){var Bt=Kt.clone(),Dn=Bt.getFill();Dn&&Dn.setColor(tt);var un=Bt.getStroke();un&&(un.setColor(tt),un.setLineDash(null)),Bt.setText(void 0);var Fn=Kt.getImage();if(Fn&&0!==Fn.getOpacity()){var kr=Fn.getImageSize();if(!kr)continue;var Jr=vd(kr[0],kr[1],void 0,{alpha:!1}),Ur=Jr.canvas;Jr.fillStyle=tt,Jr.fillRect(0,0,Ur.width,Ur.height),Bt.setImage(new C1({img:Ur,imgSize:kr,anchor:Fn.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:Fn.getOrigin(),opacity:1,size:Fn.getSize(),scale:Fn.getScale(),rotation:Fn.getRotation(),rotateWithView:Fn.getRotateWithView()}))}var Mr=Bt.getZIndex()||0;(_n=ne[Mr])||(ne[Mr]=_n={},_n[$t.POLYGON]=[],_n[$t.CIRCLE]=[],_n[$t.LINE_STRING]=[],_n[$t.POINT]=[]),_n[vn.getType().replace("Multi","")].push(vn,Bt)}}}}}for(var Qi=Object.keys(ne).map(Number).sort(r_),go=(we=0,Qi.length);we<go;++we){var _n=ne[Qi[we]];for(var Co in _n){var as=_n[Co];for(bt=0,dn=as.length;bt<dn;bt+=2){V.setStyle(as[bt+1]);for(var En=0,ma=t.length;En<ma;++En)V.setTransform(t[En]),V.drawGeometry(as[bt])}}}return T.getImageData(0,0,F.width,F.height)}function kP(r,t,e){var n=[];if(e){var i=Math.floor(Math.round(r[0])*tf),o=Math.floor(Math.round(r[1])*tf),u=4*(Wc(i,0,e.width-1)+Wc(o,0,e.height-1)*e.width),F=e.data[u+2]+256*(e.data[u+1]+256*e.data[u]),V=Math.floor(16777215/t.length);F&&F%V==0&&n.push(t[F/V-1])}return n}var PP={Point:function(r,t,e,n,i){var m,o=e.getImage(),u=e.getText();if(i&&(r=i,m=o&&u&&u.getText()?{}:void 0),o){if(2!=o.getImageState())return;var b=r.getBuilder(e.getZIndex(),"Image");b.setImageStyle(o,m),b.drawPoint(t,n)}if(u&&u.getText()){var T=r.getBuilder(e.getZIndex(),"Text");T.setTextStyle(u,m),T.drawText(t,n)}},LineString:function(r,t,e,n,i){var o=e.getStroke();if(o){var u=r.getBuilder(e.getZIndex(),"LineString");u.setFillStrokeStyle(null,o),u.drawLineString(t,n)}var m=e.getText();if(m&&m.getText()){var b=(i||r).getBuilder(e.getZIndex(),"Text");b.setTextStyle(m),b.drawText(t,n)}},Polygon:function(r,t,e,n,i){var o=e.getFill(),u=e.getStroke();if(o||u){var m=r.getBuilder(e.getZIndex(),"Polygon");m.setFillStrokeStyle(o,u),m.drawPolygon(t,n)}var b=e.getText();if(b&&b.getText()){var T=(i||r).getBuilder(e.getZIndex(),"Text");T.setTextStyle(b),T.drawText(t,n)}},MultiPoint:function(r,t,e,n,i){var m,o=e.getImage(),u=e.getText();if(i&&(r=i,m=o&&u&&u.getText()?{}:void 0),o){if(2!=o.getImageState())return;var b=r.getBuilder(e.getZIndex(),"Image");b.setImageStyle(o,m),b.drawMultiPoint(t,n)}if(u&&u.getText()){var T=(i||r).getBuilder(e.getZIndex(),"Text");T.setTextStyle(u,m),T.drawText(t,n)}},MultiLineString:function(r,t,e,n,i){var o=e.getStroke();if(o){var u=r.getBuilder(e.getZIndex(),"LineString");u.setFillStrokeStyle(null,o),u.drawMultiLineString(t,n)}var m=e.getText();if(m&&m.getText()){var b=(i||r).getBuilder(e.getZIndex(),"Text");b.setTextStyle(m),b.drawText(t,n)}},MultiPolygon:function(r,t,e,n,i){var o=e.getFill(),u=e.getStroke();if(u||o){var m=r.getBuilder(e.getZIndex(),"Polygon");m.setFillStrokeStyle(o,u),m.drawMultiPolygon(t,n)}var b=e.getText();if(b&&b.getText()){var T=(i||r).getBuilder(e.getZIndex(),"Text");T.setTextStyle(b),T.drawText(t,n)}},GeometryCollection:function(r,t,e,n,i){var u,m,o=t.getGeometriesArray();for(u=0,m=o.length;u<m;++u)(0,PP[o[u].getType()])(r,o[u],e,n,i)},Circle:function(r,t,e,n,i){var o=e.getFill(),u=e.getStroke();if(o||u){var m=r.getBuilder(e.getZIndex(),"Circle");m.setFillStrokeStyle(o,u),m.drawCircle(t,n)}var b=e.getText();if(b&&b.getText()){var T=(i||r).getBuilder(e.getZIndex(),"Text");T.setTextStyle(b),T.drawText(t,n)}}};function AG(r,t){return parseInt(Si(r),10)-parseInt(Si(t),10)}function RP(r,t){var e=oT(r,t);return e*e}function oT(r,t){return.5*r/t}function Rw(r,t,e,n,i,o,u){var m=!1,b=e.getImage();if(b){var T=b.getImageState();2==T||3==T?b.unlistenImageChange(i):(0==T&&b.load(),T=b.getImageState(),b.listenImageChange(i),m=!0)}return function(r,t,e,n,i,o){var u=e.getGeometryFunction()(t);if(u){var m=u.simplifyTransformed(n,i);e.getRenderer()?OP(r,m,e,t):(0,PP[m.getType()])(r,m,e,t,o)}}(r,t,e,n,o,u),m}function OP(r,t,e,n){if(t.getType()!=$t.GEOMETRY_COLLECTION)r.getBuilder(e.getZIndex(),"Default").drawCustom(t,n,e.getRenderer(),e.getHitDetectionRenderer());else for(var i=t.getGeometries(),o=0,u=i.length;o<u;++o)OP(r,i[o],e,n)}var BG=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),jG=function(r){function t(e){var n=r.call(this,e)||this;return n.boundHandleStyleImageChange_=n.handleStyleImageChange_.bind(n),n.dirty_=!1,n.hitDetectionImageData_=null,n.renderedFeatures_=null,n.renderedRevision_=-1,n.renderedResolution_=NaN,n.renderedExtent_=[1/0,1/0,-1/0,-1/0],n.wrappedRenderedExtent_=[1/0,1/0,-1/0,-1/0],n.renderedCenter_=null,n.renderedProjection_=null,n.renderedRenderOrder_=null,n.replayGroup_=null,n.replayGroupChanged=!0,n.declutterExecutorGroup=null,n.clipping=!0,n}return BG(t,r),t.prototype.useContainer=function(e,n,i){i<1&&(e=null),r.prototype.useContainer.call(this,e,n,i)},t.prototype.renderWorlds=function(e,n,i){var o=n.extent,u=n.viewState,m=u.center,b=u.resolution,T=u.projection,F=u.rotation,V=T.getExtent(),H=this.getLayer().getSource(),J=n.pixelRatio,ne=n.viewHints,we=!(ne[0]||ne[1]),Re=this.context,qe=Math.round(n.size[0]*J),Ne=Math.round(n.size[1]*J),$e=H.getWrapX()&&T.canWrapX(),tt=$e?Xs(V):null,bt=$e?Math.ceil((o[2]-V[2])/tt)+1:1,dn=$e?Math.floor((o[0]-V[0])/tt):0;do{var Kt=this.getRenderTransform(m,b,F,J,qe,Ne,dn*tt);e.execute(Re,1,Kt,F,we,void 0,i)}while(++dn<bt)},t.prototype.renderDeclutter=function(e){this.declutterExecutorGroup&&this.renderWorlds(this.declutterExecutorGroup,e,e.declutterTree)},t.prototype.renderFrame=function(e,n){var i=e.pixelRatio,o=e.layerStatesArray[e.layerIndex];(function(r,t,e){c1(r,t,0,0,e,0,0)})(this.pixelTransform,1/i,1/i),h1(this.inversePixelTransform,this.pixelTransform);var u=yw(this.pixelTransform);this.useContainer(n,u,o.opacity);var m=this.context,b=m.canvas,T=this.replayGroup_,F=this.declutterExecutorGroup;if((!T||T.isEmpty())&&(!F||F.isEmpty()))return null;var V=Math.round(e.size[0]*i),H=Math.round(e.size[1]*i);b.width!=V||b.height!=H?(b.width=V,b.height=H,b.style.transform!==u&&(b.style.transform=u)):this.containerReused||m.clearRect(0,0,V,H),this.preRender(m,e);var J=e.viewState,we=!1,Re=!0;if(o.extent&&this.clipping){var qe=ug(o.extent);(we=(Re=Cc(qe,e.extent))&&!ag(qe,e.extent))&&this.clipUnrotated(m,e,qe)}Re&&this.renderWorlds(T,e),we&&m.restore(),this.postRender(m,e);var Ne=XS(o.opacity),$e=this.container;return Ne!==$e.style.opacity&&($e.style.opacity=Ne),this.renderedRotation_!==J.rotation&&(this.renderedRotation_=J.rotation,this.hitDetectionImageData_=null),this.container},t.prototype.getFeatures=function(e){return new Promise(function(n){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){var i=[this.context.canvas.width,this.context.canvas.height];$c(this.pixelTransform,i);var o=this.renderedCenter_,u=this.renderedResolution_,m=this.renderedRotation_,b=this.renderedProjection_,T=this.wrappedRenderedExtent_,F=this.getLayer(),V=[],H=i[0]*tf,J=i[1]*tf;V.push(this.getRenderTransform(o,u,m,tf,H,J,0).slice());var ne=F.getSource(),we=b.getExtent();if(ne.getWrapX()&&b.canWrapX()&&!ag(we,T)){for(var Re=T[0],qe=Xs(we),Ne=0;Re<we[0];)--Ne,V.push(this.getRenderTransform(o,u,m,tf,H,J,qe*Ne).slice()),Re+=qe;for(Ne=0,Re=T[2];Re>we[2];)++Ne,V.push(this.getRenderTransform(o,u,m,tf,H,J,qe*Ne).slice()),Re-=qe}this.hitDetectionImageData_=DP(i,V,this.renderedFeatures_,F.getStyleFunction(),T,u,m)}n(kP(e,this.renderedFeatures_,this.hitDetectionImageData_))}.bind(this))},t.prototype.forEachFeatureAtCoordinate=function(e,n,i,o,u){var m=this;if(this.replayGroup_){var J,b=n.viewState.resolution,T=n.viewState.rotation,F=this.getLayer(),V={},H=function(we,Re,qe){var Ne=Si(we),$e=V[Ne];if($e){if(!0!==$e&&qe<$e.distanceSq){if(0===qe)return V[Ne]=!0,u.splice(u.lastIndexOf($e),1),o(we,F,Re);$e.geometry=Re,$e.distanceSq=qe}}else{if(0===qe)return V[Ne]=!0,o(we,F,Re);u.push(V[Ne]={feature:we,layer:F,geometry:Re,distanceSq:qe,callback:o})}},ne=[this.replayGroup_];return this.declutterExecutorGroup&&ne.push(this.declutterExecutorGroup),ne.some(function(we){return J=we.forEachFeatureAtCoordinate(e,b,T,i,H,we===m.declutterExecutorGroup?n.declutterTree.all().map(function(Re){return Re.value}):null)}),J}},t.prototype.handleFontsChanged=function(){var e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()},t.prototype.handleStyleImageChange_=function(e){this.renderIfReadyAndVisible()},t.prototype.prepareFrame=function(e){var n=this.getLayer(),i=n.getSource();if(!i)return!1;var o=e.viewHints[0],u=e.viewHints[1],m=n.getUpdateWhileAnimating(),b=n.getUpdateWhileInteracting();if(!this.dirty_&&!m&&o||!b&&u)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;var T=e.extent,F=e.viewState,V=F.projection,H=F.resolution,J=e.pixelRatio,ne=n.getRevision(),we=n.getRenderBuffer(),Re=n.getRenderOrder();void 0===Re&&(Re=AG);var qe=F.center.slice(),Ne=kf(T,we*H),$e=Ne.slice(),tt=[Ne.slice()],bt=V.getExtent();if(i.getWrapX()&&V.canWrapX()&&!ag(bt,e.extent)){var dn=Xs(bt),Kt=Math.max(Xs(Ne)/2,dn);Ne[0]=bt[0]-Kt,Ne[2]=bt[2]+Kt,AS(qe,V);var vn=function(r,t){var e=t.getExtent(),n=wm(r);if(t.canWrapX()&&(n[0]<e[0]||n[0]>=e[2])){var i=Xs(e),u=Math.floor((n[0]-e[0])/i)*i;r[0]-=u,r[2]-=u}return r}(tt[0],V);vn[0]<bt[0]&&vn[2]<bt[2]?tt.push([vn[0]+dn,vn[1],vn[2]+dn,vn[3]]):vn[0]>bt[0]&&vn[2]>bt[2]&&tt.push([vn[0]-dn,vn[1],vn[2]-dn,vn[3]])}if(!this.dirty_&&this.renderedResolution_==H&&this.renderedRevision_==ne&&this.renderedRenderOrder_==Re&&ag(this.wrappedRenderedExtent_,Ne))return i_(this.renderedExtent_,$e)||(this.hitDetectionImageData_=null,this.renderedExtent_=$e),this.renderedCenter_=qe,this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;var Dn,Bt=new Dw(oT(H,J),Ne,H,J);this.getLayer().getDeclutter()&&(Dn=new Dw(oT(H,J),Ne,H,J));var Fn,un=Pf();if(un){for(var kr=0,Jr=tt.length;kr<Jr;++kr){var Mr=hw(tt[kr]);i.loadFeatures(Mr,nU(H),un)}Fn=f_(un,V)}else for(kr=0,Jr=tt.length;kr<Jr;++kr)i.loadFeatures(tt[kr],H,V);var _n=RP(H,J),Qi=function(ma){var Mi,No=ma.getStyleFunction()||n.getStyleFunction();if(No&&(Mi=No(ma,H)),Mi){var ws=this.renderFeature(ma,_n,Mi,Bt,Fn,Dn);this.dirty_=this.dirty_||ws}}.bind(this),go=hw(Ne),Co=i.getFeaturesInExtent(go);for(Re&&Co.sort(Re),kr=0,Jr=Co.length;kr<Jr;++kr)Qi(Co[kr]);this.renderedFeatures_=Co;var as=Bt.finish(),En=new kw(Ne,H,J,i.getOverlaps(),as,n.getRenderBuffer());return Dn&&(this.declutterExecutorGroup=new kw(Ne,H,J,i.getOverlaps(),Dn.finish(),n.getRenderBuffer())),this.renderedResolution_=H,this.renderedRevision_=ne,this.renderedRenderOrder_=Re,this.renderedExtent_=$e,this.wrappedRenderedExtent_=Ne,this.renderedCenter_=qe,this.renderedProjection_=V,this.replayGroup_=En,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0},t.prototype.renderFeature=function(e,n,i,o,u,m){if(!i)return!1;var b=!1;if(Array.isArray(i))for(var T=0,F=i.length;T<F;++T)b=Rw(o,e,i[T],n,this.boundHandleStyleImageChange_,u,m)||b;else b=Rw(o,e,i,n,this.boundHandleStyleImageChange_,u,m);return b},t}(eT);const UG=jG;var VG=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),GG=function(r){function t(e){return r.call(this,e)||this}return VG(t,r),t.prototype.createRenderer=function(){return new UG(this)},t}(xP);const I_=GG;var LP=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),zP=[0,0,0,0],nx=[],sT=function(r){function t(e,n,i){var o=r.call(this,e)||this;return o.features=n,o.mapBrowserEvent=i,o}return LP(t,r),t}(_m),qG=function(r){function t(e){var i,n=r.call(this,e)||this;if(n.boundHandleFeatureChange_=n.handleFeatureChange_.bind(n),n.condition_=e.condition?e.condition:Ak,n.defaultDeleteCondition_=function(o){return function(r){var t=r.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey}(o)&&function(r){return r.type==oa.SINGLECLICK}(o)},n.deleteCondition_=e.deleteCondition?e.deleteCondition:n.defaultDeleteCondition_,n.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:CS,n.vertexFeature_=null,n.vertexSegments_=null,n.lastPixel_=[0,0],n.ignoreNextSingleClick_=!1,n.featuresBeingModified_=null,n.rBush_=new mw,n.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,n.snappedToVertex_=!1,n.changingFeature_=!1,n.dragSegments_=[],n.overlay_=new I_({source:new __({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:HG(),updateWhileAnimating:!0,updateWhileInteracting:!0}),n.SEGMENT_WRITERS_={Point:n.writePointGeometry_.bind(n),LineString:n.writeLineStringGeometry_.bind(n),LinearRing:n.writeLineStringGeometry_.bind(n),Polygon:n.writePolygonGeometry_.bind(n),MultiPoint:n.writeMultiPointGeometry_.bind(n),MultiLineString:n.writeMultiLineStringGeometry_.bind(n),MultiPolygon:n.writeMultiPolygonGeometry_.bind(n),Circle:n.writeCircleGeometry_.bind(n),GeometryCollection:n.writeGeometryCollectionGeometry_.bind(n)},n.source_=null,n.hitDetection_=null,e.features?i=e.features:e.source&&(n.source_=e.source,i=new _d(n.source_.getFeatures()),n.source_.addEventListener("addfeature",n.handleSourceAdd_.bind(n)),n.source_.addEventListener("removefeature",n.handleSourceRemove_.bind(n))),!i)throw new Error("The modify interaction requires features, a source or a layer");return e.hitDetection&&(n.hitDetection_=e.hitDetection),n.features_=i,n.features_.forEach(n.addFeature_.bind(n)),n.features_.addEventListener("add",n.handleFeatureAdd_.bind(n)),n.features_.addEventListener("remove",n.handleFeatureRemove_.bind(n)),n.lastPointerEvent_=null,n.delta_=[0,0],n.snapToPointer_=void 0===e.snapToPointer?!n.hitDetection_:e.snapToPointer,n}return LP(t,r),t.prototype.addFeature_=function(e){var n=e.getGeometry();if(n){var i=this.SEGMENT_WRITERS_[n.getType()];i&&i(e,n)}var o=this.getMap();o&&o.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,o),e.addEventListener("change",this.boundHandleFeatureChange_)},t.prototype.willModifyFeatures_=function(e,n){if(!this.featuresBeingModified_){this.featuresBeingModified_=new _d;for(var i=this.featuresBeingModified_.getArray(),o=0,u=n.length;o<u;++o)for(var m=n[o],b=0,T=m.length;b<T;++b){var F=m[b].feature;F&&-1===i.indexOf(F)&&this.featuresBeingModified_.push(F)}0===this.featuresBeingModified_.getLength()?this.featuresBeingModified_=null:this.dispatchEvent(new sT("modifystart",this.featuresBeingModified_,e))}},t.prototype.removeFeature_=function(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener("change",this.boundHandleFeatureChange_)},t.prototype.removeFeatureSegmentData_=function(e){var n=this.rBush_,i=[];n.forEach(function(b){e===b.feature&&i.push(b)});for(var o=i.length-1;o>=0;--o){for(var u=i[o],m=this.dragSegments_.length-1;m>=0;--m)this.dragSegments_[m][0]===u&&this.dragSegments_.splice(m,1);n.remove(u)}},t.prototype.setActive=function(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),r.prototype.setActive.call(this,e)},t.prototype.setMap=function(e){this.overlay_.setMap(e),r.prototype.setMap.call(this,e)},t.prototype.getOverlay=function(){return this.overlay_},t.prototype.handleSourceAdd_=function(e){e.feature&&this.features_.push(e.feature)},t.prototype.handleSourceRemove_=function(e){e.feature&&this.features_.remove(e.feature)},t.prototype.handleFeatureAdd_=function(e){this.addFeature_(e.element)},t.prototype.handleFeatureChange_=function(e){if(!this.changingFeature_){var n=e.target;this.removeFeature_(n),this.addFeature_(n)}},t.prototype.handleFeatureRemove_=function(e){this.removeFeature_(e.element)},t.prototype.writePointGeometry_=function(e,n){var i=n.getCoordinates(),o={feature:e,geometry:n,segment:[i,i]};this.rBush_.insert(n.getExtent(),o)},t.prototype.writeMultiPointGeometry_=function(e,n){for(var i=n.getCoordinates(),o=0,u=i.length;o<u;++o){var m=i[o],b={feature:e,geometry:n,depth:[o],index:o,segment:[m,m]};this.rBush_.insert(n.getExtent(),b)}},t.prototype.writeLineStringGeometry_=function(e,n){for(var i=n.getCoordinates(),o=0,u=i.length-1;o<u;++o){var m=i.slice(o,o+2),b={feature:e,geometry:n,index:o,segment:m};this.rBush_.insert(Hc(m),b)}},t.prototype.writeMultiLineStringGeometry_=function(e,n){for(var i=n.getCoordinates(),o=0,u=i.length;o<u;++o)for(var m=i[o],b=0,T=m.length-1;b<T;++b){var F=m.slice(b,b+2),V={feature:e,geometry:n,depth:[o],index:b,segment:F};this.rBush_.insert(Hc(F),V)}},t.prototype.writePolygonGeometry_=function(e,n){for(var i=n.getCoordinates(),o=0,u=i.length;o<u;++o)for(var m=i[o],b=0,T=m.length-1;b<T;++b){var F=m.slice(b,b+2),V={feature:e,geometry:n,depth:[o],index:b,segment:F};this.rBush_.insert(Hc(F),V)}},t.prototype.writeMultiPolygonGeometry_=function(e,n){for(var i=n.getCoordinates(),o=0,u=i.length;o<u;++o)for(var m=i[o],b=0,T=m.length;b<T;++b)for(var F=m[b],V=0,H=F.length-1;V<H;++V){var J=F.slice(V,V+2),ne={feature:e,geometry:n,depth:[b,o],index:V,segment:J};this.rBush_.insert(Hc(J),ne)}},t.prototype.writeCircleGeometry_=function(e,n){var i=n.getCenter(),o={feature:e,geometry:n,index:0,segment:[i,i]},u={feature:e,geometry:n,index:1,segment:[i,i]},m=[o,u];o.featureSegments=m,u.featureSegments=m,this.rBush_.insert(V0(i),o);var b=n,T=Pf();if(T&&this.getMap()){var F=this.getMap().getView().getProjection();b=qS(b=b.clone().transform(T,F)).transform(F,T)}this.rBush_.insert(b.getExtent(),u)},t.prototype.writeGeometryCollectionGeometry_=function(e,n){for(var i=n.getGeometriesArray(),o=0;o<i.length;++o){var u=i[o];(0,this.SEGMENT_WRITERS_[u.getType()])(e,u)}},t.prototype.createOrUpdateVertexFeature_=function(e,n,i){var o=this.vertexFeature_;return o?o.getGeometry().setCoordinates(e):(o=new dg(new Kp(e)),this.vertexFeature_=o,this.overlay_.getSource().addFeature(o)),o.set("features",n),o.set("geometries",i),o},t.prototype.handleEvent=function(e){return!e.originalEvent||(this.lastPointerEvent_=e,!e.map.getView().getInteracting()&&e.type==oa.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(n=!(e.type!=oa.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),e.type==oa.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),r.prototype.handleEvent.call(this,e)&&!n);var n},t.prototype.handleDragEvent=function(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);for(var n=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],o=[],u=0,m=this.dragSegments_.length;u<m;++u){var b=this.dragSegments_[u],T=b[0],F=T.feature;-1===i.indexOf(F)&&i.push(F);var V=T.geometry;-1===o.indexOf(V)&&o.push(V);for(var H=T.depth,J=void 0,ne=T.segment,we=b[1];n.length<V.getStride();)n.push(ne[we][n.length]);switch(V.getType()){case $t.POINT:J=n,ne[0]=n,ne[1]=n;break;case $t.MULTI_POINT:(J=V.getCoordinates())[T.index]=n,ne[0]=n,ne[1]=n;break;case $t.LINE_STRING:(J=V.getCoordinates())[T.index+we]=n,ne[we]=n;break;case $t.MULTI_LINE_STRING:case $t.POLYGON:(J=V.getCoordinates())[H[0]][T.index+we]=n,ne[we]=n;break;case $t.MULTI_POLYGON:(J=V.getCoordinates())[H[1]][H[0]][T.index+we]=n,ne[we]=n;break;case $t.CIRCLE:if(ne[0]=n,ne[1]=n,0===T.index)this.changingFeature_=!0,V.setCenter(n),this.changingFeature_=!1;else{this.changingFeature_=!0;var Re=e.map.getView().getProjection(),qe=MS(hl(V.getCenter()),hl(n)),Ne=Pf();if(Ne){var $e=V.clone().transform(Ne,Re);$e.setRadius(qe),qe=$e.transform(Re,Ne).getRadius()}V.setRadius(qe),this.changingFeature_=!1}}J&&this.setGeometryCoordinates_(V,J)}this.createOrUpdateVertexFeature_(n,i,o)},t.prototype.handleDownEvent=function(e){if(!this.condition_(e))return!1;var n=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,n),this.dragSegments_.length=0,this.featuresBeingModified_=null;var i=this.vertexFeature_;if(i){var o=e.map.getView().getProjection(),u=[],m=i.getGeometry().getCoordinates(),b=Hc([m]),T=this.rBush_.getInExtent(b),F={};T.sort(ZG);for(var V=0,H=T.length;V<H;++V){var J=T[V],ne=J.segment,we=Si(J.geometry),Re=J.depth;if(Re&&(we+="-"+Re.join("-")),F[we]||(F[we]=new Array(2)),J.geometry.getType()!==$t.CIRCLE||1!==J.index)if(!hg(ne[0],m)||F[we][0])if(!hg(ne[1],m)||F[we][1])Si(ne)in this.vertexSegments_&&!F[we][0]&&!F[we][1]&&this.insertVertexCondition_(e)&&u.push(J);else{if((J.geometry.getType()===$t.LINE_STRING||J.geometry.getType()===$t.MULTI_LINE_STRING)&&F[we][0]&&0===F[we][0].index)continue;this.dragSegments_.push([J,1]),F[we][1]=J}else this.dragSegments_.push([J,0]),F[we][0]=J;else hg(BP(n,J,o),m)&&!F[we][0]&&(this.dragSegments_.push([J,0]),F[we][0]=J)}u.length&&this.willModifyFeatures_(e,[u]);for(var Ne=u.length-1;Ne>=0;--Ne)this.insertVertex_(u[Ne],m)}return!!this.vertexFeature_},t.prototype.handleUpEvent=function(e){for(var n=this.dragSegments_.length-1;n>=0;--n){var i=this.dragSegments_[n][0],o=i.geometry;if(o.getType()===$t.CIRCLE){var u=o.getCenter(),m=i.featureSegments[0],b=i.featureSegments[1];m.segment[0]=u,m.segment[1]=u,b.segment[0]=u,b.segment[1]=u,this.rBush_.update(V0(u),m);var T=o,F=Pf();if(F){var V=e.map.getView().getProjection();T=qS(T=T.clone().transform(F,V)).transform(V,F)}this.rBush_.update(T.getExtent(),b)}else this.rBush_.update(Hc(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new sT("modifyend",this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1},t.prototype.handlePointerMove_=function(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)},t.prototype.handlePointerAtPixel_=function(e,n,i){var T,F,o=this,u=i||n.getCoordinateFromPixel(e),m=n.getView().getProjection();if(this.hitDetection_&&n.forEachFeatureAtPixel(e,function(Jr,Ur,Mr){if((Mr=Mr||Jr.getGeometry()).getType()===$t.POINT&&MD(o.features_.getArray(),Jr)){F=Mr;var _n=Mr.getFlatCoordinates().slice(0,2);T=[{feature:Jr,geometry:Mr,segment:[_n,_n]}]}return!0},{layerFilter:"object"==typeof this.hitDetection_?function(Jr){return Jr===o.hitDetection_}:void 0}),!T){var ne=hw(kf(ug(V0(u,zP)),n.getView().getResolution()*this.pixelTolerance_,zP));T=this.rBush_.getInExtent(ne)}if(T&&T.length>0){var we=T.sort(function(Jr,Ur){return NP(u,Jr,m)-NP(u,Ur,m)})[0],Re=we.segment,qe=BP(u,we,m),Ne=n.getPixelFromCoordinate(qe),$e=MS(e,Ne);if(F||$e<=this.pixelTolerance_){var tt={};if(tt[Si(Re)]=!0,this.snapToPointer_||(this.delta_[0]=qe[0]-u[0],this.delta_[1]=qe[1]-u[1]),we.geometry.getType()===$t.CIRCLE&&1===we.index)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(qe,[we.feature],[we.geometry]);else{var bt=n.getPixelFromCoordinate(Re[0]),dn=n.getPixelFromCoordinate(Re[1]),Kt=pg(Ne,bt),vn=pg(Ne,dn);$e=Math.sqrt(Math.min(Kt,vn)),this.snappedToVertex_=$e<=this.pixelTolerance_,this.snappedToVertex_&&(qe=Kt>vn?Re[1]:Re[0]),this.createOrUpdateVertexFeature_(qe,[we.feature],[we.geometry]);var Bt={};Bt[Si(we.geometry)]=!0;for(var Dn=1,un=T.length;Dn<un;++Dn){var Fn=T[Dn].segment;if(!(hg(Re[0],Fn[0])&&hg(Re[1],Fn[1])||hg(Re[0],Fn[1])&&hg(Re[1],Fn[0])))break;var kr=Si(T[Dn].geometry);kr in Bt||(Bt[kr]=!0,tt[Si(Fn)]=!0)}}return void(this.vertexSegments_=tt)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},t.prototype.insertVertex_=function(e,n){for(var T,i=e.segment,o=e.feature,u=e.geometry,m=e.depth,b=e.index;n.length<u.getStride();)n.push(0);switch(u.getType()){case $t.MULTI_LINE_STRING:case $t.POLYGON:(T=u.getCoordinates())[m[0]].splice(b+1,0,n);break;case $t.MULTI_POLYGON:(T=u.getCoordinates())[m[1]][m[0]].splice(b+1,0,n);break;case $t.LINE_STRING:(T=u.getCoordinates()).splice(b+1,0,n);break;default:return}this.setGeometryCoordinates_(u,T);var F=this.rBush_;F.remove(e),this.updateSegmentIndices_(u,b,m,1);var V={segment:[i[0],n],feature:o,geometry:u,depth:m,index:b};F.insert(Hc(V.segment),V),this.dragSegments_.push([V,1]);var H={segment:[n,i[1]],feature:o,geometry:u,depth:m,index:b+1};F.insert(Hc(H.segment),H),this.dragSegments_.push([H,0]),this.ignoreNextSingleClick_=!0},t.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=oa.POINTERDRAG){var e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);var n=this.removeVertex_();return this.dispatchEvent(new sT("modifyend",this.featuresBeingModified_,e)),this.featuresBeingModified_=null,n}return!1},t.prototype.removeVertex_=function(){var o,u,m,b,T,F,V,H,J,ne,we,e=this.dragSegments_,n={},i=!1;for(T=e.length-1;T>=0;--T)we=Si((ne=(m=e[T])[0]).feature),ne.depth&&(we+="-"+ne.depth.join("-")),we in n||(n[we]={}),0===m[1]?(n[we].right=ne,n[we].index=ne.index):1==m[1]&&(n[we].left=ne,n[we].index=ne.index+1);for(we in n){switch(J=n[we].right,(H=(F=n[we].index)-1)<0&&(H=0),o=u=(b=(ne=void 0!==(V=n[we].left)?V:J).geometry).getCoordinates(),i=!1,b.getType()){case $t.MULTI_LINE_STRING:u[ne.depth[0]].length>2&&(u[ne.depth[0]].splice(F,1),i=!0);break;case $t.LINE_STRING:u.length>2&&(u.splice(F,1),i=!0);break;case $t.MULTI_POLYGON:o=o[ne.depth[1]];case $t.POLYGON:(o=o[ne.depth[0]]).length>4&&(F==o.length-1&&(F=0),o.splice(F,1),i=!0,0===F&&(o.pop(),o.push(o[0]),H=o.length-1))}if(i){this.setGeometryCoordinates_(b,u);var Re=[];if(void 0!==V&&(this.rBush_.remove(V),Re.push(V.segment[0])),void 0!==J&&(this.rBush_.remove(J),Re.push(J.segment[1])),void 0!==V&&void 0!==J){var qe={depth:ne.depth,feature:ne.feature,geometry:ne.geometry,index:H,segment:Re};this.rBush_.insert(Hc(qe.segment),qe)}this.updateSegmentIndices_(b,F,ne.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return i},t.prototype.setGeometryCoordinates_=function(e,n){this.changingFeature_=!0,e.setCoordinates(n),this.changingFeature_=!1},t.prototype.updateSegmentIndices_=function(e,n,i,o){this.rBush_.forEachInExtent(e.getExtent(),function(u){u.geometry===e&&(void 0===i||void 0===u.depth||i_(u.depth,i))&&u.index>n&&(u.index+=o)})},t}(Xy);function ZG(r,t){return r.index-t.index}function NP(r,t,e){var n=t.geometry;if(n.getType()===$t.CIRCLE){var i=n;if(1===t.index){var o=Pf();o&&(i=i.clone().transform(o,e));var u=pg(i.getCenter(),hl(r)),m=Math.sqrt(u)-i.getRadius();return m*m}}var b=hl(r);return nx[0]=hl(t.segment[0]),nx[1]=hl(t.segment[1]),Rk(b,nx)}function BP(r,t,e){var n=t.geometry;if(n.getType()===$t.CIRCLE&&1===t.index){var i=n,o=Pf();return o&&(i=i.clone().transform(o,e)),g_(i.getClosestPoint(hl(r)))}var u=hl(r);return nx[0]=hl(t.segment[0]),nx[1]=hl(t.segment[1]),g_(TS(u,nx))}function HG(){var r=yP();return function(t,e){return r[$t.POINT]}}const WG=qG;var $G=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}();function jP(r){return r.feature?r.feature:r.element?r.element:void 0}var rx=[],XG=function(r){function t(e){var n=this,i=e||{},o=i;return o.handleDownEvent||(o.handleDownEvent=qy),o.stopDown||(o.stopDown=o_),(n=r.call(this,o)||this).source_=i.source?i.source:null,n.vertex_=void 0===i.vertex||i.vertex,n.edge_=void 0===i.edge||i.edge,n.features_=i.features?i.features:null,n.featuresListenerKeys_=[],n.featureChangeListenerKeys_={},n.indexedFeaturesExtents_={},n.pendingFeatures_={},n.pixelTolerance_=void 0!==i.pixelTolerance?i.pixelTolerance:10,n.rBush_=new mw,n.SEGMENT_WRITERS_={Point:n.writePointGeometry_.bind(n),LineString:n.writeLineStringGeometry_.bind(n),LinearRing:n.writeLineStringGeometry_.bind(n),Polygon:n.writePolygonGeometry_.bind(n),MultiPoint:n.writeMultiPointGeometry_.bind(n),MultiLineString:n.writeMultiLineStringGeometry_.bind(n),MultiPolygon:n.writeMultiPolygonGeometry_.bind(n),GeometryCollection:n.writeGeometryCollectionGeometry_.bind(n),Circle:n.writeCircleGeometry_.bind(n)},n}return $G(t,r),t.prototype.addFeature=function(e,n){var i=void 0===n||n,o=Si(e),u=e.getGeometry();if(u){var m=this.SEGMENT_WRITERS_[u.getType()];m&&(this.indexedFeaturesExtents_[o]=u.getExtent([1/0,1/0,-1/0,-1/0]),m(e,u))}i&&(this.featureChangeListenerKeys_[o]=Zo(e,"change",this.handleFeatureChange_,this))},t.prototype.forEachFeatureAdd_=function(e){this.addFeature(e)},t.prototype.forEachFeatureRemove_=function(e){this.removeFeature(e)},t.prototype.getFeatures_=function(){var e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e},t.prototype.handleEvent=function(e){var n=this.snapTo(e.pixel,e.coordinate,e.map);return n.snapped&&(e.coordinate=n.vertex.slice(0,2),e.pixel=n.vertexPixel),r.prototype.handleEvent.call(this,e)},t.prototype.handleFeatureAdd_=function(e){var n=jP(e);this.addFeature(n)},t.prototype.handleFeatureRemove_=function(e){var n=jP(e);this.removeFeature(n)},t.prototype.handleFeatureChange_=function(e){var n=e.target;if(this.handlingDownUpSequence){var i=Si(n);i in this.pendingFeatures_||(this.pendingFeatures_[i]=n)}else this.updateFeature_(n)},t.prototype.handleUpEvent=function(e){var n=XE(this.pendingFeatures_);return n.length&&(n.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1},t.prototype.removeFeature=function(e,n){var i=void 0===n||n,o=Si(e),u=this.indexedFeaturesExtents_[o];if(u){var m=this.rBush_,b=[];m.forEachInExtent(u,function(F){e===F.feature&&b.push(F)});for(var T=b.length-1;T>=0;--T)m.remove(b[T])}i&&(il(this.featureChangeListenerKeys_[o]),delete this.featureChangeListenerKeys_[o])},t.prototype.setMap=function(e){var n=this.getMap(),i=this.featuresListenerKeys_,o=this.getFeatures_();n&&(i.forEach(il),i.length=0,o.forEach(this.forEachFeatureRemove_.bind(this))),r.prototype.setMap.call(this,e),e&&(this.features_?i.push(Zo(this.features_,"add",this.handleFeatureAdd_,this),Zo(this.features_,"remove",this.handleFeatureRemove_,this)):this.source_&&i.push(Zo(this.source_,"addfeature",this.handleFeatureAdd_,this),Zo(this.source_,"removefeature",this.handleFeatureRemove_,this)),o.forEach(this.forEachFeatureAdd_.bind(this)))},t.prototype.snapTo=function(e,n,i){var m=Hc([i.getCoordinateFromPixel([e[0]-this.pixelTolerance_,e[1]+this.pixelTolerance_]),i.getCoordinateFromPixel([e[0]+this.pixelTolerance_,e[1]-this.pixelTolerance_])]),b=this.rBush_.getInExtent(m);this.vertex_&&!this.edge_&&(b=b.filter(function(Fn){return Fn.feature.getGeometry().getType()!==$t.CIRCLE}));var T=!1,F=null,V=null;if(0===b.length)return{snapped:T,vertex:F,vertexPixel:V};for(var ne,H=i.getView().getProjection(),J=hl(n),we=1/0,Re=0;Re<b.length;++Re){var qe=b[Re];rx[0]=hl(qe.segment[0]),rx[1]=hl(qe.segment[1]);var Ne=Rk(J,rx);Ne<we&&(ne=qe,we=Ne)}var $e=ne.segment;if(this.vertex_&&!this.edge_){var tt=i.getPixelFromCoordinate($e[0]),bt=i.getPixelFromCoordinate($e[1]),dn=pg(e,tt),Kt=pg(e,bt);Math.sqrt(Math.min(dn,Kt))<=this.pixelTolerance_&&(T=!0,V=i.getPixelFromCoordinate(F=dn>Kt?$e[1]:$e[0]))}else if(this.edge_){var Bt=ne.feature.getGeometry().getType()===$t.CIRCLE;if(Bt){var Dn=ne.feature.getGeometry(),un=Pf();un&&(Dn=Dn.clone().transform(un,H)),F=g_(function(r,t){var e=t.getRadius(),n=t.getCenter(),i=n[0],o=n[1],b=r[0]-i,T=r[1]-o;0===b&&0===T&&(b=1);var F=Math.sqrt(b*b+T*T);return[i+e*b/F,o+e*T/F]}(J,Dn))}else rx[0]=hl($e[0]),rx[1]=hl($e[1]),F=g_(TS(J,rx));MS(e,V=i.getPixelFromCoordinate(F))<=this.pixelTolerance_&&(T=!0,this.vertex_&&!Bt)&&(tt=i.getPixelFromCoordinate($e[0]),bt=i.getPixelFromCoordinate($e[1]),dn=pg(V,tt),Kt=pg(V,bt),Math.sqrt(Math.min(dn,Kt))<=this.pixelTolerance_&&(V=i.getPixelFromCoordinate(F=dn>Kt?$e[1]:$e[0])))}return T&&(V=[Math.round(V[0]),Math.round(V[1])]),{snapped:T,vertex:F,vertexPixel:V}},t.prototype.updateFeature_=function(e){this.removeFeature(e,!1),this.addFeature(e,!1)},t.prototype.writeCircleGeometry_=function(e,n){var i=this.getMap().getView().getProjection(),o=n,u=Pf();u&&(o=o.clone().transform(u,i));var m=qS(o);u&&m.transform(i,u);for(var b=m.getCoordinates()[0],T=0,F=b.length-1;T<F;++T){var V=b.slice(T,T+2),H={feature:e,segment:V};this.rBush_.insert(Hc(V),H)}},t.prototype.writeGeometryCollectionGeometry_=function(e,n){for(var i=n.getGeometriesArray(),o=0;o<i.length;++o){var u=this.SEGMENT_WRITERS_[i[o].getType()];u&&u(e,i[o])}},t.prototype.writeLineStringGeometry_=function(e,n){for(var i=n.getCoordinates(),o=0,u=i.length-1;o<u;++o){var m=i.slice(o,o+2),b={feature:e,segment:m};this.rBush_.insert(Hc(m),b)}},t.prototype.writeMultiLineStringGeometry_=function(e,n){for(var i=n.getCoordinates(),o=0,u=i.length;o<u;++o)for(var m=i[o],b=0,T=m.length-1;b<T;++b){var F=m.slice(b,b+2),V={feature:e,segment:F};this.rBush_.insert(Hc(F),V)}},t.prototype.writeMultiPointGeometry_=function(e,n){for(var i=n.getCoordinates(),o=0,u=i.length;o<u;++o){var m=i[o],b={feature:e,segment:[m,m]};this.rBush_.insert(n.getExtent(),b)}},t.prototype.writeMultiPolygonGeometry_=function(e,n){for(var i=n.getCoordinates(),o=0,u=i.length;o<u;++o)for(var m=i[o],b=0,T=m.length;b<T;++b)for(var F=m[b],V=0,H=F.length-1;V<H;++V){var J=F.slice(V,V+2),ne={feature:e,segment:J};this.rBush_.insert(Hc(J),ne)}},t.prototype.writePointGeometry_=function(e,n){var i=n.getCoordinates(),o={feature:e,segment:[i,i]};this.rBush_.insert(n.getExtent(),o)},t.prototype.writePolygonGeometry_=function(e,n){for(var i=n.getCoordinates(),o=0,u=i.length;o<u;++o)for(var m=i[o],b=0,T=m.length-1;b<T;++b){var F=m.slice(b,b+2),V={feature:e,segment:F};this.rBush_.insert(Hc(F),V)}},t}(Xy);const YG=XG;var KG=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),JG=function(r){function t(e){var n=r.call(this)||this;return n.map_=e,n}return KG(t,r),t.prototype.dispatchRenderEvent=function(e,n){li()},t.prototype.calculateMatrices2D=function(e){var n=e.viewState,i=e.coordinateToPixelTransform,o=e.pixelToCoordinateTransform;ef(i,e.size[0]/2,e.size[1]/2,1/n.resolution,-1/n.resolution,-n.rotation,-n.center[0],-n.center[1]),h1(o,i)},t.prototype.forEachFeatureAtCoordinate=function(e,n,i,o,u,m,b,T){var F,V=n.viewState;function H(Ur,Mr,_n,Qi){return u.call(m,Mr,Ur?_n:null,Qi)}var J=V.projection,ne=AS(e.slice(),J),we=[[0,0]];if(J.canWrapX()&&o){var qe=Xs(J.getExtent());we.push([-qe,0],[qe,0])}for(var Ne=n.layerStatesArray,$e=Ne.length,tt=[],bt=[],dn=0;dn<we.length;dn++)for(var Kt=$e-1;Kt>=0;--Kt){var vn=Ne[Kt],Bt=vn.layer;if(Bt.hasRenderer()&&Cw(vn,V)&&b.call(T,Bt)){var Dn=Bt.getRenderer(),un=Bt.getSource();if(Dn&&un){var Fn=un.getWrapX()?ne:e,kr=H.bind(null,vn.managed);bt[0]=Fn[0]+we[dn][0],bt[1]=Fn[1]+we[dn][1],F=Dn.forEachFeatureAtCoordinate(bt,n,i,kr,tt)}if(F)return F}}if(0!==tt.length){var Jr=1/tt.length;return tt.forEach(function(Ur,Mr){return Ur.distanceSq+=Mr*Jr}),tt.sort(function(Ur,Mr){return Ur.distanceSq-Mr.distanceSq}),tt.some(function(Ur){return F=Ur.callback(Ur.feature,Ur.layer,Ur.geometry)}),F}},t.prototype.forEachLayerAtPixel=function(e,n,i,o,u){return li()},t.prototype.hasFeatureAtCoordinate=function(e,n,i,o,u,m){return void 0!==this.forEachFeatureAtCoordinate(e,n,i,o,qy,this,u,m)},t.prototype.getMap=function(){return this.map_},t.prototype.renderFrame=function(e){li()},t.prototype.scheduleExpireIconCache=function(e){Pw.canExpireCache()&&e.postRenderFunctions.push(QG)},t}(WE);function QG(r,t){Pw.expire()}const e8=JG;var t8=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),n8=function(r){function t(e){var n=r.call(this,e)||this;n.fontChangeListenerKey_=Zo(oy,"propertychange",e.redrawText.bind(e)),n.element_=document.createElement("div");var i=n.element_.style;i.position="absolute",i.width="100%",i.height="100%",i.zIndex="0",n.element_.className=d1+" ol-layers";var o=e.getViewport();return o.insertBefore(n.element_,o.firstChild||null),n.children_=[],n.renderedVisible_=!0,n}return t8(t,r),t.prototype.dispatchRenderEvent=function(e,n){var i=this.getMap();if(i.hasListener(e)){var o=new SP(e,void 0,n);i.dispatchEvent(o)}},t.prototype.disposeInternal=function(){il(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),r.prototype.disposeInternal.call(this)},t.prototype.renderFrame=function(e){if(e){this.calculateMatrices2D(e),this.dispatchRenderEvent("precompose",e);var n=e.layerStatesArray.sort(function(H,J){return H.zIndex-J.zIndex}),i=e.viewState;this.children_.length=0;for(var o=[],u=null,m=0,b=n.length;m<b;++m){var T=n[m];if(e.layerIndex=m,Cw(T,i)&&("ready"==T.sourceState||"undefined"==T.sourceState)){var F=T.layer,V=F.render(e,u);!V||(V!==u&&(this.children_.push(V),u=V),"getDeclutter"in F&&o.push(F))}}for(m=o.length-1;m>=0;--m)o[m].renderDeclutter(e);(function(r,t){for(var e=r.childNodes,n=0;;++n){var i=e[n],o=t[n];if(!i&&!o)break;if(i!==o){if(!i){r.appendChild(o);continue}if(!o){r.removeChild(i),--n;continue}r.insertBefore(o,i)}}})(this.element_,this.children_),this.dispatchRenderEvent("postcompose",e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}else this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1)},t.prototype.forEachLayerAtPixel=function(e,n,i,o,u){for(var m=n.viewState,b=n.layerStatesArray,F=b.length-1;F>=0;--F){var V=b[F],H=V.layer;if(H.hasRenderer()&&Cw(V,m)&&u(H)){var ne=H.getRenderer().getDataAtPixel(e,n,i);if(ne){var we=o(H,ne);if(we)return we}}}},t}(e8);const r8=n8;var i8=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),o8=function(r){function t(e){var n=this,i=e||{},o=$a({},i);delete o.layers;var u=i.layers;return(n=r.call(this,o)||this).layersListenerKeys_=[],n.listenerKeys_={},n.addChangeListener("layers",n.handleLayersChanged_),u?Array.isArray(u)?u=new _d(u.slice(),{unique:!0}):bo("function"==typeof u.getArray,43):u=new _d(void 0,{unique:!0}),n.setLayers(u),n}return i8(t,r),t.prototype.handleLayerChange_=function(){this.changed()},t.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(il),this.layersListenerKeys_.length=0;var e=this.getLayers();for(var n in this.layersListenerKeys_.push(Zo(e,"add",this.handleLayersAdd_,this),Zo(e,"remove",this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[n].forEach(il);t1(this.listenerKeys_);for(var i=e.getArray(),o=0,u=i.length;o<u;o++){var m=i[o];this.listenerKeys_[Si(m)]=[Zo(m,"propertychange",this.handleLayerChange_,this),Zo(m,"change",this.handleLayerChange_,this)]}this.changed()},t.prototype.handleLayersAdd_=function(e){var n=e.element;this.listenerKeys_[Si(n)]=[Zo(n,"propertychange",this.handleLayerChange_,this),Zo(n,"change",this.handleLayerChange_,this)],this.changed()},t.prototype.handleLayersRemove_=function(e){var i=Si(e.element);this.listenerKeys_[i].forEach(il),delete this.listenerKeys_[i],this.changed()},t.prototype.getLayers=function(){return this.get("layers")},t.prototype.setLayers=function(e){this.set("layers",e)},t.prototype.getLayersArray=function(e){var n=void 0!==e?e:[];return this.getLayers().forEach(function(i){i.getLayersArray(n)}),n},t.prototype.getLayerStatesArray=function(e){var n=void 0!==e?e:[],i=n.length;this.getLayers().forEach(function(F){F.getLayerStatesArray(n)});var o=this.getLayerState(),u=o.zIndex;!e&&void 0===o.zIndex&&(u=0);for(var m=i,b=n.length;m<b;m++){var T=n[m];T.opacity*=o.opacity,T.visible=T.visible&&o.visible,T.maxResolution=Math.min(T.maxResolution,o.maxResolution),T.minResolution=Math.max(T.minResolution,o.minResolution),T.minZoom=Math.max(T.minZoom,o.minZoom),T.maxZoom=Math.min(T.maxZoom,o.maxZoom),void 0!==o.extent&&(T.extent=void 0!==T.extent?sg(T.extent,o.extent):o.extent),void 0===T.zIndex&&(T.zIndex=u)}return n},t.prototype.getSourceState=function(){return"ready"},t}(nP);const a8=o8;var s8=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),l8=function(r){function t(e,n,i){var o=r.call(this,e)||this;return o.map=n,o.frameState=void 0!==i?i:null,o}return s8(t,r),t}(_m);const Ow=l8;var u8=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),c8=function(r){function t(e,n,i,o,u){var m=r.call(this,e,n,u)||this;return m.originalEvent=i,m.pixel_=null,m.coordinate_=null,m.dragging=void 0!==o&&o,m}return u8(t,r),Object.defineProperty(t.prototype,"pixel",{get:function(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_},set:function(e){this.pixel_=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"coordinate",{get:function(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_},set:function(e){this.coordinate_=e},enumerable:!1,configurable:!0}),t.prototype.preventDefault=function(){r.prototype.preventDefault.call(this),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()},t.prototype.stopPropagation=function(){r.prototype.stopPropagation.call(this),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()},t}(Ow);const ly=c8;var h8=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),p8=function(r){function t(e,n){var i=r.call(this,e)||this;i.map_=e,i.emulateClicks_=!1,i.dragging_=!1,i.dragListenerKeys_=[],i.moveTolerance_=void 0===n?1:n,i.down_=null;var o=i.map_.getViewport();return i.activePointers_=0,i.trackedTouches_={},i.element_=o,i.pointerdownListenerKey_=Zo(o,"pointerdown",i.handlePointerDown_,i),i.relayedListenerKey_=Zo(o,"pointermove",i.relayEvent_,i),i.boundHandleTouchMove_=i.handleTouchMove_.bind(i),i.element_.addEventListener("touchmove",i.boundHandleTouchMove_,!!HD&&{passive:!1}),i}return h8(t,r),t.prototype.emulateClick_=function(e){var n=new ly(oa.CLICK,this.map_,e);this.dispatchEvent(n),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,n=new ly(oa.DBLCLICK,this.map_,e),this.dispatchEvent(n)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;var i=new ly(oa.SINGLECLICK,this.map_,e);this.dispatchEvent(i)}.bind(this),250)},t.prototype.updateActivePointers_=function(e){var n=e;n.type==oa.POINTERUP||n.type==oa.POINTERCANCEL?delete this.trackedTouches_[n.pointerId]:n.type==oa.POINTERDOWN&&(this.trackedTouches_[n.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},t.prototype.handlePointerUp_=function(e){this.updateActivePointers_(e);var n=new ly(oa.POINTERUP,this.map_,e);this.dispatchEvent(n),this.emulateClicks_&&!n.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),0===this.activePointers_&&(this.dragListenerKeys_.forEach(il),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)},t.prototype.isMouseActionButton_=function(e){return 0===e.button},t.prototype.handlePointerDown_=function(e){this.emulateClicks_=0===this.activePointers_,this.updateActivePointers_(e);var n=new ly(oa.POINTERDOWN,this.map_,e);for(var i in this.dispatchEvent(n),this.down_={},e){var o=e[i];this.down_[i]="function"==typeof o?a_:o}if(0===this.dragListenerKeys_.length){var u=this.map_.getOwnerDocument();this.dragListenerKeys_.push(Zo(u,oa.POINTERMOVE,this.handlePointerMove_,this),Zo(u,oa.POINTERUP,this.handlePointerUp_,this),Zo(this.element_,oa.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==u&&this.dragListenerKeys_.push(Zo(this.element_.getRootNode(),oa.POINTERUP,this.handlePointerUp_,this))}},t.prototype.handlePointerMove_=function(e){if(this.isMoving_(e)){this.dragging_=!0;var n=new ly(oa.POINTERDRAG,this.map_,e,this.dragging_);this.dispatchEvent(n)}},t.prototype.relayEvent_=function(e){this.originalPointerMoveEvent_=e;var n=!(!this.down_||!this.isMoving_(e));this.dispatchEvent(new ly(e.type,this.map_,e,n))},t.prototype.handleTouchMove_=function(e){var n=this.originalPointerMoveEvent_;(!n||n.defaultPrevented)&&("boolean"!=typeof e.cancelable||!0===e.cancelable)&&e.preventDefault()},t.prototype.isMoving_=function(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_},t.prototype.disposeInternal=function(){this.relayedListenerKey_&&(il(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener("touchmove",this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(il(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(il),this.dragListenerKeys_.length=0,this.element_=null,r.prototype.disposeInternal.call(this)},t}(U0);const d8=p8;var Fw=1/0,f8=function(){function r(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}return r.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,t1(this.queuedElements_)},r.prototype.dequeue=function(){var t=this.elements_,e=this.priorities_,n=t[0];1==t.length?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));var i=this.keyFunction_(n);return delete this.queuedElements_[i],n},r.prototype.enqueue=function(t){bo(!(this.keyFunction_(t)in this.queuedElements_),31);var e=this.priorityFunction_(t);return e!=Fw&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)},r.prototype.getCount=function(){return this.elements_.length},r.prototype.getLeftChildIndex_=function(t){return 2*t+1},r.prototype.getRightChildIndex_=function(t){return 2*t+2},r.prototype.getParentIndex_=function(t){return t-1>>1},r.prototype.heapify_=function(){var t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)},r.prototype.isEmpty=function(){return 0===this.elements_.length},r.prototype.isKeyQueued=function(t){return t in this.queuedElements_},r.prototype.isQueued=function(t){return this.isKeyQueued(this.keyFunction_(t))},r.prototype.siftUp_=function(t){for(var e=this.elements_,n=this.priorities_,i=e.length,o=e[t],u=n[t],m=t;t<i>>1;){var b=this.getLeftChildIndex_(t),T=this.getRightChildIndex_(t),F=T<i&&n[T]<n[b]?T:b;e[t]=e[F],n[t]=n[F],t=F}e[t]=o,n[t]=u,this.siftDown_(m,t)},r.prototype.siftDown_=function(t,e){for(var n=this.elements_,i=this.priorities_,o=n[e],u=i[e];e>t;){var m=this.getParentIndex_(e);if(!(i[m]>u))break;n[e]=n[m],i[e]=i[m],e=m}n[e]=o,i[e]=u},r.prototype.reprioritize=function(){var u,m,b,t=this.priorityFunction_,e=this.elements_,n=this.priorities_,i=0,o=e.length;for(m=0;m<o;++m)(b=t(u=e[m]))==Fw?delete this.queuedElements_[this.keyFunction_(u)]:(n[i]=b,e[i++]=u);e.length=i,n.length=i,this.heapify_()},r}();const m8=f8;var g8=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),y8=function(r){function t(e,n){var i=r.call(this,function(o){return e.apply(null,o)},function(o){return o[0].getKey()})||this;return i.boundHandleTileChange_=i.handleTileChange.bind(i),i.tileChangeCallback_=n,i.tilesLoading_=0,i.tilesLoadingKeys_={},i}return g8(t,r),t.prototype.enqueue=function(e){var n=r.prototype.enqueue.call(this,e);return n&&e[0].addEventListener("change",this.boundHandleTileChange_),n},t.prototype.getTilesLoading=function(){return this.tilesLoading_},t.prototype.handleTileChange=function(e){var n=e.target,i=n.getState();if(2===i||3===i||4===i){n.removeEventListener("change",this.boundHandleTileChange_);var o=n.getKey();o in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[o],--this.tilesLoading_),this.tileChangeCallback_()}},t.prototype.loadMoreTiles=function(e,n){for(var u,m,i=0;this.tilesLoading_<e&&i<n&&this.getCount()>0;)m=(u=this.dequeue()[0]).getKey(),0===u.getState()&&!(m in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[m]=!0,++this.tilesLoading_,++i,u.load())},t}(m8);const v8=y8;function UP(r,t,e){return function(n,i,o,u,m){if(n){var b=t?0:o[0]*i,T=t?0:o[1]*i,F=m?m[0]:0,V=m?m[1]:0,H=r[0]+b/2+F,J=r[2]-b/2+F,ne=r[1]+T/2+V,we=r[3]-T/2+V;H>J&&(J=H=(J+H)/2),ne>we&&(we=ne=(we+ne)/2);var Re=Wc(n[0],H,J),qe=Wc(n[1],ne,we),Ne=30*i;return u&&e&&(Re+=-Ne*Math.log(1+Math.max(0,H-n[0])/Ne)+Ne*Math.log(1+Math.max(0,n[0]-J)/Ne),qe+=-Ne*Math.log(1+Math.max(0,ne-n[1])/Ne)+Ne*Math.log(1+Math.max(0,n[1]-we)/Ne)),[Re,qe]}}}function x8(r){return r}function uT(r,t,e,n){var i=Xs(t)/e[0],o=mh(t)/e[1];return n?Math.min(r,Math.max(i,o)):Math.min(r,Math.min(i,o))}function cT(r,t,e){var n=Math.min(r,t);return n*=Math.log(1+50*Math.max(0,r/t-1))/50+1,e&&(n=Math.max(n,e),n/=Math.log(1+50*Math.max(0,e/r-1))/50+1),Wc(n,e/2,2*t)}function VP(r,t,e,n,i){return function(o,u,m,b){if(void 0!==o){var T=n?uT(r,n,m,i):r;return(void 0===e||e)&&b?cT(o,T,t):Wc(o,t,T)}}}var C8=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),E8=function(r){function t(e){var n=r.call(this)||this,i=$a({},e);return n.hints_=[0,0],n.animations_=[],n.projection_=oS(i.projection,"EPSG:3857"),n.viewportSize_=[100,100],n.targetCenter_=null,n.nextCenter_=null,n.cancelAnchor_=void 0,i.center&&(i.center=hl(i.center)),i.extent&&(i.extent=ug(i.extent)),n.applyOptions_(i),n}return C8(t,r),t.prototype.applyOptions_=function(e){var i=function(r){var t,e,n,u=void 0!==r.minZoom?r.minZoom:0,m=void 0!==r.maxZoom?r.maxZoom:28,b=void 0!==r.zoomFactor?r.zoomFactor:2,T=void 0!==r.multiWorld&&r.multiWorld,F=void 0===r.smoothResolutionConstraint||r.smoothResolutionConstraint,V=void 0!==r.showFullExtent&&r.showFullExtent,H=oS(r.projection,"EPSG:3857"),J=H.getExtent(),ne=r.constrainOnlyCenter,we=r.extent;if(!T&&!we&&H.isGlobal()&&(ne=!1,we=J),void 0!==r.resolutions){var Re=r.resolutions;e=Re[u],n=void 0!==Re[m]?Re[m]:Re[Re.length-1],t=r.constrainResolution?function(r,t,e,n){return function(i,o,u,m){if(void 0!==i){var b=r[0],T=r[r.length-1],F=e?uT(b,e,u,n):b;if(m)return void 0===t||t?cT(i,F,T):Wc(i,T,F);var H=Math.min(F,i),J=Math.floor(Kb(r,H,o));return r[J]>F&&J<r.length-1?r[J+1]:r[J]}}}(Re,F,!ne&&we,V):VP(e,n,F,!ne&&we,V)}else{var Ne=(J?Math.max(Xs(J),mh(J)):360*Yd[Kd.DEGREES]/H.getMetersPerUnit())/256/Math.pow(2,0),$e=Ne/Math.pow(2,28);void 0!==(e=r.maxResolution)?u=0:e=Ne/Math.pow(b,u),void 0===(n=r.minResolution)&&(n=void 0!==r.maxZoom?void 0!==r.maxResolution?e/Math.pow(b,m):Ne/Math.pow(b,m):$e),m=u+Math.floor(Math.log(e/n)/Math.log(b)),n=e/Math.pow(b,m-u),t=r.constrainResolution?function(r,t,e,n,i,o){return function(u,m,b,T){if(void 0!==u){var F=i?uT(t,i,b,o):t,V=void 0!==e?e:0;if(T)return void 0===n||n?cT(u,F,V):Wc(u,V,F);var ne=Math.ceil(Math.log(t/F)/Math.log(r)-1e-9),we=-m*(.5-1e-9)+.5,Re=Math.min(F,u),qe=Math.floor(Math.log(t/Re)/Math.log(r)+we),Ne=Math.max(ne,qe);return Wc(t/Math.pow(r,Ne),V,F)}}}(b,e,n,F,!ne&&we,V):VP(e,n,F,!ne&&we,V)}return{constraint:t,maxResolution:e,minResolution:n,minZoom:u,zoomFactor:b}}(e);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=i.minZoom;var o=function(r){if(void 0!==r.extent)return UP(r.extent,r.constrainOnlyCenter,void 0===r.smoothExtentConstraint||r.smoothExtentConstraint);var e=oS(r.projection,"EPSG:3857");if(!0!==r.multiWorld&&e.isGlobal()){var n=e.getExtent().slice();return n[0]=-1/0,n[2]=1/0,UP(n,!1,!1)}return x8}(e),u=i.constraint,m=function(r){if(void 0===r.enableRotation||r.enableRotation){var e=r.constrainRotation;return void 0===e||!0===e?function(r){var t=rw(5);return function(e,n){return n?e:void 0!==e?Math.abs(e)<=t?0:e:void 0}}():!1===e?Ok:"number"==typeof e?function(r){var t=2*Math.PI/r;return function(e,n){return n?e:void 0!==e?e=Math.floor(e/t+.5)*t:void 0}}(e):Ok}return DS}(e);this.constraints_={center:o,resolution:u,rotation:m},this.setRotation(void 0!==e.rotation?e.rotation:0),this.setCenterInternal(void 0!==e.center?e.center:null),void 0!==e.resolution?this.setResolution(e.resolution):void 0!==e.zoom&&this.setZoom(e.zoom),this.setProperties({}),this.options_=e},Object.defineProperty(t.prototype,"padding",{get:function(){return this.padding_},set:function(e){var n=this.padding_;this.padding_=e;var i=this.getCenter();if(i){var o=e||[0,0,0,0];n=n||[0,0,0,0];var u=this.getResolution();this.setCenterInternal([i[0]+u/2*(o[3]-n[3]+n[1]-o[1]),i[1]-u/2*(o[0]-n[0]+n[2]-o[2])])}},enumerable:!1,configurable:!0}),t.prototype.getUpdatedOptions_=function(e){var n=$a({},this.options_);return void 0!==n.resolution?n.resolution=this.getResolution():n.zoom=this.getZoom(),n.center=this.getCenterInternal(),n.rotation=this.getRotation(),$a({},n,e)},t.prototype.animate=function(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);for(var n=new Array(arguments.length),i=0;i<n.length;++i){var o=arguments[i];o.center&&((o=$a({},o)).center=hl(o.center,this.getProjection())),o.anchor&&((o=$a({},o)).anchor=hl(o.anchor,this.getProjection())),n[i]=o}this.animateInternal.apply(this,n)},t.prototype.animateInternal=function(e){var i,n=arguments.length;n>1&&"function"==typeof arguments[n-1]&&(i=arguments[n-1],--n);for(var o=0;o<n&&!this.isDef();++o){var u=arguments[o];u.center&&this.setCenterInternal(u.center),void 0!==u.zoom?this.setZoom(u.zoom):u.resolution&&this.setResolution(u.resolution),void 0!==u.rotation&&this.setRotation(u.rotation)}if(o!==n){for(var m=Date.now(),b=this.targetCenter_.slice(),T=this.targetResolution_,F=this.targetRotation_,V=[];o<n;++o){var H=arguments[o],J={start:m,complete:!1,anchor:H.anchor,duration:void 0!==H.duration?H.duration:1e3,easing:H.easing||_S,callback:i};if(H.center&&(J.sourceCenter=b,J.targetCenter=H.center.slice(),b=J.targetCenter),void 0!==H.zoom?(J.sourceResolution=T,J.targetResolution=this.getResolutionForZoom(H.zoom),T=J.targetResolution):H.resolution&&(J.sourceResolution=T,J.targetResolution=H.resolution,T=J.targetResolution),void 0!==H.rotation){J.sourceRotation=F;var ne=Zy(H.rotation-F+Math.PI,2*Math.PI)-Math.PI;J.targetRotation=F+ne,F=J.targetRotation}M8(J)?J.complete=!0:m+=J.duration,V.push(J)}this.animations_.push(V),this.setHint(0,1),this.updateAnimations_()}else i&&zw(i,!0)},t.prototype.getAnimating=function(){return this.hints_[0]>0},t.prototype.getInteracting=function(){return this.hints_[1]>0},t.prototype.cancelAnimations=function(){this.setHint(0,-this.hints_[0]);for(var e,n=0,i=this.animations_.length;n<i;++n){var o=this.animations_[n];if(o[0].callback&&zw(o[0].callback,!1),!e)for(var u=0,m=o.length;u<m;++u){var b=o[u];if(!b.complete){e=b.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN},t.prototype.updateAnimations_=function(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),this.getAnimating()){for(var e=Date.now(),n=!1,i=this.animations_.length-1;i>=0;--i){for(var o=this.animations_[i],u=!0,m=0,b=o.length;m<b;++m){var T=o[m];if(!T.complete){var V=T.duration>0?(e-T.start)/T.duration:1;V>=1?(T.complete=!0,V=1):u=!1;var H=T.easing(V);if(T.sourceCenter){var J=T.sourceCenter[0],ne=T.sourceCenter[1],we=T.targetCenter[0],Re=T.targetCenter[1];this.nextCenter_=T.targetCenter,this.targetCenter_=[J+H*(we-J),ne+H*(Re-ne)]}if(T.sourceResolution&&T.targetResolution){var $e=1===H?T.targetResolution:T.sourceResolution+H*(T.targetResolution-T.sourceResolution);if(T.anchor){var tt=this.getViewportSize_(this.getRotation()),bt=this.constraints_.resolution($e,0,tt,!0);this.targetCenter_=this.calculateCenterZoom(bt,T.anchor)}this.nextResolution_=T.targetResolution,this.targetResolution_=$e,this.applyTargetState_(!0)}if(void 0!==T.sourceRotation&&void 0!==T.targetRotation){var dn=1===H?Zy(T.targetRotation+Math.PI,2*Math.PI)-Math.PI:T.sourceRotation+H*(T.targetRotation-T.sourceRotation);if(T.anchor){var Kt=this.constraints_.rotation(dn,!0);this.targetCenter_=this.calculateCenterRotate(Kt,T.anchor)}this.nextRotation_=T.targetRotation,this.targetRotation_=dn}if(this.applyTargetState_(!0),n=!0,!T.complete)break}}if(u){this.animations_[i]=null,this.setHint(0,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;var vn=o[0].callback;vn&&zw(vn,!0)}}this.animations_=this.animations_.filter(Boolean),n&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}},t.prototype.calculateCenterRotate=function(e,n){var i,o=this.getCenterInternal();return void 0!==o&&(IS(i=[o[0]-n[0],o[1]-n[1]],e-this.getRotation()),Dk(i,n)),i},t.prototype.calculateCenterZoom=function(e,n){var i,o=this.getCenterInternal(),u=this.getResolution();return void 0!==o&&void 0!==u&&(i=[n[0]-e*(n[0]-o[0])/u,n[1]-e*(n[1]-o[1])/u]),i},t.prototype.getViewportSize_=function(e){var n=this.viewportSize_;if(e){var i=n[0],o=n[1];return[Math.abs(i*Math.cos(e))+Math.abs(o*Math.sin(e)),Math.abs(i*Math.sin(e))+Math.abs(o*Math.cos(e))]}return n},t.prototype.setViewportSize=function(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)},t.prototype.getCenter=function(){var e=this.getCenterInternal();return e&&g_(e,this.getProjection())},t.prototype.getCenterInternal=function(){return this.get("center")},t.prototype.getConstraints=function(){return this.constraints_},t.prototype.getConstrainResolution=function(){return this.options_.constrainResolution},t.prototype.getHints=function(e){return void 0!==e?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()},t.prototype.calculateExtent=function(e){return hw(this.calculateExtentInternal(e),this.getProjection())},t.prototype.calculateExtentInternal=function(e){var n=e||this.getViewportSizeMinusPadding_(),i=this.getCenterInternal();bo(i,1);var o=this.getResolution();bo(void 0!==o,2);var u=this.getRotation();return bo(void 0!==u,3),Z0(i,o,u,n)},t.prototype.getMaxResolution=function(){return this.maxResolution_},t.prototype.getMinResolution=function(){return this.minResolution_},t.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},t.prototype.setMaxZoom=function(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))},t.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},t.prototype.setMinZoom=function(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))},t.prototype.setConstrainResolution=function(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))},t.prototype.getProjection=function(){return this.projection_},t.prototype.getResolution=function(){return this.get("resolution")},t.prototype.getResolutions=function(){return this.resolutions_},t.prototype.getResolutionForExtent=function(e,n){return this.getResolutionForExtentInternal(ug(e,this.getProjection()),n)},t.prototype.getResolutionForExtentInternal=function(e,n){var i=n||this.getViewportSizeMinusPadding_(),o=Xs(e)/i[0],u=mh(e)/i[1];return Math.max(o,u)},t.prototype.getResolutionForValueFunction=function(e){var n=e||2,i=this.getConstrainedResolution(this.maxResolution_),u=Math.log(i/this.minResolution_)/Math.log(n);return function(m){return i/Math.pow(n,m*u)}},t.prototype.getRotation=function(){return this.get("rotation")},t.prototype.getValueForResolutionFunction=function(e){var n=Math.log(e||2),i=this.getConstrainedResolution(this.maxResolution_),u=Math.log(i/this.minResolution_)/n;return function(m){return Math.log(i/m)/n/u}},t.prototype.getViewportSizeMinusPadding_=function(e){var n=this.getViewportSize_(e),i=this.padding_;return i&&(n=[n[0]-i[1]-i[3],n[1]-i[0]-i[2]]),n},t.prototype.getState=function(){var e=this.getProjection(),n=this.getResolution(),i=this.getRotation(),o=this.getCenterInternal(),u=this.padding_;if(u){var m=this.getViewportSizeMinusPadding_();o=pT(o,this.getViewportSize_(),[m[0]/2+u[3],m[1]/2+u[0]],n,i)}return{center:o.slice(0),projection:void 0!==e?e:null,resolution:n,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}},t.prototype.getZoom=function(){var e,n=this.getResolution();return void 0!==n&&(e=this.getZoomForResolution(n)),e},t.prototype.getZoomForResolution=function(e){var i,o,n=this.minZoom_||0;if(this.resolutions_){var u=Kb(this.resolutions_,e,1);n=u,i=this.resolutions_[u],o=u==this.resolutions_.length-1?2:i/this.resolutions_[u+1]}else i=this.maxResolution_,o=this.zoomFactor_;return n+Math.log(i/e)/Math.log(o)},t.prototype.getResolutionForZoom=function(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;var n=Wc(Math.floor(e),0,this.resolutions_.length-2);return this.resolutions_[n]/Math.pow(this.resolutions_[n]/this.resolutions_[n+1],Wc(e-n,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)},t.prototype.fit=function(e,n){var i;if(bo(Array.isArray(e)||"function"==typeof e.getSimplifiedGeometry,24),Array.isArray(e))bo(!nw(e),25),i=Qk(o=ug(e,this.getProjection()));else if(e.getType()===$t.CIRCLE){var o;(i=Qk(o=ug(e.getExtent(),this.getProjection()))).rotate(this.getRotation(),wm(o))}else{var u=Pf();i=u?e.clone().transform(u,this.getProjection()):e}this.fitInternal(i,n)},t.prototype.rotatedExtentForGeometry=function(e){for(var n=this.getRotation(),i=Math.cos(n),o=Math.sin(-n),u=e.getFlatCoordinates(),m=e.getStride(),b=1/0,T=1/0,F=-1/0,V=-1/0,H=0,J=u.length;H<J;H+=m){var ne=u[H]*i-u[H+1]*o,we=u[H]*o+u[H+1]*i;b=Math.min(b,ne),T=Math.min(T,we),F=Math.max(F,ne),V=Math.max(V,we)}return[b,T,F,V]},t.prototype.fitInternal=function(e,n){var i=n||{},o=i.size;o||(o=this.getViewportSizeMinusPadding_());var b,u=void 0!==i.padding?i.padding:[0,0,0,0],m=void 0!==i.nearest&&i.nearest;b=void 0!==i.minResolution?i.minResolution:void 0!==i.maxZoom?this.getResolutionForZoom(i.maxZoom):0;var T=this.rotatedExtentForGeometry(e),F=this.getResolutionForExtentInternal(T,[o[0]-u[1]-u[3],o[1]-u[0]-u[2]]);F=isNaN(F)?b:Math.max(F,b),F=this.getConstrainedResolution(F,m?0:1);var V=this.getRotation(),H=Math.sin(V),J=Math.cos(V),ne=wm(T);ne[0]+=(u[1]-u[3])/2*F,ne[1]+=(u[0]-u[2])/2*F;var qe=this.getConstrainedCenter([ne[0]*J-ne[1]*H,ne[1]*J+ne[0]*H],F),Ne=i.callback?i.callback:a_;void 0!==i.duration?this.animateInternal({resolution:F,center:qe,duration:i.duration,easing:i.easing},Ne):(this.targetResolution_=F,this.targetCenter_=qe,this.applyTargetState_(!1,!0),zw(Ne,!0))},t.prototype.centerOn=function(e,n,i){this.centerOnInternal(hl(e,this.getProjection()),n,i)},t.prototype.centerOnInternal=function(e,n,i){this.setCenterInternal(pT(e,n,i,this.getResolution(),this.getRotation()))},t.prototype.calculateCenterShift=function(e,n,i,o){var u,m=this.padding_;if(m&&e){var b=this.getViewportSizeMinusPadding_(-i),T=pT(e,o,[b[0]/2+m[3],b[1]/2+m[0]],n,i);u=[e[0]-T[0],e[1]-T[1]]}return u},t.prototype.isDef=function(){return!!this.getCenterInternal()&&void 0!==this.getResolution()},t.prototype.adjustCenter=function(e){var n=g_(this.targetCenter_,this.getProjection());this.setCenter([n[0]+e[0],n[1]+e[1]])},t.prototype.adjustCenterInternal=function(e){var n=this.targetCenter_;this.setCenterInternal([n[0]+e[0],n[1]+e[1]])},t.prototype.adjustResolution=function(e,n){var i=n&&hl(n,this.getProjection());this.adjustResolutionInternal(e,i)},t.prototype.adjustResolutionInternal=function(e,n){var i=this.getAnimating()||this.getInteracting(),o=this.getViewportSize_(this.getRotation()),u=this.constraints_.resolution(this.targetResolution_*e,0,o,i);n&&(this.targetCenter_=this.calculateCenterZoom(u,n)),this.targetResolution_*=e,this.applyTargetState_()},t.prototype.adjustZoom=function(e,n){this.adjustResolution(Math.pow(this.zoomFactor_,-e),n)},t.prototype.adjustRotation=function(e,n){n&&(n=hl(n,this.getProjection())),this.adjustRotationInternal(e,n)},t.prototype.adjustRotationInternal=function(e,n){var i=this.getAnimating()||this.getInteracting(),o=this.constraints_.rotation(this.targetRotation_+e,i);n&&(this.targetCenter_=this.calculateCenterRotate(o,n)),this.targetRotation_+=e,this.applyTargetState_()},t.prototype.setCenter=function(e){this.setCenterInternal(hl(e,this.getProjection()))},t.prototype.setCenterInternal=function(e){this.targetCenter_=e,this.applyTargetState_()},t.prototype.setHint=function(e,n){return this.hints_[e]+=n,this.changed(),this.hints_[e]},t.prototype.setResolution=function(e){this.targetResolution_=e,this.applyTargetState_()},t.prototype.setRotation=function(e){this.targetRotation_=e,this.applyTargetState_()},t.prototype.setZoom=function(e){this.setResolution(this.getResolutionForZoom(e))},t.prototype.applyTargetState_=function(e,n){var i=this.getAnimating()||this.getInteracting()||n,o=this.constraints_.rotation(this.targetRotation_,i),u=this.getViewportSize_(o),m=this.constraints_.resolution(this.targetResolution_,0,u,i),b=this.constraints_.center(this.targetCenter_,m,u,i,this.calculateCenterShift(this.targetCenter_,m,o,u));this.get("rotation")!==o&&this.set("rotation",o),this.get("resolution")!==m&&this.set("resolution",m),(!this.get("center")||!hg(this.get("center"),b))&&this.set("center",b),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0},t.prototype.resolveConstraints=function(e,n,i){var o=void 0!==e?e:200,u=n||0,m=this.constraints_.rotation(this.targetRotation_),b=this.getViewportSize_(m),T=this.constraints_.resolution(this.targetResolution_,u,b),F=this.constraints_.center(this.targetCenter_,T,b,!1,this.calculateCenterShift(this.targetCenter_,T,m,b));if(0===o&&!this.cancelAnchor_)return this.targetResolution_=T,this.targetRotation_=m,this.targetCenter_=F,void this.applyTargetState_();var V=i||(0===o?this.cancelAnchor_:void 0);this.cancelAnchor_=void 0,(this.getResolution()!==T||this.getRotation()!==m||!this.getCenterInternal()||!hg(this.getCenterInternal(),F))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:m,center:F,resolution:T,duration:o,easing:K0,anchor:V}))},t.prototype.beginInteraction=function(){this.resolveConstraints(0),this.setHint(1,1)},t.prototype.endInteraction=function(e,n,i){var o=i&&hl(i,this.getProjection());this.endInteractionInternal(e,n,o)},t.prototype.endInteractionInternal=function(e,n,i){this.setHint(1,-1),this.resolveConstraints(e,n,i)},t.prototype.getConstrainedCenter=function(e,n){var i=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,n||this.getResolution(),i)},t.prototype.getConstrainedZoom=function(e,n){var i=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(i,n))},t.prototype.getConstrainedResolution=function(e,n){var i=n||0,o=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,i,o)},t}(cg);function zw(r,t){setTimeout(function(){r(t)},0)}function M8(r){return!(r.sourceCenter&&r.targetCenter&&!hg(r.sourceCenter,r.targetCenter)||r.sourceResolution!==r.targetResolution||r.sourceRotation!==r.targetRotation)}function pT(r,t,e,n,i){var o=Math.cos(-i),u=Math.sin(-i),m=r[0]*o-r[1]*u,b=r[1]*o+r[0]*u;return[(m+=(t[0]/2-e[0])*n)*o-(b+=(e[1]-t[1]/2)*n)*(u=-u),b*o+m*u]}const Of=E8;var A8=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),D8=function(r){function t(e){var n=r.call(this)||this,i=function(r){var t=null;void 0!==r.keyboardEventTarget&&(t="string"==typeof r.keyboardEventTarget?document.getElementById(r.keyboardEventTarget):r.keyboardEventTarget);var i,o,u,e={},n=r.layers&&"function"==typeof r.layers.getLayers?r.layers:new a8({layers:r.layers});return e.layergroup=n,e.target=r.target,e.view=r.view instanceof Of?r.view:new Of,void 0!==r.controls&&(Array.isArray(r.controls)?i=new _d(r.controls.slice()):(bo("function"==typeof r.controls.getArray,47),i=r.controls)),void 0!==r.interactions&&(Array.isArray(r.interactions)?o=new _d(r.interactions.slice()):(bo("function"==typeof r.interactions.getArray,48),o=r.interactions)),void 0!==r.overlays?Array.isArray(r.overlays)?u=new _d(r.overlays.slice()):(bo("function"==typeof r.overlays.getArray,49),u=r.overlays):u=new _d,{controls:i,interactions:o,keyboardEventTarget:t,overlays:u,values:e}}(e);n.boundHandleBrowserEvent_=n.handleBrowserEvent.bind(n),n.maxTilesLoading_=void 0!==e.maxTilesLoading?e.maxTilesLoading:16,n.pixelRatio_=void 0!==e.pixelRatio?e.pixelRatio:ZD,n.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}.bind(n),n.coordinateToPixelTransform_=[1,0,0,1,0,0],n.pixelToCoordinateTransform_=[1,0,0,1,0,0],n.frameIndex_=0,n.frameState_=null,n.previousExtent_=null,n.viewPropertyListenerKey_=null,n.viewChangeListenerKey_=null,n.layerGroupPropertyListenerKeys_=null,n.viewport_=document.createElement("div"),n.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),n.viewport_.style.position="relative",n.viewport_.style.overflow="hidden",n.viewport_.style.width="100%",n.viewport_.style.height="100%",n.overlayContainer_=document.createElement("div"),n.overlayContainer_.style.position="absolute",n.overlayContainer_.style.zIndex="0",n.overlayContainer_.style.width="100%",n.overlayContainer_.style.height="100%",n.overlayContainer_.style.pointerEvents="none",n.overlayContainer_.className="ol-overlaycontainer",n.viewport_.appendChild(n.overlayContainer_),n.overlayContainerStopEvent_=document.createElement("div"),n.overlayContainerStopEvent_.style.position="absolute",n.overlayContainerStopEvent_.style.zIndex="0",n.overlayContainerStopEvent_.style.width="100%",n.overlayContainerStopEvent_.style.height="100%",n.overlayContainerStopEvent_.style.pointerEvents="none",n.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",n.viewport_.appendChild(n.overlayContainerStopEvent_),n.mapBrowserEventHandler_=null,n.moveTolerance_=e.moveTolerance,n.keyboardEventTarget_=i.keyboardEventTarget,n.keyHandlerKeys_=null,n.controls=i.controls||new _d,n.interactions=i.interactions||new _d,n.overlays_=i.overlays,n.overlayIdIndex_={},n.renderer_=null,n.postRenderFunctions_=[],n.tileQueue_=new v8(n.getTilePriority.bind(n),n.handleTileChange_.bind(n)),n.addChangeListener("layergroup",n.handleLayerGroupChanged_),n.addChangeListener("view",n.handleViewChanged_),n.addChangeListener("size",n.handleSizeChanged_),n.addChangeListener("target",n.handleTargetChanged_),n.setProperties(i.values);var o=n;return e.view&&!(e.view instanceof Of)&&e.view.then(function(u){o.setView(new Of(u))}),n.controls.addEventListener("add",function(u){u.element.setMap(this)}.bind(n)),n.controls.addEventListener("remove",function(u){u.element.setMap(null)}.bind(n)),n.interactions.addEventListener("add",function(u){u.element.setMap(this)}.bind(n)),n.interactions.addEventListener("remove",function(u){u.element.setMap(null)}.bind(n)),n.overlays_.addEventListener("add",function(u){this.addOverlayInternal_(u.element)}.bind(n)),n.overlays_.addEventListener("remove",function(u){var b=u.element.getId();void 0!==b&&delete this.overlayIdIndex_[b.toString()],u.element.setMap(null)}.bind(n)),n.controls.forEach(function(u){u.setMap(this)}.bind(n)),n.interactions.forEach(function(u){u.setMap(this)}.bind(n)),n.overlays_.forEach(n.addOverlayInternal_.bind(n)),n}return A8(t,r),t.prototype.createRenderer=function(){throw new Error("Use a map type that has a createRenderer method")},t.prototype.addControl=function(e){this.getControls().push(e)},t.prototype.addInteraction=function(e){this.getInteractions().push(e)},t.prototype.addLayer=function(e){this.getLayerGroup().getLayers().push(e)},t.prototype.addOverlay=function(e){this.getOverlays().push(e)},t.prototype.addOverlayInternal_=function(e){var n=e.getId();void 0!==n&&(this.overlayIdIndex_[n.toString()]=e),e.setMap(this)},t.prototype.disposeInternal=function(){this.setTarget(null),r.prototype.disposeInternal.call(this)},t.prototype.forEachFeatureAtPixel=function(e,n,i){if(this.frameState_){var o=this.getCoordinateFromPixelInternal(e);return this.renderer_.forEachFeatureAtCoordinate(o,this.frameState_,void 0!==(i=void 0!==i?i:{}).hitTolerance?i.hitTolerance:0,!1!==i.checkWrapped,n,null,void 0!==i.layerFilter?i.layerFilter:qy,null)}},t.prototype.getFeaturesAtPixel=function(e,n){var i=[];return this.forEachFeatureAtPixel(e,function(o){i.push(o)},n),i},t.prototype.forEachLayerAtPixel=function(e,n,i){if(this.frameState_){var o=i||{};return this.renderer_.forEachLayerAtPixel(e,this.frameState_,void 0!==o.hitTolerance?o.hitTolerance:0,n,o.layerFilter||qy)}},t.prototype.hasFeatureAtPixel=function(e,n){if(!this.frameState_)return!1;var i=this.getCoordinateFromPixelInternal(e);return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,void 0!==(n=void 0!==n?n:{}).hitTolerance?n.hitTolerance:0,!1!==n.checkWrapped,void 0!==n.layerFilter?n.layerFilter:qy,null)},t.prototype.getEventCoordinate=function(e){return this.getCoordinateFromPixel(this.getEventPixel(e))},t.prototype.getEventCoordinateInternal=function(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))},t.prototype.getEventPixel=function(e){var n=this.viewport_.getBoundingClientRect(),i="changedTouches"in e?e.changedTouches[0]:e;return[i.clientX-n.left,i.clientY-n.top]},t.prototype.getTarget=function(){return this.get("target")},t.prototype.getTargetElement=function(){var e=this.getTarget();return void 0!==e?"string"==typeof e?document.getElementById(e):e:null},t.prototype.getCoordinateFromPixel=function(e){return g_(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())},t.prototype.getCoordinateFromPixelInternal=function(e){var n=this.frameState_;return n?$c(n.pixelToCoordinateTransform,e.slice()):null},t.prototype.getControls=function(){return this.controls},t.prototype.getOverlays=function(){return this.overlays_},t.prototype.getOverlayById=function(e){var n=this.overlayIdIndex_[e.toString()];return void 0!==n?n:null},t.prototype.getInteractions=function(){return this.interactions},t.prototype.getLayerGroup=function(){return this.get("layergroup")},t.prototype.setLayers=function(e){var n=this.getLayerGroup();if(e instanceof _d)n.setLayers(e);else{var i=n.getLayers();i.clear(),i.extend(e)}},t.prototype.getLayers=function(){return this.getLayerGroup().getLayers()},t.prototype.getLoading=function(){for(var e=this.getLayerGroup().getLayerStatesArray(),n=0,i=e.length;n<i;++n){var u=e[n].layer.getSource();if(u&&u.loading)return!0}return!1},t.prototype.getPixelFromCoordinate=function(e){var n=hl(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(n)},t.prototype.getPixelFromCoordinateInternal=function(e){var n=this.frameState_;return n?$c(n.coordinateToPixelTransform,e.slice(0,2)):null},t.prototype.getRenderer=function(){return this.renderer_},t.prototype.getSize=function(){return this.get("size")},t.prototype.getView=function(){return this.get("view")},t.prototype.getViewport=function(){return this.viewport_},t.prototype.getOverlayContainer=function(){return this.overlayContainer_},t.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},t.prototype.getOwnerDocument=function(){var e=this.getTargetElement();return e?e.ownerDocument:document},t.prototype.getTilePriority=function(e,n,i,o){return function(r,t,e,n,i){if(!r||!(e in r.wantedTiles)||!r.wantedTiles[e][t.getKey()])return Fw;var o=r.viewState.center,u=n[0]-o[0],m=n[1]-o[1];return 65536*Math.log(i)+Math.sqrt(u*u+m*m)/i}(this.frameState_,e,n,i,o)},t.prototype.handleBrowserEvent=function(e,n){var o=new ly(n||e.type,this,e);this.handleMapBrowserEvent(o)},t.prototype.handleMapBrowserEvent=function(e){if(this.frameState_){var n=e.originalEvent,i=n.type;if("pointerdown"===i||"wheel"===i||"keydown"===i){var o=this.getOwnerDocument(),u=this.viewport_.getRootNode?this.viewport_.getRootNode():o,m=n.target;if(this.overlayContainerStopEvent_.contains(m)||!(u===o?o.documentElement:u).contains(m))return}if(e.frameState=this.frameState_,!1!==this.dispatchEvent(e))for(var b=this.getInteractions().getArray().slice(),T=b.length-1;T>=0;T--){var F=b[T];if(F.getMap()===this&&F.getActive()&&this.getTargetElement()&&(!F.handleEvent(e)||e.propagationStopped))break}}},t.prototype.handlePostRender=function(){var e=this.frameState_,n=this.tileQueue_;if(!n.isEmpty()){var i=this.maxTilesLoading_,o=i;if(e){var u=e.viewHints;if(u[0]||u[1]){var m=Date.now()-e.time>8;i=m?0:8,o=m?0:2}}n.getTilesLoading()<i&&(n.reprioritize(),n.loadMoreTiles(i,o))}e&&this.hasListener("rendercomplete")&&!e.animate&&!this.tileQueue_.getTilesLoading()&&!this.getLoading()&&this.renderer_.dispatchRenderEvent("rendercomplete",e);for(var b=this.postRenderFunctions_,T=0,F=b.length;T<F;++T)b[T](this,e);b.length=0},t.prototype.handleSizeChanged_=function(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()},t.prototype.handleTargetChanged_=function(){var e;if(this.getTarget()&&(e=this.getTargetElement()),this.mapBrowserEventHandler_){for(var n=0,i=this.keyHandlerKeys_.length;n<i;++n)il(this.keyHandlerKeys_[n]);this.keyHandlerKeys_=null,this.viewport_.removeEventListener("contextmenu",this.boundHandleBrowserEvent_),this.viewport_.removeEventListener("wheel",this.boundHandleBrowserEvent_),void 0!==this.handleResize_&&(removeEventListener("resize",this.handleResize_,!1),this.handleResize_=void 0),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,sS(this.viewport_)}if(e){for(var o in e.appendChild(this.viewport_),this.renderer_||(this.renderer_=this.createRenderer()),this.mapBrowserEventHandler_=new d8(this,this.moveTolerance_),oa)this.mapBrowserEventHandler_.addEventListener(oa[o],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener("contextmenu",this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener("wheel",this.boundHandleBrowserEvent_,!!HD&&{passive:!1});var u=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.keyHandlerKeys_=[Zo(u,"keydown",this.handleBrowserEvent,this),Zo(u,"keypress",this.handleBrowserEvent,this)],this.handleResize_||(this.handleResize_=this.updateSize.bind(this),window.addEventListener("resize",this.handleResize_,!1))}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()},t.prototype.handleTileChange_=function(){this.render()},t.prototype.handleViewPropertyChanged_=function(){this.render()},t.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(il(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(il(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var e=this.getView();e&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=Zo(e,"propertychange",this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=Zo(e,"change",this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()},t.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(il),this.layerGroupPropertyListenerKeys_=null);var e=this.getLayerGroup();e&&(this.layerGroupPropertyListenerKeys_=[Zo(e,"propertychange",this.render,this),Zo(e,"change",this.render,this)]),this.render()},t.prototype.isRendered=function(){return!!this.frameState_},t.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},t.prototype.redrawText=function(){for(var e=this.getLayerGroup().getLayerStatesArray(),n=0,i=e.length;n<i;++n){var o=e[n].layer;o.hasRenderer()&&o.getRenderer().handleFontsChanged()}},t.prototype.render=function(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},t.prototype.removeControl=function(e){return this.getControls().remove(e)},t.prototype.removeInteraction=function(e){return this.getInteractions().remove(e)},t.prototype.removeLayer=function(e){return this.getLayerGroup().getLayers().remove(e)},t.prototype.removeOverlay=function(e){return this.getOverlays().remove(e)},t.prototype.renderFrame_=function(e){var n=this,i=this.getSize(),o=this.getView(),u=this.frameState_,m=null;if(void 0!==i&&lk(i)&&o&&o.isDef()){var b=o.getHints(this.frameState_?this.frameState_.viewHints:void 0),T=o.getState();if(m={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Z0(T.center,T.resolution,T.rotation,i),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:i,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:T,viewHints:b,wantedTiles:{}},T.nextCenter&&T.nextResolution){var F=isNaN(T.nextRotation)?T.rotation:T.nextRotation;m.nextExtent=Z0(T.nextCenter,T.nextResolution,F,i)}}this.frameState_=m,this.renderer_.renderFrame(m),m&&(m.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,m.postRenderFunctions),u&&(!this.previousExtent_||!nw(this.previousExtent_)&&!c_(m.extent,this.previousExtent_))&&(this.dispatchEvent(new Ow("movestart",this,u)),this.previousExtent_=u_(this.previousExtent_)),this.previousExtent_&&!m.viewHints[0]&&!m.viewHints[1]&&!c_(m.extent,this.previousExtent_)&&(this.dispatchEvent(new Ow("moveend",this,m)),RD(m.extent,this.previousExtent_))),this.dispatchEvent(new Ow("postrender",this,m)),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(function(){n.postRenderTimeoutHandle_=void 0,n.handlePostRender()},0))},t.prototype.setLayerGroup=function(e){this.set("layergroup",e)},t.prototype.setSize=function(e){this.set("size",e)},t.prototype.setTarget=function(e){this.set("target",e)},t.prototype.setView=function(e){if(!e||e instanceof Of)this.set("view",e);else{this.set("view",new Of);var n=this;e.then(function(i){n.setView(new Of(i))})}},t.prototype.updateSize=function(){var e=this.getTargetElement(),n=void 0;if(e){var i=getComputedStyle(e),o=e.offsetWidth-parseFloat(i.borderLeftWidth)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderRightWidth),u=e.offsetHeight-parseFloat(i.borderTopWidth)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderBottomWidth);!isNaN(o)&&!isNaN(u)&&!lk(n=[o,u])&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&console.warn("No map visible because the map container's width or height are 0.")}this.setSize(n),this.updateViewportSize_()},t.prototype.updateViewportSize_=function(){var e=this.getView();if(e){var n=void 0,i=getComputedStyle(this.viewport_);i.width&&i.height&&(n=[parseInt(i.width,10),parseInt(i.height,10)]),e.setViewportSize(n)}},t}(cg);const P8=D8;var R8=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),O8=function(r){function t(e){var n=r.call(this)||this,i=e.element;return i&&!e.target&&!i.style.pointerEvents&&(i.style.pointerEvents="auto"),n.element=i||null,n.target_=null,n.map_=null,n.listenerKeys=[],e.render&&(n.render=e.render),e.target&&n.setTarget(e.target),n}return R8(t,r),t.prototype.disposeInternal=function(){sS(this.element),r.prototype.disposeInternal.call(this)},t.prototype.getMap=function(){return this.map_},t.prototype.setMap=function(e){this.map_&&sS(this.element);for(var n=0,i=this.listenerKeys.length;n<i;++n)il(this.listenerKeys[n]);this.listenerKeys.length=0,this.map_=e,this.map_&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==a_&&this.listenerKeys.push(Zo(e,"postrender",this.render,this)),e.render())},t.prototype.render=function(e){},t.prototype.setTarget=function(e){this.target_="string"==typeof e?document.getElementById(e):e},t}(cg);const ix=O8;var L8=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),F8=function(r){function t(e){var n=this,i=e||{};(n=r.call(this,{element:document.createElement("div"),render:i.render,target:i.target})||this).ulElement_=document.createElement("ul"),n.collapsed_=void 0===i.collapsed||i.collapsed,n.userCollapsed_=n.collapsed_,n.overrideCollapsible_=void 0!==i.collapsible,n.collapsible_=void 0===i.collapsible||i.collapsible,n.collapsible_||(n.collapsed_=!1);var o=void 0!==i.className?i.className:"ol-attribution",u=void 0!==i.tipLabel?i.tipLabel:"Attributions",m=void 0!==i.expandClassName?i.expandClassName:o+"-expand",b=void 0!==i.collapseLabel?i.collapseLabel:"\u203a",T=void 0!==i.collapseClassName?i.collapseClassName:o+"-collpase";"string"==typeof b?(n.collapseLabel_=document.createElement("span"),n.collapseLabel_.textContent=b,n.collapseLabel_.className=T):n.collapseLabel_=b;var F=void 0!==i.label?i.label:"i";"string"==typeof F?(n.label_=document.createElement("span"),n.label_.textContent=F,n.label_.className=m):n.label_=F;var V=n.collapsible_&&!n.collapsed_?n.collapseLabel_:n.label_;n.toggleButton_=document.createElement("button"),n.toggleButton_.setAttribute("type","button"),n.toggleButton_.setAttribute("aria-expanded",String(!n.collapsed_)),n.toggleButton_.title=u,n.toggleButton_.appendChild(V),n.toggleButton_.addEventListener("click",n.handleClick_.bind(n),!1);var J=n.element;return J.className=o+" "+d1+" "+$S+(n.collapsed_&&n.collapsible_?" "+hP:"")+(n.collapsible_?"":" ol-uncollapsible"),J.appendChild(n.toggleButton_),J.appendChild(n.ulElement_),n.renderedAttributions_=[],n.renderedVisible_=!0,n}return L8(t,r),t.prototype.collectSourceAttributions_=function(e){for(var n={},i=[],o=!0,u=e.layerStatesArray,m=0,b=u.length;m<b;++m){var T=u[m];if(Cw(T,e.viewState)){var F=T.layer.getSource();if(F){var V=F.getAttributions();if(V){var H=V(e);if(H)if(o=o&&!1!==F.getAttributionsCollapsible(),Array.isArray(H))for(var J=0,ne=H.length;J<ne;++J)H[J]in n||(i.push(H[J]),n[H[J]]=!0);else H in n||(i.push(H),n[H]=!0)}}}}return this.overrideCollapsible_||this.setCollapsible(o),i},t.prototype.updateElement_=function(e){if(e){var n=this.collectSourceAttributions_(e),i=n.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!i_(n,this.renderedAttributions_)){!function(r){for(;r.lastChild;)r.removeChild(r.lastChild)}(this.ulElement_);for(var o=0,u=n.length;o<u;++o){var m=document.createElement("li");m.innerHTML=n[o],this.ulElement_.appendChild(m)}this.renderedAttributions_=n}}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},t.prototype.handleClick_=function(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_},t.prototype.handleToggle_=function(){this.element.classList.toggle(hP),this.collapsed_?WD(this.collapseLabel_,this.label_):WD(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))},t.prototype.getCollapsible=function(){return this.collapsible_},t.prototype.setCollapsible=function(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())},t.prototype.setCollapsed=function(e){this.userCollapsed_=e,this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()},t.prototype.getCollapsed=function(){return this.collapsed_},t.prototype.render=function(e){this.updateElement_(e.frameState)},t}(ix);const z8=F8;var N8=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),B8=function(r){function t(e){var n=this,i=e||{};n=r.call(this,{element:document.createElement("div"),render:i.render,target:i.target})||this;var o=void 0!==i.className?i.className:"ol-rotate",u=void 0!==i.label?i.label:"\u21e7",m=void 0!==i.compassClassName?i.compassClassName:"ol-compass";n.label_=null,"string"==typeof u?(n.label_=document.createElement("span"),n.label_.className=m,n.label_.textContent=u):(n.label_=u,n.label_.classList.add(m));var b=i.tipLabel?i.tipLabel:"Reset rotation",T=document.createElement("button");T.className=o+"-reset",T.setAttribute("type","button"),T.title=b,T.appendChild(n.label_),T.addEventListener("click",n.handleClick_.bind(n),!1);var V=n.element;return V.className=o+" "+d1+" "+$S,V.appendChild(T),n.callResetNorth_=i.resetNorth?i.resetNorth:void 0,n.duration_=void 0!==i.duration?i.duration:250,n.autoHide_=void 0===i.autoHide||i.autoHide,n.rotation_=void 0,n.autoHide_&&n.element.classList.add(Ew),n}return N8(t,r),t.prototype.handleClick_=function(e){e.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()},t.prototype.resetNorth_=function(){var n=this.getMap().getView();if(n){var i=n.getRotation();void 0!==i&&(this.duration_>0&&i%(2*Math.PI)!=0?n.animate({rotation:0,duration:this.duration_,easing:K0}):n.setRotation(0))}},t.prototype.render=function(e){var n=e.frameState;if(n){var i=n.viewState.rotation;if(i!=this.rotation_){var o="rotate("+i+"rad)";if(this.autoHide_){var u=this.element.classList.contains(Ew);u||0!==i?u&&0!==i&&this.element.classList.remove(Ew):this.element.classList.add(Ew)}this.label_.style.transform=o}this.rotation_=i}},t}(ix);const j8=B8;var U8=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),V8=function(r){function t(e){var n=this,i=e||{};n=r.call(this,{element:document.createElement("div"),target:i.target})||this;var o=void 0!==i.className?i.className:"ol-zoom",u=void 0!==i.delta?i.delta:1,m=void 0!==i.zoomInClassName?i.zoomInClassName:o+"-in",b=void 0!==i.zoomOutClassName?i.zoomOutClassName:o+"-out",T=void 0!==i.zoomInLabel?i.zoomInLabel:"+",F=void 0!==i.zoomOutLabel?i.zoomOutLabel:"\u2013",V=void 0!==i.zoomInTipLabel?i.zoomInTipLabel:"Zoom in",H=void 0!==i.zoomOutTipLabel?i.zoomOutTipLabel:"Zoom out",J=document.createElement("button");J.className=m,J.setAttribute("type","button"),J.title=V,J.appendChild("string"==typeof T?document.createTextNode(T):T),J.addEventListener("click",n.handleClick_.bind(n,u),!1);var ne=document.createElement("button");ne.className=b,ne.setAttribute("type","button"),ne.title=H,ne.appendChild("string"==typeof F?document.createTextNode(F):F),ne.addEventListener("click",n.handleClick_.bind(n,-u),!1);var Re=n.element;return Re.className=o+" "+d1+" "+$S,Re.appendChild(J),Re.appendChild(ne),n.duration_=void 0!==i.duration?i.duration:250,n}return U8(t,r),t.prototype.handleClick_=function(e,n){n.preventDefault(),this.zoomByDelta_(e)},t.prototype.zoomByDelta_=function(e){var i=this.getMap().getView();if(i){var o=i.getZoom();if(void 0!==o){var u=i.getConstrainedZoom(o+e);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:u,duration:this.duration_,easing:K0})):i.setZoom(u)}}},t}(ix);const G8=V8;var Z8=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),H8=function(r){function t(e){return(e=$a({},e)).controls||(e.controls=function(r){var t={},e=new _d;return(void 0===t.zoom||t.zoom)&&e.push(new G8(t.zoomOptions)),(void 0===t.rotate||t.rotate)&&e.push(new j8(t.rotateOptions)),(void 0===t.attribution||t.attribution)&&e.push(new z8(t.attributionOptions)),e}()),e.interactions||(e.interactions=tP({onFocusOnly:!0})),r.call(this,e)||this}return Z8(t,r),t.prototype.createRenderer=function(){return new r8(this)},t}(P8);const dT=H8;var W8=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),$8=function(r){function t(e){var n=r.call(this)||this;return n.geometries_=e||null,n.changeEventsKeys_=[],n.listenGeometriesChange_(),n}return W8(t,r),t.prototype.unlistenGeometriesChange_=function(){this.changeEventsKeys_.forEach(il),this.changeEventsKeys_.length=0},t.prototype.listenGeometriesChange_=function(){if(this.geometries_)for(var e=0,n=this.geometries_.length;e<n;++e)this.changeEventsKeys_.push(Zo(this.geometries_[e],"change",this.changed,this))},t.prototype.clone=function(){var e=new t(null);return e.setGeometries(this.geometries_),e.applyProperties(this),e},t.prototype.closestPointXY=function(e,n,i,o){if(o<l_(this.getExtent(),e,n))return o;for(var u=this.geometries_,m=0,b=u.length;m<b;++m)o=u[m].closestPointXY(e,n,i,o);return o},t.prototype.containsXY=function(e,n){for(var i=this.geometries_,o=0,u=i.length;o<u;++o)if(i[o].containsXY(e,n))return!0;return!1},t.prototype.computeExtent=function(e){u_(e);for(var n=this.geometries_,i=0,o=n.length;i<o;++i)OD(e,n[i].getExtent());return e},t.prototype.getGeometries=function(){return GP(this.geometries_)},t.prototype.getGeometriesArray=function(){return this.geometries_},t.prototype.getGeometriesArrayRecursive=function(){for(var e=[],n=this.geometries_,i=0,o=n.length;i<o;++i)n[i].getType()===this.getType()?e=e.concat(n[i].getGeometriesArrayRecursive()):e.push(n[i]);return e},t.prototype.getSimplifiedGeometry=function(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;for(var n=[],i=this.geometries_,o=!1,u=0,m=i.length;u<m;++u){var b=i[u],T=b.getSimplifiedGeometry(e);n.push(T),T!==b&&(o=!0)}if(o){var F=new t(null);return F.setGeometriesArray(n),F}return this.simplifiedGeometryMaxMinSquaredTolerance=e,this},t.prototype.getType=function(){return $t.GEOMETRY_COLLECTION},t.prototype.intersectsExtent=function(e){for(var n=this.geometries_,i=0,o=n.length;i<o;++i)if(n[i].intersectsExtent(e))return!0;return!1},t.prototype.isEmpty=function(){return 0===this.geometries_.length},t.prototype.rotate=function(e,n){for(var i=this.geometries_,o=0,u=i.length;o<u;++o)i[o].rotate(e,n);this.changed()},t.prototype.scale=function(e,n,i){var o=i;o||(o=wm(this.getExtent()));for(var u=this.geometries_,m=0,b=u.length;m<b;++m)u[m].scale(e,n,o);this.changed()},t.prototype.setGeometries=function(e){this.setGeometriesArray(GP(e))},t.prototype.setGeometriesArray=function(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()},t.prototype.applyTransform=function(e){for(var n=this.geometries_,i=0,o=n.length;i<o;++i)n[i].applyTransform(e);this.changed()},t.prototype.translate=function(e,n){for(var i=this.geometries_,o=0,u=i.length;o<u;++o)i[o].translate(e,n);this.changed()},t.prototype.disposeInternal=function(){this.unlistenGeometriesChange_(),r.prototype.disposeInternal.call(this)},t}(Bk);function GP(r){for(var t=[],e=0,n=r.length;e<n;++e)t.push(r[e].clone());return t}const Nw=$8;var X8=function(){function r(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}return r.prototype.getReadOptions=function(t,e){var n;if(e){var i=e.dataProjection?xa(e.dataProjection):this.readProjection(t);e.extent&&i&&i.getUnits()===Kd.TILE_PIXELS&&(i=xa(i)).setWorldExtent(e.extent),n={dataProjection:i,featureProjection:e.featureProjection}}return this.adaptOptions(n)},r.prototype.adaptOptions=function(t){return $a({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)},r.prototype.getType=function(){return li()},r.prototype.readFeature=function(t,e){return li()},r.prototype.readFeatures=function(t,e){return li()},r.prototype.readGeometry=function(t,e){return li()},r.prototype.readProjection=function(t){return li()},r.prototype.writeFeature=function(t,e){return li()},r.prototype.writeFeatures=function(t,e){return li()},r.prototype.writeGeometry=function(t,e){return li()},r}();const fT=X8;function T1(r,t,e){var o,n=e?xa(e.featureProjection):null,i=e?xa(e.dataProjection):null;if(o=n&&i&&!Sm(n,i)?(t?r.clone():r).transform(t?n:i,t?i:n):r,t&&e&&void 0!==e.decimals){var u=Math.pow(10,e.decimals);o===r&&(o=r.clone()),o.applyTransform(function(b){for(var T=0,F=b.length;T<F;++T)b[T]=Math.round(b[T]*u)/u;return b})}return o}var Y8=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),K8=function(r){function t(){return r.call(this)||this}return Y8(t,r),t.prototype.getType=function(){return"json"},t.prototype.readFeature=function(e,n){return this.readFeatureFromObject(Bw(e),this.getReadOptions(e,n))},t.prototype.readFeatures=function(e,n){return this.readFeaturesFromObject(Bw(e),this.getReadOptions(e,n))},t.prototype.readFeatureFromObject=function(e,n){return li()},t.prototype.readFeaturesFromObject=function(e,n){return li()},t.prototype.readGeometry=function(e,n){return this.readGeometryFromObject(Bw(e),this.getReadOptions(e,n))},t.prototype.readGeometryFromObject=function(e,n){return li()},t.prototype.readProjection=function(e){return this.readProjectionFromObject(Bw(e))},t.prototype.readProjectionFromObject=function(e){return li()},t.prototype.writeFeature=function(e,n){return JSON.stringify(this.writeFeatureObject(e,n))},t.prototype.writeFeatureObject=function(e,n){return li()},t.prototype.writeFeatures=function(e,n){return JSON.stringify(this.writeFeaturesObject(e,n))},t.prototype.writeFeaturesObject=function(e,n){return li()},t.prototype.writeGeometry=function(e,n){return JSON.stringify(this.writeGeometryObject(e,n))},t.prototype.writeGeometryObject=function(e,n){return li()},t}(fT);function Bw(r){return"string"==typeof r?JSON.parse(r)||null:null!==r?r:null}const J8=K8;function jw(r,t,e,n,i,o,u){var m,b,T=(e-t)/n;if(1===T)m=t;else if(2===T)m=t,b=i;else if(0!==T){for(var F=r[t],V=r[t+1],H=0,J=[0],ne=t+n;ne<e;ne+=n){var we=r[ne],Re=r[ne+1];H+=Math.sqrt((we-F)*(we-F)+(Re-V)*(Re-V)),J.push(H),F=we,V=Re}var qe=i*H,Ne=function(r,t,e){for(var n,i,o=r_,u=0,m=r.length,b=!1;u<m;)(i=+o(r[n=u+(m-u>>1)],t))<0?u=n+1:(m=n,b=!i);return b?u:~u}(J,qe);Ne<0?(b=(qe-J[-Ne-2])/(J[-Ne-1]-J[-Ne-2]),m=t+(-Ne-2)*n):m=t+Ne*n}var $e=u>1?u:2,tt=o||new Array($e);for(ne=0;ne<$e;++ne)tt[ne]=void 0===m?NaN:void 0===b?r[m+ne]:ry(r[m+ne],r[m+n+ne],b);return tt}function mT(r,t,e,n,i,o){if(e==t)return null;var u;if(i<r[t+n-1])return o?((u=r.slice(t,t+n))[n-1]=i,u):null;if(r[e-1]<i)return o?((u=r.slice(e-n,e))[n-1]=i,u):null;if(i==r[t+n-1])return r.slice(t,t+n);for(var m=t/n,b=e/n;m<b;){var T=m+b>>1;i<r[(T+1)*n-1]?b=T:m=T+1}var F=r[m*n-1];if(i==F)return r.slice((m-1)*n,(m-1)*n+n);var H=(i-F)/(r[(m+1)*n-1]-F);u=[];for(var J=0;J<n-1;++J)u.push(ry(r[(m-1)*n+J],r[m*n+J],H));return u.push(i),u}var eq=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),tq=function(r){function t(e,n){var i=r.call(this)||this;return i.flatMidpoint_=null,i.flatMidpointRevision_=-1,i.maxDelta_=-1,i.maxDeltaRevision_=-1,void 0===n||Array.isArray(e[0])?i.setCoordinates(e,n):i.setFlatCoordinates(n,e),i}return eq(t,r),t.prototype.appendCoordinate=function(e){this.flatCoordinates?og(this.flatCoordinates,e):this.flatCoordinates=e.slice(),this.changed()},t.prototype.clone=function(){var e=new t(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e},t.prototype.closestPointXY=function(e,n,i,o){return o<l_(this.getExtent(),e,n)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(OS(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),FS(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,n,i,o))},t.prototype.forEachSegment=function(e){return Xk(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)},t.prototype.getCoordinateAtM=function(e,n){return"XYM"!=this.layout&&"XYZM"!=this.layout?null:mT(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,void 0!==n&&n)},t.prototype.getCoordinates=function(){return Jy(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},t.prototype.getCoordinateAt=function(e,n){return jw(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,n,this.stride)},t.prototype.getLength=function(){return tT(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},t.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},t.prototype.getSimplifiedGeometryInternal=function(e){var n=[];return n.length=_w(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,n,0),new t(n,"XY")},t.prototype.getType=function(){return $t.LINE_STRING},t.prototype.intersectsExtent=function(e){return xw(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)},t.prototype.setCoordinates=function(e,n){this.setLayout(n,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=vw(this.flatCoordinates,0,e,this.stride),this.changed()},t}(Ky);const Lf=tq;var nq=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),rq=function(r){function t(e,n,i){var o=r.call(this)||this;if(o.ends_=[],o.maxDelta_=-1,o.maxDeltaRevision_=-1,Array.isArray(e[0]))o.setCoordinates(e,n);else if(void 0!==n&&i)o.setFlatCoordinates(n,e),o.ends_=i;else{for(var u=o.getLayout(),m=e,b=[],T=[],F=0,V=m.length;F<V;++F){var H=m[F];0===F&&(u=H.getLayout()),og(b,H.getFlatCoordinates()),T.push(b.length)}o.setFlatCoordinates(u,b),o.ends_=T}return o}return nq(t,r),t.prototype.appendLineString=function(e){this.flatCoordinates?og(this.flatCoordinates,e.getFlatCoordinates().slice()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},t.prototype.clone=function(){var e=new t(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e},t.prototype.closestPointXY=function(e,n,i,o){return o<l_(this.getExtent(),e,n)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(LS(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),zS(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,n,i,o))},t.prototype.getCoordinateAtM=function(e,n,i){return"XYM"!=this.layout&&"XYZM"!=this.layout||0===this.flatCoordinates.length?null:function(r,t,e,n,i,o,u){if(u)return mT(r,t,e[e.length-1],n,i,o);var m;if(i<r[n-1])return o?((m=r.slice(0,n))[n-1]=i,m):null;if(r[r.length-1]<i)return o?((m=r.slice(r.length-n))[n-1]=i,m):null;for(var b=0,T=e.length;b<T;++b){var F=e[b];if(t!=F){if(i<r[t+n-1])return null;if(i<=r[F-1])return mT(r,t,F,n,i,!1);t=F}}return null}(this.flatCoordinates,0,this.ends_,this.stride,e,void 0!==n&&n,void 0!==i&&i)},t.prototype.getCoordinates=function(){return p1(this.flatCoordinates,0,this.ends_,this.stride)},t.prototype.getEnds=function(){return this.ends_},t.prototype.getLineString=function(e){return e<0||this.ends_.length<=e?null:new Lf(this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e]),this.layout)},t.prototype.getLineStrings=function(){for(var e=this.flatCoordinates,n=this.ends_,i=this.layout,o=[],u=0,m=0,b=n.length;m<b;++m){var T=n[m],F=new Lf(e.slice(u,T),i);o.push(F),u=T}return o},t.prototype.getFlatMidpoints=function(){for(var e=[],n=this.flatCoordinates,i=0,o=this.ends_,u=this.stride,m=0,b=o.length;m<b;++m){var T=o[m];og(e,jw(n,i,T,u,.5)),i=T}return e},t.prototype.getSimplifiedGeometryInternal=function(e){var n=[],i=[];return n.length=function(r,t,e,n,i,o,u,m){for(var b=0,T=e.length;b<T;++b){var F=e[b];u=_w(r,t,F,n,i,o,u),m.push(u),t=F}return u}(this.flatCoordinates,0,this.ends_,this.stride,e,n,0,i),new t(n,"XY",i)},t.prototype.getType=function(){return $t.MULTI_LINE_STRING},t.prototype.intersectsExtent=function(e){return function(r,t,e,n,i){for(var o=0,u=e.length;o<u;++o){if(xw(r,t,e[o],n,i))return!0;t=e[o]}return!1}(this.flatCoordinates,0,this.ends_,this.stride,e)},t.prototype.setCoordinates=function(e,n){this.setLayout(n,e,2),this.flatCoordinates||(this.flatCoordinates=[]);var i=NS(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()},t}(Ky);const Uw=rq;var iq=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),oq=function(r){function t(e,n){var i=r.call(this)||this;return n&&!Array.isArray(e[0])?i.setFlatCoordinates(n,e):i.setCoordinates(e,n),i}return iq(t,r),t.prototype.appendPoint=function(e){this.flatCoordinates?og(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.changed()},t.prototype.clone=function(){var e=new t(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e},t.prototype.closestPointXY=function(e,n,i,o){if(o<l_(this.getExtent(),e,n))return o;for(var u=this.flatCoordinates,m=this.stride,b=0,T=u.length;b<T;b+=m){var F=p_(e,n,u[b],u[b+1]);if(F<o){o=F;for(var V=0;V<m;++V)i[V]=u[b+V];i.length=m}}return o},t.prototype.getCoordinates=function(){return Jy(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},t.prototype.getPoint=function(e){return e<0||(this.flatCoordinates?this.flatCoordinates.length/this.stride:0)<=e?null:new Kp(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)},t.prototype.getPoints=function(){for(var e=this.flatCoordinates,n=this.layout,i=this.stride,o=[],u=0,m=e.length;u<m;u+=i){var b=new Kp(e.slice(u,u+i),n);o.push(b)}return o},t.prototype.getType=function(){return $t.MULTI_POINT},t.prototype.intersectsExtent=function(e){for(var n=this.flatCoordinates,i=this.stride,o=0,u=n.length;o<u;o+=i)if(KE(e,n[o],n[o+1]))return!0;return!1},t.prototype.setCoordinates=function(e,n){this.setLayout(n,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=vw(this.flatCoordinates,0,e,this.stride),this.changed()},t}(Ky);const I1=oq;function qP(r,t,e,n){for(var i=[],o=[1/0,1/0,-1/0,-1/0],u=0,m=e.length;u<m;++u){var b=e[u];o=QE(r,t,b[0],n),i.push((o[0]+o[2])/2,(o[1]+o[3])/2),t=b[b.length-1]}return i}var aq=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),sq=function(r){function t(e,n,i){var o=r.call(this)||this;if(o.endss_=[],o.flatInteriorPointsRevision_=-1,o.flatInteriorPoints_=null,o.maxDelta_=-1,o.maxDeltaRevision_=-1,o.orientedRevision_=-1,o.orientedFlatCoordinates_=null,!i&&!Array.isArray(e[0])){for(var u=o.getLayout(),m=e,b=[],T=[],F=0,V=m.length;F<V;++F){var H=m[F];0===F&&(u=H.getLayout());for(var J=b.length,ne=H.getEnds(),we=0,Re=ne.length;we<Re;++we)ne[we]+=J;og(b,H.getFlatCoordinates()),T.push(ne)}n=u,e=b,i=T}return void 0!==n&&i?(o.setFlatCoordinates(n,e),o.endss_=i):o.setCoordinates(e,n),o}return aq(t,r),t.prototype.appendPolygon=function(e){var n;if(this.flatCoordinates){var i=this.flatCoordinates.length;og(this.flatCoordinates,e.getFlatCoordinates());for(var o=0,u=(n=e.getEnds().slice()).length;o<u;++o)n[o]+=i}else this.flatCoordinates=e.getFlatCoordinates().slice(),n=e.getEnds().slice(),this.endss_.push();this.endss_.push(n),this.changed()},t.prototype.clone=function(){for(var e=this.endss_.length,n=new Array(e),i=0;i<e;++i)n[i]=this.endss_[i].slice();var o=new t(this.flatCoordinates.slice(),this.layout,n);return o.applyProperties(this),o},t.prototype.closestPointXY=function(e,n,i,o){return o<l_(this.getExtent(),e,n)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(r,t,e,n,i){for(var o=0,u=e.length;o<u;++o){var m=e[o];i=LS(r,t,m,n,i),t=m[m.length-1]}return i}(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(r,t,e,n,i,o,u,m,b,T,F){for(var V=[NaN,NaN],H=0,J=e.length;H<J;++H){var ne=e[H];T=zS(r,t,ne,n,i,true,u,m,b,T,V),t=ne[ne.length-1]}return T}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,0,e,n,i,o))},t.prototype.containsXY=function(e,n){return function(r,t,e,n,i,o){if(0===e.length)return!1;for(var u=0,m=e.length;u<m;++u){var b=e[u];if(jS(r,t,b,n,i,o))return!0;t=b[b.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,n)},t.prototype.getArea=function(){return function(r,t,e,n){for(var i=0,o=0,u=e.length;o<u;++o){var m=e[o];i+=Hk(r,t,m,n),t=m[m.length-1]}return i}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},t.prototype.getCoordinates=function(e){var n;return void 0!==e?Jk(n=this.getOrientedFlatCoordinates().slice(),0,this.endss_,this.stride,e):n=this.flatCoordinates,BS(n,0,this.endss_,this.stride)},t.prototype.getEndss=function(){return this.endss_},t.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var e=qP(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=$k(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},t.prototype.getInteriorPoints=function(){return new I1(this.getFlatInteriorPoints().slice(),"XYM")},t.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var e=this.flatCoordinates;!function(r,t,e,n,i){for(var o=0,u=e.length;o<u;++o){var m=e[o];if(!Kk(r,t,m,n,undefined))return!1;m.length&&(t=m[m.length-1])}return!0}(e,0,this.endss_,this.stride)?(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=Jk(this.orientedFlatCoordinates_,0,this.endss_,this.stride)):this.orientedFlatCoordinates_=e,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},t.prototype.getSimplifiedGeometryInternal=function(e){var n=[],i=[];return n.length=function(r,t,e,n,i,o,u,m){for(var b=0,T=e.length;b<T;++b){var F=e[b],V=[];u=qk(r,t,F,n,i,o,u,V),m.push(V),t=F[F.length-1]}return u}(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),n,0,i),new t(n,"XY",i)},t.prototype.getPolygon=function(e){if(e<0||this.endss_.length<=e)return null;var n;if(0===e)n=0;else{var i=this.endss_[e-1];n=i[i.length-1]}var o=this.endss_[e].slice(),u=o[o.length-1];if(0!==n)for(var m=0,b=o.length;m<b;++m)o[m]-=n;return new Tm(this.flatCoordinates.slice(n,u),this.layout,o)},t.prototype.getPolygons=function(){for(var e=this.layout,n=this.flatCoordinates,i=this.endss_,o=[],u=0,m=0,b=i.length;m<b;++m){var T=i[m].slice(),F=T[T.length-1];if(0!==u)for(var V=0,H=T.length;V<H;++V)T[V]-=u;var J=new Tm(n.slice(u,F),e,T);o.push(J),u=F}return o},t.prototype.getType=function(){return $t.MULTI_POLYGON},t.prototype.intersectsExtent=function(e){return function(r,t,e,n,i){for(var o=0,u=e.length;o<u;++o){var m=e[o];if(Yk(r,t,m,n,i))return!0;t=m[m.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)},t.prototype.setCoordinates=function(e,n){this.setLayout(n,e,3),this.flatCoordinates||(this.flatCoordinates=[]);var i=function(r,t,e,n,i){for(var o=i||[],u=0,m=0,b=e.length;m<b;++m){var T=NS(r,t,e[m],n,o[u]);o[u++]=T,t=T[T.length-1]}return o.length=u,o}(this.flatCoordinates,0,e,this.stride,this.endss_);if(0===i.length)this.flatCoordinates.length=0;else{var o=i[i.length-1];this.flatCoordinates.length=0===o.length?0:o[o.length-1]}this.changed()},t}(Ky);const Vw=sq;var lq=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),uq=function(r){function t(e){var n=this,i=e||{};return(n=r.call(this)||this).dataProjection=xa(i.dataProjection?i.dataProjection:"EPSG:4326"),i.featureProjection&&(n.defaultFeatureProjection=xa(i.featureProjection)),n.geometryName_=i.geometryName,n.extractGeometryName_=i.extractGeometryName,n.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"],n}return lq(t,r),t.prototype.readFeatureFromObject=function(e,n){var i,o=gT((i="Feature"===e.type?e:{type:"Feature",geometry:e,properties:null}).geometry,n),u=new dg;return this.geometryName_?u.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in i!==void 0&&u.setGeometryName(i.geometry_name),u.setGeometry(o),"id"in i&&u.setId(i.id),i.properties&&u.setProperties(i.properties,!0),u},t.prototype.readFeaturesFromObject=function(e,n){var o=null;if("FeatureCollection"===e.type){o=[];for(var m=e.features,b=0,T=m.length;b<T;++b)o.push(this.readFeatureFromObject(m[b],n))}else o=[this.readFeatureFromObject(e,n)];return o},t.prototype.readGeometryFromObject=function(e,n){return gT(e,n)},t.prototype.readProjectionFromObject=function(e){var i,n=e.crs;return n?"name"==n.type?i=xa(n.properties.name):"EPSG"===n.type?i=xa("EPSG:"+n.properties.code):bo(!1,36):i=this.dataProjection,i},t.prototype.writeFeatureObject=function(e,n){n=this.adaptOptions(n);var i={type:"Feature",geometry:null,properties:null},o=e.getId();if(void 0!==o&&(i.id=o),!e.hasProperties())return i;var u=e.getProperties(),m=e.getGeometry();return m&&(i.geometry=yT(m,n),delete u[e.getGeometryName()]),s_(u)||(i.properties=u),i},t.prototype.writeFeaturesObject=function(e,n){n=this.adaptOptions(n);for(var i=[],o=0,u=e.length;o<u;++o)i.push(this.writeFeatureObject(e[o],n));return{type:"FeatureCollection",features:i}},t.prototype.writeGeometryObject=function(e,n){return yT(e,this.adaptOptions(n))},t}(J8);function gT(r,t){if(!r)return null;var e;switch(r.type){case $t.POINT:e=function(r){return new Kp(r.coordinates)}(r);break;case $t.LINE_STRING:e=function(r){return new Lf(r.coordinates)}(r);break;case $t.POLYGON:e=function(r){return new Tm(r.coordinates)}(r);break;case $t.MULTI_POINT:e=function(r){return new I1(r.coordinates)}(r);break;case $t.MULTI_LINE_STRING:e=function(r){return new Uw(r.coordinates)}(r);break;case $t.MULTI_POLYGON:e=function(r){return new Vw(r.coordinates)}(r);break;case $t.GEOMETRY_COLLECTION:e=function(r,t){var e=r.geometries.map(function(n){return gT(n,undefined)});return new Nw(e)}(r);break;default:throw new Error("Unsupported GeoJSON type: "+r.type)}return T1(e,!1,t)}function yT(r,t){var n,e=(r=T1(r,!0,t)).getType();switch(e){case $t.POINT:n=function(r,t){return{type:"Point",coordinates:r.getCoordinates()}}(r);break;case $t.LINE_STRING:n=function(r,t){return{type:"LineString",coordinates:r.getCoordinates()}}(r);break;case $t.POLYGON:n=function(r,t){var e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:r.getCoordinates(e)}}(r,t);break;case $t.MULTI_POINT:n=function(r,t){return{type:"MultiPoint",coordinates:r.getCoordinates()}}(r);break;case $t.MULTI_LINE_STRING:n=function(r,t){return{type:"MultiLineString",coordinates:r.getCoordinates()}}(r);break;case $t.MULTI_POLYGON:n=function(r,t){var e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:r.getCoordinates(e)}}(r,t);break;case $t.GEOMETRY_COLLECTION:n=function(r,t){var e=r.getGeometriesArray().map(function(n){var i=$a({},t);return delete i.featureProjection,yT(n,i)});return{type:"GeometryCollection",geometries:e}}(r,t);break;case $t.CIRCLE:n={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+e)}return n}const Gw=uq;var Eq=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}();!function(r){function t(e){var n=r.call(this,{attributions:e.attributions,wrapX:e.wrapX})||this;return n.resolution=void 0,n.distance=void 0!==e.distance?e.distance:20,n.minDistance=e.minDistance||0,n.interpolationRatio=0,n.features=[],n.geometryFunction=e.geometryFunction||function(i){var o=i.getGeometry();return bo(o.getType()==$t.POINT,10),o},n.createCustomCluster_=e.createCluster,n.source=null,n.boundRefresh_=n.refresh.bind(n),n.updateDistance(n.distance,n.minDistance),n.setSource(e.source||null),n}Eq(t,r),t.prototype.clear=function(e){this.features.length=0,r.prototype.clear.call(this,e)},t.prototype.getDistance=function(){return this.distance},t.prototype.getSource=function(){return this.source},t.prototype.loadFeatures=function(e,n,i){this.source.loadFeatures(e,n,i),n!==this.resolution&&(this.resolution=n,this.refresh())},t.prototype.setDistance=function(e){this.updateDistance(e,this.minDistance)},t.prototype.setMinDistance=function(e){this.updateDistance(this.distance,e)},t.prototype.getMinDistance=function(){return this.minDistance},t.prototype.setSource=function(e){this.source&&this.source.removeEventListener("change",this.boundRefresh_),this.source=e,e&&e.addEventListener("change",this.boundRefresh_),this.refresh()},t.prototype.refresh=function(){this.clear(),this.cluster(),this.addFeatures(this.features)},t.prototype.updateDistance=function(e,n){var i=0===e?0:Math.min(n,e)/e,o=e!==this.distance||this.interpolationRatio!==i;this.distance=e,this.minDistance=n,this.interpolationRatio=i,o&&this.refresh()},t.prototype.cluster=function(){if(void 0!==this.resolution&&this.source)for(var e=[1/0,1/0,-1/0,-1/0],n=this.distance*this.resolution,i=this.source.getFeatures(),o={},u=0,m=i.length;u<m;u++){var b=i[u];if(!(Si(b)in o)){var T=this.geometryFunction(b);if(T){V0(T.getCoordinates(),e),kf(e,n,e);var V=this.source.getFeaturesInExtent(e).filter(function(H){var J=Si(H);return!(J in o)&&(o[J]=!0,!0)});this.features.push(this.createCluster(V,e))}}}},t.prototype.createCluster=function(e,n){for(var i=[0,0],o=e.length-1;o>=0;--o){var u=this.geometryFunction(e[o]);u?Dk(i,u.getCoordinates()):e.splice(o,1)}Pk(i,1/e.length);var m=wm(n),b=this.interpolationRatio,T=new Kp([i[0]*(1-b)+m[0]*b,i[1]*(1-b)+m[1]*b]);return this.createCustomCluster_?this.createCustomCluster_(T,e):new dg({geometry:T,features:e})}}(__);var Tq=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Iq=function(r){function t(e){return r.call(this,e||{})||this}return Tq(t,r),t}(WS);const Mq=Iq;var Aq=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Dq=function(r){function t(e){var n=r.call(this,e)||this;return n.image_=null,n}return Aq(t,r),t.prototype.getImage=function(){return this.image_?this.image_.getImage():null},t.prototype.prepareFrame=function(e){var n=e.layerStatesArray[e.layerIndex],i=e.pixelRatio,o=e.viewState,u=o.resolution,m=this.getLayer().getSource(),b=e.viewHints,T=e.extent;if(void 0!==n.extent&&(T=sg(T,ug(n.extent))),!b[0]&&!b[1]&&!nw(T))if(m){var H=m.getImage(T,u,i,o.projection);H&&this.loadImage(H)&&(this.image_=H)}else this.image_=null;return!!this.image_},t.prototype.renderFrame=function(e,n){var i=this.image_,o=i.getExtent(),u=i.getResolution(),m=i.getPixelRatio(),b=e.layerStatesArray[e.layerIndex],T=e.pixelRatio,F=e.viewState,V=F.center,J=e.size,ne=T*u/(F.resolution*m),we=Math.round(J[0]*T),Re=Math.round(J[1]*T),qe=F.rotation;if(qe){var Ne=Math.round(Math.sqrt(we*we+Re*Re));we=Ne,Re=Ne}ef(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/T,1/T,qe,-we/2,-Re/2),h1(this.inversePixelTransform,this.pixelTransform);var $e=yw(this.pixelTransform);this.useContainer(n,$e,b.opacity);var tt=this.context,bt=tt.canvas;bt.width!=we||bt.height!=Re?(bt.width=we,bt.height=Re):this.containerReused||tt.clearRect(0,0,we,Re);var dn=!1,Kt=!0;if(b.extent){var vn=ug(b.extent);(dn=(Kt=Cc(vn,e.extent))&&!ag(vn,e.extent))&&this.clipUnrotated(tt,e,vn)}var Bt=i.getImage(),Dn=ef(this.tempTransform,we/2,Re/2,ne,ne,0,m*(o[0]-V[0])/u,m*(V[1]-o[3])/u);this.renderedResolution=u*T/m;var un=Bt.width*Dn[0],Fn=Bt.height*Dn[3];if($a(tt,this.getLayer().getSource().getContextOptions()),this.preRender(tt,e),Kt&&un>=.5&&Fn>=.5){var kr=Dn[4],Jr=Dn[5],Ur=b.opacity,Mr=void 0;1!==Ur&&(Mr=tt.globalAlpha,tt.globalAlpha=Ur),tt.drawImage(Bt,0,0,+Bt.width,+Bt.height,Math.round(kr),Math.round(Jr),Math.round(un),Math.round(Fn)),1!==Ur&&(tt.globalAlpha=Mr)}return this.postRender(tt,e),dn&&tt.restore(),$e!==bt.style.transform&&(bt.style.transform=$e),this.container},t}(eT);const kq=Dq;var Pq=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}();!function(r){function t(e){return r.call(this,e)||this}Pq(t,r),t.prototype.createRenderer=function(){return new kq(this)}}(Mq);var Oq=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}();!function(r){function t(e){var n=this,i=void 0!==e.crossOrigin?e.crossOrigin:null,o=void 0!==e.imageLoadFunction?e.imageLoadFunction:ek;return(n=r.call(this,{attributions:e.attributions,imageSmoothing:e.imageSmoothing,projection:xa(e.projection)})||this).url_=e.url,n.imageExtent_=e.imageExtent,n.image_=new AP(n.imageExtent_,void 0,1,n.url_,i,o),n.imageSize_=e.imageSize?e.imageSize:null,n.image_.addEventListener("change",n.handleImageChange.bind(n)),n}Oq(t,r),t.prototype.getImageExtent=function(){return this.imageExtent_},t.prototype.getImageInternal=function(e,n,i,o){return Cc(e,this.image_.getExtent())?this.image_:null},t.prototype.getUrl=function(){return this.url_},t.prototype.handleImageChange=function(e){if(2==this.image_.getState()){var n=this.image_.getExtent(),i=this.image_.getImage(),o=void 0,u=void 0;this.imageSize_?(o=this.imageSize_[0],u=this.imageSize_[1]):(o=i.width,u=i.height);var m=Xs(n),b=mh(n),T=m/o,F=b/u,V=o,H=u;if(T>F?V=Math.round(m/F):H=Math.round(b/T),V!==o||H!==u){var J=vd(V,H);$a(J,this.getContextOptions());var ne=J.canvas;J.drawImage(i,0,0,o,u,0,0,ne.width,ne.height),this.image_.setImage(ne)}}r.prototype.handleImageChange.call(this,e)}}(dS);var zq=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Nq=function(r){function t(e,n,i){var o=r.call(this)||this,u=i||{};return o.tileCoord=e,o.state=n,o.interimTile=null,o.key="",o.transition_=void 0===u.transition?250:u.transition,o.transitionStarts_={},o}return zq(t,r),t.prototype.changed=function(){this.dispatchEvent("change")},t.prototype.release=function(){},t.prototype.getKey=function(){return this.key+"/"+this.tileCoord},t.prototype.getInterimTile=function(){if(!this.interimTile)return this;var e=this.interimTile;do{if(2==e.getState())return this.transition_=0,e;e=e.interimTile}while(e);return this},t.prototype.refreshInterimChain=function(){if(this.interimTile){var e=this.interimTile,n=this;do{if(2==e.getState()){e.interimTile=null;break}1==e.getState()?n=e:0==e.getState()?n.interimTile=e.interimTile:n=e,e=n.interimTile}while(e)}},t.prototype.getTileCoord=function(){return this.tileCoord},t.prototype.getState=function(){return this.state},t.prototype.setState=function(e){if(3!==this.state&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()},t.prototype.load=function(){li()},t.prototype.getAlpha=function(e,n){if(!this.transition_)return 1;var i=this.transitionStarts_[e];if(i){if(-1===i)return 1}else this.transitionStarts_[e]=i=n;var o=n-i+1e3/60;return o>=this.transition_?1:Ck(o/this.transition_)},t.prototype.inTransition=function(e){return!!this.transition_&&-1!==this.transitionStarts_[e]},t.prototype.endTransition=function(e){this.transition_&&(this.transitionStarts_[e]=-1)},t}(U0);const qw=Nq;var Bq=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),jq=function(r){function t(e,n,i,o,u,m){var b=r.call(this,e,n,m)||this;return b.crossOrigin_=o,b.src_=i,b.key=i,b.image_=new Image,null!==o&&(b.image_.crossOrigin=o),b.unlisten_=null,b.tileLoadFunction_=u,b}return Bq(t,r),t.prototype.getImage=function(){return this.image_},t.prototype.setImage=function(e){this.image_=e,this.state=2,this.unlistenImage_(),this.changed()},t.prototype.handleImageError_=function(){this.state=3,this.unlistenImage_(),this.image_=function(){var r=vd(1,1);return r.fillStyle="rgba(0,0,0,0)",r.fillRect(0,0,1,1),r.canvas}(),this.changed()},t.prototype.handleImageLoad_=function(){var e=this.image_;this.state=e.naturalWidth&&e.naturalHeight?2:4,this.unlistenImage_(),this.changed()},t.prototype.load=function(){3==this.state&&(this.state=0,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),0==this.state&&(this.state=1,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=iT(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},t.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},t}(qw);const Vq=jq;var Gq=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),qq=function(r){function t(e,n,i,o,u,m,b,T,F,V,H,J){var ne=r.call(this,u,0)||this;ne.renderEdges_=void 0!==H&&H,ne.contextOptions_=J,ne.pixelRatio_=b,ne.gutter_=T,ne.canvas_=null,ne.sourceTileGrid_=n,ne.targetTileGrid_=o,ne.wrappedTileCoord_=m||u,ne.sourceTiles_=[],ne.sourcesListenerKeys_=null,ne.sourceZ_=0;var we=o.getTileCoordExtent(ne.wrappedTileCoord_),Re=ne.targetTileGrid_.getExtent(),qe=ne.sourceTileGrid_.getExtent(),Ne=Re?sg(we,Re):we;if(0===tw(Ne))return ne.state=4,ne;var $e=e.getExtent();$e&&(qe=qe?sg(qe,$e):$e);var tt=o.getResolution(ne.wrappedTileCoord_[0]),bt=function(r,t,e,n){var i=wm(e),o=l1(r,t,i,n);return(!isFinite(o)||o<=0)&&eS(e,function(u){return o=l1(r,t,u,n),isFinite(o)&&o>0}),o}(e,i,Ne,tt);if(!isFinite(bt)||bt<=0)return ne.state=4,ne;if(ne.triangulation_=new qD(e,i,Ne,qe,bt*(void 0!==V?V:.5),tt),0===ne.triangulation_.getTriangles().length)return ne.state=4,ne;ne.sourceZ_=n.getZForResolution(bt);var Kt=ne.triangulation_.calculateSourceExtent();if(qe&&(e.canWrapX()?(Kt[1]=Wc(Kt[1],qe[1],qe[3]),Kt[3]=Wc(Kt[3],qe[1],qe[3])):Kt=sg(Kt,qe)),tw(Kt)){for(var vn=n.getTileRangeForExtentAndZ(Kt,ne.sourceZ_),Bt=vn.minX;Bt<=vn.maxX;Bt++)for(var Dn=vn.minY;Dn<=vn.maxY;Dn++){var un=F(ne.sourceZ_,Bt,Dn,b);un&&ne.sourceTiles_.push(un)}0===ne.sourceTiles_.length&&(ne.state=4)}else ne.state=4;return ne}return Gq(t,r),t.prototype.getImage=function(){return this.canvas_},t.prototype.reproject_=function(){var e=[];if(this.sourceTiles_.forEach(function(F,V,H){F&&2==F.getState()&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(F.tileCoord),image:F.getImage()})}.bind(this)),this.sourceTiles_.length=0,0===e.length)this.state=3;else{var n=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(n),o="number"==typeof i?i:i[0],u="number"==typeof i?i:i[1],m=this.targetTileGrid_.getResolution(n),b=this.sourceTileGrid_.getResolution(this.sourceZ_),T=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=XD(o,u,this.pixelRatio_,b,this.sourceTileGrid_.getExtent(),m,T,this.triangulation_,e,this.gutter_,this.renderEdges_,this.contextOptions_),this.state=2}this.changed()},t.prototype.load=function(){if(0==this.state){this.state=1,this.changed();var e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(n,i,o){var u=n.getState();if(0==u||1==u){e++;var m=Zo(n,"change",function(b){var T=n.getState();(2==T||3==T||4==T)&&(il(m),0==--e&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(m)}}.bind(this)),0===e?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(n,i,o){0==n.getState()&&n.load()})}},t.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(il),this.sourcesListenerKeys_=null},t}(qw);const Zq=qq;function Hq(r,t){var e=/\{z\}/g,n=/\{x\}/g,i=/\{y\}/g,o=/\{-y\}/g;return function(u,m,b){if(u)return r.replace(e,u[0].toString()).replace(n,u[1].toString()).replace(i,u[2].toString()).replace(o,function(){var F=t.getFullTileRange(u[0]);return bo(F,55),(F.getHeight()-u[2]-1).toString()})}}function _T(r){return 1===r.length?r[0]:function(t,e,n){if(t){var o=Zy(ik(t),r.length);return r[o](t,e,n)}}}function WP(r){var t=[],e=/\{([a-z])-([a-z])\}/.exec(r);if(e){var n=e[1].charCodeAt(0),i=e[2].charCodeAt(0),o=void 0;for(o=n;o<=i;++o)t.push(r.replace(e[0],String.fromCharCode(o)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(r)){for(var u=parseInt(e[2],10),m=parseInt(e[1],10);m<=u;m++)t.push(r.replace(e[0],m.toString()));return t}return t.push(r),t}var $q=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Xq=function(r){function t(e){var n=r.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection})||this;return n.generateTileUrlFunction_=n.tileUrlFunction===t.prototype.tileUrlFunction,n.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(n.tileUrlFunction=e.tileUrlFunction),n.urls=null,e.urls?n.setUrls(e.urls):e.url&&n.setUrl(e.url),n.tileLoadingKeys_={},n}return $q(t,r),t.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},t.prototype.getTileUrlFunction=function(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction},t.prototype.getUrls=function(){return this.urls},t.prototype.handleTileChange=function(e){var u,n=e.target,i=Si(n),o=n.getState();1==o?(this.tileLoadingKeys_[i]=!0,u="tileloadstart"):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],u=3==o?"tileloaderror":2==o?"tileloadend":void 0),null!=u&&this.dispatchEvent(new OU(u,n))},t.prototype.setTileLoadFunction=function(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()},t.prototype.setTileUrlFunction=function(e,n){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),void 0!==n?this.setKey(n):this.changed()},t.prototype.setUrl=function(e){var n=WP(e);this.urls=n,this.setUrls(n)},t.prototype.setUrls=function(e){this.urls=e;var n=e.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(function(r,t){for(var e=r.length,n=new Array(e),i=0;i<e;++i)n[i]=Hq(r[i],t);return _T(n)}(e,this.tileGrid),n):this.setKey(n)},t.prototype.tileUrlFunction=function(e,n,i){},t.prototype.useTile=function(e,n,i){var o=X0(e,n,i);this.tileCache.containsKey(o)&&this.tileCache.get(o)},t}(fk);const $P=Xq;var Yq=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Kq=function(r){function t(e){var n=r.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Jq,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection})||this;return n.crossOrigin=void 0!==e.crossOrigin?e.crossOrigin:null,n.tileClass=void 0!==e.tileClass?e.tileClass:Vq,n.tileCacheForProjection={},n.tileGridForProjection={},n.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,n.contextOptions_=!1===e.imageSmoothing?aS:void 0,n.renderReprojectionEdges_=!1,n}return Yq(t,r),t.prototype.canExpireCache=function(){if(this.tileCache.canExpireCache())return!0;for(var e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1},t.prototype.expireCache=function(e,n){var i=this.getTileCacheForProjection(e);for(var o in this.tileCache.expireCache(this.tileCache==i?n:{}),this.tileCacheForProjection){var u=this.tileCacheForProjection[o];u.expireCache(u==i?n:{})}},t.prototype.getContextOptions=function(){return this.contextOptions_},t.prototype.getGutterForProjection=function(e){return this.getProjection()&&e&&!Sm(this.getProjection(),e)?0:this.getGutter()},t.prototype.getGutter=function(){return 0},t.prototype.getKey=function(){return r.prototype.getKey.call(this)+(this.contextOptions_?"\n"+JSON.stringify(this.contextOptions_):"")},t.prototype.getOpaque=function(e){return!(this.getProjection()&&e&&!Sm(this.getProjection(),e))&&r.prototype.getOpaque.call(this,e)},t.prototype.getTileGridForProjection=function(e){var n=this.getProjection();if(this.tileGrid&&(!n||Sm(n,e)))return this.tileGrid;var i=Si(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=ck(e)),this.tileGridForProjection[i]},t.prototype.getTileCacheForProjection=function(e){var n=this.getProjection();if(!n||Sm(n,e))return this.tileCache;var i=Si(e);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new fS(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]},t.prototype.createTile_=function(e,n,i,o,u,m){var b=[e,n,i],T=this.getTileCoordForTileUrlFunction(b,u),F=T?this.tileUrlFunction(T,o,u):void 0,V=new this.tileClass(b,void 0!==F?0:4,void 0!==F?F:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return V.key=m,V.addEventListener("change",this.handleTileChange.bind(this)),V},t.prototype.getTile=function(e,n,i,o,u){var m=this.getProjection();if(!m||!u||Sm(m,u))return this.getTileInternal(e,n,i,o,m||u);var b=this.getTileCacheForProjection(u),T=[e,n,i],F=void 0,V=nk(T);b.containsKey(V)&&(F=b.get(V));var H=this.getKey();if(F&&F.key==H)return F;var J=this.getTileGridForProjection(m),ne=this.getTileGridForProjection(u),we=this.getTileCoordForTileUrlFunction(T,u),Re=new Zq(m,J,u,ne,T,we,this.getTilePixelRatio(o),this.getGutter(),function(qe,Ne,$e,tt){return this.getTileInternal(qe,Ne,$e,tt,m)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.contextOptions_);return Re.key=H,F?(Re.interimTile=F,Re.refreshInterimChain(),b.replace(V,Re)):b.set(V,Re),Re},t.prototype.getTileInternal=function(e,n,i,o,u){var m=null,b=X0(e,n,i),T=this.getKey();if(this.tileCache.containsKey(b)){if((m=this.tileCache.get(b)).key!=T){var F=m;(m=this.createTile_(e,n,i,o,u,T)).interimTile=0==F.getState()?F.interimTile:F,m.refreshInterimChain(),this.tileCache.replace(b,m)}}else m=this.createTile_(e,n,i,o,u,T),this.tileCache.set(b,m);return m},t.prototype.setRenderReprojectionEdges=function(e){if(this.renderReprojectionEdges_!=e){for(var n in this.renderReprojectionEdges_=e,this.tileCacheForProjection)this.tileCacheForProjection[n].clear();this.changed()}},t.prototype.setTileGridForProjection=function(e,n){var i=xa(e);if(i){var o=Si(i);o in this.tileGridForProjection||(this.tileGridForProjection[o]=n)}},t}($P);function Jq(r,t){r.getImage().src=t}const XP=Kq;function ox(r,t){var e=[];Object.keys(t).forEach(function(i){null!=t[i]&&e.push(i+"="+encodeURIComponent(t[i]))});var n=e.join("&");return(r=-1===(r=r.replace(/[?&]$/,"")).indexOf("?")?r+"?":r+"&")+n}function YP(r,t){for(var e=(""+r).split("."),n=(""+t).split("."),i=0;i<Math.max(e.length,n.length);i++){var o=parseInt(e[i]||"0",10),u=parseInt(n[i]||"0",10);if(o>u)return 1;if(u>o)return-1}return 0}var Qq=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}();!function(r){function t(e){var n=this,i=e||{},o=i.params||{};return(n=r.call(this,{attributions:i.attributions,attributionsCollapsible:i.attributionsCollapsible,cacheSize:i.cacheSize,crossOrigin:i.crossOrigin,imageSmoothing:i.imageSmoothing,opaque:!(!("TRANSPARENT"in o)||o.TRANSPARENT),projection:i.projection,reprojectionErrorThreshold:i.reprojectionErrorThreshold,tileClass:i.tileClass,tileGrid:i.tileGrid,tileLoadFunction:i.tileLoadFunction,url:i.url,urls:i.urls,wrapX:void 0===i.wrapX||i.wrapX,transition:i.transition,zDirection:i.zDirection})||this).gutter_=void 0!==i.gutter?i.gutter:0,n.params_=o,n.v13_=!0,n.serverType_=i.serverType,n.hidpi_=void 0===i.hidpi||i.hidpi,n.tmpExtent_=[1/0,1/0,-1/0,-1/0],n.updateV13_(),n.setKey(n.getKeyForParams_()),n}Qq(t,r),t.prototype.getFeatureInfoUrl=function(e,n,i,o){var u=xa(i),m=this.getProjection(),b=this.getTileGrid();b||(b=this.getTileGridForProjection(u));var T=b.getZForResolution(n,this.zDirection),F=b.getTileCoordForCoordAndZ(e,T);if(!(b.getResolutions().length<=F[0])){var V=b.getResolution(F[0]),H=b.getTileCoordExtent(F,this.tmpExtent_),J=Cp(b.getTileSize(F[0]),this.tmpSize),ne=this.gutter_;0!==ne&&(J=sk(J,ne,this.tmpSize),H=kf(H,V*ne,H)),m&&m!==u&&(V=l1(m,u,e,V),H=cw(H,u,m),e=m_(e,u,m));var we={SERVICE:"WMS",VERSION:Hy,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};$a(we,this.params_,o);var Re=Math.floor((e[0]-H[0])/V),qe=Math.floor((H[3]-e[1])/V);return we[this.v13_?"I":"X"]=Re,we[this.v13_?"J":"Y"]=qe,this.getRequestUrl_(F,J,H,1,m||u,we)}},t.prototype.getLegendUrl=function(e,n){if(void 0!==this.urls[0]){var i={SERVICE:"WMS",VERSION:Hy,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===n||void 0===n.LAYER){var o=this.params_.LAYERS;if(Array.isArray(o)&&1!==o.length)return;i.LAYER=o}if(void 0!==e){var m=this.getProjection()?this.getProjection().getMetersPerUnit():1;i.SCALE=e*m/28e-5}return $a(i,n),ox(this.urls[0],i)}},t.prototype.getGutter=function(){return this.gutter_},t.prototype.getParams=function(){return this.params_},t.prototype.getRequestUrl_=function(e,n,i,o,u,m){var b=this.urls;if(b){if(m.WIDTH=n[0],m.HEIGHT=n[1],m[this.v13_?"CRS":"SRS"]=u.getCode(),"STYLES"in this.params_||(m.STYLES=""),1!=o)switch(this.serverType_){case"geoserver":var T=90*o+.5|0;"FORMAT_OPTIONS"in m?m.FORMAT_OPTIONS+=";dpi:"+T:m.FORMAT_OPTIONS="dpi:"+T;break;case"mapserver":m.MAP_RESOLUTION=90*o;break;case"carmentaserver":case"qgis":m.DPI=90*o;break;default:bo(!1,52)}var F=u.getAxisOrientation(),V=i;if(this.v13_&&"ne"==F.substr(0,2)){var H=void 0;H=i[0],V[0]=i[1],V[1]=H,H=i[2],V[2]=i[3],V[3]=H}return m.BBOX=V.join(","),ox(1==b.length?b[0]:b[Zy(ik(e),b.length)],m)}},t.prototype.getTilePixelRatio=function(e){return this.hidpi_&&void 0!==this.serverType_?e:1},t.prototype.getKeyForParams_=function(){var e=0,n=[];for(var i in this.params_)n[e++]=i+"-"+this.params_[i];return n.join("/")},t.prototype.updateParams=function(e){$a(this.params_,e),this.updateV13_(),this.setKey(this.getKeyForParams_())},t.prototype.updateV13_=function(){this.v13_=YP(this.params_.VERSION||Hy,"1.3")>=0},t.prototype.tileUrlFunction=function(e,n,i){var o=this.getTileGrid();if(o||(o=this.getTileGridForProjection(i)),!(o.getResolutions().length<=e[0])){1!=n&&(!this.hidpi_||void 0===this.serverType_)&&(n=1);var u=o.getResolution(e[0]),m=o.getTileCoordExtent(e,this.tmpExtent_),b=Cp(o.getTileSize(e[0]),this.tmpSize),T=this.gutter_;0!==T&&(b=sk(b,T,this.tmpSize),m=kf(m,u*T,m)),1!=n&&(b=uk(b,n,this.tmpSize));var F={SERVICE:"WMS",VERSION:Hy,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};return $a(F,this.params_),this.getRequestUrl_(e,b,m,n,i,F)}}}(XP);var nZ=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),rZ=function(r){function t(e){var n=this,i=e||{},o=$a({},i);return delete o.preload,delete o.useInterimTilesOnError,(n=r.call(this,o)||this).setPreload(void 0!==i.preload?i.preload:0),n.setUseInterimTilesOnError(void 0===i.useInterimTilesOnError||i.useInterimTilesOnError),n}return nZ(t,r),t.prototype.getPreload=function(){return this.get("preload")},t.prototype.setPreload=function(e){this.set("preload",e)},t.prototype.getUseInterimTilesOnError=function(){return this.get("useInterimTilesOnError")},t.prototype.setUseInterimTilesOnError=function(e){this.set("useInterimTilesOnError",e)},t}(WS);const iZ=rZ;var oZ=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),KP=function(r){function t(e){var n=r.call(this,e)||this;return n.extentChanged=!0,n.renderedExtent_=null,n.renderedProjection=null,n.renderedTiles=[],n.newTiles_=!1,n.tmpExtent=[1/0,1/0,-1/0,-1/0],n.tmpTileRange_=new ak(0,0,0,0),n}return oZ(t,r),t.prototype.isDrawableTile=function(e){var n=this.getLayer(),i=e.getState(),o=n.getUseInterimTilesOnError();return 2==i||4==i||3==i&&!o},t.prototype.getTile=function(e,n,i,o){var u=o.pixelRatio,m=o.viewState.projection,b=this.getLayer(),F=b.getSource().getTile(e,n,i,u,m);return 3==F.getState()&&(b.getUseInterimTilesOnError()?b.getPreload()>0&&(this.newTiles_=!0):F.setState(2)),this.isDrawableTile(F)||(F=F.getInterimTile()),F},t.prototype.loadedTileCallback=function(e,n,i){return!!this.isDrawableTile(i)&&r.prototype.loadedTileCallback.call(this,e,n,i)},t.prototype.prepareFrame=function(e){return!!this.getLayer().getSource()},t.prototype.renderFrame=function(e,n){var i=e.layerStatesArray[e.layerIndex],o=e.viewState,u=o.projection,m=o.resolution,b=o.center,T=o.rotation,F=e.pixelRatio,V=this.getLayer(),H=V.getSource(),J=H.getRevision(),ne=H.getTileGridForProjection(u),we=ne.getZForResolution(m,H.zDirection),Re=ne.getResolution(we),qe=e.extent,Ne=i.extent&&ug(i.extent);Ne&&(qe=sg(qe,ug(i.extent)));var $e=H.getTilePixelRatio(F),tt=Math.round(e.size[0]*$e),bt=Math.round(e.size[1]*$e);if(T){var dn=Math.round(Math.sqrt(tt*tt+bt*bt));tt=dn,bt=dn}var Kt=Re*tt/2/$e,vn=Re*bt/2/$e,Bt=[b[0]-Kt,b[1]-vn,b[0]+Kt,b[1]+vn],Dn=ne.getTileRangeForExtentAndZ(qe,we),un={};un[we]={};var Fn=this.createLoadedTileFinder(H,u,un),kr=this.tmpExtent,Jr=this.tmpTileRange_;this.newTiles_=!1;for(var Ur=Dn.minX;Ur<=Dn.maxX;++Ur)for(var Mr=Dn.minY;Mr<=Dn.maxY;++Mr){var _n=this.getTile(we,Ur,Mr,e);if(this.isDrawableTile(_n)){var Qi=Si(this);if(2==_n.getState()){un[we][_n.tileCoord.toString()]=_n;var go=_n.inTransition(Qi);!this.newTiles_&&(go||-1===this.renderedTiles.indexOf(_n))&&(this.newTiles_=!0)}if(1===_n.getAlpha(Qi,e.time))continue}var Co=ne.getTileCoordChildTileRange(_n.tileCoord,Jr,kr),as=!1;Co&&(as=Fn(we+1,Co)),as||ne.forEachTileCoordParentTileRange(_n.tileCoord,Fn,Jr,kr)}var En=Re/m;ef(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/$e,1/$e,T,-tt/2,-bt/2);var ma=yw(this.pixelTransform);this.useContainer(n,ma,i.opacity);var Mi=this.context,No=Mi.canvas;h1(this.inversePixelTransform,this.pixelTransform),ef(this.tempTransform,tt/2,bt/2,En,En,0,-tt/2,-bt/2),No.width!=tt||No.height!=bt?(No.width=tt,No.height=bt):this.containerReused||Mi.clearRect(0,0,tt,bt),Ne&&this.clipUnrotated(Mi,e,Ne),$a(Mi,H.getContextOptions()),this.preRender(Mi,e),this.renderedTiles.length=0;var cr,fl,Yc,ws=Object.keys(un).map(Number);ws.sort(r_),1!==i.opacity||this.containerReused&&!H.getOpaque(e.viewState.projection)?(cr=[],fl=[]):ws=ws.reverse();for(var ml=ws.length-1;ml>=0;--ml){var af=ws[ml],py=H.getTilePixelSize(af,F,u),zf=ne.getResolution(af)/Re,Mp=py[0]*zf*En,Fs=py[1]*zf*En,Ju=ne.getTileCoordForCoordAndZ(lg(Bt),af),jh=ne.getTileCoordExtent(Ju),Cs=$c(this.tempTransform,[$e*(jh[0]-Bt[0])/Re,$e*(Bt[3]-jh[3])/Re]),Aa=$e*H.getGutterForProjection(u),wd=un[af];for(var Pl in wd){var Nf=(_n=wd[Pl]).tileCoord,Ap=Ju[1]-Nf[1],Bf=Math.round(Cs[0]-(Ap-1)*Mp),yh=Ju[2]-Nf[2],bg=Math.round(Cs[1]-(yh-1)*Fs),Jp=Bf-(Ur=Math.round(Cs[0]-Ap*Mp)),lp=bg-(Mr=Math.round(Cs[1]-yh*Fs)),Qp=we===af;if(!(go=Qp&&1!==_n.getAlpha(Si(this),e.time)))if(cr){Mi.save(),Yc=[Ur,Mr,Ur+Jp,Mr,Ur+Jp,Mr+lp,Ur,Mr+lp];for(var Cd=0,Dp=cr.length;Cd<Dp;++Cd)if(we!==af&&af<fl[Cd]){var vh=cr[Cd];Mi.beginPath(),Mi.moveTo(Yc[0],Yc[1]),Mi.lineTo(Yc[2],Yc[3]),Mi.lineTo(Yc[4],Yc[5]),Mi.lineTo(Yc[6],Yc[7]),Mi.moveTo(vh[6],vh[7]),Mi.lineTo(vh[4],vh[5]),Mi.lineTo(vh[2],vh[3]),Mi.lineTo(vh[0],vh[1]),Mi.clip()}cr.push(Yc),fl.push(af)}else Mi.clearRect(Ur,Mr,Jp,lp);this.drawTileImage(_n,e,Ur,Mr,Jp,lp,Aa,Qp),cr&&!go?(Mi.restore(),this.renderedTiles.unshift(_n)):this.renderedTiles.push(_n),this.updateUsedTiles(e.usedTiles,H,_n)}}this.renderedRevision=J,this.renderedResolution=Re,this.extentChanged=!this.renderedExtent_||!c_(this.renderedExtent_,Bt),this.renderedExtent_=Bt,this.renderedPixelRatio=F,this.renderedProjection=u,this.manageTilePyramid(e,H,ne,F,u,qe,we,V.getPreload()),this.scheduleExpireCache(e,H),this.postRender(Mi,e),i.extent&&Mi.restore(),ma!==No.style.transform&&(No.style.transform=ma);var ed=XS(i.opacity),td=this.container;return ed!==td.style.opacity&&(td.style.opacity=ed),this.container},t.prototype.drawTileImage=function(e,n,i,o,u,m,b,T){var F=this.getTileImage(e);if(F){var V=Si(this),H=T?e.getAlpha(V,n.time):1,J=H!==this.context.globalAlpha;J&&(this.context.save(),this.context.globalAlpha=H),this.context.drawImage(F,b,b,F.width-2*b,F.height-2*b,i,o,u,m),J&&this.context.restore(),1!==H?n.animate=!0:T&&e.endTransition(V)}},t.prototype.getImage=function(){var e=this.context;return e?e.canvas:null},t.prototype.getTileImage=function(e){return e.getImage()},t.prototype.scheduleExpireCache=function(e,n){if(n.canExpireCache()){var i=function(o,u,m){var b=Si(o);b in m.usedTiles&&o.expireCache(m.viewState.projection,m.usedTiles[b])}.bind(null,n);e.postRenderFunctions.push(i)}},t.prototype.updateUsedTiles=function(e,n,i){var o=Si(n);o in e||(e[o]={}),e[o][i.getKey()]=!0},t.prototype.manageTilePyramid=function(e,n,i,o,u,m,b,T,F){var V=Si(n);V in e.wantedTiles||(e.wantedTiles[V]={});var Re,qe,Ne,$e,tt,bt,H=e.wantedTiles[V],J=e.tileQueue,we=0;for(bt=i.getMinZoom();bt<=b;++bt)for(qe=i.getTileRangeForExtentAndZ(m,bt,qe),Ne=i.getResolution(bt),$e=qe.minX;$e<=qe.maxX;++$e)for(tt=qe.minY;tt<=qe.maxY;++tt)b-bt<=T?(++we,0==(Re=n.getTile(bt,$e,tt,o,u)).getState()&&(H[Re.getKey()]=!0,J.isKeyQueued(Re.getKey())||J.enqueue([Re,V,i.getTileCoordCenter(Re.tileCoord),Ne])),void 0!==F&&F(Re)):n.useTile(bt,$e,tt,u);n.updateCacheSize(we,u)},t}(eT);const JP=KP;var aZ=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),sZ=function(r){function t(e){return r.call(this,e)||this}return aZ(t,r),t.prototype.createRenderer=function(){return new JP(this)},t}(iZ);const xT=sZ;var lZ=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),QP=function(r){function t(e){var n=r.call(this,{extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes})||this;return n.matrixIds_=e.matrixIds,n}return lZ(t,r),t.prototype.getMatrixId=function(e){return this.matrixIds_[e]},t.prototype.getMatrixIds=function(){return this.matrixIds_},t}(dw),hZ=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),pZ=function(r){function t(e){var n=this,i=void 0!==e.requestEncoding?e.requestEncoding:"KVP",o=e.tileGrid,u=e.urls;return void 0===u&&void 0!==e.url&&(u=WP(e.url)),(n=r.call(this,{attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,imageSmoothing:e.imageSmoothing,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:o,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:u,wrapX:void 0!==e.wrapX&&e.wrapX,transition:e.transition,zDirection:e.zDirection})||this).version_=void 0!==e.version?e.version:"1.0.0",n.format_=void 0!==e.format?e.format:"image/jpeg",n.dimensions_=void 0!==e.dimensions?e.dimensions:{},n.layer_=e.layer,n.matrixSet_=e.matrixSet,n.style_=e.style,n.requestEncoding_=i,n.setKey(n.getKeyForDimensions_()),u&&u.length>0&&(n.tileUrlFunction=_T(u.map(n.createFromWMTSTemplate.bind(n)))),n}return hZ(t,r),t.prototype.setUrls=function(e){this.urls=e;var n=e.join("\n");this.setTileUrlFunction(_T(e.map(this.createFromWMTSTemplate.bind(this))),n)},t.prototype.getDimensions=function(){return this.dimensions_},t.prototype.getFormat=function(){return this.format_},t.prototype.getLayer=function(){return this.layer_},t.prototype.getMatrixSet=function(){return this.matrixSet_},t.prototype.getRequestEncoding=function(){return this.requestEncoding_},t.prototype.getStyle=function(){return this.style_},t.prototype.getVersion=function(){return this.version_},t.prototype.getKeyForDimensions_=function(){var e=0,n=[];for(var i in this.dimensions_)n[e++]=i+"-"+this.dimensions_[i];return n.join("/")},t.prototype.updateDimensions=function(e){$a(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())},t.prototype.createFromWMTSTemplate=function(e){var n=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};"KVP"==n&&$a(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e="KVP"==n?ox(e,i):e.replace(/\{(\w+?)\}/g,function(m,b){return b.toLowerCase()in i?i[b.toLowerCase()]:m});var o=this.tileGrid,u=this.dimensions_;return function(m,b,T){if(m){var F={TileMatrix:o.getMatrixId(m[0]),TileCol:m[1],TileRow:m[2]};$a(F,u);var V=e;return"KVP"==n?ox(V,F):V.replace(/\{(\w+?)\}/g,function(H,J){return F[J]})}}},t}(XP);const eR=pZ;function wo(...r){return qt(r,Xt(r))}function ax(r,t){return Ut(t)?pe(r,t,1):pe(r,1)}class tR{}class nR{}class uy{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(e=>{const n=e.indexOf(":");if(n>0){const i=e.slice(0,n),o=i.toLowerCase(),u=e.slice(n+1).trim();this.maybeSetNormalizedName(i,o),this.headers.has(o)?this.headers.get(o).push(u):this.headers.set(o,[u])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(e=>{let n=t[e];const i=e.toLowerCase();"string"==typeof n&&(n=[n]),n.length>0&&(this.headers.set(i,n),this.maybeSetNormalizedName(e,i))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof uy?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new uy;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof uy?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let n=t.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(t.name,e);const i=("a"===t.op?this.headers.get(e):void 0)||[];i.push(...n),this.headers.set(e,i);break;case"d":const o=t.value;if(o){let u=this.headers.get(e);if(!u)return;u=u.filter(m=>-1===o.indexOf(m)),0===u.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,u)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class fZ{encodeKey(t){return rR(t)}encodeValue(t){return rR(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const gZ=/%(\d[a-f0-9])/gi,yZ={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function rR(r){return encodeURIComponent(r).replace(gZ,(t,e)=>{var n;return null!==(n=yZ[e])&&void 0!==n?n:t})}function iR(r){return`${r}`}class av{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new fZ,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(r,t){const e=new Map;return r.length>0&&r.replace(/^\?/,"").split("&").forEach(i=>{const o=i.indexOf("="),[u,m]=-1==o?[t.decodeKey(i),""]:[t.decodeKey(i.slice(0,o)),t.decodeValue(i.slice(o+1))],b=e.get(u)||[];b.push(m),e.set(u,b)}),e}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const n=t.fromObject[e];this.map.set(e,Array.isArray(n)?n:[n])})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){const e=[];return Object.keys(t).forEach(n=>{const i=t[n];Array.isArray(i)?i.forEach(o=>{e.push({param:n,value:o,op:"a"})}):e.push({param:n,value:i,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(n=>e+"="+this.encoder.encodeValue(n)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const e=new av({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(iR(t.value)),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let n=this.map.get(t.param)||[];const i=n.indexOf(iR(t.value));-1!==i&&n.splice(i,1),n.length>0?this.map.set(t.param,n):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class vZ{constructor(){this.map=new Map}set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function oR(r){return"undefined"!=typeof ArrayBuffer&&r instanceof ArrayBuffer}function aR(r){return"undefined"!=typeof Blob&&r instanceof Blob}function sR(r){return"undefined"!=typeof FormData&&r instanceof FormData}class M1{constructor(t,e,n,i){let o;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function(r){switch(r){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||i?(this.body=void 0!==n?n:null,o=i):o=n,o&&(this.reportProgress=!!o.reportProgress,this.withCredentials=!!o.withCredentials,o.responseType&&(this.responseType=o.responseType),o.headers&&(this.headers=o.headers),o.context&&(this.context=o.context),o.params&&(this.params=o.params)),this.headers||(this.headers=new uy),this.context||(this.context=new vZ),this.params){const u=this.params.toString();if(0===u.length)this.urlWithParams=e;else{const m=e.indexOf("?");this.urlWithParams=e+(-1===m?"?":m<e.length-1?"&":"")+u}}else this.params=new av,this.urlWithParams=e}serializeBody(){return null===this.body?null:oR(this.body)||aR(this.body)||sR(this.body)||function(r){return"undefined"!=typeof URLSearchParams&&r instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof av?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||sR(this.body)?null:aR(this.body)?this.body.type||null:oR(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof av?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){var e;const n=t.method||this.method,i=t.url||this.url,o=t.responseType||this.responseType,u=void 0!==t.body?t.body:this.body,m=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,b=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let T=t.headers||this.headers,F=t.params||this.params;const V=null!==(e=t.context)&&void 0!==e?e:this.context;return void 0!==t.setHeaders&&(T=Object.keys(t.setHeaders).reduce((H,J)=>H.set(J,t.setHeaders[J]),T)),t.setParams&&(F=Object.keys(t.setParams).reduce((H,J)=>H.set(J,t.setParams[J]),F)),new M1(n,i,u,{params:F,headers:T,context:V,reportProgress:b,responseType:o,withCredentials:m})}}var Xc=(()=>((Xc=Xc||{})[Xc.Sent=0]="Sent",Xc[Xc.UploadProgress=1]="UploadProgress",Xc[Xc.ResponseHeader=2]="ResponseHeader",Xc[Xc.DownloadProgress=3]="DownloadProgress",Xc[Xc.Response=4]="Response",Xc[Xc.User=5]="User",Xc))();class bT{constructor(t,e=200,n="OK"){this.headers=t.headers||new uy,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||n,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class wT extends bT{constructor(t={}){super(t),this.type=Xc.ResponseHeader}clone(t={}){return new wT({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class Zw extends bT{constructor(t={}){super(t),this.type=Xc.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new Zw({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class lR extends bT{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function CT(r,t){return{body:t,headers:r.headers,context:r.context,observe:r.observe,params:r.params,reportProgress:r.reportProgress,responseType:r.responseType,withCredentials:r.withCredentials}}let sx=(()=>{class r{constructor(e){this.handler=e}request(e,n,i={}){let o;if(e instanceof M1)o=e;else{let b,T;b=i.headers instanceof uy?i.headers:new uy(i.headers),i.params&&(T=i.params instanceof av?i.params:new av({fromObject:i.params})),o=new M1(e,n,void 0!==i.body?i.body:null,{headers:b,context:i.context,params:T,reportProgress:i.reportProgress,responseType:i.responseType||"json",withCredentials:i.withCredentials})}const u=wo(o).pipe(ax(b=>this.handler.handle(b)));if(e instanceof M1||"events"===i.observe)return u;const m=u.pipe(e_(b=>b instanceof Zw));switch(i.observe||"body"){case"body":switch(o.responseType){case"arraybuffer":return m.pipe(Zr(b=>{if(null!==b.body&&!(b.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return b.body}));case"blob":return m.pipe(Zr(b=>{if(null!==b.body&&!(b.body instanceof Blob))throw new Error("Response is not a Blob.");return b.body}));case"text":return m.pipe(Zr(b=>{if(null!==b.body&&"string"!=typeof b.body)throw new Error("Response is not a string.");return b.body}));default:return m.pipe(Zr(b=>b.body))}case"response":return m;default:throw new Error(`Unreachable: unhandled observe type ${i.observe}}`)}}delete(e,n={}){return this.request("DELETE",e,n)}get(e,n={}){return this.request("GET",e,n)}head(e,n={}){return this.request("HEAD",e,n)}jsonp(e,n){return this.request("JSONP",e,{params:(new av).append(n,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,n={}){return this.request("OPTIONS",e,n)}patch(e,n,i={}){return this.request("PATCH",e,CT(i,n))}post(e,n,i={}){return this.request("POST",e,CT(i,n))}put(e,n,i={}){return this.request("PUT",e,CT(i,n))}}return r.\u0275fac=function(e){return new(e||r)(Xn(tR))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();class uR{constructor(t,e){this.next=t,this.interceptor=e}handle(t){return this.interceptor.intercept(t,this.next)}}const cR=new ao("HTTP_INTERCEPTORS");let bZ=(()=>{class r{intercept(e,n){return n.handle(e)}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();const wZ=/^\)\]\}',?\n/;let hR=(()=>{class r{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new ct(n=>{const i=this.xhrFactory.build();if(i.open(e.method,e.urlWithParams),e.withCredentials&&(i.withCredentials=!0),e.headers.forEach((J,ne)=>i.setRequestHeader(J,ne.join(","))),e.headers.has("Accept")||i.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const J=e.detectContentTypeHeader();null!==J&&i.setRequestHeader("Content-Type",J)}if(e.responseType){const J=e.responseType.toLowerCase();i.responseType="json"!==J?J:"text"}const o=e.serializeBody();let u=null;const m=()=>{if(null!==u)return u;const J=1223===i.status?204:i.status,ne=i.statusText||"OK",we=new uy(i.getAllResponseHeaders()),Re=function(r){return"responseURL"in r&&r.responseURL?r.responseURL:/^X-Request-URL:/m.test(r.getAllResponseHeaders())?r.getResponseHeader("X-Request-URL"):null}(i)||e.url;return u=new wT({headers:we,status:J,statusText:ne,url:Re}),u},b=()=>{let{headers:J,status:ne,statusText:we,url:Re}=m(),qe=null;204!==ne&&(qe=void 0===i.response?i.responseText:i.response),0===ne&&(ne=qe?200:0);let Ne=ne>=200&&ne<300;if("json"===e.responseType&&"string"==typeof qe){const $e=qe;qe=qe.replace(wZ,"");try{qe=""!==qe?JSON.parse(qe):null}catch(tt){qe=$e,Ne&&(Ne=!1,qe={error:tt,text:qe})}}Ne?(n.next(new Zw({body:qe,headers:J,status:ne,statusText:we,url:Re||void 0})),n.complete()):n.error(new lR({error:qe,headers:J,status:ne,statusText:we,url:Re||void 0}))},T=J=>{const{url:ne}=m(),we=new lR({error:J,status:i.status||0,statusText:i.statusText||"Unknown Error",url:ne||void 0});n.error(we)};let F=!1;const V=J=>{F||(n.next(m()),F=!0);let ne={type:Xc.DownloadProgress,loaded:J.loaded};J.lengthComputable&&(ne.total=J.total),"text"===e.responseType&&!!i.responseText&&(ne.partialText=i.responseText),n.next(ne)},H=J=>{let ne={type:Xc.UploadProgress,loaded:J.loaded};J.lengthComputable&&(ne.total=J.total),n.next(ne)};return i.addEventListener("load",b),i.addEventListener("error",T),i.addEventListener("timeout",T),i.addEventListener("abort",T),e.reportProgress&&(i.addEventListener("progress",V),null!==o&&i.upload&&i.upload.addEventListener("progress",H)),i.send(o),n.next({type:Xc.Sent}),()=>{i.removeEventListener("error",T),i.removeEventListener("abort",T),i.removeEventListener("load",b),i.removeEventListener("timeout",T),e.reportProgress&&(i.removeEventListener("progress",V),null!==o&&i.upload&&i.upload.removeEventListener("progress",H)),i.readyState!==i.DONE&&i.abort()}})}}return r.\u0275fac=function(e){return new(e||r)(Xn(oD))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();const ET=new ao("XSRF_COOKIE_NAME"),ST=new ao("XSRF_HEADER_NAME");class pR{}let EZ=(()=>{class r{constructor(e,n,i){this.doc=e,this.platform=n,this.cookieName=i,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=$A(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return r.\u0275fac=function(e){return new(e||r)(Xn(Xd),Xn(Ib),Xn(ET))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})(),TT=(()=>{class r{constructor(e,n){this.tokenService=e,this.headerName=n}intercept(e,n){const i=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||i.startsWith("http://")||i.startsWith("https://"))return n.handle(e);const o=this.tokenService.getToken();return null!==o&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,o)})),n.handle(e)}}return r.\u0275fac=function(e){return new(e||r)(Xn(pR),Xn(ST))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})(),SZ=(()=>{class r{constructor(e,n){this.backend=e,this.injector=n,this.chain=null}handle(e){if(null===this.chain){const n=this.injector.get(cR,[]);this.chain=n.reduceRight((i,o)=>new uR(i,o),this.backend)}return this.chain.handle(e)}}return r.\u0275fac=function(e){return new(e||r)(Xn(nR),Xn(Fo))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})(),TZ=(()=>{class r{static disable(){return{ngModule:r,providers:[{provide:TT,useClass:bZ}]}}static withOptions(e={}){return{ngModule:r,providers:[e.cookieName?{provide:ET,useValue:e.cookieName}:[],e.headerName?{provide:ST,useValue:e.headerName}:[]]}}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=Gi({type:r}),r.\u0275inj=io({providers:[TT,{provide:cR,useExisting:TT,multi:!0},{provide:pR,useClass:EZ},{provide:ET,useValue:"XSRF-TOKEN"},{provide:ST,useValue:"X-XSRF-TOKEN"}]}),r})(),dR=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=Gi({type:r}),r.\u0275inj=io({providers:[sx,{provide:tR,useClass:SZ},hR,{provide:nR,useExisting:hR}],imports:[[TZ.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),r})();var IZ=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),fR=[101,101];function IT(r,t){return mR(r,t,[]).join("")}function mR(r,t,e){if(r.nodeType==Node.CDATA_SECTION_NODE||r.nodeType==Node.TEXT_NODE)e.push(t?String(r.nodeValue).replace(/(\r\n|\r|\n)/g,""):r.nodeValue);else{var n=void 0;for(n=r.firstChild;n;n=n.nextSibling)mR(n,t,e)}return e}function MT(r,t){return function(e,n){var i=r.call(void 0!==t?t:this,e,n);void 0!==i&&n[n.length-1].push(i)}}function nf(r,t,e){return function(n,i){var o=r.call(void 0!==e?e:this,n,i);if(void 0!==o){var u=i[i.length-1],m=void 0!==t?t:n.localName,b=void 0;m in u?b=u[m]:u[m]=b=[],b.push(o)}}}function _i(r,t,e){return function(n,i){var o=r.call(void 0!==e?e:this,n,i);void 0!==o&&(i[i.length-1][void 0!==t?t:n.localName]=o)}}function Ls(r,t,e){var i,o,n=void 0!==e?e:{};for(i=0,o=r.length;i<o;++i)n[r[i]]=t;return n}function Xl(r,t,e,n,i){return n.push(r),function(r,t,e,n){var i;for(i=t.firstElementChild;i;i=i.nextElementSibling){var o=r[i.namespaceURI];if(void 0!==o){var u=o[i.localName];void 0!==u&&u.call(n,i,e)}}}(t,e,n,i),n.pop()}!function(r){function t(e){var n=this,i=e||{};return(n=r.call(this,{attributions:i.attributions,imageSmoothing:i.imageSmoothing,projection:i.projection,resolutions:i.resolutions})||this).crossOrigin_=void 0!==i.crossOrigin?i.crossOrigin:null,n.url_=i.url,n.imageLoadFunction_=void 0!==i.imageLoadFunction?i.imageLoadFunction:ek,n.params_=i.params||{},n.v13_=!0,n.updateV13_(),n.serverType_=i.serverType,n.hidpi_=void 0===i.hidpi||i.hidpi,n.image_=null,n.imageSize_=[0,0],n.renderedRevision_=0,n.ratio_=void 0!==i.ratio?i.ratio:1.5,n}IZ(t,r),t.prototype.getFeatureInfoUrl=function(e,n,i,o){if(void 0!==this.url_){var u=xa(i),m=this.getProjection();m&&m!==u&&(n=l1(m,u,e,n),e=m_(e,u,m));var b=Z0(e,n,0,fR),T={SERVICE:"WMS",VERSION:Hy,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};$a(T,this.params_,o);var F=Math.floor((e[0]-b[0])/n),V=Math.floor((b[3]-e[1])/n);return T[this.v13_?"I":"X"]=F,T[this.v13_?"J":"Y"]=V,this.getRequestUrl_(b,fR,1,m||u,T)}},t.prototype.getLegendUrl=function(e,n){if(void 0!==this.url_){var i={SERVICE:"WMS",VERSION:Hy,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===n||void 0===n.LAYER){var o=this.params_.LAYERS;if(Array.isArray(o)&&1!==o.length)return;i.LAYER=o}if(void 0!==e){var m=this.getProjection()?this.getProjection().getMetersPerUnit():1;i.SCALE=e*m/28e-5}return $a(i,n),ox(this.url_,i)}},t.prototype.getParams=function(){return this.params_},t.prototype.getImageInternal=function(e,n,i,o){if(void 0===this.url_)return null;n=this.findNearestResolution(n),1!=i&&(!this.hidpi_||void 0===this.serverType_)&&(i=1);var u=n/i,m=wm(e),F=Z0(m,u,0,[Math.ceil(Xs(e)/u),Math.ceil(mh(e)/u)]),J=Z0(m,u,0,[Math.ceil(this.ratio_*Xs(e)/u),Math.ceil(this.ratio_*mh(e)/u)]),ne=this.image_;if(ne&&this.renderedRevision_==this.getRevision()&&ne.getResolution()==n&&ne.getPixelRatio()==i&&ag(ne.getExtent(),F))return ne;var we={SERVICE:"WMS",VERSION:Hy,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};$a(we,this.params_),this.imageSize_[0]=Math.round(Xs(J)/u),this.imageSize_[1]=Math.round(mh(J)/u);var Re=this.getRequestUrl_(J,this.imageSize_,i,o,we);return this.image_=new AP(J,n,i,Re,this.crossOrigin_,this.imageLoadFunction_),this.renderedRevision_=this.getRevision(),this.image_.addEventListener("change",this.handleImageChange.bind(this)),this.image_},t.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_},t.prototype.getRequestUrl_=function(e,n,i,o,u){if(bo(void 0!==this.url_,9),u[this.v13_?"CRS":"SRS"]=o.getCode(),"STYLES"in this.params_||(u.STYLES=""),1!=i)switch(this.serverType_){case"geoserver":var m=90*i+.5|0;"FORMAT_OPTIONS"in u?u.FORMAT_OPTIONS+=";dpi:"+m:u.FORMAT_OPTIONS="dpi:"+m;break;case"mapserver":u.MAP_RESOLUTION=90*i;break;case"carmentaserver":case"qgis":u.DPI=90*i;break;default:bo(!1,8)}u.WIDTH=n[0],u.HEIGHT=n[1];var T,b=o.getAxisOrientation();return T=this.v13_&&"ne"==b.substr(0,2)?[e[1],e[0],e[3],e[2]]:e,u.BBOX=T.join(","),ox(this.url_,u)},t.prototype.getUrl=function(){return this.url_},t.prototype.setImageLoadFunction=function(e){this.image_=null,this.imageLoadFunction_=e,this.changed()},t.prototype.setUrl=function(e){e!=this.url_&&(this.url_=e,this.image_=null,this.changed())},t.prototype.updateParams=function(e){$a(this.params_,e),this.updateV13_(),this.image_=null,this.changed()},t.prototype.updateV13_=function(){this.v13_=YP(this.params_.VERSION||Hy,"1.3")>=0}}(dS),function(r,t){var e=r}();var LZ=function(){function r(){}return r.prototype.read=function(t){if(t){if("string"==typeof t){var e=function(r){return(new DOMParser).parseFromString(r,"application/xml")}(t);return this.readFromDocument(e)}return function(r){return"documentElement"in r}(t)?this.readFromDocument(t):this.readFromNode(t)}return null},r.prototype.readFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null},r.prototype.readFromNode=function(t){},r}();const vR=LZ;function AT(r){return r.getAttributeNS("http://www.w3.org/1999/xlink","href")}function sv(r){return function(r){var t=/^\s*(\d+)\s*$/.exec(r);if(t)return parseInt(t[1],10)}(IT(r,!1))}function za(r){return IT(r,!1).trim()}var VZ=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),bd=[null,"http://www.opengis.net/ows/1.1"],GZ=Ls(bd,{ServiceIdentification:_i(function(r,t){return Xl({},n7,r,t)}),ServiceProvider:_i(function(r,t){return Xl({},r7,r,t)}),OperationsMetadata:_i(function(r,t){return Xl({},JZ,r,t)})}),qZ=function(r){function t(){return r.call(this)||this}return VZ(t,r),t.prototype.readFromNode=function(e){return Xl({},GZ,e,[])||null},t}(vR),ZZ=Ls(bd,{DeliveryPoint:_i(za),City:_i(za),AdministrativeArea:_i(za),PostalCode:_i(za),Country:_i(za),ElectronicMailAddress:_i(za)}),HZ=Ls(bd,{Value:nf(function(r,t){return za(r)})}),WZ=Ls(bd,{AllowedValues:_i(function(r,t){return Xl({},HZ,r,t)})}),$Z=Ls(bd,{Phone:_i(function(r,t){return Xl({},QZ,r,t)}),Address:_i(function(r,t){return Xl({},ZZ,r,t)})}),XZ=Ls(bd,{HTTP:_i(function(r,t){return Xl({},YZ,r,t)})}),YZ=Ls(bd,{Get:nf(function(r,t){var e=AT(r);if(e)return Xl({href:e},e7,r,t)}),Post:void 0}),KZ=Ls(bd,{DCP:_i(function(r,t){return Xl({},XZ,r,t)})}),JZ=Ls(bd,{Operation:function(r,t){var e=r.getAttribute("name"),n=Xl({},KZ,r,t);n&&(t[t.length-1][e]=n)}}),QZ=Ls(bd,{Voice:_i(za),Facsimile:_i(za)}),e7=Ls(bd,{Constraint:nf(function(r,t){var e=r.getAttribute("name");if(e)return Xl({name:e},WZ,r,t)})}),t7=Ls(bd,{IndividualName:_i(za),PositionName:_i(za),ContactInfo:_i(function(r,t){return Xl({},$Z,r,t)})}),n7=Ls(bd,{Abstract:_i(za),AccessConstraints:_i(za),Fees:_i(za),Title:_i(za),ServiceTypeVersion:_i(za),ServiceType:_i(za)}),r7=Ls(bd,{ProviderName:_i(za),ProviderSite:_i(AT),ServiceContact:_i(function(r,t){return Xl({},t7,r,t)})});const v7=qZ;var _7=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),gg=[null,"http://www.opengis.net/wmts/1.0"],lx=[null,"http://www.opengis.net/ows/1.1"],x7=Ls(gg,{Contents:_i(function(r,t){return Xl({},w7,r,t)})}),b7=function(r){function t(){var e=r.call(this)||this;return e.owsParser_=new v7,e}return _7(t,r),t.prototype.readFromNode=function(e){var n=e.getAttribute("version");n&&(n=n.trim());var i=this.owsParser_.readFromNode(e);return i?(i.version=n,(i=Xl(i,x7,e,[]))||null):null},t}(vR),w7=Ls(gg,{Layer:nf(function(r,t){return Xl({},C7,r,t)}),TileMatrixSet:nf(function(r,t){return Xl({},D7,r,t)})}),C7=Ls(gg,{Style:nf(function(r,t){var e=Xl({},E7,r,t);if(e){var n="true"===r.getAttribute("isDefault");return e.isDefault=n,e}}),Format:nf(za),TileMatrixSetLink:nf(function(r,t){return Xl({},S7,r,t)}),Dimension:nf(function(r,t){return Xl({},M7,r,t)}),ResourceURL:nf(function(r,t){var e=r.getAttribute("format"),n=r.getAttribute("template"),i=r.getAttribute("resourceType"),o={};return e&&(o.format=e),n&&(o.template=n),i&&(o.resourceType=i),o})},Ls(lx,{Title:_i(za),Abstract:_i(za),WGS84BoundingBox:_i(_R),Identifier:_i(za)})),E7=Ls(gg,{LegendURL:nf(function(r,t){var e={};return e.format=r.getAttribute("format"),e.href=AT(r),e})},Ls(lx,{Title:_i(za),Identifier:_i(za)})),S7=Ls(gg,{TileMatrixSet:_i(za),TileMatrixSetLimits:_i(function(r,t){return Xl([],T7,r,t)})}),T7=Ls(gg,{TileMatrixLimits:MT(function(r,t){return Xl({},I7,r,t)})}),I7=Ls(gg,{TileMatrix:_i(za),MinTileRow:_i(sv),MaxTileRow:_i(sv),MinTileCol:_i(sv),MaxTileCol:_i(sv)}),M7=Ls(gg,{Default:_i(za),Value:nf(za)},Ls(lx,{Identifier:_i(za)})),A7=Ls(lx,{LowerCorner:MT(DT),UpperCorner:MT(DT)}),D7=Ls(gg,{WellKnownScaleSet:_i(za),TileMatrix:nf(function(r,t){return Xl({},k7,r,t)})},Ls(lx,{SupportedCRS:_i(za),Identifier:_i(za),BoundingBox:_i(_R)})),k7=Ls(gg,{TopLeftCorner:_i(DT),ScaleDenominator:_i(function(r){return function(r){var t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(r);if(t)return parseFloat(t[1])}(IT(r,!1))}),TileWidth:_i(sv),TileHeight:_i(sv),MatrixWidth:_i(sv),MatrixHeight:_i(sv)},Ls(lx,{Identifier:_i(za)}));function _R(r,t){var e=Xl([],A7,r,t);if(2==e.length)return Hc(e)}function DT(r,t){var e=za(r).split(/\s+/);if(e&&2==e.length){var n=+e[0],i=+e[1];if(!isNaN(n)&&!isNaN(i))return[n,i]}}const G7=b7;var q7=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),xR=function(r){function t(e,n,i){var o=r.call(this)||this;return void 0!==i&&void 0===n?o.setFlatCoordinates(i,e):o.setCenterAndRadius(e,n||0,i),o}return q7(t,r),t.prototype.clone=function(){var e=new t(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e},t.prototype.closestPointXY=function(e,n,i,o){var u=this.flatCoordinates,m=e-u[0],b=n-u[1],T=m*m+b*b;if(T<o){if(0===T)for(var F=0;F<this.stride;++F)i[F]=u[F];else{var V=this.getRadius()/Math.sqrt(T);for(i[0]=u[0]+V*m,i[1]=u[1]+V*b,F=2;F<this.stride;++F)i[F]=u[F]}return i.length=this.stride,T}return o},t.prototype.containsXY=function(e,n){var i=this.flatCoordinates,o=e-i[0],u=n-i[1];return o*o+u*u<=this.getRadiusSquared_()},t.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)},t.prototype.computeExtent=function(e){var n=this.flatCoordinates,i=n[this.stride]-n[0];return bm(n[0]-i,n[1]-i,n[0]+i,n[1]+i,e)},t.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())},t.prototype.getRadiusSquared_=function(){var e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],n=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+n*n},t.prototype.getType=function(){return $t.CIRCLE},t.prototype.intersectsExtent=function(e){if(Cc(e,this.getExtent())){var i=this.getCenter();return e[0]<=i[0]&&e[2]>=i[0]||e[1]<=i[1]&&e[3]>=i[1]||eS(e,this.intersectsCoordinate.bind(this))}return!1},t.prototype.setCenter=function(e){var n=this.stride,i=this.flatCoordinates[n]-this.flatCoordinates[0],o=e.slice();o[n]=o[0]+i;for(var u=1;u<n;++u)o[n+u]=e[u];this.setFlatCoordinates(this.layout,o),this.changed()},t.prototype.setCenterAndRadius=function(e,n,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);var o=this.flatCoordinates,u=Vk(o,0,e);o[u++]=o[0]+n;for(var m=1,b=this.stride;m<b;++m)o[u++]=o[m];o.length=u,this.changed()},t.prototype.getCoordinates=function(){return null},t.prototype.setCoordinates=function(e,n){},t.prototype.setRadius=function(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()},t.prototype.rotate=function(e,n){var i=this.getCenter(),o=this.getStride();this.setCenter(RS(i,0,i.length,o,e,n,i)),this.changed()},t.prototype.translate=function(e,n){var i=this.getCenter(),o=this.getStride();this.setCenter(zk(i,0,i.length,o,e,n,i)),this.changed()},t}(Ky);const Z7=xR;var bR=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Xw=function(r){function t(e,n){var i=r.call(this,e)||this;return i.feature=n,i}return bR(t,r),t}(_m),H7=function(r){function t(e){var n=this,i=e;i.stopDown||(i.stopDown=o_),(n=r.call(this,i)||this).shouldHandle_=!1,n.downPx_=null,n.freehand_=!1,n.source_=e.source?e.source:null,n.features_=e.features?e.features:null,n.snapTolerance_=e.snapTolerance?e.snapTolerance:12,n.type_=e.type,n.mode_=function(r){switch(r){case $t.POINT:case $t.MULTI_POINT:return"Point";case $t.LINE_STRING:case $t.MULTI_LINE_STRING:return"LineString";case $t.POLYGON:case $t.MULTI_POLYGON:return"Polygon";case $t.CIRCLE:return"Circle";default:throw new Error("Invalid type: "+r)}}(n.type_),n.stopClick_=!!e.stopClick,n.minPoints_=e.minPoints?e.minPoints:"Polygon"===n.mode_?3:2,n.maxPoints_="Circle"===n.mode_?2:e.maxPoints?e.maxPoints:1/0,n.finishCondition_=e.finishCondition?e.finishCondition:qy;var o=e.geometryFunction;if(!o){var m,u=n.mode_;"Circle"===u?o=function(b,T,F){var V=T||new Z7([NaN,NaN]),H=hl(b[0]),J=pg(H,hl(b[b.length-1]));V.setCenterAndRadius(H,Math.sqrt(J));var ne=Pf();return ne&&V.transform(F,ne),V}:("Point"===u?m=Kp:"LineString"===u?m=Lf:"Polygon"===u&&(m=Tm),o=function(b,T,F){return T?T.setCoordinates("Polygon"===u?b[0].length?[b[0].concat([b[0][0]])]:[]:b):T=new m(b),T})}return n.geometryFunction_=o,n.dragVertexDelay_=void 0!==e.dragVertexDelay?e.dragVertexDelay:500,n.finishCoordinate_=null,n.sketchFeature_=null,n.sketchPoint_=null,n.sketchCoords_=null,n.sketchLine_=null,n.sketchLineCoords_=null,n.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,n.overlay_=new I_({source:new __({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style?e.style:W7(),updateWhileInteracting:!0}),n.geometryName_=e.geometryName,n.condition_=e.condition?e.condition:ES,n.freehandCondition_=e.freehand?CS:e.freehandCondition?e.freehandCondition:Ik,n.addChangeListener("active",n.updateState_),n}return bR(t,r),t.prototype.setMap=function(e){r.prototype.setMap.call(this,e),this.updateState_()},t.prototype.getOverlay=function(){return this.overlay_},t.prototype.handleEvent=function(e){"contextmenu"===e.originalEvent.type&&e.originalEvent.preventDefault(),this.freehand_="Point"!==this.mode_&&this.freehandCondition_(e);var n=e.type===oa.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&e.type===oa.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,n=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===oa.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(e.coordinate),i=!1):this.freehand_&&e.type===oa.POINTERDOWN?i=!1:n&&this.getPointerCount()<2?(i=e.type===oa.POINTERMOVE)&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):("mouse"===e.originalEvent.pointerType||e.type===oa.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(e):e.type===oa.DBLCLICK&&(i=!1),r.prototype.handleEvent.call(this,e)&&i},t.prototype.handleDownEvent=function(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new ly(oa.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)},t.prototype.handleUpEvent=function(e){var n=!0;if(0===this.getPointerCount())if(this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e),this.shouldHandle_){var i=!this.finishCoordinate_;i&&this.startDrawing_(e.coordinate),!i&&this.freehand_?this.finishDrawing():!this.freehand_&&(!i||"Point"===this.mode_)&&(this.atFinish_(e.pixel)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),n=!1}else this.freehand_&&this.abortDrawing();return!n&&this.stopClick_&&e.preventDefault(),n},t.prototype.handlePointerMove_=function(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var n=this.downPx_,i=e.pixel,o=n[0]-i[0],u=n[1]-i[1],m=o*o+u*u;if(this.shouldHandle_=this.freehand_?m>this.squaredClickTolerance_:m<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?this.modifyDrawing_(e.coordinate):this.createOrUpdateSketchPoint_(e.coordinate.slice())},t.prototype.atFinish_=function(e){var n=!1;if(this.sketchFeature_){var i=!1,o=[this.finishCoordinate_],u=this.mode_;if("Point"===u)n=!0;else if("Circle"===u)n=2===this.sketchCoords_.length;else if("LineString"===u)i=this.sketchCoords_.length>this.minPoints_;else if("Polygon"===u){var m=this.sketchCoords_;i=m[0].length>this.minPoints_,o=[m[0][0],m[0][m[0].length-2]]}if(i)for(var b=this.getMap(),T=0,F=o.length;T<F;T++){var V=o[T],H=b.getPixelFromCoordinate(V),J=e[0]-H[0],ne=e[1]-H[1],we=this.freehand_?1:this.snapTolerance_;if(n=Math.sqrt(J*J+ne*ne)<=we){this.finishCoordinate_=V;break}}}return n},t.prototype.createOrUpdateSketchPoint_=function(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new dg(new Kp(e)),this.updateSketchFeatures_())},t.prototype.createOrUpdateCustomSketchLine_=function(e){this.sketchLine_||(this.sketchLine_=new dg);var n=e.getLinearRing(0),i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(n.getLayout(),n.getFlatCoordinates()),i.changed()):(i=new Lf(n.getFlatCoordinates(),n.getLayout()),this.sketchLine_.setGeometry(i))},t.prototype.startDrawing_=function(e){var n=this.getMap().getView().getProjection();this.finishCoordinate_=e,"Point"===this.mode_?this.sketchCoords_=e.slice():"Polygon"===this.mode_?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new dg(new Lf(this.sketchLineCoords_)));var i=this.geometryFunction_(this.sketchCoords_,void 0,n);this.sketchFeature_=new dg,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(i),this.updateSketchFeatures_(),this.dispatchEvent(new Xw("drawstart",this.sketchFeature_))},t.prototype.modifyDrawing_=function(e){var u,m,n=this.getMap(),i=this.sketchFeature_.getGeometry(),o=n.getView().getProjection();"Point"===this.mode_?m=this.sketchCoords_:"Polygon"===this.mode_?(m=(u=this.sketchCoords_[0])[u.length-1],this.atFinish_(n.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):m=(u=this.sketchCoords_)[u.length-1],m[0]=e[0],m[1]=e[1],this.geometryFunction_(this.sketchCoords_,i,o),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),i.getType()===$t.POLYGON&&"Polygon"!==this.mode_?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()},t.prototype.addToDrawing_=function(e){var o,u,n=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),m=this.mode_;"LineString"===m||"Circle"===m?(this.finishCoordinate_=e.slice(),(u=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?u.pop():o=!0),u.push(e.slice()),this.geometryFunction_(u,n,i)):"Polygon"===m&&((u=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?u.pop():o=!0),u.push(e.slice()),o&&(this.finishCoordinate_=u[0]),this.geometryFunction_(this.sketchCoords_,n,i)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),o&&this.finishDrawing()},t.prototype.removeLastPoint=function(){if(this.sketchFeature_){var i,e=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection(),o=this.mode_;if("LineString"===o||"Circle"===o){if((i=this.sketchCoords_).splice(-2,1),i.length>=2){this.finishCoordinate_=i[i.length-2].slice();var u=this.finishCoordinate_.slice();i[i.length-1]=u,this.createOrUpdateSketchPoint_(u)}this.geometryFunction_(i,e,n),e.getType()===$t.POLYGON&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(e)}else if("Polygon"===o){(i=this.sketchCoords_[0]).splice(-2,1);var m=this.sketchLine_.getGeometry();i.length>=2&&(u=i[i.length-2].slice(),i[i.length-1]=u,this.createOrUpdateSketchPoint_(u)),m.setCoordinates(i),this.geometryFunction_(this.sketchCoords_,e,n)}1===i.length&&this.abortDrawing(),this.updateSketchFeatures_()}},t.prototype.finishDrawing=function(){var e=this.abortDrawing_();if(e){var n=this.sketchCoords_,i=e.getGeometry(),o=this.getMap().getView().getProjection();"LineString"===this.mode_?(n.pop(),this.geometryFunction_(n,i,o)):"Polygon"===this.mode_&&(n[0].pop(),this.geometryFunction_(n,i,o),n=i.getCoordinates()),this.type_===$t.MULTI_POINT?e.setGeometry(new I1([n])):this.type_===$t.MULTI_LINE_STRING?e.setGeometry(new Uw([n])):this.type_===$t.MULTI_POLYGON&&e.setGeometry(new Vw([n])),this.dispatchEvent(new Xw("drawend",e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e)}},t.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),e},t.prototype.abortDrawing=function(){var e=this.abortDrawing_();e&&this.dispatchEvent(new Xw("drawabort",e))},t.prototype.appendCoordinates=function(e){var o,n=this.mode_,i=!this.sketchFeature_;if(i&&this.startDrawing_(e[0]),"LineString"===n||"Circle"===n)o=this.sketchCoords_;else{if("Polygon"!==n)return;o=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]}i&&o.shift(),o.pop();for(var u=0;u<e.length;u++)this.addToDrawing_(e[u]);var m=e[e.length-1];this.addToDrawing_(m),this.modifyDrawing_(m)},t.prototype.extend=function(e){var i=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=i.getCoordinates();var o=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=o.slice(),this.sketchCoords_.push(o.slice()),this.sketchPoint_=new dg(new Kp(o)),this.updateSketchFeatures_(),this.dispatchEvent(new Xw("drawstart",this.sketchFeature_))},t.prototype.updateSketchFeatures_=function(){var e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);var n=this.overlay_.getSource();n.clear(!0),n.addFeatures(e)},t.prototype.updateState_=function(){var e=this.getMap(),n=this.getActive();(!e||!n)&&this.abortDrawing(),this.overlay_.setMap(n?e:null)},t}(Xy);function W7(){var r=yP();return function(t,e){return r[t.getGeometry().getType()]}}const Y7=H7;var J7=function(){function r(t){var e=t||{};this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.scaleArray_=Cp(void 0!==e.scale?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.textBaseline_=e.textBaseline,this.fill_=void 0!==e.fill?e.fill:new Bh({color:"#333"}),this.maxAngle_=void 0!==e.maxAngle?e.maxAngle:Math.PI/4,this.placement_=void 0!==e.placement?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=void 0!==e.stroke?e.stroke:null,this.offsetX_=void 0!==e.offsetX?e.offsetX:0,this.offsetY_=void 0!==e.offsetY?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=void 0===e.padding?null:e.padding}return r.prototype.clone=function(){var t=this.getScale();return new r({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()})},r.prototype.getOverflow=function(){return this.overflow_},r.prototype.getFont=function(){return this.font_},r.prototype.getMaxAngle=function(){return this.maxAngle_},r.prototype.getPlacement=function(){return this.placement_},r.prototype.getOffsetX=function(){return this.offsetX_},r.prototype.getOffsetY=function(){return this.offsetY_},r.prototype.getFill=function(){return this.fill_},r.prototype.getRotateWithView=function(){return this.rotateWithView_},r.prototype.getRotation=function(){return this.rotation_},r.prototype.getScale=function(){return this.scale_},r.prototype.getScaleArray=function(){return this.scaleArray_},r.prototype.getStroke=function(){return this.stroke_},r.prototype.getText=function(){return this.text_},r.prototype.getTextAlign=function(){return this.textAlign_},r.prototype.getTextBaseline=function(){return this.textBaseline_},r.prototype.getBackgroundFill=function(){return this.backgroundFill_},r.prototype.getBackgroundStroke=function(){return this.backgroundStroke_},r.prototype.getPadding=function(){return this.padding_},r.prototype.setOverflow=function(t){this.overflow_=t},r.prototype.setFont=function(t){this.font_=t},r.prototype.setMaxAngle=function(t){this.maxAngle_=t},r.prototype.setOffsetX=function(t){this.offsetX_=t},r.prototype.setOffsetY=function(t){this.offsetY_=t},r.prototype.setPlacement=function(t){this.placement_=t},r.prototype.setRotateWithView=function(t){this.rotateWithView_=t},r.prototype.setFill=function(t){this.fill_=t},r.prototype.setRotation=function(t){this.rotation_=t},r.prototype.setScale=function(t){this.scale_=t,this.scaleArray_=Cp(void 0!==t?t:1)},r.prototype.setStroke=function(t){this.stroke_=t},r.prototype.setText=function(t){this.text_=t},r.prototype.setTextAlign=function(t){this.textAlign_=t},r.prototype.setTextBaseline=function(t){this.textBaseline_=t},r.prototype.setBackgroundFill=function(t){this.backgroundFill_=t},r.prototype.setBackgroundStroke=function(t){this.backgroundStroke_=t},r.prototype.setPadding=function(t){this.padding_=t},r}();const Yw=J7;var Q7=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),kT="projection",wR="coordinateFormat";!function(r){function t(e){var n=this,i=e||{},o=document.createElement("div");o.className=void 0!==i.className?i.className:"ol-mouse-position",(n=r.call(this,{element:o,render:i.render,target:i.target})||this).addChangeListener(kT,n.handleProjectionChanged_),i.coordinateFormat&&n.setCoordinateFormat(i.coordinateFormat),i.projection&&n.setProjection(i.projection);var u=!0,m="&#160;";return"undefinedHTML"in i?(void 0!==i.undefinedHTML&&(m=i.undefinedHTML),u=!!m):"placeholder"in i&&(!1===i.placeholder?u=!1:m=String(i.placeholder)),n.placeholder_=m,n.renderOnMouseOut_=u,n.renderedHTML_=o.innerHTML,n.mapProjection_=null,n.transform_=null,n}Q7(t,r),t.prototype.handleProjectionChanged_=function(){this.transform_=null},t.prototype.getCoordinateFormat=function(){return this.get(wR)},t.prototype.getProjection=function(){return this.get(kT)},t.prototype.handleMouseMove=function(e){var n=this.getMap();this.updateHTML_(n.getEventPixel(e))},t.prototype.handleMouseOut=function(e){this.updateHTML_(null)},t.prototype.setMap=function(e){if(r.prototype.setMap.call(this,e),e){var n=e.getViewport();this.listenerKeys.push(Zo(n,"pointermove",this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(Zo(n,"pointerout",this.handleMouseOut,this)),this.updateHTML_(null)}},t.prototype.setCoordinateFormat=function(e){this.set(wR,e)},t.prototype.setProjection=function(e){this.set(kT,xa(e))},t.prototype.updateHTML_=function(e){var n=this.placeholder_;if(e&&this.mapProjection_){if(!this.transform_){var i=this.getProjection();this.transform_=i?f_(this.mapProjection_,i):iS}var u=this.getMap().getCoordinateFromPixelInternal(e);if(u){var m=Pf();m&&(this.transform_=f_(this.mapProjection_,m)),this.transform_(u,u);var b=this.getCoordinateFormat();n=b?b(u):u.toString()}}(!this.renderedHTML_||n!==this.renderedHTML_)&&(this.element.innerHTML=n,this.renderedHTML_=n)},t.prototype.render=function(e){var n=e.frameState;n?this.mapProjection_!=n.viewState.projection&&(this.mapProjection_=n.viewState.projection,this.transform_=null):this.mapProjection_=null}}(ix);var n9=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),PT="units",r9=[1,2,5],RT=25.4/.28;!function(r){function t(e){var n=this,i=e||{},o=void 0!==i.className?i.className:i.bar?"ol-scale-bar":"ol-scale-line";return(n=r.call(this,{element:document.createElement("div"),render:i.render,target:i.target})||this).innerElement_=document.createElement("div"),n.innerElement_.className=o+"-inner",n.element.className=o+" "+d1,n.element.appendChild(n.innerElement_),n.viewState_=null,n.minWidth_=void 0!==i.minWidth?i.minWidth:64,n.renderedVisible_=!1,n.renderedWidth_=void 0,n.renderedHTML_="",n.addChangeListener(PT,n.handleUnitsChanged_),n.setUnits(i.units||"metric"),n.scaleBar_=i.bar||!1,n.scaleBarSteps_=i.steps||4,n.scaleBarText_=i.text||!1,n.dpi_=i.dpi||void 0,n}n9(t,r),t.prototype.getUnits=function(){return this.get(PT)},t.prototype.handleUnitsChanged_=function(){this.updateElement_()},t.prototype.setUnits=function(e){this.set(PT,e)},t.prototype.setDpi=function(e){this.dpi_=e},t.prototype.updateElement_=function(){var e=this.viewState_;if(e){var qe,n=e.center,i=e.projection,o=this.getUnits(),m=uw(i,e.resolution,n,"degrees"==o?Kd.DEGREES:Kd.METERS),b=this.minWidth_*(this.dpi_||RT)/RT,T=b*m,F="";if("degrees"==o){var V=Yd[Kd.DEGREES];(T*=V)<V/60?(F="\u2033",m*=3600):T<V?(F="\u2032",m*=60):F="\xb0"}else"imperial"==o?T<.9144?(F="in",m/=.0254):T<1609.344?(F="ft",m/=.3048):(F="mi",m/=1609.344):"nautical"==o?(m/=1852,F="nm"):"metric"==o?T<.001?(F="\u03bcm",m*=1e6):T<1?(F="mm",m*=1e3):T<1e3?F="m":(F="km",m/=1e3):"us"==o?T<.9144?(F="in",m*=39.37):T<1609.344?(F="ft",m/=.30480061):(F="mi",m/=1609.3472):bo(!1,33);for(var J,ne,we,H=3*Math.floor(Math.log(b*m)/Math.log(10));;){we=Math.floor(H/3);var Re=Math.pow(10,we);if(J=r9[(H%3+3)%3]*Re,ne=Math.round(J/m),isNaN(ne))return this.element.style.display="none",void(this.renderedVisible_=!1);if(ne>=b)break;++H}qe=this.scaleBar_?this.createScaleBar(ne,J,F):J.toFixed(we<0?-we:0)+" "+F,this.renderedHTML_!=qe&&(this.innerElement_.innerHTML=qe,this.renderedHTML_=qe),this.renderedWidth_!=ne&&(this.innerElement_.style.width=ne+"px",this.renderedWidth_=ne),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},t.prototype.createScaleBar=function(e,n,i){for(var o="1 : "+Math.round(this.getScaleForResolution()).toLocaleString(),u=[],m=e/this.scaleBarSteps_,b="#ffffff",T=0;T<this.scaleBarSteps_;T++)0===T&&u.push(this.createMarker("absolute",T)),u.push('<div><div class="ol-scale-singlebar" style="width: '+m+"px;background-color: "+b+';"></div>'+this.createMarker("relative",T)+(T%2==0||2===this.scaleBarSteps_?this.createStepText(T,e,!1,n,i):"")+"</div>"),T===this.scaleBarSteps_-1&&u.push(this.createStepText(T+1,e,!0,n,i)),b="#ffffff"===b?"#000000":"#ffffff";return'<div style="display: flex;">'+(this.scaleBarText_?'<div class="ol-scale-text" style="width: '+e+'px;">'+o+"</div>":"")+u.join("")+"</div>"},t.prototype.createMarker=function(e,n){return'<div class="ol-scale-step-marker" style="position: '+e+";top: "+("absolute"===e?3:-10)+'px;"></div>'},t.prototype.createStepText=function(e,n,i,o,u){var m=0===e?0:Math.round(o/this.scaleBarSteps_*e*100)/100;return'<div class="ol-scale-step-text" style="margin-left: '+(0===e?-3:n/this.scaleBarSteps_*-1)+"px;text-align: "+(0===e?"left":"center")+"; min-width: "+(0===e?0:n/this.scaleBarSteps_*2)+"px;left: "+(i?n+"px":"unset")+';">'+m+(0===e?"":" "+u)+"</div>"},t.prototype.getScaleForResolution=function(){var e=uw(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center),n=this.dpi_||RT,i=this.viewState_.projection.getMetersPerUnit();return parseFloat(e.toString())*i*(1e3/25.4)*n},t.prototype.render=function(e){var n=e.frameState;this.viewState_=n?n.viewState:null,this.updateElement_()}}(ix);var a9=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),s9=function(r){function t(){return r.call(this)||this}return a9(t,r),t.prototype.getType=function(){return"text"},t.prototype.readFeature=function(e,n){return this.readFeatureFromText(Kw(e),this.adaptOptions(n))},t.prototype.readFeatureFromText=function(e,n){return li()},t.prototype.readFeatures=function(e,n){return this.readFeaturesFromText(Kw(e),this.adaptOptions(n))},t.prototype.readFeaturesFromText=function(e,n){return li()},t.prototype.readGeometry=function(e,n){return this.readGeometryFromText(Kw(e),this.adaptOptions(n))},t.prototype.readGeometryFromText=function(e,n){return li()},t.prototype.readProjection=function(e){return this.readProjectionFromText(Kw(e))},t.prototype.readProjectionFromText=function(e){return this.dataProjection},t.prototype.writeFeature=function(e,n){return this.writeFeatureText(e,this.adaptOptions(n))},t.prototype.writeFeatureText=function(e,n){return li()},t.prototype.writeFeatures=function(e,n){return this.writeFeaturesText(e,this.adaptOptions(n))},t.prototype.writeFeaturesText=function(e,n){return li()},t.prototype.writeGeometry=function(e,n){return this.writeGeometryText(e,this.adaptOptions(n))},t.prototype.writeGeometryText=function(e,n){return li()},t}(fT);function Kw(r){return"string"==typeof r?r:""}const l9=s9;var u9=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),c9={POINT:Kp,LINESTRING:Lf,POLYGON:Tm,MULTIPOINT:I1,MULTILINESTRING:Uw,MULTIPOLYGON:Vw},p9={};for(var TR in $t)p9[TR]=$t[TR].toUpperCase();var d9=function(){function r(t){this.wkt=t,this.index_=-1}return r.prototype.isAlpha_=function(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"},r.prototype.isNumeric_=function(t,e){return t>="0"&&t<="9"||"."==t&&!(void 0!==e&&e)},r.prototype.isWhiteSpace_=function(t){return" "==t||"\t"==t||"\r"==t||"\n"==t},r.prototype.nextChar_=function(){return this.wkt.charAt(++this.index_)},r.prototype.nextToken=function(){var i,t=this.nextChar_(),e=this.index_,n=t;if("("==t)i=2;else if(","==t)i=5;else if(")"==t)i=3;else if(this.isNumeric_(t)||"-"==t)i=4,n=this.readNumber_();else if(this.isAlpha_(t))i=1,n=this.readText_();else{if(this.isWhiteSpace_(t))return this.nextToken();if(""!==t)throw new Error("Unexpected character: "+t);i=6}return{position:e,value:n,type:i}},r.prototype.readNumber_=function(){var t,e=this.index_,n=!1,i=!1;do{"."==t?n=!0:("e"==t||"E"==t)&&(i=!0),t=this.nextChar_()}while(this.isNumeric_(t,n)||!i&&("e"==t||"E"==t)||i&&("-"==t||"+"==t));return parseFloat(this.wkt.substring(e,this.index_--))},r.prototype.readText_=function(){var t,e=this.index_;do{t=this.nextChar_()}while(this.isAlpha_(t));return this.wkt.substring(e,this.index_--).toUpperCase()},r}(),f9=function(){function r(t){this.lexer_=t,this.token_={position:0,type:0},this.layout_="XY"}return r.prototype.consume_=function(){this.token_=this.lexer_.nextToken()},r.prototype.isTokenType=function(t){return this.token_.type==t},r.prototype.match=function(t){var e=this.isTokenType(t);return e&&this.consume_(),e},r.prototype.parse=function(){return this.consume_(),this.parseGeometry_()},r.prototype.parseGeometryLayout_=function(){var t="XY",e=this.token_;if(this.isTokenType(1)){var n=e.value;"Z"===n?t="XYZ":"M"===n?t="XYM":"ZM"===n&&(t="XYZM"),"XY"!==t&&this.consume_()}return t},r.prototype.parseGeometryCollectionText_=function(){if(this.match(2)){var t=[];do{t.push(this.parseGeometry_())}while(this.match(5));if(this.match(3))return t}throw new Error(this.formatErrorMessage_())},r.prototype.parsePointText_=function(){if(this.match(2)){var t=this.parsePoint_();if(this.match(3))return t}throw new Error(this.formatErrorMessage_())},r.prototype.parseLineStringText_=function(){if(this.match(2)){var t=this.parsePointList_();if(this.match(3))return t}throw new Error(this.formatErrorMessage_())},r.prototype.parsePolygonText_=function(){if(this.match(2)){var t=this.parseLineStringTextList_();if(this.match(3))return t}throw new Error(this.formatErrorMessage_())},r.prototype.parseMultiPointText_=function(){if(this.match(2)){var t;if(t=2==this.token_.type?this.parsePointTextList_():this.parsePointList_(),this.match(3))return t}throw new Error(this.formatErrorMessage_())},r.prototype.parseMultiLineStringText_=function(){if(this.match(2)){var t=this.parseLineStringTextList_();if(this.match(3))return t}throw new Error(this.formatErrorMessage_())},r.prototype.parseMultiPolygonText_=function(){if(this.match(2)){var t=this.parsePolygonTextList_();if(this.match(3))return t}throw new Error(this.formatErrorMessage_())},r.prototype.parsePoint_=function(){for(var t=[],e=this.layout_.length,n=0;n<e;++n){var i=this.token_;if(!this.match(4))break;t.push(i.value)}if(t.length==e)return t;throw new Error(this.formatErrorMessage_())},r.prototype.parsePointList_=function(){for(var t=[this.parsePoint_()];this.match(5);)t.push(this.parsePoint_());return t},r.prototype.parsePointTextList_=function(){for(var t=[this.parsePointText_()];this.match(5);)t.push(this.parsePointText_());return t},r.prototype.parseLineStringTextList_=function(){for(var t=[this.parseLineStringText_()];this.match(5);)t.push(this.parseLineStringText_());return t},r.prototype.parsePolygonTextList_=function(){for(var t=[this.parsePolygonText_()];this.match(5);)t.push(this.parsePolygonText_());return t},r.prototype.isEmptyGeometry_=function(){var t=this.isTokenType(1)&&"EMPTY"==this.token_.value;return t&&this.consume_(),t},r.prototype.formatErrorMessage_=function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"},r.prototype.parseGeometry_=function(){var t=this.token_;if(this.match(1)){var e=t.value;this.layout_=this.parseGeometryLayout_();var n=this.isEmptyGeometry_();if("GEOMETRYCOLLECTION"==e){if(n)return new Nw([]);var i=this.parseGeometryCollectionText_();return new Nw(i)}var o=c9[e];if(!o)throw new Error("Invalid geometry type: "+e);var u=void 0;if(n)u="POINT"==e?[NaN,NaN]:[];else switch(e){case"POINT":u=this.parsePointText_();break;case"LINESTRING":u=this.parseLineStringText_();break;case"POLYGON":u=this.parsePolygonText_();break;case"MULTIPOINT":u=this.parseMultiPointText_();break;case"MULTILINESTRING":u=this.parseMultiLineStringText_();break;case"MULTIPOLYGON":u=this.parseMultiPolygonText_()}return new o(u,this.layout_)}throw new Error(this.formatErrorMessage_())},r}(),m9=function(r){function t(e){var n=r.call(this)||this,i=e||{};return n.splitCollection_=void 0!==i.splitCollection&&i.splitCollection,n}return u9(t,r),t.prototype.parse_=function(e){var n=new d9(e);return new f9(n).parse()},t.prototype.readFeatureFromText=function(e,n){var i=this.readGeometryFromText(e,n),o=new dg;return o.setGeometry(i),o},t.prototype.readFeaturesFromText=function(e,n){for(var i,o=this.readGeometryFromText(e,n),u=[],m=0,b=(i=this.splitCollection_&&o.getType()==$t.GEOMETRY_COLLECTION?o.getGeometriesArray():[o]).length;m<b;++m){var T=new dg;T.setGeometry(i[m]),u.push(T)}return u},t.prototype.readGeometryFromText=function(e,n){return T1(this.parse_(e),!1,n)},t.prototype.writeFeatureText=function(e,n){var i=e.getGeometry();return i?this.writeGeometryText(i,n):""},t.prototype.writeFeaturesText=function(e,n){if(1==e.length)return this.writeFeatureText(e[0],n);for(var i=[],o=0,u=e.length;o<u;++o)i.push(e[o].getGeometry());var m=new Nw(i);return this.writeGeometryText(m,n)},t.prototype.writeGeometryText=function(e,n){return AR(T1(e,!0,n))},t}(l9);function IR(r){var t=r.getCoordinates();return 0===t.length?"":t.join(" ")}function OT(r){for(var t=r.getCoordinates(),e=[],n=0,i=t.length;n<i;++n)e.push(t[n].join(" "));return e.join(",")}function MR(r){for(var t=[],e=r.getLinearRings(),n=0,i=e.length;n<i;++n)t.push("("+OT(e[n])+")");return t.join(",")}var b9={Point:IR,LineString:OT,Polygon:MR,MultiPoint:function(r){for(var t=[],e=r.getPoints(),n=0,i=e.length;n<i;++n)t.push("("+IR(e[n])+")");return t.join(",")},MultiLineString:function(r){for(var t=[],e=r.getLineStrings(),n=0,i=e.length;n<i;++n)t.push("("+OT(e[n])+")");return t.join(",")},MultiPolygon:function(r){for(var t=[],e=r.getPolygons(),n=0,i=e.length;n<i;++n)t.push("("+MR(e[n])+")");return t.join(",")},GeometryCollection:function(r){for(var t=[],e=r.getGeometries(),n=0,i=e.length;n<i;++n)t.push(AR(e[n]));return t.join(",")}};function AR(r){var t=r.getType(),n=(0,b9[t])(r);if(t=t.toUpperCase(),"function"==typeof r.getFlatCoordinates){var i=function(r){var t=r.getLayout(),e="";return("XYZ"===t||"XYZM"===t)&&(e+="Z"),("XYM"===t||"XYZM"===t)&&(e+="M"),e}(r);i.length>0&&(t+=" "+i)}return 0===n.length?t+" EMPTY":t+"("+n+")"}const DR=m9,C9=["mapElement"],Ti="_DEFAULT_",kR=new ao("EXTRA_LAYERS");let ux=(()=>{class r{getRdNewCrsConfig(){if(void 0===this.rdNewCrsConfig){const e="EPSG:28992",n=[-285401.92,22598.08,595401.92,903401.92],i=[3440.64,1720.32,860.16,430.08,215.04,107.52,53.76,26.88,13.44,6.72,3.36,1.68,.84,.42,.21,.105,.0525,.02625,.013125,.0065625,.00328125,.001640625,820313e-9,410156e-9,205078e-9,102539e-9],o=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432],u=[];for(let m=0;m<i.length;++m)u[m]=e+":"+m;this.rdNewCrsConfig={projectionCode:e,extent:n,resolutions:i,matrixSet:e,matrixIds:u,matrixSizes:o,units:"m"}}return this.rdNewCrsConfig}}return r.\u0275fac=function(e){return new(e||r)},r.MAX_ZOOMLEVEL=25,r.\u0275prov=Hr({factory:function(){return new r},token:r,providedIn:"root"}),r})();class D_{constructor(t){this.map=new Map,this.create=t}get size(){return this.map.size}getOrCreate(t){if(!this.map.has(t)){const e=this.create();this.map.set(t,{subject:e,observable:e.asObservable()})}return this.map.get(t)}getOrCreateSubject(t){return this.getOrCreate(t).subject}getOrCreateObservable(t){return this.getOrCreate(t).observable}get(t){return this.map.get(t)}has(t){return this.map.has(t)}delete(t){return this.map.delete(t)}}let Jw=(()=>{class r{constructor(){this.loadCounter=new Map,this.loadStatesMap=new D_(()=>new Jd(0))}destroyLoadersForMap(e){this.loadCounter.delete(e),this.loadStatesMap.delete(e)}isLoading(e){return this.loadStatesMap.getOrCreateObservable(e).pipe(Zr(n=>n>0),wk())}updateLoadCounter(e,n){this.loadCounter.has(e)||this.loadCounter.set(e,0);const i=this.getCurrentCount(e)+n;this.loadCounter.set(e,i),this.loadStatesMap.getOrCreateSubject(e).next(i)}getCurrentCount(e){return this.loadCounter.get(e)||0}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=Hr({factory:function(){return new r},token:r,providedIn:"root"}),r})();var mu=(()=>(function(r){r.MAPINITIALIZED="mapInitialized",r.ZOOMEND="zoomEnd",r.ZOOMENDLOCATION="zoomEndLocation",r.SINGLECLICK="singleClick",r.EMPTYPARAMETER="emptyParameter",r.WMSFEATUREINFO="WmsFeatureInfo",r.WMTSFEATUREINFO="WmtsFeatureInfo",r.GEOJSONFEATUREINFO="geoJsonFeatureInfo",r.SUCCESSFUL="successful",r.UNSUCCESSFUL="unsuccessful",r.LOADING="loading",r.SELECTIONSERVICE_MAPCLICKED="selectionServiceMapClicked",r.SELECTIONSERVICE_CLEARSELECTION="selectionServiceClearSelection",r.SELECTIONSERVICE_SELECTIONUPDATED="selectionServiceSelectionUpdated"}(mu||(mu={})),mu))();class Ec{constructor(t){this.type=t.type,this.mapName=t.mapName,this.layerName=t.layerName,this.message=t.message,this.value=t.value}}class O9{constructor(t,e){this.center=t,this.zoom=e}}let Sp=(()=>{class r{constructor(e){this.crsConfigService=e,this.olMaps=new Map,this.extraLayers=["selection","highlight"],this.extraLayersMap=new Map,this.rdNewConfig=this.crsConfigService.getRdNewCrsConfig(),this.rdNewProjection=new h_({code:this.rdNewConfig.projectionCode,extent:this.rdNewConfig.extent,units:this.rdNewConfig.units,getPointResolution:n=>n}),jD(this.rdNewProjection)}createAndGetMap(e,n=0,i=14){this.olMaps.has(e=null!=e?e:Ti)||this.olMaps.set(e,this.createNewOlMap());const o=this.olMaps.get(e);return o.setView(new Of({projection:this.rdNewProjection,resolutions:this.rdNewConfig.resolutions.slice(0,i+1),center:[16e4,455e3]})),o.getView().setMinZoom(Math.floor(n)),this.createExtraLayers(e),o}getMap(e){return this.olMaps.has(e=null!=e?e:Ti)||this.olMaps.set(e,this.createNewOlMap()),this.olMaps.get(e)}getLayer(e,n=Ti){return this.getMap(n).getLayers().getArray().find(o=>o.get("ggc-layer-id")===e)}getExtraLayer(e,n=Ti){return this.extraLayersMap.get(`${n}-${e}`)}checkMapIndex(e=Ti){return this.olMaps.has(e=null!=e?e:Ti)}destroyMap(e){this.olMaps.delete(e),this.extraLayers.forEach(n=>{this.extraLayersMap.delete(`${e}-${n}`)})}decideMapComponentEventType(e,n){const i=null!=n?n:Ti;return new Ec(e?{type:mu.SUCCESSFUL,mapName:i,message:"Methode succesvol uitgevoerd"}:{type:mu.UNSUCCESSFUL,mapName:i,message:`Mapindex bestaat niet voor index: ${i}`})}addFeaturesToHighlightLayer(e,n){return this.checkMapIndex(n)?(this.getHighlightLayerSource(n).addFeatures(e),this.decideMapComponentEventType(!0,n)):this.decideMapComponentEventType(!1,n)}clearHighlightLayer(e){if(this.checkMapIndex(e)){const n=this.getHighlightLayerSource(e);return n&&n.clear(),this.decideMapComponentEventType(!0,e)}return this.decideMapComponentEventType(!1,e)}changeHighlightLayerStyle(e,n){this.changeLayerStyle(e,n,"highlight")}addFeaturesToSelectionLayer(e,n){return this.checkMapIndex(n)?(this.getSelectionLayerSource(n).addFeatures(e),this.decideMapComponentEventType(!0,n)):this.decideMapComponentEventType(!1,n)}clearSelectionLayer(e){return this.checkMapIndex(e)?(this.getSelectionLayerSource(e).clear(),this.decideMapComponentEventType(!0,e)):this.decideMapComponentEventType(!1,e)}changeSelectionLayerStyle(e,n){this.changeLayerStyle(e,n,"selection")}changeLayerStyle(e,n,i){const o=this.extraLayersMap.get(`${n}-${i}`);null==o||o.setStyle(e)}setExtraLayers(e){this.extraLayers=[...this.extraLayers,...e]}createNewOlMap(){return new dT({interactions:tP({onFocusOnly:!1}),layers:[],view:new Of({projection:this.rdNewProjection})})}getHighlightLayerSource(e){var n;return null===(n=this.extraLayersMap.get(`${e}-highlight`))||void 0===n?void 0:n.getSource()}getSelectionLayerSource(e){var n;return null===(n=this.extraLayersMap.get(`${e}-selection`))||void 0===n?void 0:n.getSource()}createExtraLayers(e){this.extraLayers.forEach(n=>{const i=this.createLayerAndAddToMap(new dl,e);this.extraLayersMap.set(`${e}-${n}`,i)}),this.setDefaultHighlightLayerStyle(e),this.setDefaultSelectionLayerStyle(e)}setDefaultHighlightLayerStyle(e){const n=new dl({fill:new Bh({color:"rgba(0, 115, 149, 0.5)"}),stroke:new Ku({color:"#007395",width:5}),image:new S_({radius:7,fill:new Bh({color:"rgba(0, 115, 149, 0.5)"}),stroke:new Ku({color:"#007395",width:5})})}),i=this.extraLayersMap.get(`${e}-highlight`);null==i||i.setStyle(n)}setDefaultSelectionLayerStyle(e){const n=new Bh({color:"rgba(255,255,255,0.5)"}),i=new Ku({color:"#0093be",width:4}),o=new dl({fill:n,stroke:i,image:new S_({fill:n,stroke:i,radius:5})}),u=this.extraLayersMap.get(`${e}-selection`);null==u||u.setStyle(o)}createLayerAndAddToMap(e,n){const i=new __,o=new I_({source:i,style:e}),u=this.getMap(n);return o.setMap(u),o}}return r.\u0275fac=function(e){return new(e||r)(Xn(ux))},r.\u0275prov=Hr({factory:function(){return new r(Xn(ux))},token:r,providedIn:"root"}),r})();class PR{constructor(t){this.coordinate=t,this.featureCollectionForLayers=[]}}class RR{}var Qw=(()=>(function(r){r.SINGLE_SELECT="singleselect",r.MULTI_SELECT="multiselect"}(Qw||(Qw={})),Qw))();let OR=(()=>{class r{constructor(){this.selectionModeMap=new Map,this.allSelections=new Map,this.subjectMap=new Map,this.observableMap=new Map}destroySelectionForMap(e){this.subjectMap.has(e)&&(this.observableMap.delete(e),this.subjectMap.delete(e)),this.selectionModeMap.delete(e),this.allSelections.delete(e)}setSelectionModeForMapName(e,n){this.selectionModeMap.set(n,e)}isMultiSelectMode(e){return!!this.selectionModeMap.has(e)&&this.selectionModeMap.get(e)===Qw.MULTI_SELECT}getObservableForMap(e){return this.createIfNotExistsSubjectAndObservableForMap(e),this.observableMap.get(e)}clearSelectionForMap(e){this.allSelections.set(e,new RR),this.emitEvent(e,new Ec({type:mu.SELECTIONSERVICE_CLEARSELECTION,mapName:e,message:r.messageClearSelection}))}setSelectionForLayer(e,n,i){const o=this.getAllSelectionsForMap(i),u=o.current||new PR,m=u.featureCollectionForLayers.find(b=>b.layerName===n);m?m.features=e:u.featureCollectionForLayers.push({layerName:n,features:e}),o.current=u,this.emitEvent(i,new Ec({layerName:n,type:mu.SELECTIONSERVICE_SELECTIONUPDATED,mapName:i,message:r.messageMapClicked,value:o.current}))}handleSingleclickEventForMap(e,n){const i=this.getAllSelectionsForMap(n);this.isMultiSelectMode(n)&&(i.previous=i.current),i.current=new PR(e),this.emitEvent(n,new Ec({type:mu.SELECTIONSERVICE_MAPCLICKED,mapName:n,message:r.messageMapClicked,value:i.current}))}clearFeatureInfoForLayer(e,n){const i=this.getAllSelectionsForMap(e),o=i.current;if(null==o)return;const u=o.featureCollectionForLayers.find(m=>m.layerName===n);u&&(o.featureCollectionForLayers=o.featureCollectionForLayers.filter(m=>m!==u)),setTimeout(()=>{this.emitEvent(e,new Ec({type:mu.SELECTIONSERVICE_SELECTIONUPDATED,mapName:e,layerName:n,message:r.messageSelectionUpdated,value:i.current}))})}handleFeatureInfoForLayer(e,n,i,o){const u=this.getAllSelectionsForMap(e),m=u.current;if(m&&m.coordinate===n){if(this.isMultiSelectMode(e)){let b;if(u.previous&&(b=u.previous.featureCollectionForLayers.find(T=>T.layerName===o)),b){const T=this.getMultiSelectFeatures(b.features,i);m.featureCollectionForLayers.push({layerName:o,features:T})}else m.featureCollectionForLayers.push({layerName:o,features:i})}else m.featureCollectionForLayers.push({layerName:o,features:i});this.emitEvent(e,new Ec({type:mu.SELECTIONSERVICE_SELECTIONUPDATED,mapName:e,layerName:o,message:r.messageSelectionUpdated,value:u.current}))}else this.emitEvent(e,new Ec({type:mu.UNSUCCESSFUL,mapName:e,message:r.messageCoordinateDoesNotMatch}))}getMultiSelectFeatures(e,n){const i=e;return n.forEach(o=>{const u=e.findIndex(m=>m.getId()===o.getId());u<0?i.unshift(o):i.splice(u,1)}),i}createIfNotExistsSubjectAndObservableForMap(e){this.subjectMap.has(e)||(this.subjectMap.set(e,new Er),this.observableMap.set(e,this.subjectMap.get(e).asObservable()))}getAllSelectionsForMap(e){return this.allSelections.has(e)?this.allSelections.get(e):this.allSelections.set(e,new RR).get(e)}emitEvent(e,n){this.createIfNotExistsSubjectAndObservableForMap(e),this.subjectMap.get(e).next(n)}}return r.\u0275fac=function(e){return new(e||r)},r.messageClearSelection="Selectie is gewist",r.messageMapClicked="Er is geklikt in de kaart en de feature info wordt opgehaald.",r.messageSelectionUpdated="Nieuwe feature info van een kaartlaag toegevoegd aan de selectie.",r.messageCoordinateDoesNotMatch="Er is iets mis gegaan in de CoreSelectionService: het coordinaat van de kaartlaag komt niet overeen met het verwachte coordinaat van het klik-event in de kaart.",r.\u0275prov=Hr({factory:function(){return new r},token:r,providedIn:"root"}),r})(),LR=(()=>{class r{constructor(e){this.injector=e,this.mapName=Ti,this.eventKeys=[],this.loadCounter=0,this.coreMapService=e.get(Sp),this.coreLoadingService=e.get(Jw),this.coreSelectionService=e.get(OR),this.crsConfig=e.get(ux)}ngOnInit(){this.rdNewConfig=this.crsConfig.getRdNewCrsConfig()}ngOnDestroy(){void 0!==this.map&&void 0!==this.olLayer&&(this.map.removeLayer(this.olLayer),n1(this.eventKeys),this.coreLoadingService.updateLoadCounter(this.mapName,-1*this.loadCounter))}setLayer(e){this.olLayer=e;const n=this.olLayer.getSource();n instanceof fk?(this.eventKeys.push(n.on("tileloadstart",()=>this.loadStart())),this.eventKeys.push(n.on("tileloadend",()=>this.loadEnd())),this.eventKeys.push(n.on("tileloaderror",()=>this.loadError()))):n instanceof __?(this.eventKeys.push(n.on("featuresloadstart",()=>this.loadStart())),this.eventKeys.push(n.on("featuresloadend",()=>this.loadEnd())),this.eventKeys.push(n.on("featuresloaderror",()=>this.loadError()))):n instanceof dS&&(this.eventKeys.push(n.on("imageloadstart",()=>this.loadStart())),this.eventKeys.push(n.on("imageloadend",()=>this.loadEnd())),this.eventKeys.push(n.on("imageloaderror",()=>this.loadError()))),this.map=this.coreMapService.getMap(this.mapName),this.map.addLayer(this.olLayer)}loadStart(){this.loadCounter++,this.coreLoadingService.updateLoadCounter(this.mapName,1)}loadEnd(){this.loadCounter--,this.coreLoadingService.updateLoadCounter(this.mapName,-1)}loadError(){this.loadCounter--,this.coreLoadingService.updateLoadCounter(this.mapName,-1)}}return r.\u0275fac=function(e){return new(e||r)(qn(Fo))},r.\u0275cmp=eo({type:r,selectors:[["ng-component"]],inputs:{mapName:"mapName"},decls:0,vars:0,template:function(e,n){},encapsulation:2}),r})(),A1=(()=>{class r{constructor(e){this.coreLoadingServiceService=e,this.singleclickMap=new D_(()=>new Er),this.zoomendMap=new D_(()=>new BU(1))}destroyEventsForMap(e){this.destroySingleclickForMap(e),this.destroyZoomendForMap(e)}emitSingleclickEventForMap(e,n){this.singleclickMap.getOrCreateSubject(n).next(e)}getSingleclickObservableForMap(e){return this.singleclickMap.getOrCreateObservable(e)}destroySingleclickForMap(e){this.singleclickMap.delete(e)}emitZoomendEventForMap(e,n){this.zoomendMap.getOrCreateSubject(n).next(e)}getZoomendObservableForMap(e){return this.zoomendMap.getOrCreateObservable(e)}destroyZoomendForMap(e){this.zoomendMap.delete(e)}getLoadingObservableForMap(e){return this.coreLoadingServiceService.isLoading(e)}}return r.\u0275fac=function(e){return new(e||r)(Xn(Jw))},r.\u0275prov=Hr({factory:function(){return new r(Xn(Jw))},token:r,providedIn:"root"}),r})(),FR=(()=>{class r extends LR{constructor(e){super(e),this.injector=e,this.events=new Nn,this.requiredProperties=["url","minResolution","maxResolution","attributions","zIndex"]}static GetProperty(e,n){return e[n]}ngOnInit(){super.ngOnInit(),this.requiredProperties.forEach(e=>{void 0===r.GetProperty(this,e)&&this.logLegeParameter(e),"url"===e&&""===this.url&&this.logLegeParameter("url")}),this.layerOptions={minResolution:this.minResolution,maxResolution:this.maxResolution,zIndex:this.zIndex}}ngOnDestroy(){super.ngOnDestroy()}logLegeParameter(e){this.events.emit(new Ec({type:mu.EMPTYPARAMETER,mapName:this.mapName,layerName:this.layerName,message:"De waarde van "+e+" is niet ingevuld voor deze laag"}))}setLayer(e){super.setLayer(e),this.olLayer.set("ggc-layer-id",this.layerId),void 0!==this.attributions&&this.olLayer.getSource().setAttributions(this.attributions)}}return r.\u0275fac=function(e){return new(e||r)(qn(Fo))},r.\u0275cmp=eo({type:r,selectors:[["ggc-abstract-configurable-layer"]],inputs:{attributions:"attributions",layerId:"layerId",layerName:"layerName",maxResolution:"maxResolution",minResolution:"minResolution",url:"url",zIndex:"zIndex"},outputs:{events:"events"},features:[Xg],decls:0,vars:0,template:function(e,n){},encapsulation:2}),r})(),FT=(()=>{class r extends FR{constructor(e){super(e),this.injector=e,this.maxFeaturesOnSingleclick=8,this.mapEventsService=e.get(A1)}ngOnInit(){super.ngOnInit(),this.getFeatureInfoOnSingleclick&&(this.singleclick=this.mapEventsService.getSingleclickObservableForMap(this.mapName).subscribe(e=>{this.getFeatureInfo(e)}))}ngOnDestroy(){super.ngOnDestroy(),void 0!==this.singleclick&&this.singleclick.unsubscribe(),this.getFeatureInfoOnSingleclick&&this.layerName&&this.coreSelectionService.clearFeatureInfoForLayer(this.mapName,this.layerName)}getFeatureInfo(e){}}return r.\u0275fac=function(e){return new(e||r)(qn(Fo))},r.\u0275cmp=eo({type:r,selectors:[["ng-component"]],inputs:{maxFeaturesOnSingleclick:"maxFeaturesOnSingleclick",getFeatureInfoOnSingleclick:"getFeatureInfoOnSingleclick"},features:[Xg],decls:0,vars:0,template:function(e,n){},encapsulation:2}),r})();class B9{constructor(t){this.setFeatureInfoUrl(t)}getFeatureInfoUrl(){return this.featureInfoUrl}setFeatureInfoUrl(t){var e,n,i,o,u;this.featureInfoUrl=(null===(o=null===(i=null===(n=null===(e=null==t?void 0:t.OperationsMetadata)||void 0===e?void 0:e.GetFeatureInfo)||void 0===n?void 0:n.DCP)||void 0===i?void 0:i.HTTP)||void 0===o?void 0:o.Get)&&t.OperationsMetadata.GetFeatureInfo.DCP.HTTP.Get.length>0&&(null===(u=t.OperationsMetadata.GetFeatureInfo.DCP.HTTP.Get[0])||void 0===u?void 0:u.href)}}let j9=(()=>{class r{constructor(e,n){this.coreMapService=e,this.httpClient=n,this.capabilitiesMap=new Map,this.format=new G7}getCapabilitiesForUrl(e){if(this.capabilitiesMap.has(e))return this.capabilitiesMap.get(e);{const n=this.httpClient.get(e,{responseType:"text",params:{request:"getCapabilities",service:"WMTS"}}).pipe(Zr(i=>this.format.read(i)));return this.capabilitiesMap.set(e,n),n}}optionsFromCapabilities(e,n){return function(r,t){var n=j0(r.Contents.Layer,function(En,ma,Mi){return En.Identifier==t.layer});if(null===n)return null;var o,i=r.Contents.TileMatrixSet;(o=n.TileMatrixSetLink.length>1?$E(n.TileMatrixSetLink,"projection"in t?function(En,ma,Mi){var ws=j0(i,function(Yc){return Yc.Identifier==En.TileMatrixSet}).SupportedCRS,cr=xa(ws),fl=xa(t.projection);return cr&&fl?Sm(cr,fl):ws==t.projection}:function(En,ma,Mi){return En.TileMatrixSet==t.matrixSet}):0)<0&&(o=0);var u=n.TileMatrixSetLink[o].TileMatrixSet,m=n.TileMatrixSetLink[o].TileMatrixSetLimits,b=n.Format[0];"format"in t&&(b=t.format),(o=$E(n.Style,function(En,ma,Mi){return"style"in t?En.Title==t.style:En.isDefault}))<0&&(o=0);var T=n.Style[o].Identifier,F={};"Dimension"in n&&n.Dimension.forEach(function(En,ma,Mi){var ws=En.Default;void 0===ws&&(ws=En.Value[0]),F[En.Identifier]=ws});var J,H=j0(r.Contents.TileMatrixSet,function(En,ma,Mi){return En.Identifier==u}),ne=H.SupportedCRS;if(ne&&(J=xa(ne)),"projection"in t){var we=xa(t.projection);we&&(!J||Sm(we,J))&&(J=we)}var Re=!1,qe="ne"==J.getAxisOrientation().substr(0,2),Ne=H.TileMatrix[0],$e={MinTileCol:0,MinTileRow:0,MaxTileCol:Ne.MatrixWidth-1,MaxTileRow:Ne.MatrixHeight-1};if(m){$e=m[m.length-1];var tt=j0(H.TileMatrix,function(En){return En.Identifier===$e.TileMatrix||H.Identifier+":"+En.Identifier===$e.TileMatrix});tt&&(Ne=tt)}var bt=28e-5*Ne.ScaleDenominator/J.getMetersPerUnit(),dn=qe?[Ne.TopLeftCorner[1],Ne.TopLeftCorner[0]]:Ne.TopLeftCorner,Kt=Ne.TileWidth*bt,vn=Ne.TileHeight*bt,Bt=H.BoundingBox,Dn=[dn[0]+Kt*$e.MinTileCol,dn[1]-vn*(1+$e.MaxTileRow),dn[0]+Kt*(1+$e.MaxTileCol),dn[1]-vn*$e.MinTileRow];if(void 0!==Bt&&!ag(Bt,Dn)){var un=n.WGS84BoundingBox,Fn=xa("EPSG:4326").getExtent();if(Dn=Bt,un)Re=un[0]===Fn[0]&&un[2]===Fn[2];else{var kr=cw(Bt,H.SupportedCRS,"EPSG:4326");Re=kr[0]-1e-10<=Fn[0]&&kr[2]+1e-10>=Fn[2]}}var Jr=function(r,t,e){var n=[],i=[],o=[],u=[],m=[],b=void 0!==e?e:[],F="TileMatrix",V="Identifier",H="ScaleDenominator",J="TopLeftCorner",qe=xa(r.SupportedCRS),Ne=qe.getMetersPerUnit(),$e="ne"==qe.getAxisOrientation().substr(0,2);return r[F].sort(function(tt,bt){return bt[H]-tt[H]}),r[F].forEach(function(tt){if(!(b.length>0)||j0(b,function(Bt){return tt[V]==Bt[F]||-1===tt[V].indexOf(":")&&r[V]+":"+tt[V]===Bt[F]})){i.push(tt[V]);var dn=28e-5*tt[H]/Ne,Kt=tt.TileWidth,vn=tt.TileHeight;o.push($e?[tt[J][1],tt[J][0]]:tt[J]),n.push(dn),u.push(Kt==vn?Kt:[Kt,vn]),m.push([tt.MatrixWidth,tt.MatrixHeight])}}),new QP({extent:t,origins:o,resolutions:n,matrixIds:i,tileSizes:u,sizes:m})}(H,Dn,m),Ur=[],Mr=t.requestEncoding;if(Mr=void 0!==Mr?Mr:"","OperationsMetadata"in r&&"GetTile"in r.OperationsMetadata)for(var _n=r.OperationsMetadata.GetTile.DCP.HTTP.Get,Qi=0,go=_n.length;Qi<go;++Qi)if(_n[Qi].Constraint){var as=j0(_n[Qi].Constraint,function(En){return"GetEncoding"==En.name}).AllowedValues.Value;if(""===Mr&&(Mr=as[0]),"KVP"!==Mr)break;MD(as,"KVP")&&Ur.push(_n[Qi].href)}else _n[Qi].href&&(Mr="KVP",Ur.push(_n[Qi].href));return 0===Ur.length&&(Mr="REST",n.ResourceURL.forEach(function(En){"tile"===En.resourceType&&(b=En.format,Ur.push(En.template))})),{urls:Ur,layer:t.layer,matrixSet:u,format:b,projection:J,requestEncoding:Mr,tileGrid:Jr,style:T,dimensions:F,wrapX:Re,crossOrigin:t.crossOrigin}}(e,n)}hasFeatureInfoUrl(e){return!!e.getFeatureInfoUrl()}createGetFeatureInfoUrlObservable(e,n,i,o){const u=this.constructGetFeatureInfoParams(n,i,o);return this.httpClient.get(e,{params:u})}constructGetFeatureInfoParams(e,n,i){const o=e.getTileGrid(),u=o.getTileCoordForCoordAndResolution(n,i),m=u[1],b=u[2],T=o.getTileCoordExtent(u),F=o.getResolution(u[0]),V=o.getZForResolution(F),H=Math.floor((n[0]-T[0])/F),J=Math.floor((T[3]-n[1])/F);return{SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetFeatureInfo",LAYER:e.getLayer(),STYLE:"",FORMAT:"image/png",TileCol:""+m,TileRow:""+b,TileMatrix:e.getMatrixSet()+":"+V,TileMatrixSet:e.getMatrixSet(),I:""+H,J:""+J,infoformat:"application/json",info_format:"application/json",FEATURE_COUNT:"8"}}}return r.\u0275fac=function(e){return new(e||r)(Xn(Sp),Xn(sx))},r.\u0275prov=Hr({factory:function(){return new r(Xn(Sp),Xn(sx))},token:r,providedIn:"root"}),r})(),NR=(()=>{class r extends FT{constructor(e){super(e),this.injector=e,this.capabilitiesService=e.get(j9)}ngOnInit(){this.requiredProperties.push("layer"),super.ngOnInit(),this.capabilitiesSubscription=this.capabilitiesService.getCapabilitiesForUrl(this.url).subscribe(e=>{if(e){this.capabilities=new B9(e);const n=this.capabilitiesService.optionsFromCapabilities(e,{format:"image/png",layer:this.layer||"",projection:this.rdNewConfig.projectionCode,style:"default",crossOrigin:"anonymous"});void 0!==this.opacity&&this.opacity<1&&(n.transition=0,this.layerOptions.opacity=this.opacity),this.wmtsSource=new eR(n),this.setLayer(new xT(Object.assign(Object.assign({},this.layerOptions),{source:this.wmtsSource})))}else this.capabilities=void 0,console.error("Invalid capabilities")})}getFeatureInfo(e){const n=e.coordinate,i=this.map.getView().getResolution();i&&((r,t,e)=>(!t||r>=t)&&(!e||r<e))(i,this.minResolution,this.maxResolution)&&this.capabilities&&this.capabilitiesService.hasFeatureInfoUrl(this.capabilities)?(this.coreMapService.getMap(this.mapName).getView().getZoomForResolution(i),this.capabilitiesService.createGetFeatureInfoUrlObservable(this.url,this.wmtsSource,n,i).subscribe(m=>{const T=(new Gw).readFeatures(m);this.emitFeatureInfoEvent(T,n)},()=>{this.emitFeatureInfoEvent([],n)})):this.emitFeatureInfoEvent([],n)}emitFeatureInfoEvent(e,n){this.layerName&&this.coreSelectionService.handleFeatureInfoForLayer(this.mapName,n,e,this.layerName),this.events.emit(new Ec({type:mu.WMTSFEATUREINFO,mapName:this.mapName,layerName:this.layerName,message:"WMTS getFeatureInfo resultaten: ",value:e}))}ngOnDestroy(){void 0!==this.capabilitiesSubscription&&this.capabilitiesSubscription.unsubscribe(),super.ngOnDestroy()}}return r.\u0275fac=function(e){return new(e||r)(qn(Fo))},r.\u0275cmp=eo({type:r,selectors:[["ggc-wmts-layer"]],inputs:{opacity:"opacity",layer:"layer"},features:[Xg],decls:0,vars:0,template:function(e,n){},encapsulation:2}),r})(),eC=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=Gi({type:r}),r.\u0275inj=io({imports:[[Df,dR]]}),r})(),zT=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=Gi({type:r}),r.\u0275inj=io({imports:[[Df]]}),r})(),NT=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=Gi({type:r}),r.\u0275inj=io({}),r})();var cx=(()=>(function(r){r.DRAWEND="drawend",r.DRAWSTART="drawstart"}(cx||(cx={})),cx))(),zu=(()=>(function(r){r.RECTANGLE="rectangle",r.POLYGON="polygon",r.LINESTRING="linestring",r.POINT="point",r.CIRCLE="circle"}(zu||(zu={})),zu))(),Tp=(()=>(function(r){r.DRAW="drawing",r.MEASURE="measuring"}(Tp||(Tp={})),Tp))();class jR{constructor(t,e,n,i,o){this.type=t,this.drawType=e,this.mapName=n,this.message=i,this.event=o}}var tC=(()=>(function(r){r.MODIFYEND="modifyend"}(tC||(tC={})),tC))();class U9{constructor(t){this.type=t.type,this.mapName=t.mapName,this.message=t.message,this.event=t.event}}var k_=(()=>(function(r){r.STOP_MEASURING="stopMeasuring",r.DELETE_MEASURESUBSCRIPTIONS="deleteMeasuresubscriptions"}(k_||(k_={})),k_))();class UR{constructor(t){this.type=t}}const BT=[255,255,255,1],VR=[0,153,255,1],rC="#666666",hx=new Yw({fill:new Bh({color:BT}),padding:[5,6,5,5],offsetY:-25}),GR=new Yw({fill:new Bh({color:rC}),padding:[5,6,5,5],offsetY:-25}),jT=new C1({src:`data:image/svg+xml,${encodeURIComponent(eO(rC,rC))}`}),q9=new C1({src:`data:image/svg+xml,${encodeURIComponent(eO("#fff",rC))}`}),qR=[new dl({fill:new Bh({color:[255,255,255,.5]})})],ZR=[new dl({stroke:new Ku({color:BT,width:5})}),new dl({stroke:new Ku({color:VR,width:3})})],HR=[new dl({image:new S_({radius:6,fill:new Bh({color:VR}),stroke:new Ku({color:BT,width:1.5})}),zIndex:1/0})],WR=new Bh({color:"rgba(255, 255, 255, 0.4)"}),$R=new Ku({color:"#3399CC",width:1.25}),px=[new dl({image:new S_({fill:WR,stroke:$R,radius:5}),fill:WR,stroke:$R})],XR=r=>{const t=r.getGeometry();let e=t.getLastCoordinate(),n="";if(t.getType()===$t.POLYGON){let o=0;const u=t.getCoordinates()[0];e=u.reduce((m,b)=>(m&&(o+=new Lf([m,b]).getLength()),b)),u.length>1&&(e=u[u.length-2]),n=rO(o)}else n=UT(t);hx.setText(n);const i=new Kp(e);return new dl({geometry:i,image:jT,text:hx.clone()})},YR=r=>{const t=new Kp([0,0]);let e="";if(r.getGeometry().getType()===$t.POLYGON){const n=r.getGeometry();t.setCoordinates(n.getInteriorPoint().getCoordinates()),e=function(r){const t=r.getArea();let e;return e=t>1e4?Math.round(t/1e6*100)/100+" km2":Math.round(100*t)/100+" m2",e}(n)}else t.setCoordinates(r.getGeometry().getLastCoordinate());return hx.setText(e),new dl({geometry:t,image:jT,text:hx.clone()})},Z9=r=>nO(r,!1),H9=r=>nO(r,!0),KR=r=>{const t=r.getGeometry(),e=[];return t instanceof Lf?t.forEachSegment((n,i)=>{e.push(tO(n,i))}):t instanceof Tm&&t.getCoordinates()[0].reduce((n,i)=>(n&&e.push(tO(n,i)),i)),e};function UT(r){return rO(r.getLength())}function eO(r,t){return`<svg width="80" height="75" xmlns="http://www.w3.org/2000/svg">\n        <rect opacity="0.9" rx="5" id="svg_1" height="21.25" width="78" y="0" x="1" stroke="${t}" stroke-width="1" fill="${r}"/>\n        <path opacity="0.9" transform="rotate(-180, 40, 27.332)" id="svg_5"\n          d="m33.12426,33.08272l6.87567,-11.50139l6.87567,11.50139l-13.75134,0z" fill-opacity="null" stroke-opacity="null"\n          stroke-width="1" stroke="${t}" fill="${r}"/>\n       </svg>`}function tO(r,t){const e=new Lf([r,t]);return GR.setText(UT(e)),new dl({geometry:new Kp(e.getFlatMidpoint()),image:q9,text:GR.clone()})}function nO(r,t){const e={};return e[$t.POLYGON]=t?px:qR,e[$t.MULTI_POLYGON]=t?px:qR,e[$t.LINE_STRING]=t?px:ZR,e[$t.MULTI_LINE_STRING]=t?px:ZR,e[$t.POINT]=t?px:HR,e[$t.MULTI_POINT]=t?px:HR,e[r.getGeometry().getType()]}function rO(r){let t;return t=r>100?Math.round(r/1e3*100)/100+" km":Math.round(100*r)/100+" m",t}let iO=(()=>{class r{getMeasureStyle(e,n,i){const o={};return o.drawingDrawStyle=this.extendStyleFunctionWithLabels(i&&i.drawingDrawStyle?i.drawingDrawStyle:Z9,e,n),o.finishDrawStyle=this.extendStyleFunctionWithLabelsFinish(i&&i.finishDrawStyle?i.finishDrawStyle:H9,n),o}extendStyleFunctionWithLabels(e,n,i){return(o,u)=>{const m=o.getGeometry().getType();let b=e.call(this,o,u);return m===this.measureTypeToGeometryType(n)&&(i.showSegmentLength&&(b=this.addSegmentLabelsToStyle(o,b)),i.showTotalLength&&(b=this.addTotalLengthLabelToStyle(o,b)),m!==$t.LINE_STRING&&m!==$t.POINT&&i.showArea&&(b=this.addAreaLabelToStyle(o,b))),b}}extendStyleFunctionWithLabelsFinish(e,n){return(i,o)=>{const u=i.getGeometry().getType();let m=e.call(this,i,o);return u!==$t.POINT&&(n.showSegmentLength&&(m=this.addSegmentLabelsToStyle(i,m)),n.showTotalLength&&(m=this.addTotalLengthLabelToStyle(i,m)),u!==$t.LINE_STRING&&n.showArea&&(m=this.addAreaLabelToStyle(i,m))),m}}addAreaLabelToStyle(e,n){return Array.isArray(n)?n.concat(YR(e)):n instanceof dl?[n,YR(e)]:n}addTotalLengthLabelToStyle(e,n){return Array.isArray(n)?n.concat(XR(e)):n instanceof dl?[n,XR(e)]:n}addSegmentLabelsToStyle(e,n){return Array.isArray(n)?n=n.concat(KR(e)):n instanceof dl&&(n=[n,...KR(e)]),n}measureTypeToGeometryType(e){switch(e){case zu.RECTANGLE:case zu.POLYGON:return $t.POLYGON;case zu.CIRCLE:return $t.CIRCLE;case zu.LINESTRING:return $t.LINE_STRING;case zu.POINT:return $t.POINT}}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=Hr({factory:function(){return new r},token:r,providedIn:"root"}),r})(),D1=(()=>{class r{constructor(e,n){this.coreMapService=e,this.measureDrawStyleService=n,this.drawInteractions=new Map,this.modifyInteractions=new Map,this.snapInteractions=new Map,this.drawInteractionLayers=new Map,this.measureInteractionLayers=new Map,this.drawEventsMap=new D_(()=>new Er),this.modifyEventsMap=new D_(()=>new Er),this.drawEndListenerMap=new Map,this.modifyEndListenerMap=new Map,this.drawStyleMap=new Map,this.measureStyleMap=new Map,this.stopMeasuringMap=new D_(()=>new Er)}startDrawInteraction(e,n,i,o={}){this.stopDrawInteraction(i),this.emitStopMeasureEventForMap(i,new UR(k_.STOP_MEASURING)),this.makeLayerVisibleIfInvisible(i,n),this.drawEventsMap.getOrCreateObservable(i);const u=this.decideAndGetStyles(n,i,e,o),m={};o.maxPoints&&(m.maxPoints=o.maxPoints),this.createInteractionLayer(i,n,u),this.createDrawInteraction(e,i,n,u,m);const b=this.getDrawInteraction(i);if(b){b.on("drawstart",F=>{this.drawEventsMap.getOrCreateSubject(i).next(new jR(cx.DRAWSTART,e,i,"message",F))});const T=b.on("drawend",F=>{u&&F.feature.setStyle(u.finishDrawStyle),this.drawEventsMap.getOrCreateSubject(i).next(new jR(cx.DRAWEND,e,i,"message",F))});this.drawEndListenerMap.set(i,T)}n===Tp.DRAW&&this.startSnapInteractionAgainIfExists(i)}getDrawObservableForMap(e){return this.drawEventsMap.getOrCreateObservable(e)}getModifyObservableForMap(e){return this.modifyEventsMap.getOrCreateObservable(e)}toggleLayer(e,n){const i=this.getDrawOrMeasureLayer(n,e);i&&(this.stopDrawInteraction(e),i.isVisible=!i.isVisible,i.vectorLayer.setMap(i.isVisible?this.coreMapService.getMap(e):null))}getDrawOrMeasureLayer(e,n){return e===Tp.DRAW?this.drawInteractionLayers.get(n):e===Tp.MEASURE?this.measureInteractionLayers.get(n):void 0}setStyleFunctions(e,n){this.drawStyleMap.set(n,e)}setMeasureStyleFunctions(e,n){this.measureStyleMap.set(n,e)}getOrCreateDrawInteractionLayer(e){if(this.drawInteractionLayers.has(e))return this.makeLayerVisibleIfInvisible(e,Tp.DRAW),this.getDrawInteractionLayer(e);const n=this.drawStyleMap.get(e);return this.createInteractionLayer(e,Tp.DRAW,n),this.getDrawInteractionLayer(e)}startModifyInteraction(e,n=Tk,i=Tk){this.stopModifyInteraction(e);const o=this.getVectorSourceFromInteractionLayer(e),u=new WG({source:o,deleteCondition:n,insertVertexCondition:i});this.coreMapService.getMap(e).addInteraction(u),this.modifyInteractions.set(e,u);const m=this.modifyEventsMap.getOrCreateSubject(e),b=u.on("modifyend",T=>{m.next(new U9({type:tC.MODIFYEND,mapName:e,message:"bewerken tekenlaag",event:T}))});this.modifyEndListenerMap.set(e,b),this.startSnapInteractionAgainIfExists(e)}stopModifyInteraction(e){const n=this.modifyInteractions.get(e);n&&(n1(this.modifyEndListenerMap.get(e)),this.modifyEndListenerMap.delete(e),this.coreMapService.getMap(e).removeInteraction(n),this.modifyInteractions.delete(e))}startSnapInteraction(e){this.stopSnapInteraction(e);const n=this.getVectorSourceFromInteractionLayer(e),i=new YG({source:n});this.snapInteractions.set(e,i),this.coreMapService.getMap(e).addInteraction(i)}stopSnapInteraction(e){const n=this.snapInteractions.get(e);n&&(this.coreMapService.getMap(e).removeInteraction(n),this.snapInteractions.delete(e))}startSnapInteractionAgainIfExists(e){this.snapInteractions.get(e)&&this.startSnapInteraction(e)}decideAndGetStyles(e,n,i,o){return e===Tp.DRAW?this.drawStyleMap.get(n):this.measureDrawStyleService.getMeasureStyle(i,o,this.measureStyleMap.get(n))}makeLayerVisibleIfInvisible(e,n){const i=this.getDrawOrMeasureLayer(n,e);i&&!i.isVisible&&this.toggleLayer(e,n)}stopDrawInteraction(e){this.getDrawInteraction(e)&&(n1(this.drawEndListenerMap.get(e)),this.drawEndListenerMap.delete(e),this.deleteDrawInteraction(e))}getDrawInteractionLayer(e){return this.drawInteractionLayers.get(e)}getMeasureInteractionLayer(e){return this.measureInteractionLayers.get(e)}clearMeasureInteractionLayer(e=Ti){if(this.coreMapService.checkMapIndex(e)){const n=this.getMeasureInteractionLayer(e);return void 0!==n&&n.vectorLayer.getSource().clear(),this.coreMapService.decideMapComponentEventType(!0,e)}return this.coreMapService.decideMapComponentEventType(!1,e)}getDrawInteraction(e){return this.drawInteractions.get(e)}getStopMeasureEventObservableForMap(e){return this.stopMeasuringMap.getOrCreateObservable(e)}emitStopMeasureEventForMap(e,n){this.stopMeasuringMap.getOrCreateSubject(e).next(n)}deleteDrawInteraction(e){const n=this.coreMapService.getMap(e);this.drawInteractions.has(e)&&n.removeInteraction(this.getDrawInteraction(e)),this.drawInteractions.delete(e)}deleteDrawInteractionLayer(e){this.drawInteractionLayers.has(e)&&this.drawInteractionLayers.get(e).vectorLayer.setMap(null),this.drawInteractionLayers.delete(e)}deleteMeasureInteractionLayer(e){this.measureInteractionLayers.delete(e)}destroyDrawInteraction(e){this.drawInteractions.delete(e),this.drawInteractionLayers.delete(e)}destroyStopMeasureForMap(e){this.emitStopMeasureEventForMap(e,new UR(k_.DELETE_MEASURESUBSCRIPTIONS)),this.stopMeasuringMap.delete(e)}createInteractionLayer(e,n,i){if(n===Tp.DRAW){if(!this.drawInteractionLayers.has(e)){const o=this.createGgcVectorLayer(e,i);this.drawInteractionLayers.set(e,o)}}else if(!this.measureInteractionLayers.has(e)){const o=this.createGgcVectorLayer(e,i);this.measureInteractionLayers.set(e,o)}}createGgcVectorLayer(e,n){const i=new I_({source:new __,style:n?n.finishDrawStyle:void 0}),o=this.coreMapService.getMap(e);return i.setMap(o),{vectorLayer:i,isVisible:!0}}createDrawInteraction(e,n,i,o,u){if(!this.drawInteractions.has(n)){let m;switch(e){case zu.RECTANGLE:m=this.createDrawObject($t.CIRCLE,n,i,o,u,function(r,t,e){var n=Hc([r[0],r[r.length-1]].map(function(m){return hl(m)})),i=[[q0(n),i1(n),o1(n),lg(n),q0(n)]],o=t;o?o.setCoordinates(i):o=new Tm(i);var u=Pf();return u&&o.transform(e,u),o});break;case zu.POLYGON:m=this.createDrawObject($t.POLYGON,n,i,o,u);break;case zu.LINESTRING:m=this.createDrawObject($t.LINE_STRING,n,i,o,u);break;case zu.POINT:m=this.createDrawObject($t.POINT,n,i,o,u);break;case zu.CIRCLE:m=this.createDrawObject($t.CIRCLE,n,i,o,u)}this.coreMapService.getMap(n).addInteraction(m),this.drawInteractions.set(n,m)}}createDrawObject(e,n,i,o,u,m){var b;const T=null===(b=this.getDrawOrMeasureLayer(i,n))||void 0===b?void 0:b.vectorLayer.getSource(),F=Object.assign(Object.assign({},u),{source:T,type:e,stopClick:!0,geometryFunction:m});return o&&(F.style=o.drawingDrawStyle),new Y7(F)}getVectorSourceFromInteractionLayer(e){this.createInteractionLayer(e,Tp.DRAW,this.drawStyleMap.get(e));const i=this.getDrawInteractionLayer(e).vectorLayer.getSource();return this.makeLayerVisibleIfInvisible(e,Tp.DRAW),i}}return r.\u0275fac=function(e){return new(e||r)(Xn(Sp),Xn(iO))},r.\u0275prov=Hr({factory:function(){return new r(Xn(Sp),Xn(iO))},token:r,providedIn:"root"}),r})(),W9=(()=>{class r{constructor(e,n,i,o,u){this.coreMapService=e,this.mapEventsService=n,this.coreLoadingService=i,this.coreSelectionService=o,this.coreDrawInteractionService=u,this.mapName=Ti,this.mapTabIndex=void 0,this.events=new Nn,this.eventsMap=[],this._minZoomlevel=0,this._maxZoomlevel=14,this.OL_MOVEEND="moveend",this.OL_SINGLECLICK="singleclick",this.OL_CHANGE_RESOLUTION="change:resolution",this.OL_PRECOMPOSE="precompose",this.OL_RENDERCOMPLETE="rendercomplete"}set maxZoomlevel(e){this._maxZoomlevel=Math.max(1,Math.min(ux.MAX_ZOOMLEVEL,e))}get maxZoomlevel(){return this._maxZoomlevel}set minZoomlevel(e){this._minZoomlevel=Math.max(0,Math.min(ux.MAX_ZOOMLEVEL,e))}get minZoomlevel(){return this._minZoomlevel}ngAfterViewInit(){if(this._minZoomlevel>this._maxZoomlevel)this.events.emit(new Ec({type:mu.UNSUCCESSFUL,mapName:this.mapName,message:"Kaart kon niet worden geladen omdat de waarde van minZoomLevel ("+this._minZoomlevel+") hoger is dan die van maxZoomLevel ("+this._maxZoomlevel+")."}));else{const e=this.coreMapService.createAndGetMap(this.mapName,this._minZoomlevel,this._maxZoomlevel);e.setTarget(this.mapElement.nativeElement.id),this.eventsMap.push(e.on(this.OL_PRECOMPOSE,this.processEvent.bind(this))),this.eventsMap.push(e.on(this.OL_RENDERCOMPLETE,this.processEvent.bind(this))),this.eventsMap.push(e.on(this.OL_SINGLECLICK,this.processEvent.bind(this))),this.eventsMap.push(e.on(this.OL_MOVEEND,this.processEvent.bind(this)));const n=e.getView();this.eventsMap.push(n.on(this.OL_CHANGE_RESOLUTION,this.processEvent.bind(this))),n.setZoom(3),this.initializeLoader(),this.events.emit(new Ec({type:mu.MAPINITIALIZED,mapName:this.mapName,message:"Het ggc-map component is geinitialiseerd."}))}}processEvent(e){switch(e.type){case this.OL_CHANGE_RESOLUTION:this.lastChangeResolutionEvent=e;break;case this.OL_MOVEEND:const n=this.getLocationFromMapEvent(e);this.events.emit(new Ec({type:mu.ZOOMENDLOCATION,mapName:this.mapName,message:"Het zoomen is beeindigd, dit event bevat X en Y en zoomlevel.",value:n})),this.lastChangeResolutionEvent&&(this.events.emit(new Ec({type:mu.ZOOMEND,mapName:this.mapName,message:"Het zoomen is beeindigd, dit is het laatste ol.MapEvent.",value:e})),this.lastChangeResolutionEvent=void 0,this.mapEventsService.emitZoomendEventForMap(e,this.mapName));break;case this.OL_SINGLECLICK:this.events.emit(new Ec({type:mu.SINGLECLICK,mapName:this.mapName,message:"Er is een singleClick gegenereerd.",value:e})),this.coreSelectionService.handleSingleclickEventForMap(e.coordinate,this.mapName),this.mapEventsService.emitSingleclickEventForMap(e,this.mapName)}}getLocationFromMapEvent(e){const n=e.map.getView().getZoom(),i=e.map.getView().getCenter();return new O9(i,n)}ngOnDestroy(){for(;this.eventsMap.length>0;)n1(this.eventsMap.pop());this.isLoading$&&this.isLoading$.unsubscribe(),this.coreMapService.destroyMap(this.mapName),this.coreLoadingService.destroyLoadersForMap(this.mapName),this.coreDrawInteractionService&&(this.coreDrawInteractionService.destroyDrawInteraction(this.mapName),this.coreDrawInteractionService.destroyStopMeasureForMap(this.mapName)),this.coreSelectionService.destroySelectionForMap(this.mapName),this.mapEventsService.destroyEventsForMap(this.mapName)}initializeLoader(){this.isLoading$=this.coreLoadingService.isLoading(this.mapName).subscribe(e=>{this.events.emit(new Ec({message:e?"De kaart is aan het laden":"De kaart is klaar met laden",value:e,type:mu.LOADING,mapName:this.mapName}))})}}return r.\u0275fac=function(e){return new(e||r)(qn(Sp),qn(A1),qn(Jw),qn(OR),qn(D1,8))},r.\u0275cmp=eo({type:r,selectors:[["ggc-map"]],viewQuery:function(e,n){if(1&e&&mm(C9,7),2&e){let i;md(i=gd())&&(n.mapElement=i.first)}},inputs:{mapName:"mapName",mapTabIndex:"mapTabIndex",maxZoomlevel:"maxZoomlevel",minZoomlevel:"minZoomlevel"},outputs:{events:"events"},decls:2,vars:2,consts:[[1,"ggc-ol-map",3,"id"],["mapElement",""]],template:function(e,n){1&e&&Hi(0,"div",0,1),2&e&&(kn("id",n.mapName),Yg("tabindex",n.mapTabIndex))},styles:[".ggc-ol-map[_ngcontent-%COMP%]{height:100%;width:100%}  .ol-attribution li{font-size:1.1rem;line-height:1.375rem}"]}),r})(),iC=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=Gi({type:r}),r.\u0275inj=io({}),r})(),VT=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=Gi({type:r}),r.\u0275inj=io({}),r})(),GT=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=Gi({type:r}),r.\u0275inj=io({imports:[[Df]]}),r})(),qT=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=Gi({type:r}),r.\u0275inj=io({}),r})(),oO=(()=>{class r{constructor(e,n=[[]]){this.coreMapService=e,n&&this.coreMapService.setExtraLayers(n.flat()),this.format=new DR}getMap(e){return this.coreMapService.getMap(e)}getLayer(e,n=Ti){return this.coreMapService.getLayer(e,n)}getExtraLayer(e,n=Ti){return this.coreMapService.getExtraLayer(e,n)}zoomToCoordinate(e,n=Ti,i){return this.coreMapService.checkMapIndex(n)?(this.coreMapService.getMap(n).getView().fit([...e,...e],{maxZoom:i}),this.coreMapService.decideMapComponentEventType(!0,n)):this.coreMapService.decideMapComponentEventType(!1,n)}zoomToGeometry(e,n=Ti,i){if(this.coreMapService.checkMapIndex(n)){const u=this.format.readGeometry(e).getExtent();return this.coreMapService.getMap(n).getView().fit(u,{maxZoom:i}),this.coreMapService.decideMapComponentEventType(!0,n)}return this.coreMapService.decideMapComponentEventType(!1,n)}zoomToPdokResult(e,n,i){if(this.coreMapService.checkMapIndex(n)){const o=this.getCoordinatesFromEvent(e);return o?this.zoomToGeometry(o,n,i):new Ec({type:mu.UNSUCCESSFUL,mapName:n||Ti,message:"Coordinaat voor zoomToPdokResult op de kaart kon niet worden bepaald"})}return this.coreMapService.decideMapComponentEventType(!1,n)}zoomToPdokResultAndSimulateClick(e,n,i){if(this.coreMapService.checkMapIndex(n)){this.zoomToPdokResult(e,n,i);const o=this.getCentroidRdFromPdokResult(e);if(o){const u=this.coreMapService.getMap(n),m={type:"singleclick",map:this.getMap(n),coordinate:o,pixel:u.getPixelFromCoordinate(o)};return u.dispatchEvent(m),this.coreMapService.decideMapComponentEventType(!0,n)}return new Ec({type:mu.UNSUCCESSFUL,mapName:n||Ti,message:"Coordinaat voor simuleren klik op de kaart kon niet worden bepaald"})}return this.coreMapService.decideMapComponentEventType(!1,n)}zoomToPdokResultAndMark(e,n,i){if(this.coreMapService.checkMapIndex(n)){this.zoomToPdokResult(e,n,i);const o=this.getCoordinatesFromEvent(e);if(o){const u=this.format.readFeatures(o);return this.clearHighlightLayer(n),this.addFeaturesToHighlightLayer(u,n),this.coreMapService.decideMapComponentEventType(!0,n)}return new Ec({type:mu.UNSUCCESSFUL,mapName:n||Ti,message:"Coordinaat voor zoomToPdokResultAndMark op de kaart kon niet worden bepaald"})}return this.coreMapService.decideMapComponentEventType(!1,n)}getCentroidRdFromPdokResult(e){let n;const i=this.getSearchResultDocFromEvent(e);if(i){const o=i.centroide_rd;o&&(n=this.format.readGeometry(o).getCoordinates())}return n}getGeometryFromPdokResult(e){let n;const i=this.getSearchResultDocFromEvent(e);if(i){const o=i.geometrie_rd;o&&(n=this.format.readGeometry(o).getSimplifiedGeometry(0))}return n}addFeaturesToHighlightLayer(e,n=Ti){return this.coreMapService.addFeaturesToHighlightLayer(e,n)}clearHighlightLayer(e=Ti){return this.coreMapService.clearHighlightLayer(e)}changeHighlightLayerStyle(e,n=Ti){this.coreMapService.changeHighlightLayerStyle(e,n)}addFeaturesToSelectionLayer(e,n=Ti){return this.coreMapService.addFeaturesToSelectionLayer(e,n)}clearSelectionLayer(e=Ti){return this.coreMapService.clearSelectionLayer(e)}changeSelectionLayerStyle(e,n=Ti){this.coreMapService.changeSelectionLayerStyle(e,n)}getGeometrieOrCentroide(e){return e.geometrie_rd?e.geometrie_rd:e.centroide_rd?e.centroide_rd:void 0}getSearchResultDocFromEvent(e){let n;return e.value&&e.value.docs&&e.value.docs.length>0&&(n=e.value.docs[0]),n}getCoordinatesFromEvent(e){let n;const i=this.getSearchResultDocFromEvent(e);if(i){const o=this.getGeometrieOrCentroide(i);o&&(n=o)}return n}}return r.\u0275fac=function(e){return new(e||r)(Xn(Sp),Xn(kR,8))},r.\u0275prov=Hr({factory:function(){return new r(Xn(Sp),Xn(kR,8))},token:r,providedIn:"root"}),r})(),ZT=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=Gi({type:r}),r.\u0275inj=io({imports:[[Df]]}),r})(),HT=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=Gi({type:r}),r.\u0275inj=io({imports:[[Df]]}),r})();const eH=[iC,VT,eC,zT,qT,GT,NT,HT,ZT];let tH=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=Gi({type:r}),r.\u0275inj=io({imports:[[eH],iC,VT,eC,zT,qT,GT,NT,HT,ZT]}),r})();const{isArray:nH}=Array,{getPrototypeOf:rH,prototype:iH,keys:oH}=Object;function aO(r){if(1===r.length){const t=r[0];if(nH(t))return{args:t,keys:null};if(function(r){return r&&"object"==typeof r&&rH(r)===iH}(t)){const e=oH(t);return{args:e.map(n=>t[n]),keys:e}}}return{args:r,keys:null}}const{isArray:sH}=Array;function sO(r){return Zr(t=>function(r,t){return sH(t)?r(...t):r(t)}(r,t))}function lO(r,t){return r.reduce((e,n,i)=>(e[n]=t[i],e),{})}class cH extends ut{constructor(t,e){super()}schedule(t,e=0){return this}}const aC={setInterval(...r){const{delegate:t}=aC;return((null==t?void 0:t.setInterval)||setInterval)(...r)},clearInterval(r){const{delegate:t}=aC;return((null==t?void 0:t.clearInterval)||clearInterval)(r)},delegate:void 0};class k1{constructor(t,e=k1.now){this.schedulerActionCtor=t,this.now=e}schedule(t,e=0,n){return new this.schedulerActionCtor(this,t).schedule(n,e)}}k1.now=yS.now;const WT=new class extends k1{constructor(t,e=k1.now){super(t,e),this.actions=[],this._active=!1,this._scheduled=void 0}flush(t){const{actions:e}=this;if(this._active)return void e.push(t);let n;this._active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}}(class extends cH{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const n=this.id,i=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(i,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(i,this.id,e),this}requestAsyncId(t,e,n=0){return aC.setInterval(t.flush.bind(t,this),n)}recycleAsyncId(t,e,n=0){if(null!=n&&this.delay===n&&!1===this.pending)return e;aC.clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let i,n=!1;try{this.work(t)}catch(o){n=!0,i=o||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),i}unsubscribe(){if(!this.closed){const{id:t,scheduler:e}=this,{actions:n}=e;this.work=this.state=this.scheduler=null,this.pending=!1,C(n,this),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null,super.unsubscribe()}}}),dH=WT;function lv(r,t){return Xi((e,n)=>{let i=null,o=0,u=!1;const m=()=>u&&!i&&n.complete();e.subscribe(new Vi(n,b=>{null==i||i.unsubscribe();let T=0;const F=o++;Da(r(b,F)).subscribe(i=new Vi(n,V=>n.next(t?t(b,V,F,T++):V),()=>{i=null,m()}))},()=>{u=!0,m()}))})}function uO(r){return Xi((t,e)=>{let n,o,i=!1;const u=()=>{n=t.subscribe(new Vi(e,void 0,void 0,m=>{o||(o=new Er,r(o).subscribe(new Vi(e,()=>n?u():i=!0))),o&&o.next(m)})),i&&(n.unsubscribe(),n=null,i=!1,u())};u()})}function sC(...r){return Se(1)(qt(r,Xt(r)))}function cO(r,t){return t?e=>sC(t.pipe(wn(1),Xi((r,t)=>{r.subscribe(new Vi(t,on))})),e.pipe(cO(r))):pe((e,n)=>r(e,n).pipe(wn(1),function(r){return Zr(()=>r)}(e)))}function hO(r,t=WT){const e=function(r=0,t,e=dH){let n=-1;return null!=t&&(lt(t)?e=t:n=t),new ct(i=>{let o=function(r){return r instanceof Date&&!isNaN(r)}(r)?+r-e.now():r;o<0&&(o=0);let u=0;return e.schedule(function(){i.closed||(i.next(u++),0<=n?this.schedule(void 0,n):i.complete())},o)})}(r,t);return cO(()=>e)}const xH=["searchInput"];function bH(r,t){if(1&r&&(It(0,"label"),jr(1),Mt()),2&r){const e=ir();Yg("id",e.elementIds.searchLabelId)("for",e.elementIds.searchInputId),rn(1),bp(e.labelText)}}function wH(r,t){if(1&r){const e=$l();It(0,"button",11),Qr("click",function(){return Rr(e),ir().clearSearchTerm()}),Hi(1,"span",7),Mt()}if(2&r){const e=ir();rn(1),kn("ngClass",e.classClearButton)}}function CH(r,t){if(1&r){const e=$l();It(0,"li",12),It(1,"button",13),Qr("click",function(){const o=Rr(e).$implicit;return ir().lookupPdok(o)}),jr(2),Mt(),Mt()}if(2&r){const e=t.$implicit;rn(2),bp(e.weergavenaam)}}function EH(r,t){1&r&&(It(0,"li",12),jr(1,"Geen resultaat gevonden"),Mt())}let P1=(()=>{class r{search(e){return wo([])}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})(),pO=(()=>{class r{constructor(e,n){this.httpClient=e,this.additionalSuggestionSourceService=n,this.debounceTime=400,this.baseUrl="https://geodata.nationaalgeoregister.nl/locatieserver/v3/suggest?",this.queryUrl="q=",this.queryRows="rows=",this.filterQueryKey="fq=",this.numberOfSuggestions=5,this.minQueryLength=1}search(e){return e.pipe(function(r,t=WT){return Xi((e,n)=>{let i=null,o=null,u=null;const m=()=>{if(i){i.unsubscribe(),i=null;const T=o;o=null,n.next(T)}};function b(){const T=u+r,F=t.now();if(F<T)return i=this.schedule(void 0,T-F),void n.add(i);m()}e.subscribe(new Vi(n,T=>{o=T,u=t.now(),i||(i=t.schedule(b,r),n.add(i))},()=>{m(),n.complete()},void 0,()=>{o=i=null}))})}(this.debounceTime),wk(),lv(n=>n.length>=this.minQueryLength?this.searchEntries(n):wo(null)))}searchEntries(e){const n=this.constructUrl(e);return function(...r){const t=xt(r),{args:e,keys:n}=aO(r),i=new ct(o=>{const{length:u}=e;if(!u)return void o.complete();const m=new Array(u);let b=u,T=u;for(let F=0;F<u;F++){let V=!1;Da(e[F]).subscribe(new Vi(o,H=>{V||(V=!0,T--),m[F]=H},()=>b--,void 0,()=>{(!b||!V)&&(T||o.next(n?lO(n,m):m),o.complete())}))}});return t?i.pipe(sO(t)):i}([this.additionalSuggestionSourceService.search(e),this.httpClient.get(n).pipe(Zr(i=>i.response),uO(i=>{let o=0;return i.pipe(hO(500),Zr(u=>{if(3==o++)throw u}))}))]).pipe(Zr(([i,o])=>(i.forEach(u=>u.source=u.source||"alt"),o.numFound+=i.length,o.docs.push(...i),o.docs.splice(this.numberOfSuggestions),o)))}constructUrl(e){const n=[];return n.push(this.queryUrl+encodeURIComponent(e),this.queryRows+this.numberOfSuggestions),this.filterQuery&&n.push(this.filterQueryKey+this.filterQuery),this.baseUrl+n.join("&")}}return r.\u0275fac=function(e){return new(e||r)(Xn(sx),Xn(P1))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})(),dO=(()=>{class r{constructor(e){this.httpClient=e,this.baseUrl="https://geodata.nationaalgeoregister.nl/locatieserver/v3/lookup",this.queryUrl="?fl=*&id="}search(e){return this.httpClient.get(this.baseUrl+this.queryUrl+e).pipe(Zr(n=>n.response),uO(n=>{let i=0;return n.pipe(hO(500),Zr(o=>{if(3==i++)throw o}))}))}}return r.\u0275fac=function(e){return new(e||r)(Xn(sx))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();var vg=(()=>(function(r){r.RESULT_INVALIDATED="resultInvalidated",r.SEARCH_RESULT="searchResult",r.SEARCH_RESULT_ERROR="searchResultError",r.SEARCH_SUGGESTION_ERROR="searchSuggestionError"}(vg||(vg={})),vg))();class R1{constructor(t,e,n){this.type=t,this.message=e,this.value=n}}class SH{constructor(t){this.searchInputId=t.searchInputId||"ggcSearchInput",this.searchButtonId=t.searchButtonId||"ggcSearchButton",this.suggestionListId=t.suggestionListId||"ggcSuggestionList",this.searchLabelId=t.searchLabelId||"ggcSearchLabel"}}let TH=(()=>{class r{constructor(e,n){this.searchSuggestionsService=e,this.searchLocationService=n,this.suggestions=[],this.showSuggestions=!1,this.noSuggestionsFound=!1,this.hasInitialSearchterm=!1,this.searchTerm$=new Er,this.minQueryLength=1,this.elementIds=new SH({}),this.classSearchButton="fal fa-search",this.classClearButton="fal fa-times",this.placeholderTextAndAriaLabel="Voer locatie in",this.events=new Nn}resetSuggestionsAndResult(){this.result&&this.events.emit(new R1(vg.RESULT_INVALIDATED,"Het vorige zoekresultaat is niet meer geldig")),this.suggestions.length=0,this.noSuggestionsFound=!1,this.result=void 0,this.weergavenaamCache=void 0,this.showSuggestions=!1}clearSearchTerm(){this.searchInput.nativeElement.value="",this.searchTerm$.next(this.searchInput.nativeElement.value),this.resetSuggestionsAndResult()}searchForSuggestions(e){e!==this.weergavenaamCache&&this.searchTerm$.next(e)}searchOnEnter(){this.result?this.events.emit(new R1(vg.SEARCH_RESULT,"Er is een nieuw zoekresultaat",this.result)):this.suggestions.length>0&&this.lookupFirstSuggestion()}lookupFirstSuggestion(){this.lookupPdok(this.suggestions[0])}lookupPdok(e){this.suggestions.length=0,this.searchInput.nativeElement.value=e.weergavenaam,this.weergavenaamCache=e.weergavenaam,void 0===e.source?this.searchLocationService.search(e.id).subscribe(n=>this.processResultLocation(n),n=>{this.processError(n,vg.SEARCH_RESULT_ERROR)}):this.processResultLocation({docs:[e],numFound:1,maxScore:1,start:1})}processResultLocation(e){this.result=e,this.events.emit(new R1(vg.SEARCH_RESULT,"Er is een nieuw zoekresultaat",this.result)),this.showSuggestions=!1}processError(e,n){let i;i=e.error instanceof ErrorEvent?e.message?e.message:e.toString():`${e.status} - ${e.statusText||""} - ${e.message}`,this.events.emit(new R1(n,"Er is een fout opgetreden bij het benaderen van de locatieserver: "+i+". Herlaad de pagina om het opnieuw te proberen.",e))}processSuggestionsResult(e){this.resetSuggestionsAndResult(),e&&e.numFound>-1&&(this.showSuggestions=!0,this.suggestions=e.docs,e.numFound>0?(this.noSuggestionsFound=!1,this.checkAndSearchInitialSearchterm()):this.noSuggestionsFound=!0,this.clearHasInitialSearchterm())}checkAndSearchInitialSearchterm(){this.hasInitialSearchterm&&1===this.suggestions.length&&this.lookupFirstSuggestion()}clearHasInitialSearchterm(){this.hasInitialSearchterm&&(this.hasInitialSearchterm=!1)}ngOnInit(){if(this.numberOfSuggestions&&(this.searchSuggestionsService.numberOfSuggestions=this.numberOfSuggestions),this.filterQuery&&(this.searchSuggestionsService.filterQuery=this.filterQuery),this.minQueryLength>0&&(this.searchSuggestionsService.minQueryLength=this.minQueryLength),this.searchSuggestionsService.search(this.searchTerm$).subscribe(e=>{this.processSuggestionsResult(e)},e=>{this.processError(e,vg.SEARCH_SUGGESTION_ERROR)}),this.initialSearchterm){const e=this.initialSearchterm.trim();e&&(this.hasInitialSearchterm=!0,this.searchInput.nativeElement.value=e,this.searchTerm$.next(e))}}}return r.\u0275fac=function(e){return new(e||r)(qn(pO),qn(dO))},r.\u0275cmp=eo({type:r,selectors:[["ggc-search"]],viewQuery:function(e,n){if(1&e&&mm(xH,7),2&e){let i;md(i=gd())&&(n.searchInput=i.first)}},inputs:{minQueryLength:"minQueryLength",elementIds:"elementIds",classSearchButton:"classSearchButton",classClearButton:"classClearButton",placeholderTextAndAriaLabel:"placeholderTextAndAriaLabel",numberOfSuggestions:"numberOfSuggestions",filterQuery:"filterQuery",initialSearchterm:"initialSearchterm",labelText:"labelText"},outputs:{events:"events"},features:[WC([pO,dO])],decls:11,vars:15,consts:[[4,"ngIf"],["role","combobox","aria-haspopup","listbox",1,"input-group"],["autocomplete","off",1,"form-control",3,"placeholder","keyup","keyup.enter"],["searchInput",""],[1,"input-group-btn"],["aria-label","Zoekterm wissen","id","clear","class","btn btn-default",3,"click",4,"ngIf"],["aria-label","Zoeken",1,"btn","btn-primary",3,"click"],["aria-hidden","true",3,"ngClass"],["role","listbox",1,"list-group",3,"hidden"],["class","list-group-item",4,"ngFor","ngForOf"],["class","list-group-item",4,"ngIf"],["aria-label","Zoekterm wissen","id","clear",1,"btn","btn-default",3,"click"],[1,"list-group-item"],["type","button",1,"btn","btn-link",3,"click"]],template:function(e,n){if(1&e&&(Ii(0,bH,2,3,"label",0),It(1,"div",1),It(2,"input",2,3),Qr("keyup",function(o){return n.searchForSuggestions(o.target.value)})("keyup.enter",function(){return n.searchOnEnter()}),Mt(),It(4,"div",4),Ii(5,wH,2,1,"button",5),It(6,"button",6),Qr("click",function(){return n.searchOnEnter()}),Hi(7,"span",7),Mt(),Mt(),Mt(),It(8,"ul",8),Ii(9,CH,3,1,"li",9),Ii(10,EH,2,0,"li",10),Mt()),2&e){const i=function(r){return ds(Lr.lFrame.contextLView,20+r)}(3);kn("ngIf",n.labelText),rn(1),Yg("aria-owns",n.elementIds.suggestionListId)("aria-expanded",n.showSuggestions),rn(1),$v("placeholder",n.placeholderTextAndAriaLabel),Yg("id",n.elementIds.searchInputId)("aria-label",n.labelText?null:n.placeholderTextAndAriaLabel)("aria-controls",n.elementIds.suggestionListId),rn(3),kn("ngIf",i.value.length>0),rn(1),Yg("id",n.elementIds.searchButtonId),rn(1),kn("ngClass",n.classSearchButton),rn(1),kn("hidden",!n.showSuggestions),Yg("id",n.elementIds.suggestionListId)("aria-labelledby",n.elementIds.searchLabelId),rn(1),kn("ngForOf",n.suggestions),rn(1),kn("ngIf",n.noSuggestionsFound)}},directives:[Vy,Kx,B0],encapsulation:2}),r})(),IH=(()=>{class r{static forRoot(e={}){return{ngModule:r,providers:[(null==e?void 0:e.suggestSources)||{provide:P1,useClass:P1}]}}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=Gi({type:r}),r.\u0275inj=io({providers:[{provide:P1,useClass:P1}],imports:[[Df,dR]]}),r})();function fO(r,t,e){r?me(e,r,t):t()}function mO(r){return new ct(t=>{Da(r()).subscribe(t)})}function gO(){return Xi((r,t)=>{let e=null;r._refCount++;const n=new Vi(t,void 0,void 0,void 0,()=>{if(!r||r._refCount<=0||0<--r._refCount)return void(e=null);const i=r._connection,o=e;e=null,i&&(!o||i===o)&&i.unsubscribe(),t.unsubscribe()});r.subscribe(n),n.closed||(e=r.connect())})}class DH extends ct{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,Wo(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,null==t||t.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new ut;const e=this.getSubject();t.add(this.source.subscribe(new Vi(e,void 0,()=>{this._teardown(),e.complete()},n=>{this._teardown(),e.error(n)},()=>this._teardown()))),t.closed&&(this._connection=null,t=ut.EMPTY)}return t}refCount(){return gO()(this)}}function PH(r,t,e,n,i){return(o,u)=>{let m=e,b=t,T=0;o.subscribe(new Vi(u,F=>{const V=T++;b=m?r(b,F,V):(m=!0,F),n&&u.next(b)},i&&(()=>{m&&u.next(b),u.complete()})))}}function yO(r,t){return Xi(PH(r,t,arguments.length>=2,!0))}function uv(r){return Xi((t,e)=>{let o,n=null,i=!1;n=t.subscribe(new Vi(e,void 0,void 0,u=>{o=Da(r(u,uv(r)(t))),n?(n.unsubscribe(),n=null,o.subscribe(e)):i=!0})),i&&(n.unsubscribe(),n=null,o.subscribe(e))})}function $T(r){return r<=0?()=>He:Xi((t,e)=>{let n=[];t.subscribe(new Vi(e,i=>{n.push(i),r<n.length&&n.shift()},()=>{for(const i of n)e.next(i);e.complete()},void 0,()=>{n=null}))})}function rf(r,t,e){const n=Ut(r)||t||e?{next:r,error:t,complete:e}:r;return n?Xi((i,o)=>{var u;null===(u=n.subscribe)||void 0===u||u.call(n);let m=!0;i.subscribe(new Vi(o,b=>{var T;null===(T=n.next)||void 0===T||T.call(n,b),o.next(b)},()=>{var b;m=!1,null===(b=n.complete)||void 0===b||b.call(n),o.complete()},b=>{var T;m=!1,null===(T=n.error)||void 0===T||T.call(n,b),o.error(b)},()=>{var b,T;m&&(null===(b=n.unsubscribe)||void 0===b||b.call(n)),null===(T=n.finalize)||void 0===T||T.call(n)}))}):qr}class cy{constructor(t,e){this.id=t,this.url=e}}class XT extends cy{constructor(t,e,n="imperative",i=null){super(t,e),this.navigationTrigger=n,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class O1 extends cy{constructor(t,e,n){super(t,e),this.urlAfterRedirects=n}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class vO extends cy{constructor(t,e,n){super(t,e),this.reason=n}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class LH extends cy{constructor(t,e,n){super(t,e),this.error=n}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class FH extends cy{constructor(t,e,n,i){super(t,e),this.urlAfterRedirects=n,this.state=i}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class zH extends cy{constructor(t,e,n,i){super(t,e),this.urlAfterRedirects=n,this.state=i}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class NH extends cy{constructor(t,e,n,i,o){super(t,e),this.urlAfterRedirects=n,this.state=i,this.shouldActivate=o}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class BH extends cy{constructor(t,e,n,i){super(t,e),this.urlAfterRedirects=n,this.state=i}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class jH extends cy{constructor(t,e,n,i){super(t,e),this.urlAfterRedirects=n,this.state=i}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _O{constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class xO{constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class UH{constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class VH{constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class GH{constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class qH{constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class bO{constructor(t,e,n){this.routerEvent=t,this.position=e,this.anchor=n}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const sa="primary";class ZH{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function dx(r){return new ZH(r)}const wO="ngNavigationCancelingError";function YT(r){const t=Error("NavigationCancelingError: "+r);return t[wO]=!0,t}function WH(r,t,e){const n=e.path.split("/");if(n.length>r.length||"full"===e.pathMatch&&(t.hasChildren()||n.length<r.length))return null;const i={};for(let o=0;o<n.length;o++){const u=n[o],m=r[o];if(u.startsWith(":"))i[u.substring(1)]=m;else if(u!==m.path)return null}return{consumed:r.slice(0,n.length),posParams:i}}function _g(r,t){const e=r?Object.keys(r):void 0,n=t?Object.keys(t):void 0;if(!e||!n||e.length!=n.length)return!1;let i;for(let o=0;o<e.length;o++)if(i=e[o],!CO(r[i],t[i]))return!1;return!0}function CO(r,t){if(Array.isArray(r)&&Array.isArray(t)){if(r.length!==t.length)return!1;const e=[...r].sort(),n=[...t].sort();return e.every((i,o)=>n[o]===i)}return r===t}function EO(r){return Array.prototype.concat.apply([],r)}function SO(r){return r.length>0?r[r.length-1]:null}function sp(r,t){for(const e in r)r.hasOwnProperty(e)&&t(r[e],e)}function xg(r){return oI(r)?r:ub(r)?qt(Promise.resolve(r)):wo(r)}const YH={exact:function MO(r,t,e){if(!O_(r.segments,t.segments)||!lC(r.segments,t.segments,e)||r.numberOfChildren!==t.numberOfChildren)return!1;for(const n in t.children)if(!r.children[n]||!MO(r.children[n],t.children[n],e))return!1;return!0},subset:AO},TO={exact:function(r,t){return _g(r,t)},subset:function(r,t){return Object.keys(t).length<=Object.keys(r).length&&Object.keys(t).every(e=>CO(r[e],t[e]))},ignored:()=>!0};function IO(r,t,e){return YH[e.paths](r.root,t.root,e.matrixParams)&&TO[e.queryParams](r.queryParams,t.queryParams)&&!("exact"===e.fragment&&r.fragment!==t.fragment)}function AO(r,t,e){return DO(r,t,t.segments,e)}function DO(r,t,e,n){if(r.segments.length>e.length){const i=r.segments.slice(0,e.length);return!(!O_(i,e)||t.hasChildren()||!lC(i,e,n))}if(r.segments.length===e.length){if(!O_(r.segments,e)||!lC(r.segments,e,n))return!1;for(const i in t.children)if(!r.children[i]||!AO(r.children[i],t.children[i],n))return!1;return!0}{const i=e.slice(0,r.segments.length),o=e.slice(r.segments.length);return!!(O_(r.segments,i)&&lC(r.segments,i,n)&&r.children[sa])&&DO(r.children[sa],t,o,n)}}function lC(r,t,e){return t.every((n,i)=>TO[e](r[i].parameters,n.parameters))}class R_{constructor(t,e,n){this.root=t,this.queryParams=e,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=dx(this.queryParams)),this._queryParamMap}toString(){return tW.serialize(this)}}class ba{constructor(t,e){this.segments=t,this.children=e,this.parent=null,sp(e,(n,i)=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return uC(this)}}class L1{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=dx(this.parameters)),this._parameterMap}toString(){return LO(this)}}function O_(r,t){return r.length===t.length&&r.every((e,n)=>e.path===t[n].path)}class kO{}class PO{parse(t){const e=new cW(t);return new R_(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){const e=`/${F1(t.root,!0)}`,n=function(r){const t=Object.keys(r).map(e=>{const n=r[e];return Array.isArray(n)?n.map(i=>`${cC(e)}=${cC(i)}`).join("&"):`${cC(e)}=${cC(n)}`}).filter(e=>!!e);return t.length?`?${t.join("&")}`:""}(t.queryParams),i="string"==typeof t.fragment?`#${function(r){return encodeURI(r)}(t.fragment)}`:"";return`${e}${n}${i}`}}const tW=new PO;function uC(r){return r.segments.map(t=>LO(t)).join("/")}function F1(r,t){if(!r.hasChildren())return uC(r);if(t){const e=r.children[sa]?F1(r.children[sa],!1):"",n=[];return sp(r.children,(i,o)=>{o!==sa&&n.push(`${o}:${F1(i,!1)}`)}),n.length>0?`${e}(${n.join("//")})`:e}{const e=function(r,t){let e=[];return sp(r.children,(n,i)=>{i===sa&&(e=e.concat(t(n,i)))}),sp(r.children,(n,i)=>{i!==sa&&(e=e.concat(t(n,i)))}),e}(r,(n,i)=>i===sa?[F1(r.children[sa],!1)]:[`${i}:${F1(n,!1)}`]);return 1===Object.keys(r.children).length&&null!=r.children[sa]?`${uC(r)}/${e[0]}`:`${uC(r)}/(${e.join("//")})`}}function RO(r){return encodeURIComponent(r).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function cC(r){return RO(r).replace(/%3B/gi,";")}function KT(r){return RO(r).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function hC(r){return decodeURIComponent(r)}function OO(r){return hC(r.replace(/\+/g,"%20"))}function LO(r){return`${KT(r.path)}${function(r){return Object.keys(r).map(t=>`;${KT(t)}=${KT(r[t])}`).join("")}(r.parameters)}`}const oW=/^[^\/()?;=#]+/;function pC(r){const t=r.match(oW);return t?t[0]:""}const aW=/^[^=?&#]+/,lW=/^[^&#]+/;class cW{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new ba([],{}):new ba([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(n[sa]=new ba(t,e)),n}parseSegment(){const t=pC(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(t),new L1(hC(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=pC(this.remaining);if(!e)return;this.capture(e);let n="";if(this.consumeOptional("=")){const i=pC(this.remaining);i&&(n=i,this.capture(n))}t[hC(e)]=hC(n)}parseQueryParam(t){const e=function(r){const t=r.match(aW);return t?t[0]:""}(this.remaining);if(!e)return;this.capture(e);let n="";if(this.consumeOptional("=")){const u=function(r){const t=r.match(lW);return t?t[0]:""}(this.remaining);u&&(n=u,this.capture(n))}const i=OO(e),o=OO(n);if(t.hasOwnProperty(i)){let u=t[i];Array.isArray(u)||(u=[u],t[i]=u),u.push(o)}else t[i]=o}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=pC(this.remaining),i=this.remaining[n.length];if("/"!==i&&")"!==i&&";"!==i)throw new Error(`Cannot parse url '${this.url}'`);let o;n.indexOf(":")>-1?(o=n.substr(0,n.indexOf(":")),this.capture(o),this.capture(":")):t&&(o=sa);const u=this.parseChildren();e[o]=1===Object.keys(u).length?u[sa]:new ba([],u),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Error(`Expected "${t}".`)}}class FO{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=JT(t,this._root);return e?e.children.map(n=>n.value):[]}firstChild(t){const e=JT(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=QT(t,this._root);return e.length<2?[]:e[e.length-2].children.map(i=>i.value).filter(i=>i!==t)}pathFromRoot(t){return QT(t,this._root).map(e=>e.value)}}function JT(r,t){if(r===t.value)return t;for(const e of t.children){const n=JT(r,e);if(n)return n}return null}function QT(r,t){if(r===t.value)return[t];for(const e of t.children){const n=QT(r,e);if(n.length)return n.unshift(t),n}return[]}class hy{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function fx(r){const t={};return r&&r.children.forEach(e=>t[e.value.outlet]=e),t}class zO extends FO{constructor(t,e){super(t),this.snapshot=e,e2(this,t)}toString(){return this.snapshot.toString()}}function NO(r,t){const e=function(r,t){const u=new dC([],{},{},"",{},sa,t,null,r.root,-1,{});return new jO("",new hy(u,[]))}(r,t),n=new Jd([new L1("",{})]),i=new Jd({}),o=new Jd({}),u=new Jd({}),m=new Jd(""),b=new mx(n,i,u,m,o,sa,t,e.root);return b.snapshot=e.root,new zO(new hy(b,[]),e)}class mx{constructor(t,e,n,i,o,u,m,b){this.url=t,this.params=e,this.queryParams=n,this.fragment=i,this.data=o,this.outlet=u,this.component=m,this._futureSnapshot=b}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Zr(t=>dx(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Zr(t=>dx(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function BO(r,t="emptyOnly"){const e=r.pathFromRoot;let n=0;if("always"!==t)for(n=e.length-1;n>=1;){const i=e[n],o=e[n-1];if(i.routeConfig&&""===i.routeConfig.path)n--;else{if(o.component)break;n--}}return function(r){return r.reduce((t,e)=>({params:Object.assign(Object.assign({},t.params),e.params),data:Object.assign(Object.assign({},t.data),e.data),resolve:Object.assign(Object.assign({},t.resolve),e._resolvedData)}),{params:{},data:{},resolve:{}})}(e.slice(n))}class dC{constructor(t,e,n,i,o,u,m,b,T,F,V){this.url=t,this.params=e,this.queryParams=n,this.fragment=i,this.data=o,this.outlet=u,this.component=m,this.routeConfig=b,this._urlSegment=T,this._lastPathIndex=F,this._resolve=V}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=dx(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=dx(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(n=>n.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class jO extends FO{constructor(t,e){super(e),this.url=t,e2(this,e)}toString(){return UO(this._root)}}function e2(r,t){t.value._routerState=r,t.children.forEach(e=>e2(r,e))}function UO(r){const t=r.children.length>0?` { ${r.children.map(UO).join(", ")} } `:"";return`${r.value}${t}`}function t2(r){if(r.snapshot){const t=r.snapshot,e=r._futureSnapshot;r.snapshot=e,_g(t.queryParams,e.queryParams)||r.queryParams.next(e.queryParams),t.fragment!==e.fragment&&r.fragment.next(e.fragment),_g(t.params,e.params)||r.params.next(e.params),function(r,t){if(r.length!==t.length)return!1;for(let e=0;e<r.length;++e)if(!_g(r[e],t[e]))return!1;return!0}(t.url,e.url)||r.url.next(e.url),_g(t.data,e.data)||r.data.next(e.data)}else r.snapshot=r._futureSnapshot,r.data.next(r._futureSnapshot.data)}function n2(r,t){const e=_g(r.params,t.params)&&function(r,t){return O_(r,t)&&r.every((e,n)=>_g(e.parameters,t[n].parameters))}(r.url,t.url);return e&&!(!r.parent!=!t.parent)&&(!r.parent||n2(r.parent,t.parent))}function z1(r,t,e){if(e&&r.shouldReuseRoute(t.value,e.value.snapshot)){const n=e.value;n._futureSnapshot=t.value;const i=function(r,t,e){return t.children.map(n=>{for(const i of e.children)if(r.shouldReuseRoute(n.value,i.value.snapshot))return z1(r,n,i);return z1(r,n)})}(r,t,e);return new hy(n,i)}{if(r.shouldAttach(t.value)){const o=r.retrieve(t.value);if(null!==o){const u=o.route;return u.value._futureSnapshot=t.value,u.children=t.children.map(m=>z1(r,m)),u}}const n=function(r){return new mx(new Jd(r.url),new Jd(r.params),new Jd(r.queryParams),new Jd(r.fragment),new Jd(r.data),r.outlet,r.component,r)}(t.value),i=t.children.map(o=>z1(r,o));return new hy(n,i)}}function fC(r){return"object"==typeof r&&null!=r&&!r.outlets&&!r.segmentPath}function N1(r){return"object"==typeof r&&null!=r&&r.outlets}function r2(r,t,e,n,i){let o={};return n&&sp(n,(u,m)=>{o[m]=Array.isArray(u)?u.map(b=>`${b}`):`${u}`}),new R_(e.root===r?t:VO(e.root,r,t),o,i)}function VO(r,t,e){const n={};return sp(r.children,(i,o)=>{n[o]=i===t?e:VO(i,t,e)}),new ba(r.segments,n)}class GO{constructor(t,e,n){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=n,t&&n.length>0&&fC(n[0]))throw new Error("Root segment cannot have matrix parameters");const i=n.find(N1);if(i&&i!==SO(n))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class i2{constructor(t,e,n){this.segmentGroup=t,this.processChildren=e,this.index=n}}function qO(r,t,e){if(r||(r=new ba([],{})),0===r.segments.length&&r.hasChildren())return mC(r,t,e);const n=function(r,t,e){let n=0,i=t;const o={match:!1,pathIndex:0,commandIndex:0};for(;i<r.segments.length;){if(n>=e.length)return o;const u=r.segments[i],m=e[n];if(N1(m))break;const b=`${m}`,T=n<e.length-1?e[n+1]:null;if(i>0&&void 0===b)break;if(b&&T&&"object"==typeof T&&void 0===T.outlets){if(!HO(b,T,u))return o;n+=2}else{if(!HO(b,{},u))return o;n++}i++}return{match:!0,pathIndex:i,commandIndex:n}}(r,t,e),i=e.slice(n.commandIndex);if(n.match&&n.pathIndex<r.segments.length){const o=new ba(r.segments.slice(0,n.pathIndex),{});return o.children[sa]=new ba(r.segments.slice(n.pathIndex),r.children),mC(o,0,i)}return n.match&&0===i.length?new ba(r.segments,{}):n.match&&!r.hasChildren()?o2(r,t,e):n.match?mC(r,0,i):o2(r,t,e)}function mC(r,t,e){if(0===e.length)return new ba(r.segments,{});{const n=function(r){return N1(r[0])?r[0].outlets:{[sa]:r}}(e),i={};return sp(n,(o,u)=>{"string"==typeof o&&(o=[o]),null!==o&&(i[u]=qO(r.children[u],t,o))}),sp(r.children,(o,u)=>{void 0===n[u]&&(i[u]=o)}),new ba(r.segments,i)}}function o2(r,t,e){const n=r.segments.slice(0,t);let i=0;for(;i<e.length;){const o=e[i];if(N1(o)){const b=wW(o.outlets);return new ba(n,b)}if(0===i&&fC(e[0])){n.push(new L1(r.segments[t].path,ZO(e[0]))),i++;continue}const u=N1(o)?o.outlets[sa]:`${o}`,m=i<e.length-1?e[i+1]:null;u&&m&&fC(m)?(n.push(new L1(u,ZO(m))),i+=2):(n.push(new L1(u,{})),i++)}return new ba(n,{})}function wW(r){const t={};return sp(r,(e,n)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[n]=o2(new ba([],{}),0,e))}),t}function ZO(r){const t={};return sp(r,(e,n)=>t[n]=`${e}`),t}function HO(r,t,e){return r==e.path&&_g(t,e.parameters)}class EW{constructor(t,e,n,i){this.routeReuseStrategy=t,this.futureState=e,this.currState=n,this.forwardEvent=i}activate(t){const e=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,n,t),t2(this.futureState.root),this.activateChildRoutes(e,n,t)}deactivateChildRoutes(t,e,n){const i=fx(e);t.children.forEach(o=>{const u=o.value.outlet;this.deactivateRoutes(o,i[u],n),delete i[u]}),sp(i,(o,u)=>{this.deactivateRouteAndItsChildren(o,n)})}deactivateRoutes(t,e,n){const i=t.value,o=e?e.value:null;if(i===o)if(i.component){const u=n.getContext(i.outlet);u&&this.deactivateChildRoutes(t,e,u.children)}else this.deactivateChildRoutes(t,e,n);else o&&this.deactivateRouteAndItsChildren(e,n)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const n=e.getContext(t.value.outlet),i=n&&t.value.component?n.children:e,o=fx(t);for(const u of Object.keys(o))this.deactivateRouteAndItsChildren(o[u],i);if(n&&n.outlet){const u=n.outlet.detach(),m=n.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:u,route:t,contexts:m})}}deactivateRouteAndOutlet(t,e){const n=e.getContext(t.value.outlet),i=n&&t.value.component?n.children:e,o=fx(t);for(const u of Object.keys(o))this.deactivateRouteAndItsChildren(o[u],i);n&&n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated(),n.attachRef=null,n.resolver=null,n.route=null)}activateChildRoutes(t,e,n){const i=fx(e);t.children.forEach(o=>{this.activateRoutes(o,i[o.value.outlet],n),this.forwardEvent(new qH(o.value.snapshot))}),t.children.length&&this.forwardEvent(new VH(t.value.snapshot))}activateRoutes(t,e,n){const i=t.value,o=e?e.value:null;if(t2(i),i===o)if(i.component){const u=n.getOrCreateContext(i.outlet);this.activateChildRoutes(t,e,u.children)}else this.activateChildRoutes(t,e,n);else if(i.component){const u=n.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){const m=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),u.children.onOutletReAttached(m.contexts),u.attachRef=m.componentRef,u.route=m.route.value,u.outlet&&u.outlet.attach(m.componentRef,m.route.value),t2(m.route.value),this.activateChildRoutes(t,null,u.children)}else{const m=function(r){for(let t=r.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig;if(e&&e.component)return null}return null}(i.snapshot),b=m?m.module.componentFactoryResolver:null;u.attachRef=null,u.route=i,u.resolver=b,u.outlet&&u.outlet.activateWith(i,b),this.activateChildRoutes(t,null,u.children)}}else this.activateChildRoutes(t,null,n)}}class a2{constructor(t,e){this.routes=t,this.module=e}}function cv(r){return"function"==typeof r}function L_(r){return r instanceof R_}const B1=Symbol("INITIAL_VALUE");function j1(){return lv(r=>function(...r){const t=Xt(r),e=xt(r),{args:n,keys:i}=aO(r);if(0===n.length)return qt([],t);const o=new ct(function(r,t,e=qr){return n=>{fO(t,()=>{const{length:i}=r,o=new Array(i);let u=i,m=i;for(let b=0;b<i;b++)fO(t,()=>{const T=qt(r[b],t);let F=!1;T.subscribe(new Vi(n,V=>{o[b]=V,F||(F=!0,m--),m||n.next(e(o.slice()))},()=>{--u||n.complete()}))},n)},n)}}(n,t,i?u=>lO(i,u):qr));return e?o.pipe(sO(e)):o}(r.map(t=>t.pipe(wn(1),function(...r){const t=Xt(r);return Xi((e,n)=>{(t?sC(r,e,t):sC(r,e)).subscribe(n)})}(B1)))).pipe(yO((t,e)=>{let n=!1;return e.reduce((i,o,u)=>i!==B1?i:(o===B1&&(n=!0),n||!1!==o&&u!==e.length-1&&!L_(o)?i:o),t)},B1),e_(t=>t!==B1),Zr(t=>L_(t)?t:!0===t),wn(1)))}class kW{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new U1,this.attachRef=null}}class U1{constructor(){this.contexts=new Map}onChildOutletCreated(t,e){const n=this.getOrCreateContext(t);n.outlet=e,this.contexts.set(t,n)}onChildOutletDestroyed(t){const e=this.getContext(t);e&&(e.outlet=null,e.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let e=this.getContext(t);return e||(e=new kW,this.contexts.set(t,e)),e}getContext(t){return this.contexts.get(t)||null}}let s2=(()=>{class r{constructor(e,n,i,o,u){this.parentContexts=e,this.location=n,this.resolver=i,this.changeDetector=u,this.activated=null,this._activatedRoute=null,this.activateEvents=new Nn,this.deactivateEvents=new Nn,this.attachEvents=new Nn,this.detachEvents=new Nn,this.name=o||sa,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,n){this.activated=e,this._activatedRoute=n,this.location.insert(e.hostView),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,n){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;const u=(n=n||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),m=this.parentContexts.getOrCreateContext(this.name).children,b=new PW(e,m,this.location.injector);this.activated=this.location.createComponent(u,this.location.length,b),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return r.\u0275fac=function(e){return new(e||r)(qn(U1),qn(If),qn(Kv),function(r){return function(r,t){if("class"===t)return r.classes;if("style"===t)return r.styles;const e=r.attrs;if(e){const n=e.length;let i=0;for(;i<n;){const o=e[i];if(Cr(o))break;if(0===o)i+=2;else if("number"==typeof o)for(i++;i<n&&"string"==typeof e[i];)i++;else{if(o===t)return e[i+1];i+=2}}}return null}(jo(),r)}("name"),qn(Ab))},r.\u0275dir=Pa({type:r,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),r})();class PW{constructor(t,e,n){this.route=t,this.childContexts=e,this.parent=n}get(t,e){return t===mx?this.route:t===U1?this.childContexts:this.parent.get(t,e)}}let WO=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275cmp=eo({type:r,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,n){1&e&&Hi(0,"router-outlet")},directives:[s2],encapsulation:2}),r})();function $O(r,t=""){for(let e=0;e<r.length;e++){const n=r[e];RW(n,OW(t,n))}}function RW(r,t){r.children&&$O(r.children,t)}function OW(r,t){return t?r||t.path?r&&!t.path?`${r}/`:!r&&t.path?t.path:`${r}/${t.path}`:"":r}function l2(r){const t=r.children&&r.children.map(l2),e=t?Object.assign(Object.assign({},r),{children:t}):Object.assign({},r);return!e.component&&(t||e.loadChildren)&&e.outlet&&e.outlet!==sa&&(e.component=WO),e}function Ff(r){return r.outlet||sa}function XO(r,t){const e=r.filter(n=>Ff(n)===t);return e.push(...r.filter(n=>Ff(n)!==t)),e}const YO={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function gC(r,t,e){var n;if(""===t.path)return"full"===t.pathMatch&&(r.hasChildren()||e.length>0)?Object.assign({},YO):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const o=(t.matcher||WH)(e,r,t);if(!o)return Object.assign({},YO);const u={};sp(o.posParams,(b,T)=>{u[T]=b.path});const m=o.consumed.length>0?Object.assign(Object.assign({},u),o.consumed[o.consumed.length-1].parameters):u;return{matched:!0,consumedSegments:o.consumed,lastChild:o.consumed.length,parameters:m,positionalParamSegments:null!==(n=o.posParams)&&void 0!==n?n:{}}}function yC(r,t,e,n,i="corrected"){if(e.length>0&&function(r,t,e){return e.some(n=>vC(r,t,n)&&Ff(n)!==sa)}(r,e,n)){const u=new ba(t,function(r,t,e,n){const i={};i[sa]=n,n._sourceSegment=r,n._segmentIndexShift=t.length;for(const o of e)if(""===o.path&&Ff(o)!==sa){const u=new ba([],{});u._sourceSegment=r,u._segmentIndexShift=t.length,i[Ff(o)]=u}return i}(r,t,n,new ba(e,r.children)));return u._sourceSegment=r,u._segmentIndexShift=t.length,{segmentGroup:u,slicedSegments:[]}}if(0===e.length&&function(r,t,e){return e.some(n=>vC(r,t,n))}(r,e,n)){const u=new ba(r.segments,function(r,t,e,n,i,o){const u={};for(const m of n)if(vC(r,e,m)&&!i[Ff(m)]){const b=new ba([],{});b._sourceSegment=r,b._segmentIndexShift="legacy"===o?r.segments.length:t.length,u[Ff(m)]=b}return Object.assign(Object.assign({},i),u)}(r,t,e,n,r.children,i));return u._sourceSegment=r,u._segmentIndexShift=t.length,{segmentGroup:u,slicedSegments:e}}const o=new ba(r.segments,r.children);return o._sourceSegment=r,o._segmentIndexShift=t.length,{segmentGroup:o,slicedSegments:e}}function vC(r,t,e){return(!(r.hasChildren()||t.length>0)||"full"!==e.pathMatch)&&""===e.path}function KO(r,t,e,n){return!!(Ff(r)===n||n!==sa&&vC(t,e,r))&&("**"===r.path||gC(t,r,e).matched)}function JO(r,t,e){return 0===t.length&&!r.children[e]}class V1{constructor(t){this.segmentGroup=t||null}}class QO{constructor(t){this.urlTree=t}}function _C(r){return new ct(t=>t.error(new V1(r)))}function eL(r){return new ct(t=>t.error(new QO(r)))}function BW(r){return new ct(t=>t.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${r}'`)))}class VW{constructor(t,e,n,i,o){this.configLoader=e,this.urlSerializer=n,this.urlTree=i,this.config=o,this.allowRedirects=!0,this.ngModule=t.get(Kg)}apply(){const t=yC(this.urlTree.root,[],[],this.config).segmentGroup,e=new ba(t.segments,t.children);return this.expandSegmentGroup(this.ngModule,this.config,e,sa).pipe(Zr(o=>this.createUrlTree(u2(o),this.urlTree.queryParams,this.urlTree.fragment))).pipe(uv(o=>{if(o instanceof QO)return this.allowRedirects=!1,this.match(o.urlTree);throw o instanceof V1?this.noMatchError(o):o}))}match(t){return this.expandSegmentGroup(this.ngModule,this.config,t.root,sa).pipe(Zr(i=>this.createUrlTree(u2(i),t.queryParams,t.fragment))).pipe(uv(i=>{throw i instanceof V1?this.noMatchError(i):i}))}noMatchError(t){return new Error(`Cannot match any routes. URL Segment: '${t.segmentGroup}'`)}createUrlTree(t,e,n){const i=t.segments.length>0?new ba([],{[sa]:t}):t;return new R_(i,e,n)}expandSegmentGroup(t,e,n,i){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(t,e,n).pipe(Zr(o=>new ba([],o))):this.expandSegment(t,n,e,n.segments,i,!0)}expandChildren(t,e,n){const i=[];for(const o of Object.keys(n.children))"primary"===o?i.unshift(o):i.push(o);return qt(i).pipe(ax(o=>{const u=n.children[o],m=XO(e,o);return this.expandSegmentGroup(t,m,u,o).pipe(Zr(b=>({segment:b,outlet:o})))}),yO((o,u)=>(o[u.outlet]=u.segment,o),{}),function(r,t){const e=arguments.length>=2;return n=>n.pipe(r?e_((i,o)=>r(i,o,n)):qr,$T(1),e?CD(t):ED(()=>new Xb))}())}expandSegment(t,e,n,i,o,u){return qt(n).pipe(ax(m=>this.expandSegmentAgainstRoute(t,e,n,m,i,o,u).pipe(uv(T=>{if(T instanceof V1)return wo(null);throw T}))),t_(m=>!!m),uv((m,b)=>{if(m instanceof Xb||"EmptyError"===m.name){if(JO(e,i,o))return wo(new ba([],{}));throw new V1(e)}throw m}))}expandSegmentAgainstRoute(t,e,n,i,o,u,m){return KO(i,e,o,u)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(t,e,i,o,u):m&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,n,i,o,u):_C(e):_C(e)}expandSegmentAgainstRouteUsingRedirect(t,e,n,i,o,u){return"**"===i.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,i,u):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,n,i,o,u)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,e,n,i){const o=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?eL(o):this.lineralizeSegments(n,o).pipe(pe(u=>{const m=new ba(u,{});return this.expandSegment(t,m,e,u,i,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,e,n,i,o,u){const{matched:m,consumedSegments:b,lastChild:T,positionalParamSegments:F}=gC(e,i,o);if(!m)return _C(e);const V=this.applyRedirectCommands(b,i.redirectTo,F);return i.redirectTo.startsWith("/")?eL(V):this.lineralizeSegments(i,V).pipe(pe(H=>this.expandSegment(t,e,n,H.concat(o.slice(T)),u,!1)))}matchSegmentAgainstRoute(t,e,n,i,o){if("**"===n.path)return n.loadChildren?(n._loadedConfig?wo(n._loadedConfig):this.configLoader.load(t.injector,n)).pipe(Zr(H=>(n._loadedConfig=H,new ba(i,{})))):wo(new ba(i,{}));const{matched:u,consumedSegments:m,lastChild:b}=gC(e,n,i);if(!u)return _C(e);const T=i.slice(b);return this.getChildConfig(t,n,i).pipe(pe(V=>{const H=V.module,J=V.routes,{segmentGroup:ne,slicedSegments:we}=yC(e,m,T,J),Re=new ba(ne.segments,ne.children);if(0===we.length&&Re.hasChildren())return this.expandChildren(H,J,Re).pipe(Zr(tt=>new ba(m,tt)));if(0===J.length&&0===we.length)return wo(new ba(m,{}));const qe=Ff(n)===o;return this.expandSegment(H,Re,J,we,qe?sa:o,!0).pipe(Zr($e=>new ba(m.concat($e.segments),$e.children)))}))}getChildConfig(t,e,n){return e.children?wo(new a2(e.children,t)):e.loadChildren?void 0!==e._loadedConfig?wo(e._loadedConfig):this.runCanLoadGuards(t.injector,e,n).pipe(pe(i=>i?this.configLoader.load(t.injector,e).pipe(Zr(o=>(e._loadedConfig=o,o))):function(r){return new ct(t=>t.error(YT(`Cannot load children because the guard of the route "path: '${r.path}'" returned false`)))}(e))):wo(new a2([],t))}runCanLoadGuards(t,e,n){const i=e.canLoad;if(!i||0===i.length)return wo(!0);const o=i.map(u=>{const m=t.get(u);let b;if(function(r){return r&&cv(r.canLoad)}(m))b=m.canLoad(e,n);else{if(!cv(m))throw new Error("Invalid CanLoad guard");b=m(e,n)}return xg(b)});return wo(o).pipe(j1(),rf(u=>{if(!L_(u))return;const m=YT(`Redirecting to "${this.urlSerializer.serialize(u)}"`);throw m.url=u,m}),Zr(u=>!0===u))}lineralizeSegments(t,e){let n=[],i=e.root;for(;;){if(n=n.concat(i.segments),0===i.numberOfChildren)return wo(n);if(i.numberOfChildren>1||!i.children[sa])return BW(t.redirectTo);i=i.children[sa]}}applyRedirectCommands(t,e,n){return this.applyRedirectCreatreUrlTree(e,this.urlSerializer.parse(e),t,n)}applyRedirectCreatreUrlTree(t,e,n,i){const o=this.createSegmentGroup(t,e.root,n,i);return new R_(o,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const n={};return sp(t,(i,o)=>{if("string"==typeof i&&i.startsWith(":")){const m=i.substring(1);n[o]=e[m]}else n[o]=i}),n}createSegmentGroup(t,e,n,i){const o=this.createSegments(t,e.segments,n,i);let u={};return sp(e.children,(m,b)=>{u[b]=this.createSegmentGroup(t,m,n,i)}),new ba(o,u)}createSegments(t,e,n,i){return e.map(o=>o.path.startsWith(":")?this.findPosParam(t,o,i):this.findOrReturn(o,n))}findPosParam(t,e,n){const i=n[e.path.substring(1)];if(!i)throw new Error(`Cannot redirect to '${t}'. Cannot find '${e.path}'.`);return i}findOrReturn(t,e){let n=0;for(const i of e){if(i.path===t.path)return e.splice(n),i;n++}return t}}function u2(r){const t={};for(const n of Object.keys(r.children)){const o=u2(r.children[n]);(o.segments.length>0||o.hasChildren())&&(t[n]=o)}return function(r){if(1===r.numberOfChildren&&r.children[sa]){const t=r.children[sa];return new ba(r.segments.concat(t.segments),t.children)}return r}(new ba(r.segments,t))}class tL{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class xC{constructor(t,e){this.component=t,this.route=e}}function ZW(r,t,e){const n=r._root;return G1(n,t?t._root:null,e,[n.value])}function bC(r,t,e){const n=function(r){if(!r)return null;for(let t=r.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig}return null}(t);return(n?n.module.injector:e).get(r)}function G1(r,t,e,n,i={canDeactivateChecks:[],canActivateChecks:[]}){const o=fx(t);return r.children.forEach(u=>{(function(r,t,e,n,i={canDeactivateChecks:[],canActivateChecks:[]}){const o=r.value,u=t?t.value:null,m=e?e.getContext(r.value.outlet):null;if(u&&o.routeConfig===u.routeConfig){const b=function(r,t,e){if("function"==typeof e)return e(r,t);switch(e){case"pathParamsChange":return!O_(r.url,t.url);case"pathParamsOrQueryParamsChange":return!O_(r.url,t.url)||!_g(r.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!n2(r,t)||!_g(r.queryParams,t.queryParams);default:return!n2(r,t)}}(u,o,o.routeConfig.runGuardsAndResolvers);b?i.canActivateChecks.push(new tL(n)):(o.data=u.data,o._resolvedData=u._resolvedData),G1(r,t,o.component?m?m.children:null:e,n,i),b&&m&&m.outlet&&m.outlet.isActivated&&i.canDeactivateChecks.push(new xC(m.outlet.component,u))}else u&&q1(t,m,i),i.canActivateChecks.push(new tL(n)),G1(r,null,o.component?m?m.children:null:e,n,i)})(u,o[u.value.outlet],e,n.concat([u.value]),i),delete o[u.value.outlet]}),sp(o,(u,m)=>q1(u,e.getContext(m),i)),i}function q1(r,t,e){const n=fx(r),i=r.value;sp(n,(o,u)=>{q1(o,i.component?t?t.children.getContext(u):null:t,e)}),e.canDeactivateChecks.push(new xC(i.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,i))}class i${}function nL(r){return new ct(t=>t.error(r))}class a${constructor(t,e,n,i,o,u){this.rootComponentType=t,this.config=e,this.urlTree=n,this.url=i,this.paramsInheritanceStrategy=o,this.relativeLinkResolution=u}recognize(){const t=yC(this.urlTree.root,[],[],this.config.filter(u=>void 0===u.redirectTo),this.relativeLinkResolution).segmentGroup,e=this.processSegmentGroup(this.config,t,sa);if(null===e)return null;const n=new dC([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},sa,this.rootComponentType,null,this.urlTree.root,-1,{}),i=new hy(n,e),o=new jO(this.url,i);return this.inheritParamsAndData(o._root),o}inheritParamsAndData(t){const e=t.value,n=BO(e,this.paramsInheritanceStrategy);e.params=Object.freeze(n.params),e.data=Object.freeze(n.data),t.children.forEach(i=>this.inheritParamsAndData(i))}processSegmentGroup(t,e,n){return 0===e.segments.length&&e.hasChildren()?this.processChildren(t,e):this.processSegment(t,e,e.segments,n)}processChildren(t,e){const n=[];for(const o of Object.keys(e.children)){const u=e.children[o],m=XO(t,o),b=this.processSegmentGroup(m,u,o);if(null===b)return null;n.push(...b)}const i=rL(n);return function(r){r.sort((t,e)=>t.value.outlet===sa?-1:e.value.outlet===sa?1:t.value.outlet.localeCompare(e.value.outlet))}(i),i}processSegment(t,e,n,i){for(const o of t){const u=this.processSegmentAgainstRoute(o,e,n,i);if(null!==u)return u}return JO(e,n,i)?[]:null}processSegmentAgainstRoute(t,e,n,i){if(t.redirectTo||!KO(t,e,n,i))return null;let o,u=[],m=[];if("**"===t.path){const J=n.length>0?SO(n).parameters:{};o=new dC(n,J,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,aL(t),Ff(t),t.component,t,iL(e),oL(e)+n.length,sL(t))}else{const J=gC(e,t,n);if(!J.matched)return null;u=J.consumedSegments,m=n.slice(J.lastChild),o=new dC(u,J.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,aL(t),Ff(t),t.component,t,iL(e),oL(e)+u.length,sL(t))}const b=function(r){return r.children?r.children:r.loadChildren?r._loadedConfig.routes:[]}(t),{segmentGroup:T,slicedSegments:F}=yC(e,u,m,b.filter(J=>void 0===J.redirectTo),this.relativeLinkResolution);if(0===F.length&&T.hasChildren()){const J=this.processChildren(b,T);return null===J?null:[new hy(o,J)]}if(0===b.length&&0===F.length)return[new hy(o,[])];const V=Ff(t)===i,H=this.processSegment(b,T,F,V?sa:i);return null===H?null:[new hy(o,H)]}}function u$(r){const t=r.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function rL(r){const t=[],e=new Set;for(const n of r){if(!u$(n)){t.push(n);continue}const i=t.find(o=>n.value.routeConfig===o.value.routeConfig);void 0!==i?(i.children.push(...n.children),e.add(i)):t.push(n)}for(const n of e){const i=rL(n.children);t.push(new hy(n.value,i))}return t.filter(n=>!e.has(n))}function iL(r){let t=r;for(;t._sourceSegment;)t=t._sourceSegment;return t}function oL(r){let t=r,e=t._segmentIndexShift?t._segmentIndexShift:0;for(;t._sourceSegment;)t=t._sourceSegment,e+=t._segmentIndexShift?t._segmentIndexShift:0;return e-1}function aL(r){return r.data||{}}function sL(r){return r.resolve||{}}function c2(r){return lv(t=>{const e=r(t);return e?qt(e).pipe(Zr(()=>t)):wo(t)})}class y$ extends class{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}{}const h2=new ao("ROUTES");class lL{constructor(t,e,n,i){this.injector=t,this.compiler=e,this.onLoadStartListener=n,this.onLoadEndListener=i}load(t,e){if(e._loader$)return e._loader$;this.onLoadStartListener&&this.onLoadStartListener(e);const i=this.loadModuleFactory(e.loadChildren).pipe(Zr(o=>{this.onLoadEndListener&&this.onLoadEndListener(e);const u=o.create(t);return new a2(EO(u.injector.get(h2,void 0,oi.Self|oi.Optional)).map(l2),u)}),uv(o=>{throw e._loader$=void 0,o}));return e._loader$=new DH(i,()=>new Er).pipe(gO()),e._loader$}loadModuleFactory(t){return xg(t()).pipe(pe(e=>e instanceof MM?wo(e):qt(this.compiler.compileModuleAsync(e))))}}class _${shouldProcessUrl(t){return!0}extract(t){return t}merge(t,e){return t}}function x$(r){throw r}function b$(r,t,e){return t.parse("/")}function uL(r,t){return wo(null)}const w$={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},C$={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let of=(()=>{class r{constructor(e,n,i,o,u,m,b){this.rootComponentType=e,this.urlSerializer=n,this.rootContexts=i,this.location=o,this.config=b,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Er,this.errorHandler=x$,this.malformedUriErrorHandler=b$,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:uL,afterPreactivation:uL},this.urlHandlingStrategy=new _$,this.routeReuseStrategy=new y$,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=u.get(Kg),this.console=u.get(cA);const V=u.get(bc);this.isNgZoneEnabled=V instanceof bc&&bc.isInAngularZone(),this.resetConfig(b),this.currentUrlTree=new R_(new ba([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new lL(u,m,H=>this.triggerEvent(new _O(H)),H=>this.triggerEvent(new xO(H))),this.routerState=NO(this.currentUrlTree,this.rootComponentType),this.transitions=new Jd({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}setupNavigations(e){const n=this.events;return e.pipe(e_(i=>0!==i.id),Zr(i=>Object.assign(Object.assign({},i),{extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl)})),lv(i=>{let o=!1,u=!1;return wo(i).pipe(rf(m=>{this.currentNavigation={id:m.id,initialUrl:m.currentRawUrl,extractedUrl:m.extractedUrl,trigger:m.source,extras:m.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),lv(m=>{const b=this.browserUrlTree.toString(),T=!this.navigated||m.extractedUrl.toString()!==b||b!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||T)&&this.urlHandlingStrategy.shouldProcessUrl(m.rawUrl))return wC(m.source)&&(this.browserUrlTree=m.extractedUrl),wo(m).pipe(lv(V=>{const H=this.transitions.getValue();return n.next(new XT(V.id,this.serializeUrl(V.extractedUrl),V.source,V.restoredState)),H!==this.transitions.getValue()?He:Promise.resolve(V)}),function(r,t,e,n){return lv(i=>function(r,t,e,n,i){return new VW(r,t,e,n,i).apply()}(r,t,e,i.extractedUrl,n).pipe(Zr(o=>Object.assign(Object.assign({},i),{urlAfterRedirects:o}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),rf(V=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:V.urlAfterRedirects})}),function(r,t,e,n,i){return pe(o=>function(r,t,e,n,i="emptyOnly",o="legacy"){try{const u=new a$(r,t,e,n,i,o).recognize();return null===u?nL(new i$):wo(u)}catch(u){return nL(u)}}(r,t,o.urlAfterRedirects,e(o.urlAfterRedirects),n,i).pipe(Zr(u=>Object.assign(Object.assign({},o),{targetSnapshot:u}))))}(this.rootComponentType,this.config,V=>this.serializeUrl(V),this.paramsInheritanceStrategy,this.relativeLinkResolution),rf(V=>{if("eager"===this.urlUpdateStrategy){if(!V.extras.skipLocationChange){const J=this.urlHandlingStrategy.merge(V.urlAfterRedirects,V.rawUrl);this.setBrowserUrl(J,V)}this.browserUrlTree=V.urlAfterRedirects}const H=new FH(V.id,this.serializeUrl(V.extractedUrl),this.serializeUrl(V.urlAfterRedirects),V.targetSnapshot);n.next(H)}));if(T&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:H,extractedUrl:J,source:ne,restoredState:we,extras:Re}=m,qe=new XT(H,this.serializeUrl(J),ne,we);n.next(qe);const Ne=NO(J,this.rootComponentType).snapshot;return wo(Object.assign(Object.assign({},m),{targetSnapshot:Ne,urlAfterRedirects:J,extras:Object.assign(Object.assign({},Re),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=m.rawUrl,m.resolve(null),He}),c2(m=>{const{targetSnapshot:b,id:T,extractedUrl:F,rawUrl:V,extras:{skipLocationChange:H,replaceUrl:J}}=m;return this.hooks.beforePreactivation(b,{navigationId:T,appliedUrlTree:F,rawUrlTree:V,skipLocationChange:!!H,replaceUrl:!!J})}),rf(m=>{const b=new zH(m.id,this.serializeUrl(m.extractedUrl),this.serializeUrl(m.urlAfterRedirects),m.targetSnapshot);this.triggerEvent(b)}),Zr(m=>Object.assign(Object.assign({},m),{guards:ZW(m.targetSnapshot,m.currentSnapshot,this.rootContexts)})),function(r,t){return pe(e=>{const{targetSnapshot:n,currentSnapshot:i,guards:{canActivateChecks:o,canDeactivateChecks:u}}=e;return 0===u.length&&0===o.length?wo(Object.assign(Object.assign({},e),{guardsResult:!0})):function(r,t,e,n){return qt(r).pipe(pe(i=>function(r,t,e,n,i){const o=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return o&&0!==o.length?wo(o.map(m=>{const b=bC(m,t,i);let T;if(function(r){return r&&cv(r.canDeactivate)}(b))T=xg(b.canDeactivate(r,t,e,n));else{if(!cv(b))throw new Error("Invalid CanDeactivate guard");T=xg(b(r,t,e,n))}return T.pipe(t_())})).pipe(j1()):wo(!0)}(i.component,i.route,e,t,n)),t_(i=>!0!==i,!0))}(u,n,i,r).pipe(pe(m=>m&&function(r){return"boolean"==typeof r}(m)?function(r,t,e,n){return qt(t).pipe(ax(i=>sC(function(r,t){return null!==r&&t&&t(new UH(r)),wo(!0)}(i.route.parent,n),function(r,t){return null!==r&&t&&t(new GH(r)),wo(!0)}(i.route,n),function(r,t,e){const n=t[t.length-1],o=t.slice(0,t.length-1).reverse().map(u=>function(r){const t=r.routeConfig?r.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:r,guards:t}:null}(u)).filter(u=>null!==u).map(u=>mO(()=>wo(u.guards.map(b=>{const T=bC(b,u.node,e);let F;if(function(r){return r&&cv(r.canActivateChild)}(T))F=xg(T.canActivateChild(n,r));else{if(!cv(T))throw new Error("Invalid CanActivateChild guard");F=xg(T(n,r))}return F.pipe(t_())})).pipe(j1())));return wo(o).pipe(j1())}(r,i.path,e),function(r,t,e){const n=t.routeConfig?t.routeConfig.canActivate:null;if(!n||0===n.length)return wo(!0);const i=n.map(o=>mO(()=>{const u=bC(o,t,e);let m;if(function(r){return r&&cv(r.canActivate)}(u))m=xg(u.canActivate(t,r));else{if(!cv(u))throw new Error("Invalid CanActivate guard");m=xg(u(t,r))}return m.pipe(t_())}));return wo(i).pipe(j1())}(r,i.route,e))),t_(i=>!0!==i,!0))}(n,o,r,t):wo(m)),Zr(m=>Object.assign(Object.assign({},e),{guardsResult:m})))})}(this.ngModule.injector,m=>this.triggerEvent(m)),rf(m=>{if(L_(m.guardsResult)){const T=YT(`Redirecting to "${this.serializeUrl(m.guardsResult)}"`);throw T.url=m.guardsResult,T}const b=new NH(m.id,this.serializeUrl(m.extractedUrl),this.serializeUrl(m.urlAfterRedirects),m.targetSnapshot,!!m.guardsResult);this.triggerEvent(b)}),e_(m=>!!m.guardsResult||(this.restoreHistory(m),this.cancelNavigationTransition(m,""),!1)),c2(m=>{if(m.guards.canActivateChecks.length)return wo(m).pipe(rf(b=>{const T=new BH(b.id,this.serializeUrl(b.extractedUrl),this.serializeUrl(b.urlAfterRedirects),b.targetSnapshot);this.triggerEvent(T)}),lv(b=>{let T=!1;return wo(b).pipe(function(r,t){return pe(e=>{const{targetSnapshot:n,guards:{canActivateChecks:i}}=e;if(!i.length)return wo(e);let o=0;return qt(i).pipe(ax(u=>function(r,t,e,n){return function(r,t,e,n){const i=Object.keys(r);if(0===i.length)return wo({});const o={};return qt(i).pipe(pe(u=>function(r,t,e,n){const i=bC(r,t,n);return xg(i.resolve?i.resolve(t,e):i(t,e))}(r[u],t,e,n).pipe(rf(m=>{o[u]=m}))),$T(1),pe(()=>Object.keys(o).length===i.length?wo(o):He))}(r._resolve,r,t,n).pipe(Zr(o=>(r._resolvedData=o,r.data=Object.assign(Object.assign({},r.data),BO(r,e).resolve),null)))}(u.route,n,r,t)),rf(()=>o++),$T(1),pe(u=>o===i.length?wo(e):He))})}(this.paramsInheritanceStrategy,this.ngModule.injector),rf({next:()=>T=!0,complete:()=>{T||(this.restoreHistory(b),this.cancelNavigationTransition(b,"At least one route resolver didn't emit any value."))}}))}),rf(b=>{const T=new jH(b.id,this.serializeUrl(b.extractedUrl),this.serializeUrl(b.urlAfterRedirects),b.targetSnapshot);this.triggerEvent(T)}))}),c2(m=>{const{targetSnapshot:b,id:T,extractedUrl:F,rawUrl:V,extras:{skipLocationChange:H,replaceUrl:J}}=m;return this.hooks.afterPreactivation(b,{navigationId:T,appliedUrlTree:F,rawUrlTree:V,skipLocationChange:!!H,replaceUrl:!!J})}),Zr(m=>{const b=function(r,t,e){const n=z1(r,t._root,e?e._root:void 0);return new zO(n,t)}(this.routeReuseStrategy,m.targetSnapshot,m.currentRouterState);return Object.assign(Object.assign({},m),{targetRouterState:b})}),rf(m=>{this.currentUrlTree=m.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(m.urlAfterRedirects,m.rawUrl),this.routerState=m.targetRouterState,"deferred"===this.urlUpdateStrategy&&(m.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,m),this.browserUrlTree=m.urlAfterRedirects)}),((r,t,e)=>Zr(n=>(new EW(t,n.targetRouterState,n.currentRouterState,e).activate(r),n)))(this.rootContexts,this.routeReuseStrategy,m=>this.triggerEvent(m)),rf({next(){o=!0},complete(){o=!0}}),function(r){return Xi((t,e)=>{try{t.subscribe(e)}finally{e.add(r)}})}(()=>{var m;o||u||this.cancelNavigationTransition(i,`Navigation ID ${i.id} is not equal to the current navigation id ${this.navigationId}`),(null===(m=this.currentNavigation)||void 0===m?void 0:m.id)===i.id&&(this.currentNavigation=null)}),uv(m=>{if(u=!0,function(r){return r&&r[wO]}(m)){const b=L_(m.url);b||(this.navigated=!0,this.restoreHistory(i,!0));const T=new vO(i.id,this.serializeUrl(i.extractedUrl),m.message);n.next(T),b?setTimeout(()=>{const F=this.urlHandlingStrategy.merge(m.url,this.rawUrlTree),V={skipLocationChange:i.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||wC(i.source)};this.scheduleNavigation(F,"imperative",null,V,{resolve:i.resolve,reject:i.reject,promise:i.promise})},0):i.resolve(!1)}else{this.restoreHistory(i,!0);const b=new LH(i.id,this.serializeUrl(i.extractedUrl),m);n.next(b);try{i.resolve(this.errorHandler(m))}catch(T){i.reject(T)}}return He}))}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const n="popstate"===e.type?"popstate":"hashchange";"popstate"===n&&setTimeout(()=>{var i;const o={replaceUrl:!0},u=(null===(i=e.state)||void 0===i?void 0:i.navigationId)?e.state:null;if(u){const b=Object.assign({},u);delete b.navigationId,delete b.\u0275routerPageId,0!==Object.keys(b).length&&(o.state=b)}const m=this.parseUrl(e.url);this.scheduleNavigation(m,n,u,o)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){$O(e),this.config=e.map(l2),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,n={}){const{relativeTo:i,queryParams:o,fragment:u,queryParamsHandling:m,preserveFragment:b}=n,T=i||this.routerState.root,F=b?this.currentUrlTree.fragment:u;let V=null;switch(m){case"merge":V=Object.assign(Object.assign({},this.currentUrlTree.queryParams),o);break;case"preserve":V=this.currentUrlTree.queryParams;break;default:V=o||null}return null!==V&&(V=this.removeEmptyProps(V)),function(r,t,e,n,i){if(0===e.length)return r2(t.root,t.root,t,n,i);const o=function(r){if("string"==typeof r[0]&&1===r.length&&"/"===r[0])return new GO(!0,0,r);let t=0,e=!1;const n=r.reduce((i,o,u)=>{if("object"==typeof o&&null!=o){if(o.outlets){const m={};return sp(o.outlets,(b,T)=>{m[T]="string"==typeof b?b.split("/"):b}),[...i,{outlets:m}]}if(o.segmentPath)return[...i,o.segmentPath]}return"string"!=typeof o?[...i,o]:0===u?(o.split("/").forEach((m,b)=>{0==b&&"."===m||(0==b&&""===m?e=!0:".."===m?t++:""!=m&&i.push(m))}),i):[...i,o]},[]);return new GO(e,t,n)}(e);if(o.toRoot())return r2(t.root,new ba([],{}),t,n,i);const u=function(r,t,e){if(r.isAbsolute)return new i2(t.root,!0,0);if(-1===e.snapshot._lastPathIndex){const o=e.snapshot._urlSegment;return new i2(o,o===t.root,0)}const n=fC(r.commands[0])?0:1;return function(r,t,e){let n=r,i=t,o=e;for(;o>i;){if(o-=i,n=n.parent,!n)throw new Error("Invalid number of '../'");i=n.segments.length}return new i2(n,!1,i-o)}(e.snapshot._urlSegment,e.snapshot._lastPathIndex+n,r.numberOfDoubleDots)}(o,t,r),m=u.processChildren?mC(u.segmentGroup,u.index,o.commands):qO(u.segmentGroup,u.index,o.commands);return r2(u.segmentGroup,m,t,n,i)}(T,this.currentUrlTree,e,V,null!=F?F:null)}navigateByUrl(e,n={skipLocationChange:!1}){const i=L_(e)?e:this.parseUrl(e),o=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(o,"imperative",null,n)}navigate(e,n={skipLocationChange:!1}){return function(r){for(let t=0;t<r.length;t++){const e=r[t];if(null==e)throw new Error(`The requested path contains ${e} segment at index ${t}`)}}(e),this.navigateByUrl(this.createUrlTree(e,n),n)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let n;try{n=this.urlSerializer.parse(e)}catch(i){n=this.malformedUriErrorHandler(i,this.urlSerializer,e)}return n}isActive(e,n){let i;if(i=!0===n?Object.assign({},w$):!1===n?Object.assign({},C$):n,L_(e))return IO(this.currentUrlTree,e,i);const o=this.parseUrl(e);return IO(this.currentUrlTree,o,i)}removeEmptyProps(e){return Object.keys(e).reduce((n,i)=>{const o=e[i];return null!=o&&(n[i]=o),n},{})}processNavigations(){this.navigations.subscribe(e=>{this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new O1(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,e.resolve(!0)},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}scheduleNavigation(e,n,i,o,u){var m,b,T;if(this.disposed)return Promise.resolve(!1);const F=this.transitions.value,V=wC(n)&&F&&!wC(F.source),H=F.rawUrl.toString()===e.toString(),J=F.id===(null===(m=this.currentNavigation)||void 0===m?void 0:m.id);if(V&&H&&J)return Promise.resolve(!0);let we,Re,qe;u?(we=u.resolve,Re=u.reject,qe=u.promise):qe=new Promise((tt,bt)=>{we=tt,Re=bt});const Ne=++this.navigationId;let $e;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(i=this.location.getState()),$e=i&&i.\u0275routerPageId?i.\u0275routerPageId:o.replaceUrl||o.skipLocationChange?null!==(b=this.browserPageId)&&void 0!==b?b:0:(null!==(T=this.browserPageId)&&void 0!==T?T:0)+1):$e=0,this.setTransition({id:Ne,targetPageId:$e,source:n,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:o,resolve:we,reject:Re,promise:qe,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),qe.catch(tt=>Promise.reject(tt))}setBrowserUrl(e,n){const i=this.urlSerializer.serialize(e),o=Object.assign(Object.assign({},n.extras.state),this.generateNgRouterState(n.id,n.targetPageId));this.location.isCurrentPathEqualTo(i)||n.extras.replaceUrl?this.location.replaceState(i,"",o):this.location.go(i,"",o)}restoreHistory(e,n=!1){var i,o;if("computed"===this.canceledNavigationResolution){const u=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(i=this.currentNavigation)||void 0===i?void 0:i.finalUrl)||0===u?this.currentUrlTree===(null===(o=this.currentNavigation)||void 0===o?void 0:o.finalUrl)&&0===u&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(u)}else"replace"===this.canceledNavigationResolution&&(n&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,n){const i=new vO(e.id,this.serializeUrl(e.extractedUrl),n);this.triggerEvent(i),e.resolve(!1)}generateNgRouterState(e,n){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:n}:{navigationId:e}}}return r.\u0275fac=function(e){LC()},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();function wC(r){return"imperative"!==r}class cL{}class hL{preload(t,e){return wo(null)}}let pL=(()=>{class r{constructor(e,n,i,o){this.router=e,this.injector=i,this.preloadingStrategy=o,this.loader=new lL(i,n,b=>e.triggerEvent(new _O(b)),b=>e.triggerEvent(new xO(b)))}setUpPreloading(){this.subscription=this.router.events.pipe(e_(e=>e instanceof O1),ax(()=>this.preload())).subscribe(()=>{})}preload(){const e=this.injector.get(Kg);return this.processRoutes(e,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,n){const i=[];for(const o of n)if(o.loadChildren&&!o.canLoad&&o._loadedConfig){const u=o._loadedConfig;i.push(this.processRoutes(u.module,u.routes))}else o.loadChildren&&!o.canLoad?i.push(this.preloadConfig(e,o)):o.children&&i.push(this.processRoutes(e,o.children));return qt(i).pipe(Se(),Zr(o=>{}))}preloadConfig(e,n){return this.preloadingStrategy.preload(n,()=>(n._loadedConfig?wo(n._loadedConfig):this.loader.load(e.injector,n)).pipe(pe(o=>(n._loadedConfig=o,this.processRoutes(o.module,o.routes)))))}}return r.\u0275fac=function(e){return new(e||r)(Xn(of),Xn(Mb),Xn(Fo),Xn(cL))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})(),f2=(()=>{class r{constructor(e,n,i={}){this.router=e,this.viewportScroller=n,this.options=i,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},i.scrollPositionRestoration=i.scrollPositionRestoration||"disabled",i.anchorScrolling=i.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof XT?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof O1&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof bO&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,n){this.router.triggerEvent(new bO(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,n))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return r.\u0275fac=function(e){LC()},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();const F_=new ao("ROUTER_CONFIGURATION"),dL=new ao("ROUTER_FORROOT_GUARD"),M$=[CE,{provide:kO,useClass:PO},{provide:of,useFactory:function(r,t,e,n,i,o,u={},m,b){const T=new of(null,r,t,e,n,i,EO(o));return m&&(T.urlHandlingStrategy=m),b&&(T.routeReuseStrategy=b),function(r,t){r.errorHandler&&(t.errorHandler=r.errorHandler),r.malformedUriErrorHandler&&(t.malformedUriErrorHandler=r.malformedUriErrorHandler),r.onSameUrlNavigation&&(t.onSameUrlNavigation=r.onSameUrlNavigation),r.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=r.paramsInheritanceStrategy),r.relativeLinkResolution&&(t.relativeLinkResolution=r.relativeLinkResolution),r.urlUpdateStrategy&&(t.urlUpdateStrategy=r.urlUpdateStrategy),r.canceledNavigationResolution&&(t.canceledNavigationResolution=r.canceledNavigationResolution)}(u,T),u.enableTracing&&T.events.subscribe(F=>{var V,H;null===(V=console.group)||void 0===V||V.call(console,`Router Event: ${F.constructor.name}`),console.log(F.toString()),console.log(F),null===(H=console.groupEnd)||void 0===H||H.call(console)}),T},deps:[kO,U1,CE,Fo,Mb,h2,F_,[class{},new po],[class{},new po]]},U1,{provide:mx,useFactory:function(r){return r.routerState.root},deps:[of]},pL,hL,class{preload(t,e){return e().pipe(uv(()=>wo(null)))}},{provide:F_,useValue:{enableTracing:!1}}];function A$(){return new gA("Router",of)}let fL=(()=>{class r{constructor(e,n){}static forRoot(e,n){return{ngModule:r,providers:[M$,mL(e),{provide:dL,useFactory:P$,deps:[[of,new po,new Pd]]},{provide:F_,useValue:n||{}},{provide:N0,useFactory:k$,deps:[Qv,[new Pm(wE),new po],F_]},{provide:f2,useFactory:D$,deps:[of,AB,F_]},{provide:cL,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:hL},{provide:gA,multi:!0,useFactory:A$},[m2,{provide:Tb,multi:!0,useFactory:F$,deps:[m2]},{provide:gL,useFactory:z$,deps:[m2]},{provide:uA,multi:!0,useExisting:gL}]]}}static forChild(e){return{ngModule:r,providers:[mL(e)]}}}return r.\u0275fac=function(e){return new(e||r)(Xn(dL,8),Xn(of,8))},r.\u0275mod=Gi({type:r}),r.\u0275inj=io({}),r})();function D$(r,t,e){return e.scrollOffset&&t.setOffset(e.scrollOffset),new f2(r,t,e)}function k$(r,t,e={}){return e.useHash?new v5(r,t):new NA(r,t)}function P$(r){return"guarded"}function mL(r){return[{provide:hr,multi:!0,useValue:r},{provide:h2,multi:!0,useValue:r}]}let m2=(()=>{class r{constructor(e){this.injector=e,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Er}appInitializer(){return this.injector.get(m5,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let n=null;const i=new Promise(m=>n=m),o=this.injector.get(of),u=this.injector.get(F_);return"disabled"===u.initialNavigation?(o.setUpLocationChangeListener(),n(!0)):"enabled"===u.initialNavigation||"enabledBlocking"===u.initialNavigation?(o.hooks.afterPreactivation=()=>this.initNavigation?wo(null):(this.initNavigation=!0,n(!0),this.resultOfPreactivationDone),o.initialNavigation()):n(!0),i})}bootstrapListener(e){const n=this.injector.get(F_),i=this.injector.get(pL),o=this.injector.get(f2),u=this.injector.get(of),m=this.injector.get(F0);e===m.components[0]&&(("enabledNonBlocking"===n.initialNavigation||void 0===n.initialNavigation)&&u.initialNavigation(),i.setUpPreloading(),o.init(),u.resetRootComponentType(m.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return r.\u0275fac=function(e){return new(e||r)(Xn(Fo))},r.\u0275prov=Hr({token:r,factory:r.\u0275fac}),r})();function F$(r){return r.appInitializer.bind(r)}function z$(r){return r.bootstrapListener.bind(r)}const gL=new ao("Router Initializer"),B$=[];let j$=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=Gi({type:r}),r.\u0275inj=io({imports:[[fL.forRoot(B$)],fL]}),r})();var Ip=(()=>(function(r){r.achtergrond="BGT Vectortile Achtergrond Visualisatie",r.standaard="BGT Vectortile Standaard Visualisatie",r.zerodefaultA="Vectortile Inspect (Blanco) Visualisatie",r.zerodefaultB="Vectortile Inspect (Kleurrijk tegels zichtbaar) Visualisatie",r.zerodefaultC_Bron="Vectortile Inspect Bronhouder Visualisatie",r.zerodefaultD="Vectortile Inspect (Kleurrijk) Visualisatie"}(Ip||(Ip={})),Ip))();function yL(r){switch(r){case Ip.achtergrond:return"styles/achtergrondvisualisatie.json";case Ip.standaard:return"styles/standaardvisualisatie.json";default:return""}}var hv=(()=>(function(r){r.search="search",r.move="move"}(hv||(hv={})),hv))();let g2=(()=>{class r{constructor(){this.rdProjection=new h_({code:"EPSG:28992",extent:[-285401.92,22598.08,595401.92,903401.92]}),this.initialView=new Of({projection:this.rdProjection,center:[155e3,463e3],zoom:13}),this.initialEvent=new R1(vg.RESULT_INVALIDATED,""),this.initialViewLocation={change:hv.move,view:this.initialView,event:this.initialEvent},this.messageSource=new Jd(this.initialViewLocation),this.currentLocation=this.messageSource.asObservable(),this.changeLocation(this.initialViewLocation)}changeLocation(e){this.messageSource.next(e)}changeSearchEvent(e){this.messageSource.next({change:hv.search,view:void 0,event:e})}changeView(e){const n=this.initialViewLocation;n.view=e,n.change=hv.move,this.messageSource.next(n)}wktToCoordinates(e){return(new DR).readFeature(e,{dataProjection:"EPSG:28992",featureProjection:"EPSG:28992"}).getGeometry().getCoordinates()}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=Hr({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),U$=(()=>{class r{constructor(e){this.locationService=e,this.demotext="random locatiedemo aan"}ngOnInit(){}handleEvent(e){e.type===vg.SEARCH_RESULT&&this.locationService.changeSearchEvent(e)}gotoStartLocationOnMap(){this.locationService.changeView(this.locationService.initialView)}toggleDemo(){this.isDemo=!this.isDemo,this.isDemo?(this.demotext="random locatie demo uit",this.gotoRandomLocation()):this.demotext="random locatie demo aan"}gotoRandomLocation(){if(this.isDemo){var e=155e3+Math.round(5e4*Math.random()),n=463e3+Math.round(5e4*Math.random());const i=new Of({projection:this.locationService.rdProjection,center:[e,n],zoom:13});this.locationService.changeView(i),setTimeout(()=>{this.gotoRandomLocation()},8e3)}}}return r.\u0275fac=function(e){return new(e||r)(qn(g2))},r.\u0275cmp=eo({type:r,selectors:[["app-search"]],decls:9,vars:3,consts:[[1,"flex-parent-search"],[1,"flex-child-search"],[3,"classSearchButton","classClearButton","events"],["type","submit",3,"click"],["type","checkbox",3,"click"]],template:function(e,n){1&e&&(It(0,"div",0),It(1,"div",1),It(2,"ggc-search",2),Qr("events",function(o){return n.handleEvent(o)}),Mt(),Mt(),It(3,"div",1),It(4,"button",3),Qr("click",function(){return n.gotoStartLocationOnMap()}),jr(5,"start locatie"),Mt(),Mt(),It(6,"div",1),It(7,"button",4),Qr("click",function(){return n.toggleDemo()}),jr(8),Mt(),Mt(),Mt()),2&e&&(rn(2),kn("classSearchButton","fas fa-search")("classClearButton","fas fa-times-circle"),rn(6),bp(n.demotext))},directives:[TH],styles:[".flex-parent-search[_ngcontent-%COMP%]{display:flex}.flex-child-search[_ngcontent-%COMP%]{flex:1;margin:4px}"]}),r})();var V$=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),G$={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},q$={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]},Z$=function(r){function t(e){var n=r.call(this,e)||this;return n.boundHandleStyleImageChange_=n.handleStyleImageChange_.bind(n),n.dirty_=!1,n.renderedPixelToCoordinateTransform_=null,n.tmpTransform_=[1,0,0,1,0,0],n}return V$(t,r),t.prototype.prepareTile=function(e,n,i){var o,u=e.getState();return(2===u||3===u)&&(this.updateExecutorGroup_(e,n,i),this.tileImageNeedsRender_(e)&&(o=!0)),o},t.prototype.getTile=function(e,n,i,o){var u=o.pixelRatio,m=o.viewState,b=m.resolution,T=m.projection,F=this.getLayer(),V=F.getSource().getTile(e,n,i,u,T),H=o.viewHints,J=!(H[0]||H[1]);return(J||!V.wantedResolution)&&(V.wantedResolution=b),this.prepareTile(V,u,T)&&(J||Date.now()-o.time<8)&&"vector"!==F.getRenderMode()&&this.renderTileImage_(V,o),r.prototype.getTile.call(this,e,n,i,o)},t.prototype.isDrawableTile=function(e){var n=this.getLayer();return r.prototype.isDrawableTile.call(this,e)&&("vector"===n.getRenderMode()?Si(n)in e.executorGroups:e.hasContext(n))},t.prototype.getTileImage=function(e){return e.getImage(this.getLayer())},t.prototype.prepareFrame=function(e){var n=this.getLayer().getRevision();return this.renderedLayerRevision_!=n&&(this.renderedTiles.length=0),this.renderedLayerRevision_=n,r.prototype.prepareFrame.call(this,e)},t.prototype.updateExecutorGroup_=function(e,n,i){var o=this.getLayer(),u=o.getRevision(),m=o.getRenderOrder()||null,b=e.wantedResolution,T=e.getReplayState(o);if(T.dirty||T.renderedResolution!==b||T.renderedRevision!=u||T.renderedRenderOrder!=m){var F=o.getSource(),V=o.getDeclutter(),H=F.getTileGrid(),ne=F.getTileGridForProjection(i).getTileCoordExtent(e.wrappedTileCoord),we=F.getSourceTiles(n,i,e),Re=Si(o);delete e.hitDetectionImageData[Re],e.executorGroups[Re]=[],V&&(e.declutterExecutorGroups[Re]=[]);for(var qe=function(bt,dn){var Kt=we[bt];if(2!=Kt.getState())return"continue";var Bt=H.getTileCoordExtent(Kt.tileCoord),Dn=sg(ne,Bt),un=kf(Dn,o.getRenderBuffer()*b,Ne.tmpExtent),Fn=c_(Bt,Dn)?null:un;T.dirty=!1;var kr=new Dw(0,un,b,n),Jr=V?new Dw(0,Dn,b,n):void 0,Ur=RP(b,n),Mr=function(No){var ws,cr=No.getStyleFunction()||o.getStyleFunction();if(cr&&(ws=cr(No,b)),ws){var fl=this.renderFeature(No,Ur,ws,kr,Jr);this.dirty_=this.dirty_||fl,T.dirty=T.dirty||fl}},_n=Kt.getFeatures();m&&m!==T.renderedRenderOrder&&_n.sort(m);for(var Qi=0,go=_n.length;Qi<go;++Qi){var Co=_n[Qi];(!Fn||Cc(Fn,Co.getGeometry().getExtent()))&&Mr.call(Ne,Co)}var as=kr.finish(),En="vector"!==o.getRenderMode()&&V&&1===we.length?null:Dn,ma=new kw(En,b,n,F.getOverlaps(),as,o.getRenderBuffer());if(e.executorGroups[Re].push(ma),Jr){var Mi=new kw(null,b,n,F.getOverlaps(),Jr.finish(),o.getRenderBuffer());e.declutterExecutorGroups[Re].push(Mi)}},Ne=this,$e=0,tt=we.length;$e<tt;++$e)qe($e);T.renderedRevision=u,T.renderedRenderOrder=m,T.renderedResolution=b}},t.prototype.forEachFeatureAtCoordinate=function(e,n,i,o,u){var m=n.viewState.resolution,b=n.viewState.rotation;i=null==i?0:i;var T=this.getLayer(),V=T.getSource().getTileGridForProjection(n.viewState.projection),H=Hc([e]);kf(H,m*i,H);for(var Re,J={},ne=function(tt,bt,dn){var Kt=tt.getId();void 0===Kt&&(Kt=Si(tt));var vn=J[Kt];if(vn){if(!0!==vn&&dn<vn.distanceSq){if(0===dn)return J[Kt]=!0,u.splice(u.lastIndexOf(vn),1),o(tt,T,bt);vn.geometry=bt,vn.distanceSq=dn}}else{if(0===dn)return J[Kt]=!0,o(tt,T,bt);u.push(J[Kt]={feature:tt,layer:T,geometry:bt,distanceSq:dn,callback:o})}},we=this.renderedTiles,qe=function(tt,bt){var dn=we[tt];if(!Cc(V.getTileCoordExtent(dn.wrappedTileCoord),H))return"continue";var vn=Si(T),Bt=[dn.executorGroups[vn]],Dn=dn.declutterExecutorGroups[vn];Dn&&Bt.push(Dn),Bt.some(function(un){for(var Fn=un===Dn?n.declutterTree.all().map(function(Mr){return Mr.value}):null,kr=0,Jr=un.length;kr<Jr;++kr)if(Re=un[kr].forEachFeatureAtCoordinate(e,m,b,i,ne,Fn))return!0})},Ne=0,$e=we.length;!Re&&Ne<$e;++Ne)qe(Ne);return Re},t.prototype.getFeatures=function(e){return new Promise(function(n,i){for(var ne,o=this.getLayer(),u=Si(o),m=o.getSource(),b=this.renderedProjection,T=b.getExtent(),F=this.renderedResolution,V=m.getTileGridForProjection(b),H=$c(this.renderedPixelToCoordinateTransform_,e.slice()),J=V.getTileCoordForCoordAndResolution(H,F),we=0,Re=this.renderedTiles.length;we<Re;++we)if(J.toString()===this.renderedTiles[we].tileCoord.toString()){if(2===(ne=this.renderedTiles[we]).getState()){var qe=V.getTileCoordExtent(ne.tileCoord);m.getWrapX()&&b.canWrapX()&&!ag(T,qe)&&AS(H,b);break}ne=void 0}if(!ne||ne.loadingSourceTiles>0)n([]);else{var $e=lg(V.getTileCoordExtent(ne.wrappedTileCoord)),tt=[(H[0]-$e[0])/F,($e[1]-H[1])/F],bt=ne.getSourceTiles().reduce(function(Dn,un){return Dn.concat(un.getFeatures())},[]),dn=ne.hitDetectionImageData[u];if(!dn&&!this.animatingOrInteracting_){var Kt=Cp(V.getTileSize(V.getZForResolution(F))),vn=this.renderedRotation_;dn=DP(Kt,[this.getRenderTransform(V.getTileCoordCenter(ne.wrappedTileCoord),F,0,tf,Kt[0]*tf,Kt[1]*tf,0)],bt,o.getStyleFunction(),V.getTileCoordExtent(ne.wrappedTileCoord),ne.getReplayState(o).renderedResolution,vn),ne.hitDetectionImageData[u]=dn}n(kP(tt,bt,dn))}}.bind(this))},t.prototype.handleFontsChanged=function(){var e=this.getLayer();e.getVisible()&&void 0!==this.renderedLayerRevision_&&e.changed()},t.prototype.handleStyleImageChange_=function(e){this.renderIfReadyAndVisible()},t.prototype.renderDeclutter=function(e){var n=this.context,i=n.globalAlpha;n.globalAlpha=this.getLayer().getOpacity();for(var o=e.viewHints,u=!(o[0]||o[1]),m=this.renderedTiles,b=0,T=m.length;b<T;++b){var F=m[b],V=F.declutterExecutorGroups[Si(this.getLayer())];if(V)for(var H=V.length-1;H>=0;--H)V[H].execute(this.context,1,this.getTileRenderTransform(F,e),e.viewState.rotation,u,void 0,e.declutterTree)}n.globalAlpha=i},t.prototype.getTileRenderTransform=function(e,n){var i=n.pixelRatio,o=n.viewState,u=o.center,m=o.resolution,b=o.rotation,T=n.size,F=Math.round(T[0]*i),V=Math.round(T[1]*i),J=this.getLayer().getSource().getTileGridForProjection(n.viewState.projection),ne=e.tileCoord,we=J.getTileCoordExtent(e.wrappedTileCoord),Re=J.getTileCoordExtent(ne,this.tmpExtent)[0]-we[0];return gw(PS(this.inversePixelTransform.slice(),1/i,1/i),this.getRenderTransform(u,m,b,i,F,V,Re))},t.prototype.renderFrame=function(e,n){var i=e.viewHints,o=!(i[0]||i[1]);r.prototype.renderFrame.call(this,e,n),this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice(),this.renderedRotation_=e.viewState.rotation;var u=this.getLayer(),m=u.getRenderMode(),b=this.context,T=b.globalAlpha;b.globalAlpha=u.getOpacity();for(var F=q$[m],H=e.viewState.rotation,J=this.renderedTiles,ne=[],we=[],Re=J.length-1;Re>=0;--Re)for(var qe=J[Re],Ne=this.getTileRenderTransform(qe,e),$e=qe.executorGroups[Si(u)],tt=!1,bt=0,dn=$e.length;bt<dn;++bt){var Kt=$e[bt];if(Kt.hasExecutors(F)){var vn=qe.tileCoord[0],Bt=void 0;if(!tt&&(Bt=Kt.getClipCoords(Ne))){b.save();for(var Dn=0,un=ne.length;Dn<un;++Dn){var Fn=ne[Dn];vn<we[Dn]&&(b.beginPath(),b.moveTo(Bt[0],Bt[1]),b.lineTo(Bt[2],Bt[3]),b.lineTo(Bt[4],Bt[5]),b.lineTo(Bt[6],Bt[7]),b.moveTo(Fn[6],Fn[7]),b.lineTo(Fn[4],Fn[5]),b.lineTo(Fn[2],Fn[3]),b.lineTo(Fn[0],Fn[1]),b.clip())}}Kt.execute(b,1,Ne,H,o,F),!tt&&Bt&&(b.restore(),ne.push(Bt),we.push(vn),tt=!0)}}return b.globalAlpha=T,this.container},t.prototype.renderFeature=function(e,n,i,o,u){if(!i)return!1;var m=!1;if(Array.isArray(i))for(var b=0,T=i.length;b<T;++b)m=Rw(o,e,i[b],n,this.boundHandleStyleImageChange_,void 0,u)||m;else m=Rw(o,e,i,n,this.boundHandleStyleImageChange_,void 0,u);return m},t.prototype.tileImageNeedsRender_=function(e){var n=this.getLayer();if("vector"===n.getRenderMode())return!1;var i=e.getReplayState(n),o=n.getRevision();return i.renderedTileResolution!==e.wantedResolution||i.renderedTileRevision!==o},t.prototype.renderTileImage_=function(e,n){var i=this.getLayer(),o=e.getReplayState(i),u=i.getRevision(),m=e.executorGroups[Si(i)];o.renderedTileRevision=u;var b=e.wrappedTileCoord,T=b[0],F=i.getSource(),V=n.pixelRatio,J=n.viewState.projection,ne=F.getTileGridForProjection(J),we=ne.getResolution(e.tileCoord[0]),Re=n.pixelRatio/e.wantedResolution*we,qe=ne.getResolution(T),Ne=e.getContext(i);V=Math.round(Math.max(V,Re/V));var $e=F.getTilePixelSize(T,V,J);Ne.canvas.width=$e[0],Ne.canvas.height=$e[1];var tt=V/Re;if(1!==tt){var bt=Lk(this.tmpTransform_);PS(bt,tt,tt),Ne.setTransform.apply(Ne,bt)}var dn=ne.getTileCoordExtent(b,this.tmpExtent),Kt=Re/qe,vn=Lk(this.tmpTransform_);PS(vn,Kt,-Kt),function(r,t,e){gw(r,c1(kS,1,0,0,1,t,e))}(vn,-dn[0],-dn[3]);for(var Bt=0,Dn=m.length;Bt<Dn;++Bt)m[Bt].execute(Ne,tt,vn,0,!0,G$[i.getRenderMode()]);o.renderedTileResolution=e.wantedResolution},t}(JP);const H$=Z$;var W$=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),$$=function(r){function t(e){var n=this,i=e||{},o=$a({},i);delete o.preload,delete o.useInterimTilesOnError,n=r.call(this,o)||this,"image"===i.renderMode&&(console.warn('renderMode: "image" is deprecated. Option ignored.'),i.renderMode=void 0);var u=i.renderMode||"hybrid";return bo("hybrid"==u||"vector"==u,28),n.renderMode_=u,n.setPreload(i.preload?i.preload:0),n.setUseInterimTilesOnError(void 0===i.useInterimTilesOnError||i.useInterimTilesOnError),n}return W$(t,r),t.prototype.createRenderer=function(){return new H$(this)},t.prototype.getFeatures=function(e){return r.prototype.getFeatures.call(this,e)},t.prototype.getRenderMode=function(){return this.renderMode_},t.prototype.getPreload=function(){return this.get("preload")},t.prototype.getUseInterimTilesOnError=function(){return this.get("useInterimTilesOnError")},t.prototype.setPreload=function(e){this.set("preload",e)},t.prototype.setUseInterimTilesOnError=function(e){this.set("useInterimTilesOnError",e)},t}(xP);const vL=$$;var _L=[1,0,0,1,0,0],Z1=function(){function r(t,e,n,i,o){this.id_=o,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n,this.properties_=i}return r.prototype.get=function(t){return this.properties_[t]},r.prototype.getExtent=function(){return this.extent_||(this.extent_=this.type_===$t.POINT?V0(this.flatCoordinates_):QE(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_},r.prototype.getFlatInteriorPoint=function(){if(!this.flatInteriorPoints_){var t=wm(this.getExtent());this.flatInteriorPoints_=US(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_},r.prototype.getFlatInteriorPoints=function(){if(!this.flatInteriorPoints_){var t=qP(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=$k(this.flatCoordinates_,0,this.ends_,2,t)}return this.flatInteriorPoints_},r.prototype.getFlatMidpoint=function(){return this.flatMidpoints_||(this.flatMidpoints_=jw(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_},r.prototype.getFlatMidpoints=function(){if(!this.flatMidpoints_){this.flatMidpoints_=[];for(var t=this.flatCoordinates_,e=0,n=this.ends_,i=0,o=n.length;i<o;++i){var u=n[i],m=jw(t,e,u,2,.5);og(this.flatMidpoints_,m),e=u}}return this.flatMidpoints_},r.prototype.getId=function(){return this.id_},r.prototype.getOrientedFlatCoordinates=function(){return this.flatCoordinates_},r.prototype.getGeometry=function(){return this},r.prototype.getSimplifiedGeometry=function(t){return this},r.prototype.simplifyTransformed=function(t,e){return this},r.prototype.getProperties=function(){return this.properties_},r.prototype.getStride=function(){return 2},r.prototype.getStyleFunction=function(){},r.prototype.getType=function(){return this.type_},r.prototype.transform=function(t){var e=(t=xa(t)).getExtent(),n=t.getWorldExtent();if(e&&n){var i=mh(n)/mh(e);ef(_L,n[0],n[3],i,-i,0,0,0),Yy(this.flatCoordinates_,0,this.flatCoordinates_.length,2,_L,this.flatCoordinates_)}},r.prototype.getEnds=function(){return this.ends_},r}();Z1.prototype.getEndss=Z1.prototype.getEnds,Z1.prototype.getFlatCoordinates=Z1.prototype.getOrientedFlatCoordinates;const y2=Z1;var xL=Ht(728),dv=Ht(630);function v2(r){return r*Math.PI/180}const X$=function(){const r=[];for(let t=78271.51696402048;r.length<=24;t/=2)r.push(t);return r}();function bL(r,t){if("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas)return new OffscreenCanvas(r,t);{const e=document.createElement("canvas");return e.width=r,e.height=t,e}}const K$=Array(256).join("\u200a");function wL(r,t){if(t>=.05){let e="";const n=r.split("\n"),i=K$.slice(0,Math.round(t/.1));for(let o=0,u=n.length;o<u;++o)o>0&&(e+="\n"),e+=n[o].split("").join(i);return e}return r}let _2;function CL(){return _2||(_2=bL(1,1).getContext("2d")),_2}function z_(r,t){return CL().measureText(r).width+(r.length-1)*t}let x2={};function EL(r,t,e,n){if(-1!==r.indexOf("\n")){const u=r.split("\n"),m=[];for(let b=0,T=u.length;b<T;++b)m.push(EL(u[b],t,e,n));return m.join("\n")}const i=e+","+t+","+r+","+n;let o=x2[i];if(!o){const u=r.split(" ");if(u.length>1){const m=CL();m.font=t;const T=m.measureText("M").width*e;let F="";const V=[];for(let H=0,J=u.length;H<J;++H){const ne=u[H],we=F+(F?" ":"")+ne;z_(we,n)<=T?F=we:(F&&V.push(F),F=ne)}F&&V.push(F);for(let H=0,J=V.length;H<J&&J>1;++H){const ne=V[H];if(z_(ne,n)<.35*T){const we=H>0?z_(V[H-1],n):1/0,Re=H<J-1?z_(V[H+1],n):1/0;V.splice(H,1),J-=1,we<Re?(V[H-1]+=" "+ne,H-=1):V[H]=ne+" "+V[H]}}for(let H=0,J=V.length-1;H<J;++H){const ne=V[H],we=V[H+1];if(z_(ne,n)>.7*T&&z_(we,n)<.6*T){const Re=ne.split(" "),qe=Re.pop();z_(qe,n)<.2*T&&(V[H]=Re.join(" "),V[H+1]=qe+" "+we),J-=1}}o=V.join("\n")}else o=r;o=wL(o,n),x2[i]=o}return o}YS&&Zo(YS,"clear",function(){x2={}});const J$=dv.ZI.isFunction,Q$=dv.ZI.convertFunction,eX=dv.th.isExpression,tX=dv.th.createPropertyExpression,nX={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},rX={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},b2={},CC={zoom:0};let EC,w2;function Mo(r,t,e,n,i,o){const u=r.id;o||(o={},console.warn("No functionCache provided to getValue()")),o[u]||(o[u]={});const m=o[u];if(!m[e]){let b=(r[t]||b2)[e];const T=dv.pA[`${t}_${r.type}`][e];void 0===b&&(b=T.default);let F=eX(b);if(!F&&J$(b)&&(b=Q$(b,T),F=!0),F){const V=function(r,t){const e=tX(r,t);if("error"===e.result)throw new Error(e.value.map(n=>`${n.key}: ${n.message}`).join(", "));return e.value}(b,T);m[e]=V.evaluate.bind(V)}else"color"==T.type&&(b=dv.Il.parse(b)),m[e]=function(){return b}}return CC.zoom=n,m[e](CC,i)}function oX(r,t,e,n,i){return i||console.warn("No filterCache provided to evaluateFilter()"),r in i||(i[r]=(0,dv.TE)(t).filter),CC.zoom=n,i[r](CC,e)}function N_(r,t){if(r){if(0===r.a||0===t)return;const e=r.a;return t=void 0===t?1:t,0===e?"transparent":"rgba("+Math.round(255*r.r/e)+","+Math.round(255*r.g/e)+","+Math.round(255*r.b/e)+","+e*t+")"}return r}const aX=/^([^]*)\{(.*)\}([^]*)$/;function C2(r,t){let e;do{e=r.match(aX),e&&(r=e[1]+(t[e[2]]||"")+e[3])}while(e);return r}var lX=Ht(249);const uX=/font-family: ?([^;]*);/,cX=/("|')/g;let SC;function hX(r){if(!SC){SC={};const t=document.styleSheets;for(let e=0,n=t.length;e<n;++e){const i=t[e];try{const o=i.rules||i.cssRules;if(o)for(let u=0,m=o.length;u<m;++u){const b=o[u];if(5==b.type){const T=b.cssText.match(uX);SC[T[1].replace(cX,"")]=!0}}}catch(o){}}}return r in SC}const ML={},pX=lX.getNames();function dX(r){const t=r.toString();if(t in ML)return r;const e=r.map(function(n){const i=xL(n,1).split(" ");return[i.slice(3).join(" ").replace(/"/g,""),i[1]+i[0]]});for(let n=0,i=e.length;n<i;++n){const o=e[n],u=o[0];if(!hX(u)&&-1!==pX.indexOf(u)){const m="https://fonts.googleapis.com/css?family="+u.replace(/ /g,"+")+":"+o[1];if(!document.querySelector('link[href="'+m+'"]')){const b=document.createElement("link");b.href=m,b.rel="stylesheet",document.head.appendChild(b)}}}return ML[t]=!0,r}const AL=/^(.*)(\?.*)$/;function E2(r,t,e){const n=(r=function(r,t){return t&&0===r.indexOf(".")&&(r=t+r),r}(r,t)).match(AL);return n?n[1]+e+(n.length>2?n[2]:""):r+e}function DL(r,t,e,n,i){return new Promise(function(o,u){if("object"!=typeof t&&(t=JSON.parse(t)),8!=t.version)return u(new Error("glStyle version 8 required."));if(!(r instanceof I_||r instanceof vL))return u(new Error("Can only apply to VectorLayer or VectorTileLayer"));let m,b,T,F;function V(){F||t.sprite&&!b?F?(r.setStyle(F),o()):u(new Error("Something went wrong trying to apply style.")):(F=function(r,t,e,n=X$,i,o,u){if("string"==typeof t&&(t=JSON.parse(t)),8!=t.version)throw new Error("glStyle version 8 required.");let m,b;if(o)if("undefined"!=typeof Image){const bt=new Image;bt.crossOrigin="anonymous",bt.onload=function(){m=bt,b=[bt.width,bt.height],r.changed(),bt.onload=null},bt.src=o}else if("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){const bt=self;bt.postMessage({action:"loadImage",src:o}),bt.addEventListener("message",function(Kt){"imageLoaded"===Kt.data.action&&Kt.data.src===o&&(m=Kt.data.image,b=[m.width,m.height])})}const T=(0,dv.eG)(t.layers),F={},V=[],H={},J={},ne={},we={};let Re;for(let bt=0,dn=T.length;bt<dn;++bt){const Kt=T[bt],vn=Kt.id;if("string"==typeof e&&Kt.source==e||-1!==e.indexOf(vn)){const Bt=Kt["source-layer"];if(!Re){Re=Kt.source;const un=t.sources[Re];if(!un)throw new Error(`Source "${Re}" is not defined`);const Fn=un.type;if("vector"!==Fn&&"geojson"!==Fn)throw new Error(`Source "${Re}" is not of type "vector" or "geojson", but "${Fn}"`)}let Dn=F[Bt];Dn||(Dn=[],F[Bt]=Dn),Dn.push({layer:Kt,index:bt}),V.push(vn)}}const qe=new Ku,Ne=new Bh,$e=[],tt=function(bt,dn){const Kt=bt.getProperties(),vn=F[Kt.layer];if(!vn)return;let Bt=n.indexOf(dn);-1==Bt&&(Bt=function(r,t){let e=0;const n=t.length;for(;e<n;++e)if(t[e]<r&&e+1<n){const o=t[e]/t[e+1];return e+Math.log(t[e]/r)/Math.log(o)}return n-1}(dn,n));const Dn=nX[bt.getGeometry().getType()],un={properties:Kt,type:Dn};let kr,Fn=-1;for(let Jr=0,Ur=vn.length;Jr<Ur;++Jr){const Mr=vn[Jr],_n=Mr.layer,Qi=_n.id,go=_n.layout||b2,Co=_n.paint||b2;if("none"===go.visibility||"minzoom"in _n&&Bt<_n.minzoom||"maxzoom"in _n&&Bt>=_n.maxzoom)continue;const as=_n.filter;if(!as||oX(Qi,as,un,Bt,we)){let En,ma,Mi,No,ws,cr;kr=_n;const fl=Mr.index;if(3==Dn&&("fill"==_n.type||"fill-extrusion"==_n.type))if(ma=Mo(_n,"paint",_n.type+"-opacity",Bt,un,ne),_n.type+"-pattern"in Co){const Fs=Mo(_n,"paint",_n.type+"-pattern",Bt,un,ne);if(Fs){const Ju="string"==typeof Fs?C2(Fs,Kt):Fs.toString();if(m&&i&&i[Ju]){++Fn,cr=$e[Fn],(!cr||!cr.getFill()||cr.getStroke()||cr.getText())&&(cr=new dl({fill:new Bh}),$e[Fn]=cr),Mi=cr.getFill(),cr.setZIndex(fl);const jh=Ju+"."+ma;let Cs=J[jh];if(!Cs){const Aa=i[Ju],wd=bL(Aa.width,Aa.height),Pl=wd.getContext("2d");Pl.globalAlpha=ma,Pl.drawImage(m,Aa.x,Aa.y,Aa.width,Aa.height,0,0,Aa.width,Aa.height),Cs=Pl.createPattern(wd,"repeat"),J[jh]=Cs}Mi.setColor(Cs)}}}else En=N_(Mo(_n,"paint",_n.type+"-color",Bt,un,ne),ma),En&&(_n.type+"-outline-color"in Co&&(ws=N_(Mo(_n,"paint",_n.type+"-outline-color",Bt,un,ne),ma)),ws||(ws=En),++Fn,cr=$e[Fn],(!cr||!(cr.getFill()&&cr.getStroke())||cr.getText())&&(cr=new dl({fill:new Bh,stroke:new Ku}),$e[Fn]=cr),Mi=cr.getFill(),Mi.setColor(En),No=cr.getStroke(),No.setColor(ws),No.setWidth(.5),cr.setZIndex(fl));if(1!=Dn&&"line"==_n.type){En=!("line-pattern"in Co)&&"line-color"in Co?N_(Mo(_n,"paint","line-color",Bt,un,ne),Mo(_n,"paint","line-opacity",Bt,un,ne)):void 0;const Fs=Mo(_n,"paint","line-width",Bt,un,ne);En&&Fs>0&&(++Fn,cr=$e[Fn],(!cr||!cr.getStroke()||cr.getFill()||cr.getText())&&(cr=new dl({stroke:new Ku}),$e[Fn]=cr),No=cr.getStroke(),No.setLineCap(Mo(_n,"layout","line-cap",Bt,un,ne)),No.setLineJoin(Mo(_n,"layout","line-join",Bt,un,ne)),No.setMiterLimit(Mo(_n,"layout","line-miter-limit",Bt,un,ne)),No.setColor(En),No.setWidth(Fs),No.setLineDash(Co["line-dasharray"]?Mo(_n,"paint","line-dasharray",Bt,un,ne).map(function(Ju){return Ju*Fs}):null),cr.setZIndex(fl))}let py,gh,zf,Mp,Yc=!1,ml=null,af=0;if((1==Dn||2==Dn)&&"icon-image"in go){const Fs=Mo(_n,"layout","icon-image",Bt,un,ne);if(Fs){let Ju;if(py="string"==typeof Fs?C2(Fs,Kt):Fs.toString(),m&&i&&i[py]){const jh=Mo(_n,"layout","icon-rotation-alignment",Bt,un,ne);if(2==Dn){const Cs=bt.getGeometry();if(Cs.getFlatMidpoint||Cs.getFlatMidpoints){const Aa=Cs.getExtent();if(Math.sqrt(Math.max(Math.pow((Aa[2]-Aa[0])/dn,2),Math.pow((Aa[3]-Aa[1])/dn,2)))>150){const Pl="MultiLineString"===Cs.getType()?Cs.getFlatMidpoints():Cs.getFlatMidpoint();if(w2||(EC=[NaN,NaN],w2=new y2("Point",EC,[],{},null)),Ju=w2,EC[0]=Pl[0],EC[1]=Pl[1],"line"===Mo(_n,"layout","symbol-placement",Bt,un,ne)&&"map"===jh){const Ap=Cs.getStride(),Bf=Cs.getFlatCoordinates();for(let yh=0,bg=Bf.length-Ap;yh<bg;yh+=Ap){const Jp=Bf[yh],lp=Bf[yh+1],Qp=Bf[yh+Ap],Cd=Bf[yh+Ap+1],Dp=Math.min(Jp,Qp),vh=Math.min(lp,Cd),ed=Math.max(Jp,Qp),td=Math.max(lp,Cd);if(Pl[0]>=Dp&&Pl[0]<=ed&&Pl[1]>=vh&&Pl[1]<=td){af=Math.atan2(lp-Cd,Qp-Jp);break}}}}}}if(2!==Dn||Ju){const Cs=Mo(_n,"layout","icon-size",Bt,un,ne),Aa=void 0!==Co["icon-color"]?Mo(_n,"paint","icon-color",Bt,un,ne):null;if(!Aa||0!==Aa.a){let wd=py+"."+Cs;if(null!==Aa&&(wd+="."+Aa),gh=H[wd],!gh){const Pl=i[py];gh=new C1({color:Aa?[255*Aa.r,255*Aa.g,255*Aa.b,Aa.a]:void 0,img:m,imgSize:b,size:[Pl.width,Pl.height],offset:[Pl.x,Pl.y],rotateWithView:"map"===jh,scale:Cs/Pl.pixelRatio}),H[wd]=gh}}gh&&(++Fn,cr=$e[Fn],(!cr||!cr.getImage()||cr.getFill()||cr.getStroke())&&(cr=new dl,$e[Fn]=cr),cr.setGeometry(Ju),gh.setRotation(af+v2(Mo(_n,"layout","icon-rotate",Bt,un,ne))),gh.setOpacity(Mo(_n,"paint","icon-opacity",Bt,un,ne)),gh.setAnchor(rX[Mo(_n,"layout","icon-anchor",Bt,un,ne)]),cr.setImage(gh),ml=cr.getText(),cr.setText(void 0),cr.setZIndex(fl),Yc=!0,zf=!1)}else zf=!0}}}if(1==Dn&&"circle-radius"in Co){++Fn,cr=$e[Fn],(!cr||!cr.getImage()||cr.getFill()||cr.getStroke())&&(cr=new dl,$e[Fn]=cr);const Fs=Mo(_n,"paint","circle-radius",Bt,un,ne),Ju=N_(Mo(_n,"paint","circle-stroke-color",Bt,un,ne),Mo(_n,"paint","circle-stroke-opacity",Bt,un,ne)),jh=N_(Mo(_n,"paint","circle-color",Bt,un,ne),Mo(_n,"paint","circle-opacity",Bt,un,ne)),Cs=Mo(_n,"paint","circle-stroke-width",Bt,un,ne),Aa=Fs+"."+Ju+"."+jh+"."+Cs;gh=H[Aa],gh||(gh=new S_({radius:Fs,stroke:Ju&&Cs>0?new Ku({width:Cs,color:Ju}):void 0,fill:jh?new Bh({color:jh}):void 0}),H[Aa]=gh),cr.setImage(gh),ml=cr.getText(),cr.setText(void 0),cr.setGeometry(void 0),cr.setZIndex(fl),Yc=!0}if("text-field"in go&&(Mp=C2(Mo(_n,"layout","text-field",Bt,un,ne).toString(),Kt).trim(),ma=Mo(_n,"paint","text-opacity",Bt,un,ne)),Mp&&ma&&!zf){Yc||(++Fn,cr=$e[Fn],(!cr||!cr.getText()||cr.getFill()||cr.getStroke())&&(cr=new dl,$e[Fn]=cr),cr.setImage(void 0),cr.setGeometry(void 0)),cr.getText()||cr.setText(ml||new Yw({padding:[2,2,2,2]})),ml=cr.getText();const Fs=Math.round(Mo(_n,"layout","text-size",Bt,un,ne)),Ju=Mo(_n,"layout","text-font",Bt,un,ne),jh=Mo(_n,"layout","text-line-height",Bt,un,ne),Cs=xL(u?u(Ju):Ju,Fs,jh),Aa=go["text-transform"];"uppercase"==Aa?Mp=Mp.toUpperCase():"lowercase"==Aa&&(Mp=Mp.toLowerCase());const wd=Mo(_n,"layout","text-max-width",Bt,un,ne),Pl=Mo(_n,"layout","text-letter-spacing",Bt,un,ne),Nf=2==Dn?wL(Mp,Pl):EL(Mp,Cs,wd,Pl);ml.setText(Nf),ml.setFont(Cs),ml.setRotation(v2(Mo(_n,"layout","text-rotate",Bt,un,ne)));const Ap=Mo(_n,"layout","text-anchor",Bt,un,ne),Bf=Yc||1==Dn?"point":Mo(_n,"layout","symbol-placement",Bt,un,ne);ml.setPlacement(Bf);let yh=Mo(_n,"paint","text-halo-width",Bt,un,ne);const bg=Mo(_n,"layout","text-offset",Bt,un,ne),Jp=Mo(_n,"paint","text-translate",Bt,un,ne);let lp=0,Qp=0;if("point"==Bf){let td="center";-1!==Ap.indexOf("left")?(td="left",Qp=yh):-1!==Ap.indexOf("right")&&(td="right",Qp=-yh),ml.setTextAlign(td);const yx=Mo(_n,"layout","text-rotation-alignment",Bt,un,ne);ml.setRotateWithView("map"==yx)}else ml.setMaxAngle(v2(Mo(_n,"layout","text-max-angle",Bt,un,ne))*Mp.length/Nf.length),ml.setTextAlign(),ml.setRotateWithView(!1);let Cd="middle";0==Ap.indexOf("bottom")?(Cd="bottom",lp=-yh-.5*(jh-1)*Fs):0==Ap.indexOf("top")&&(Cd="top",lp=yh+.5*(jh-1)*Fs),ml.setTextBaseline(Cd),ml.setOffsetX(bg[0]*Fs+Qp+Jp[0]),ml.setOffsetY(bg[1]*Fs+lp+Jp[1]),Ne.setColor(N_(Mo(_n,"paint","text-color",Bt,un,ne),ma)),ml.setFill(Ne);const Dp=N_(Mo(_n,"paint","text-halo-color",Bt,un,ne),ma);if(Dp){qe.setColor(Dp),yh*=2;const td=.5*Fs;qe.setWidth(yh<=td?yh:td),ml.setStroke(qe)}else ml.setStroke(void 0);const vh=Mo(_n,"layout","text-padding",Bt,un,ne),ed=ml.getPadding();vh!==ed[0]&&(ed[0]=vh,ed[1]=vh,ed[2]=vh,ed[3]=vh),cr.setZIndex(fl)}}}return Fn>-1?($e.length=Fn+1,$e):void 0};return r.setStyle(tt),r.set("mapbox-source",Re),r.set("mapbox-layers",V),tt}(r,t,e,i,b,T,dX),r.getStyle()?o():u(new Error(`Nothing to show for source [${e}]`)))}if(t.sprite){m=window.devicePixelRatio>=1.5?.5:1;const H=.5==m?"@2x":"";let J=E2(t.sprite,n,H+".json");fetch(J,{credentials:"same-origin"}).then(function(ne){return ne.ok||""===H?ne:(J=E2(t.sprite,n,".json"),fetch(J,{credentials:"same-origin"}))}).then(function(ne){if(ne.ok)return ne.json();u(new Error(`Problem fetching sprite from ${J}: ${ne.statusText}`))}).then(function(ne){if(void 0===ne)return u(new Error("No sprites found."));b=ne,T=E2(t.sprite,n,H+".png"),V()}).catch(function(ne){u(new Error(`Sprites cannot be loaded: ${J}: ${ne.message}`))})}else V()})}new Gw;var xX=Ht(697),bX=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),wX=function(r){function t(e){var n=r.call(this)||this,i=e||{};return n.dataProjection=new h_({code:"",units:Kd.TILE_PIXELS}),n.featureClass_=i.featureClass?i.featureClass:y2,n.geometryName_=i.geometryName,n.layerName_=i.layerName?i.layerName:"layer",n.layers_=i.layers?i.layers:null,n.idProperty_=i.idProperty,n.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"],n}return bX(t,r),t.prototype.readRawGeometry_=function(e,n,i,o){e.pos=n.geometry;for(var u=e.readVarint()+e.pos,m=1,b=0,T=0,F=0,V=0,H=0;e.pos<u;){if(!b){var J=e.readVarint();m=7&J,b=J>>3}b--,1===m||2===m?(T+=e.readSVarint(),F+=e.readSVarint(),1===m&&V>H&&(o.push(V),H=V),i.push(T,F),V+=2):7===m?V>H&&(i.push(i[H],i[H+1]),V+=2):bo(!1,59)}V>H&&(o.push(V),H=V)},t.prototype.createFeature_=function(e,n,i){var o=n.type;if(0===o)return null;var u,b,m=n.properties;this.idProperty_?(b=m[this.idProperty_],delete m[this.idProperty_]):b=n.id,m[this.layerName_]=n.layer.name;var T=[],F=[];this.readRawGeometry_(e,n,T,F);var V=function(r,t){var e;return 1===r?e=1===t?$t.POINT:$t.MULTI_POINT:2===r?e=1===t?$t.LINE_STRING:$t.MULTI_LINE_STRING:3===r&&(e=$t.POLYGON),e}(o,F.length);if(this.featureClass_===y2)(u=new this.featureClass_(V,T,F,m,b)).transform(i.dataProjection);else{var H=void 0;if(V==$t.POLYGON){for(var J=[],ne=0,we=0,Re=0,qe=F.length;Re<qe;++Re){var Ne=F[Re];if(VS(T,ne,Ne,2)){if(0===J.length)continue;J[J.length-1].push(F[we])}else J.push(F.slice(we,Re+1));we=Re+1,ne=Ne}H=J.length>1?new Vw(T,"XY",J):new Tm(T,"XY",F)}else H=V===$t.POINT?new Kp(T,"XY"):V===$t.LINE_STRING?new Lf(T,"XY"):V===$t.POLYGON?new Tm(T,"XY",F):V===$t.MULTI_POINT?new I1(T,"XY"):V===$t.MULTI_LINE_STRING?new Uw(T,"XY",F):null;u=new(0,this.featureClass_),this.geometryName_&&u.setGeometryName(this.geometryName_);var tt=T1(H,!1,i);u.setGeometry(tt),u.setId(b),u.setProperties(m,!0)}return u},t.prototype.getType=function(){return"arraybuffer"},t.prototype.readFeatures=function(e,n){var i=this.layers_,o=this.adaptOptions(n),u=xa(o.dataProjection);u.setWorldExtent(o.extent),o.dataProjection=u;var m=new xX(e),b=m.readFields(CX,{}),T=[];for(var F in b)if(!i||-1!=i.indexOf(F)){var V=b[F];u.setExtent(V?[0,0,V.extent,V.extent]:null);for(var J=0,ne=V.length;J<ne;++J){var we=TX(m,V,J);T.push(this.createFeature_(m,we,o))}}return T},t.prototype.readProjection=function(e){return this.dataProjection},t.prototype.setLayers=function(e){this.layers_=e},t}(fT);function CX(r,t,e){if(3===r){var n={keys:[],values:[],features:[]},i=e.readVarint()+e.pos;e.readFields(EX,n,i),n.length=n.features.length,n.length&&(t[n.name]=n)}}function EX(r,t,e){if(15===r)t.version=e.readVarint();else if(1===r)t.name=e.readString();else if(5===r)t.extent=e.readVarint();else if(2===r)t.features.push(e.pos);else if(3===r)t.keys.push(e.readString());else if(4===r){for(var n=null,i=e.readVarint()+e.pos;e.pos<i;)n=1==(r=e.readVarint()>>3)?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null;t.values.push(n)}}function SX(r,t,e){if(1==r)t.id=e.readVarint();else if(2==r)for(var n=e.readVarint()+e.pos;e.pos<n;){var i=t.layer.keys[e.readVarint()],o=t.layer.values[e.readVarint()];t.properties[i]=o}else 3==r?t.type=e.readVarint():4==r&&(t.geometry=e.pos)}function TX(r,t,e){r.pos=t.features[e];var n=r.readVarint()+r.pos,i={layer:t,type:0,properties:{}};return r.readFields(SX,i,n),i}const MX=wX;Ht(986);var AX=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),DX=function(r){function t(e,n,i,o,u,m){var b=r.call(this,e,n,m)||this;return b.extent=null,b.format_=o,b.features_=null,b.projection=null,b.tileLoadFunction_=u,b.url_=i,b.key=i,b}return AX(t,r),t.prototype.getFormat=function(){return this.format_},t.prototype.getFeatures=function(){return this.features_},t.prototype.load=function(){0==this.state&&(this.setState(1),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))},t.prototype.onLoad=function(e,n){this.setFeatures(e)},t.prototype.onError=function(){this.setState(3)},t.prototype.setFeatures=function(e){this.features_=e,this.setState(2)},t.prototype.setLoader=function(e){this.loader_=e},t}(qw);const kX=DX;var PX=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),zL=[],RX=function(r){function t(e,n,i,o){var u=r.call(this,e,n,{transition:0})||this;return u.context_={},u.executorGroups={},u.declutterExecutorGroups={},u.loadingSourceTiles=0,u.hitDetectionImageData={},u.replayState_={},u.sourceTiles=[],u.errorTileKeys={},u.getSourceTiles=o.bind(void 0,u),u.wrappedTileCoord=i,u}return PX(t,r),t.prototype.getContext=function(e){var n=Si(e);return n in this.context_||(this.context_[n]=vd(1,1,zL)),this.context_[n]},t.prototype.hasContext=function(e){return Si(e)in this.context_},t.prototype.getImage=function(e){return this.hasContext(e)?this.getContext(e).canvas:null},t.prototype.getReplayState=function(e){var n=Si(e);return n in this.replayState_||(this.replayState_[n]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[n]},t.prototype.load=function(){this.getSourceTiles()},t.prototype.release=function(){for(var e in this.context_)zL.push(this.context_[e].canvas),delete this.context_[e];r.prototype.release.call(this)},t}(qw);const OX=RX;var LX=function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),FX=function(r){function t(e){var n=this,i=e.projection||"EPSG:3857",o=e.extent||gS(i),u=e.tileGrid||function(r){var t=r||{},e=t.extent||xa("EPSG:3857").getExtent(),n={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:hk(e,t.maxZoom,t.tileSize,t.maxResolution)};return new dw(n)}({extent:o,maxResolution:e.maxResolution,maxZoom:void 0!==e.maxZoom?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});return(n=r.call(this,{attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,opaque:!1,projection:i,state:e.state,tileGrid:u,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:NX,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:void 0===e.zDirection?1:e.zDirection})||this).format_=e.format?e.format:null,n.sourceTileCache=new fS(n.tileCache.highWaterMark),n.overlaps_=null==e.overlaps||e.overlaps,n.tileClass=e.tileClass?e.tileClass:kX,n.tileGrids_={},n}return LX(t,r),t.prototype.getFeaturesInExtent=function(e){var n=[],i=this.tileCache;if(0===i.getCount())return n;var o=rk(i.peekFirstKey())[0],u=this.tileGrid;return i.forEach(function(m){if(m.tileCoord[0]===o&&2===m.getState())for(var b=m.getSourceTiles(),T=0,F=b.length;T<F;++T){var V=b[T];if(Cc(e,u.getTileCoordExtent(V.tileCoord))){var J=V.getFeatures();if(J)for(var ne=0,we=J.length;ne<we;++ne){var Re=J[ne],qe=Re.getGeometry();Cc(e,qe.getExtent())&&n.push(Re)}}}}),n},t.prototype.getOverlaps=function(){return this.overlaps_},t.prototype.clear=function(){this.tileCache.clear(),this.sourceTileCache.clear()},t.prototype.expireCache=function(e,n){var i=this.getTileCacheForProjection(e),o=Object.keys(n).reduce(function(u,m){var b=function(r){var t=r.substring(r.lastIndexOf("/")+1,r.length).split(",").map(Number);return X0(t[0],t[1],t[2])}(m);if(i.containsKey(b))for(var T=i.get(b).sourceTiles,F=0,V=T.length;F<V;++F)u[T[F].getKey()]=!0;return u},{});r.prototype.expireCache.call(this,e,n),this.sourceTileCache.expireCache(o)},t.prototype.getSourceTiles=function(e,n,i){var o=this;if(0===i.getState()){i.setState(1);var u=i.wrappedTileCoord,m=this.getTileGridForProjection(n),b=m.getTileCoordExtent(u),F=m.getResolution(u[0]);kf(b,-F,b);var V=this.tileGrid,H=V.getExtent();H&&sg(b,H,b);var J=V.getZForResolution(F,1);V.forEachTileCoord(b,J,function(ne){var we=o.tileUrlFunction(ne,e,n),Re=o.sourceTileCache.containsKey(we)?o.sourceTileCache.get(we):new o.tileClass(ne,we?0:4,we,o.format_,o.tileLoadFunction);i.sourceTiles.push(Re);var qe=Re.getState();if(qe<2){var Ne=function($e){o.handleTileChange($e);var tt=Re.getState();if(2===tt||3===tt){var bt=Re.getKey();bt in i.errorTileKeys?2===Re.getState()&&delete i.errorTileKeys[bt]:i.loadingSourceTiles--,3===tt?i.errorTileKeys[bt]=!0:Re.removeEventListener("change",Ne),0===i.loadingSourceTiles&&i.setState(s_(i.errorTileKeys)?2:3)}};Re.addEventListener("change",Ne),i.loadingSourceTiles++}0===qe&&(Re.extent=V.getTileCoordExtent(ne),Re.projection=n,Re.resolution=V.getResolution(ne[0]),o.sourceTileCache.set(we,Re),Re.load())}),i.loadingSourceTiles||i.setState(i.sourceTiles.some(function(ne){return 3===ne.getState()})?3:2)}return i.sourceTiles},t.prototype.getTile=function(e,n,i,o,u){var T,m=X0(e,n,i),b=this.getKey();if(this.tileCache.containsKey(m)&&(T=this.tileCache.get(m)).key===b)return T;var F=[e,n,i],V=this.getTileCoordForTileUrlFunction(F,u),H=this.getTileGrid().getExtent(),J=this.getTileGridForProjection(u);if(V&&H){var ne=J.getTileCoordExtent(V);kf(ne,-J.getResolution(e),ne),Cc(H,ne)||(V=null)}var we=!0;if(null!==V){var Re=this.tileGrid,qe=J.getResolution(e),Ne=Re.getZForResolution(qe,1),$e=J.getTileCoordExtent(V);kf($e,-qe,$e),Re.forEachTileCoord($e,Ne,function(bt){we=we&&!this.tileUrlFunction(bt,o,u)}.bind(this))}var tt=new OX(F,we?4:0,V,this.getSourceTiles.bind(this,o,u));return tt.key=b,T?(tt.interimTile=T,tt.refreshInterimChain(),this.tileCache.replace(m,tt)):this.tileCache.set(m,tt),tt},t.prototype.getTileGridForProjection=function(e){var n=e.getCode(),i=this.tileGrids_[n];if(!i){var o=this.tileGrid;i=pk(e,void 0,o?o.getTileSize(o.getMinZoom()):void 0),this.tileGrids_[n]=i}return i},t.prototype.getTilePixelRatio=function(e){return e},t.prototype.getTilePixelSize=function(e,n,i){var u=Cp(this.getTileGridForProjection(i).getTileSize(e),this.tmpSize);return[Math.round(u[0]*n),Math.round(u[1]*n)]},t.prototype.updateCacheSize=function(e,n){r.prototype.updateCacheSize.call(this,2*e,n),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(n).highWaterMark},t}($P);const zX=FX;function NX(r,t){r.setLoader(function(e,n,i){_k(t,r.getFormat(),e,n,i,r.onLoad.bind(r),r.onError.bind(r))})}class H1{constructor(t,e,n=""){if(this.type="",this._rbgString="",this._show=!0,this.legendfeature=e,this.type=this.legendfeature.type_,this.label=t,""===n)this.r=Math.round(255*Math.random()),this.g=Math.round(255*Math.random()),this.b=Math.round(255*Math.random()),this.a=1;else{const i=o=>{let u=0;for(let m=0;m<o.length;m++)u+=(m+1)*o.codePointAt(m)/256;return u%1};this.r=Math.round(255*i(n)),this.g=Math.round(255*i(n)),this.b=Math.round(255*i(n)),this.a=1}this._rbgString=this.makerbgString()}get rbgString(){return this._rbgString}set rbgString(t){var e=this.parse_rgb_string(t);this.r=e[0],this.g=e[1],this.b=e[2],this.a=4===e.length?e[3]:1,this._rbgString=this.makerbgString()}setRbg(t,e,n){this.r=t,this.b=e,this.g=n}get show(){return this._show}set show(t){this._show=t,this.a=this._show?1:0}parse_rgb_string(t){return t.replace(/[^\d,]/g,"").split(",")}backgroundRbgString(){return{"background-color":`rgba(${this.r}, ${this.g}, ${this.b}, ${this.a})`}}makerbgString(){return`rgba(${this.r}, ${this.g}, ${this.b}, ${this.a})`}style(t){return new dl({fill:new Bh({color:`rgba(${this.r}, ${this.g}, ${this.b}, ${this.a})`}),stroke:new Ku({color:`rgb(${this.r}, ${this.g}, ${this.b}, ${this.a})`}),text:new Yw({font:"15px Calibri,sans-serif",text:`${t.text}`,rotation:t.rotation,fill:new Bh({color:`rgb(${this.r}, ${this.g}, ${this.b}, ${this.a})`}),stroke:new Ku({color:`rgb(${this.r}, ${this.g}, ${this.b}, ${this.a})`,width:2})})})}}function jX(r,t){if(1&r&&(It(0,"tr"),It(1,"td"),jr(2),Mt(),It(3,"td"),jr(4),Mt(),Mt()),2&r){const e=t.$implicit;rn(2),bp(e.title),rn(2),bp(e.value)}}function UX(r,t){if(1&r&&(It(0,"div"),It(1,"table",6),It(2,"caption",7),jr(3,"Object Informatie:"),Mt(),It(4,"thead"),It(5,"th",8),jr(6,"Veld"),Mt(),It(7,"th",9),jr(8,"Waarde"),Mt(),Mt(),It(9,"tbody"),It(10,"tr"),It(11,"td"),jr(12,"Kleur"),Mt(),Hi(13,"td",10),Mt(),Ii(14,jX,5,2,"tr",11),Mt(),Mt(),Mt()),2&r){const e=ir(2);rn(13),kn("ngStyle",e.selectedFillStyle()),rn(1),kn("ngForOf",e.selectedFeatureProperties())}}function VX(r,t){if(1&r&&(It(0,"div",5),Ii(1,UX,15,2,"div",4),Mt()),2&r){const e=ir();rn(1),kn("ngIf",e.showselectedFeature())}}function GX(r,t){if(1&r){const e=$l();It(0,"div"),It(1,"div",18),It(2,"input",19),Qr("colorPickerChange",function(i){return Rr(e),ir().$implicit.value.rbgString=i})("colorPickerChange",function(i){Rr(e);const o=ir().$implicit;return ir(3).onColorChange(i,o)}),Mt(),Mt(),Mt()}if(2&r){const e=ir().$implicit;rn(2),dh("background",e.value.rbgString),kn("colorPicker",e.value.rbgString)("cpOutputFormat","rgba")("cpAlphaChannel","enabled")}}function qX(r,t){if(1&r){const e=$l();It(0,"tr"),It(1,"td"),jr(2),Mt(),It(3,"td"),It(4,"input",17),Qr("change",function(i){const u=Rr(e).$implicit;return ir(3).onCheckboxChange(i,u)}),Mt(),Mt(),It(5,"td"),Ii(6,GX,3,5,"div",4),Mt(),Mt()}if(2&r){const e=t.$implicit;rn(2),bp(e.key),rn(2),kn("checked",e.value.show),rn(2),kn("ngIf",e.value.show)}}function ZX(r,t){if(1&r){const e=$l();It(0,"div",5),It(1,"table",6),It(2,"caption",13),jr(3,"Legenda:"),Mt(),It(4,"thead"),It(5,"th",8),jr(6,"Waarde"),Mt(),It(7,"th",8),jr(8,"Tonen"),Mt(),It(9,"th",9),jr(10,"Visualisatie"),Mt(),Mt(),It(11,"tbody"),It(12,"tr"),It(13,"td"),jr(14,"Alle waarden"),Mt(),It(15,"td"),It(16,"input",14),Qr("change",function(i){return Rr(e),ir(2).onCheckboxAllChange(i)}),Mt(),Mt(),It(17,"td"),It(18,"button",15),Qr("click",function(){return Rr(e),ir(2).NewColorMap()}),jr(19,"Reset"),Mt(),Mt(),Mt(),Ii(20,qX,7,3,"tr",11),Gx(21,"keyvalue"),Mt(),Mt(),Hi(22,"div",16),Mt()}if(2&r){const e=ir(2);rn(20),kn("ngForOf",qx(21,1,e.colorArray()))}}function HX(r,t){if(1&r){const e=$l();It(0,"div"),It(1,"button",12),Qr("click",function(){return Rr(e),ir().toggleShowLegend()}),jr(2,"Toon Legenda aan/uit"),Mt(),Ii(3,ZX,23,3,"div",3),Mt()}if(2&r){const e=ir();rn(3),kn("ngIf",e.isShowLegend)}}let WX=(()=>{class r{constructor(e){this.locationService=e,this.StyleJson="",this.color="geen",this.SelectedVisualisation=Ip.achtergrond,this.colorMap=new Map,this.newcolorMap=new Map,this.vectorTileLayer=new vL({renderMode:"hybrid",declutter:!0,useInterimTilesOnError:!1}),this.rdProjection=new h_({code:"EPSG:28992",extent:[-285401.92,22598.08,595401.92,903401.92]}),this.view=new Of({projection:this.rdProjection,center:[155e3,463e3],zoom:13,minZoom:13}),this.map1=new dT({layers:[this.vectorTileLayer],target:"map1",view:this.view}),this.resolutions=[],this.matrixIds=[],this.selectedFeature=""[""],this.selectedFeatures=void 0,this.isShowDetails=!1,this.isShowLegend=!1,this.detailsupdate=!0}set visualisation(e){this.SelectedVisualisation=e}selectedFeatureProperties(){var e=[],n=this.selectedFeature.getProperties();for(var i in n)e.push({title:i,value:n[i]});return e}ngOnInit(){this.locationService.currentLocation.subscribe(n=>{this.currentlocation=n;let i=this.map1.getView();n.view&&i.setCenter(n.view.getCenter())}),this.calcMatrixAndResolutions(this.rdProjection),this.resolutions=this.getResolutionsVt(11),this.map1=new dT({layers:[this.vectorTileLayer],target:"map1",view:this.view});const e=this;this.map1.on(["moveend"],function(n){e.locationService.changeView(e.map1.getView())}),this.map1.on(["click","pointermove"],function(n){const o=e;e.detailsupdate&&e.vectorTileLayer.getFeatures(n.pixel).then(function(u){if(!u.length)return void(o.selectedFeature=""[""]);let m=u[0];!m||(o.selectedFeatures=u,o.selectedFeature=m)}),"click"==n.type&&(e.detailsupdate=!e.detailsupdate)}),this.changeStyleJson(this.vectorTileLayer,this.resolutions),this.setTileSource(this.rdProjection,this.vectorTileLayer)}ngOnChanges(){this.changeStyleJson(this.vectorTileLayer,this.resolutions)}toggleShowDetails(){this.isShowDetails=!this.isShowDetails}toggleShowLegend(){this.isShowLegend=!this.isShowLegend}hasLegend(){return this.colorMap.size>0}getZoomLevel(){return this.map1.getView().getZoom()}getResolutionsVt(e=9){return this.getMatrixIdsVt(e).map(n=>3440.64/2**n)}getMatrixIdsVt(e=9){return Array(e+1).fill(null).map((n,i)=>i)}calcMatrixAndResolutions(e){const i=Xs(e.getExtent())/256;for(let o=0;o<=15;o++)this.matrixIds[o]=o.toString(),this.resolutions[o]=i/Math.pow(2,o)}selectedFillStyle(){return{"background-color":this.getFillColor(this.selectedFeature)}}getFillColor(e){const o=this.vectorTileLayer.getStyleFunction()(e,this.view.getResolution());var u="";return u=o instanceof Array?o[o.length-1].getFill().getColor():o.fill_.color_,CanvasPattern,u}changeStyleJson(e,n){this.colorMap.clear(),""!==this.StyleJson?fetch(this.StyleJson).then(i=>{i.json().then(o=>{DL(e,o,"bgt",void 0,n)})}):this.SelectedVisualisation===Ip.zerodefaultA?e.setStyle():this.collectLayers(e)}clearColorMap(){this.colorMap.clear()}collectLayers(e){var n=this;e.setStyle(function(o){const u=o.getGeometry(),m=o.getProperties();var b=void 0,T={text:"",rotation:0};switch(n.SelectedVisualisation){case Ip.zerodefaultB:b=new H1("default zero",u);break;case Ip.zerodefaultC_Bron:if(n.colorMap.has(m[F="bronhouder"]))b=n.colorMap.get(m[F]);else{var V=new H1(m[F],u);n.colorMap.set(m[F],V),b=V}break;case Ip.zerodefaultD:"pand_nummeraanduiding"===m[F="layer"]&&(T.text=m.tekst,T.rotation=m.hoek*Math.PI/180),"openbareruimtelabel"===m[F]&&(T.text=m.openbareruimtenaam,T.rotation=m.hoek*Math.PI/180),n.colorMap.has(m[F])?b=n.colorMap.get(m[F]):(V=new H1(m[F],u),n.colorMap.set(m[F],V),b=V);break;default:var F;return n.colorMap.has(m[F="layer"])||(V=new H1(m[F],u),n.colorMap.set(m[F],V)),e.getStyle()}return b.style(T)})}setimageline(e){var n=[new dl({stroke:new Ku({color:"blue",width:4})}),new dl({stroke:new Ku({color:"red",width:2})})];e.setStyle(n)}setimageline1(e){var n=new Image;n.src="data:image/svg+xml;base64,"+btoa('<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   height="20"\n   width="17"\n   version="1.1"\n   id="svg23"\n   sodipodi:docname="kruinlijn4.svg"\n   inkscape:version="1.1.1 (3bf5ae0d25, 2021-09-20)"\n   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\n   xmlns="http://www.w3.org/2000/svg"\n   xmlns:svg="http://www.w3.org/2000/svg">\n  <defs\n     id="defs27" />\n  <sodipodi:namedview\n     id="namedview25"\n     pagecolor="#ffffff"\n     bordercolor="#666666"\n     borderopacity="1.0"\n     inkscape:pageshadow="2"\n     inkscape:pageopacity="0.0"\n     inkscape:pagecheckerboard="0"\n     showgrid="false"\n     inkscape:zoom="23.029412"\n     inkscape:cx="8.0549169"\n     inkscape:cy="12.136654"\n     inkscape:window-width="1920"\n     inkscape:window-height="1001"\n     inkscape:window-x="-9"\n     inkscape:window-y="-9"\n     inkscape:window-maximized="1"\n     inkscape:current-layer="svg23"\n     showguides="false"\n     height="33px" />\n  <ellipse\n  \n     style="fill:#000000;fill-rule:evenodd"\n     id="path120"\n     cx="8.8799486"\n     cy="9.7484035"\n     rx="7.4469986"\n     ry="7.750958" />\n</svg>'),n.onload=function(){document.createElement("canvas").getContext("2d").createPattern(n,"repeat");var m=[new dl({stroke:new Ku({color:"red",width:10,lineDash:[10,20],lineDashOffset:20})}),new dl({stroke:new Ku({color:"black",width:2})})];e.setStyle(m)}}setimageline2(e){}getVectorTileSource(e,n){return this.resolutions=this.getResolutionsVt(12),new zX({format:new MX,projection:e,tileGrid:new dw({extent:e.getExtent(),resolutions:this.resolutions,tileSize:[256,256],origin:lg(e.getExtent())}),url:`${n}/{z}/{x}/{y}`,cacheSize:0})}setTileSource(e,n){let o=this.getVectorTileSource(e,"https://api.pdok.nl/lv/bgt/oat/v1_0-preprod/tiles/EPSG:28992");n.setVisible(!1),n.setSource(o),n.setVisible(!0),n.set("renderMode","hybrid")}showselectedFeature(){return this.selectedFeature!==""[""]}colorArray(){return new Map([...this.colorMap.entries()].sort())}colorArray2(){return Array.from(this.colorMap.entries())}onCheckboxAllChange(e){this.colorMap.forEach(n=>{n.show=e.target.checked}),this.vectorTileLayer.getSource().refresh()}onColorChange(e,n){this.vectorTileLayer.getSource().refresh()}onCheckboxChange(e,n){var i=n.value,o=new H1(i.label,i.legendfeature);o.show=e.target.checked,this.colorMap.has(i.label)&&this.colorMap.set(i.label,o),this.vectorTileLayer.getSource().refresh()}NewColorMap(){this.clearColorMap(),this.vectorTileLayer.getSource().refresh()}ApplyColorMap(){this.vectorTileLayer.getSource().refresh()}}return r.\u0275fac=function(e){return new(e||r)(qn(g2))},r.\u0275cmp=eo({type:r,selectors:[["app-olmap"]],inputs:{StyleJson:"StyleJson",visualisation:"visualisation"},features:[Lo],decls:8,vars:3,consts:[["id","map1",1,"map-container"],[1,"topright"],["type","checkbox",1,"topbutton",3,"click"],["class","row container-fluid","id","divshow",4,"ngIf"],[4,"ngIf"],["id","divshow",1,"row","container-fluid"],[1,"featuretable"],[1,"featuretablecaption"],["id","Veld"],["id","Waarde"],[3,"ngStyle"],[4,"ngFor","ngForOf"],["type","checkbox",1,"topbutton2",3,"click"],[1,"legendtablecaption"],["type","checkbox",3,"change"],["type","checkbox",1,"leftbutton",3,"click"],[1,"colorfillerbox"],["type","checkbox",3,"checked","change"],[1,"colorpick"],[3,"colorPicker","cpOutputFormat","cpAlphaChannel","colorPickerChange"]],template:function(e,n){1&e&&(It(0,"div",0),It(1,"div",1),It(2,"button",2),Qr("click",function(){return n.toggleShowDetails()}),jr(3,"Toon object aan/uit"),Mt(),Ii(4,VX,2,1,"div",3),It(5,"div"),Ii(6,HX,4,1,"div",4),Mt(),Mt(),Mt(),jr(7)),2&e&&(rn(4),kn("ngIf",n.isShowDetails),rn(2),kn("ngIf",n.hasLegend()),rn(1),wp("\nBGT Vector tile viewer (met openlayers) zoom ",n.getZoomLevel(),"\n"))},directives:[Vy,eD,B0,cj],pipes:[OE],styles:[".map-container[_ngcontent-%COMP%]{align-items:stretch;display:flex;height:100%;justify-content:stretch;min-height:80vh;position:relative;width:100%}#map1[_ngcontent-%COMP%]{z-index:1;height:100vh;width:98vw}.topright[_ngcontent-%COMP%]{background-color:#f5f5f5;opacity:.7;z-index:2;position:absolute;top:8px;right:16px;font-size:14px;width:36vw;overflow-x:auto;overflow-y:auto}.topbutton[_ngcontent-%COMP%]{float:right;margin-right:16vw}.featuretable[_ngcontent-%COMP%]{text-align:left}.featuretablecaption[_ngcontent-%COMP%]{text-align:left;font-weight:700}.leftbutton[_ngcontent-%COMP%]{float:right;text-align:right;margin-right:16vw}.colorpick[_ngcontent-%COMP%]{z-index:3}"]}),r})();function $X(r,t){1&r&&(It(0,"div"),Hi(1,"ggc-wmts-layer",6),Hi(2,"ggc-wmts-layer",7),Mt()),2&r&&(rn(1),kn("mapName","cloud")("layer","achtergrondvisualisatie")("minResolution",.0525)("maxResolution",.841),rn(1),kn("mapName","vintage")("layer","bgtachtergrond")("minResolution",.0525)("maxResolution",.841))}function XX(r,t){1&r&&(It(0,"div"),Hi(1,"ggc-wmts-layer",6),Hi(2,"ggc-wmts-layer",7),Mt()),2&r&&(rn(1),kn("mapName","cloud")("layer","standaardvisualisatie")("minResolution",.0525)("maxResolution",.841),rn(1),kn("mapName","vintage")("layer","bgtstandaardv2")("minResolution",.0525)("maxResolution",.841))}function YX(r,t){1&r&&(It(0,"div"),jr(1,"Default Option"),Mt())}let KX=(()=>{class r{constructor(e,n){this.mapService=e,this.locationService=n,this.selectedVisualisatie="",this.visualisatie=Ip,this.rdProjection=new h_({code:"EPSG:28992",extent:[-285401.92,22598.08,595401.92,903401.92]})}ngOnInit(){this.locationService.currentLocation.subscribe(n=>{this.SyncLocation(n)});let e=this;this.mapService.getMap("cloud").on(["moveend"],function(n){e.locationService.changeView(e.mapService.getMap("cloud").getView())}),this.mapService.getMap("vintage").on(["moveend"],function(n){e.locationService.changeView(e.mapService.getMap("vintage").getView())})}SyncLocation(e){switch(e.change){case hv.move:this.setview(e,"cloud"),this.setview(e,"vintage");break;case hv.search:this.mapService.zoomToPdokResultAndSimulateClick(e.event,"cloud",12),this.mapService.zoomToPdokResultAndSimulateClick(e.event,"vintage",12)}}setview(e,n){let i=this.mapService.getMap(n).getView();i.setCenter(e.view.getCenter());let o=e.view.getZoom();o&&i.setZoom(o)}getZoomLevel(){return this.mapService.getMap("cloud").getView().getZoom()}}return r.\u0275fac=function(e){return new(e||r)(qn(oO),qn(g2))},r.\u0275cmp=eo({type:r,selectors:[["app-wmtsmap"]],inputs:{selectedVisualisatie:"selectedVisualisatie"},decls:13,vars:10,consts:[[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"map-container1"],[3,"mapName","minZoomlevel","maxZoomlevel"],[1,"map-container2"],["attributions","BGT Standaard Visualisatie","layerName","'cloud1'","url","https://service.pdok.nl/lv/bgt/wmts/v1_0?",3,"mapName","layer","minResolution","maxResolution"],["attributions","BGT Standaard Visualisatie \xa9","layerName","'layerold'","url","https://geodata.nationaalgeoregister.nl/tiles/service/wmts?",3,"mapName","layer","minResolution","maxResolution"]],template:function(e,n){1&e&&(It(0,"div",0),Ii(1,$X,3,8,"div",1),Ii(2,XX,3,8,"div",1),Ii(3,YX,2,0,"div",2),Mt(),It(4,"div"),It(5,"p"),jr(6),Mt(),It(7,"div",3),Hi(8,"ggc-map",4),Mt(),It(9,"p"),jr(10,"vintage :)"),Mt(),It(11,"div",5),Hi(12,"ggc-map",4),Mt(),Mt()),2&e&&(kn("ngSwitch",n.selectedVisualisatie),rn(1),kn("ngSwitchCase",n.visualisatie.achtergrond),rn(1),kn("ngSwitchCase",n.visualisatie.standaard),rn(4),wp("new BGT zoom ",n.getZoomLevel()," "),rn(2),kn("mapName","cloud")("minZoomlevel",13)("maxZoomlevel",16),rn(4),kn("mapName","vintage")("minZoomlevel",13)("maxZoomlevel",16))},directives:[Vb,KA,JA,W9,NR],styles:[".map-container1[_ngcontent-%COMP%], .map-container2[_ngcontent-%COMP%]{width:98vw;height:100vh}ggc-map[_ngcontent-%COMP%]{height:100vh;width:100vh}"]}),r})();var JX=Ht(958),QX=Ht(511);let eY=(()=>{class r{constructor(){this.StyleJson="styles/achtergrondvisualisatie.json"}ngOnInit(){this.map=new JX.Map;var e=this;this.map.on(["mapload"],function(n){e.map.addControl(new QX.P({},{showDefault:!1,showCheckbox:!1,onlyRendered:!0,reverseOrder:!0}),"top-right")})}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275cmp=eo({type:r,selectors:[["app-ngxmap"]],inputs:{StyleJson:"StyleJson"},decls:10,vars:4,consts:[[1,"maparea"],[3,"href"],["href","https://pdok.github.io/vectortile-test-viewer/#overzoomLevel=12&source=bgt-demo&filter=&filterInc%5B%E2%80%A6%5D407634027=&y=487401.5669761629&z=13.39918661680849&x=121321.87311002854"]],template:function(e,n){1&e&&(It(0,"H2"),jr(1),Mt(),It(2,"div",0),It(3,"mgl-map"),Hi(4,"div"),Mt(),Mt(),It(5,"a",1),jr(6,"test style"),Mt(),Hi(7,"br"),It(8,"a",2),jr(9,"tile viewer"),Mt()),2&e&&(rn(1),wp("BGT Vector tile viewer (met ngx-maplibre-gl) ",n.StyleJson," "),rn(2),function(r){dm(TI,BF,r,!1)}(n.StyleJson),rn(2),$v("href",n.StyleJson,qm))},directives:[C4],styles:["mgl-map[_ngcontent-%COMP%]{height:100vh;width:98vw}.maparea[_ngcontent-%COMP%]{width:98vw}",'.maplibregl-legend-list[_ngcontent-%COMP%]{display:none}.maplibregl-legend-list[_ngcontent-%COMP%]{overflow-y:scroll;max-height:70vh}.maplibregl-ctrl-group[_ngcontent-%COMP%]   .maplibregl-legend-list[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;display:block;height:auto}.maplibregl-legend-list[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{font-weight:700}.maplibregl-legend-list[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#0000000d}.maplibregl-legend-list[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{border-top:1px solid #ddd}.maplibregl-legend-switcher[_ngcontent-%COMP%]{background:url(\'data:image/svg+xml;charset=UTF-8,<svg height="512pt" viewBox="0 0 512 512.0005" width="512pt" xmlns="http://www.w3.org/2000/svg"><path d="m220 0h-200c-11.046875 0-20 8.953125-20 20v200c0 11.046875 8.953125 20 20 20h200c11.046875 0 20-8.953125 20-20v-200c0-11.046875-8.953125-20-20-20zm-20 200h-160v-160h160zm299.65625 73.523438c-7.472656-3.097657-16.078125-1.386719-21.796875 4.332031l-200 200c-5.722656 5.722656-7.433594 14.324219-4.335937 21.796875 3.097656 7.476562 10.386718 12.347656 18.476562 12.347656h200c11.046875 0 20-8.953125 20-20v-200c0-8.089844-4.871094-15.382812-12.34375-18.476562zm-27.65625 198.476562h-131.714844l131.714844-131.714844zm-80-232c66.167969 0 120-53.832031 120-120s-53.832031-120-120-120-120 53.832031-120 120 53.832031 120 120 120zm0-200c44.113281 0 80 35.886719 80 80s-35.886719 80-80 80-80-35.886719-80-80 35.886719-80 80-80zm-157.859375 266.144531-85.855469 85.855469 85.855469 85.855469c7.8125 7.8125 7.8125 20.476562 0 28.285156-7.808594 7.808594-20.472656 7.8125-28.28125 0l-85.859375-85.855469-85.859375 85.859375c-7.808594 7.808594-20.472656 7.808594-28.28125 0-7.8125-7.8125-7.8125-20.476562 0-28.285156l85.855469-85.859375-85.855469-85.855469c-7.8125-7.8125-7.8125-20.476562 0-28.285156 7.808594-7.8125 20.472656-7.8125 28.28125 0l85.859375 85.855469 85.859375-85.859375c7.808594-7.808594 20.472656-7.808594 28.28125 0 7.8125 7.8125 7.8125 20.476562 0 28.289062zm0 0"/></svg>\');background-position:center;background-repeat:no-repeat;background-size:70%}table.legend-table[_ngcontent-%COMP%]{border-collapse:collapse;margin:0 auto}td.legend-table-td[_ngcontent-%COMP%], th.legend-table-th[_ngcontent-%COMP%]{border:1px solid #ffffff;margin:10px;padding:2px;text-align:left}.maplibregl-legend-close-button[_ngcontent-%COMP%]{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent;font-size:13px;padding-top:5px;padding-right:5px}.maplibregl-legend-title-label[_ngcontent-%COMP%]{font-size:14px;font-weight:700;margin:5px}.maplibregl-legend-onlyRendered-checkbox[_ngcontent-%COMP%]{margin:5px}.maplibregl-legend-onlyRendered-label[_ngcontent-%COMP%]{font-size:14px;margin:5px}td.legend-table-td[_ngcontent-%COMP%] > svg[_ngcontent-%COMP%]{height:17px}']}),r})();function tY(r,t){if(1&r&&(It(0,"tr"),It(1,"td"),jr(2),Mt(),It(3,"td"),jr(4),Mt(),It(5,"td"),jr(6),Mt(),It(7,"td"),jr(8),Mt(),It(9,"td"),jr(10),Gx(11,"json"),Mt(),It(12,"td"),jr(13),Gx(14,"json"),Mt(),It(15,"td"),jr(16),Mt(),Mt()),2&r){const e=t.$implicit,n=t.index;rn(2),wp("",n," "),rn(2),wp("",e["source-layer"]," "),rn(2),wp("",e.filter," "),rn(2),wp("",e.type," "),rn(2),wp("",qx(11,7,e.paint)," "),rn(3),wp("",qx(14,9,e.layout)," "),rn(3),bp(e.id)}}let nY=(()=>{class r{constructor(){this.StyleJson="styles/achtergrondvisualisatie.json"}ngOnInit(){this.LoadJson()}ngOnChanges(){this.LoadJson()}LoadJson(){this.mapboxStyle=void 0,fetch(this.StyleJson).then(n=>{n.json().then(i=>{this.mapboxStyle=i})})}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275cmp=eo({type:r,selectors:[["app-mapboxlegend"]],inputs:{StyleJson:"StyleJson"},features:[Lo],decls:22,vars:2,consts:[["id","index"],["id","laag"],["id","filter"],["id","type"],["id","paint"],["id","layout"],["id","id"],[4,"ngFor","ngForOf"]],template:function(e,n){1&e&&(It(0,"p"),jr(1),Mt(),It(2,"table"),It(3,"caption"),jr(4,"Layers in mapboxstyle"),Mt(),It(5,"thead"),It(6,"th",0),jr(7,"index"),Mt(),It(8,"th",1),jr(9,"laag"),Mt(),It(10,"th",2),jr(11,"filter"),Mt(),It(12,"th",3),jr(13,"type"),Mt(),It(14,"th",4),jr(15,"paint"),Mt(),It(16,"th",5),jr(17,"layout"),Mt(),It(18,"th",6),jr(19,"id"),Mt(),Mt(),It(20,"tbody"),Ii(21,tY,17,11,"tr",7),Mt(),Mt()),2&e&&(rn(1),wp("mapboxlegend ",n.StyleJson," "),rn(20),kn("ngForOf",null==n.mapboxStyle?null:n.mapboxStyle.layers))},directives:[B0],pipes:[tD],styles:["table[_ngcontent-%COMP%], th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid grey;border-collapse:collapse;width:98vw;font-size:.7vw}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background-color:#f1f1f1}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(even){background-color:#fff}"]}),r})();function rY(r,t){if(1&r){const e=$l();It(0,"li",13),Qr("click",function(){const o=Rr(e).$implicit;return ir(2).onSelect(o.value)}),It(1,"span"),jr(2),Mt(),Mt()}if(2&r){const e=t.$implicit;rn(2),bp(e.value)}}function iY(r,t){if(1&r&&(It(0,"div",10),It(1,"ul",11),Ii(2,rY,3,1,"li",12),Gx(3,"keyvalue"),Mt(),Mt()),2&r){const e=ir();rn(2),kn("ngForOf",qx(3,1,e.visualisatie))}}let oY=(()=>{class r{constructor(){this.enumFromValue=(e,n,i=`${e} not in enum`)=>{const o=Object.keys(n).find(u=>n[u]===e);if(!o)throw new Error(i);return n[o]},this.title="vector-style-tester",this.visualisatie=Ip,this.selectedVis=Ip.achtergrond,this.mapboxJson="styles/achtergrondvisualisatie.json",this.isShow=!1,this.isDemo=!1,this.demotext="visualisatie demo mode aan",this.repeating_style_function()}ngOnInit(){}toggleShow(){this.isShow=!this.isShow}toggleDemo(){this.isDemo=!this.isDemo,this.isDemo?(this.demotext="visualisatie demo mode uit",this.selectedVis=Ip.achtergrond,this.repeating_style_function()):this.demotext="visualisatie demo mode aan"}repeating_style_function(){if(this.isDemo){var e=!1;for(var n in Ip)e?(this.selectedVis=this.visualisatie[n],e=!1):this.selectedVis===this.visualisatie[n]&&(e=!0);!0===e&&(this.selectedVis=Ip.achtergrond),this.mapboxJson=yL(this.selectedVis),setTimeout(()=>{this.repeating_style_function()},Math.round(4e3*Math.random()))}}onSelect(e){this.selectedVis=e,this.mapboxJson=yL(e),this.isShow=!1}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275cmp=eo({type:r,selectors:[["app-root"]],decls:19,vars:8,consts:[[1,"app-container"],[1,"head"],["alt","PDOK","src","../assets/images/logo-pdok.svg"],[1,"topright"],[1,"flex-child-box"],["type","checkbox",1,"flex-child-box",3,"click"],["class","row container-fluid","id","divshow",4,"ngIf"],[3,"visualisation","StyleJson"],[3,"selectedVisualisatie"],[3,"StyleJson"],["id","divshow",1,"row","container-fluid"],[1,"visualisatieselect"],[3,"click",4,"ngFor","ngForOf"],[3,"click"]],template:function(e,n){1&e&&(It(0,"div"),It(1,"div",0),It(2,"div",1),Hi(3,"img",2),Mt(),It(4,"div",3),It(5,"div"),Hi(6,"app-search"),Mt(),It(7,"div",4),Hi(8,"div",4),It(9,"button",5),Qr("click",function(){return n.toggleShow()}),jr(10),Mt(),It(11,"button",5),Qr("click",function(){return n.toggleDemo()}),jr(12),Mt(),Mt(),Ii(13,iY,4,3,"div",6),Mt(),Hi(14,"app-olmap",7),Hi(15,"app-wmtsmap",8),Mt(),Mt(),Hi(16,"app-ngxmap",9),Hi(17,"app-mapboxlegend",9),Hi(18,"router-outlet")),2&e&&(rn(10),bp(n.selectedVis),rn(2),bp(n.demotext),rn(1),kn("ngIf",n.isShow),rn(1),$v("visualisation",n.selectedVis),$v("StyleJson",n.mapboxJson),rn(1),$v("selectedVisualisatie",n.selectedVis),rn(1),kn("StyleJson",n.mapboxJson),rn(1),kn("StyleJson",n.mapboxJson))},directives:[U$,Vy,WX,KX,eY,nY,s2,B0],pipes:[OE],styles:[".head[_ngcontent-%COMP%]{background-color:#1a1e4f;height:4em;width:12%;position:absolute;top:10px;left:10px;z-index:3}.app-container[_ngcontent-%COMP%]{height:100%;width:100%}.topright[_ngcontent-%COMP%]{flex:1;background-color:#f5f5f5;opacity:.7;z-index:2;position:absolute;top:1vh;left:14vw;width:30vw;font-size:18px}.flex-parent-box[_ngcontent-%COMP%]{position:relative}.flex-child-box[_ngcontent-%COMP%]{flex:1;margin:4px}"]}),r})(),aY=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=Gi({type:r,bootstrap:[oY]}),r.\u0275inj=io({providers:[ZE],imports:[[n4,j$,tH,IH,E4,hj]]}),r})();wA=!1,e4().bootstrapModule(aY).catch(r=>console.error(r))},986:()=>{},630:(xr,Gr,Ht)=>{"use strict";Ht.d(Gr,{Il:()=>Fr,eG:()=>pc,th:()=>Ko,TE:()=>Ja,ZI:()=>va,pA:()=>Ar});var Ar={$version:8,$root:{version:{required:!0,type:"enum",values:[8],doc:"Style specification version number. Must be 8.",example:8},name:{type:"string",doc:"A human-readable name for the style.",example:"Bright"},metadata:{type:"*",doc:"Arbitrary properties useful to track with the stylesheet, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},center:{type:"array",value:"number",doc:"Default map center in longitude and latitude.  The style center will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:[-73.9749,40.7736]},zoom:{type:"number",doc:"Default zoom level.  The style zoom will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:12.5},bearing:{type:"number",default:0,period:360,units:"degrees",doc:'Default bearing, in degrees. The bearing is the compass direction that is "up"; for example, a bearing of 90\xb0 orients the map so that east is up. This value will be used only if the map has not been positioned by other means (e.g. map options or user interaction).',example:29},pitch:{type:"number",default:0,units:"degrees",doc:"Default pitch, in degrees. Zero is perpendicular to the surface, for a look straight down at the map, while a greater value like 60 looks ahead towards the horizon. The style pitch will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:50},light:{type:"light",doc:"The global light source.",example:{anchor:"viewport",color:"white",intensity:.4}},terrain:{type:"terrain",doc:"A global modifier that elevates layers and markers based on a DEM data source."},fog:{type:"fog",doc:"A global effect that fades layers and markers based on their distance to the camera. The fog can be used to approximate the effect of atmosphere on distant objects and enhance the depth perception of the map when used with terrain or 3D features."},sources:{required:!0,type:"sources",doc:"Data source specifications.",example:{"mapbox-streets":{type:"vector",url:"mapbox://mapbox.mapbox-streets-v6"}}},sprite:{type:"string",doc:"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended. This property is required if any layer uses the `background-pattern`, `fill-pattern`, `line-pattern`, `fill-extrusion-pattern`, or `icon-image` properties. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://sprites/mapbox/bright-v8"},glyphs:{type:"string",doc:"A URL template for loading signed-distance-field glyph sets in PBF format. The URL must include `{fontstack}` and `{range}` tokens. This property is required if any layer uses the `text-field` layout property. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},transition:{type:"transition",doc:"A global transition definition to use as a default across properties, to be used for timing transitions between one value and the next when no property-specific transition is set. Collision-based symbol fading is controlled independently of the style's `transition` property.",example:{duration:300,delay:0}},projection:{type:"projection",doc:"The projection the map should be rendered in. Suported projections are Albers, Equal Earth, Equirectangular (WGS84), Lambert conformal conic, Mercator, Natural Earth, and Winkel Tripel. Terrain, fog, sky and CustomLayerInterface are not supported for projections other than mercator.",example:{name:"albers",center:[-154,50],parallels:[55,65]}},layers:{required:!0,type:"array",value:"layer",doc:"Layers will be drawn in the order of this array.",example:[{id:"water",source:"mapbox-streets","source-layer":"water",type:"fill",paint:{"fill-color":"#00ffff"}}]}},sources:{"*":{type:"source",doc:"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For image and video sources, a URL must be provided. For GeoJSON sources, a URL or inline GeoJSON must be provided."}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{doc:"A vector tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`. If specified as a string for a vector tile source, the same property is used across all its source layers."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster:{type:{required:!0,type:"enum",values:{raster:{doc:"A raster tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{doc:"A RGB-encoded raster DEM source"}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},encoding:{type:"enum",values:{terrarium:{doc:"Terrarium format PNG tiles. See https://aws.amazon.com/es/public-datasets/terrain/ for more info."},mapbox:{doc:"Mapbox Terrain RGB tiles. See https://www.mapbox.com/help/access-elevation-data/#mapbox-terrain-rgb for more info."}},default:"mapbox",doc:"The encoding used by this source. Mapbox Terrain RGB is used by default"},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{doc:"A GeoJSON data source."}},doc:"The data type of the GeoJSON source."},data:{type:"*",doc:"A URL to a GeoJSON file, or inline GeoJSON."},maxzoom:{type:"number",default:18,doc:"Maximum zoom level at which to create vector tiles (higher means greater detail at high zoom levels)."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},buffer:{type:"number",default:128,maximum:512,minimum:0,doc:"Size of the tile buffer on each side. A value of 0 produces no buffer. A value of 512 produces a buffer as wide as the tile itself. Larger values produce fewer rendering artifacts near tile edges and slower performance."},filter:{type:"*",doc:"An expression for filtering features prior to processing them for rendering."},tolerance:{type:"number",default:.375,doc:"Douglas-Peucker simplification tolerance (higher means simpler geometries and faster performance)."},cluster:{type:"boolean",default:!1,doc:"If the data is a collection of point features, setting this to true clusters the points by radius into groups. Cluster groups become new `Point` features in the source with additional properties:\n * `cluster` Is `true` if the point is a cluster \n * `cluster_id` A unqiue id for the cluster to be used in conjunction with the [cluster inspection methods](https://www.mapbox.com/mapbox-gl-js/api/#geojsonsource#getclusterexpansionzoom)\n * `point_count` Number of original points grouped into this cluster\n * `point_count_abbreviated` An abbreviated point count"},clusterRadius:{type:"number",default:50,minimum:0,doc:"Radius of each cluster if clustering is enabled. A value of 512 indicates a radius equal to the width of a tile."},clusterMaxZoom:{type:"number",doc:"Max zoom on which to cluster points if clustering is enabled. Defaults to one zoom less than maxzoom (so that last zoom features are not clustered). Clusters are re-evaluated at integer zoom levels so setting clusterMaxZoom to 14 means the clusters will be displayed until z15."},clusterMinPoints:{type:"number",doc:"Minimum number of points necessary to form a cluster if clustering is enabled. Defaults to `2`."},clusterProperties:{type:"*",doc:'An object defining custom properties on the generated clusters if clustering is enabled, aggregating values from clustered points. Has the form `{"property_name": [operator, map_expression]}`. `operator` is any expression function that accepts at least 2 operands (e.g. `"+"` or `"max"`) \u2014 it accumulates the property value from clusters/points the cluster contains; `map_expression` produces the value of a single point.\n\nExample: `{"sum": ["+", ["get", "scalerank"]]}`.\n\nFor more advanced use cases, in place of `operator`, you can use a custom reduce expression that references a special `["accumulated"]` value, e.g.:\n`{"sum": [["+", ["accumulated"], ["get", "sum"]], ["get", "scalerank"]]}`'},lineMetrics:{type:"boolean",default:!1,doc:"Whether to calculate line distance metrics. This is required for line layers that specify `line-gradient` values."},generateId:{type:"boolean",default:!1,doc:"Whether to generate ids for the geojson features. When enabled, the `feature.id` property will be auto assigned based on its index in the `features` array, over-writing any previous values."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`."}},source_video:{type:{required:!0,type:"enum",values:{video:{doc:"A video data source."}},doc:"The data type of the video source."},urls:{required:!0,type:"array",value:"string",doc:"URLs to video content in order of preferred format."},coordinates:{required:!0,doc:"Corners of video specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},source_image:{type:{required:!0,type:"enum",values:{image:{doc:"An image data source."}},doc:"The data type of the image source."},url:{required:!0,type:"string",doc:"URL that points to an image."},coordinates:{required:!0,doc:"Corners of image specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},layer:{id:{type:"string",doc:"Unique layer name.",required:!0},type:{type:"enum",values:{fill:{doc:"A filled polygon with an optional stroked border.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},line:{doc:"A stroked line.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},symbol:{doc:"An icon or a text label.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},circle:{doc:"A filled circle.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},heatmap:{doc:"A heatmap.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"fill-extrusion":{doc:"An extruded (3D) polygon.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},raster:{doc:"Raster map textures such as satellite imagery.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},hillshade:{doc:"Client-side hillshading visualization based on DEM data. Currently, the implementation only supports Mapbox Terrain RGB and Mapzen Terrarium tiles.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},background:{doc:"The background color or pattern of the map.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},sky:{doc:"A spherical dome around the map that is always rendered behind all other layers.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},doc:"Rendering type of this layer.",required:!0},metadata:{type:"*",doc:"Arbitrary properties useful to track with the layer, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},source:{type:"string",doc:"Name of a source description to be used for this layer. Required for all layer types except `background`."},"source-layer":{type:"string",doc:"Layer to use from a vector tile source. Required for vector tile sources; prohibited for all other source types, including GeoJSON sources."},minzoom:{type:"number",minimum:0,maximum:24,doc:"The minimum zoom level for the layer. At zoom levels less than the minzoom, the layer will be hidden."},maxzoom:{type:"number",minimum:0,maximum:24,doc:"The maximum zoom level for the layer. At zoom levels equal to or greater than the maxzoom, the layer will be hidden."},filter:{type:"filter",doc:'An expression specifying conditions on source features. Only features that match the filter are displayed. Zoom expressions in filters are only evaluated at integer zoom levels. The `["feature-state", ...]` expression is not supported in filter expressions.  The `["pitch"]` and `["distance-from-center"]` expressions are supported only for filter expressions on the symbol layer.'},layout:{type:"layout",doc:"Layout properties for the layer."},paint:{type:"paint",doc:"Default paint properties for this layer."}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"},"data-driven styling":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},"property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{doc:"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{doc:"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{doc:"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt",doc:"The display of line endings.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{doc:"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{doc:"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{doc:"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter",doc:"The display of lines when joining.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,doc:"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"line-join":"miter"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,doc:"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"line-join":"round"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{doc:"The label is placed at the point where the geometry is located."},line:{doc:"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."},"line-center":{doc:"The label is placed at the center of the line of the geometry. Can only be used on `LineString` and `Polygon` geometries. Note that a single feature in a vector tile may contain multiple line geometries."}},default:"point",doc:"Label placement relative to its geometry.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`line-center` value":{js:"0.47.0",android:"6.4.0",ios:"4.3.0",macos:"0.10.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",doc:"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,doc:"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer. When using a client that supports global collision detection, like Mapbox GL JS version 0.42.0 or greater, enabling this property is not needed to prevent clipped labels at tile boundaries.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with lower sort keys are drawn and placed first.  When `icon-allow-overlap` or `text-allow-overlap` is `false`, features with a lower sort key will have priority during placement. When `icon-allow-overlap` or `text-allow-overlap` is set to `true`, features with a higher sort key will overlap over features with a lower sort key.","sdk-support":{"basic functionality":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"},"data-driven styling":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},"viewport-y":{doc:"Sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},source:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, no sorting is applied; symbols are rendered in the same order as the source data."}},default:"auto",doc:"Determines whether overlapping symbols in the same layer are rendered in the order that they appear in the data source or by their y-position relative to the viewport. To control the order and prioritization of symbols otherwise, use `symbol-sort-key`.","sdk-support":{"basic functionality":{js:"0.49.0",android:"6.6.0",ios:"4.5.0",macos:"0.12.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,doc:"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,doc:"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line` or `line-center`, aligns icon x-axes with the line."},viewport:{doc:"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",doc:"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{doc:"The icon is displayed at its intrinsic aspect ratio."},width:{doc:"The icon is scaled in the x-dimension to fit the width of the text."},height:{doc:"The icon is scaled in the y-dimension to fit the height of the text."},both:{doc:"The icon is scaled in both x- and y-dimensions."}},default:"none",doc:"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"stretchable icons":{js:"1.6.0",android:"9.2.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",doc:"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",doc:"Name of image in sprite to use for drawing an image background.",tokens:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the icon clockwise.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,doc:"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],doc:"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{doc:"The center of the icon is placed closest to the anchor."},left:{doc:"The left side of the icon is placed closest to the anchor."},right:{doc:"The right side of the icon is placed closest to the anchor."},top:{doc:"The top of the icon is placed closest to the anchor."},bottom:{doc:"The bottom of the icon is placed closest to the anchor."},"top-left":{doc:"The top left corner of the icon is placed closest to the anchor."},"top-right":{doc:"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the icon is placed closest to the anchor."}},default:"center",doc:"Part of the icon placed closest to the anchor.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{doc:"The icon is aligned to the plane of the map."},viewport:{doc:"The icon is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto",doc:"Orientation of icon when map is pitched.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{doc:"The text is aligned to the plane of the map."},viewport:{doc:"The text is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `text-rotation-alignment`."}},default:"auto",doc:"Orientation of text when map is pitched.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line` or `line-center`, aligns text x-axes with the line."},viewport:{doc:"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,doc:"Value to use for a text label. If a plain `string` is provided, it will be treated as a `formatted` with default/inherited formatting options. SDF images are not supported in formatted text and will be ignored.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],doc:"Font stack to use for displaying text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",doc:"Font size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",doc:"The maximum line width for text wrapping.",requires:["text-field",{"symbol-placement":["point"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",doc:"Text leading value for multi-line text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",doc:"Text tracking amount.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{doc:"The text is aligned towards the anchor position."},left:{doc:"The text is aligned to the left."},center:{doc:"The text is centered."},right:{doc:"The text is aligned to the right."}},default:"center",doc:"Text justification options.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},auto:{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,doc:"Radial offset of text, in the direction of the symbol's anchor. Useful in combination with `text-variable-anchor`, which defaults to using the two-dimensional `text-offset` if present.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"},"data-driven styling":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},requires:["text-field",{"symbol-placement":["point"]}],doc:"To increase the chance of placing high-priority labels on the map, you can provide an array of `text-anchor` locations: the renderer will attempt to place the label at each location, in order, before moving onto the next label. Use `text-justify: auto` to choose justification based on anchor position. To apply an offset, use the `text-radial-offset` or the two-dimensional `text-offset`.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},default:"center",doc:"Part of the text placed closest to the anchor.",requires:["text-field",{"!":"text-variable-anchor"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",doc:"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{doc:"If a text's language supports horizontal writing mode, symbols would be laid out horizontally."},vertical:{doc:"If a text's language supports vertical writing mode, symbols would be laid out vertically."}},doc:"The property allows control over a symbol's orientation. Note that the property values act as a hint, so that a symbol whose language doesn\u2019t support the provided orientation will be laid out in its natural orientation. Example: English point symbol will be rendered horizontally even if array value contains single 'vertical' enum value. For symbol with point placement, the order of elements in an array define priority order for the placement of an orientation variant. For symbol with line placement, the default text writing mode is either ['horizontal', 'vertical'] or ['vertical', 'horizontal'], the order doesn't affect the placement.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"1.3.0",android:"8.3.0",ios:"5.3.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the text clockwise.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,doc:"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{doc:"The text is not altered."},uppercase:{doc:"Forces all letters to be displayed in uppercase."},lowercase:{doc:"Forces all letters to be displayed in lowercase."}},default:"none",doc:"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",doc:"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up. If used with text-variable-anchor, input values will be taken as absolute values. Offsets along the x- and y-axis will be applied automatically based on the anchor position.",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,doc:"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,doc:"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},filter:{type:"array",value:"*",doc:"A filter selects specific features from a layer."},filter_symbol:{type:"boolean",doc:'Expression which determines whether or not to display a symbol. Symbols support dynamic filtering, meaning this expression can use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},filter_fill:{type:"boolean",doc:'Expression which determines whether or not to display a polygon. Fill layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_line:{type:"boolean",doc:'Expression which determines whether or not to display a Polygon or LineString. Line layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_circle:{type:"boolean",doc:'Expression which determines whether or not to display a circle. Circle layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},"filter_fill-extrusion":{type:"boolean",doc:'Expression which determines whether or not to display a Polygon. Fill-extrusion layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:{type:"boolean",doc:'Expression used to determine whether a point is being displayed or not. Heatmap layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_operator:{type:"enum",values:{"==":{doc:'`["==", key, value]` equality: `feature[key] = value`'},"!=":{doc:'`["!=", key, value]` inequality: `feature[key] \u2260 value`'},">":{doc:'`[">", key, value]` greater than: `feature[key] > value`'},">=":{doc:'`[">=", key, value]` greater than or equal: `feature[key] \u2265 value`'},"<":{doc:'`["<", key, value]` less than: `feature[key] < value`'},"<=":{doc:'`["<=", key, value]` less than or equal: `feature[key] \u2264 value`'},in:{doc:'`["in", key, v0, ..., vn]` set inclusion: `feature[key] \u2208 {v0, ..., vn}`'},"!in":{doc:'`["!in", key, v0, ..., vn]` set exclusion: `feature[key] \u2209 {v0, ..., vn}`'},all:{doc:'`["all", f0, ..., fn]` logical `AND`: `f0 \u2227 ... \u2227 fn`'},any:{doc:'`["any", f0, ..., fn]` logical `OR`: `f0 \u2228 ... \u2228 fn`'},none:{doc:'`["none", f0, ..., fn]` logical `NOR`: `\xacf0 \u2227 ... \u2227 \xacfn`'},has:{doc:'`["has", key]` `feature[key]` exists'},"!has":{doc:'`["!has", key]` `feature[key]` does not exist'},within:{doc:'`["within", object]` feature geometry is within object geometry'}},doc:"The filter operator."},geometry_type:{type:"enum",values:{Point:{doc:"Filter to point geometries."},LineString:{doc:"Filter to line geometries."},Polygon:{doc:"Filter to polygon geometries."}},doc:"The geometry type for the filter to select."},function:{expression:{type:"expression",doc:"An expression."},stops:{type:"array",doc:"An array of stops.",value:"function_stop"},base:{type:"number",default:1,minimum:0,doc:"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."},property:{type:"string",doc:"The name of a feature property to use as the function input.",default:"$zoom"},type:{type:"enum",values:{identity:{doc:"Return the input value as the output value."},exponential:{doc:"Generate an output by interpolating between stops just less than and just greater than the function input."},interval:{doc:"Return the output value of the stop just less than the function input."},categorical:{doc:"Return the output value of the stop equal to the function input."}},doc:"The interpolation strategy to use in function evaluation.",default:"exponential"},colorSpace:{type:"enum",values:{rgb:{doc:"Use the RGB color space to interpolate color values"},lab:{doc:"Use the LAB color space to interpolate color values."},hcl:{doc:"Use the HCL color space to interpolate color values, interpolating the Hue, Chroma, and Luminance channels individually."}},doc:"The color space in which colors interpolated. Interpolating colors in perceptual color spaces like LAB and HCL tend to produce color ramps that look more consistent and produce colors that can be differentiated more easily than those interpolated in RGB space.",default:"rgb"},default:{type:"*",required:!1,doc:"A value to serve as a fallback function result when a value isn't otherwise available. It is used in the following circumstances:\n* In categorical functions, when the feature value does not match any of the stop domain values.\n* In property and zoom-and-property functions, when a feature does not contain a value for the specified property.\n* In identity functions, when the feature value is not valid for the style property (for example, if the function is being used for a `circle-color` property but the feature property value is not a string or not a valid color).\n* In interval or exponential property and zoom-and-property functions, when the feature value is not numeric.\nIf no default is provided, the style property's default is used in these circumstances."}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2,doc:"Zoom level and value pair."},expression:{type:"array",value:"*",minimum:1,doc:"An expression defines a function that can be used for data-driven style properties or feature filters."},expression_name:{doc:"",type:"enum",values:{let:{doc:'Binds expressions to named variables, which can then be referenced in the result expression using ["var", "variable_name"].',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},var:{doc:'References variable bound using "let".',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},literal:{doc:"Provides a literal array or object value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},array:{doc:"Asserts that the input is an array (optionally with a specific item type and length).  If, when the input expression is evaluated, it is not of the asserted type, then this assertion will cause the whole expression to be aborted.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},at:{doc:"Retrieves an item from an array.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},in:{doc:"Determines whether an item exists in an array or a substring exists in a string. In the specific case when the second and third arguments are string literals, you must wrap at least one of them in a [`literal`](#types-literal) expression to hint correct interpretation to the [type system](#type-system).",group:"Lookup","sdk-support":{"basic functionality":{js:"1.6.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"index-of":{doc:"Returns the first position at which an item can be found in an array or a substring can be found in a string, or `-1` if the input cannot be found. Accepts an optional index from where to begin the search.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0"}}},slice:{doc:"Returns an item from an array or a substring from a string from a specified start index, or between a start index and an end index if set. The return value is inclusive of the start index but not of the end index.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0"}}},case:{doc:"Selects the first output whose corresponding test condition evaluates to true, or the fallback value otherwise.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},match:{doc:'Selects the output for which the label value matches the input value, or the fallback value if no match is found. The input can be any expression (for example, `["get", "building_type"]`). Each label must be unique, and must be either:\n - a single literal value; or\n - an array of literal values, the values of which must be all strings or all numbers (for example `[100, 101]` or `["c", "b"]`).\n\nThe input matches if any of the values in the array matches using strict equality, similar to the `"in"` operator.\nIf the input type does not match the type of the labels, the result will be the fallback value.',group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},coalesce:{doc:"Evaluates each expression in turn until the first valid value is obtained. Invalid values are `null` and [`'image'`](#types-image) expressions that are unavailable in the style. If all values are invalid, `coalesce` returns the first value listed.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},step:{doc:'Produces discrete, stepped results by evaluating a piecewise-constant function defined by pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. Returns the output value of the stop just less than the input, or the first output if the input is less than the first stop.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},interpolate:{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. The output type must be `number`, `array<number>`, or `color`.\n\nInterpolation types:\n- `["linear"]`: Interpolates linearly between the pair of stops just less than and just greater than the input.\n- `["exponential", base]`: Interpolates exponentially between the stops just less than and just greater than the input. `base` controls the rate at which the output increases: higher values make the output increase more towards the high end of the range. With values close to 1 the output increases linearly.\n- `["cubic-bezier", x1, y1, x2, y2]`: Interpolates using the cubic bezier curve defined by the given control points.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"interpolate-hcl":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the Hue-Chroma-Luminance color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},"interpolate-lab":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the CIELAB color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},ln2:{doc:"Returns mathematical constant ln(2).",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pi:{doc:"Returns the mathematical constant pi.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},e:{doc:"Returns the mathematical constant e.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},typeof:{doc:"Returns a string describing the type of the given value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},string:{doc:"Asserts that the input value is a string. If multiple values are provided, each one is evaluated in order until a string is obtained. If none of the inputs are strings, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},number:{doc:"Asserts that the input value is a number. If multiple values are provided, each one is evaluated in order until a number is obtained. If none of the inputs are numbers, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},boolean:{doc:"Asserts that the input value is a boolean. If multiple values are provided, each one is evaluated in order until a boolean is obtained. If none of the inputs are booleans, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},object:{doc:"Asserts that the input value is an object. If multiple values are provided, each one is evaluated in order until an object is obtained. If none of the inputs are objects, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},collator:{doc:"Returns a `collator` for use in locale-dependent comparison operations. The `case-sensitive` and `diacritic-sensitive` options default to `false`. The `locale` argument specifies the IETF language tag of the locale to use. If none is provided, the default locale is used. If the requested locale is not available, the `collator` will use a system-defined fallback locale. Use `resolved-locale` to test the results of locale fallback behavior.",group:"Types","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},format:{doc:'Returns a `formatted` string for displaying mixed-format text in the `text-field` property. The input may contain a string literal or expression, including an [`\'image\'`](#types-image) expression. Strings may be followed by a style override object that supports the following properties:\n- `"text-font"`: Overrides the font stack specified by the root layout property.\n- `"text-color"`: Overrides the color specified by the root paint property.\n- `"font-scale"`: Applies a scaling factor on `text-size` as specified by the root layout property.',group:"Types","sdk-support":{"basic functionality":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-font":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"font-scale":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-color":{js:"1.3.0",android:"7.3.0",ios:"4.10.0",macos:"0.14.0"},image:{js:"1.6.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},image:{doc:"Returns a [`ResolvedImage`](/mapbox-gl-js/style-spec/types/#resolvedimage) for use in [`icon-image`](/mapbox-gl-js/style-spec/layers/#layout-symbol-icon-image), `*-pattern` entries, and as a section in the [`'format'`](#types-format) expression. A [`'coalesce'`](#coalesce) expression containing `image` expressions will evaluate to the first listed image that is currently in the style. This validation process is synchronous and requires the image to have been added to the style before requesting it in the `'image'` argument.",group:"Types","sdk-support":{"basic functionality":{js:"1.4.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},"number-format":{doc:"Converts the input number into a string representation using the providing formatting rules. If set, the `locale` argument specifies the locale to use, as a BCP 47 language tag. If set, the `currency` argument specifies an ISO 4217 code to use for currency-style formatting. If set, the `min-fraction-digits` and `max-fraction-digits` arguments specify the minimum and maximum number of fractional digits to include.",group:"Types","sdk-support":{"basic functionality":{js:"0.54.0",android:"8.4.0",ios:"5.4.0",macos:"0.15.0"}}},"to-string":{doc:'Converts the input value to a string. If the input is `null`, the result is `""`. If the input is a [`boolean`](#types-boolean), the result is `"true"` or `"false"`. If the input is a number, it is converted to a string as specified by the ["NumberToString" algorithm](https://tc39.github.io/ecma262/#sec-tostring-applied-to-the-number-type) of the ECMAScript Language Specification. If the input is a [`color`](#color), it is converted to a string of the form `"rgba(r,g,b,a)"`, where `r`, `g`, and `b` are numerals ranging from 0 to 255, and `a` ranges from 0 to 1. If the input is an [`\'image\'`](#types-image) expression, `\'to-string\'` returns the image name. Otherwise, the input is converted to a string in the format specified by the [`JSON.stringify`](https://tc39.github.io/ecma262/#sec-json.stringify) function of the ECMAScript Language Specification.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-number":{doc:'Converts the input value to a number, if possible. If the input is `null` or `false`, the result is 0. If the input is `true`, the result is 1. If the input is a string, it is converted to a number as specified by the ["ToNumber Applied to the String Type" algorithm](https://tc39.github.io/ecma262/#sec-tonumber-applied-to-the-string-type) of the ECMAScript Language Specification. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-boolean":{doc:"Converts the input value to a boolean. The result is `false` when then input is an empty string, 0, `false`, `null`, or `NaN`; otherwise it is `true`.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-rgba":{doc:"Returns a four-element array containing the input color's red, green, blue, and alpha components, in that order.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-color":{doc:"Converts the input value to a color. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgb:{doc:"Creates a color value from red, green, and blue components, which must range between 0 and 255, and an alpha component of 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgba:{doc:"Creates a color value from red, green, blue components, which must range between 0 and 255, and an alpha component which must range between 0 and 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},get:{doc:"Retrieves a property value from the current feature's properties, or from another object if a second argument is provided. Returns `null` if the requested property is missing.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},has:{doc:"Tests for the presence of an property value in the current feature's properties, or from another object if a second argument is provided.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},length:{doc:"Returns the length of an array or string.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},properties:{doc:'Returns the feature properties object.  Note that in some cases, it may be more efficient to use `["get", "property_name"]` directly.',group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"feature-state":{doc:"Retrieves a property value from the current feature's state. Returns `null` if the requested property is not present on the feature's state. A feature's state is not part of the GeoJSON or vector tile data, and must be set programmatically on each feature. Features are identified by their `id` attribute, which must be an integer or a string that can be cast to an integer. Note that [\"feature-state\"] can only be used with paint properties that support data-driven styling.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.46.0"}}},"geometry-type":{doc:"Returns the feature's geometry type: `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`. `Multi*` feature types are only returned in GeoJSON sources. When working with vector tile sources, use the singular forms.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},id:{doc:"Returns the feature's id, if it has one.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},zoom:{doc:'Returns the current zoom level.  Note that in style layout and paint properties, ["zoom"] may only appear as the input to a top-level "step" or "interpolate" expression.',group:"Camera","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pitch:{doc:'Returns the current pitch in degrees. `["pitch"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0"}}},"distance-from-center":{doc:'Returns the distance of a `symbol` instance from the center of the map. The distance is measured in pixels divided by the height of the map container. It measures 0 at the center, decreases towards the camera and increase away from the camera. For example, if the height of the map is 1000px, a value of -1 means 1000px away from the center towards the camera, and a value of 1 means a distance of 1000px away from the camera from the center. `["distance-from-center"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0"}}},"heatmap-density":{doc:"Returns the kernel density estimation of a pixel in a heatmap layer, which is a relative measure of how many data points are crowded around a particular pixel. Can only be used in the `heatmap-color` property.",group:"Heatmap","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"line-progress":{doc:"Returns the progress along a gradient line. Can only be used in the `line-gradient` property.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.6.0",macos:"0.12.0"}}},"sky-radial-progress":{doc:"Returns the distance of a point on the sky from the sun position. Returns 0 at sun position and 1 when the distance reaches `sky-gradient-radius`. Can only be used in the `sky-gradient` property.",group:"sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},accumulated:{doc:"Returns the value of a cluster property accumulated so far. Can only be used in the `clusterProperties` option of a clustered GeoJSON source.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.53.0",android:"8.4.0",ios:"5.5.0",macos:"0.15.0"}}},"+":{doc:"Returns the sum of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"*":{doc:"Returns the product of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"-":{doc:"For two inputs, returns the result of subtracting the second input from the first. For a single input, returns the result of subtracting it from 0.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"/":{doc:"Returns the result of floating point division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"%":{doc:"Returns the remainder after integer division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"^":{doc:"Returns the result of raising the first input to the power specified by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sqrt:{doc:"Returns the square root of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log10:{doc:"Returns the base-ten logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ln:{doc:"Returns the natural logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log2:{doc:"Returns the base-two logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sin:{doc:"Returns the sine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},cos:{doc:"Returns the cosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},tan:{doc:"Returns the tangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},asin:{doc:"Returns the arcsine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},acos:{doc:"Returns the arccosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},atan:{doc:"Returns the arctangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},min:{doc:"Returns the minimum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},max:{doc:"Returns the maximum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},round:{doc:'Rounds the input to the nearest integer. Halfway values are rounded away from zero. For example, `["round", -1.5]` evaluates to -2.',group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},abs:{doc:"Returns the absolute value of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ceil:{doc:"Returns the smallest integer that is greater than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},floor:{doc:"Returns the largest integer that is less than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},distance:{doc:"Returns the shortest distance in meters between the evaluated feature and the input geometry. The input value can be a valid GeoJSON of type `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Distance values returned may vary in precision due to loss in precision from encoding geometries, particularly below zoom level 13.",group:"Math","sdk-support":{"basic functionality":{android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}}},"==":{doc:"Returns `true` if the input values are equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"!=":{doc:"Returns `true` if the input values are not equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">":{doc:"Returns `true` if the first input is strictly greater than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<":{doc:"Returns `true` if the first input is strictly less than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">=":{doc:"Returns `true` if the first input is greater than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<=":{doc:"Returns `true` if the first input is less than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},all:{doc:"Returns `true` if all the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `false`, the result is `false` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},any:{doc:"Returns `true` if any of the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `true`, the result is `true` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"!":{doc:"Logical negation. Returns `true` if the input is `false`, and `false` if the input is `true`.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},within:{doc:"Returns `true` if the evaluated feature is fully contained inside a boundary of the input geometry, `false` otherwise. The input value can be a valid GeoJSON of type `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Supported features for evaluation:\n- `Point`: Returns `false` if a point is on the boundary or falls outside the boundary.\n- `LineString`: Returns `false` if any part of a line falls outside the boundary, the line intersects the boundary, or a line's endpoint is on the boundary.",group:"Decision","sdk-support":{"basic functionality":{js:"1.9.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"is-supported-script":{doc:"Returns `true` if the input string is expected to render legibly. Returns `false` if the input string contains sections that cannot be rendered without potential loss of meaning (e.g. Indic scripts that require complex text shaping, or right-to-left scripts if the the `mapbox-gl-rtl-text` plugin is not in use in Mapbox GL JS).",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.6.0"}}},upcase:{doc:"Returns the input string converted to uppercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},downcase:{doc:"Returns the input string converted to lowercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},concat:{doc:"Returns a `string` consisting of the concatenation of the inputs. Each input is converted to a string as if by `to-string`.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"resolved-locale":{doc:"Returns the IETF language tag of the locale being used by the provided `collator`. This can be used to determine the default system locale, or to determine if a requested locale was successfully loaded.",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}}}},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"The start and end distance range in which fog fades from fully transparent to fully opaque. The distance to the point at the center of the map is defined as zero, so that negative range values are closer to the camera, and positive values are farther away.",example:[.5,10],"sdk-support":{"basic functionality":{js:"2.3.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the fog. Using opacity is recommended only for smoothly transitioning fog on/off as anything less than 100% opacity results in more tiles loaded and drawn.","sdk-support":{"basic functionality":{js:"2.3.0"}}},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Horizon blend applies a smooth fade from the color of the fog to the color of the sky. A value of zero leaves a sharp transition from fog to sky. Increasing the value blends the color of fog into increasingly high angles of the sky.","sdk-support":{"basic functionality":{js:"2.3.0"}}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{doc:"The position of the light source is aligned to the rotation of the map."},viewport:{doc:"The position of the light source is aligned to the rotation of the viewport."}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},doc:"Whether extruded geometries are lit relative to the map or viewport.",example:"map","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"Position of the light source relative to lit (extruded) geometries, in [r radial coordinate, a azimuthal angle, p polar angle] where r indicates the distance from the center of the base of an object to its light, a indicates the position of the light relative to 0\xb0 (0\xb0 when `light.anchor` is set to `viewport` corresponds to the top of the viewport, or 0\xb0 when `light.anchor` is set to `map` corresponds to due north, and degrees proceed clockwise), and p indicates the height of the light (from 0\xb0, directly above, to 180\xb0, directly below).",example:[1.5,90,80],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Color tint for lighting extruded geometries.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Intensity of lighting (on a scale from 0 to 1). Higher numbers will present as more extreme contrast.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}}},projection:{name:{type:"enum",values:{albers:{doc:"An Albers equal-area projection centered on the continental United States. You can configure the projection for a different region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},equalEarth:{doc:"An Equal Earth projection."},equirectangular:{doc:"An Equirectangular projection. This projection is very similar to the Plate Carr\xe9e projection."},lambertConformalConic:{doc:"A Lambert conformal conic projection. You can configure the projection for a region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},mercator:{doc:"The Mercator projection is the default projection."},naturalEarth:{doc:"A Natural Earth projection."},winkelTripel:{doc:"A Winkel Tripel projection."}},default:"mercator",doc:"The name of the projection to be used for rendering the map.",required:!0,"sdk-support":{"basic functionality":{js:"2.6.0"}}},center:{type:"array",length:2,value:"number","property-type":"data-constant",transition:!1,doc:"The reference longitude and latitude of the projection. `center` takes the form of [lng, lat]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic). All other projections are centered on [0, 0].",example:[-96,37.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",transition:!1,doc:"The standard parallels of the projection, denoting the desired latitude range with minimal distortion. `parallels` takes the form of [lat0, lat1]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic).",example:[29.5,45.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}}},terrain:{source:{type:"string",doc:"Name of a source of `raster_dem` type to be used for terrain elevation.",required:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Exaggerates the elevation of the terrain by multiplying the data from the DEM with this value.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,doc:"Whether or not the fill should be antialiased.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill layer. In contrast to the `fill-color`, this value will also affect the 1px stroke around the fill, if the stroke is used.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",doc:"The color of the filled part of this layer. This color can be specified as `rgba` with an alpha component and the color's opacity will not affect the opacity of the 1px stroke, if it is used.",transition:!0,requires:[{"!":"fill-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",doc:"The outline color of the fill. Matches the value of `fill-color` if unspecified.",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{doc:"The fill is translated relative to the map."},viewport:{doc:"The fill is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-translate`.",default:"map",requires:["fill-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing image fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill extrusion layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",doc:"The base color of the extruded fill. The extrusion's surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `fill-extrusion-opacity` to set layer opacity.",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{doc:"The fill extrusion is translated relative to the map."},viewport:{doc:"The fill extrusion is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-extrusion-translate`.",default:"map",requires:["fill-extrusion-translate"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude this layer.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude the base of this layer. Must be less than or equal to `fill-extrusion-height`.",transition:!0,requires:["fill-extrusion-height"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,doc:"Whether to apply a vertical gradient to the sides of a fill-extrusion layer. If true, sides will be shaded slightly darker farther down.",transition:!1,"sdk-support":{"basic functionality":{js:"0.50.0",android:"7.0.0",ios:"4.7.0",macos:"0.13.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",doc:"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",doc:"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.23.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{doc:"The line is translated relative to the map."},viewport:{doc:"The line is translated relative to the viewport."}},doc:"Controls the frame of reference for `line-translate`.",default:"map",requires:["line-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",doc:"Stroke thickness.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,doc:"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,doc:"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.12.1",android:"3.0.0",ios:"3.1.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Blur applied to the line, in pixels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",doc:"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width. Note that GeoJSON sources with `lineMetrics: true` specified won't render dashed lines to the expected scale. Also note that zoom-dependent expressions will be evaluated only at integer zoom levels.",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",doc:'Defines a gradient with which to color a line feature. Can only be used with GeoJSON sources that specify `"lineMetrics": true`.',transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],"sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.4.0",macos:"0.11.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",doc:"Circle radius.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",doc:"The fill color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,doc:"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",doc:"The opacity at which the circle will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{doc:"The circle is translated relative to the map."},viewport:{doc:"The circle is translated relative to the viewport."}},doc:"Controls the frame of reference for `circle-translate`.",default:"map",requires:["circle-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{doc:"Circles are scaled according to their apparent distance to the camera."},viewport:{doc:"Circles are not scaled."}},default:"map",doc:"Controls the scaling behavior of the circle when the map is pitched.","sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{doc:"The circle is aligned to the plane of the map."},viewport:{doc:"The circle is aligned to the plane of the viewport."}},default:"viewport",doc:"Orientation of circle when map is pitched.","sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The width of the circle's stroke. Strokes are placed outside of the `circle-radius`.","sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",doc:"The stroke color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",doc:"The opacity of the circle's stroke.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",doc:"Radius of influence of one heatmap point in pixels. Increasing the value makes the heatmap smoother, but less detailed. `queryRenderedFeatures` on heatmap layers will return points within this radius.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,doc:"A measure of how much an individual point contributes to the heatmap. A value of 10 would be equivalent to having 10 points of weight 1 in the same spot. Especially useful when combined with clustering.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,doc:"Similar to `heatmap-weight` but controls the intensity of the heatmap globally. Primarily used for adjusting the heatmap based on zoom level.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],doc:'Defines the color of each pixel based on its density value in a heatmap.  Should be an expression that uses `["heatmap-density"]` as input.',transition:!1,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",doc:"The global opacity at which the heatmap layer will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{doc:"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,doc:"The color of the icon. This can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the icon's halo. Icon halos can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the icon outline.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Fade out the halo towards the outside.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{doc:"Icons are translated relative to the map."},viewport:{doc:"Icons are translated relative to the viewport."}},doc:"Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",doc:"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",doc:"The color with which the text will be drawn.",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The halo's fadeout distance towards the outside.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{doc:"The text is translated relative to the map."},viewport:{doc:"The text is translated relative to the viewport."}},doc:"Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",doc:"The opacity at which the image will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",doc:"Rotates hues around the color wheel.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the minimum brightness.",default:0,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the maximum brightness.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",doc:"Increase or reduce the saturation of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",doc:"Increase or reduce the contrast of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",doc:"The resampling/interpolation method to use for overscaling, also known as texture magnification filter",values:{linear:{doc:"(Bi)linear filtering interpolates pixel values using the weighted average of the four closest original source pixels creating a smooth but blurry look when overscaled"},nearest:{doc:"Nearest neighbor filtering interpolates pixel values using the nearest original source pixel creating a sharp but pixelated look when overscaled"}},default:"linear","sdk-support":{"basic functionality":{js:"0.47.0",android:"6.3.0",ios:"4.2.0",macos:"0.9.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",doc:"Fade duration when a new tile is added.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,doc:"The direction of the light source used to generate the hillshading with 0 as the top of the viewport if `hillshade-illumination-anchor` is set to `viewport` and due north if `hillshade-illumination-anchor` is set to `map`.",transition:!1,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{doc:"The hillshade illumination is relative to the north direction."},viewport:{doc:"The hillshade illumination is relative to the top of the viewport."}},default:"viewport",doc:"Direction of light source when map is rotated.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",doc:"Intensity of the hillshade",default:.5,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",doc:"The shading color of areas that face away from the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",doc:"The shading color of areas that faces towards the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",doc:"The shading color used to accentuate rugged terrain like sharp cliffs and gorges.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",doc:"The color with which the background will be drawn.",transition:!0,requires:[{"!":"background-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing an image background. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity at which the background will be drawn.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{doc:"Renders the sky with a gradient that can be configured with `sky-gradient-radius` and `sky-gradient`."},atmosphere:{doc:"Renders the sky with a simulated atmospheric scattering algorithm, the sun direction can be attached to the light position or explicitly set through `sky-atmosphere-sun`."}},default:"atmosphere",doc:"The type of the sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the sun center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the sun relative to 0\xb0 north, where degrees proceed clockwise. The polar angle indicates the height of the sun, where 0\xb0 is directly above, at zenith, and 90\xb0 at the horizon. When this property is ommitted, the sun center is directly inherited from the light position.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,doc:"Intensity of the sun as a light source in the atmosphere (on a scale from 0 to a 100). Setting higher values will brighten up the sky.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the gradient center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the gradient center relative to 0\xb0 north, where degrees proceed clockwise. The polar angle indicates the height of the gradient center, where 0\xb0 is directly above, at zenith, and 90\xb0 at the horizon.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,doc:"The angular distance (measured in degrees) from `sky-gradient-center` up to which the gradient extends. A value of 180 causes the gradient to wrap around to the opposite direction from `sky-gradient-center`.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],doc:"Defines a radial color gradient with which to color the sky. The color values can be interpolated with an expression using `sky-radial-progress`. The range [0, 1] for the interpolant covers a radial distance (in degrees) of [0, `sky-gradient-radius`] centered at the position specified by `sky-gradient-center`.",transition:!1,requires:[{"sky-type":"gradient"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",doc:"A color applied to the atmosphere sun halo. The alpha channel describes how strongly the sun halo is represented in an atmosphere sky layer.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",doc:"A color used to tweak the main atmospheric scattering coefficients. Using white applies the default coefficients giving the natural blue color to the atmosphere. This color affects how heavily the corresponding wavelength is represented during scattering. The alpha channel describes the density of the atmosphere, with 1 maximum density and 0 no density.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire sky layer.",transition:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds",doc:"Time allotted for transitions to complete."},delay:{type:"number",default:0,minimum:0,units:"milliseconds",doc:"Length of time before a transition begins."}},"property-type":{"data-driven":{type:"property-type",doc:"Property is interpolable and can be represented using a property expression."},"cross-faded":{type:"property-type",doc:"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms."},"cross-faded-data-driven":{type:"property-type",doc:"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms. It can be represented using a property expression."},"color-ramp":{type:"property-type",doc:"Property should be specified using a color ramp from which the output color can be sampled based on a property calculation."},"data-constant":{type:"property-type",doc:"Property is interpolable but cannot be represented using a property expression."},constant:{type:"property-type",doc:"Property is constant across all zoom levels and property values."}},promoteId:{"*":{type:"string",doc:"A name of a feature property to use as ID for feature state."}}},Ol="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function gu(O){var P={exports:{}};return O(P,P.exports),P.exports}function _l(O){throw new Error('Could not dynamically require "'+O+'". Please configure the dynamicRequireTargets option of @rollup/plugin-commonjs appropriately for this require call to behave properly.')}var Na=gu(function(O,P){!function(z){var K=P&&!P.nodeType&&P,he=O&&!O.nodeType&&O,fe="object"==typeof Ol&&Ol;(fe.global===fe||fe.window===fe||fe.self===fe)&&(z=fe);var Ie,ci,Fe=2147483647,Xr=/^xn--/,Sr=/[^\x20-\x7E]/,en=/[\x2E\u3002\uFF0E\uFF61]/g,Vn={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},Br=Math.floor,ei=String.fromCharCode;function qa(hr){throw RangeError(Vn[hr])}function ai(hr,ti){for(var wi=hr.length,Uo=[];wi--;)Uo[wi]=ti(hr[wi]);return Uo}function Iu(hr,ti){var wi=hr.split("@"),Uo="";return wi.length>1&&(Uo=wi[0]+"@",hr=wi[1]),Uo+ai((hr=hr.replace(en,".")).split("."),ti).join(".")}function Xu(hr){for(var To,Qa,ti=[],wi=0,Uo=hr.length;wi<Uo;)(To=hr.charCodeAt(wi++))>=55296&&To<=56319&&wi<Uo?56320==(64512&(Qa=hr.charCodeAt(wi++)))?ti.push(((1023&To)<<10)+(1023&Qa)+65536):(ti.push(To),wi--):ti.push(To);return ti}function fc(hr){return ai(hr,function(ti){var wi="";return ti>65535&&(wi+=ei((ti-=65536)>>>10&1023|55296),ti=56320|1023&ti),wi+ei(ti)}).join("")}function el(hr){return hr-48<10?hr-22:hr-65<26?hr-65:hr-97<26?hr-97:36}function Sa(hr,ti){return hr+22+75*(hr<26)-((0!=ti)<<5)}function Mu(hr,ti,wi){var Uo=0;for(hr=wi?Br(hr/700):hr>>1,hr+=Br(hr/ti);hr>455;Uo+=36)hr=Br(hr/35);return Br(Uo+36*hr/(hr+38))}function Gl(hr){var Uo,es,mc,Go,su,ms,Ah,ko,na,Au,ti=[],wi=hr.length,To=0,Qa=128,Vo=72;for((es=hr.lastIndexOf("-"))<0&&(es=0),mc=0;mc<es;++mc)hr.charCodeAt(mc)>=128&&qa("not-basic"),ti.push(hr.charCodeAt(mc));for(Go=es>0?es+1:0;Go<wi;){for(su=To,ms=1,Ah=36;Go>=wi&&qa("invalid-input"),((ko=el(hr.charCodeAt(Go++)))>=36||ko>Br((Fe-To)/ms))&&qa("overflow"),To+=ko*ms,!(ko<(na=Ah<=Vo?1:Ah>=Vo+26?26:Ah-Vo));Ah+=36)ms>Br(Fe/(Au=36-na))&&qa("overflow"),ms*=Au;Vo=Mu(To-su,Uo=ti.length+1,0==su),Br(To/Uo)>Fe-Qa&&qa("overflow"),Qa+=Br(To/Uo),To%=Uo,ti.splice(To++,0,Qa)}return fc(ti)}function Id(hr){var ti,wi,Uo,To,Qa,Vo,es,mc,Go,su,ms,ko,na,Au,Md,Ah=[];for(ko=(hr=Xu(hr)).length,ti=128,wi=0,Qa=72,Vo=0;Vo<ko;++Vo)(ms=hr[Vo])<128&&Ah.push(ei(ms));for(Uo=To=Ah.length,To&&Ah.push("-");Uo<ko;){for(es=Fe,Vo=0;Vo<ko;++Vo)(ms=hr[Vo])>=ti&&ms<es&&(es=ms);for(es-ti>Br((Fe-wi)/(na=Uo+1))&&qa("overflow"),wi+=(es-ti)*na,ti=es,Vo=0;Vo<ko;++Vo)if((ms=hr[Vo])<ti&&++wi>Fe&&qa("overflow"),ms==ti){for(mc=wi,Go=36;!(mc<(su=Go<=Qa?1:Go>=Qa+26?26:Go-Qa));Go+=36)Ah.push(ei(Sa(su+(Md=mc-su)%(Au=36-su),0))),mc=Br(Md/Au);Ah.push(ei(Sa(mc,0))),Qa=Mu(wi,na,Uo==To),wi=0,++Uo}++wi,++ti}return Ah.join("")}if(Ie={version:"1.3.2",ucs2:{decode:Xu,encode:fc},decode:Gl,encode:Id,toASCII:function(hr){return Iu(hr,function(ti){return Sr.test(ti)?"xn--"+Id(ti):ti})},toUnicode:function(hr){return Iu(hr,function(ti){return Xr.test(ti)?Gl(ti.slice(4).toLowerCase()):ti})}},K&&he)if(O.exports==K)he.exports=Ie;else for(ci in Ie)Ie.hasOwnProperty(ci)&&(K[ci]=Ie[ci]);else z.punycode=Ie}(Ol)}),la_isString=function(O){return"string"==typeof O},la_isObject=function(O){return"object"==typeof O&&null!==O},la_isNull=function(O){return null===O};function al(O,P){return Object.prototype.hasOwnProperty.call(O,P)}var Uh=function(O,P,z,K){z=z||"=";var he={};if("string"!=typeof O||0===O.length)return he;var fe=/\+/g;O=O.split(P=P||"&");var Ie=1e3;K&&"number"==typeof K.maxKeys&&(Ie=K.maxKeys);var Fe=O.length;Ie>0&&Fe>Ie&&(Fe=Ie);for(var at=0;at<Fe;++at){var Pt,cn,Sn,ar,nt=O[at].replace(fe,"%20"),jt=nt.indexOf(z);jt>=0?(Pt=nt.substr(0,jt),cn=nt.substr(jt+1)):(Pt=nt,cn=""),Sn=decodeURIComponent(Pt),ar=decodeURIComponent(cn),al(he,Sn)?Array.isArray(he[Sn])?he[Sn].push(ar):he[Sn]=[he[Sn],ar]:he[Sn]=ar}return he},Ys=function(O){switch(typeof O){case"string":return O;case"boolean":return O?"true":"false";case"number":return isFinite(O)?O:"";default:return""}},Ns=function(O,P,z,K){return P=P||"&",z=z||"=",null===O&&(O=void 0),"object"==typeof O?Object.keys(O).map(function(he){var fe=encodeURIComponent(Ys(he))+z;return Array.isArray(O[he])?O[he].map(function(Ie){return fe+encodeURIComponent(Ys(Ie))}).join(P):fe+encodeURIComponent(Ys(O[he]))}).join(P):K?encodeURIComponent(Ys(K))+z+encodeURIComponent(Ys(O)):""},Kc=gu(function(O,P){P.decode=P.parse=Uh,P.encode=P.stringify=Ns});function Ss(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Qc=/^([a-z0-9.+-]+:)/i,Nu=/:[0-9]*$/,_h=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,Kl=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),Jl=["'"].concat(Kl),Ll=["%","/","?",";","#"].concat(Jl),Da=["/","?","#"],be=/^[+a-z0-9A-Z_-]{0,63}$/,De=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Oe={javascript:!0,"javascript:":!0},se={javascript:!0,"javascript:":!0},te={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function On(O,...P){for(const z of P)for(const K in z)O[K]=z[K];return O}Ss.prototype.parse=function(O,P,z){if(!la_isString(O))throw new TypeError("Parameter 'url' must be a string, not "+typeof O);var K=O.indexOf("?"),he=-1!==K&&K<O.indexOf("#")?"?":"#",fe=O.split(he);fe[0]=fe[0].replace(/\\/g,"/");var Fe=O=fe.join(he);if(Fe=Fe.trim(),!z&&1===O.split("#").length){var at=_h.exec(Fe);if(at)return this.path=Fe,this.href=Fe,this.pathname=at[1],at[2]?(this.search=at[2],this.query=P?Kc.parse(this.search.substr(1)):this.search.substr(1)):P&&(this.search="",this.query={}),this}var nt=Qc.exec(Fe);if(nt){var jt=(nt=nt[0]).toLowerCase();this.protocol=jt,Fe=Fe.substr(nt.length)}if(z||nt||Fe.match(/^\/\/[^@\/]+@[^@\/]+/)){var Pt="//"===Fe.substr(0,2);Pt&&(!nt||!se[nt])&&(Fe=Fe.substr(2),this.slashes=!0)}if(!se[nt]&&(Pt||nt&&!te[nt])){for(var cn=-1,Sn=0;Sn<Da.length;Sn++)-1!==(ar=Fe.indexOf(Da[Sn]))&&(-1===cn||ar<cn)&&(cn=ar);var xn,Xr;for(-1!==(Xr=-1===cn?Fe.lastIndexOf("@"):Fe.lastIndexOf("@",cn))&&(xn=Fe.slice(0,Xr),Fe=Fe.slice(Xr+1),this.auth=decodeURIComponent(xn)),cn=-1,Sn=0;Sn<Ll.length;Sn++){var ar;-1!==(ar=Fe.indexOf(Ll[Sn]))&&(-1===cn||ar<cn)&&(cn=ar)}-1===cn&&(cn=Fe.length),this.host=Fe.slice(0,cn),Fe=Fe.slice(cn),this.parseHost(),this.hostname=this.hostname||"";var Sr="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!Sr)for(var en=this.hostname.split(/\./),Vn=(Sn=0,en.length);Sn<Vn;Sn++){var yr=en[Sn];if(yr&&!yr.match(be)){for(var Br="",ei=0,ci=yr.length;ei<ci;ei++)yr.charCodeAt(ei)>127?Br+="x":Br+=yr[ei];if(!Br.match(be)){var qa=en.slice(0,Sn),ai=en.slice(Sn+1),Iu=yr.match(De);Iu&&(qa.push(Iu[1]),ai.unshift(Iu[2])),ai.length&&(Fe="/"+ai.join(".")+Fe),this.hostname=qa.join(".");break}}}this.hostname=this.hostname.length>255?"":this.hostname.toLowerCase(),Sr||(this.hostname=Na.toASCII(this.hostname)),this.host=(this.hostname||"")+(this.port?":"+this.port:""),this.href+=this.host,Sr&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==Fe[0]&&(Fe="/"+Fe))}if(!Oe[jt])for(Sn=0,Vn=Jl.length;Sn<Vn;Sn++){var el=Jl[Sn];if(-1!==Fe.indexOf(el)){var Sa=encodeURIComponent(el);Sa===el&&(Sa=escape(el)),Fe=Fe.split(el).join(Sa)}}var Mu=Fe.indexOf("#");-1!==Mu&&(this.hash=Fe.substr(Mu),Fe=Fe.slice(0,Mu));var Gl=Fe.indexOf("?");return-1!==Gl?(this.search=Fe.substr(Gl),this.query=Fe.substr(Gl+1),P&&(this.query=Kc.parse(this.query)),Fe=Fe.slice(0,Gl)):P&&(this.search="",this.query={}),Fe&&(this.pathname=Fe),te[jt]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(this.path=(this.pathname||"")+(this.search||"")),this.href=this.format(),this},Ss.prototype.format=function(){var O=this.auth||"";O&&(O=(O=encodeURIComponent(O)).replace(/%3A/i,":"),O+="@");var P=this.protocol||"",z=this.pathname||"",K=this.hash||"",he=!1,fe="";this.host?he=O+this.host:this.hostname&&(he=O+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(he+=":"+this.port)),this.query&&la_isObject(this.query)&&Object.keys(this.query).length&&(fe=Kc.stringify(this.query));var Ie=this.search||fe&&"?"+fe||"";return P&&":"!==P.substr(-1)&&(P+=":"),this.slashes||(!P||te[P])&&!1!==he?(he="//"+(he||""),z&&"/"!==z.charAt(0)&&(z="/"+z)):he||(he=""),K&&"#"!==K.charAt(0)&&(K="#"+K),Ie&&"?"!==Ie.charAt(0)&&(Ie="?"+Ie),P+he+(z=z.replace(/[?#]/g,function(Fe){return encodeURIComponent(Fe)}))+(Ie=Ie.replace("#","%23"))+K},Ss.prototype.resolve=function(O){return this.resolveObject(function(O,P,z){if(O&&la_isObject(O)&&O instanceof Ss)return O;var K=new Ss;return K.parse(O,P,z),K}(O,!1,!0)).format()},Ss.prototype.resolveObject=function(O){if(la_isString(O)){var P=new Ss;P.parse(O,!1,!0),O=P}for(var z=new Ss,K=Object.keys(this),he=0;he<K.length;he++){var fe=K[he];z[fe]=this[fe]}if(z.hash=O.hash,""===O.href)return z.href=z.format(),z;if(O.slashes&&!O.protocol){for(var Ie=Object.keys(O),Fe=0;Fe<Ie.length;Fe++){var at=Ie[Fe];"protocol"!==at&&(z[at]=O[at])}return te[z.protocol]&&z.hostname&&!z.pathname&&(z.path=z.pathname="/"),z.href=z.format(),z}if(O.protocol&&O.protocol!==z.protocol){if(!te[O.protocol]){for(var nt=Object.keys(O),jt=0;jt<nt.length;jt++){var Pt=nt[jt];z[Pt]=O[Pt]}return z.href=z.format(),z}if(z.protocol=O.protocol,O.host||se[O.protocol])z.pathname=O.pathname;else{for(var Vn=(O.pathname||"").split("/");Vn.length&&!(O.host=Vn.shift()););O.host||(O.host=""),O.hostname||(O.hostname=""),""!==Vn[0]&&Vn.unshift(""),Vn.length<2&&Vn.unshift(""),z.pathname=Vn.join("/")}return z.search=O.search,z.query=O.query,z.host=O.host||"",z.auth=O.auth,z.hostname=O.hostname||O.host,z.port=O.port,(z.pathname||z.search)&&(z.path=(z.pathname||"")+(z.search||"")),z.slashes=z.slashes||O.slashes,z.href=z.format(),z}var ar=z.pathname&&"/"===z.pathname.charAt(0),xn=O.host||O.pathname&&"/"===O.pathname.charAt(0),Xr=xn||ar||z.host&&O.pathname,Sr=Xr,en=z.pathname&&z.pathname.split("/")||[],yr=(Vn=O.pathname&&O.pathname.split("/")||[],z.protocol&&!te[z.protocol]);if(yr&&(z.hostname="",z.port=null,z.host&&(""===en[0]?en[0]=z.host:en.unshift(z.host)),z.host="",O.protocol&&(O.hostname=null,O.port=null,O.host&&(""===Vn[0]?Vn[0]=O.host:Vn.unshift(O.host)),O.host=null),Xr=Xr&&(""===Vn[0]||""===en[0])),xn)z.host=O.host||""===O.host?O.host:z.host,z.hostname=O.hostname||""===O.hostname?O.hostname:z.hostname,z.search=O.search,z.query=O.query,en=Vn;else if(Vn.length)en||(en=[]),en.pop(),en=en.concat(Vn),z.search=O.search,z.query=O.query;else if(!function(O){return null==O}(O.search))return yr&&(z.hostname=z.host=en.shift(),(Br=!!(z.host&&z.host.indexOf("@")>0)&&z.host.split("@"))&&(z.auth=Br.shift(),z.host=z.hostname=Br.shift())),z.search=O.search,z.query=O.query,(!la_isNull(z.pathname)||!la_isNull(z.search))&&(z.path=(z.pathname?z.pathname:"")+(z.search?z.search:"")),z.href=z.format(),z;if(!en.length)return z.pathname=null,z.path=z.search?"/"+z.search:null,z.href=z.format(),z;for(var ei=en.slice(-1)[0],ci=(z.host||O.host||en.length>1)&&("."===ei||".."===ei)||""===ei,qa=0,ai=en.length;ai>=0;ai--)"."===(ei=en[ai])?en.splice(ai,1):".."===ei?(en.splice(ai,1),qa++):qa&&(en.splice(ai,1),qa--);if(!Xr&&!Sr)for(;qa--;qa)en.unshift("..");Xr&&""!==en[0]&&(!en[0]||"/"!==en[0].charAt(0))&&en.unshift(""),ci&&"/"!==en.join("/").substr(-1)&&en.push("");var Br,Iu=""===en[0]||en[0]&&"/"===en[0].charAt(0);return yr&&(z.hostname=z.host=Iu?"":en.length?en.shift():"",(Br=!!(z.host&&z.host.indexOf("@")>0)&&z.host.split("@"))&&(z.auth=Br.shift(),z.host=z.hostname=Br.shift())),(Xr=Xr||z.host&&en.length)&&!Iu&&en.unshift(""),en.length?z.pathname=en.join("/"):(z.pathname=null,z.path=null),(!la_isNull(z.pathname)||!la_isNull(z.search))&&(z.path=(z.pathname?z.pathname:"")+(z.search?z.search:"")),z.auth=O.auth||z.auth,z.slashes=z.slashes||O.slashes,z.href=z.format(),z},Ss.prototype.parseHost=function(){var O=this.host,P=Nu.exec(O);P&&(":"!==(P=P[0])&&(this.port=P.substr(1)),O=O.substr(0,O.length-P.length)),O&&(this.hostname=O)};class Bn extends Error{constructor(P,z){super(z),this.message=z,this.key=P}}class sn{constructor(P,z=[]){this.parent=P,this.bindings={};for(const[K,he]of z)this.bindings[K]=he}concat(P){return new sn(this,P)}get(P){if(this.bindings[P])return this.bindings[P];if(this.parent)return this.parent.get(P);throw new Error(`${P} not found in scope.`)}has(P){return!!this.bindings[P]||!!this.parent&&this.parent.has(P)}}const br={kind:"null"},Ft={kind:"number"},mr={kind:"string"},or={kind:"boolean"},qt={kind:"color"},ur={kind:"object"},wn={kind:"value"},Yr={kind:"collator"},lr={kind:"formatted"},ni={kind:"resolvedImage"};function Kr(O,P){return{kind:"array",itemType:O,N:P}}function yo(O){if("array"===O.kind){const P=yo(O.itemType);return"number"==typeof O.N?`array<${P}, ${O.N}>`:"value"===O.itemType.kind?"array":`array<${P}>`}return O.kind}const Ro=[br,Ft,mr,or,qt,lr,ur,Kr(wn),ni];function gi(O,P){if("error"===P.kind)return null;if("array"===O.kind){if("array"===P.kind&&(0===P.N&&"value"===P.itemType.kind||!gi(O.itemType,P.itemType))&&("number"!=typeof O.N||O.N===P.N))return null}else{if(O.kind===P.kind)return null;if("value"===O.kind)for(const z of Ro)if(!gi(z,P))return null}return`Expected ${yo(O)} but found ${yo(P)} instead.`}function fi(O,P){return P.some(z=>z.kind===O.kind)}function js(O,P){return P.some(z=>"null"===z?null===O:"array"===z?Array.isArray(O):"object"===z?O&&!Array.isArray(O)&&"object"==typeof O:z===typeof O)}var Ya=gu(function(O,P){var z={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function K(nt){return(nt=Math.round(nt))<0?0:nt>255?255:nt}function fe(nt){return K("%"===nt[nt.length-1]?parseFloat(nt)/100*255:parseInt(nt))}function Ie(nt){return function(nt){return nt<0?0:nt>1?1:nt}("%"===nt[nt.length-1]?parseFloat(nt)/100:parseFloat(nt))}function Fe(nt,jt,Pt){return Pt<0?Pt+=1:Pt>1&&(Pt-=1),6*Pt<1?nt+(jt-nt)*Pt*6:2*Pt<1?jt:3*Pt<2?nt+(jt-nt)*(2/3-Pt)*6:nt}try{P.parseCSSColor=function(nt){var Pt,jt=nt.replace(/ /g,"").toLowerCase();if(jt in z)return z[jt].slice();if("#"===jt[0])return 4===jt.length?(Pt=parseInt(jt.substr(1),16))>=0&&Pt<=4095?[(3840&Pt)>>4|(3840&Pt)>>8,240&Pt|(240&Pt)>>4,15&Pt|(15&Pt)<<4,1]:null:7===jt.length&&(Pt=parseInt(jt.substr(1),16))>=0&&Pt<=16777215?[(16711680&Pt)>>16,(65280&Pt)>>8,255&Pt,1]:null;var cn=jt.indexOf("("),Sn=jt.indexOf(")");if(-1!==cn&&Sn+1===jt.length){var ar=jt.substr(0,cn),xn=jt.substr(cn+1,Sn-(cn+1)).split(","),Xr=1;switch(ar){case"rgba":if(4!==xn.length)return null;Xr=Ie(xn.pop());case"rgb":return 3!==xn.length?null:[fe(xn[0]),fe(xn[1]),fe(xn[2]),Xr];case"hsla":if(4!==xn.length)return null;Xr=Ie(xn.pop());case"hsl":if(3!==xn.length)return null;var Sr=(parseFloat(xn[0])%360+360)%360/360,en=Ie(xn[1]),Vn=Ie(xn[2]),yr=Vn<=.5?Vn*(en+1):Vn+en-Vn*en,Br=2*Vn-yr;return[K(255*Fe(Br,yr,Sr+1/3)),K(255*Fe(Br,yr,Sr)),K(255*Fe(Br,yr,Sr-1/3)),Xr];default:return null}}return null}}catch(nt){}});class Fr{constructor(P,z,K,he=1){this.r=P,this.g=z,this.b=K,this.a=he}static parse(P){if(!P)return;if(P instanceof Fr)return P;if("string"!=typeof P)return;const z=Ya.parseCSSColor(P);return z?new Fr(z[0]/255*z[3],z[1]/255*z[3],z[2]/255*z[3],z[3]):void 0}toString(){const[P,z,K,he]=this.toArray();return`rgba(${Math.round(P)},${Math.round(z)},${Math.round(K)},${he})`}toArray(){const{r:P,g:z,b:K,a:he}=this;return 0===he?[0,0,0,0]:[255*P/he,255*z/he,255*K/he,he]}}Fr.black=new Fr(0,0,0,1),Fr.white=new Fr(1,1,1,1),Fr.transparent=new Fr(0,0,0,0),Fr.red=new Fr(1,0,0,1),Fr.blue=new Fr(0,0,1,1);class xl{constructor(P,z,K){this.sensitivity=P?z?"variant":"case":z?"accent":"base",this.locale=K,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(P,z){return this.collator.compare(P,z)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Oi{constructor(P,z,K,he,fe){this.text=P,this.image=z,this.scale=K,this.fontStack=he,this.textColor=fe}}class Mn{constructor(P){this.sections=P}static fromString(P){return new Mn([new Oi(P,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(P=>0!==P.text.length||P.image&&0!==P.image.name.length)}static factory(P){return P instanceof Mn?P:Mn.fromString(P)}toString(){return 0===this.sections.length?"":this.sections.map(P=>P.text).join("")}serialize(){const P=["format"];for(const z of this.sections){if(z.image){P.push(["image",z.image.name]);continue}P.push(z.text);const K={};z.fontStack&&(K["text-font"]=["literal",z.fontStack.split(",")]),z.scale&&(K["font-scale"]=z.scale),z.textColor&&(K["text-color"]=["rgba"].concat(z.textColor.toArray())),P.push(K)}return P}}class Ai{constructor(P){this.name=P.name,this.available=P.available}toString(){return this.name}static fromString(P){return P?new Ai({name:P,available:!1}):null}serialize(){return["image",this.name]}}function ls(O,P,z,K){return"number"==typeof O&&O>=0&&O<=255&&"number"==typeof P&&P>=0&&P<=255&&"number"==typeof z&&z>=0&&z<=255?void 0===K||"number"==typeof K&&K>=0&&K<=1?null:`Invalid rgba value [${[O,P,z,K].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof K?[O,P,z,K]:[O,P,z]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ga(O){if(null===O)return!0;if("string"==typeof O)return!0;if("boolean"==typeof O)return!0;if("number"==typeof O)return!0;if(O instanceof Fr)return!0;if(O instanceof xl)return!0;if(O instanceof Mn)return!0;if(O instanceof Ai)return!0;if(Array.isArray(O)){for(const P of O)if(!ga(P))return!1;return!0}if("object"==typeof O){for(const P in O)if(!ga(O[P]))return!1;return!0}return!1}function $o(O){if(null===O)return br;if("string"==typeof O)return mr;if("boolean"==typeof O)return or;if("number"==typeof O)return Ft;if(O instanceof Fr)return qt;if(O instanceof xl)return Yr;if(O instanceof Mn)return lr;if(O instanceof Ai)return ni;if(Array.isArray(O)){const P=O.length;let z;for(const K of O){const he=$o(K);if(z){if(z===he)continue;z=wn;break}z=he}return Kr(z||wn,P)}return ur}function Ts(O){const P=typeof O;return null===O?"":"string"===P||"number"===P||"boolean"===P?String(O):O instanceof Fr||O instanceof Mn||O instanceof Ai?O.toString():JSON.stringify(O)}class Ka{constructor(P,z){this.type=P,this.value=z}static parse(P,z){if(2!==P.length)return z.error(`'literal' expression requires exactly one argument, but found ${P.length-1} instead.`);if(!ga(P[1]))return z.error("invalid value");const K=P[1];let he=$o(K);const fe=z.expectedType;return"array"===he.kind&&0===he.N&&fe&&"array"===fe.kind&&("number"!=typeof fe.N||0===fe.N)&&(he=fe),new Ka(he,K)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Fr?["rgba"].concat(this.value.toArray()):this.value instanceof Mn?this.value.serialize():this.value}}class xi{constructor(P){this.name="ExpressionEvaluationError",this.message=P}toJSON(){return this.message}}const ua={string:mr,number:Ft,boolean:or,object:ur};class no{constructor(P,z){this.type=P,this.args=z}static parse(P,z){if(P.length<2)return z.error("Expected at least one argument.");let he,K=1;const fe=P[0];if("array"===fe){let Fe,at;if(P.length>2){const nt=P[1];if("string"!=typeof nt||!(nt in ua)||"object"===nt)return z.error('The item type argument of "array" must be one of string, number, boolean',1);Fe=ua[nt],K++}else Fe=wn;if(P.length>3){if(null!==P[2]&&("number"!=typeof P[2]||P[2]<0||P[2]!==Math.floor(P[2])))return z.error('The length argument to "array" must be a positive integer literal',2);at=P[2],K++}he=Kr(Fe,at)}else he=ua[fe];const Ie=[];for(;K<P.length;K++){const Fe=z.parse(P[K],K,wn);if(!Fe)return null;Ie.push(Fe)}return new no(he,Ie)}evaluate(P){for(let z=0;z<this.args.length;z++){const K=this.args[z].evaluate(P);if(!gi(this.type,$o(K)))return K;if(z===this.args.length-1)throw new xi(`Expected value to be of type ${yo(this.type)}, but found ${yo($o(K))} instead.`)}return null}eachChild(P){this.args.forEach(P)}outputDefined(){return this.args.every(P=>P.outputDefined())}serialize(){const P=this.type,z=[P.kind];if("array"===P.kind){const K=P.itemType;if("string"===K.kind||"number"===K.kind||"boolean"===K.kind){z.push(K.kind);const he=P.N;("number"==typeof he||this.args.length>1)&&z.push(he)}}return z.concat(this.args.map(K=>K.serialize()))}}class ro{constructor(P){this.type=lr,this.sections=P}static parse(P,z){if(P.length<2)return z.error("Expected at least one argument.");const K=P[1];if(!Array.isArray(K)&&"object"==typeof K)return z.error("First argument must be an image or text section.");const he=[];let fe=!1;for(let Ie=1;Ie<=P.length-1;++Ie){const Fe=P[Ie];if(fe&&"object"==typeof Fe&&!Array.isArray(Fe)){fe=!1;let at=null;if(Fe["font-scale"]&&(at=z.parse(Fe["font-scale"],1,Ft),!at))return null;let nt=null;if(Fe["text-font"]&&(nt=z.parse(Fe["text-font"],1,Kr(mr)),!nt))return null;let jt=null;if(Fe["text-color"]&&(jt=z.parse(Fe["text-color"],1,qt),!jt))return null;const Pt=he[he.length-1];Pt.scale=at,Pt.font=nt,Pt.textColor=jt}else{const at=z.parse(P[Ie],1,wn);if(!at)return null;const nt=at.type.kind;if("string"!==nt&&"value"!==nt&&"null"!==nt&&"resolvedImage"!==nt)return z.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");fe=!0,he.push({content:at,scale:null,font:null,textColor:null})}}return new ro(he)}evaluate(P){return new Mn(this.sections.map(K=>{const he=K.content.evaluate(P);return $o(he)===ni?new Oi("",he,null,null,null):new Oi(Ts(he),null,K.scale?K.scale.evaluate(P):null,K.font?K.font.evaluate(P).join(","):null,K.textColor?K.textColor.evaluate(P):null)}))}eachChild(P){for(const z of this.sections)P(z.content),z.scale&&P(z.scale),z.font&&P(z.font),z.textColor&&P(z.textColor)}outputDefined(){return!1}serialize(){const P=["format"];for(const z of this.sections){P.push(z.content.serialize());const K={};z.scale&&(K["font-scale"]=z.scale.serialize()),z.font&&(K["text-font"]=z.font.serialize()),z.textColor&&(K["text-color"]=z.textColor.serialize()),P.push(K)}return P}}class xh{constructor(P){this.type=ni,this.input=P}static parse(P,z){if(2!==P.length)return z.error("Expected two arguments.");const K=z.parse(P[1],1,mr);return K?new xh(K):z.error("No image name provided.")}evaluate(P){const z=this.input.evaluate(P),K=Ai.fromString(z);return K&&P.availableImages&&(K.available=P.availableImages.indexOf(z)>-1),K}eachChild(P){P(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Ac={"to-boolean":or,"to-color":qt,"to-number":Ft,"to-string":mr};class ec{constructor(P,z){this.type=P,this.args=z}static parse(P,z){if(P.length<2)return z.error("Expected at least one argument.");const K=P[0];if(("to-boolean"===K||"to-string"===K)&&2!==P.length)return z.error("Expected one argument.");const he=Ac[K],fe=[];for(let Ie=1;Ie<P.length;Ie++){const Fe=z.parse(P[Ie],Ie,wn);if(!Fe)return null;fe.push(Fe)}return new ec(he,fe)}evaluate(P){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(P));if("color"===this.type.kind){let z,K;for(const he of this.args){if(z=he.evaluate(P),K=null,z instanceof Fr)return z;if("string"==typeof z){const fe=P.parseColor(z);if(fe)return fe}else if(Array.isArray(z)&&(K=z.length<3||z.length>4?`Invalid rbga value ${JSON.stringify(z)}: expected an array containing either three or four numeric values.`:ls(z[0],z[1],z[2],z[3]),!K))return new Fr(z[0]/255,z[1]/255,z[2]/255,z[3])}throw new xi(K||`Could not parse color from value '${"string"==typeof z?z:String(JSON.stringify(z))}'`)}if("number"===this.type.kind){let z=null;for(const K of this.args){if(z=K.evaluate(P),null===z)return 0;const he=Number(z);if(!isNaN(he))return he}throw new xi(`Could not convert ${JSON.stringify(z)} to number.`)}return"formatted"===this.type.kind?Mn.fromString(Ts(this.args[0].evaluate(P))):"resolvedImage"===this.type.kind?Ai.fromString(Ts(this.args[0].evaluate(P))):Ts(this.args[0].evaluate(P))}eachChild(P){this.args.forEach(P)}outputDefined(){return this.args.every(P=>P.outputDefined())}serialize(){if("formatted"===this.type.kind)return new ro([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new xh(this.args[0]).serialize();const P=[`to-${this.type.kind}`];return this.eachChild(z=>{P.push(z.serialize())}),P}}const kp=["Unknown","Point","LineString","Polygon"];class sf{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?kp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const P=this.featureDistanceData.center,z=this.featureDistanceData.scale,{x:K,y:he}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(K*z-P[0])+this.featureDistanceData.bearing[1]*(he*z-P[1])}return 0}parseColor(P){let z=this._parseColorCache[P];return z||(z=this._parseColorCache[P]=Fr.parse(P)),z}}class Us{constructor(P,z,K,he){this.name=P,this.type=z,this._evaluate=K,this.args=he}evaluate(P){return this._evaluate(P,this.args)}eachChild(P){this.args.forEach(P)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(P=>P.serialize()))}static parse(P,z){const K=P[0],he=Us.definitions[K];if(!he)return z.error(`Unknown expression "${K}". If you wanted a literal array, use ["literal", [...]].`,0);const fe=Array.isArray(he)?he[0]:he.type,Ie=Array.isArray(he)?[[he[1],he[2]]]:he.overloads,Fe=Ie.filter(([nt])=>!Array.isArray(nt)||nt.length===P.length-1);let at=null;for(const[nt,jt]of Fe){at=new ka(z.registry,z.path,null,z.scope);const Pt=[];let cn=!1;for(let Sn=1;Sn<P.length;Sn++){const ar=P[Sn],xn=Array.isArray(nt)?nt[Sn-1]:nt.type,Xr=at.parse(ar,1+Pt.length,xn);if(!Xr){cn=!0;break}Pt.push(Xr)}if(!cn){if(Array.isArray(nt)&&nt.length!==Pt.length){at.error(`Expected ${nt.length} arguments, but found ${Pt.length} instead.`);continue}for(let Sn=0;Sn<Pt.length;Sn++){const ar=Array.isArray(nt)?nt[Sn]:nt.type,xn=Pt[Sn];at.concat(Sn+1).checkSubtype(ar,xn.type)}if(0===at.errors.length)return new Us(K,fe,jt,Pt)}}if(1===Fe.length)z.errors.push(...at.errors);else{const jt=(Fe.length?Fe:Ie).map(([cn])=>{return O=cn,Array.isArray(O)?`(${O.map(yo).join(", ")})`:`(${yo(O.type)}...)`;var O}).join(" | "),Pt=[];for(let cn=1;cn<P.length;cn++){const Sn=z.parse(P[cn],1+Pt.length);if(!Sn)return null;Pt.push(yo(Sn.type))}z.error(`Expected arguments of type ${jt}, but found (${Pt.join(", ")}) instead.`)}return null}static register(P,z){Us.definitions=z;for(const K in z)P[K]=Us}}class Gh{constructor(P,z,K){this.type=Yr,this.locale=K,this.caseSensitive=P,this.diacriticSensitive=z}static parse(P,z){if(2!==P.length)return z.error("Expected one argument.");const K=P[1];if("object"!=typeof K||Array.isArray(K))return z.error("Collator options argument must be an object.");const he=z.parse(void 0!==K["case-sensitive"]&&K["case-sensitive"],1,or);if(!he)return null;const fe=z.parse(void 0!==K["diacritic-sensitive"]&&K["diacritic-sensitive"],1,or);if(!fe)return null;let Ie=null;return K.locale&&(Ie=z.parse(K.locale,1,mr),!Ie)?null:new Gh(he,fe,Ie)}evaluate(P){return new xl(this.caseSensitive.evaluate(P),this.diacriticSensitive.evaluate(P),this.locale?this.locale.evaluate(P):null)}eachChild(P){P(this.caseSensitive),P(this.diacriticSensitive),this.locale&&P(this.locale)}outputDefined(){return!1}serialize(){const P={};return P["case-sensitive"]=this.caseSensitive.serialize(),P["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(P.locale=this.locale.serialize()),["collator",P]}}const Yi=8192;function Eo(O,P){O[0]=Math.min(O[0],P[0]),O[1]=Math.min(O[1],P[1]),O[2]=Math.max(O[2],P[0]),O[3]=Math.max(O[3],P[1])}function eh(O,P){return!(O[0]<=P[0]||O[2]>=P[2]||O[1]<=P[1]||O[3]>=P[3])}function Hr(O,P){const z=function(O){return(180+O)/360}(O[0]),K=function(O){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+O*Math.PI/360)))/360}(O[1]),he=Math.pow(2,P.z);return[Math.round(z*he*Yi),Math.round(K*he*Yi)]}function Ql(O,P,z){const K=O[0]-P[0],he=O[1]-P[1],fe=O[0]-z[0],Ie=O[1]-z[1];return K*Ie-fe*he==0&&K*fe<=0&&he*Ie<=0}function io(O,P,z){return P[1]>O[1]!=z[1]>O[1]&&O[0]<(z[0]-P[0])*(O[1]-P[1])/(z[1]-P[1])+P[0]}function Fl(O,P){let z=!1;for(let K=0,he=P.length;K<he;K++){const fe=P[K];for(let Ie=0,Fe=fe.length;Ie<Fe-1;Ie++){if(Ql(O,fe[Ie],fe[Ie+1]))return!1;io(O,fe[Ie],fe[Ie+1])&&(z=!z)}}return z}function up(O,P){for(let z=0;z<P.length;z++)if(Fl(O,P[z]))return!0;return!1}function Dc(O,P,z,K){const at=K[0]-z[0],nt=K[1]-z[1],jt=(O[0]-z[0])*nt-at*(O[1]-z[1]),Pt=(P[0]-z[0])*nt-at*(P[1]-z[1]);return jt>0&&Pt<0||jt<0&&Pt>0}function kc(O,P,z,K){return 0!==function(O,P){return O[0]*P[1]-O[1]*P[0]}([K[0]-z[0],K[1]-z[1]],[P[0]-O[0],P[1]-O[1]])&&!(!Dc(O,P,z,K)||!Dc(z,K,O,P))}function wa(O,P,z){for(const K of z)for(let he=0;he<K.length-1;++he)if(kc(O,P,K[he],K[he+1]))return!0;return!1}function ca(O,P){for(let z=0;z<O.length;++z)if(!Fl(O[z],P))return!1;for(let z=0;z<O.length-1;++z)if(wa(O[z],O[z+1],P))return!1;return!0}function qh(O,P){for(let z=0;z<P.length;z++)if(ca(O,P[z]))return!0;return!1}function wh(O,P,z){const K=[];for(let he=0;he<O.length;he++){const fe=[];for(let Ie=0;Ie<O[he].length;Ie++){const Fe=Hr(O[he][Ie],z);Eo(P,Fe),fe.push(Fe)}K.push(fe)}return K}function oi(O,P,z){const K=[];for(let he=0;he<O.length;he++){const fe=wh(O[he],P,z);K.push(fe)}return K}function nc(O,P,z,K){if(O[0]<z[0]||O[0]>z[2]){const he=.5*K;let fe=O[0]-z[0]>he?-K:z[0]-O[0]>he?K:0;0===fe&&(fe=O[0]-z[2]>he?-K:z[2]-O[0]>he?K:0),O[0]+=fe}Eo(P,O)}function eu(O,P,z,K){const he=Math.pow(2,K.z)*Yi,fe=[K.x*Yi,K.y*Yi],Ie=[];for(const Fe of O)for(const at of Fe){const nt=[at.x+fe[0],at.y+fe[1]];nc(nt,P,z,he),Ie.push(nt)}return Ie}function Li(O,P,z,K){const he=Math.pow(2,K.z)*Yi,fe=[K.x*Yi,K.y*Yi],Ie=[];for(const Fe of O){const at=[];for(const nt of Fe){const jt=[nt.x+fe[0],nt.y+fe[1]];Eo(P,jt),at.push(jt)}Ie.push(at)}if(P[2]-P[0]<=he/2){!function(O){O[0]=O[1]=1/0,O[2]=O[3]=-1/0}(P);for(const Fe of Ie)for(const at of Fe)nc(at,P,z,he)}return Ie}class Is{constructor(P,z){this.type=or,this.geojson=P,this.geometries=z}static parse(P,z){if(2!==P.length)return z.error(`'within' expression requires exactly one argument, but found ${P.length-1} instead.`);if(ga(P[1])){const K=P[1];if("FeatureCollection"===K.type)for(let he=0;he<K.features.length;++he){const fe=K.features[he].geometry.type;if("Polygon"===fe||"MultiPolygon"===fe)return new Is(K,K.features[he].geometry)}else if("Feature"===K.type){const he=K.geometry.type;if("Polygon"===he||"MultiPolygon"===he)return new Is(K,K.geometry)}else if("Polygon"===K.type||"MultiPolygon"===K.type)return new Is(K,K)}return z.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(P){if(null!=P.geometry()&&null!=P.canonicalID()){if("Point"===P.geometryType())return function(O,P){const z=[1/0,1/0,-1/0,-1/0],K=[1/0,1/0,-1/0,-1/0],he=O.canonicalID();if("Polygon"===P.type){const fe=wh(P.coordinates,K,he),Ie=eu(O.geometry(),z,K,he);if(!eh(z,K))return!1;for(const Fe of Ie)if(!Fl(Fe,fe))return!1}if("MultiPolygon"===P.type){const fe=oi(P.coordinates,K,he),Ie=eu(O.geometry(),z,K,he);if(!eh(z,K))return!1;for(const Fe of Ie)if(!up(Fe,fe))return!1}return!0}(P,this.geometries);if("LineString"===P.geometryType())return function(O,P){const z=[1/0,1/0,-1/0,-1/0],K=[1/0,1/0,-1/0,-1/0],he=O.canonicalID();if("Polygon"===P.type){const fe=wh(P.coordinates,K,he),Ie=Li(O.geometry(),z,K,he);if(!eh(z,K))return!1;for(const Fe of Ie)if(!ca(Fe,fe))return!1}if("MultiPolygon"===P.type){const fe=oi(P.coordinates,K,he),Ie=Li(O.geometry(),z,K,he);if(!eh(z,K))return!1;for(const Fe of Ie)if(!qh(Fe,fe))return!1}return!0}(P,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Eh(O){if(O instanceof Us){if("get"===O.name&&1===O.args.length)return!1;if("feature-state"===O.name)return!1;if("has"===O.name&&1===O.args.length)return!1;if("properties"===O.name||"geometry-type"===O.name||"id"===O.name)return!1;if(/^filter-/.test(O.name))return!1}if(O instanceof Is)return!1;let P=!0;return O.eachChild(z=>{P&&!Eh(z)&&(P=!1)}),P}function rc(O){if(O instanceof Us&&"feature-state"===O.name)return!1;let P=!0;return O.eachChild(z=>{P&&!rc(z)&&(P=!1)}),P}function ii(O,P){if(O instanceof Us&&P.indexOf(O.name)>=0)return!1;let z=!0;return O.eachChild(K=>{z&&!ii(K,P)&&(z=!1)}),z}class th{constructor(P,z){this.type=z.type,this.name=P,this.boundExpression=z}static parse(P,z){if(2!==P.length||"string"!=typeof P[1])return z.error("'var' expression requires exactly one string literal argument.");const K=P[1];return z.scope.has(K)?new th(K,z.scope.get(K)):z.error(`Unknown variable "${K}". Make sure "${K}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(P){return this.boundExpression.evaluate(P)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ka{constructor(P,z=[],K,he=new sn,fe=[]){this.registry=P,this.path=z,this.key=z.map(Ie=>`[${Ie}]`).join(""),this.scope=he,this.errors=fe,this.expectedType=K}parse(P,z,K,he,fe={}){return z?this.concat(z,K,he)._parse(P,fe):this._parse(P,fe)}_parse(P,z){function K(he,fe,Ie){return"assert"===Ie?new no(fe,[he]):"coerce"===Ie?new ec(fe,[he]):he}if((null===P||"string"==typeof P||"boolean"==typeof P||"number"==typeof P)&&(P=["literal",P]),Array.isArray(P)){if(0===P.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const he=P[0];if("string"!=typeof he)return this.error(`Expression name must be a string, but found ${typeof he} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const fe=this.registry[he];if(fe){let Ie=fe.parse(P,this);if(!Ie)return null;if(this.expectedType){const Fe=this.expectedType,at=Ie.type;if("string"!==Fe.kind&&"number"!==Fe.kind&&"boolean"!==Fe.kind&&"object"!==Fe.kind&&"array"!==Fe.kind||"value"!==at.kind)if("color"!==Fe.kind&&"formatted"!==Fe.kind&&"resolvedImage"!==Fe.kind||"value"!==at.kind&&"string"!==at.kind){if(this.checkSubtype(Fe,at))return null}else Ie=K(Ie,Fe,z.typeAnnotation||"coerce");else Ie=K(Ie,Fe,z.typeAnnotation||"assert")}if(!(Ie instanceof Ka)&&"resolvedImage"!==Ie.type.kind&&Zh(Ie)){const Fe=new sf;try{Ie=new Ka(Ie.type,Ie.evaluate(Fe))}catch(at){return this.error(at.message),null}}return Ie}return this.error(`Unknown expression "${he}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===P?"'undefined' value invalid. Use null instead.":"object"==typeof P?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof P} instead.`)}concat(P,z,K){const he="number"==typeof P?this.path.concat(P):this.path,fe=K?this.scope.concat(K):this.scope;return new ka(this.registry,he,z||null,fe,this.errors)}error(P,...z){const K=`${this.key}${z.map(he=>`[${he}]`).join("")}`;this.errors.push(new Bn(K,P))}checkSubtype(P,z){const K=gi(P,z);return K&&this.error(K),K}}function Zh(O){if(O instanceof th)return Zh(O.boundExpression);if(O instanceof Us&&"error"===O.name)return!1;if(O instanceof Gh)return!1;if(O instanceof Is)return!1;const P=O instanceof ec||O instanceof no;let z=!0;return O.eachChild(K=>{z=P?z&&Zh(K):z&&K instanceof Ka}),!!z&&Eh(O)&&ii(O,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ic(O,P){const z=O.length-1;let Ie,Fe,K=0,he=z,fe=0;for(;K<=he;)if(fe=Math.floor((K+he)/2),Ie=O[fe],Fe=O[fe+1],Ie<=P){if(fe===z||P<Fe)return fe;K=fe+1}else{if(!(Ie>P))throw new xi("Input is not a number.");he=fe-1}return 0}class Di{constructor(P,z,K){this.type=P,this.input=z,this.labels=[],this.outputs=[];for(const[he,fe]of K)this.labels.push(he),this.outputs.push(fe)}static parse(P,z){if(P.length-1<4)return z.error(`Expected at least 4 arguments, but found only ${P.length-1}.`);if((P.length-1)%2!=0)return z.error("Expected an even number of arguments.");const K=z.parse(P[1],1,Ft);if(!K)return null;const he=[];let fe=null;z.expectedType&&"value"!==z.expectedType.kind&&(fe=z.expectedType);for(let Ie=1;Ie<P.length;Ie+=2){const Fe=1===Ie?-1/0:P[Ie],at=P[Ie+1],nt=Ie,jt=Ie+1;if("number"!=typeof Fe)return z.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',nt);if(he.length&&he[he.length-1][0]>=Fe)return z.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',nt);const Pt=z.parse(at,jt,fe);if(!Pt)return null;fe=fe||Pt.type,he.push([Fe,Pt])}return new Di(fe,K,he)}evaluate(P){const z=this.labels,K=this.outputs;if(1===z.length)return K[0].evaluate(P);const he=this.input.evaluate(P);if(he<=z[0])return K[0].evaluate(P);const fe=z.length;return he>=z[fe-1]?K[fe-1].evaluate(P):K[ic(z,he)].evaluate(P)}eachChild(P){P(this.input);for(const z of this.outputs)P(z)}outputDefined(){return this.outputs.every(P=>P.outputDefined())}serialize(){const P=["step",this.input.serialize()];for(let z=0;z<this.labels.length;z++)z>0&&P.push(this.labels[z]),P.push(this.outputs[z].serialize());return P}}var Sh=oc;function oc(O,P,z,K){this.cx=3*O,this.bx=3*(z-O)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*P,this.by=3*(K-P)-this.cy,this.ay=1-this.cy-this.by,this.p1x=O,this.p1y=K,this.p2x=z,this.p2y=K}function ya(O,P,z){return O*(1-z)+P*z}oc.prototype.sampleCurveX=function(O){return((this.ax*O+this.bx)*O+this.cx)*O},oc.prototype.sampleCurveY=function(O){return((this.ay*O+this.by)*O+this.cy)*O},oc.prototype.sampleCurveDerivativeX=function(O){return(3*this.ax*O+2*this.bx)*O+this.cx},oc.prototype.solveCurveX=function(O,P){var z,K,he,fe,Ie;for(void 0===P&&(P=1e-6),he=O,Ie=0;Ie<8;Ie++){if(fe=this.sampleCurveX(he)-O,Math.abs(fe)<P)return he;var Fe=this.sampleCurveDerivativeX(he);if(Math.abs(Fe)<1e-6)break;he-=fe/Fe}if((he=O)<(z=0))return z;if(he>(K=1))return K;for(;z<K;){if(fe=this.sampleCurveX(he),Math.abs(fe-O)<P)return he;O>fe?z=he:K=he,he=.5*(K-z)+z}return he},oc.prototype.solve=function(O,P){return this.sampleCurveY(this.solveCurveX(O,P))};var tu=Object.freeze({__proto__:null,number:ya,color:function(O,P,z){return new Fr(ya(O.r,P.r,z),ya(O.g,P.g,z),ya(O.b,P.b,z),ya(O.a,P.a,z))},array:function(O,P,z){return O.map((K,he)=>ya(K,P[he],z))}});const Pc=4/29,ju=6/29,eo=3*ju*ju,zl=Math.PI/180,nd=180/Math.PI;function nu(O){return O>.008856451679035631?Math.pow(O,1/3):O/eo+Pc}function Gi(O){return O>ju?O*O*O:eo*(O-Pc)}function Rc(O){return 255*(O<=.0031308?12.92*O:1.055*Math.pow(O,1/2.4)-.055)}function Hh(O){return(O/=255)<=.04045?O/12.92:Math.pow((O+.055)/1.055,2.4)}function Pa(O){const P=Hh(O.r),z=Hh(O.g),K=Hh(O.b),he=nu((.4124564*P+.3575761*z+.1804375*K)/.95047),fe=nu((.2126729*P+.7151522*z+.072175*K)/1);return{l:116*fe-16,a:500*(he-fe),b:200*(fe-nu((.0193339*P+.119192*z+.9503041*K)/1.08883)),alpha:O.a}}function Ms(O){let P=(O.l+16)/116,z=isNaN(O.a)?P:P+O.a/500,K=isNaN(O.b)?P:P-O.b/200;return P=1*Gi(P),z=.95047*Gi(z),K=1.08883*Gi(K),new Fr(Rc(3.2404542*z-1.5371385*P-.4985314*K),Rc(-.969266*z+1.8760108*P+.041556*K),Rc(.0556434*z-.2040259*P+1.0572252*K),O.alpha)}function Ks(O,P,z){const K=P-O;return O+z*(K>180||K<-180?K-360*Math.round(K/360):K)}const Oc={forward:Pa,reverse:Ms,interpolate:function(O,P,z){return{l:ya(O.l,P.l,z),a:ya(O.a,P.a,z),b:ya(O.b,P.b,z),alpha:ya(O.alpha,P.alpha,z)}}},Ki={forward:function(O){const{l:P,a:z,b:K}=Pa(O),he=Math.atan2(K,z)*nd;return{h:he<0?he+360:he,c:Math.sqrt(z*z+K*K),l:P,alpha:O.a}},reverse:function(O){const P=O.h*zl,z=O.c;return Ms({l:O.l,a:Math.cos(P)*z,b:Math.sin(P)*z,alpha:O.alpha})},interpolate:function(O,P,z){return{h:Ks(O.h,P.h,z),c:ya(O.c,P.c,z),l:ya(O.l,P.l,z),alpha:ya(O.alpha,P.alpha,z)}}};var Ih=Object.freeze({__proto__:null,lab:Oc,hcl:Ki});class Vs{constructor(P,z,K,he,fe){this.type=P,this.operator=z,this.interpolation=K,this.input=he,this.labels=[],this.outputs=[];for(const[Ie,Fe]of fe)this.labels.push(Ie),this.outputs.push(Fe)}static interpolationFactor(P,z,K,he){let fe=0;if("exponential"===P.name)fe=Ba(z,P.base,K,he);else if("linear"===P.name)fe=Ba(z,1,K,he);else if("cubic-bezier"===P.name){const Ie=P.controlPoints;fe=new Sh(Ie[0],Ie[1],Ie[2],Ie[3]).solve(Ba(z,1,K,he))}return fe}static parse(P,z){let[K,he,fe,...Ie]=P;if(!Array.isArray(he)||0===he.length)return z.error("Expected an interpolation type expression.",1);if("linear"===he[0])he={name:"linear"};else if("exponential"===he[0]){const nt=he[1];if("number"!=typeof nt)return z.error("Exponential interpolation requires a numeric base.",1,1);he={name:"exponential",base:nt}}else{if("cubic-bezier"!==he[0])return z.error(`Unknown interpolation type ${String(he[0])}`,1,0);{const nt=he.slice(1);if(4!==nt.length||nt.some(jt=>"number"!=typeof jt||jt<0||jt>1))return z.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);he={name:"cubic-bezier",controlPoints:nt}}}if(P.length-1<4)return z.error(`Expected at least 4 arguments, but found only ${P.length-1}.`);if((P.length-1)%2!=0)return z.error("Expected an even number of arguments.");if(fe=z.parse(fe,2,Ft),!fe)return null;const Fe=[];let at=null;"interpolate-hcl"===K||"interpolate-lab"===K?at=qt:z.expectedType&&"value"!==z.expectedType.kind&&(at=z.expectedType);for(let nt=0;nt<Ie.length;nt+=2){const jt=Ie[nt],Pt=Ie[nt+1],cn=nt+3,Sn=nt+4;if("number"!=typeof jt)return z.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',cn);if(Fe.length&&Fe[Fe.length-1][0]>=jt)return z.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',cn);const ar=z.parse(Pt,Sn,at);if(!ar)return null;at=at||ar.type,Fe.push([jt,ar])}return"number"===at.kind||"color"===at.kind||"array"===at.kind&&"number"===at.itemType.kind&&"number"==typeof at.N?new Vs(at,K,he,fe,Fe):z.error(`Type ${yo(at)} is not interpolatable.`)}evaluate(P){const z=this.labels,K=this.outputs;if(1===z.length)return K[0].evaluate(P);const he=this.input.evaluate(P);if(he<=z[0])return K[0].evaluate(P);const fe=z.length;if(he>=z[fe-1])return K[fe-1].evaluate(P);const Ie=ic(z,he),nt=Vs.interpolationFactor(this.interpolation,he,z[Ie],z[Ie+1]),jt=K[Ie].evaluate(P),Pt=K[Ie+1].evaluate(P);return"interpolate"===this.operator?tu[this.type.kind.toLowerCase()](jt,Pt,nt):"interpolate-hcl"===this.operator?Ki.reverse(Ki.interpolate(Ki.forward(jt),Ki.forward(Pt),nt)):Oc.reverse(Oc.interpolate(Oc.forward(jt),Oc.forward(Pt),nt))}eachChild(P){P(this.input);for(const z of this.outputs)P(z)}outputDefined(){return this.outputs.every(P=>P.outputDefined())}serialize(){let P;P="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const z=[this.operator,P,this.input.serialize()];for(let K=0;K<this.labels.length;K++)z.push(this.labels[K],this.outputs[K].serialize());return z}}function Ba(O,P,z,K){const he=K-z,fe=O-z;return 0===he?0:1===P?fe/he:(Math.pow(P,fe)-1)/(Math.pow(P,he)-1)}class Rp{constructor(P,z){this.type=P,this.args=z}static parse(P,z){if(P.length<2)return z.error("Expectected at least one argument.");let K=null;const he=z.expectedType;he&&"value"!==he.kind&&(K=he);const fe=[];for(const Fe of P.slice(1)){const at=z.parse(Fe,1+fe.length,K,void 0,{typeAnnotation:"omit"});if(!at)return null;K=K||at.type,fe.push(at)}return he&&fe.some(Fe=>gi(he,Fe.type))?new Rp(wn,fe):new Rp(K,fe)}evaluate(P){let he,z=null,K=0;for(const fe of this.args)if(K++,z=fe.evaluate(P),z&&z instanceof Ai&&!z.available&&(he||(he=z.name),z=null,K===this.args.length&&(z=he)),null!==z)break;return z}eachChild(P){this.args.forEach(P)}outputDefined(){return this.args.every(P=>P.outputDefined())}serialize(){const P=["coalesce"];return this.eachChild(z=>{P.push(z.serialize())}),P}}class As{constructor(P,z){this.type=z.type,this.bindings=[].concat(P),this.result=z}evaluate(P){return this.result.evaluate(P)}eachChild(P){for(const z of this.bindings)P(z[1]);P(this.result)}static parse(P,z){if(P.length<4)return z.error(`Expected at least 3 arguments, but found ${P.length-1} instead.`);const K=[];for(let fe=1;fe<P.length-1;fe+=2){const Ie=P[fe];if("string"!=typeof Ie)return z.error(`Expected string, but found ${typeof Ie} instead.`,fe);if(/[^a-zA-Z0-9_]/.test(Ie))return z.error("Variable names must contain only alphanumeric characters or '_'.",fe);const Fe=z.parse(P[fe+1],fe+1);if(!Fe)return null;K.push([Ie,Fe])}const he=z.parse(P[P.length-1],P.length-1,z.expectedType,K);return he?new As(K,he):null}outputDefined(){return this.result.outputDefined()}serialize(){const P=["let"];for(const[z,K]of this.bindings)P.push(z,K.serialize());return P.push(this.result.serialize()),P}}class Qn{constructor(P,z,K){this.type=P,this.index=z,this.input=K}static parse(P,z){if(3!==P.length)return z.error(`Expected 2 arguments, but found ${P.length-1} instead.`);const K=z.parse(P[1],1,Ft),he=z.parse(P[2],2,Kr(z.expectedType||wn));return K&&he?new Qn(he.type.itemType,K,he):null}evaluate(P){const z=this.index.evaluate(P),K=this.input.evaluate(P);if(z<0)throw new xi(`Array index out of bounds: ${z} < 0.`);if(z>=K.length)throw new xi(`Array index out of bounds: ${z} > ${K.length-1}.`);if(z!==Math.floor(z))throw new xi(`Array index must be an integer, but found ${z} instead.`);return K[z]}eachChild(P){P(this.index),P(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class ui{constructor(P,z){this.type=or,this.needle=P,this.haystack=z}static parse(P,z){if(3!==P.length)return z.error(`Expected 2 arguments, but found ${P.length-1} instead.`);const K=z.parse(P[1],1,wn),he=z.parse(P[2],2,wn);return K&&he?fi(K.type,[or,mr,Ft,br,wn])?new ui(K,he):z.error(`Expected first argument to be of type boolean, string, number or null, but found ${yo(K.type)} instead`):null}evaluate(P){const z=this.needle.evaluate(P),K=this.haystack.evaluate(P);if(!K)return!1;if(!js(z,["boolean","string","number","null"]))throw new xi(`Expected first argument to be of type boolean, string, number or null, but found ${yo($o(z))} instead.`);if(!js(K,["string","array"]))throw new xi(`Expected second argument to be of type array or string, but found ${yo($o(K))} instead.`);return K.indexOf(z)>=0}eachChild(P){P(this.needle),P(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class So{constructor(P,z,K){this.type=Ft,this.needle=P,this.haystack=z,this.fromIndex=K}static parse(P,z){if(P.length<=2||P.length>=5)return z.error(`Expected 3 or 4 arguments, but found ${P.length-1} instead.`);const K=z.parse(P[1],1,wn),he=z.parse(P[2],2,wn);if(!K||!he)return null;if(!fi(K.type,[or,mr,Ft,br,wn]))return z.error(`Expected first argument to be of type boolean, string, number or null, but found ${yo(K.type)} instead`);if(4===P.length){const fe=z.parse(P[3],3,Ft);return fe?new So(K,he,fe):null}return new So(K,he)}evaluate(P){const z=this.needle.evaluate(P),K=this.haystack.evaluate(P);if(!js(z,["boolean","string","number","null"]))throw new xi(`Expected first argument to be of type boolean, string, number or null, but found ${yo($o(z))} instead.`);if(!js(K,["string","array"]))throw new xi(`Expected second argument to be of type array or string, but found ${yo($o(K))} instead.`);if(this.fromIndex){const he=this.fromIndex.evaluate(P);return K.indexOf(z,he)}return K.indexOf(z)}eachChild(P){P(this.needle),P(this.haystack),this.fromIndex&&P(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const P=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),P]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Gs{constructor(P,z,K,he,fe,Ie){this.inputType=P,this.type=z,this.input=K,this.cases=he,this.outputs=fe,this.otherwise=Ie}static parse(P,z){if(P.length<5)return z.error(`Expected at least 4 arguments, but found only ${P.length-1}.`);if(P.length%2!=1)return z.error("Expected an even number of arguments.");let K,he;z.expectedType&&"value"!==z.expectedType.kind&&(he=z.expectedType);const fe={},Ie=[];for(let nt=2;nt<P.length-1;nt+=2){let jt=P[nt];const Pt=P[nt+1];Array.isArray(jt)||(jt=[jt]);const cn=z.concat(nt);if(0===jt.length)return cn.error("Expected at least one branch label.");for(const ar of jt){if("number"!=typeof ar&&"string"!=typeof ar)return cn.error("Branch labels must be numbers or strings.");if("number"==typeof ar&&Math.abs(ar)>Number.MAX_SAFE_INTEGER)return cn.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof ar&&Math.floor(ar)!==ar)return cn.error("Numeric branch labels must be integer values.");if(K){if(cn.checkSubtype(K,$o(ar)))return null}else K=$o(ar);if(void 0!==fe[String(ar)])return cn.error("Branch labels must be unique.");fe[String(ar)]=Ie.length}const Sn=z.parse(Pt,nt,he);if(!Sn)return null;he=he||Sn.type,Ie.push(Sn)}const Fe=z.parse(P[1],1,wn);if(!Fe)return null;const at=z.parse(P[P.length-1],P.length-1,he);return!at||"value"!==Fe.type.kind&&z.concat(1).checkSubtype(K,Fe.type)?null:new Gs(K,he,Fe,fe,Ie,at)}evaluate(P){const z=this.input.evaluate(P);return($o(z)===this.inputType&&this.outputs[this.cases[z]]||this.otherwise).evaluate(P)}eachChild(P){P(this.input),this.outputs.forEach(P),P(this.otherwise)}outputDefined(){return this.outputs.every(P=>P.outputDefined())&&this.otherwise.outputDefined()}serialize(){const P=["match",this.input.serialize()],z=Object.keys(this.cases).sort(),K=[],he={};for(const Ie of z){const Fe=he[this.cases[Ie]];void 0===Fe?(he[this.cases[Ie]]=K.length,K.push([this.cases[Ie],[Ie]])):K[Fe][1].push(Ie)}const fe=Ie=>"number"===this.inputType.kind?Number(Ie):Ie;for(const[Ie,Fe]of K)P.push(1===Fe.length?fe(Fe[0]):Fe.map(fe)),P.push(this.outputs[Ie].serialize());return P.push(this.otherwise.serialize()),P}}class ru{constructor(P,z,K){this.type=P,this.branches=z,this.otherwise=K}static parse(P,z){if(P.length<4)return z.error(`Expected at least 3 arguments, but found only ${P.length-1}.`);if(P.length%2!=0)return z.error("Expected an odd number of arguments.");let K;z.expectedType&&"value"!==z.expectedType.kind&&(K=z.expectedType);const he=[];for(let Ie=1;Ie<P.length-1;Ie+=2){const Fe=z.parse(P[Ie],Ie,or);if(!Fe)return null;const at=z.parse(P[Ie+1],Ie+1,K);if(!at)return null;he.push([Fe,at]),K=K||at.type}const fe=z.parse(P[P.length-1],P.length-1,K);return fe?new ru(K,he,fe):null}evaluate(P){for(const[z,K]of this.branches)if(z.evaluate(P))return K.evaluate(P);return this.otherwise.evaluate(P)}eachChild(P){for(const[z,K]of this.branches)P(z),P(K);P(this.otherwise)}outputDefined(){return this.branches.every(([P,z])=>z.outputDefined())&&this.otherwise.outputDefined()}serialize(){const P=["case"];return this.eachChild(z=>{P.push(z.serialize())}),P}}class Ao{constructor(P,z,K,he){this.type=P,this.input=z,this.beginIndex=K,this.endIndex=he}static parse(P,z){if(P.length<=2||P.length>=5)return z.error(`Expected 3 or 4 arguments, but found ${P.length-1} instead.`);const K=z.parse(P[1],1,wn),he=z.parse(P[2],2,Ft);if(!K||!he)return null;if(!fi(K.type,[Kr(wn),mr,wn]))return z.error(`Expected first argument to be of type array or string, but found ${yo(K.type)} instead`);if(4===P.length){const fe=z.parse(P[3],3,Ft);return fe?new Ao(K.type,K,he,fe):null}return new Ao(K.type,K,he)}evaluate(P){const z=this.input.evaluate(P),K=this.beginIndex.evaluate(P);if(!js(z,["string","array"]))throw new xi(`Expected first argument to be of type array or string, but found ${yo($o(z))} instead.`);if(this.endIndex){const he=this.endIndex.evaluate(P);return z.slice(K,he)}return z.slice(K)}eachChild(P){P(this.input),P(this.beginIndex),this.endIndex&&P(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const P=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),P]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Bl(O,P){return"=="===O||"!="===O?"boolean"===P.kind||"string"===P.kind||"number"===P.kind||"null"===P.kind||"value"===P.kind:"string"===P.kind||"number"===P.kind||"value"===P.kind}function Lc(O,P,z,K){return 0===K.compare(P,z)}function vo(O,P,z){const K="=="!==O&&"!="!==O;return class WL{constructor(fe,Ie,Fe){this.type=or,this.lhs=fe,this.rhs=Ie,this.collator=Fe,this.hasUntypedArgument="value"===fe.type.kind||"value"===Ie.type.kind}static parse(fe,Ie){if(3!==fe.length&&4!==fe.length)return Ie.error("Expected two or three arguments.");const Fe=fe[0];let at=Ie.parse(fe[1],1,wn);if(!at)return null;if(!Bl(Fe,at.type))return Ie.concat(1).error(`"${Fe}" comparisons are not supported for type '${yo(at.type)}'.`);let nt=Ie.parse(fe[2],2,wn);if(!nt)return null;if(!Bl(Fe,nt.type))return Ie.concat(2).error(`"${Fe}" comparisons are not supported for type '${yo(nt.type)}'.`);if(at.type.kind!==nt.type.kind&&"value"!==at.type.kind&&"value"!==nt.type.kind)return Ie.error(`Cannot compare types '${yo(at.type)}' and '${yo(nt.type)}'.`);K&&("value"===at.type.kind&&"value"!==nt.type.kind?at=new no(nt.type,[at]):"value"!==at.type.kind&&"value"===nt.type.kind&&(nt=new no(at.type,[nt])));let jt=null;if(4===fe.length){if("string"!==at.type.kind&&"string"!==nt.type.kind&&"value"!==at.type.kind&&"value"!==nt.type.kind)return Ie.error("Cannot use collator to compare non-string types.");if(jt=Ie.parse(fe[3],3,Yr),!jt)return null}return new WL(at,nt,jt)}evaluate(fe){const Ie=this.lhs.evaluate(fe),Fe=this.rhs.evaluate(fe);if(K&&this.hasUntypedArgument){const at=$o(Ie),nt=$o(Fe);if(at.kind!==nt.kind||"string"!==at.kind&&"number"!==at.kind)throw new xi(`Expected arguments for "${O}" to be (string, string) or (number, number), but found (${at.kind}, ${nt.kind}) instead.`)}if(this.collator&&!K&&this.hasUntypedArgument){const at=$o(Ie),nt=$o(Fe);if("string"!==at.kind||"string"!==nt.kind)return P(fe,Ie,Fe)}return this.collator?z(fe,Ie,Fe,this.collator.evaluate(fe)):P(fe,Ie,Fe)}eachChild(fe){fe(this.lhs),fe(this.rhs),this.collator&&fe(this.collator)}outputDefined(){return!0}serialize(){const fe=[O];return this.eachChild(Ie=>{fe.push(Ie.serialize())}),fe}}}const Op=vo("==",function(O,P,z){return P===z},Lc),qu=vo("!=",function(O,P,z){return P!==z},function(O,P,z,K){return!Lc(0,P,z,K)}),Cl=vo("<",function(O,P,z){return P<z},function(O,P,z,K){return K.compare(P,z)<0}),us=vo(">",function(O,P,z){return P>z},function(O,P,z,K){return K.compare(P,z)>0}),nh=vo("<=",function(O,P,z){return P<=z},function(O,P,z,K){return K.compare(P,z)<=0}),Wh=vo(">=",function(O,P,z){return P>=z},function(O,P,z,K){return K.compare(P,z)>=0});class jl{constructor(P,z,K,he,fe){this.type=mr,this.number=P,this.locale=z,this.currency=K,this.minFractionDigits=he,this.maxFractionDigits=fe}static parse(P,z){if(3!==P.length)return z.error("Expected two arguments.");const K=z.parse(P[1],1,Ft);if(!K)return null;const he=P[2];if("object"!=typeof he||Array.isArray(he))return z.error("NumberFormat options argument must be an object.");let fe=null;if(he.locale&&(fe=z.parse(he.locale,1,mr),!fe))return null;let Ie=null;if(he.currency&&(Ie=z.parse(he.currency,1,mr),!Ie))return null;let Fe=null;if(he["min-fraction-digits"]&&(Fe=z.parse(he["min-fraction-digits"],1,Ft),!Fe))return null;let at=null;return he["max-fraction-digits"]&&(at=z.parse(he["max-fraction-digits"],1,Ft),!at)?null:new jl(K,fe,Ie,Fe,at)}evaluate(P){return new Intl.NumberFormat(this.locale?this.locale.evaluate(P):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(P):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(P):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(P):void 0}).format(this.number.evaluate(P))}eachChild(P){P(this.number),this.locale&&P(this.locale),this.currency&&P(this.currency),this.minFractionDigits&&P(this.minFractionDigits),this.maxFractionDigits&&P(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const P={};return this.locale&&(P.locale=this.locale.serialize()),this.currency&&(P.currency=this.currency.serialize()),this.minFractionDigits&&(P["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(P["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),P]}}class cs{constructor(P){this.type=Ft,this.input=P}static parse(P,z){if(2!==P.length)return z.error(`Expected 1 argument, but found ${P.length-1} instead.`);const K=z.parse(P[1],1);return K?"array"!==K.type.kind&&"string"!==K.type.kind&&"value"!==K.type.kind?z.error(`Expected argument of type string or array, but found ${yo(K.type)} instead.`):new cs(K):null}evaluate(P){const z=this.input.evaluate(P);if("string"==typeof z)return z.length;if(Array.isArray(z))return z.length;throw new xi(`Expected value to be of type string or array, but found ${yo($o(z))} instead.`)}eachChild(P){P(this.input)}outputDefined(){return!1}serialize(){const P=["length"];return this.eachChild(z=>{P.push(z.serialize())}),P}}const El={"==":Op,"!=":qu,">":us,"<":Cl,">=":Wh,"<=":nh,array:no,at:Qn,boolean:no,case:ru,coalesce:Rp,collator:Gh,format:ro,image:xh,in:ui,"index-of":So,interpolate:Vs,"interpolate-hcl":Vs,"interpolate-lab":Vs,length:cs,let:As,literal:Ka,match:Gs,number:no,"number-format":jl,object:no,slice:Ao,step:Di,string:no,"to-boolean":ec,"to-color":ec,"to-number":ec,"to-string":ec,var:th,within:Is};function _o(O,[P,z,K,he]){P=P.evaluate(O),z=z.evaluate(O),K=K.evaluate(O);const fe=he?he.evaluate(O):1,Ie=ls(P,z,K,fe);if(Ie)throw new xi(Ie);return new Fr(P/255*fe,z/255*fe,K/255*fe,fe)}function $h(O,P){return O in P}function Zu(O,P){const z=P[O];return void 0===z?null:z}function qi(O){return{type:O}}function yi(O){return{result:"success",value:O}}function ou(O){return{result:"error",value:O}}function Sl(O){return"data-driven"===O["property-type"]||"cross-faded-data-driven"===O["property-type"]}function rd(O){return!!O.expression&&O.expression.parameters.indexOf("zoom")>-1}function _u(O){return!!O.expression&&O.expression.interpolated}function vi(O){return O instanceof Number?"number":O instanceof String?"string":O instanceof Boolean?"boolean":Array.isArray(O)?"array":null===O?"null":typeof O}function Lp(O){return"object"==typeof O&&null!==O&&!Array.isArray(O)}function hp(O){return O}function Xh(O,P){const z="color"===P.type,K=O.stops&&"object"==typeof O.stops[0][0],fe=K||!(K||void 0!==O.property),Ie=O.type||(_u(P)?"exponential":"interval");if(z&&((O=On({},O)).stops&&(O.stops=O.stops.map(jt=>[jt[0],Fr.parse(jt[1])])),O.default=Fr.parse(O.default?O.default:P.default)),O.colorSpace&&"rgb"!==O.colorSpace&&!Ih[O.colorSpace])throw new Error(`Unknown color space: ${O.colorSpace}`);let Fe,at,nt;if("exponential"===Ie)Fe=Fp;else if("interval"===Ie)Fe=xu;else if("categorical"===Ie){Fe=hs,at=Object.create(null);for(const jt of O.stops)at[jt[0]]=jt[1];nt=typeof O.stops[0][0]}else{if("identity"!==Ie)throw new Error(`Unknown function type "${Ie}"`);Fe=Ra}if(K){const jt={},Pt=[];for(let ar=0;ar<O.stops.length;ar++){const xn=O.stops[ar],Xr=xn[0].zoom;void 0===jt[Xr]&&(jt[Xr]={zoom:Xr,type:O.type,property:O.property,default:O.default,stops:[]},Pt.push(Xr)),jt[Xr].stops.push([xn[0].value,xn[1]])}const cn=[];for(const ar of Pt)cn.push([jt[ar].zoom,Xh(jt[ar],P)]);const Sn={name:"linear"};return{kind:"composite",interpolationType:Sn,interpolationFactor:Vs.interpolationFactor.bind(void 0,Sn),zoomStops:cn.map(ar=>ar[0]),evaluate:({zoom:ar},xn)=>Fp({stops:cn,base:O.base},P,ar).evaluate(ar,xn)}}if(fe){const jt="exponential"===Ie?{name:"exponential",base:void 0!==O.base?O.base:1}:null;return{kind:"camera",interpolationType:jt,interpolationFactor:Vs.interpolationFactor.bind(void 0,jt),zoomStops:O.stops.map(Pt=>Pt[0]),evaluate:({zoom:Pt})=>Fe(O,P,Pt,at,nt)}}return{kind:"source",evaluate(jt,Pt){const cn=Pt&&Pt.properties?Pt.properties[O.property]:void 0;return void 0===cn?lc(O.default,P.default):Fe(O,P,cn,at,nt)}}}function lc(O,P,z){return void 0!==O?O:void 0!==P?P:void 0!==z?z:void 0}function hs(O,P,z,K,he){return lc(typeof z===he?K[z]:void 0,O.default,P.default)}function xu(O,P,z){if("number"!==vi(z))return lc(O.default,P.default);const K=O.stops.length;if(1===K||z<=O.stops[0][0])return O.stops[0][1];if(z>=O.stops[K-1][0])return O.stops[K-1][1];const he=ic(O.stops.map(fe=>fe[0]),z);return O.stops[he][1]}function Fp(O,P,z){const K=void 0!==O.base?O.base:1;if("number"!==vi(z))return lc(O.default,P.default);const he=O.stops.length;if(1===he||z<=O.stops[0][0])return O.stops[0][1];if(z>=O.stops[he-1][0])return O.stops[he-1][1];const fe=ic(O.stops.map(jt=>jt[0]),z),Ie=function(O,P,z,K){const he=K-z,fe=O-z;return 0===he?0:1===P?fe/he:(Math.pow(P,fe)-1)/(Math.pow(P,he)-1)}(z,K,O.stops[fe][0],O.stops[fe+1][0]),Fe=O.stops[fe][1],at=O.stops[fe+1][1];let nt=tu[P.type]||hp;if(O.colorSpace&&"rgb"!==O.colorSpace){const jt=Ih[O.colorSpace];nt=(Pt,cn)=>jt.reverse(jt.interpolate(jt.forward(Pt),jt.forward(cn),Ie))}return"function"==typeof Fe.evaluate?{evaluate(...jt){const Pt=Fe.evaluate.apply(void 0,jt),cn=at.evaluate.apply(void 0,jt);if(void 0!==Pt&&void 0!==cn)return nt(Pt,cn,Ie)}}:nt(Fe,at,Ie)}function Ra(O,P,z){return"color"===P.type?z=Fr.parse(z):"formatted"===P.type?z=Mn.fromString(z.toString()):"resolvedImage"===P.type?z=Ai.fromString(z.toString()):vi(z)!==P.type&&("enum"!==P.type||!P.values[z])&&(z=void 0),lc(z,O.default,P.default)}Us.register(El,{error:[{kind:"error"},[mr],(O,[P])=>{throw new xi(P.evaluate(O))}],typeof:[mr,[wn],(O,[P])=>yo($o(P.evaluate(O)))],"to-rgba":[Kr(Ft,4),[qt],(O,[P])=>P.evaluate(O).toArray()],rgb:[qt,[Ft,Ft,Ft],_o],rgba:[qt,[Ft,Ft,Ft,Ft],_o],has:{type:or,overloads:[[[mr],(O,[P])=>$h(P.evaluate(O),O.properties())],[[mr,ur],(O,[P,z])=>$h(P.evaluate(O),z.evaluate(O))]]},get:{type:wn,overloads:[[[mr],(O,[P])=>Zu(P.evaluate(O),O.properties())],[[mr,ur],(O,[P,z])=>Zu(P.evaluate(O),z.evaluate(O))]]},"feature-state":[wn,[mr],(O,[P])=>Zu(P.evaluate(O),O.featureState||{})],properties:[ur,[],O=>O.properties()],"geometry-type":[mr,[],O=>O.geometryType()],id:[wn,[],O=>O.id()],zoom:[Ft,[],O=>O.globals.zoom],pitch:[Ft,[],O=>O.globals.pitch||0],"distance-from-center":[Ft,[],O=>O.distanceFromCenter()],"heatmap-density":[Ft,[],O=>O.globals.heatmapDensity||0],"line-progress":[Ft,[],O=>O.globals.lineProgress||0],"sky-radial-progress":[Ft,[],O=>O.globals.skyRadialProgress||0],accumulated:[wn,[],O=>void 0===O.globals.accumulated?null:O.globals.accumulated],"+":[Ft,qi(Ft),(O,P)=>{let z=0;for(const K of P)z+=K.evaluate(O);return z}],"*":[Ft,qi(Ft),(O,P)=>{let z=1;for(const K of P)z*=K.evaluate(O);return z}],"-":{type:Ft,overloads:[[[Ft,Ft],(O,[P,z])=>P.evaluate(O)-z.evaluate(O)],[[Ft],(O,[P])=>-P.evaluate(O)]]},"/":[Ft,[Ft,Ft],(O,[P,z])=>P.evaluate(O)/z.evaluate(O)],"%":[Ft,[Ft,Ft],(O,[P,z])=>P.evaluate(O)%z.evaluate(O)],ln2:[Ft,[],()=>Math.LN2],pi:[Ft,[],()=>Math.PI],e:[Ft,[],()=>Math.E],"^":[Ft,[Ft,Ft],(O,[P,z])=>Math.pow(P.evaluate(O),z.evaluate(O))],sqrt:[Ft,[Ft],(O,[P])=>Math.sqrt(P.evaluate(O))],log10:[Ft,[Ft],(O,[P])=>Math.log(P.evaluate(O))/Math.LN10],ln:[Ft,[Ft],(O,[P])=>Math.log(P.evaluate(O))],log2:[Ft,[Ft],(O,[P])=>Math.log(P.evaluate(O))/Math.LN2],sin:[Ft,[Ft],(O,[P])=>Math.sin(P.evaluate(O))],cos:[Ft,[Ft],(O,[P])=>Math.cos(P.evaluate(O))],tan:[Ft,[Ft],(O,[P])=>Math.tan(P.evaluate(O))],asin:[Ft,[Ft],(O,[P])=>Math.asin(P.evaluate(O))],acos:[Ft,[Ft],(O,[P])=>Math.acos(P.evaluate(O))],atan:[Ft,[Ft],(O,[P])=>Math.atan(P.evaluate(O))],min:[Ft,qi(Ft),(O,P)=>Math.min(...P.map(z=>z.evaluate(O)))],max:[Ft,qi(Ft),(O,P)=>Math.max(...P.map(z=>z.evaluate(O)))],abs:[Ft,[Ft],(O,[P])=>Math.abs(P.evaluate(O))],round:[Ft,[Ft],(O,[P])=>{const z=P.evaluate(O);return z<0?-Math.round(-z):Math.round(z)}],floor:[Ft,[Ft],(O,[P])=>Math.floor(P.evaluate(O))],ceil:[Ft,[Ft],(O,[P])=>Math.ceil(P.evaluate(O))],"filter-==":[or,[mr,wn],(O,[P,z])=>O.properties()[P.value]===z.value],"filter-id-==":[or,[wn],(O,[P])=>O.id()===P.value],"filter-type-==":[or,[mr],(O,[P])=>O.geometryType()===P.value],"filter-<":[or,[mr,wn],(O,[P,z])=>{const K=O.properties()[P.value],he=z.value;return typeof K==typeof he&&K<he}],"filter-id-<":[or,[wn],(O,[P])=>{const z=O.id(),K=P.value;return typeof z==typeof K&&z<K}],"filter->":[or,[mr,wn],(O,[P,z])=>{const K=O.properties()[P.value],he=z.value;return typeof K==typeof he&&K>he}],"filter-id->":[or,[wn],(O,[P])=>{const z=O.id(),K=P.value;return typeof z==typeof K&&z>K}],"filter-<=":[or,[mr,wn],(O,[P,z])=>{const K=O.properties()[P.value],he=z.value;return typeof K==typeof he&&K<=he}],"filter-id-<=":[or,[wn],(O,[P])=>{const z=O.id(),K=P.value;return typeof z==typeof K&&z<=K}],"filter->=":[or,[mr,wn],(O,[P,z])=>{const K=O.properties()[P.value],he=z.value;return typeof K==typeof he&&K>=he}],"filter-id->=":[or,[wn],(O,[P])=>{const z=O.id(),K=P.value;return typeof z==typeof K&&z>=K}],"filter-has":[or,[wn],(O,[P])=>P.value in O.properties()],"filter-has-id":[or,[],O=>null!==O.id()&&void 0!==O.id()],"filter-type-in":[or,[Kr(mr)],(O,[P])=>P.value.indexOf(O.geometryType())>=0],"filter-id-in":[or,[Kr(wn)],(O,[P])=>P.value.indexOf(O.id())>=0],"filter-in-small":[or,[mr,Kr(wn)],(O,[P,z])=>z.value.indexOf(O.properties()[P.value])>=0],"filter-in-large":[or,[mr,Kr(wn)],(O,[P,z])=>function(O,P,z,K){for(;z<=K;){const he=z+K>>1;if(P[he]===O)return!0;P[he]>O?K=he-1:z=he+1}return!1}(O.properties()[P.value],z.value,0,z.value.length-1)],all:{type:or,overloads:[[[or,or],(O,[P,z])=>P.evaluate(O)&&z.evaluate(O)],[qi(or),(O,P)=>{for(const z of P)if(!z.evaluate(O))return!1;return!0}]]},any:{type:or,overloads:[[[or,or],(O,[P,z])=>P.evaluate(O)||z.evaluate(O)],[qi(or),(O,P)=>{for(const z of P)if(z.evaluate(O))return!0;return!1}]]},"!":[or,[or],(O,[P])=>!P.evaluate(O)],"is-supported-script":[or,[mr],(O,[P])=>{const z=O.globals&&O.globals.isSupportedScript;return!z||z(P.evaluate(O))}],upcase:[mr,[mr],(O,[P])=>P.evaluate(O).toUpperCase()],downcase:[mr,[mr],(O,[P])=>P.evaluate(O).toLowerCase()],concat:[mr,qi(wn),(O,P)=>P.map(z=>Ts(z.evaluate(O))).join("")],"resolved-locale":[mr,[Yr],(O,[P])=>P.evaluate(O).resolvedLocale()]});class $n{constructor(P,z){var O;this.expression=P,this._warningHistory={},this._evaluator=new sf,this._defaultValue=z?"color"===(O=z).type&&Lp(O.default)?new Fr(0,0,0,0):"color"===O.type?Fr.parse(O.default)||null:void 0===O.default?null:O.default:null,this._enumValues=z&&"enum"===z.type?z.values:null}evaluateWithoutErrorHandling(P,z,K,he,fe,Ie,Fe,at){return this._evaluator.globals=P,this._evaluator.feature=z,this._evaluator.featureState=K,this._evaluator.canonical=he,this._evaluator.availableImages=fe||null,this._evaluator.formattedSection=Ie,this._evaluator.featureTileCoord=Fe||null,this._evaluator.featureDistanceData=at||null,this.expression.evaluate(this._evaluator)}evaluate(P,z,K,he,fe,Ie,Fe,at){this._evaluator.globals=P,this._evaluator.feature=z||null,this._evaluator.featureState=K||null,this._evaluator.canonical=he,this._evaluator.availableImages=fe||null,this._evaluator.formattedSection=Ie||null,this._evaluator.featureTileCoord=Fe||null,this._evaluator.featureDistanceData=at||null;try{const nt=this.expression.evaluate(this._evaluator);if(null==nt||"number"==typeof nt&&nt!=nt)return this._defaultValue;if(this._enumValues&&!(nt in this._enumValues))throw new xi(`Expected value to be one of ${Object.keys(this._enumValues).map(jt=>JSON.stringify(jt)).join(", ")}, but found ${JSON.stringify(nt)} instead.`);return nt}catch(nt){return this._warningHistory[nt.message]||(this._warningHistory[nt.message]=!0,"undefined"!=typeof console&&console.warn(nt.message)),this._defaultValue}}}function Hu(O){return Array.isArray(O)&&O.length>0&&"string"==typeof O[0]&&O[0]in El}function Ds(O,P){const z=new ka(El,[],P?function(O){const P={color:qt,string:mr,number:Ft,enum:mr,boolean:or,formatted:lr,resolvedImage:ni};return"array"===O.type?Kr(P[O.value]||wn,O.length):P[O.type]}(P):void 0),K=z.parse(O,void 0,void 0,void 0,P&&"string"===P.type?{typeAnnotation:"coerce"}:void 0);return K?yi(new $n(K,P)):ou(z.errors)}class Ua{constructor(P,z){this.kind=P,this._styleExpression=z,this.isStateDependent="constant"!==P&&!rc(z.expression)}evaluateWithoutErrorHandling(P,z,K,he,fe,Ie){return this._styleExpression.evaluateWithoutErrorHandling(P,z,K,he,fe,Ie)}evaluate(P,z,K,he,fe,Ie){return this._styleExpression.evaluate(P,z,K,he,fe,Ie)}}class Lo{constructor(P,z,K,he){this.kind=P,this.zoomStops=K,this._styleExpression=z,this.isStateDependent="camera"!==P&&!rc(z.expression),this.interpolationType=he}evaluateWithoutErrorHandling(P,z,K,he,fe,Ie){return this._styleExpression.evaluateWithoutErrorHandling(P,z,K,he,fe,Ie)}evaluate(P,z,K,he,fe,Ie){return this._styleExpression.evaluate(P,z,K,he,fe,Ie)}interpolationFactor(P,z,K){return this.interpolationType?Vs.interpolationFactor(this.interpolationType,P,z,K):0}}function bu(O,P){if("error"===(O=Ds(O,P)).result)return O;const z=O.value.expression,K=Eh(z);if(!K&&!Sl(P))return ou([new Bn("","data expressions not supported")]);const he=ii(z,["zoom","pitch","distance-from-center"]);if(!he&&!rd(P))return ou([new Bn("","zoom expressions not supported")]);const fe=rh(z);if(!fe&&!he)return ou([new Bn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(fe instanceof Bn)return ou([fe]);if(fe instanceof Vs&&!_u(P))return ou([new Bn("",'"interpolate" expressions cannot be used with this property')]);if(!fe)return yi(new Ua(K?"constant":"source",O.value));return yi(new Lo(K?"camera":"composite",O.value,fe.labels,fe instanceof Vs?fe.interpolation:void 0))}class qs{constructor(P,z){this._parameters=P,this._specification=z,On(this,Xh(this._parameters,this._specification))}static deserialize(P){return new qs(P._parameters,P._specification)}static serialize(P){return{_parameters:P._parameters,_specification:P._specification}}}function rh(O){let P=null;if(O instanceof As)P=rh(O.result);else if(O instanceof Rp){for(const z of O.args)if(P=rh(z),P)break}else(O instanceof Di||O instanceof Vs)&&O.input instanceof Us&&"zoom"===O.input.name&&(P=O);return P instanceof Bn||O.eachChild(z=>{const K=rh(z);K instanceof Bn?P=K:!P&&K?P=new Bn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):P&&K&&P!==K&&(P=new Bn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),P}function Oa(O){return"object"==typeof O?["literal",O]:O}function Tl(O){switch(O.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function uc(O,P){const z=Oa(function(O,P){return void 0!==O?O:void 0!==P?P:void 0}(O.default,P.default));return void 0===z&&"resolvedImage"===P.type?"":z}function Yh(O,P,z){const K=Yo(O,P),he=["get",O.property];if("categorical"===K&&"boolean"==typeof z[0][0]){const fe=["case"];for(const Ie of z)fe.push(["==",he,Ie[0]],Ie[1]);return fe.push(uc(O,P)),fe}if("categorical"===K){const fe=["match",he];for(const Ie of z)ih(fe,Ie[0],Ie[1],!1);return fe.push(uc(O,P)),fe}if("interval"===K){const fe=["step",["number",he]];for(const Ie of z)ih(fe,Ie[0],Ie[1],!0);return to(fe),void 0===O.default?fe:["case",["==",["typeof",he],"number"],fe,Oa(O.default)]}if("exponential"===K){const fe=void 0!==O.base?O.base:1,Ie=[Tl(O),1===fe?["linear"]:["exponential",fe],["number",he]];for(const Fe of z)ih(Ie,Fe[0],Fe[1],!1);return void 0===O.default?Ie:["case",["==",["typeof",he],"number"],Ie,Oa(O.default)]}throw new Error(`Unknown property function type ${K}`)}function to(O){"step"===O[0]&&3===O.length&&(O.push(0),O.push(O[3]))}function ih(O,P,z,K){O.length>3&&P===O[O.length-2]||(K&&2===O.length||O.push(P),O.push(z))}function Yo(O,P){return O.type?O.type:P.expression.interpolated?"exponential":"interval"}function Vr(O){const P=["concat"],z=/{([^{}]+)}/g;let K=0;for(let he=z.exec(O);null!==he;he=z.exec(O)){const fe=O.slice(K,z.lastIndex-he[0].length);K=z.lastIndex,fe.length>0&&P.push(fe),P.push(["get",he[1]])}if(1===P.length)return O;if(K<O.length)P.push(O.slice(K));else if(2===P.length)return["to-string",P[1]];return P}function ki(O){return O instanceof Number||O instanceof String||O instanceof Boolean?O.valueOf():O}function La(O){if(Array.isArray(O))return O.map(La);if(O instanceof Object&&!(O instanceof Number||O instanceof String||O instanceof Boolean)){const P={};for(const z in O)P[z]=La(O[z]);return P}return ki(O)}function ps(O){if(!0===O||!1===O)return!0;if(!Array.isArray(O)||0===O.length)return!1;switch(O[0]){case"has":return O.length>=2&&"$id"!==O[1]&&"$type"!==O[1];case"in":return O.length>=3&&("string"!=typeof O[1]||Array.isArray(O[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==O.length||Array.isArray(O[1])||Array.isArray(O[2]);case"any":case"all":for(const P of O.slice(1))if(!ps(P)&&"boolean"!=typeof P)return!1;return!0;default:return!0}}function Ja(O,P="fill"){if(null==O)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ps(O)||(O=Rs(O));const z=O;let K=!0;try{K=function(O){if(!ta(O))return O;let P=La(O);return ds(P),P=Wu(P),P}(z)}catch(jt){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(z,null,2)}\n        `)}const he=Ar[`filter_${P}`],fe=Ds(K,he);let Ie=null;if("error"===fe.result)throw new Error(fe.value.map(jt=>`${jt.key}: ${jt.message}`).join(", "));Ie=(jt,Pt,cn)=>fe.value.evaluate(jt,Pt,{},cn);let Fe=null,at=null;if(K!==z){const jt=Ds(z,he);if("error"===jt.result)throw new Error(jt.value.map(Pt=>`${Pt.key}: ${Pt.message}`).join(", "));Fe=(Pt,cn,Sn,ar,xn)=>jt.value.evaluate(Pt,cn,{},Sn,void 0,void 0,ar,xn),at=!Eh(jt.value.expression)}return Ie=Ie,{filter:Ie,dynamicFilter:Fe||void 0,needGeometry:$u(K),needFeature:!!at}}function Wu(O){if(!Array.isArray(O))return O;const P=function(O){if(Nr.has(O[0]))for(let P=1;P<O.length;P++)if(ta(O[P]))return!0;return O}(O);return!0===P?P:P.map(z=>Wu(z))}function ds(O){let P=!1;const z=[];if("case"===O[0]){for(let K=1;K<O.length-1;K+=2)P=P||ta(O[K]),z.push(O[K+1]);z.push(O[O.length-1])}else if("match"===O[0]){P=P||ta(O[1]);for(let K=2;K<O.length-1;K+=2)z.push(O[K+1]);z.push(O[O.length-1])}else if("step"===O[0]){P=P||ta(O[1]);for(let K=1;K<O.length-1;K+=2)z.push(O[K+1])}P&&(O.length=0,O.push("any",...z));for(let K=1;K<O.length;K++)ds(O[K])}function ta(O){if(!Array.isArray(O))return!1;if(function(O){return"pitch"===O||"distance-from-center"===O}(O[0]))return!0;for(let P=1;P<O.length;P++)if(ta(O[P]))return!0;return!1}const Nr=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ps(O,P){return O<P?-1:O>P?1:0}function $u(O){if(!Array.isArray(O))return!1;if("within"===O[0])return!0;for(let P=1;P<O.length;P++)if($u(O[P]))return!0;return!1}function Rs(O){if(!O)return!0;const P=O[0];return O.length<=1?"any"!==P:"=="===P?Lr(O[1],O[2],"=="):"!="===P?Ea(Lr(O[1],O[2],"==")):"<"===P||">"===P||"<="===P||">="===P?Lr(O[1],O[2],P):"any"===P?function(O){return["any"].concat(O.map(Rs))}(O.slice(1)):"all"===P?["all"].concat(O.slice(1).map(Rs)):"none"===P?["all"].concat(O.slice(1).map(Rs).map(Ea)):"in"===P?Eu(O[1],O.slice(2)):"!in"===P?Ea(Eu(O[1],O.slice(2))):"has"===P?co(O[1]):"!has"===P?Ea(co(O[1])):"within"!==P||O}function Lr(O,P,z){switch(O){case"$type":return[`filter-type-${z}`,P];case"$id":return[`filter-id-${z}`,P];default:return[`filter-${z}`,O,P]}}function Eu(O,P){if(0===P.length)return!1;switch(O){case"$type":return["filter-type-in",["literal",P]];case"$id":return["filter-id-in",["literal",P]];default:return P.length>200&&!P.some(z=>typeof z!=typeof P[0])?["filter-in-large",O,["literal",P.sort(Ps)]]:["filter-in-small",O,["literal",P]]}}function co(O){switch(O){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",O]}}function Ea(O){return["!",O]}var Su=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function hc(O,P){const z={};for(const K in O)"ref"!==K&&(z[K]=O[K]);return Su.forEach(K=>{K in P&&(z[K]=P[K])}),z}function pc(O){O=O.slice();const P=Object.create(null);for(let z=0;z<O.length;z++)P[O[z].id]=O[z];for(let z=0;z<O.length;z++)"ref"in O[z]&&(O[z]=hc(O[z],P[O[z].ref]));return O}class _{constructor(P,z,K,he){this.message=(P?`${P}: `:"")+K,he&&(this.identifier=he),null!=z&&z.__line__&&(this.line=z.__line__)}}class I{constructor(P){this.error=P,this.message=P.message;const z=P.message.match(/line (\d+)/);this.line=z?parseInt(z[1],10):0}}function j(O){const z=O.value;return z?[new _(O.key,z,"constants have been deprecated as of v8")]:[]}function f(O){const P=O.key,z=O.value,K=O.valueSpec||{},he=O.objectElementValidators||{},fe=O.style,Ie=O.styleSpec;let Fe=[];const at=vi(z);if("object"!==at)return[new _(P,z,`object expected, ${at} found`)];for(const nt in z){const jt=nt.split(".")[0],Pt=K[jt]||K["*"];let cn;if(he[jt])cn=he[jt];else if(K[jt])cn=dt;else if(he["*"])cn=he["*"];else{if(!K["*"]){Fe.push(new _(P,z[nt],`unknown property "${nt}"`));continue}cn=dt}Fe=Fe.concat(cn({key:(P&&`${P}.`)+nt,value:z[nt],valueSpec:Pt,style:fe,styleSpec:Ie,object:z,objectKey:nt},z))}for(const nt in K)he[nt]||K[nt].required&&void 0===K[nt].default&&void 0===z[nt]&&Fe.push(new _(P,z,`missing required property "${nt}"`));return Fe}function l(O){const P=O.value,z=O.valueSpec,K=O.style,he=O.styleSpec,fe=O.key,Ie=O.arrayElementValidator||dt;if("array"!==vi(P))return[new _(fe,P,`array expected, ${vi(P)} found`)];if(z.length&&P.length!==z.length)return[new _(fe,P,`array length ${z.length} expected, length ${P.length} found`)];if(z["min-length"]&&P.length<z["min-length"])return[new _(fe,P,`array length at least ${z["min-length"]} expected, length ${P.length} found`)];let Fe={type:z.value,values:z.values,minimum:z.minimum,maximum:z.maximum};he.$version<7&&(Fe.function=z.function),"object"===vi(z.value)&&(Fe=z.value);let at=[];for(let nt=0;nt<P.length;nt++)at=at.concat(Ie({array:P,arrayIndex:nt,value:P[nt],valueSpec:Fe,style:K,styleSpec:he,key:`${fe}[${nt}]`}));return at}function d(O){const P=O.key,z=O.value,K=O.valueSpec;let he=vi(z);if("number"===he&&z!=z&&(he="NaN"),"number"!==he)return[new _(P,z,`number expected, ${he} found`)];if("minimum"in K){let fe=K.minimum;if("array"===vi(K.minimum)&&(fe=K.minimum[O.arrayIndex]),z<fe)return[new _(P,z,`${z} is less than the minimum value ${fe}`)]}if("maximum"in K){let fe=K.maximum;if("array"===vi(K.maximum)&&(fe=K.maximum[O.arrayIndex]),z>fe)return[new _(P,z,`${z} is greater than the maximum value ${fe}`)]}return[]}function x(O){const P=O.valueSpec,z=ki(O.value.type);let K,fe,Ie,he={};const Fe="categorical"!==z&&void 0===O.value.property,at=!Fe,nt="array"===vi(O.value.stops)&&"array"===vi(O.value.stops[0])&&"object"===vi(O.value.stops[0][0]),jt=f({key:O.key,value:O.value,valueSpec:O.styleSpec.function,style:O.style,styleSpec:O.styleSpec,objectElementValidators:{stops:function(xn){if("identity"===z)return[new _(xn.key,xn.value,'identity function may not have a "stops" property')];let Xr=[];const Sr=xn.value;return Xr=Xr.concat(l({key:xn.key,value:Sr,valueSpec:xn.valueSpec,style:xn.style,styleSpec:xn.styleSpec,arrayElementValidator:cn})),"array"===vi(Sr)&&0===Sr.length&&Xr.push(new _(xn.key,Sr,"array must have at least one stop")),Xr},default:function(xn){return dt({key:xn.key,value:xn.value,valueSpec:P,style:xn.style,styleSpec:xn.styleSpec})}}});return"identity"===z&&Fe&&jt.push(new _(O.key,O.value,'missing required property "property"')),"identity"!==z&&!O.value.stops&&jt.push(new _(O.key,O.value,'missing required property "stops"')),"exponential"===z&&O.valueSpec.expression&&!_u(O.valueSpec)&&jt.push(new _(O.key,O.value,"exponential functions not supported")),O.styleSpec.$version>=8&&(at&&!Sl(O.valueSpec)?jt.push(new _(O.key,O.value,"property functions not supported")):Fe&&!rd(O.valueSpec)&&jt.push(new _(O.key,O.value,"zoom functions not supported"))),("categorical"===z||nt)&&void 0===O.value.property&&jt.push(new _(O.key,O.value,'"property" property is required')),jt;function cn(xn){let Xr=[];const Sr=xn.value,en=xn.key;if("array"!==vi(Sr))return[new _(en,Sr,`array expected, ${vi(Sr)} found`)];if(2!==Sr.length)return[new _(en,Sr,`array length 2 expected, length ${Sr.length} found`)];if(nt){if("object"!==vi(Sr[0]))return[new _(en,Sr,`object expected, ${vi(Sr[0])} found`)];if(void 0===Sr[0].zoom)return[new _(en,Sr,"object stop key must have zoom")];if(void 0===Sr[0].value)return[new _(en,Sr,"object stop key must have value")];if(Ie&&Ie>ki(Sr[0].zoom))return[new _(en,Sr[0].zoom,"stop zoom values must appear in ascending order")];ki(Sr[0].zoom)!==Ie&&(Ie=ki(Sr[0].zoom),fe=void 0,he={}),Xr=Xr.concat(f({key:`${en}[0]`,value:Sr[0],valueSpec:{zoom:{}},style:xn.style,styleSpec:xn.styleSpec,objectElementValidators:{zoom:d,value:Sn}}))}else Xr=Xr.concat(Sn({key:`${en}[0]`,value:Sr[0],valueSpec:{},style:xn.style,styleSpec:xn.styleSpec},Sr));return Hu(La(Sr[1]))?Xr.concat([new _(`${en}[1]`,Sr[1],"expressions are not allowed in function stops.")]):Xr.concat(dt({key:`${en}[1]`,value:Sr[1],valueSpec:P,style:xn.style,styleSpec:xn.styleSpec}))}function Sn(xn,Xr){const Sr=vi(xn.value),en=ki(xn.value),Vn=null!==xn.value?xn.value:Xr;if(K){if(Sr!==K)return[new _(xn.key,Vn,`${Sr} stop domain type must match previous stop domain type ${K}`)]}else K=Sr;if("number"!==Sr&&"string"!==Sr&&"boolean"!==Sr)return[new _(xn.key,Vn,"stop domain value must be a number, string, or boolean")];if("number"!==Sr&&"categorical"!==z){let yr=`number expected, ${Sr} found`;return Sl(P)&&void 0===z&&(yr+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new _(xn.key,Vn,yr)]}return"categorical"!==z||"number"!==Sr||isFinite(en)&&Math.floor(en)===en?"categorical"!==z&&"number"===Sr&&void 0!==fe&&en<fe?[new _(xn.key,Vn,"stop domain values must appear in ascending order")]:(fe=en,"categorical"===z&&en in he?[new _(xn.key,Vn,"stop domain values must be unique")]:(he[en]=!0,[])):[new _(xn.key,Vn,`integer expected, found ${en}`)]}}function M(O){const P=("property"===O.expressionContext?bu:Ds)(La(O.value),O.valueSpec);if("error"===P.result)return P.value.map(K=>new _(`${O.key}${K.key}`,O.value,K.message));const z=P.value.expression||P.value._styleExpression.expression;if("property"===O.expressionContext&&"text-font"===O.propertyKey&&!z.outputDefined())return[new _(O.key,O.value,`Invalid data expression for "${O.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===O.expressionContext&&"layout"===O.propertyType&&!rc(z))return[new _(O.key,O.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===O.expressionContext)return D(z,O);if(O.expressionContext&&0===O.expressionContext.indexOf("cluster")){if(!ii(z,["zoom","feature-state"]))return[new _(O.key,O.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===O.expressionContext&&!Eh(z))return[new _(O.key,O.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function D(O,P){const z=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const he of P.valueSpec.expression.parameters)z.delete(he);if(0===z.size)return[];const K=[];return O instanceof Us&&z.has(O.name)?[new _(P.key,P.value,`["${O.name}"] expression is not supported in a filter for a ${P.object.type} layer with id: ${P.object.id}`)]:(O.eachChild(he=>{K.push(...D(he,P))}),K)}function W(O){const P=O.key,z=O.value,K=O.valueSpec,he=[];return Array.isArray(K.values)?-1===K.values.indexOf(ki(z))&&he.push(new _(P,z,`expected one of [${K.values.join(", ")}], ${JSON.stringify(z)} found`)):-1===Object.keys(K.values).indexOf(ki(z))&&he.push(new _(P,z,`expected one of [${Object.keys(K.values).join(", ")}], ${JSON.stringify(z)} found`)),he}function Y(O){if(ps(La(O.value))){const P=La(O.layerType);return M(On({},O,{expressionContext:"filter",valueSpec:O.styleSpec[`filter_${P||"fill"}`]}))}return ee(O)}function ee(O){const P=O.value,z=O.key;if("array"!==vi(P))return[new _(z,P,`array expected, ${vi(P)} found`)];const K=O.styleSpec;let he,fe=[];if(P.length<1)return[new _(z,P,"filter array must have at least 1 element")];switch(fe=fe.concat(W({key:`${z}[0]`,value:P[0],valueSpec:K.filter_operator,style:O.style,styleSpec:O.styleSpec})),ki(P[0])){case"<":case"<=":case">":case">=":P.length>=2&&"$type"===ki(P[1])&&fe.push(new _(z,P,`"$type" cannot be use with operator "${P[0]}"`));case"==":case"!=":3!==P.length&&fe.push(new _(z,P,`filter array for operator "${P[0]}" must have 3 elements`));case"in":case"!in":P.length>=2&&(he=vi(P[1]),"string"!==he&&fe.push(new _(`${z}[1]`,P[1],`string expected, ${he} found`)));for(let Ie=2;Ie<P.length;Ie++)he=vi(P[Ie]),"$type"===ki(P[1])?fe=fe.concat(W({key:`${z}[${Ie}]`,value:P[Ie],valueSpec:K.geometry_type,style:O.style,styleSpec:O.styleSpec})):"string"!==he&&"number"!==he&&"boolean"!==he&&fe.push(new _(`${z}[${Ie}]`,P[Ie],`string, number, or boolean expected, ${he} found`));break;case"any":case"all":case"none":for(let Ie=1;Ie<P.length;Ie++)fe=fe.concat(ee({key:`${z}[${Ie}]`,value:P[Ie],style:O.style,styleSpec:O.styleSpec}));break;case"has":case"!has":he=vi(P[1]),2!==P.length?fe.push(new _(z,P,`filter array for "${P[0]}" operator must have 2 elements`)):"string"!==he&&fe.push(new _(`${z}[1]`,P[1],`string expected, ${he} found`));break;case"within":he=vi(P[1]),2!==P.length?fe.push(new _(z,P,`filter array for "${P[0]}" operator must have 2 elements`)):"object"!==he&&fe.push(new _(`${z}[1]`,P[1],`object expected, ${he} found`))}return fe}function Q(O,P){const z=O.key,K=O.style,he=O.styleSpec,fe=O.value,Ie=O.objectKey,Fe=he[`${P}_${O.layerType}`];if(!Fe)return[];const at=Ie.match(/^(.*)-transition$/);if("paint"===P&&at&&Fe[at[1]]&&Fe[at[1]].transition)return dt({key:z,value:fe,valueSpec:he.transition,style:K,styleSpec:he});const nt=O.valueSpec||Fe[Ie];if(!nt)return[new _(z,fe,`unknown property "${Ie}"`)];let jt;if("string"===vi(fe)&&Sl(nt)&&!nt.tokens&&(jt=/^{([^}]+)}$/.exec(fe)))return[new _(z,fe,`"${Ie}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(jt[1])} }\`.`)];const Pt=[];return"symbol"===O.layerType&&("text-field"===Ie&&K&&!K.glyphs&&Pt.push(new _(z,fe,'use of "text-field" requires a style "glyphs" property')),"text-font"===Ie&&Lp(La(fe))&&"identity"===ki(fe.type)&&Pt.push(new _(z,fe,'"text-font" does not support identity functions'))),Pt.concat(dt({key:O.key,value:fe,valueSpec:nt,style:K,styleSpec:he,expressionContext:"property",propertyType:P,propertyKey:Ie}))}function le(O){return Q(O,"paint")}function de(O){return Q(O,"layout")}function ge(O){let P=[];const z=O.value,K=O.key,he=O.style,fe=O.styleSpec;!z.type&&!z.ref&&P.push(new _(K,z,'either "type" or "ref" is required'));let Ie=ki(z.type);const Fe=ki(z.ref);if(z.id){const at=ki(z.id);for(let nt=0;nt<O.arrayIndex;nt++){const jt=he.layers[nt];ki(jt.id)===at&&P.push(new _(K,z.id,`duplicate layer id "${z.id}", previously used at line ${jt.id.__line__}`))}}if("ref"in z){let at;["type","source","source-layer","filter","layout"].forEach(nt=>{nt in z&&P.push(new _(K,z[nt],`"${nt}" is prohibited for ref layers`))}),he.layers.forEach(nt=>{ki(nt.id)===Fe&&(at=nt)}),at?at.ref?P.push(new _(K,z.ref,"ref cannot reference another ref layer")):Ie=ki(at.type):P.push(new _(K,z.ref,`ref layer "${Fe}" not found`))}else if("background"!==Ie&&"sky"!==Ie)if(z.source){const at=he.sources&&he.sources[z.source],nt=at&&ki(at.type);at?"vector"===nt&&"raster"===Ie?P.push(new _(K,z.source,`layer "${z.id}" requires a raster source`)):"raster"===nt&&"raster"!==Ie?P.push(new _(K,z.source,`layer "${z.id}" requires a vector source`)):"vector"!==nt||z["source-layer"]?"raster-dem"===nt&&"hillshade"!==Ie?P.push(new _(K,z.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"===Ie&&z.paint&&z.paint["line-gradient"]&&("geojson"!==nt||!at.lineMetrics)&&P.push(new _(K,z,`layer "${z.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):P.push(new _(K,z,`layer "${z.id}" must specify a "source-layer"`)):P.push(new _(K,z.source,`source "${z.source}" not found`))}else P.push(new _(K,z,'missing required property "source"'));return P=P.concat(f({key:K,value:z,valueSpec:fe.layer,style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":()=>[],type:()=>dt({key:`${K}.type`,value:z.type,valueSpec:fe.layer.type,style:O.style,styleSpec:O.styleSpec,object:z,objectKey:"type"}),filter:at=>Y(On({layerType:Ie},at)),layout:at=>f({layer:z,key:at.key,value:at.value,style:at.style,styleSpec:at.styleSpec,objectElementValidators:{"*":nt=>de(On({layerType:Ie},nt))}}),paint:at=>f({layer:z,key:at.key,value:at.value,style:at.style,styleSpec:at.styleSpec,objectElementValidators:{"*":nt=>le(On({layerType:Ie},nt))}})}})),P}function xe(O){const P=O.value,z=O.key,K=vi(P);return"string"!==K?[new _(z,P,`string expected, ${K} found`)]:[]}const Te={promoteId:function({key:O,value:P}){if("string"===vi(P))return xe({key:O,value:P});{const z=[];for(const K in P)z.push(...xe({key:`${O}.${K}`,value:P[K]}));return z}}};function Ee(O){const P=O.value,z=O.key,K=O.styleSpec,he=O.style;if(!P.type)return[new _(z,P,'"type" is required')];const fe=ki(P.type);let Ie;switch(fe){case"vector":case"raster":case"raster-dem":return Ie=f({key:z,value:P,valueSpec:K[`source_${fe.replace("-","_")}`],style:O.style,styleSpec:K,objectElementValidators:Te}),Ie;case"geojson":if(Ie=f({key:z,value:P,valueSpec:K.source_geojson,style:he,styleSpec:K,objectElementValidators:Te}),P.cluster)for(const Fe in P.clusterProperties){const[at,nt]=P.clusterProperties[Fe],jt="string"==typeof at?[at,["accumulated"],["get",Fe]]:at;Ie.push(...M({key:`${z}.${Fe}.map`,value:nt,expressionContext:"cluster-map"})),Ie.push(...M({key:`${z}.${Fe}.reduce`,value:jt,expressionContext:"cluster-reduce"}))}return Ie;case"video":return f({key:z,value:P,valueSpec:K.source_video,style:he,styleSpec:K});case"image":return f({key:z,value:P,valueSpec:K.source_image,style:he,styleSpec:K});case"canvas":return[new _(z,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return W({key:`${z}.type`,value:P.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:he,styleSpec:K})}}function Le(O){const P=O.value,z=O.styleSpec,K=z.light,he=O.style;let fe=[];const Ie=vi(P);if(void 0===P)return fe;if("object"!==Ie)return fe=fe.concat([new _("light",P,`object expected, ${Ie} found`)]),fe;for(const Fe in P){const at=Fe.match(/^(.*)-transition$/);fe=fe.concat(at&&K[at[1]]&&K[at[1]].transition?dt({key:Fe,value:P[Fe],valueSpec:z.transition,style:he,styleSpec:z}):K[Fe]?dt({key:Fe,value:P[Fe],valueSpec:K[Fe],style:he,styleSpec:z}):[new _(Fe,P[Fe],`unknown property "${Fe}"`)])}return fe}function Me(O){const P=O.value,z=O.key,K=O.style,he=O.styleSpec,fe=he.terrain;let Ie=[];const Fe=vi(P);if(void 0===P)return Ie;if("object"!==Fe)return Ie=Ie.concat([new _("terrain",P,`object expected, ${Fe} found`)]),Ie;for(const at in P){const nt=at.match(/^(.*)-transition$/);Ie=Ie.concat(nt&&fe[nt[1]]&&fe[nt[1]].transition?dt({key:at,value:P[at],valueSpec:he.transition,style:K,styleSpec:he}):fe[at]?dt({key:at,value:P[at],valueSpec:fe[at],style:K,styleSpec:he}):[new _(at,P[at],`unknown property "${at}"`)])}if(P.source){const at=K.sources&&K.sources[P.source],nt=at&&ki(at.type);at?"raster-dem"!==nt&&Ie.push(new _(z,P.source,`terrain cannot be used with a source of type ${nt}, it only be used with a "raster-dem" source type`)):Ie.push(new _(z,P.source,`source "${P.source}" not found`))}else Ie.push(new _(z,P,'terrain is missing required property "source"'));return Ie}function Ue(O){const P=O.value,z=O.style,K=O.styleSpec,he=K.fog;let fe=[];const Ie=vi(P);if(void 0===P)return fe;if("object"!==Ie)return fe=fe.concat([new _("fog",P,`object expected, ${Ie} found`)]),fe;for(const Fe in P){const at=Fe.match(/^(.*)-transition$/);fe=fe.concat(at&&he[at[1]]&&he[at[1]].transition?dt({key:Fe,value:P[Fe],valueSpec:K.transition,style:z,styleSpec:K}):he[Fe]?dt({key:Fe,value:P[Fe],valueSpec:he[Fe],style:z,styleSpec:K}):[new _(Fe,P[Fe],`unknown property "${Fe}"`)])}return fe}const Ot={"*":()=>[],array:l,boolean:function(O){const P=O.value,z=O.key,K=vi(P);return"boolean"!==K?[new _(z,P,`boolean expected, ${K} found`)]:[]},number:d,color:function(O){const P=O.key,z=O.value,K=vi(z);return"string"!==K?[new _(P,z,`color expected, ${K} found`)]:null===Ya.parseCSSColor(z)?[new _(P,z,`color expected, "${z}" found`)]:[]},constants:j,enum:W,filter:Y,function:x,layer:ge,object:f,source:Ee,light:Le,terrain:Me,fog:Ue,string:xe,formatted:function(O){return 0===xe(O).length?[]:M(O)},resolvedImage:function(O){return 0===xe(O).length?[]:M(O)},projection:function(O){const P=O.value,z=O.styleSpec,K=z.projection,he=O.style;let fe=[];const Ie=vi(P);if("object"===Ie)for(const Fe in P)fe=fe.concat(dt({key:Fe,value:P[Fe],valueSpec:K[Fe],style:he,styleSpec:z}));else"string"!==Ie&&(fe=fe.concat([new _("projection",P,`object or string expected, ${Ie} found`)]));return fe}};function dt(O){const P=O.value,z=O.valueSpec,K=O.styleSpec;return z.expression&&Lp(ki(P))?x(O):z.expression&&Hu(La(P))?M(O):z.type&&Ot[z.type]?Ot[z.type](O):f(On({},O,{valueSpec:z.type?K[z.type]:z}))}function Nt(O){const P=O.value,z=O.key,K=xe(O);return K.length||(-1===P.indexOf("{fontstack}")&&K.push(new _(z,P,'"glyphs" url must include a "{fontstack}" token')),-1===P.indexOf("{range}")&&K.push(new _(z,P,'"glyphs" url must include a "{range}" token'))),K}function wt(O,P=Ar){let z=[];return z=z.concat(dt({key:"",value:O,valueSpec:P.$root,styleSpec:P,style:O,objectElementValidators:{glyphs:Nt,"*":()=>[]}})),O.constants&&(z=z.concat(j({key:"constants",value:O.constants,style:O,styleSpec:P}))),Zt(z)}function Zt(O){return[].concat(O).sort((P,z)=>P.line-z.line)}function ft(O){return function(...P){return Zt(O.apply(this,P))}}wt.source=ft(Ee),wt.light=ft(Le),wt.terrain=ft(Me),wt.fog=ft(Ue),wt.layer=ft(ge),wt.filter=ft(Y),wt.paintProperty=ft(le),wt.layoutProperty=ft(de);var Gt=gu(function(O,P){var z=function(){var K=function(Sr,en,Vn,yr){for(Vn=Vn||{},yr=Sr.length;yr--;Vn[Sr[yr]]=en);return Vn},he=[1,12],fe=[1,13],Ie=[1,9],Fe=[1,10],at=[1,11],nt=[1,14],jt=[1,15],Pt=[14,18,22,24],cn=[18,22],Sn=[22,24],ar={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(en,Vn,yr,Br,ei,ci,qa){var ai=ci.length-1;switch(ei){case 1:this.$=new String(en.replace(/\\(\\|")/g,"$1").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"\t").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\b/g,"\b")),this.$.__line__=this._$.first_line;break;case 2:this.$=new Number(en),this.$.__line__=this._$.first_line;break;case 3:this.$=null;break;case 4:this.$=new Boolean(!0),this.$.__line__=this._$.first_line;break;case 5:this.$=new Boolean(!1),this.$.__line__=this._$.first_line;break;case 6:return this.$=ci[ai-1];case 13:this.$={},Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 14:case 19:this.$=ci[ai-1],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 15:this.$=[ci[ai-2],ci[ai]];break;case 16:this.$={},this.$[ci[ai][0]]=ci[ai][1];break;case 17:this.$=ci[ai-2],ci[ai-2][ci[ai][0]]=ci[ai][1];break;case 18:this.$=[],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 20:this.$=[ci[ai]];break;case 21:this.$=ci[ai-2],ci[ai-2].push(ci[ai])}},table:[{3:5,4:he,5:6,6:fe,7:3,8:Ie,9:4,10:Fe,11:at,12:1,13:2,15:7,16:8,17:nt,23:jt},{1:[3]},{14:[1,16]},K(Pt,[2,7]),K(Pt,[2,8]),K(Pt,[2,9]),K(Pt,[2,10]),K(Pt,[2,11]),K(Pt,[2,12]),K(Pt,[2,3]),K(Pt,[2,4]),K(Pt,[2,5]),K([14,18,21,22,24],[2,1]),K(Pt,[2,2]),{3:20,4:he,18:[1,17],19:18,20:19},{3:5,4:he,5:6,6:fe,7:3,8:Ie,9:4,10:Fe,11:at,13:23,15:7,16:8,17:nt,23:jt,24:[1,21],25:22},{1:[2,6]},K(Pt,[2,13]),{18:[1,24],22:[1,25]},K(cn,[2,16]),{21:[1,26]},K(Pt,[2,18]),{22:[1,28],24:[1,27]},K(Sn,[2,20]),K(Pt,[2,14]),{3:20,4:he,20:29},{3:5,4:he,5:6,6:fe,7:3,8:Ie,9:4,10:Fe,11:at,13:30,15:7,16:8,17:nt,23:jt},K(Pt,[2,19]),{3:5,4:he,5:6,6:fe,7:3,8:Ie,9:4,10:Fe,11:at,13:31,15:7,16:8,17:nt,23:jt},K(cn,[2,17]),K(cn,[2,15]),K(Sn,[2,21])],defaultActions:{16:[2,6]},parseError:function(en,Vn){if(!Vn.recoverable)throw new Error(en);this.trace(en)},parse:function(en){var Vn=this,yr=[0],Br=[null],ei=[],ci=this.table,qa="",ai=0,Iu=0,Xu=2,fc=1,el=ei.slice.call(arguments,1),Sa=Object.create(this.lexer),Mu={yy:{}};for(var Gl in this.yy)Object.prototype.hasOwnProperty.call(this.yy,Gl)&&(Mu.yy[Gl]=this.yy[Gl]);Sa.setInput(en,Mu.yy),Mu.yy.lexer=Sa,Mu.yy.parser=this,void 0===Sa.yylloc&&(Sa.yylloc={});var Id=Sa.yylloc;ei.push(Id);var lf=Sa.options&&Sa.options.ranges;function ao(){var su;return"number"!=typeof(su=Sa.lex()||fc)&&(su=Vn.symbols_[su]||su),su}this.parseError="function"==typeof Mu.yy.parseError?Mu.yy.parseError:Object.getPrototypeOf(this).parseError;for(var hr,ti,wi,Uo,Qa,Vo,mc,To={};;){if(this.defaultActions[ti=yr[yr.length-1]]?wi=this.defaultActions[ti]:(null==hr&&(hr=ao()),wi=ci[ti]&&ci[ti][hr]),void 0===wi||!wi.length||!wi[0]){var Go="";for(Qa in mc=[],ci[ti])this.terminals_[Qa]&&Qa>Xu&&mc.push("'"+this.terminals_[Qa]+"'");Go=Sa.showPosition?"Parse error on line "+(ai+1)+":\n"+Sa.showPosition()+"\nExpecting "+mc.join(", ")+", got '"+(this.terminals_[hr]||hr)+"'":"Parse error on line "+(ai+1)+": Unexpected "+(hr==fc?"end of input":"'"+(this.terminals_[hr]||hr)+"'"),this.parseError(Go,{text:Sa.match,token:this.terminals_[hr]||hr,line:Sa.yylineno,loc:Id,expected:mc})}if(wi[0]instanceof Array&&wi.length>1)throw new Error("Parse Error: multiple actions possible at state: "+ti+", token: "+hr);switch(wi[0]){case 1:yr.push(hr),Br.push(Sa.yytext),ei.push(Sa.yylloc),yr.push(wi[1]),hr=null,Iu=Sa.yyleng,qa=Sa.yytext,ai=Sa.yylineno,Id=Sa.yylloc;break;case 2:if(To.$=Br[Br.length-(Vo=this.productions_[wi[1]][1])],To._$={first_line:ei[ei.length-(Vo||1)].first_line,last_line:ei[ei.length-1].last_line,first_column:ei[ei.length-(Vo||1)].first_column,last_column:ei[ei.length-1].last_column},lf&&(To._$.range=[ei[ei.length-(Vo||1)].range[0],ei[ei.length-1].range[1]]),void 0!==(Uo=this.performAction.apply(To,[qa,Iu,ai,Mu.yy,wi[1],Br,ei].concat(el))))return Uo;Vo&&(yr=yr.slice(0,-1*Vo*2),Br=Br.slice(0,-1*Vo),ei=ei.slice(0,-1*Vo)),yr.push(this.productions_[wi[1]][0]),Br.push(To.$),ei.push(To._$),yr.push(ci[yr[yr.length-2]][yr[yr.length-1]]);break;case 3:return!0}}return!0}};function Xr(){this.yy={}}return ar.lexer={EOF:1,parseError:function(Vn,yr){if(!this.yy.parser)throw new Error(Vn);this.yy.parser.parseError(Vn,yr)},setInput:function(en,Vn){return this.yy=Vn||this.yy||{},this._input=en,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var en=this._input[0];return this.yytext+=en,this.yyleng++,this.offset++,this.match+=en,this.matched+=en,en.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),en},unput:function(en){var Vn=en.length,yr=en.split(/(?:\r\n?|\n)/g);this._input=en+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-Vn),this.offset-=Vn;var Br=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),yr.length-1&&(this.yylineno-=yr.length-1);var ei=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:yr?(yr.length===Br.length?this.yylloc.first_column:0)+Br[Br.length-yr.length].length-yr[0].length:this.yylloc.first_column-Vn},this.options.ranges&&(this.yylloc.range=[ei[0],ei[0]+this.yyleng-Vn]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(en){this.unput(this.match.slice(en))},pastInput:function(){var en=this.matched.substr(0,this.matched.length-this.match.length);return(en.length>20?"...":"")+en.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var en=this.match;return en.length<20&&(en+=this._input.substr(0,20-en.length)),(en.substr(0,20)+(en.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var en=this.pastInput(),Vn=new Array(en.length+1).join("-");return en+this.upcomingInput()+"\n"+Vn+"^"},test_match:function(en,Vn){var yr,Br,ei;if(this.options.backtrack_lexer&&(ei={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(ei.yylloc.range=this.yylloc.range.slice(0))),(Br=en[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=Br.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:Br?Br[Br.length-1].length-Br[Br.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+en[0].length},this.yytext+=en[0],this.match+=en[0],this.matches=en,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(en[0].length),this.matched+=en[0],yr=this.performAction.call(this,this.yy,this,Vn,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),yr)return yr;if(this._backtrack){for(var ci in ei)this[ci]=ei[ci];return!1}return!1},next:function(){if(this.done)return this.EOF;var en,Vn,yr,Br;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var ei=this._currentRules(),ci=0;ci<ei.length;ci++)if((yr=this._input.match(this.rules[ei[ci]]))&&(!Vn||yr[0].length>Vn[0].length)){if(Vn=yr,Br=ci,this.options.backtrack_lexer){if(!1!==(en=this.test_match(yr,ei[ci])))return en;if(this._backtrack){Vn=!1;continue}return!1}if(!this.options.flex)break}return Vn?!1!==(en=this.test_match(Vn,ei[Br]))&&en:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){return this.next()||this.lex()},begin:function(Vn){this.conditionStack.push(Vn)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(Vn){return(Vn=this.conditionStack.length-1-Math.abs(Vn||0))>=0?this.conditionStack[Vn]:"INITIAL"},pushState:function(Vn){this.begin(Vn)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(Vn,yr,Br,ei){switch(Br){case 0:break;case 1:return 6;case 2:return yr.yytext=yr.yytext.substr(1,yr.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}},Xr.prototype=ar,ar.Parser=Xr,new Xr}();void 0!==_l&&(P.parser=z,P.Parser=z.Parser,P.parse=function(){return z.parse.apply(z,arguments)})});function mn(O,P=Ar){let z=O;try{z=function(O){if(O instanceof String||"string"==typeof O||O instanceof Buffer)try{return Gt.parse(O.toString())}catch(P){throw new I(P)}return O}(z)}catch(K){return[K]}return wt(z,P)}const Ko={StyleExpression:$n,isExpression:Hu,isExpressionFilter:ps,createExpression:Ds,createPropertyExpression:bu,normalizePropertyExpression:function(O,P){if(Lp(O))return new qs(O,P);if(Hu(O)){const z=bu(O,P);if("error"===z.result)throw new Error(z.value.map(K=>`${K.key}: ${K.message}`).join(", "));return z.value}{let z=O;return"string"==typeof O&&"color"===P.type&&(z=Fr.parse(O)),{kind:"constant",evaluate:()=>z}}},ZoomConstantExpression:Ua,ZoomDependentExpression:Lo,StylePropertyFunction:qs},va={convertFunction:function(O,P){let z=O.stops;if(!z)return function(O,P){const z=["get",O.property];if(void 0===O.default)return"string"===P.type?["string",z]:z;if("enum"===P.type)return["match",z,Object.keys(P.values),z,O.default];{const K=["color"===P.type?"to-color":P.type,z,Oa(O.default)];return"array"===P.type&&K.splice(1,0,P.value,P.length||null),K}}(O,P);const K=z&&"object"==typeof z[0][0],he=K||void 0!==O.property,fe=K||!he;return z=z.map(Ie=>!he&&P.tokens&&"string"==typeof Ie[1]?[Ie[0],Vr(Ie[1])]:[Ie[0],Oa(Ie[1])]),K?function(O,P,z){const K={},he={},fe=[];for(let Fe=0;Fe<z.length;Fe++){const at=z[Fe],nt=at[0].zoom;void 0===K[nt]&&(K[nt]={zoom:nt,type:O.type,property:O.property,default:O.default},he[nt]=[],fe.push(nt)),he[nt].push([at[0].value,at[1]])}if("exponential"===Yo({},P)){const Fe=[Tl(O),["linear"],["zoom"]];for(const at of fe)ih(Fe,at,Yh(K[at],P,he[at]),!1);return Fe}{const Fe=["step",["zoom"]];for(const at of fe)ih(Fe,at,Yh(K[at],P,he[at]),!0);return to(Fe),Fe}}(O,P,z):fe?function(O,P,z,K=["zoom"]){const he=Yo(O,P);let fe,Ie=!1;if("interval"===he)fe=["step",K],Ie=!0;else{if("exponential"!==he)throw new Error(`Unknown zoom function type "${he}"`);{const Fe=void 0!==O.base?O.base:1;fe=[Tl(O),1===Fe?["linear"]:["exponential",Fe],K]}}for(const Fe of z)ih(fe,Fe[0],Fe[1],Ie);return to(fe),fe}(O,P,z):Yh(O,P,z)},createFunction:Xh,isFunction:Lp};mn.parsed=mn,mn.latest=mn},593:xr=>{"use strict";xr.exports=JSON.parse('{"_args":[["axios@0.21.4","C:\\\\project\\\\vectortile\\\\vectortile-bgt-style-viewer"]],"_from":"axios@0.21.4","_id":"axios@0.21.4","_inBundle":false,"_integrity":"sha1-xnuQ3AVo5cHPKwuFjEO6KOLtpXU=","_location":"/axios","_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"axios@0.21.4","name":"axios","escapedName":"axios","rawSpec":"0.21.4","saveSpec":null,"fetchSpec":"0.21.4"},"_requiredBy":["/@watergis/mapbox-gl-legend"],"_resolved":"https://dev-brm.cs.kadaster.nl:443/artifactory/api/npm/npm-registry/axios/-/axios-0.21.4.tgz","_spec":"0.21.4","_where":"C:\\\\project\\\\vectortile\\\\vectortile-bgt-style-viewer","author":{"name":"Matt Zabriskie"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"bugs":{"url":"https://github.com/axios/axios/issues"},"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}],"dependencies":{"follow-redirects":"^1.14.0"},"description":"Promise based HTTP client for the browser and node.js","devDependencies":{"coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^8.2.1","sinon":"^4.5.0","terser-webpack-plugin":"^4.2.3","typescript":"^4.0.5","url-search-params":"^0.10.0","webpack":"^4.44.2","webpack-dev-server":"^3.11.0"},"homepage":"https://axios-http.com","jsdelivr":"dist/axios.min.js","keywords":["xhr","http","ajax","promise","node"],"license":"MIT","main":"index.js","name":"axios","repository":{"type":"git","url":"git+https://github.com/axios/axios.git"},"scripts":{"build":"NODE_ENV=production grunt build","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","examples":"node ./examples/server.js","fix":"eslint --fix lib/**/*.js","postversion":"git push && git push --tags","preversion":"npm test","start":"node ./sandbox/server.js","test":"grunt test","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json"},"typings":"./index.d.ts","unpkg":"dist/axios.min.js","version":"0.21.4"}')}},xr=>{xr(xr.s=21)}]);